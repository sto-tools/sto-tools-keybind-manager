const e="v2025.06.20-preview-1",t={};function a(e,a){t[e]||(t[e]=new Set),t[e].add(a)}function n(e,a){t[e]&&t[e].delete(a)}function o(e,a){if(t[e])for(const n of t[e])try{n(a)}catch(e){console.error(e)}}var i={on:a,off:n,emit:o,onDom:function(e,t,i,s){if("string"==typeof e&&(e=document.getElementById(e)),!e||!e.addEventListener)return()=>{};"function"==typeof i&&(s=i,i=t),i||(i=t);const r=e=>o(i,e);return e.addEventListener(t,r),s&&a(i,s),()=>{e.removeEventListener(t,r),s&&n(i,s)}}};const s={commands:{targeting:{name:"Targeting",icon:"fas fa-crosshairs",description:"Target selection and management",commands:{target:{name:"Target by Name",command:"Target",description:"Target entity by name (requires quotes)",syntax:'Target "EntityName"',icon:"üéØ",customizable:!0,parameters:{entityName:{type:"text",default:"EntityName",placeholder:"Enter entity name"}}},target_enemy_near:{name:"Target Nearest Enemy",command:"Target_Enemy_Near",description:"Target the nearest enemy in view",syntax:"Target_Enemy_Near",icon:"üéØ"},target_friend_near:{name:"Target Nearest Friend",command:"Target_Friend_Near",description:"Target the nearest friendly entity",syntax:"Target_Friend_Near",icon:"ü§ù"},target_self:{name:"Target Self",command:"Target_Self",description:"Target your own ship/character",syntax:"Target_Self",icon:"üë§"},target_clear:{name:"Clear Target",command:"Target_Clear",description:"Remove current target lock",syntax:"Target_Clear",icon:"‚ùå"},target_teammate_1:{name:"Target Teammate 1",command:"Target_Teammate 1",description:"Target first team member",syntax:"Target_Teammate 1",icon:"üë•"},target_teammate_2:{name:"Target Teammate 2",command:"Target_Teammate 2",description:"Target second team member",syntax:"Target_Teammate 2",icon:"üë•"},target_teammate_3:{name:"Target Teammate 3",command:"Target_Teammate 3",description:"Target third team member",syntax:"Target_Teammate 3",icon:"üë•"},target_teammate_4:{name:"Target Teammate 4",command:"Target_Teammate 4",description:"Target fourth team member",syntax:"Target_Teammate 4",icon:"üë•"}}},combat:{name:"Combat",icon:"fas fa-fire",description:"Weapon firing and combat actions",commands:{fire_all:{name:"Fire All Weapons",command:"FireAll",description:"Fire all weapons",syntax:"FireAll",environment:"space",icon:"üî•",warning:"Not recommended on spam bars as it interferes with firing cycles"},fire_phasers:{name:"Fire Energy Weapons",command:"FirePhasers",description:"Fire all Energy Weapons",syntax:"FirePhasers",environment:"space",icon:"‚ö°",warning:"Not recommended on spam bars as it interferes with firing cycles"},fire_torps:{name:"Fire Torpedoes",command:"FireTorps",description:"Fire all Torpedos",syntax:"FireTorps",environment:"space",icon:"üöÄ",warning:"Not recommended on spam bars as it interferes with firing cycles"},fire_mines:{name:"Fire Mines",command:"FireMines",description:"Fire all Mines",syntax:"FireMines",environment:"space",icon:"üí£",warning:"Not recommended on spam bars as it interferes with firing cycles"},fire_phasers_torps:{name:"Fire Phasers & Torpedoes",command:"FirePhasersTorps",description:"Fire phasers & torpedos",syntax:"FirePhasersTorps",environment:"space",icon:"üí•",warning:"Not recommended on spam bars as it interferes with firing cycles"},fire_projectiles:{name:"Fire Projectiles",command:"FireProjectiles",description:"Fire torpedos & mines",syntax:"FireProjectiles",environment:"space",icon:"üéØ",warning:"Not recommended on spam bars as it interferes with firing cycles"}}},tray:{name:"Tray Execution",icon:"fas fa-th",description:"Execute abilities from action trays",commands:{custom_tray:{name:"Tray Execution",command:"+STOTrayExecByTray 0 0",description:"Execute specific tray slot",syntax:"+STOTrayExecByTray <tray> <slot>",icon:"‚ö°",customizable:!0,parameters:{tray:{type:"number",min:0,max:9,default:0},slot:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"STOTrayExecByTray"}}},tray_with_backup:{name:"Tray Execution with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute specific tray slot with backup ability",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot>",icon:"‚ö°",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},slot:{type:"number",min:0,max:9,default:0},backup_tray:{type:"number",min:0,max:9,default:0},backup_slot:{type:"number",min:0,max:9,default:0}}},tray_range:{name:"Tray Range Execution",command:"+STOTrayExecByTray 0 0",description:"Execute a range of tray slots",syntax:"+STOTrayExecByTray <tray> <slot> $$ ... (range)",icon:"‚ö°",customizable:!0,parameters:{start_tray:{type:"number",min:0,max:9,default:0},start_slot:{type:"number",min:0,max:9,default:0},end_tray:{type:"number",min:0,max:9,default:0},end_slot:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"STOTrayExecByTray"}}},tray_range_with_backup:{name:"Tray Range with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute a range of tray slots with backup abilities",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot> $$ ... (range)",icon:"‚ö°",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},start_tray:{type:"number",min:0,max:9,default:0},start_slot:{type:"number",min:0,max:9,default:0},end_tray:{type:"number",min:0,max:9,default:0},end_slot:{type:"number",min:0,max:9,default:0},backup_start_tray:{type:"number",min:0,max:9,default:0},backup_start_slot:{type:"number",min:0,max:9,default:0},backup_end_tray:{type:"number",min:0,max:9,default:0},backup_end_slot:{type:"number",min:0,max:9,default:0}}},whole_tray:{name:"Whole Tray Execution",command:"+STOTrayExecByTray 0 0",description:"Execute all slots in a tray",syntax:"+STOTrayExecByTray <tray> <slot> $$ ... (all slots)",icon:"‚ö°",customizable:!0,parameters:{tray:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"STOTrayExecByTray"}}},whole_tray_with_backup:{name:"Whole Tray with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute all slots in a tray with backup tray",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot> $$ ... (all slots)",icon:"‚ö°",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},backup_tray:{type:"number",min:0,max:9,default:0}}}}},power:{name:"Shield Management",icon:"fas fa-shield-alt",description:"Shield power and distribution management",commands:{distribute_shields:{name:"Distribute Shields",command:"+power_exec Distribute_Shields",description:"Evenly distributes shields as if clicking in the middle of the ship and shields icon",syntax:"+power_exec Distribute_Shields",environment:"space",icon:"üõ°Ô∏è",warning:"Not recommended on spam bars as it interferes with firing cycles"},reroute_shields_rear:{name:"Reroute Shields Rear",command:"+power_exec reroute_shields_rear",description:"Route shield power to rear facing",syntax:"+power_exec reroute_shields_rear",environment:"space",icon:"üõ°Ô∏è"},reroute_shields_left:{name:"Reroute Shields Left",command:"+power_exec reroute_shields_left",description:"Route shield power to left side",syntax:"+power_exec reroute_shields_left",environment:"space",icon:"üõ°Ô∏è"},reroute_shields_right:{name:"Reroute Shields Right",command:"+power_exec reroute_shields_right",description:"Route shield power to right side",syntax:"+power_exec reroute_shields_right",environment:"space",icon:"üõ°Ô∏è"},reroute_shields_forward:{name:"Reroute Shields Forward",command:"+power_exec reroute_shields_forward",description:"Route shield power to forward facing",syntax:"+power_exec reroute_shields_forward",environment:"space",icon:"üõ°Ô∏è"}}},movement:{name:"Movement",icon:"fas fa-arrows-alt",description:"Ship movement and navigation",commands:{full_impulse:{name:"Full Impulse",command:"+fullimpulse",description:"Engage full impulse drive",syntax:"+fullimpulse",environment:"space",icon:"üöÄ"},reverse:{name:"Reverse",command:"+reverse",description:"Reverse engines",syntax:"+reverse",icon:"‚¨ÖÔ∏è"},throttle_adjust:{name:"Throttle Adjust",command:"ThrottleAdjust",description:"Increase or decrease the throttle by amount",syntax:"ThrottleAdjust <amount>",icon:"‚ö°",customizable:!0,parameters:{amount:{type:"number",min:-1,max:1,default:.25,step:.05}}},throttle_set:{name:"Throttle Set",command:"ThrottleSet",description:"Set the throttle to a specific position (negative = reverse, 0 = stop)",syntax:"ThrottleSet <position>",icon:"üéõÔ∏è",customizable:!0,parameters:{position:{type:"number",min:-1,max:1,default:1,step:.1}}},throttle_toggle:{name:"Throttle Toggle",command:"ThrottleToggle",description:"Alternates between full throttle and full stop",syntax:"ThrottleToggle",icon:"üîÑ"},turn_left:{name:"Turn Left",command:"+turnleft",description:"Turn ship left (continuous while held)",syntax:"+turnleft",icon:"‚Ü™Ô∏è"},turn_right:{name:"Turn Right",command:"+turnright",description:"Turn ship right (continuous while held)",syntax:"+turnright",icon:"‚Ü©Ô∏è"},pitch_up:{name:"Pitch Up",command:"+up",description:"Pitch ship nose up (space altitude change)",syntax:"+up",icon:"‚¨ÜÔ∏è"},pitch_down:{name:"Pitch Down",command:"+down",description:"Pitch ship nose down (space altitude change)",syntax:"+down",icon:"‚¨áÔ∏è"},strafe_left:{name:"Strafe Left",command:"+left",description:"Strafe ship left",syntax:"+left",icon:"‚¨ÖÔ∏è"},strafe_right:{name:"Strafe Right",command:"+right",description:"Strafe ship right",syntax:"+right",icon:"‚û°Ô∏è"},forward:{name:"Forward",command:"+forward",description:"Move forward",syntax:"+forward",icon:"‚¨ÜÔ∏è"},backward:{name:"Backward",command:"+backward",description:"Move backward",syntax:"+backward",icon:"‚¨áÔ∏è"},auto_forward:{name:"Auto Forward",command:"autoForward",description:"Character moves forward until given new movement commands",syntax:"autoForward",environment:"ground",icon:"üèÉ"},follow:{name:"Follow Target",command:"Follow",description:"Follow the targeted entity",syntax:"Follow",icon:"üë•"},follow_cancel:{name:"Cancel Follow",command:"Follow_Cancel",description:"Stop following and forget about the target",syntax:"Follow_Cancel",icon:"‚ùå"}}},camera:{name:"Camera",icon:"fas fa-video",description:"Camera control and view management",commands:{zoom_in:{name:"Zoom In",command:"Camzoomin",description:"Zoom the camera in",syntax:"Camzoomin",icon:"üîç"},zoom_out:{name:"Zoom Out",command:"Camzoomout",description:"Zoom the camera out",syntax:"Camzoomout",icon:"üîé"},zoom_in_small:{name:"Zoom In Small",command:"Camzoominsmall",description:"Zoom the camera in slightly",syntax:"Camzoominsmall",icon:"üîç"},zoom_out_small:{name:"Zoom Out Small",command:"Camzoomoutsmall",description:"Zoom the camera out slightly",syntax:"Camzoomoutsmall",icon:"üîé"},cam_distance:{name:"Set Camera Distance",command:"camdist",description:"Sets the camera distance from the player",syntax:"camdist <distance>",icon:"üìè",customizable:!0,parameters:{distance:{type:"number",min:1,max:500,default:50}}},cam_reset:{name:"Reset Camera",command:"CamReset",description:"Reset the camera position to default",syntax:"CamReset",icon:"üîÑ"},cam_target_lock:{name:"Lock Camera to Target",command:"Camsetlocktotarget",description:"Lock or unlock the camera to the target",syntax:"Camsetlocktotarget",icon:"üéØ"},cam_cycle_distance:{name:"Cycle Camera Distance",command:"camCycleDist",description:"Cycle the camera distance between several preset values",syntax:"camCycleDist",icon:"üîÑ"},cam_mouse_look:{name:"Mouse Look",command:"+camMouseLook",description:"Enable mouse look camera control",syntax:"+camMouseLook",icon:"üñ±Ô∏è"},cam_turn_to_face:{name:"Turn to Face Camera",command:"+camTurnToFace",description:"Turn ship to face camera direction",syntax:"+camTurnToFace",icon:"‚Ü™Ô∏è"},look_up:{name:"Look Up",command:"lookUp",description:"Change point of view to look straight up",syntax:"lookUp",icon:"‚¨ÜÔ∏è"},look_down:{name:"Look Down",command:"lookDown",description:"Change point of view to look straight down",syntax:"lookDown",icon:"‚¨áÔ∏è"}}},communication:{name:"Communication",icon:"fas fa-comments",description:"Chat and team communication",commands:{team_message:{name:"Team Message",command:"team",description:"Send message to team",syntax:"team message",icon:"üí¨",customizable:!0,parameters:{message:{type:"text",default:"Message text here"}}},local_message:{name:"Local Message",command:"say",description:"Send message to local area",syntax:"say message",icon:"üì¢",customizable:!0,parameters:{message:{type:"text",default:"Message text here"}}},zone_message:{name:"Zone Message",command:"zone",description:"Send message to zone",syntax:"zone message",icon:"üì°",customizable:!0,parameters:{message:{type:"text",default:"Message text here"}}}}},system:{name:"System",icon:"fas fa-cog",description:"UI and system commands",commands:{toggle_hud:{name:"Toggle HUD",command:"+GenToggleHUD",description:"Toggle HUD visibility",syntax:"+GenToggleHUD",icon:"üëÅÔ∏è"},screenshot:{name:"Screenshot",command:"screenshot",description:"Take a screenshot",syntax:"screenshot",icon:"üì∑"},screenshot_jpg:{name:"Screenshot JPG",command:"screenshot_jpg",description:"Save a screenshot as JPG",syntax:"screenshot_jpg",icon:"üì∑"},autofire_toggle:{name:"Toggle Autofire",command:"+GenToggleAutofire",description:"Toggle weapon autofire",syntax:"+GenToggleAutofire",icon:"üîÅ"},bind_save_file:{name:"Save Binds to File",command:"bind_save_file",description:"Save all your binds to a text file",syntax:"bind_save_file <filename>",icon:"üíæ",customizable:!0,parameters:{filename:{type:"text",default:"my_binds.txt"}}},bind_load_file:{name:"Load Binds from File",command:"bind_load_file",description:"Load a bind file into the client",syntax:"bind_load_file <filename>",icon:"üìÅ",customizable:!0,parameters:{filename:{type:"text",default:"my_binds.txt"}}},combat_log:{name:"Toggle Combat Log",command:"CombatLog",description:"Turn combat log recording on/off (1=on, 0=off)",syntax:"CombatLog <1/0>",icon:"üìä",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},missions:{name:"Show/Hide Missions",command:"missions",description:"Show/hide the mission journal",syntax:"missions",icon:"üìã"},inventory:{name:"Show/Hide Inventory",command:"Inventory",description:"Show/hide your inventory",syntax:"Inventory",icon:"üéí"},map:{name:"Show/Hide Map",command:"Map",description:"Show/hide the map window",syntax:"Map",icon:"üó∫Ô∏è"}}}},templates:{space_combat:{basic_attack:{name:"Basic Attack Sequence",description:"Target enemy and fire all weapons",commands:["Target_Enemy_Near","FireAll"]},defensive_sequence:{name:"Defensive Sequence",description:"Target self and activate defensive abilities",commands:["Target_Self","+power_exec Distribute_Shields"]},alpha_strike:{name:"Alpha Strike",description:"Full offensive sequence with buffs",commands:["Target_Enemy_Near","FireAll"]},healing_sequence:{name:"Emergency Healing",description:"Self-healing and damage control",commands:["Target_Self","+power_exec Distribute_Shields"]}},ground_combat:{basic_ground_attack:{name:"Basic Ground Attack",description:"Target and attack sequence for ground combat",commands:["Target_Enemy_Near","+STOTrayExecByTray 0 0"]}}},defaultProfiles:{default_space:{name:"Default Space",description:"Basic space combat configuration",currentEnvironment:"space",builds:{space:{keys:{Space:[{command:"Target_Enemy_Near",type:"targeting",icon:"üéØ",text:"Target nearest enemy",id:"cmd_1"},{command:"FireAll",type:"combat",icon:"üî•",text:"Fire all weapons",id:"cmd_2"}]},aliases:{AttackCall:{description:"Call out attack target to team",commands:"team Attacking [$Target] - focus fire!"},TargetReport:{description:"Report current target to team",commands:"team Current target: [$Target]"},HealCall:{description:"Request healing for target",commands:"team Need healing on [$Target]!"}}},ground:{keys:{Space:[{command:"Target_Enemy_Near",type:"targeting",icon:"üéØ",text:"Target nearest enemy",id:"cmd_g1"},{command:"+STOTrayExecByTray 0 0",type:"tray",icon:"‚ö°",text:"Primary attack",id:"cmd_g2"}]},aliases:{}}}},tactical_space:{name:"Tactical Space",description:"Aggressive DPS-focused space build",currentEnvironment:"space",builds:{space:{keys:{Space:[{command:"Target_Enemy_Near",type:"targeting",icon:"üéØ",text:"Target nearest enemy",id:"cmd_1"},{command:"+STOTrayExecByTray 0 0",type:"tray",icon:"‚ö°",text:"Execute Tray 1 Slot 1",id:"cmd_2"},{command:"FireAll",type:"combat",icon:"üî•",text:"Fire all weapons",id:"cmd_3"},{command:"+power_exec Distribute_Shields",type:"power",icon:"üõ°Ô∏è",text:"Distribute shields",id:"cmd_4"}],1:[{command:"+STOTrayExecByTray 1 0",type:"tray",icon:"‚ö°",text:"Execute Tray 2 Slot 1",id:"cmd_5"}],F1:[{command:"Target_Self",type:"targeting",icon:"üë§",text:"Target self",id:"cmd_6"},{command:"+STOTrayExecByTray 2 0",type:"tray",icon:"‚ö°",text:"Execute Tray 3 Slot 1",id:"cmd_7"}]},aliases:{}},ground:{keys:{Space:[{command:"Target_Enemy_Near",type:"targeting",icon:"üéØ",text:"Target nearest enemy",id:"cmd_g1"},{command:"+STOTrayExecByTray 0 0",type:"tray",icon:"‚ö°",text:"Primary attack",id:"cmd_g2"}],1:[{command:"+STOTrayExecByTray 0 1",type:"tray",icon:"‚ö°",text:"Secondary attack",id:"cmd_g3"}],F1:[{command:"Target_Self",type:"targeting",icon:"üë§",text:"Target self",id:"cmd_g4"},{command:"+STOTrayExecByTray 1 0",type:"tray",icon:"üíä",text:"Heal self",id:"cmd_g5"}]},aliases:{}}}}},keys:{common:{name:"Common Keys",description:"Most frequently used keys",keys:[{key:"Space",description:"Spacebar"},{key:"1",description:"Number 1"},{key:"2",description:"Number 2"},{key:"3",description:"Number 3"},{key:"4",description:"Number 4"},{key:"5",description:"Number 5"},{key:"F1",description:"Function Key 1"},{key:"F2",description:"Function Key 2"},{key:"F3",description:"Function Key 3"},{key:"F4",description:"Function Key 4"},{key:"Tab",description:"Tab"},{key:"enter",description:"Main Enter Key"},{key:"Shift",description:"Shift"},{key:"Control",description:"Control"},{key:"ALT",description:"Alt"}]},letters:{name:"Letter Keys",description:"A-Z keyboard letters",keys:[{key:"A",description:"Key A"},{key:"B",description:"Key B"},{key:"C",description:"Key C"},{key:"D",description:"Key D"},{key:"E",description:"Key E"},{key:"F",description:"Key F"},{key:"G",description:"Key G"},{key:"H",description:"Key H"},{key:"I",description:"Key I"},{key:"J",description:"Key J"},{key:"K",description:"Key K"},{key:"L",description:"Key L"},{key:"M",description:"Key M"},{key:"N",description:"Key N"},{key:"O",description:"Key O"},{key:"P",description:"Key P"},{key:"Q",description:"Key Q"},{key:"R",description:"Key R"},{key:"S",description:"Key S"},{key:"T",description:"Key T"},{key:"U",description:"Key U"},{key:"V",description:"Key V"},{key:"W",description:"Key W"},{key:"X",description:"Key X"},{key:"Y",description:"Key Y"},{key:"Z",description:"Key Z"}]},numbers:{name:"Number Keys",description:"Number row and numpad",keys:[{key:"0",description:"Number 0"},{key:"6",description:"Number 6"},{key:"7",description:"Number 7"},{key:"8",description:"Number 8"},{key:"9",description:"Number 9"},{key:"numpad0",description:"Numerical Keypad 0"},{key:"numpad1",description:"Numerical Keypad 1"},{key:"numpad2",description:"Numerical Keypad 2"},{key:"numpad3",description:"Numerical Keypad 3"},{key:"numpad4",description:"Numerical Keypad 4"},{key:"numpad5",description:"Numerical Keypad 5"},{key:"numpad6",description:"Numerical Keypad 6"},{key:"numpad7",description:"Numerical Keypad 7"},{key:"numpad8",description:"Numerical Keypad 8"},{key:"numpad9",description:"Numerical Keypad 9"},{key:"Decimal",description:"Numerical Keypad Decimal"},{key:"Divide",description:"Numerical Keypad Divide"},{key:"Multiply",description:"Multiply (*)"},{key:"Subtract",description:"Subtract (-)"},{key:"Add",description:"Add (+)"},{key:"numpadenter",description:"Numerical Keypad Enter"}]},function:{name:"Function Keys",description:"F1-F24 function keys",keys:[{key:"F5",description:"Function Key 5"},{key:"F6",description:"Function Key 6"},{key:"F7",description:"Function Key 7"},{key:"F8",description:"Function Key 8"},{key:"F9",description:"Function Key 9"},{key:"F10",description:"Function Key 10"},{key:"F11",description:"Function Key 11"},{key:"F12",description:"Function Key 12"},{key:"F13",description:"Function Key 13"},{key:"F14",description:"Function Key 14"},{key:"F15",description:"Function Key 15"},{key:"F16",description:"Function Key 16"},{key:"F17",description:"Function Key 17"},{key:"F18",description:"Function Key 18"},{key:"F19",description:"Function Key 19"},{key:"F20",description:"Function Key 20"},{key:"F21",description:"Function Key 21"},{key:"F22",description:"Function Key 22"},{key:"F23",description:"Function Key 23"},{key:"F24",description:"Function Key 24"}]},arrows:{name:"Arrow & Navigation",description:"Arrow keys and navigation",keys:[{key:"Up",description:"Arrow Key: Up"},{key:"Down",description:"Arrow Key: Down"},{key:"Left",description:"Arrow Key: Left"},{key:"Right",description:"Arrow Key: Right"},{key:"Home",description:"Home"},{key:"End",description:"End"},{key:"PageUp",description:"Page Up"},{key:"PageDown",description:"Page Down"},{key:"insert",description:"Insert"},{key:"delete",description:"Delete"}]},modifiers:{name:"Modifier Keys",description:"Shift, Ctrl, Alt variations",keys:[{key:"LALT",description:"Alt (Left)"},{key:"RALT",description:"Alt (Right)"},{key:"LCTRL",description:"Control (Left)"},{key:"RCTRL",description:"Control (Right)"}]},symbols:{name:"Symbol Keys",description:"Punctuation and symbols",keys:[{key:"[",description:"["},{key:"]",description:"]"},{key:"\\",description:"\\"},{key:",",description:"Comma (,)"},{key:".",description:"Period (.)"},{key:"/",description:"Divide (/)"},{key:"`",description:"Tilda Key (~)"}]},mouse:{name:"Mouse Controls",description:"Mouse buttons and scroll",keys:[{key:"Lbutton",description:"Mouse Left Press"},{key:"Rbutton",description:"Mouse Right Press"},{key:"Middleclick",description:"Mouse Middle Click"},{key:"Button1",description:"Mouse Button 1"},{key:"Button2",description:"Mouse Button 2"},{key:"Button3",description:"Mouse Button 3"},{key:"Button4",description:"Mouse Button 4"},{key:"Button5",description:"Mouse Button 5"},{key:"Button6",description:"Mouse Button 6"},{key:"Button7",description:"Mouse Button 7"},{key:"Button8",description:"Mouse Button 8"},{key:"Button9",description:"Mouse Button 9"},{key:"Button10",description:"Mouse Button 10"},{key:"Wheelplus",description:"Mouse Scroll Up"},{key:"Wheelminus",description:"Mouse Scroll Down"}]},gamepad:{name:"Xbox Controller",description:"Xbox/Gamepad controls",keys:[{key:"Joy1",description:"XBOX Contr [Start]"},{key:"Joy2",description:"XBOX Contr [Back]"},{key:"Joy3",description:"XBOX Contr [L Thumb depress]"},{key:"Joy4",description:"XBOX Contr [R Thumb depress]"},{key:"Joy5",description:"XBOX Contr [Left Bumper]"},{key:"Joy6",description:"XBOX Contr [Right Bumper]"},{key:"Joy7",description:"XBOX Contr [Left Trigger]"},{key:"Joy8",description:"XBOX Contr [Right Trigger]"},{key:"Joy9",description:"XBOX Contr [A Button]"},{key:"Joy10",description:"XBOX Contr [B Button]"},{key:"Joy11",description:"XBOX Contr [X Button]"},{key:"Joy12",description:"XBOX Contr [Y Button]"},{key:"Joypad_up",description:"XBOX Contr [Pad up]"},{key:"Joypad_down",description:"XBOX Contr [Pad down]"},{key:"Joypad_left",description:"XBOX Contr [Pad left]"},{key:"Joypad_right",description:"XBOX Contr [Pad right]"},{key:"Lstick_up",description:"XBOX Contr [Left Stick up]"},{key:"Lstick_down",description:"XBOX Contr [Left Stick down]"},{key:"Lstick_left",description:"XBOX Contr [Left Stick left]"},{key:"Lstick_right",description:"XBOX Contr [Left Stick right]"},{key:"Rstick_up",description:"XBOX Contr [Right Stick up]"},{key:"Rstick_down",description:"XBOX Contr [Right Stick down]"},{key:"Rstick_left",description:"XBOX Contr [Right Stick left]"},{key:"Rstick_right",description:"XBOX Contr [Right Stick right]"}]}},validation:{keyNamePattern:/^[a-zA-Z0-9_+\-\s]+$/,aliasNamePattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,maxCommandsPerKey:20,maxKeysPerProfile:100},settings:{version:"1.0.0",autoSave:!0,maxUndoSteps:50,defaultMode:"space"},variables:{target:{variable:"$Target",description:"Replaced with the name of your current target",example:"team Target [$Target]",usableIn:["communication","custom","aliases"],notes:"If your target's name is 'froggyMonster', this will output 'Target [froggyMonster]'"}}};window.STO_DATA=s,window.COMMAND_CATEGORIES=s.commands,window.COMMANDS={},Object.entries(s.commands).forEach(([e,t])=>{Object.entries(t.commands).forEach(([t,a])=>{window.COMMANDS[t]={...a,category:e,key:t}})}),window.KEY_LAYOUTS=s.keyLayouts||{qwerty:{name:"QWERTY",rows:[[{key:"Escape",display:"Esc"},{key:"F1",display:"F1"},{key:"F2",display:"F2"},{key:"F3",display:"F3"},{key:"F4",display:"F4"},{key:"F5",display:"F5"},{key:"F6",display:"F6"},{key:"F7",display:"F7"},{key:"F8",display:"F8"},{key:"F9",display:"F9"},{key:"F10",display:"F10"},{key:"F11",display:"F11"},{key:"F12",display:"F12"}],[{key:"`",display:"`"},{key:"1",display:"1"},{key:"2",display:"2"},{key:"3",display:"3"},{key:"4",display:"4"},{key:"5",display:"5"},{key:"6",display:"6"},{key:"7",display:"7"},{key:"8",display:"8"},{key:"9",display:"9"},{key:"0",display:"0"},{key:"-",display:"-"},{key:"=",display:"="},{key:"Backspace",display:"Backspace"}],[{key:"Tab",display:"Tab"},{key:"Q",display:"Q"},{key:"W",display:"W"},{key:"E",display:"E"},{key:"R",display:"R"},{key:"T",display:"T"},{key:"Y",display:"Y"},{key:"U",display:"U"},{key:"I",display:"I"},{key:"O",display:"O"},{key:"P",display:"P"},{key:"[",display:"["},{key:"]",display:"]"},{key:"\\",display:"\\"}],[{key:"CapsLock",display:"Caps"},{key:"A",display:"A"},{key:"S",display:"S"},{key:"D",display:"D"},{key:"F",display:"F"},{key:"G",display:"G"},{key:"H",display:"H"},{key:"J",display:"J"},{key:"K",display:"K"},{key:"L",display:"L"},{key:";",display:";"},{key:"'",display:"'"},{key:"Enter",display:"Enter"}],[{key:"Shift",display:"Shift"},{key:"Z",display:"Z"},{key:"X",display:"X"},{key:"C",display:"C"},{key:"V",display:"V"},{key:"B",display:"B"},{key:"N",display:"N"},{key:"M",display:"M"},{key:",",display:","},{key:".",display:"."},{key:"/",display:"/"},{key:"Shift",display:"Shift"}],[{key:"Ctrl",display:"Ctrl"},{key:"Alt",display:"Alt"},{key:"Space",display:"Space"},{key:"Alt",display:"Alt"},{key:"Ctrl",display:"Ctrl"}]]}},window.DEFAULT_SETTINGS={keyLayout:"qwerty",autoSave:s.settings?.autoSave||!0,showTooltips:!0,exportFormat:"txt",maxUndoSteps:s.settings?.maxUndoSteps||50,defaultMode:s.settings?.defaultMode||"space"},window.SAMPLE_PROFILES=Object.values(s.defaultProfiles).map(e=>({id:e.name.toLowerCase().replace(/\s+/g,"_"),name:e.name,description:e.description,currentEnvironment:e.currentEnvironment||"space",builds:e.builds||{space:{keys:{}},ground:{keys:{}}},mode:e.currentEnvironment||"space",keybinds:e.builds?.space?.keys||{},aliases:e.builds?.space?.aliases||{},created:(new Date).toISOString(),modified:(new Date).toISOString()})),window.SAMPLE_ALIASES={attack_sequence:{name:"Attack Sequence",commands:["Target_Enemy_Near","FireAll"],description:"Target and attack nearest enemy"},defensive_sequence:{name:"Defensive Sequence",commands:["Target_Self","+power_exec Distribute_Shields"],description:"Self-target and activate defensive abilities"},heal_sequence:{name:"Healing Sequence",commands:["Target_Self","+STOTrayExecByTray 3 0 $$ +STOTrayExecByTray 3 1"],description:"Emergency healing and repair sequence"}},window.TRAY_CONFIG={maxTrays:10,slotsPerTray:10,defaultTray:0,maxCommandsPerSlot:1},window.getCommandsByCategory=function(e){return e&&s.commands[e]?Object.values(s.commands[e].commands):[]};class r extends Error{constructor(e,t="STO_ERROR"){super(e),this.name="STOError",this.code=t}}class c extends r{constructor(e,t="VFX_ERROR"){super(e,t),this.name="VertigoError"}}"undefined"!=typeof window&&(window.STOError=r,window.VertigoError=c,window.InvalidEnvironmentError=class extends c{constructor(e){super(`Invalid environment '${e}'. Valid environments are: space, ground`,"INVALID_ENVIRONMENT"),this.environment=e}},window.InvalidEffectError=class extends c{constructor(e,t){super(`Invalid effect '${e}' for environment '${t}'`,"INVALID_EFFECT"),this.effectName=e,this.environment=t}});const l=e=>"string"==typeof e,d=()=>{let e,t;const a=new Promise((a,n)=>{e=a,t=n});return a.resolve=e,a.reject=t,a},m=e=>null==e?"":""+e,u=/###/g,p=e=>e&&e.indexOf("###")>-1?e.replace(u,"."):e,_=e=>!e||l(e),f=(e,t,a)=>{const n=l(t)?t.split("."):t;let o=0;for(;o<n.length-1;){if(_(e))return{};const t=p(n[o]);!e[t]&&a&&(e[t]=new a),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++o}return _(e)?{}:{obj:e,k:p(n[o])}},h=(e,t,a)=>{const{obj:n,k:o}=f(e,t,Object);if(void 0!==n||1===t.length)return void(n[o]=a);let i=t[t.length-1],s=t.slice(0,t.length-1),r=f(e,s,Object);for(;void 0===r.obj&&s.length;)i=`${s[s.length-1]}.${i}`,s=s.slice(0,s.length-1),r=f(e,s,Object),r?.obj&&void 0!==r.obj[`${r.k}.${i}`]&&(r.obj=void 0);r.obj[`${r.k}.${i}`]=a},y=(e,t)=>{const{obj:a,k:n}=f(e,t);if(a&&Object.prototype.hasOwnProperty.call(a,n))return a[n]},g=(e,t,a)=>{for(const n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?l(e[n])||e[n]instanceof String||l(t[n])||t[n]instanceof String?a&&(e[n]=t[n]):g(e[n],t[n],a):e[n]=t[n]);return e},b=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const k=e=>l(e)?e.replace(/[&<>"'\/]/g,e=>v[e]):e,x=[" ",",","?","!",";"],S=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const a=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,a),this.regExpQueue.push(e),a}}(20),T=(e,t,a=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const n=t.split(a);let o=e;for(let e=0;e<n.length;){if(!o||"object"!=typeof o)return;let t,i="";for(let s=e;s<n.length;++s)if(s!==e&&(i+=a),i+=n[s],t=o[i],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&s<n.length-1)continue;e+=s-e+1;break}o=t}return o},w=e=>e?.replace("_","-"),$={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class C{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||$,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,a,n){return n&&!this.debug?null:(l(e[0])&&(e[0]=`${a}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new C(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new C(this.logger,e)}}var A=new C;class E{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const a=this.observers[e].get(t)||0;this.observers[e].set(t,a+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([e,a])=>{for(let n=0;n<a;n++)e(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([a,n])=>{for(let o=0;o<n;o++)a.apply(a,[e,...t])})}}class F extends E{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,a,n={}){const o=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,i=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;e.indexOf(".")>-1?s=e.split("."):(s=[e,t],a&&(Array.isArray(a)?s.push(...a):l(a)&&o?s.push(...a.split(o)):s.push(a)));const r=y(this.data,s);return!r&&!t&&!a&&e.indexOf(".")>-1&&(e=s[0],t=s[1],a=s.slice(2).join(".")),!r&&i&&l(a)?T(this.data?.[e]?.[t],a,o):r}addResource(e,t,a,n,o={silent:!1}){const i=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator;let s=[e,t];a&&(s=s.concat(i?a.split(i):a)),e.indexOf(".")>-1&&(s=e.split("."),n=t,t=s[1]),this.addNamespaces(t),h(this.data,s,n),o.silent||this.emit("added",e,t,a,n)}addResources(e,t,a,n={silent:!1}){for(const n in a)(l(a[n])||Array.isArray(a[n]))&&this.addResource(e,t,n,a[n],{silent:!0});n.silent||this.emit("added",e,t,a)}addResourceBundle(e,t,a,n,o,i={silent:!1,skipCopy:!1}){let s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),n=a,a=t,t=s[1]),this.addNamespaces(t);let r=y(this.data,s)||{};i.skipCopy||(a=JSON.parse(JSON.stringify(a))),n?g(r,a,o):r={...r,...a},h(this.data,s,r),i.silent||this.emit("added",e,t,a)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var O={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,a,n,o){return e.forEach(e=>{t=this.processors[e]?.process(t,a,n,o)??t}),t}};const B={},I=e=>!l(e)&&"boolean"!=typeof e&&"number"!=typeof e;class M extends E{constructor(e,t={}){var a,n;super(),a=e,n=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{a[e]&&(n[e]=a[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=A.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const a={...t};if(null==e)return!1;const n=this.resolve(e,a);return void 0!==n?.res}extractFromKey(e,t){let a=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===a&&(a=":");const n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let o=t.ns||this.options.defaultNS||[];const i=a&&e.indexOf(a)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,a)=>{t=t||"",a=a||"";const n=x.filter(e=>t.indexOf(e)<0&&a.indexOf(e)<0);if(0===n.length)return!0;const o=S.getRegExp(`(${n.map(e=>"?"===e?"\\?":e).join("|")})`);let i=!o.test(e);if(!i){const t=e.indexOf(a);t>0&&!o.test(e.substring(0,t))&&(i=!0)}return i})(e,a,n));if(i&&!s){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:l(o)?[o]:o};const i=e.split(a);(a!==n||a===n&&this.options.ns.indexOf(i[0])>-1)&&(o=i.shift()),e=i.join(n)}return{key:e,namespaces:l(o)?[o]:o}}translate(e,t,a){let n="object"==typeof t?{...t}:t;if("object"!=typeof n&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(n={...n}),n||(n={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const o=void 0!==n.returnDetails?n.returnDetails:this.options.returnDetails,i=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,{key:s,namespaces:r}=this.extractFromKey(e[e.length-1],n),c=r[r.length-1];let d=void 0!==n.nsSeparator?n.nsSeparator:this.options.nsSeparator;void 0===d&&(d=":");const m=n.lng||this.language,u=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===m?.toLowerCase())return u?o?{res:`${c}${d}${s}`,usedKey:s,exactUsedKey:s,usedLng:m,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:`${c}${d}${s}`:o?{res:s,usedKey:s,exactUsedKey:s,usedLng:m,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:s;const p=this.resolve(e,n);let _=p?.res;const f=p?.usedKey||s,h=p?.exactUsedKey||s,y=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,g=!this.i18nFormat||this.i18nFormat.handleAsObject,b=void 0!==n.count&&!l(n.count),v=M.hasDefaultValue(n),k=b?this.pluralResolver.getSuffix(m,n.count,n):"",x=n.ordinal&&b?this.pluralResolver.getSuffix(m,n.count,{ordinal:!1}):"",S=b&&!n.ordinal&&0===n.count,T=S&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${k}`]||n[`defaultValue${x}`]||n.defaultValue;let w=_;g&&!_&&v&&(w=T);const $=I(w),C=Object.prototype.toString.apply(w);if(!(g&&w&&$&&["[object Number]","[object Function]","[object RegExp]"].indexOf(C)<0)||l(y)&&Array.isArray(w))if(g&&l(y)&&Array.isArray(_))_=_.join(y),_&&(_=this.extendTranslation(_,e,n,a));else{let t=!1,o=!1;!this.isValidLookup(_)&&v&&(t=!0,_=T),this.isValidLookup(_)||(o=!0,_=s);const r=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&o?void 0:_,l=v&&T!==_&&this.options.updateMissing;if(o||t||l){if(this.logger.log(l?"updateKey":"missingKey",m,c,s,l?T:_),i){const e=this.resolve(s,{...n,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let a=0;a<t.length;a++)e.push(t[a]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(n.lng||this.language):e.push(n.lng||this.language);const a=(e,t,a)=>{const o=v&&a!==_?a:r;this.options.missingKeyHandler?this.options.missingKeyHandler(e,c,t,o,l,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,c,t,o,l,n),this.emit("missingKey",e,c,t,_)};this.options.saveMissing&&(this.options.saveMissingPlurals&&b?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,n);S&&n[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{a([e],s+t,n[`defaultValue${t}`]||T)})}):a(e,s,T))}_=this.extendTranslation(_,e,n,p,a),o&&_===s&&this.options.appendNamespaceToMissingKey&&(_=`${c}${d}${s}`),(o||t)&&this.options.parseMissingKeyHandler&&(_=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}${d}${s}`:s,t?_:void 0,n))}else{if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,w,{...n,ns:r}):`key '${s} (${this.language})' returned an object instead of string.`;return o?(p.res=e,p.usedParams=this.getUsedParamsDetails(n),p):e}if(i){const e=Array.isArray(w),t=e?[]:{},a=e?h:f;for(const e in w)if(Object.prototype.hasOwnProperty.call(w,e)){const o=`${a}${i}${e}`;t[e]=v&&!_?this.translate(o,{...n,defaultValue:I(T)?T[e]:void 0,joinArrays:!1,ns:r}):this.translate(o,{...n,joinArrays:!1,ns:r}),t[e]===o&&(t[e]=w[e])}_=t}}return o?(p.res=_,p.usedParams=this.getUsedParamsDetails(n),p):_}extendTranslation(e,t,a,n,o){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...a},a.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!a.skipInterpolation){a.interpolation&&this.interpolator.init({...a,interpolation:{...this.options.interpolation,...a.interpolation}});const i=l(e)&&(void 0!==a?.interpolation?.skipOnVariables?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let s;if(i){const t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let r=a.replace&&!l(a.replace)?a.replace:a;if(this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),e=this.interpolator.interpolate(e,r,a.lng||this.language||n.usedLng,a),i){const t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(a.nest=!1)}!a.lng&&n&&n.res&&(a.lng=this.language||n.usedLng),!1!==a.nest&&(e=this.interpolator.nest(e,(...e)=>o?.[0]!==e[0]||a.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),a)),a.interpolation&&this.interpolator.reset()}const i=a.postProcess||this.options.postProcess,s=l(i)?[i]:i;return null!=e&&s?.length&&!1!==a.applyPostProcessor&&(e=O.handle(s,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(a)},...a}:a,this)),e}resolve(e,t={}){let a,n,o,i,s;return l(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(a))return;const r=this.extractFromKey(e,t),c=r.key;n=c;let d=r.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const m=void 0!==t.count&&!l(t.count),u=m&&!t.ordinal&&0===t.count,p=void 0!==t.context&&(l(t.context)||"number"==typeof t.context)&&""!==t.context,_=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);d.forEach(e=>{this.isValidLookup(a)||(s=e,B[`${_[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(s)||(B[`${_[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${_.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),_.forEach(n=>{if(this.isValidLookup(a))return;i=n;const s=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(s,c,n,e,t);else{let e;m&&(e=this.pluralResolver.getSuffix(n,t.count,t));const a=`${this.options.pluralSeparator}zero`,o=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(m&&(s.push(c+e),t.ordinal&&0===e.indexOf(o)&&s.push(c+e.replace(o,this.options.pluralSeparator)),u&&s.push(c+a)),p){const n=`${c}${this.options.contextSeparator}${t.context}`;s.push(n),m&&(s.push(n+e),t.ordinal&&0===e.indexOf(o)&&s.push(n+e.replace(o,this.options.pluralSeparator)),u&&s.push(n+a))}}let r;for(;r=s.pop();)this.isValidLookup(a)||(o=r,a=this.getResource(n,e,r,t))}))})}),{res:a,usedKey:n,exactUsedKey:o,usedLng:i,usedNS:s}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,a,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,a,n):this.resourceStore.getResource(e,t,a,n)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],a=e.replace&&!l(e.replace);let n=a?e.replace:e;if(a&&void 0!==e.count&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!a){n={...n};for(const e of t)delete n[e]}return n}static hasDefaultValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}class P{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=A.create("languageUtils")}getScriptPartFromCode(e){if(!(e=w(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=w(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(l(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const a=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(a)||(t=a)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const a=this.getScriptPartFromCode(e);if(this.isSupportedCode(a))return t=a;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0?void 0:e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),l(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let a=e[t];return a||(a=e[this.getScriptPartFromCode(t)]),a||(a=e[this.formatLanguageCode(t)]),a||(a=e[this.getLanguagePartFromCode(t)]),a||(a=e.default),a||[]}toResolveHierarchy(e,t){const a=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),n=[],o=e=>{e&&(this.isSupportedCode(e)?n.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return l(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):l(e)&&o(this.formatLanguageCode(e)),a.forEach(e=>{n.indexOf(e)<0&&o(this.formatLanguageCode(e))}),n}}const N={zero:0,one:1,two:2,few:3,many:4,other:5},D={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class j{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=A.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const a=w("dev"===e?"en":e),n=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:a,type:n});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let i;try{i=new Intl.PluralRules(a,{type:n})}catch(a){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),D;if(!e.match(/-|_/))return D;const n=this.languageUtils.getLanguagePartFromCode(e);i=this.getRule(n,t)}return this.pluralRulesCache[o]=i,i}needsPlural(e,t={}){let a=this.getRule(e,t);return a||(a=this.getRule("dev",t)),a?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,a={}){return this.getSuffixes(e,a).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let a=this.getRule(e,t);return a||(a=this.getRule("dev",t)),a?a.resolvedOptions().pluralCategories.sort((e,t)=>N[e]-N[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,a={}){const n=this.getRule(e,a);return n?`${this.options.prepend}${a.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,a))}}const K=(e,t,a,n=".",o=!0)=>{let i=((e,t,a)=>{const n=y(e,a);return void 0!==n?n:y(t,a)})(e,t,a);return!i&&o&&l(a)&&(i=T(e,a,n),void 0===i&&(i=T(t,a,n))),i},U=e=>e.replace(/\$/g,"$$$$");class L{constructor(e={}){this.logger=A.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:a,useRawValueToEscape:n,prefix:o,prefixEscaped:i,suffix:s,suffixEscaped:r,formatSeparator:c,unescapeSuffix:l,unescapePrefix:d,nestingPrefix:m,nestingPrefixEscaped:u,nestingSuffix:p,nestingSuffixEscaped:_,nestingOptionsSeparator:f,maxReplaces:h,alwaysFormat:y}=e.interpolation;this.escape=void 0!==t?t:k,this.escapeValue=void 0===a||a,this.useRawValueToEscape=void 0!==n&&n,this.prefix=o?b(o):i||"{{",this.suffix=s?b(s):r||"}}",this.formatSeparator=c||",",this.unescapePrefix=l?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=m?b(m):u||b("$t("),this.nestingSuffix=p?b(p):_||b(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=h||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,a,n){let o,i,s;const r=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const o=K(t,r,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(o,void 0,a,{...n,...t,interpolationkey:e}):o}const o=e.split(this.formatSeparator),i=o.shift().trim(),s=o.join(this.formatSeparator).trim();return this.format(K(t,r,i,this.options.keySeparator,this.options.ignoreJSONStructure),s,a,{...n,...t,interpolationkey:i})};this.resetRegExp();const d=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,u=void 0!==n?.interpolation?.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>U(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?U(this.escape(e)):U(e)}].forEach(t=>{for(s=0;o=t.regex.exec(e);){const a=o[1].trim();if(i=c(a),void 0===i)if("function"==typeof d){const t=d(e,o,n);i=l(t)?t:""}else if(n&&Object.prototype.hasOwnProperty.call(n,a))i="";else{if(u){i=o[0];continue}this.logger.warn(`missed to pass in variable ${a} for interpolating ${e}`),i=""}else l(i)||this.useRawValueToEscape||(i=m(i));const r=t.safeValue(i);if(e=e.replace(o[0],r),u?(t.regex.lastIndex+=i.length,t.regex.lastIndex-=o[0].length):t.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,t,a={}){let n,o,i;const s=(e,t)=>{const a=this.nestingOptionsSeparator;if(e.indexOf(a)<0)return e;const n=e.split(new RegExp(`${a}[ ]*{`));let o=`{${n[1]}`;e=n[0],o=this.interpolate(o,i);const s=o.match(/'/g),r=o.match(/"/g);((s?.length??0)%2==0&&!r||r.length%2!=0)&&(o=o.replace(/'/g,'"'));try{i=JSON.parse(o),t&&(i={...t,...i})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${a}${o}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let r=[];i={...a},i=i.replace&&!l(i.replace)?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;let c=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),r=e,c=!0}if(o=t(s.call(this,n[1].trim(),i),i),o&&n[0]===e&&!l(o))return o;l(o)||(o=m(o)),o||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),o=""),c&&(o=r.reduce((e,t)=>this.format(e,t,a.lng,{...a,interpolationkey:n[1].trim()}),o.trim())),e=e.replace(n[0],o),this.regexp.lastIndex=0}return e}}const R=e=>{const t={};return(a,n,o)=>{let i=o;o&&o.interpolationkey&&o.formatParams&&o.formatParams[o.interpolationkey]&&o[o.interpolationkey]&&(i={...i,[o.interpolationkey]:void 0});const s=n+JSON.stringify(i);let r=t[s];return r||(r=e(w(n),o),t[s]=r),r(a)}},z=e=>(t,a,n)=>e(w(a),n)(t);class V{constructor(e={}){this.logger=A.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const a=t.cacheInBuiltFormats?R:z;this.formats={number:a((e,t)=>{const a=new Intl.NumberFormat(e,{...t});return e=>a.format(e)}),currency:a((e,t)=>{const a=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>a.format(e)}),datetime:a((e,t)=>{const a=new Intl.DateTimeFormat(e,{...t});return e=>a.format(e)}),relativetime:a((e,t)=>{const a=new Intl.RelativeTimeFormat(e,{...t});return e=>a.format(e,t.range||"day")}),list:a((e,t)=>{const a=new Intl.ListFormat(e,{...t});return e=>a.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=R(t)}format(e,t,a,n={}){const o=t.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(e=>e.indexOf(")")>-1)){const e=o.findIndex(e=>e.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,e)].join(this.formatSeparator)}return o.reduce((e,t)=>{const{formatName:o,formatOptions:i}=(e=>{let t=e.toLowerCase().trim();const a={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const o=n[1].substring(0,n[1].length-1);"currency"===t&&o.indexOf(":")<0?a.currency||(a.currency=o.trim()):"relativetime"===t&&o.indexOf(":")<0?a.range||(a.range=o.trim()):o.split(";").forEach(e=>{if(e){const[t,...n]=e.split(":"),o=n.join(":").trim().replace(/^'+|'+$/g,""),i=t.trim();a[i]||(a[i]=o),"false"===o&&(a[i]=!1),"true"===o&&(a[i]=!0),isNaN(o)||(a[i]=parseInt(o,10))}})}return{formatName:t,formatOptions:a}})(t);if(this.formats[o]){let t=e;try{const s=n?.formatParams?.[n.interpolationkey]||{},r=s.locale||s.lng||n.locale||n.lng||a;t=this.formats[o](e,r,{...i,...n,...s})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${o}`),e},e)}}class G extends E{constructor(e,t,a,n={}){super(),this.backend=e,this.store=t,this.services=a,this.languageUtils=a.languageUtils,this.options=n,this.logger=A.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(a,n.backend,n)}queueLoad(e,t,a,n){const o={},i={},s={},r={};return e.forEach(e=>{let n=!0;t.forEach(t=>{const s=`${e}|${t}`;!a.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===i[s]&&(i[s]=!0):(this.state[s]=1,n=!1,void 0===i[s]&&(i[s]=!0),void 0===o[s]&&(o[s]=!0),void 0===r[t]&&(r[t]=!0)))}),n||(s[e]=!0)}),(Object.keys(o).length||Object.keys(i).length)&&this.queue.push({pending:i,pendingCount:Object.keys(i).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(o),pending:Object.keys(i),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(r)}}loaded(e,t,a){const n=e.split("|"),o=n[0],i=n[1];t&&this.emit("failedLoading",o,i,t),!t&&a&&this.store.addResourceBundle(o,i,a,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&a&&(this.state[e]=0);const s={};this.queue.forEach(a=>{((e,t,a)=>{const{obj:n,k:o}=f(e,t,Object);n[o]=n[o]||[],n[o].push(a)})(a.loaded,[o],i),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(a,e),t&&a.errors.push(t),0!==a.pendingCount||a.done||(Object.keys(a.loaded).forEach(e=>{s[e]||(s[e]={});const t=a.loaded[e];t.length&&t.forEach(t=>{void 0===s[e][t]&&(s[e][t]=!0)})}),a.done=!0,a.errors.length?a.callback(a.errors):a.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(e=>!e.done)}read(e,t,a,n=0,o=this.retryTimeout,i){if(!e.length)return i(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:a,tried:n,wait:o,callback:i});this.readingCalls++;const s=(s,r)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}s&&r&&n<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,a,n+1,2*o,i)},o):i(s,r)},r=this.backend[a].bind(this.backend);if(2!==r.length)return r(e,t,s);try{const a=r(e,t);a&&"function"==typeof a.then?a.then(e=>s(null,e)).catch(s):s(null,a)}catch(e){s(e)}}prepareLoading(e,t,a={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();l(e)&&(e=this.languageUtils.toResolveHierarchy(e)),l(t)&&(t=[t]);const o=this.queueLoad(e,t,a,n);if(!o.toLoad.length)return o.pending.length||n(),null;o.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,a){this.prepareLoading(e,t,{},a)}reload(e,t,a){this.prepareLoading(e,t,{reload:!0},a)}loadOne(e,t=""){const a=e.split("|"),n=a[0],o=a[1];this.read(n,o,"read",void 0,void 0,(a,i)=>{a&&this.logger.warn(`${t}loading namespace ${o} for language ${n} failed`,a),!a&&i&&this.logger.log(`${t}loaded namespace ${o} for language ${n}`,i),this.loaded(e,a,i)})}saveMissing(e,t,a,n,o,i={},s=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=a&&""!==a){if(this.backend?.create){const r={...i,isUpdate:o},c=this.backend.create.bind(this.backend);if(c.length<6)try{let o;o=5===c.length?c(e,t,a,n,r):c(e,t,a,n),o&&"function"==typeof o.then?o.then(e=>s(null,e)).catch(s):s(null,o)}catch(e){s(e)}else c(e,t,a,n,s,r)}e&&e[0]&&this.store.addResource(e[0],t,a,n)}}else this.logger.warn(`did not save key "${a}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const W=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),l(e[1])&&(t.defaultValue=e[1]),l(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const a=e[3]||e[2];Object.keys(a).forEach(e=>{t[e]=a[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),q=e=>(l(e.ns)&&(e.ns=[e.ns]),l(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),l(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),X=()=>{};class J extends E{constructor(e={},t){var a;if(super(),this.options=q(e),this.services={},this.logger=A,this.modules={external:[]},a=this,Object.getOwnPropertyNames(Object.getPrototypeOf(a)).forEach(e=>{"function"==typeof a[e]&&(a[e]=a[e].bind(a))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(l(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const a=W();this.options={...a,...this.options,...q(e)},this.options.interpolation={...a.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator);const n=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?A.init(n(this.modules.logger),this.options):A.init(null,this.options),e=this.modules.formatter?this.modules.formatter:V;const t=new P(this.options);this.store=new F(this.options.resources,this.options);const o=this.services;o.logger=A,o.resourceStore=this.store,o.languageUtils=t,o.pluralResolver=new j(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!e||this.options.interpolation.format&&this.options.interpolation.format!==a.interpolation.format||(o.formatter=n(e),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new L(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new G(n(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(o.languageDetector=n(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=n(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new M(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=X),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const o=d(),i=()=>{const e=(e,a)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(a),t(e,a)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?i():setTimeout(i,0),o}loadResources(e,t=X){let a=t;const n=l(e)?e:this.language;if("function"==typeof e&&(a=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===n?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return a();const e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};n?t(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),a(e)})}else a(null)}reloadResources(e,t,a){const n=d();return"function"==typeof e&&(a=e,e=void 0),"function"==typeof t&&(a=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),a||(a=X),this.services.backendConnector.reload(e,t,e=>{n.resolve(),a(e)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&O.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const a=d();this.emit("languageChanging",e);const n=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},o=(o,i)=>{i?this.isLanguageChangingTo===e&&(n(i),this.translator.changeLanguage(i),this.isLanguageChangingTo=void 0,this.emit("languageChanged",i),this.logger.log("languageChanged",i)):this.isLanguageChangingTo=void 0,a.resolve((...e)=>this.t(...e)),t&&t(o,(...e)=>this.t(...e))},i=t=>{e||t||!this.services.languageDetector||(t=[]);const a=l(t)?t:t&&t[0],i=this.store.hasLanguageSomeTranslations(a)?a:this.services.languageUtils.getBestMatchFromCodes(l(t)?[t]:t);i&&(this.language||n(i),this.translator.language||this.translator.changeLanguage(i),this.services.languageDetector?.cacheUserLanguage?.(i)),this.loadResources(i,e=>{o(e,i)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),a}getFixedT(e,t,a){const n=(e,t,...o)=>{let i;i="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(o)):{...t},i.lng=i.lng||n.lng,i.lngs=i.lngs||n.lngs,i.ns=i.ns||n.ns,""!==i.keyPrefix&&(i.keyPrefix=i.keyPrefix||a||n.keyPrefix);const s=this.options.keySeparator||".";let r;return r=i.keyPrefix&&Array.isArray(e)?e.map(e=>`${i.keyPrefix}${s}${e}`):i.keyPrefix?`${i.keyPrefix}${s}${e}`:e,this.t(r,i)};return l(e)?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=a,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const a=t.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,o=this.languages[this.languages.length-1];if("cimode"===a.toLowerCase())return!0;const i=(e,t)=>{const a=this.services.backendConnector.state[`${e}|${t}`];return-1===a||0===a||2===a};if(t.precheck){const e=t.precheck(this,i);if(void 0!==e)return e}return!(!this.hasResourceBundle(a,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!i(a,e)||n&&!i(o,e)))}loadNamespaces(e,t){const a=d();return this.options.ns?(l(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{a.resolve(),t&&t(e)}),a):(t&&t(),Promise.resolve())}loadLanguages(e,t){const a=d();l(e)&&(e=[e]);const n=this.options.preload||[],o=e.filter(e=>n.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return o.length?(this.options.preload=n.concat(o),this.loadResources(e=>{a.resolve(),t&&t(e)}),a):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services?.languageUtils||new P(W());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){return new J(e,t)}cloneInstance(e={},t=X){const a=e.forkResourceStore;a&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},o=new J(n);if(void 0===e.debug&&void 0===e.prefix||(o.logger=o.logger.clone(e)),["store","services","language"].forEach(e=>{o[e]=this[e]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},a){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((a,n)=>(a[n]={...e[t][n]},a),e[t]),e),{});o.store=new F(e,n),o.services.resourceStore=o.store}return o.translator=new M(o.services,n),o.translator.on("*",(e,...t)=>{o.emit(e,...t)}),o.init(n,t),o.translator.options=n,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const H=J.createInstance();H.createInstance=J.createInstance,H.createInstance,H.dir,H.init,H.loadResources,H.reloadResources,H.use,H.changeLanguage,H.getFixedT,H.t,H.exists,H.setDefaultNamespace,H.hasLoadedNamespace,H.loadNamespaces,H.loadLanguages;var Z={sto_tools_keybind_manager:"STO Tools Keybind Manager",open:"Open",save:"Save",explorer:"Explorer",keybinds:"Keybinds",import_keybinds:"Import Keybinds",export_keybinds:"Export Keybinds",aliases:"Aliases",import_aliases:"Import Aliases",export_aliases:"Export Aliases",vfx:"VFX",dark_mode:"Dark Mode",load_default_data:"Load Default Data",reset_application:"Reset Application",about:"About",new:"New",clone:"Clone",rename:"Rename",delete:"Delete",space:"Space",ground:"Ground",modified:"Modified",valid:"Valid",keys:"keys",key_singular:"key",all:"All",add_key:"Add Key",copy:"Copy",select_a_key_to_edit:"Select a key to edit",commands:"commands",command_singular:"command",stabilize_execution_order:"Stabilize Execution Order",validate:"Validate",clear:"Clear",no_key_selected:"No Key Selected",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"Select a key from the left panel to view and edit its command chain.",generated_command:"Generated Command:",select_a_key_to_see_the_generated_command:"Select a key to see the generated command",add_command:"Add Command",from_template:"From Template",add_alias:"Add Alias",copy_from_key:"Copy from Key",command_library:"Command Library",add_new_key:"Add New Key",key_name:"Key Name:",use_standard_key_names_like_f1_ctrl_a_shift_space_etc:"Use standard key names like F1, Ctrl+A, Shift+Space, etc.",common_keys:"Common Keys:",ctrl:"Ctrl",alt:"Alt",shift:"Shift",cancel:"Cancel",command_type:"Command Type:",select_command_type:"Select command type...",targeting:"Targeting",combat:"Combat",tray_execution:"Tray Execution",shield_management:"Shield Management",movement:"Movement",camera:"Camera",communication:"Communication",system:"System",alias:"Alias",custom_command:"Custom Command",select_a_command_type_to_see_preview:"Select a command type to see preview",profile:"Profile",profile_name:"Profile Name:",description_optional:"Description (optional):",command_alias_manager:"Command Alias Manager",new_alias:"New Alias",edit_alias:"Edit Alias",alias_name:"Alias Name:",use_alphanumeric_characters_only_no_spaces:"Use alphanumeric characters only, no spaces",description:"Description:",target:"$Target",example_target_self_power_exec_science_team_team_healing_target:"Example: target_self $$ +power_exec Science_Team $$ team Healing [$Target]",use_in_communication_commands_to_include_target_name:"- Use in communication commands to include target name",preview:"Preview:",alias_myalias_command_sequence:'alias MyAlias "command sequence"',save_alias:"Save Alias",select_key:"Select Key",common_keys1:"Common Keys",find_other_keys:"Find other keys...",vfx_manager:"VFX Manager",select_visual_effects_to_disable_using_dynfxsetfxexlusionlist_aliases_effects_are_organized_by_environment:"Select visual effects to disable using dynFxSetFXExlusionList aliases. Effects are organized by environment.",space_effects:"Space Effects",select_all:"Select All",clear_all:"Clear All",selected:"selected",ground_effects:"Ground Effects",generated_aliases:"Generated Aliases:",space_alias:"Space Alias:",no_space_effects_selected:"No space effects selected",ground_alias:"Ground Alias:",no_ground_effects_selected:"No ground effects selected",show_player_say:"Show Player Say",generate_aliases:"Generate Aliases",about_sto_tools_keybind_manager:"About STO Tools Keybind Manager",a_comprehensive_web_based_tool_for_creating_editing_and_managing_star_trek_online_keybind_configurations_with_visual_editing_and_advanced_features:"A comprehensive web-based tool for creating, editing, and managing Star Trek Online keybind configurations with visual editing and advanced features.",features:"Features:",visual_keybind_editor:"Visual keybind editor",sto_command_library_with_search_and_categorization:"STO command library with search and categorization",multiple_profile_management_create_clone_rename_delete:"Multiple profile management (create, clone, rename, delete)",custom_alias_system_for_complex_command_sequences:"Custom alias system for complex command sequences",vertigo_inspired_vfx_manager_for_visual_effects_control:"VERTIGO-inspired VFX Manager for visual effects control",import_export_keybind_and_alias_files_and_project_backups:"Import/export keybind and alias files, and project backups",real_time_validation_and_command_preview:"Real-time validation and command preview",quick_start:"Quick Start:",create_a_new_profile_or_use_the_default_profile:"Create a new profile or use the default profile",select_keys_from_the_grid_and_add_commands_from_the_library:"Select keys from the grid and add commands from the library",use_the_command_chain_editor_to_build_complex_sequences:"Use the command chain editor to build complex sequences",export_your_keybinds_as_txt_files_for_use_in_sto:"Export your keybinds as .txt files for use in STO",resources:"Resources:",copyright:"¬© 2025 STO Tools. All rights reserved.",got_it:"Got it!",file_explorer:"File Explorer",select_an_item_on_the_left_to_preview_export:"Select an item on the left to preview export",close:"Close",select_export_format:"Select Export Format",export_as:"Export As:",sto_keybind_file_txt:"STO Keybind File (.txt)",json_profile_json:"JSON Profile (.json)",complete_project_json:"Complete Project (.json)",csv_data_csv:"CSV Data (.csv)",html_report_html:"HTML Report (.html)",alias_file_txt:"Alias File (.txt)",environment:"Environment:",export:"Export",filter_keys:"Filter keys...",search_commands:"Search commands...",e_g_f5_ctrl_a_shift_1:"e.g., F5, Ctrl+A, Shift+1",enter_profile_name:"Enter profile name",describe_this_keybind_profile:"Describe this keybind profile",myalias:"MyAlias",brief_description_of_what_this_alias_does:"Brief description of what this alias does",enter_command_sequence_use_to_separate_commands:"Enter command sequence (use $$ to separate commands)",search_keys:"Search keys...",open_project_json:"Open Project JSON",save_project_json:"Save Project JSON",keybind_operations:"Keybind Operations",alias_operations:"Alias Operations",settings:"Settings",select_profile:"Select Profile",new_profile:"New Profile",clone_profile:"Clone Profile",rename_profile:"Rename Profile",delete_profile:"Delete Profile",space_mode:"Space Mode",ground_mode:"Ground Mode",unsaved_changes:"Unsaved Changes",validation_status:"Validation Status",bound_keys:"Bound Keys",toggle_between_grid_and_categorized_view:"Toggle between grid and categorized view",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Ensures consistent execution order by mirroring commands (Phase 1: left-to-right, Phase 2: right-to-left)",validate_command_chain:"Validate Command Chain",clear_all_commands:"Clear All Commands",copy_to_clipboard:"Copy to Clipboard",collapse_expand:"Collapse/Expand",insert_target_variable:"Insert $Target variable",sto_keybind_report:"STO Keybind Report",mode:"Mode:",generated:"Generated:",created_by:"Created by:",statistics:"Statistics",keys_bound:"Keys Bound:",total_commands:"Total Commands:",aliases_defined:"Aliases Defined:",no_keybinds_defined:"No keybinds defined.",command_aliases:"Command Aliases",report_footer:"This report was generated by STO Tools Keybind Manager. For more information about Star Trek Online keybinds, visit the STO Wiki."},Y={sto_tools_keybind_manager:"STO Tools Keybind Manager",open:"√ñffnen",save:"Speichern",explorer:"Explorer",keybinds:"Tastaturbelegung",import_keybinds:"Tastaturbelegung importieren",export_keybinds:"Tastaturbelegung exportieren",aliases:"Aliase",import_aliases:"Aliase importieren",export_aliases:"Aliase exportieren",vfx:"VFX",dark_mode:"Dunkler Modus",load_default_data:"Standarddaten laden",reset_application:"Anwendung zur√ºcksetzen",about:"√úber",new:"Neu",clone:"Klonen",rename:"Umbenennen",delete:"L√∂schen",space:"Weltraum",ground:"Boden",modified:"Ge√§ndert",valid:"G√ºltig",keys:"Tasten",key_singular:"Taste",all:"Alle",add_key:"Taste hinzuf√ºgen",copy:"Kopieren",select_a_key_to_edit:"W√§hlen Sie eine Taste zum Bearbeiten",commands:"Befehle",command_singular:"Befehl",stabilize_execution_order:"Ausf√ºhrungsreihenfolge stabilisieren",validate:"Validieren",clear:"L√∂schen",no_key_selected:"Keine Taste ausgew√§hlt",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"W√§hlen Sie eine Taste aus dem linken Panel, um ihre Befehlskette anzuzeigen und zu bearbeiten.",generated_command:"Generierter Befehl:",select_a_key_to_see_the_generated_command:"W√§hlen Sie eine Taste, um den generierten Befehl zu sehen",add_command:"Befehl hinzuf√ºgen",from_template:"Aus Vorlage",add_alias:"Alias hinzuf√ºgen",copy_from_key:"Von Taste kopieren",command_library:"Befehlsbibliothek",add_new_key:"Neue Taste hinzuf√ºgen",key_name:"Tastenname:",use_standard_key_names_like_f1_ctrl_a_shift_space_etc:"Verwenden Sie Standardtastennamen wie F1, Strg+A, Umschalt+Leertaste, etc.",common_keys:"H√§ufige Tasten:",ctrl:"Strg",alt:"Alt",shift:"Umschalt",cancel:"Abbrechen",command_type:"Befehlstyp:",select_command_type:"Befehlstyp ausw√§hlen...",targeting:"Zielerfassung",combat:"Kampf",tray_execution:"Tray-Ausf√ºhrung",shield_management:"Schildverwaltung",movement:"Bewegung",camera:"Kamera",communication:"Kommunikation",system:"System",alias:"Alias",custom_command:"Benutzerdefinierter Befehl",select_a_command_type_to_see_preview:"W√§hlen Sie einen Befehlstyp f√ºr eine Vorschau",profile:"Profil",profile_name:"Profilname:",description_optional:"Beschreibung (optional):",command_alias_manager:"Befehlsalias-Manager",new_alias:"Neuer Alias",edit_alias:"Alias bearbeiten",alias_name:"Alias-Name:",use_alphanumeric_characters_only_no_spaces:"Verwenden Sie nur alphanumerische Zeichen, keine Leerzeichen",description:"Beschreibung:",target:"$Target",example_target_self_power_exec_science_team_team_healing_target:"Beispiel: target_self $$ +power_exec Science_Team $$ team Healing [$Target]",use_in_communication_commands_to_include_target_name:"- Verwenden Sie in Kommunikationsbefehlen, um Zielnamen einzuschlie√üen",preview:"Vorschau:",alias_myalias_command_sequence:'alias MeinAlias "Befehlssequenz"',save_alias:"Alias speichern",select_key:"Taste ausw√§hlen",common_keys1:"H√§ufige Tasten",find_other_keys:"Andere Tasten finden...",vfx_manager:"VFX-Manager",select_visual_effects_to_disable_using_dynfxsetfxexlusionlist_aliases_effects_are_organized_by_environment:"W√§hlen Sie visuelle Effekte zum Deaktivieren mit dynFxSetFXExlusionList-Aliasen. Effekte sind nach Umgebung organisiert.",space_effects:"Weltraum-Effekte",select_all:"Alle ausw√§hlen",clear_all:"Alle l√∂schen",selected:"ausgew√§hlt",ground_effects:"Boden-Effekte",generated_aliases:"Generierte Aliase:",space_alias:"Weltraum-Alias:",no_space_effects_selected:"Keine Weltraum-Effekte ausgew√§hlt",ground_alias:"Boden-Alias:",no_ground_effects_selected:"Keine Boden-Effekte ausgew√§hlt",show_player_say:"Spieler-Say anzeigen",generate_aliases:"Aliase generieren",about_sto_tools_keybind_manager:"√úber STO Tools Keybind Manager",a_comprehensive_web_based_tool_for_creating_editing_and_managing_star_trek_online_keybind_configurations_with_visual_editing_and_advanced_features:"Ein umfassendes webbasiertes Tool zum Erstellen, Bearbeiten und Verwalten von Star Trek Online Keybind-Konfigurationen mit visueller Bearbeitung und erweiterten Funktionen.",features:"Funktionen:",visual_keybind_editor:"Visueller Keybind-Editor",sto_command_library_with_search_and_categorization:"STO-Befehlsbibliothek mit Suche und Kategorisierung",multiple_profile_management_create_clone_rename_delete:"Mehrfache Profilverwaltung (erstellen, klonen, umbenennen, l√∂schen)",custom_alias_system_for_complex_command_sequences:"Benutzerdefiniertes Alias-System f√ºr komplexe Befehlssequenzen",vertigo_inspired_vfx_manager_for_visual_effects_control:"VERTIGO-inspirierter VFX-Manager zur Kontrolle visueller Effekte",import_export_keybind_and_alias_files_and_project_backups:"Import/Export von Keybind- und Alias-Dateien sowie Projekt-Backups",real_time_validation_and_command_preview:"Echtzeit-Validierung und Befehlsvorschau",quick_start:"Schnellstart:",create_a_new_profile_or_use_the_default_profile:"Erstellen Sie ein neues Profil oder verwenden Sie das Standardprofil",select_keys_from_the_grid_and_add_commands_from_the_library:"W√§hlen Sie Tasten aus dem Raster und f√ºgen Sie Befehle aus der Bibliothek hinzu",use_the_command_chain_editor_to_build_complex_sequences:"Verwenden Sie den Befehlsketten-Editor, um komplexe Sequenzen zu erstellen",export_your_keybinds_as_txt_files_for_use_in_sto:"Exportieren Sie Ihre Keybinds als .txt-Dateien f√ºr die Verwendung in STO",resources:"Ressourcen:",copyright:"¬© 2025 STO Tools. Alle Rechte vorbehalten.",got_it:"Verstanden!",file_explorer:"Datei-Explorer",select_an_item_on_the_left_to_preview_export:"W√§hlen Sie ein Element links aus, um den Export in der Vorschau anzuzeigen",close:"Schlie√üen",select_export_format:"Exportformat ausw√§hlen",export_as:"Exportieren als:",sto_keybind_file_txt:"STO Keybind-Datei (.txt)",json_profile_json:"JSON-Profil (.json)",complete_project_json:"Vollst√§ndiges Projekt (.json)",csv_data_csv:"CSV-Daten (.csv)",html_report_html:"HTML-Bericht (.html)",alias_file_txt:"Alias-Datei (.txt)",environment:"Umgebung:",export:"Exportieren",filter_keys:"Tasten filtern...",search_commands:"Befehle suchen...",e_g_f5_ctrl_a_shift_1:"z.B. F5, Strg+A, Umschalt+1",enter_profile_name:"Profilnamen eingeben",describe_this_keybind_profile:"Dieses Keybind-Profil beschreiben",myalias:"MeinAlias",brief_description_of_what_this_alias_does:"Kurze Beschreibung, was dieser Alias tut",enter_command_sequence_use_to_separate_commands:"Befehlssequenz eingeben (verwenden Sie $$ zur Trennung von Befehlen)",search_keys:"Tasten suchen...",open_project_json:"Projekt JSON √∂ffnen",save_project_json:"Projekt JSON speichern",keybind_operations:"Keybind-Operationen",alias_operations:"Alias-Operationen",settings:"Einstellungen",select_profile:"Profil ausw√§hlen",new_profile:"Neues Profil",clone_profile:"Profil klonen",rename_profile:"Profil umbenennen",delete_profile:"Profil l√∂schen",space_mode:"Weltraum-Modus",ground_mode:"Boden-Modus",unsaved_changes:"Ungespeicherte √Ñnderungen",validation_status:"Validierungsstatus",bound_keys:"Gebundene Tasten",toggle_between_grid_and_categorized_view:"Zwischen Raster- und kategorisierter Ansicht wechseln",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Gew√§hrleistet konsistente Ausf√ºhrungsreihenfolge durch Spiegelung der Befehle (Phase 1: links nach rechts, Phase 2: rechts nach links)",validate_command_chain:"Befehlskette validieren",clear_all_commands:"Alle Befehle l√∂schen",copy_to_clipboard:"In Zwischenablage kopieren",collapse_expand:"Einklappen/Ausklappen",insert_target_variable:"$Target-Variable einf√ºgen",sto_keybind_report:"STO Keybind-Bericht",mode:"Modus:",generated:"Generiert:",created_by:"Erstellt von:",statistics:"Statistiken",keys_bound:"Gebundene Tasten:",total_commands:"Gesamtbefehle:",aliases_defined:"Definierte Aliase:",no_keybinds_defined:"Keine Keybinds definiert.",command_aliases:"Befehlsaliase",report_footer:"Dieser Bericht wurde vom STO Tools Keybind Manager generiert. F√ºr weitere Informationen √ºber Star Trek Online Keybinds besuchen Sie das STO Wiki."},Q={sto_tools_keybind_manager:"STO Tools Keybind Manager",open:"Ouvrir",save:"Enregistrer",explorer:"Explorateur",keybinds:"Raccourcis",import_keybinds:"Importer les raccourcis",export_keybinds:"Exporter les raccourcis",aliases:"Alias",import_aliases:"Importer les alias",export_aliases:"Exporter les alias",vfx:"VFX",dark_mode:"Mode sombre",load_default_data:"Charger les donn√©es par d√©faut",reset_application:"R√©initialiser l'application",about:"√Ä propos",new:"Nouveau",clone:"Cloner",rename:"Renommer",delete:"Supprimer",space:"Espace",ground:"Sol",modified:"Modifi√©",valid:"Valide",keys:"touches",key_singular:"touche",all:"Tout",add_key:"Ajouter une touche",copy:"Copier",select_a_key_to_edit:"S√©lectionnez une touche √† modifier",commands:"commandes",command_singular:"commande",stabilize_execution_order:"Stabiliser l'ordre d'ex√©cution",validate:"Valider",clear:"Effacer",no_key_selected:"Aucune touche s√©lectionn√©e",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"S√©lectionnez une touche dans le panneau de gauche pour voir et modifier sa cha√Æne de commandes.",generated_command:"Commande g√©n√©r√©e :",select_a_key_to_see_the_generated_command:"S√©lectionnez une touche pour voir la commande g√©n√©r√©e",add_command:"Ajouter une commande",from_template:"√Ä partir d'un mod√®le",add_alias:"Ajouter un alias",copy_from_key:"Copier depuis la touche",command_library:"Biblioth√®que de commandes",add_new_key:"Ajouter une nouvelle touche",key_name:"Nom de la touche :",use_standard_key_names_like_f1_ctrl_a_shift_space_etc:"Utilisez des noms de touches standard comme F1, Ctrl+A, Maj+Espace, etc.",common_keys:"Touches communes :",ctrl:"Ctrl",alt:"Alt",shift:"Maj",cancel:"Annuler",command_type:"Type de commande :",select_command_type:"S√©lectionner le type de commande...",targeting:"Ciblage",combat:"Combat",tray_execution:"Ex√©cution de plateau",shield_management:"Gestion des boucliers",movement:"Mouvement",camera:"Cam√©ra",communication:"Communication",system:"Syst√®me",alias:"Alias",custom_command:"Commande personnalis√©e",select_a_command_type_to_see_preview:"S√©lectionnez un type de commande pour voir l'aper√ßu",profile:"Profil",profile_name:"Nom du profil :",description_optional:"Description (optionnelle) :",command_alias_manager:"Gestionnaire d'alias de commandes",new_alias:"Nouvel alias",edit_alias:"Modifier l'alias",alias_name:"Nom de l'alias :",use_alphanumeric_characters_only_no_spaces:"Utilisez uniquement des caract√®res alphanum√©riques, pas d'espaces",description:"Description :",target:"$Target",example_target_self_power_exec_science_team_team_healing_target:"Exemple : target_self $$ +power_exec Science_Team $$ team Healing [$Target]",use_in_communication_commands_to_include_target_name:"- Utilisez dans les commandes de communication pour inclure le nom de la cible",preview:"Aper√ßu :",alias_myalias_command_sequence:'alias MonAlias "s√©quence de commandes"',save_alias:"Enregistrer l'alias",select_key:"S√©lectionner une touche",common_keys1:"Touches communes",find_other_keys:"Trouver d'autres touches...",vfx_manager:"Gestionnaire VFX",select_visual_effects_to_disable_using_dynfxsetfxexlusionlist_aliases_effects_are_organized_by_environment:"S√©lectionnez les effets visuels √† d√©sactiver en utilisant les alias dynFxSetFXExlusionList. Les effets sont organis√©s par environnement.",space_effects:"Effets d'espace",select_all:"Tout s√©lectionner",clear_all:"Tout effacer",selected:"s√©lectionn√©",ground_effects:"Effets de sol",generated_aliases:"Alias g√©n√©r√©s :",space_alias:"Alias d'espace :",no_space_effects_selected:"Aucun effet d'espace s√©lectionn√©",ground_alias:"Alias de sol :",no_ground_effects_selected:"Aucun effet de sol s√©lectionn√©",show_player_say:"Afficher le Say du joueur",generate_aliases:"G√©n√©rer les alias",about_sto_tools_keybind_manager:"√Ä propos de STO Tools Keybind Manager",a_comprehensive_web_based_tool_for_creating_editing_and_managing_star_trek_online_keybind_configurations_with_visual_editing_and_advanced_features:"Un outil web complet pour cr√©er, modifier et g√©rer les configurations de raccourcis Star Trek Online avec √©dition visuelle et fonctionnalit√©s avanc√©es.",features:"Fonctionnalit√©s :",visual_keybind_editor:"√âditeur visuel de raccourcis",sto_command_library_with_search_and_categorization:"Biblioth√®que de commandes STO avec recherche et cat√©gorisation",multiple_profile_management_create_clone_rename_delete:"Gestion de profils multiples (cr√©er, cloner, renommer, supprimer)",custom_alias_system_for_complex_command_sequences:"Syst√®me d'alias personnalis√© pour les s√©quences de commandes complexes",vertigo_inspired_vfx_manager_for_visual_effects_control:"Gestionnaire VFX inspir√© de VERTIGO pour le contr√¥le des effets visuels",import_export_keybind_and_alias_files_and_project_backups:"Import/export de fichiers de raccourcis et d'alias, et sauvegardes de projet",real_time_validation_and_command_preview:"Validation en temps r√©el et aper√ßu des commandes",quick_start:"D√©marrage rapide :",create_a_new_profile_or_use_the_default_profile:"Cr√©ez un nouveau profil ou utilisez le profil par d√©faut",select_keys_from_the_grid_and_add_commands_from_the_library:"S√©lectionnez des touches dans la grille et ajoutez des commandes depuis la biblioth√®que",use_the_command_chain_editor_to_build_complex_sequences:"Utilisez l'√©diteur de cha√Ænes de commandes pour construire des s√©quences complexes",export_your_keybinds_as_txt_files_for_use_in_sto:"Exportez vos raccourcis en fichiers .txt pour utilisation dans STO",resources:"Ressources :",copyright:"¬© 2025 STO Tools. Tous droits r√©serv√©s.",got_it:"Compris !",file_explorer:"Explorateur de fichiers",select_an_item_on_the_left_to_preview_export:"S√©lectionnez un √©l√©ment √† gauche pour pr√©visualiser l'export",close:"Fermer",select_export_format:"S√©lectionner le format d'export",export_as:"Exporter en :",sto_keybind_file_txt:"Fichier de raccourcis STO (.txt)",json_profile_json:"Profil JSON (.json)",complete_project_json:"Projet complet (.json)",csv_data_csv:"Donn√©es CSV (.csv)",html_report_html:"Rapport HTML (.html)",alias_file_txt:"Fichier d'alias (.txt)",environment:"Environnement :",export:"Exporter",filter_keys:"Filtrer les touches...",search_commands:"Rechercher des commandes...",e_g_f5_ctrl_a_shift_1:"ex. F5, Ctrl+A, Maj+1",enter_profile_name:"Entrez le nom du profil",describe_this_keybind_profile:"D√©crivez ce profil de raccourcis",myalias:"MonAlias",brief_description_of_what_this_alias_does:"Br√®ve description de ce que fait cet alias",enter_command_sequence_use_to_separate_commands:"Entrez la s√©quence de commandes (utilisez $$ pour s√©parer les commandes)",search_keys:"Rechercher des touches...",open_project_json:"Ouvrir le JSON du projet",save_project_json:"Enregistrer le JSON du projet",keybind_operations:"Op√©rations de raccourcis",alias_operations:"Op√©rations d'alias",settings:"Param√®tres",select_profile:"S√©lectionner un profil",new_profile:"Nouveau profil",clone_profile:"Cloner le profil",rename_profile:"Renommer le profil",delete_profile:"Supprimer le profil",space_mode:"Mode espace",ground_mode:"Mode sol",unsaved_changes:"Modifications non enregistr√©es",validation_status:"Statut de validation",bound_keys:"Touches li√©es",toggle_between_grid_and_categorized_view:"Basculer entre la vue grille et cat√©goris√©e",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Assure un ordre d'ex√©cution coh√©rent en miroir des commandes (Phase 1 : gauche √† droite, Phase 2 : droite √† gauche)",validate_command_chain:"Valider la cha√Æne de commandes",clear_all_commands:"Effacer toutes les commandes",copy_to_clipboard:"Copier dans le presse-papiers",collapse_expand:"R√©duire/D√©velopper",insert_target_variable:"Ins√©rer la variable $Target",sto_keybind_report:"Rapport de raccourcis STO",mode:"Mode :",generated:"G√©n√©r√© :",created_by:"Cr√©√© par :",statistics:"Statistiques",keys_bound:"Touches li√©es :",total_commands:"Total des commandes :",aliases_defined:"Alias d√©finis :",no_keybinds_defined:"Aucun raccourci d√©fini.",command_aliases:"Alias de commandes",report_footer:"Ce rapport a √©t√© g√©n√©r√© par STO Tools Keybind Manager. Pour plus d'informations sur les raccourcis Star Trek Online, visitez le Wiki STO."},ee={sto_tools_keybind_manager:"STO Tools Keybind Manager",open:"Abrir",save:"Guardar",explorer:"Explorador",keybinds:"Atajos de teclado",import_keybinds:"Importar atajos de teclado",export_keybinds:"Exportar atajos de teclado",aliases:"Alias",import_aliases:"Importar alias",export_aliases:"Exportar alias",vfx:"VFX",dark_mode:"Modo oscuro",load_default_data:"Cargar datos predeterminados",reset_application:"Restablecer aplicaci√≥n",about:"Acerca de",new:"Nuevo",clone:"Clonar",rename:"Renombrar",delete:"Eliminar",space:"Espacio",ground:"Suelo",modified:"Modificado",valid:"V√°lido",keys:"teclas",key_singular:"tecla",all:"Todo",add_key:"Agregar tecla",copy:"Copiar",select_a_key_to_edit:"Selecciona una tecla para editar",commands:"comandos",command_singular:"comando",stabilize_execution_order:"Estabilizar orden de ejecuci√≥n",validate:"Validar",clear:"Limpiar",no_key_selected:"Ninguna tecla seleccionada",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"Selecciona una tecla del panel izquierdo para ver y editar su cadena de comandos.",generated_command:"Comando generado:",select_a_key_to_see_the_generated_command:"Selecciona una tecla para ver el comando generado",add_command:"Agregar comando",from_template:"Desde plantilla",add_alias:"Agregar alias",copy_from_key:"Copiar desde tecla",command_library:"Biblioteca de comandos",add_new_key:"Agregar nueva tecla",key_name:"Nombre de la tecla:",use_standard_key_names_like_f1_ctrl_a_shift_space_etc:"Use nombres de teclas est√°ndar como F1, Ctrl+A, May√∫s+Espacio, etc.",common_keys:"Teclas comunes:",ctrl:"Ctrl",alt:"Alt",shift:"May√∫s",cancel:"Cancelar",command_type:"Tipo de comando:",select_command_type:"Seleccionar tipo de comando...",targeting:"Apuntado",combat:"Combate",tray_execution:"Ejecuci√≥n de bandeja",shield_management:"Gesti√≥n de escudos",movement:"Movimiento",camera:"C√°mara",communication:"Comunicaci√≥n",system:"Sistema",alias:"Alias",custom_command:"Comando personalizado",select_a_command_type_to_see_preview:"Selecciona un tipo de comando para ver vista previa",profile:"Perfil",profile_name:"Nombre del perfil:",description_optional:"Descripci√≥n (opcional):",command_alias_manager:"Gestor de alias de comandos",new_alias:"Nuevo alias",edit_alias:"Editar alias",alias_name:"Nombre del alias:",use_alphanumeric_characters_only_no_spaces:"Use solo caracteres alfanum√©ricos, sin espacios",description:"Descripci√≥n:",target:"$Target",example_target_self_power_exec_science_team_team_healing_target:"Ejemplo: target_self $$ +power_exec Science_Team $$ team Healing [$Target]",use_in_communication_commands_to_include_target_name:"- Use en comandos de comunicaci√≥n para incluir nombre del objetivo",preview:"Vista previa:",alias_myalias_command_sequence:'alias MiAlias "secuencia de comandos"',save_alias:"Guardar alias",select_key:"Seleccionar tecla",common_keys1:"Teclas comunes",find_other_keys:"Encontrar otras teclas...",vfx_manager:"Gestor VFX",select_visual_effects_to_disable_using_dynfxsetfxexlusionlist_aliases_effects_are_organized_by_environment:"Selecciona efectos visuales para desactivar usando alias dynFxSetFXExlusionList. Los efectos est√°n organizados por entorno.",space_effects:"Efectos de espacio",select_all:"Seleccionar todo",clear_all:"Limpiar todo",selected:"seleccionado",ground_effects:"Efectos de suelo",generated_aliases:"Alias generados:",space_alias:"Alias de espacio:",no_space_effects_selected:"No hay efectos de espacio seleccionados",ground_alias:"Alias de suelo:",no_ground_effects_selected:"No hay efectos de suelo seleccionados",show_player_say:"Mostrar Say del jugador",generate_aliases:"Generar alias",about_sto_tools_keybind_manager:"Acerca de STO Tools Keybind Manager",a_comprehensive_web_based_tool_for_creating_editing_and_managing_star_trek_online_keybind_configurations_with_visual_editing_and_advanced_features:"Una herramienta web integral para crear, editar y gestionar configuraciones de atajos de teclado de Star Trek Online con edici√≥n visual y caracter√≠sticas avanzadas.",features:"Caracter√≠sticas:",visual_keybind_editor:"Editor visual de atajos de teclado",sto_command_library_with_search_and_categorization:"Biblioteca de comandos STO con b√∫squeda y categorizaci√≥n",multiple_profile_management_create_clone_rename_delete:"Gesti√≥n de m√∫ltiples perfiles (crear, clonar, renombrar, eliminar)",custom_alias_system_for_complex_command_sequences:"Sistema de alias personalizado para secuencias de comandos complejas",vertigo_inspired_vfx_manager_for_visual_effects_control:"Gestor VFX inspirado en VERTIGO para control de efectos visuales",import_export_keybind_and_alias_files_and_project_backups:"Importar/exportar archivos de atajos y alias, y respaldos de proyecto",real_time_validation_and_command_preview:"Validaci√≥n en tiempo real y vista previa de comandos",quick_start:"Inicio r√°pido:",create_a_new_profile_or_use_the_default_profile:"Crea un nuevo perfil o usa el perfil predeterminado",select_keys_from_the_grid_and_add_commands_from_the_library:"Selecciona teclas de la cuadr√≠cula y agrega comandos desde la biblioteca",use_the_command_chain_editor_to_build_complex_sequences:"Usa el editor de cadenas de comandos para construir secuencias complejas",export_your_keybinds_as_txt_files_for_use_in_sto:"Exporta tus atajos como archivos .txt para usar en STO",resources:"Recursos:",copyright:"¬© 2025 STO Tools. Todos los derechos reservados.",got_it:"¬°Entendido!",file_explorer:"Explorador de archivos",select_an_item_on_the_left_to_preview_export:"Selecciona un elemento a la izquierda para previsualizar exportaci√≥n",close:"Cerrar",select_export_format:"Seleccionar formato de exportaci√≥n",export_as:"Exportar como:",sto_keybind_file_txt:"Archivo de atajos STO (.txt)",json_profile_json:"Perfil JSON (.json)",complete_project_json:"Proyecto completo (.json)",csv_data_csv:"Datos CSV (.csv)",html_report_html:"Reporte HTML (.html)",alias_file_txt:"Archivo de alias (.txt)",environment:"Entorno:",export:"Exportar",filter_keys:"Filtrar teclas...",search_commands:"Buscar comandos...",e_g_f5_ctrl_a_shift_1:"ej. F5, Ctrl+A, May√∫s+1",enter_profile_name:"Ingresa nombre del perfil",describe_this_keybind_profile:"Describe este perfil de atajos de teclado",myalias:"MiAlias",brief_description_of_what_this_alias_does:"Breve descripci√≥n de lo que hace este alias",enter_command_sequence_use_to_separate_commands:"Ingresa secuencia de comandos (usa $$ para separar comandos)",search_keys:"Buscar teclas...",open_project_json:"Abrir JSON del proyecto",save_project_json:"Guardar JSON del proyecto",keybind_operations:"Operaciones de atajos",alias_operations:"Operaciones de alias",settings:"Configuraci√≥n",select_profile:"Seleccionar perfil",new_profile:"Nuevo perfil",clone_profile:"Clonar perfil",rename_profile:"Renombrar perfil",delete_profile:"Eliminar perfil",space_mode:"Modo espacio",ground_mode:"Modo suelo",unsaved_changes:"Cambios no guardados",validation_status:"Estado de validaci√≥n",bound_keys:"Teclas vinculadas",toggle_between_grid_and_categorized_view:"Alternar entre vista de cuadr√≠cula y categorizada",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Asegura orden de ejecuci√≥n consistente reflejando comandos (Fase 1: izquierda a derecha, Fase 2: derecha a izquierda)",validate_command_chain:"Validar cadena de comandos",clear_all_commands:"Limpiar todos los comandos",copy_to_clipboard:"Copiar al portapapeles",collapse_expand:"Contraer/Expandir",insert_target_variable:"Insertar variable $Target",sto_keybind_report:"Reporte de atajos STO",mode:"Modo:",generated:"Generado:",created_by:"Creado por:",statistics:"Estad√≠sticas",keys_bound:"Teclas vinculadas:",total_commands:"Total de comandos:",aliases_defined:"Alias definidos:",no_keybinds_defined:"No hay atajos de teclado definidos.",command_aliases:"Alias de comandos",report_footer:"Este reporte fue generado por STO Tools Keybind Manager. Para m√°s informaci√≥n sobre atajos de teclado de Star Trek Online, visita el Wiki de STO."};const te=new Proxy({currentProfile:null,currentMode:"space",currentEnvironment:"space",selectedKey:null,isModified:!1,undoStack:[],redoStack:[],maxUndoSteps:50,commandIdCounter:0},{set:(e,t,a)=>(e[t]=a,i&&i.emit&&i.emit(`store:${t}`,a),!0)}),ae={space:[{label:"Advanced inhibiting turret shield bubble",effect:"Fx_Rep_Temporal_Ship_Chroniton_Stabilization_Proc"},{label:"Approaching Agony",effect:"Cfx_Lockboxfx_Cb29_Ship_Agony_Field"},{label:"Attack Pattern Alpha",effect:"Fx_Ship_Tac_Attackpatternalpha"},{label:"Attack Pattern Beta",effect:"Fx_Ship_Tac_Attackpatternbeta"},{label:"Attack Pattern Delta",effect:"Fx_Ship_Tac_Attackpatterndelta"},{label:"Attack Pattern Omega",effect:"Fx_Ship_Tac_Attackpatternomega"},{label:"Beacon of Kahless",effect:"Fx_Er_Bbs_Beacon_Of_Kahless_Flash"},{label:"Boost Morale",effect:"Fx_Ship_Spec_Powers_Command_Boost_Morale_Bufffx,Cfx_Ship_Spec_Powers_Command_Boost_Morale_Activate"},{label:"Brace for Impact",effect:"Fx_Bop_Braceforimpact,Cfx_Ship_Sci_Hazardemitter_Buff"},{label:"Breath of the Dragon",effect:"Fx_Ship_Cp_T6_Hysperian_Dragonbreath"},{label:"Call Emergency Artillery",effect:"Fx_Ships_Boffs_Cmd_Callartillery_Activate,Fx_Ships_Boffs_Cmd_Callartillery_Explosion"},{label:"Competitive Engine Buff Effect",effect:"Fx_Ship_Mod_Haste_Buff_Gen"},{label:"Co-opt Energy Weapons",effect:"Fx_Capt_Powers_Ship_Sci_Coopt_Energy_Wep_Aoe,Cfx_Capt_Powers_Ship_Sci_Coopt_Energy_Wep_Area"},{label:"Concentrate Fire Power",effect:"Fx_Ships_Boff_Cmd_Confire_Activatefx,Cfx_Ships_Boff_Cmd_Confire_Mark"},{label:"Cnidarian Jellyfish AoE",effect:"Cfx_Ship_Sp_T6_Jellyfish_Cnidarian_Defense_Aoe"},{label:"Dark Matter Anomaly",effect:"Cfx_Ship_Console_Dark_Matter_Anamoly_Costumefx"},{label:"Delphic Tear",effect:"Fx_Ships_Consoles_Cb21_Delphictear"},{label:"Destabilising Resonance Beam",effect:"P_Er_Ship_Destabilizing_Resonance_Beam_Aoe_Particles"},{label:"Elachi Walker Combat Pet (3 effects)",effect:"Soundfx_Elachiwalker_Footstep_Pet,Fx_Er_Tfo_Elachi_Walker_Combat_Pet_Deathfx,Soundfx_Elachiwalker_Petsummon"},{label:"Electrified Anomalies Trait",effect:"Fx_Tp_Ship_T6_Risian_Science_Electrified_Anomalies_Arc_Foe,Fx_Tp_Ship_T6_Risian_Science_Electrified_Anomalies_Arc_Friend"},{label:"Emergency Pwr to Shields",effect:"Fx_Ship_Eng_Emergencypowershields"},{label:"Emergency Pwr to Wep",effect:"Fx_Ship_Eng_Emergencypowerweapons"},{label:"Engineering Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Engineering_Teambuff"},{label:"Engineering Team",effect:"Cfx_Ship_Crewteam_Engineeringteam_Buff"},{label:"EPS Power Transfer",effect:"Cfx_Ship_Eng_Epspowertransfer_Target"},{label:"Focus Frenzy",effect:"Fx_Skilltree_Ship_Ffrenzy_Activatefx"},{label:"Go Down Fighting",effect:"Fx_Bop_Godownfighting"},{label:"Hangar Pet Rank Up",effect:"Fx_Ship_Levelup_Fighter_Rankup"},{label:"Hazard Emitters",effect:"Cfx_Ship_Sci_Hazardemitter_Buff"},{label:"Intel Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Intel_Teambuff"},{label:"Intel Team (uses 3 effects)",effect:"Cfx_Ship_Cruiser_Auras_Taunt,Cfx_Spc_Boffpowers_Intel_Intelteam_Buff,Fx_Ships_Intel_Lyinginwait"},{label:"Kemocite on ship animation",effect:"C1_E_Ship_Xindi_Lockboxcb15_Kemocite_Weaponry_Bufffx"},{label:"Kemocite HitFX ring",effect:"Fx_Ship_Xindi_Lockboxcb15_Kemocite_Weaponry_Aoe_Proc"},{label:"Kentari Ferocity Weapons Glow",effect:"P_Trait_Powers_Ship_Lukari_Colony_Kentari_Ferocity_Weapons_Glow"},{label:"Kobayashi Maru powerup silenced",effect:"Fx_Evr_Kmaru_Ship_Dev_Resupply_Drop_Powerup_Bufffx,Fx_Evr_Kmaru_Ship_Dev_Resupply_Drop_Powerup"},{label:"Less Obvious Loot Drop Common",effect:"Cfx_Space_Loot_Drop_Common_Costumefx"},{label:"Less Obvious Loot Drop Uncommon",effect:"Cfx_Space_Loot_Drop_Uncommon_Costumefx"},{label:"Less Obvious Loot Drop Rare",effect:"Cfx_Space_Loot_Drop_Rare_Costumefx"},{label:"Less Obvious Loot Drop Very Rare",effect:"Cfx_Space_Loot_Drop_Veryrare_Costumefx"},{label:"Less Obvious Loot Drop Lock Box",effect:"Cfx_Space_Loot_Drop_Chancebox_Costumefx"},{label:"Less Obvious Loot Drop Dilithium",effect:"Cfx_Space_Loot_Drop_Dilithium_Costumefx"},{label:"Miraculous Repairs",effect:"Fx_Bop_Miracleworker"},{label:"MW - Align Shield Frequencies",effect:"Fx_Spc_Boffpowers_Miracleworker_Alignshieldfrequencies_Hitfx"},{label:"MW - Destabilize Warp Core",effect:"Fx_Spc_Boffpowers_Miracleworker_Destabilizewarpcore"},{label:"MW - Exceed rated limits",effect:"Fx_Spc_Boffpowers_Miracleworker_Energyweaponsexceedratedlimits_Dot_Hitfx,Fx_Spc_Boffpowers_Miracleworker_Energyweaponsexceedratedlimits"},{label:"MW - Fix em up (and other green glows)",effect:"Fx_Ship_Mod_Damage_Buff"},{label:"MW - Mixed Armaments Synergy",effect:"Fx_Spc_Boffpowers_Miracleworker_Mixedarmamentssynergy"},{label:"MW - Narrow Sensor Bands",effect:"Fx_Spc_Boffpowers_Miracleworker_Narrowsensorbands"},{label:"MW - Null Pointer Flood",effect:"Fx_Spc_Boffpowers_Miracleworker_Nullpointerflood"},{label:"MW - Reroute shilds to Hull containment",effect:"Fx_Spc_Boffpowers_Miracleworker_Rerouteshieldstohullcontainment,Cfx_Spc_Boffpowers_Miracleworker_Rerouteshieldstohullcontainment"},{label:"Nadion Inversion",effect:"Fx_Bop_Nadioinversion"},{label:"Nanoprobe Shield Generator (Dyson Rep)",effect:"Cfx_Rp_Dyson_Ship_Reactive_Shielding"},{label:"Neutronic Eddies",effect:"Cfx_Ships_Cp_T6_Risian_Science_Neutronic_Edides_Costumefx"},{label:"Overwhelm Emitters",effect:"Fx_Ships_Boff_Cmd_Owemitters_Activatefx"},{label:"Photonic Officer",effect:"Fx_Bop_Photonicofficer_activate"},{label:"PILOT - Clean Getaway",effect:"Fx_Spc_Boff_Pilot_Cleangetaway_Activate"},{label:"PILOT - Coolant Ignition (mostly)",effect:"Fx_Spc_Boff_Pilot_Coolantinjection_Ignite,Fx_Spc_Boff_Pilot_Coolantinjection_Costumefx"},{label:"PILOT - Deploy Countermeasures",effect:"Fx_Spc_Boff_Pilot_Deploycm"},{label:"PILOT - Fly her apart",effect:"Cfx_Spc_Boff_Pilot_Flyapart_Dot"},{label:"PILOT - Form Up (mostly)",effect:"Fx_Spc_Boff_Pilot_Formup_Teleport,Fx_Spc_Boff_Pilot_Formup_Buff_Wepbuff"},{label:"PILOT - hold Together",effect:"Cfx_Spc_Boff_Pilot_Holdtogether"},{label:"PILOT - Lambda",effect:"Fx_Ship_Mod_Damage_Buff,Fx_Spc_Boff_Pilot_Aplambda_Bufffx,Fx_Spc_Boff_Pilot_Aplambda"},{label:"PILOT - Lock Trajectory",effect:"Fx_Spc_Boff_Pilot_Flares_Switch,Cfx_Spc_Boff_Pilot_Locktrajectory"},{label:"PILOT - Pilot Team",effect:"Cfx_Spc_Boff_Pilot_Pilotteam_Buff"},{label:"PILOT - Reroute Reserves to Weapons",effect:"Fx_Spc_Boff_Pilot_Reroute_Wepbuff,Fx_Spc_Boff_Pilot_Reroute_Activate"},{label:"PILOT - Subspace Boom",effect:"Cfx_Spc_Boff_Pilot_Ssboom_Costumefx_Neverdie,Fx_Spc_Boff_Pilot_Ssboom_Boom"},{label:"Plasma Storm",effect:"Cfx_Ship_Cp_Cb27_Generate_Plasma_Storm_Costumefx"},{label:"Rally Point Marker",effect:"Cfx_Ships_Boff_Cmd_Rallypoint_Marker"},{label:"Reverse Shield Polarity",effect:"Cfx_Ship_Eng_Reverseshieldpolarity_Buff"},{label:"Scattering Field",effect:"Cfx_Ship_Sci_Dampeningfield_Aoe,Cfx_Ship_Sci_Dampeningfield_Shield_Buff"},{label:"Science Team",effect:"Cfx_Ship_Crewteam_Scienceteam_Buff"},{label:"Science Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Science_Teambuff"},{label:"Soliton Wave Generator (uses 4 effects)",effect:"Cfx_Ship_Risa_Loot_Soliton_Wave_Suckfx_Target,Cfx_Ship_Risa_Loot_Soliton_Wave_Suckfx,Cfx_Ship_Risa_Loot_Soliton_Wave_Out,Cfx_Ship_Risa_Loot_Soliton_Wave_In"},{label:"Spore Infused Anomalies",effect:"Fx_Trait_Powers_Ship_T6_Somerville_Sia_Blast"},{label:"Subspace Vortex Teleport Effect",effect:"Fx_Ship_Xindi_Lockboxcb15_Subspace_Vortex_Teleport"},{label:"Suppression Barrage",effect:"Cfx_Ships_Boff_Cmd_Sbarrage_Buff"},{label:"Surgical Strikes",effect:"Fx_Spc_Boffpowers_Int_Sstrikes_Buff"},{label:"Tactical Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Tactical_Teambuff"},{label:"Tactical Initiative",effect:"Fx_Bop_Tacticalinitiative"},{label:"Tactical Team",effect:"Cfx_Ship_Crewteam_Tacticalteam_Buff"},{label:"Target Rich Environment",effect:"Fx_Ship_Trait_Cb20_Targetrichenvironment"},{label:"Temporal Anchor",effect:"Cfx_Ship_Trait_Temporal_Anchor_Costumefx"},{label:"Temporal Vortex Probe",effect:"C1_Eventreward_Fcd_Temporal_Vortex_Costumefx,Fx_Eventreward_Fcd_Temporal_Vortex_Blast"},{label:"Timeline Collapse (5 effects!)",effect:"Cfx_Ship_Temp_Tcollapse_Costume,Fx_Ship_Temp_Tcollapse_Hitfx,Fx_Ship_Temp_Tcollapse_Explode,Fx_Ship_Temp_Tcollapse_Beamhitfx,Fx_Ship_Temp_Tcollapse"},{label:"V'Ger Torpedo (Volatile Digital Transformation)",effect:"Fx_Ship_Torpedo_Plasma_Vger_Anniv_Explode,Cfx_Ship_Torpedo_Vger_Disintegrate_In_Tintable"},{label:"Viral Impulse Burst",effect:"Fx_Spc_Boffpowers_int_Viralimpulse"},{label:"Vulcan Jelly Fish Eject Red Matter",effect:"Cfx_ship_jellyfish_eject_red_matter_costumefx"},{label:"Vulnerability Assessment Sweep",effect:"Fx_Capt_Powers_Ship_Tac_Vulnerability_Assessment_Sweep"}],ground:[{label:"Agony Field Generator",effect:"Fx_Ground_Lockboxfx_Cb29_Agony_Field_Generator"},{label:"Anti-time ground",effect:"Cfx_Rep_Temp_Char_Kit_Sci_Antitime_Entanglement_Field_Costumefx"},{label:"Ball Lightning",effect:"Cfx_Char_Kit_Univ_Sum_Ball_Lightning_Costumefx"},{label:"Chaos Blaze",effect:"Cfx_Char_Chaos_Blaze_Aoe"},{label:"Conussive Tachyon Emission",effect:"fx_Char_Delta_Rep_Cte_Aoe"},{label:"Disco Ball (Party Bomb)",effect:"Cfx_Char_Device_Partybomb"},{label:"Dot-7 Drone Support Field",effect:"Cfx_Er_Bbs_char_Dot7_Drone_support_Field"},{label:"Eng Proficiency (Character Glow)",effect:"Cfx_Ground_Kit_Eng_Engineeringproficiency"},{label:"Ever Watchful",effect:"Cfx_Ground_Kit_Tac_Overwatch_Bufffx,Fx_Ground_Kit_Tac_Overwatch_Activatefx"},{label:"Herald AP Beam Projector ground weapon",effect:"Fx_Char_Icoenergy_Rifle_Energyblast,Fx_Char_Icoenergy_Assault_Beam_Lockbox"},{label:"Lava Floor",effect:"Cfx_Char_Kit_Univ_Sum_The_Floor_Is_Lava_Costumefx,Cfx_Char_Kit_Univ_Sum_The_Floor_Is_Lava_Geyser"},{label:"Less Obvious Loot Drop Common",effect:"Cfx_Gnd_Loot_Drop_Common_Costumefx"},{label:"Less Obvious Loot Drop Uncommon",effect:"Cfx_Gnd_Loot_Drop_Uncommon_Costumefx"},{label:"Less Obvious Loot Drop Rare",effect:"Cfx_Gnd_Loot_Drop_Rare_Costumefx"},{label:"Less Obvious Loot Drop Very Rare",effect:"Cfx_Gnd_Loot_Drop_Veryrare_Costumefx"},{label:"Less Obvious Loot Drop Lock Box",effect:"Cfx_Gnd_Loot_Drop_Chancebox_Costumefx"},{label:"Less Obvious Loot Drop Dilithium",effect:"Cfx_Gnd_Loot_Drop_Dilithium_Costumefx"},{label:"Motivation (Tac Kit Module)",effect:"Cfx_Ground_Kit_Tac_Motivation_Buff,Fx_Ground_Kit_Tac_Motivation"},{label:"Orbital Devastation",effect:"Fx_Char_Voth_Orbitalstrike_Chasebeam"},{label:"Pahvan Crystal Prism noisy tether",effect:"Cfx_Er_Tfo_Pahvan_Crystal_Prism_Tether_Beam"},{label:"Rally Cry",effect:"Fx_Ground_Kit_Tac_Rallycry"},{label:"Red Riker Gun Sound effect",effect:"Cfx_Ep_Winterevent_Redriker_Sniper_Chargefx"},{label:"Scientific Aptitude (character glow)",effect:"Cfx_Ground_Kit_Sci_Scientificaptitude"},{label:"Solar Gateway",effect:"Fx_Char_Ico_Capt_Portal,Fx_Char_Ico_Capt_Portal_Sunbeam"},{label:"Smoke Grenade",effect:"Fx_Char_Grenade_smoke_costume,Fx_Char_Grenade_Smoke_Explode"},{label:"Sompek Energy Rebounder",effect:"Fx_Env_Gnd_Qadhos_Arena_Phaserhazard_Cylinder_Turret"},{label:"Strike Team III (character red glow)",effect:"Cfx_Ground_Kit_Tac_Striketeam"},{label:"Symphony of Lightning Char Glow",effect:"Fx_Er_Featured_Char_Kuumaarke_Wristgun_Tir_bufffx"},{label:"Symphony of Lightning Drone AoE",effect:"Cfx_Er_Featured_Char_Kuumaarke_Set_Symphony_Of_Lightning_Drone_Aoe"},{label:"Symphony of Lightning STRIKE",effect:"Fx_Er_Featured_Char_Kuumaarke_Set_Symphony_Of_Lightning_Strike"},{label:"Trajectory Bending",effect:"Cfx_Char_Xindi_Cb15_Tac_Kit_Trajectory_Bending"},{label:"Visual Dampening Field",effect:"Cfx_Char_Trait_Mirror_Vdfield"}]};document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("appVersion");t&&(t.textContent=e);const a=document.getElementById("aboutVersion");a&&(a.textContent=e)}),(async()=>{function e(e=document){e.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n"),a=e.getAttribute("data-i18n-attr");if(!t)return;const n=H.t(t);a?e.setAttribute(a,n):e.textContent=n}),e.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const t=e.getAttribute("data-i18n-placeholder");t&&e.setAttribute("placeholder",H.t(t))}),e.querySelectorAll("[data-i18n-title]").forEach(e=>{const t=e.getAttribute("data-i18n-title");t&&e.setAttribute("title",H.t(t))}),e.querySelectorAll("[data-i18n-alt]").forEach(e=>{const t=e.getAttribute("data-i18n-alt");t&&e.setAttribute("alt",H.t(t))})}await H.init({lng:"en",fallbackLng:"en",resources:{en:{translation:Z},de:{translation:Y},fr:{translation:Q},es:{translation:ee}}}),window.applyTranslations=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()})();const ne=new class{constructor(){this.storageKey="sto_keybind_manager",this.backupKey="sto_keybind_manager_backup",this.settingsKey="sto_keybind_settings",this.version="1.0.0",this.init()}init(){this.migrateData(),this.ensureStorageStructure()}getAllData(){try{const e=localStorage.getItem(this.storageKey),t=localStorage.getItem("sto_app_reset");if(!e)return t?(localStorage.removeItem("sto_app_reset"),this.getEmptyData()):this.getDefaultData();const a=JSON.parse(e);return this.isValidDataStructure(a)?a:this.getDefaultData()}catch(e){return console.error("Error loading data from storage:",e),this.getDefaultData()}}saveAllData(e){try{this.createBackup();const t={...e,version:this.version,lastModified:(new Date).toISOString(),lastBackup:(new Date).toISOString()};return localStorage.setItem(this.storageKey,JSON.stringify(t)),!0}catch(e){return console.error("Error saving data to storage:",e),!1}}getProfile(e){return this.getAllData().profiles[e]||null}saveProfile(e,t){const a=this.getAllData();return a.profiles[e]={...t,lastModified:(new Date).toISOString()},this.saveAllData(a)}deleteProfile(e){const t=this.getAllData();if(t.profiles[e]){if(delete t.profiles[e],t.currentProfile===e){const e=Object.keys(t.profiles);t.currentProfile=e.length>0?e[0]:null}return this.saveAllData(t)}return!1}getSettings(){try{const e=localStorage.getItem(this.settingsKey);return e?JSON.parse(e):this.getDefaultSettings()}catch(e){return console.error("Error loading settings:",e),this.getDefaultSettings()}}saveSettings(e){try{return localStorage.setItem(this.settingsKey,JSON.stringify(e)),!0}catch(e){return console.error("Error saving settings:",e),!1}}createBackup(){try{const e=localStorage.getItem(this.storageKey);if(e){const t={data:e,timestamp:(new Date).toISOString(),version:this.version};localStorage.setItem(this.backupKey,JSON.stringify(t))}}catch(e){console.error("Error creating backup:",e)}}restoreFromBackup(){try{const e=localStorage.getItem(this.backupKey);if(e){const t=JSON.parse(e);return localStorage.setItem(this.storageKey,t.data),!0}}catch(e){console.error("Error restoring from backup:",e)}return!1}exportData(){const e=this.getAllData();return JSON.stringify(e,null,2)}importData(e){try{const t=JSON.parse(e);return!!this.isValidDataStructure(t)&&this.saveAllData(t)}catch(t){return t instanceof SyntaxError&&e.includes("invalid")||console.error("Error importing data:",t),!1}}clearAllData(){try{return localStorage.removeItem(this.storageKey),localStorage.removeItem(this.backupKey),localStorage.removeItem(this.settingsKey),localStorage.setItem("sto_app_reset","true"),!0}catch(e){return console.error("Error clearing data:",e),!1}}getStorageInfo(){try{const e=localStorage.getItem(this.storageKey)?.length||0,t=localStorage.getItem(this.backupKey)?.length||0,a=localStorage.getItem(this.settingsKey)?.length||0;return{totalSize:e+t+a,dataSize:e,backupSize:t,settingsSize:a,available:this.getAvailableStorage()}}catch(e){return console.error("Error getting storage info:",e),null}}getDefaultData(){return{version:this.version,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),currentProfile:"default_space",profiles:{default_space:{...STO_DATA.defaultProfiles.default_space},tactical_space:{...STO_DATA.defaultProfiles.tactical_space}},globalAliases:{},settings:this.getDefaultSettings()}}getEmptyData(){return{version:this.version,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),currentProfile:null,profiles:{},globalAliases:{},settings:this.getDefaultSettings()}}getDefaultSettings(){return{theme:"default",autoSave:!0,showTooltips:!0,confirmDeletes:!0,maxUndoSteps:50,defaultMode:"space",compactView:!1}}isValidDataStructure(e){if(!e||"object"!=typeof e)return!1;const t=["profiles","currentProfile"];for(const a of t)if(!(a in e))return!1;if("object"!=typeof e.profiles)return!1;for(const[t,a]of Object.entries(e.profiles))if(!this.isValidProfile(a))return!1;return!0}isValidProfile(e){if(!e||"object"!=typeof e)return!1;if(e.builds){if(!e.name||"object"!=typeof e.builds)return!1;const t=e.builds;if(!t.space&&!t.ground)return!1;for(const[e,a]of Object.entries(t))if("space"===e||"ground"===e){if(!a||"object"!=typeof a)return!1;if(!a.keys||"object"!=typeof a.keys)return!1}return!0}const t=["name","mode","keys"];for(const a of t)if(!(a in e))return!1;return"object"==typeof e.keys}ensureStorageStructure(){const e=this.getAllData();e.globalAliases||(e.globalAliases={}),e.settings||(e.settings=this.getDefaultSettings()),0===Object.keys(e.profiles).length&&null!==e.currentProfile&&(e.profiles={default_space:{...STO_DATA.defaultProfiles.default_space}},e.currentProfile="default_space"),Object.keys(e.profiles).length>0&&!e.profiles[e.currentProfile]&&(e.currentProfile=Object.keys(e.profiles)[0]),this.saveAllData(e)}migrateData(){const e=this.getAllData();e.version!==this.version&&(console.log(`Migrating data from ${e.version} to ${this.version}`),e.version=this.version,this.saveAllData(e))}getAvailableStorage(){try{let e="storage_test",t="0",a=0,n=0,o=10485760;for(;n<=o;){let i=Math.floor((n+o)/2);t="0".repeat(i);try{localStorage.setItem(e,t),localStorage.removeItem(e),a=i,n=i+1}catch(e){o=i-1}}return a}catch(e){return 0}}loadDefaultData(){const e=this.getDefaultData();return this.saveAllData(e)}},oe=new class{constructor(){this.currentModal=null}init(){this.setupEventListeners()}setupEventListeners(){const e=document.getElementById("profileSelect");e&&e.addEventListener("change",e=>{app.switchProfile(e.target.value)}),i.onDom("newProfileBtn","click","profile-new",()=>{this.showNewProfileModal()}),i.onDom("cloneProfileBtn","click","profile-clone",()=>{this.showCloneProfileModal()}),i.onDom("renameProfileBtn","click","profile-rename",()=>{this.showRenameProfileModal()}),i.onDom("deleteProfileBtn","click","profile-delete",()=>{this.confirmDeleteProfile()}),i.onDom("saveProfileBtn","click","profile-save",()=>{this.handleProfileSave()}),i.onDom("settingsBtn","click","settings-menu",e=>{e.stopPropagation(),this.toggleSettingsMenu()}),i.onDom("keybindsBtn","click","keybinds-menu",e=>{e.stopPropagation(),this.toggleKeybindsMenu()}),i.onDom("aliasesBtn","click","aliases-menu",e=>{e.stopPropagation(),this.toggleAliasesMenu()}),i.onDom("importKeybindsBtn","click","keybinds-import",()=>{this.importKeybinds(),this.closeKeybindsMenu()}),i.onDom("exportKeybindsBtn","click","keybinds-export",()=>{this.exportKeybinds(),this.closeKeybindsMenu()}),i.onDom("importAliasesBtn","click","aliases-import",()=>{this.importAliases(),this.closeAliasesMenu()}),i.onDom("exportAliasesBtn","click","aliases-export",()=>{this.exportAliases(),this.closeAliasesMenu()}),i.onDom("loadDefaultDataBtn","click","load-default-data",()=>{this.loadDefaultData(),this.closeSettingsMenu()}),i.onDom("resetAppBtn","click","reset-app",()=>{this.confirmResetApp(),this.closeSettingsMenu()}),i.onDom("aboutBtn","click","about-open",()=>{modalManager.show("aboutModal")}),i.onDom("themeToggleBtn","click","theme-toggle",()=>{app.toggleTheme(),this.closeSettingsMenu()}),document.addEventListener("click",()=>{this.closeSettingsMenu(),this.closeKeybindsMenu(),this.closeAliasesMenu()})}showNewProfileModal(){document.getElementById("profileModal");const e=document.getElementById("profileModalTitle"),t=document.getElementById("profileName"),a=document.getElementById("profileDescription");e&&(e.textContent="New Profile"),t&&(t.value="",t.placeholder="Enter profile name"),a&&(a.value=""),this.currentModal="new",modalManager.show("profileModal")}showCloneProfileModal(){const e=app.getCurrentProfile();if(!e)return void stoUI.showToast("No profile selected to clone","warning");document.getElementById("profileModal");const t=document.getElementById("profileModalTitle"),a=document.getElementById("profileName"),n=document.getElementById("profileDescription");t&&(t.textContent="Clone Profile"),a&&(a.value=`${e.name} Copy`,a.placeholder="Enter new profile name"),n&&(n.value=`Copy of ${e.name}`),this.currentModal="clone",modalManager.show("profileModal")}showRenameProfileModal(){const e=app.getCurrentProfile();if(!e)return void stoUI.showToast("No profile selected to rename","warning");document.getElementById("profileModal");const t=document.getElementById("profileModalTitle"),a=document.getElementById("profileName"),n=document.getElementById("profileDescription");t&&(t.textContent="Rename Profile"),a&&(a.value=e.name,a.placeholder="Enter profile name"),n&&(n.value=e.description||""),this.currentModal="rename",modalManager.show("profileModal")}handleProfileSave(){const e=document.getElementById("profileName"),t=document.getElementById("profileDescription");if(!e)return;const a=e.value.trim(),n=t?.value.trim()||"";if(!a)return stoUI.showToast("Profile name is required","error"),void e.focus();if(a.length>50)return stoUI.showToast("Profile name is too long (max 50 characters)","error"),void e.focus();const o=stoStorage.getAllData();if(Object.values(o.profiles).find(e=>e.name.toLowerCase()===a.toLowerCase()&&("rename"!==this.currentModal||e.name!==app.getCurrentProfile()?.name)))return stoUI.showToast("A profile with this name already exists","error"),void e.focus();try{switch(this.currentModal){case"new":this.createNewProfile(a,n);break;case"clone":this.cloneCurrentProfile(a,n);break;case"rename":this.renameCurrentProfile(a,n)}modalManager.hide("profileModal"),this.currentModal=null}catch(e){stoUI.showToast("Failed to save profile: "+e.message,"error")}}createNewProfile(e,t){const a=app.generateProfileId(e),n={name:e,description:t,mode:"space",keys:{},aliases:{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()};if(!stoStorage.saveProfile(a,n))throw new Error("Failed to save profile");app.switchProfile(a),app.renderProfiles(),stoUI.showToast(`Profile "${e}" created`,"success")}cloneCurrentProfile(e,t){const a=app.getCurrentProfile();if(!a)throw new Error("No profile to clone");const n=app.generateProfileId(e),o={...JSON.parse(JSON.stringify(a)),name:e,description:t,created:(new Date).toISOString(),lastModified:(new Date).toISOString()};if(!stoStorage.saveProfile(n,o))throw new Error("Failed to save cloned profile");app.switchProfile(n),app.renderProfiles(),stoUI.showToast(`Profile "${e}" created from "${a.name}"`,"success")}renameCurrentProfile(e,t){const a=app.getCurrentProfile();if(!a)throw new Error("No profile to rename");const n=a.name;if(a.name=e,a.description=t,a.lastModified=(new Date).toISOString(),!stoStorage.saveProfile(te.currentProfile,a))throw new Error("Failed to save renamed profile");app.renderProfiles(),app.setModified(!0),stoUI.showToast(`Profile renamed from "${n}" to "${e}"`,"success")}async confirmDeleteProfile(){const e=app.getCurrentProfile();if(!e)return void stoUI.showToast("No profile selected to delete","warning");const t=stoStorage.getAllData();Object.keys(t.profiles).length<=1?stoUI.showToast("Cannot delete the last profile","warning"):await stoUI.confirm(`Are you sure you want to delete the profile "${e.name}"?\n\nThis action cannot be undone.`,"Delete Profile","danger")&&this.deleteCurrentProfile()}deleteCurrentProfile(){const e=app.getCurrentProfile();if(!e)return;const t=e.name;app.deleteProfile(app.currentProfile)?stoUI.showToast(`Profile "${t}" deleted`,"success"):stoUI.showToast("Failed to delete profile","error")}toggleSettingsMenu(){const e=document.getElementById("settingsBtn");if(e){const t=e.closest(".dropdown");t&&t.classList.toggle("active")}}closeSettingsMenu(){const e=document.getElementById("settingsBtn");if(e){const t=e.closest(".dropdown");t&&t.classList.remove("active")}}toggleKeybindsMenu(){this.closeSettingsMenu(),this.closeAliasesMenu();const e=document.getElementById("keybindsBtn");if(e){const t=e.closest(".dropdown");t&&t.classList.toggle("active")}}closeKeybindsMenu(){const e=document.getElementById("keybindsBtn");if(e){const t=e.closest(".dropdown");t&&t.classList.remove("active")}}toggleAliasesMenu(){this.closeSettingsMenu(),this.closeKeybindsMenu();const e=document.getElementById("aliasesBtn");if(e){const t=e.closest(".dropdown");t&&t.classList.toggle("active")}}closeAliasesMenu(){const e=document.getElementById("aliasesBtn");if(e){const t=e.closest(".dropdown");t&&t.classList.remove("active")}}importKeybinds(){const e=document.getElementById("fileInput");e&&(e.accept=".txt",e.onchange=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{try{stoKeybinds.importKeybindFile(e.target.result)}catch(e){stoUI.showToast("Failed to import keybind file: "+e.message,"error")}},e.readAsText(t)}e.target.value=""},e.click())}exportKeybinds(){const e=app.getCurrentProfile();e?e.keys&&0!==Object.keys(e.keys).length?stoExport.exportSTOKeybindFile(e):stoUI.showToast("No keybinds to export","warning"):stoUI.showToast("No profile selected to export","warning")}importAliases(){const e=document.createElement("input");e.type="file",e.accept=".txt",e.onchange=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{try{const t=e.target.result;stoKeybinds.importAliasFile(t),window.stoAliases&&"function"==typeof window.stoAliases.renderAliasList&&window.stoAliases.renderAliasList()}catch(e){stoUI.showToast("Failed to import aliases: "+e.message,"error")}},e.readAsText(t)}},e.click()}exportAliases(){const e=app.getCurrentProfile();e?e.aliases&&0!==Object.keys(e.aliases).length?stoExport.exportAliases(e):stoUI.showToast("No aliases to export","warning"):stoUI.showToast("No profile selected to export","warning")}async confirmResetApp(){await stoUI.confirm("Are you sure you want to reset the application?\n\nThis will delete all profiles, keybinds, and settings. This action cannot be undone.","Reset Application","danger")&&this.resetApplication()}resetApplication(){try{stoStorage.clearAllData(),app.currentProfile=null,app.selectedKey=null,app.setModified(!1),app.renderProfiles(),app.renderKeyGrid(),app.renderCommandChain(),app.updateProfileInfo(),stoUI.showToast("Application reset successfully. All data cleared.","success")}catch(e){stoUI.showToast("Failed to reset application: "+e.message,"error")}}loadDefaultData(){try{if(stoStorage.loadDefaultData()){const e=stoStorage.getAllData();app.currentProfile=e.currentProfile,app.selectedKey=null,app.setModified(!1),app.renderProfiles(),app.renderKeyGrid(),app.renderCommandChain(),app.updateProfileInfo(),stoUI.showToast("Default demo data loaded successfully","success")}else stoUI.showToast("Failed to load default data","error")}catch(e){stoUI.showToast("Failed to load default data: "+e.message,"error")}}getProfileAnalysis(e){const t={keyCount:Object.keys(e.keys).length,commandCount:0,aliasCount:Object.keys(e.aliases||{}).length,commandTypes:{},keyTypes:{function:0,number:0,letter:0,special:0,modifier:0},complexity:"Simple",recommendations:[]};return Object.entries(e.keys).forEach(([e,a])=>{t.commandCount+=a.length,/^F\d+$/.test(e)?t.keyTypes.function++:/^\d+$/.test(e)?t.keyTypes.number++:/^[A-Z]$/.test(e)?t.keyTypes.letter++:e.includes("+")?t.keyTypes.modifier++:t.keyTypes.special++,a.forEach(e=>{t.commandTypes[e.type]=(t.commandTypes[e.type]||0)+1})}),t.commandCount>50?t.complexity="Complex":t.commandCount>20&&(t.complexity="Moderate"),this.generateRecommendations(t,e),t}generateRecommendations(e,t){const a=[];e.commandTypes.targeting||e.commandTypes.combat||a.push({type:"setup",title:"Add Basic Combat Commands",description:"Consider adding targeting and firing commands for basic combat functionality.",priority:"high"}),e.commandTypes.power||a.push({type:"defensive",title:"Add Defensive Abilities",description:"Add shield management commands like shield distribution and shield routing.",priority:"medium"}),e.keyTypes.modifier<3&&e.keyCount>10&&a.push({type:"efficiency",title:"Use Modifier Keys",description:"Consider using Ctrl+, Alt+, and Shift+ combinations to access more commands efficiently.",priority:"low"}),0===e.aliasCount&&e.commandCount>15&&a.push({type:"organization",title:"Create Command Aliases",description:"Use aliases to group related commands and simplify complex sequences.",priority:"medium"});const n=["FireAll","target_nearest_enemy","+fullimpulse"],o=Object.values(t.keys).some(e=>e.some(e=>n.some(t=>e.command.includes(t))));"ground"===t.mode&&o&&a.push({type:"mode",title:"Check Profile Mode",description:"This profile contains space combat commands but is set to ground mode.",priority:"medium"}),e.recommendations=a}getProfileTemplates(){return{basic_space:{name:"Basic Space Combat",description:"Essential space combat keybinds for new players",mode:"space",keys:{Space:[{command:"target_nearest_enemy",type:"targeting",icon:"üéØ",text:"Target nearest enemy"},{command:"FireAll",type:"combat",icon:"üî•",text:"Fire all weapons"}],Tab:[{command:"target_nearest_friend",type:"targeting",icon:"ü§ù",text:"Target nearest friend"}],F1:[{command:"target_self",type:"targeting",icon:"üë§",text:"Target self"},{command:"+power_exec Distribute_Shields",type:"power",icon:"üõ°Ô∏è",text:"Distribute shields"}]},aliases:{}},advanced_tactical:{name:"Advanced Tactical",description:"Comprehensive DPS-focused space build",mode:"space",keys:{Space:[{command:"target_nearest_enemy",type:"targeting",icon:"üéØ",text:"Target nearest enemy"},{command:"+STOTrayExecByTray 0 0",type:"tray",icon:"‚ö°",text:"Execute Tray 1 Slot 1"},{command:"FireAll",type:"combat",icon:"üî•",text:"Fire all weapons"}],1:[{command:"+STOTrayExecByTray 1 0",type:"tray",icon:"‚ö°",text:"Execute Tray 2 Slot 1"}],2:[{command:"+STOTrayExecByTray 1 1",type:"tray",icon:"‚ö°",text:"Execute Tray 2 Slot 2"}],F1:[{command:"target_self",type:"targeting",icon:"üë§",text:"Target self"}],F2:[{command:"target_self",type:"targeting",icon:"üë§",text:"Target self"}]},aliases:{AlphaStrike:{name:"AlphaStrike",commands:"target_nearest_enemy $$ +STOTrayExecByTray 0 0 $$ +STOTrayExecByTray 0 1",description:"Full alpha strike sequence"}}},ground_combat:{name:"Ground Combat",description:"Ground combat and away team keybinds",mode:"ground",keys:{Space:[{command:"target_nearest_enemy",type:"targeting",icon:"üéØ",text:"Target nearest enemy"},{command:"+STOTrayExecByTray 0 0",type:"tray",icon:"‚ö°",text:"Primary attack"}],1:[{command:"+STOTrayExecByTray 0 1",type:"tray",icon:"‚ö°",text:"Secondary attack"}],2:[{command:"+STOTrayExecByTray 0 2",type:"tray",icon:"‚ö°",text:"Kit ability 1"}],F1:[{command:"target_self",type:"targeting",icon:"üë§",text:"Target self"},{command:"+STOTrayExecByTray 1 0",type:"tray",icon:"üíä",text:"Heal self"}]},aliases:{}}}}createProfileFromTemplate(e){const t=this.getProfileTemplates()[e];if(!t)return void stoUI.showToast("Template not found","error");let a=t.name,n=1;const o=stoStorage.getAllData();for(;Object.values(o.profiles).some(e=>e.name===a);)a=`${t.name} ${n}`,n++;const i=app.generateProfileId(a),s={...t,name:a,created:(new Date).toISOString(),lastModified:(new Date).toISOString()};Object.values(s.keys).forEach(e=>{e.forEach(e=>{e.id=app.generateCommandId()})}),stoStorage.saveProfile(i,s)?(app.switchProfile(i),app.renderProfiles(),stoUI.showToast(`Profile "${a}" created from template`,"success")):stoUI.showToast("Failed to create profile from template","error")}exportProfile(e){const t=stoStorage.getProfile(e);if(!t)return void stoUI.showToast("Profile not found","error");const a={version:"1.0.0",exported:(new Date).toISOString(),profile:t},n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=`${t.name.replace(/[^a-zA-Z0-9]/g,"_")}_profile.json`,i.click(),URL.revokeObjectURL(o),stoUI.showToast(`Profile "${t.name}" exported`,"success")}async importProfile(e){try{const t=JSON.parse(e);if(!t.profile)throw new Error("Invalid profile file format");const a=t.profile;let n=a.name,o=1;const i=stoStorage.getAllData();for(;Object.values(i.profiles).some(e=>e.name===n);)n=`${a.name} (${o})`,o++;a.name=n,a.imported=(new Date).toISOString(),a.lastModified=(new Date).toISOString();const s=app.generateProfileId(n);if(stoStorage.saveProfile(s,a))return app.renderProfiles(),stoUI.showToast(`Profile "${n}" imported successfully`,"success"),!0;throw new Error("Failed to save imported profile")}catch(e){return stoUI.showToast("Failed to import profile: "+e.message,"error"),!1}}},ie=new class{constructor(){this.keybindPatterns={standard:/^([a-zA-Z0-9_+\-\s\[\]]+)\s+"([^"]*)"(?:\s+"([^"]*)")?$/,bind:/^\/bind\s+([a-zA-Z0-9_+\-\s\[\]]+)\s+(.+)$/,alias:/^alias\s+([a-zA-Z_][a-zA-Z0-9_]*)\s+(?:"([^"]+)"|<&\s+(.+?)\s+&>)$/,comment:/^[#;].*$/},this.validKeys=this.generateValidKeys()}init(){this.setupEventListeners()}generateValidKeys(){const e=new Set;for(let t=1;t<=12;t++)e.add(`F${t}`);for(let t=0;t<=9;t++)e.add(t.toString());for(let t=65;t<=90;t++)e.add(String.fromCharCode(t));["Space","Tab","Enter","Escape","Backspace","Delete","Insert","Home","End","PageUp","PageDown","Up","Down","Left","Right","NumPad0","NumPad1","NumPad2","NumPad3","NumPad4","NumPad5","NumPad6","NumPad7","NumPad8","NumPad9","NumPadEnter","NumPadPlus","NumPadMinus","NumPadMultiply","NumPadDivide","numpad0","numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9","divide","multiply","Button4","Button5","Button6","Button7","Button8","Lbutton","Rbutton","Mbutton","Leftdrag","Rightdrag","Middleclick","Mousechord","Wheelplus","Wheelminus","Semicolon","Equals","Comma","Minus","Period","Slash","Grave","LeftBracket","Backslash","RightBracket","Quote","[","]"].forEach(t=>e.add(t));const t=Array.from(e);return["Ctrl","Alt","Shift","Control"].forEach(a=>{t.forEach(t=>{e.add(`${a}+${t}`)})}),e.add("Ctrl+Alt"),e.add("Ctrl+Shift"),e.add("Alt+Shift"),e.add("Control+Alt"),e.add("Control+Shift"),t.forEach(t=>{e.add(`Ctrl+Alt+${t}`),e.add(`Ctrl+Shift+${t}`),e.add(`Alt+Shift+${t}`),e.add(`Control+Alt+${t}`),e.add(`Control+Shift+${t}`)}),Array.from(e).sort()}parseKeybindFile(e){const t=e.split("\n"),a={keybinds:{},aliases:{},comments:[],errors:[]};return t.forEach((e,t)=>{const n=e.trim();if(n)try{if(this.keybindPatterns.comment.test(n))a.comments.push({line:t+1,content:n});else if(this.keybindPatterns.alias.test(n)){const e=n.match(this.keybindPatterns.alias);if(e){const[,n,o,i]=e,s=o||i;a.aliases[n]={name:n,commands:s,line:t+1}}}else if(this.keybindPatterns.standard.test(n)){const e=n.match(this.keybindPatterns.standard);if(e){const[,n,o,i]=e,s=this.parseCommandString(o);a.keybinds[n]={key:n,commands:s,line:t+1,raw:o,optionalParam:i||null}}}else if(this.keybindPatterns.bind.test(n)){const e=n.match(this.keybindPatterns.bind);if(e){const[,n,o]=e,i=o.replace(/^"(.*)"$/,"$1"),s=this.parseCommandString(i);a.keybinds[n]={key:n,commands:s,line:t+1,raw:i}}}else a.errors.push({line:t+1,content:n,error:"Invalid keybind format"})}catch(e){a.errors.push({line:t+1,content:n,error:e.message})}}),a}generateMirroredCommandString(e){if(!e||e.length<=1)return e.map(e=>e.command||e).join(" $$ ");const t=e.map(e=>e.command||e),a=[...t].reverse().slice(1);return[...t,...a].join(" $$ ")}detectAndUnmirrorCommands(e){if(!e||"string"!=typeof e)return{isMirrored:!1,originalCommands:[]};const t=e.split(" $$ ").map(e=>e.trim()).filter(e=>e);if(t.length<=1)return{isMirrored:!1,originalCommands:t};if(t.length<3||t.length%2==0)return{isMirrored:!1,originalCommands:t};const a=Math.floor(t.length/2),n=t.slice(0,a+1),o=t.slice(a+1),i=n.slice(0,-1).reverse();return o.length===i.length&&o.every((e,t)=>e===i[t])?{isMirrored:!0,originalCommands:n}:{isMirrored:!1,originalCommands:t}}parseCommandString(e){return e.split("$$").map(e=>e.trim()).map((e,t)=>{const a={command:e,type:window.stoCommands?window.stoCommands.detectCommandType(e):"custom",icon:window.stoCommands?window.stoCommands.getCommandIcon(e):"‚öôÔ∏è",text:window.stoCommands?window.stoCommands.getCommandText(e):e,id:`imported_${Date.now()}_${t}`};if(e.includes("+STOTrayExecByTray")){const t=e.match(/\+STOTrayExecByTray\s+(\d+)\s+(\d+)/);t&&(a.parameters={tray:parseInt(t[1]),slot:parseInt(t[2])},a.text=`Execute Tray ${parseInt(t[1])+1} Slot ${parseInt(t[2])+1}`)}else if(e.includes('"')){const t=e.match(/^(\w+)\s+"([^"]+)"$/);t&&(a.parameters={message:t[2]},a.text=`${a.text}: ${t[2]}`)}return a})}importKeybindFile(e){const t=stoStorage.getProfile(te.currentProfile);if(!t)return stoUI.showToast("No profile selected for import","warning"),{success:!1,error:"No active profile"};try{const a=this.parseKeybindFile(e),n=Object.keys(a.keybinds).length;if(0===n)return stoUI.showToast("No keybinds found in file","warning"),{success:!1,error:"No keybinds found"};t.builds||(t.builds={space:{keys:{}},ground:{keys:{}}}),t.builds[te.currentEnvironment]||(t.builds[te.currentEnvironment]={keys:{}});const o=t.builds[te.currentEnvironment].keys;Object.entries(a.keybinds).forEach(([e,a])=>{const n=a.commands.map(e=>e.command).join(" $$ "),i=this.detectAndUnmirrorCommands(n);if(i.isMirrored){o[e]=this.parseCommandString(i.originalCommands.join(" $$ "));const a=te.currentEnvironment;t.keybindMetadata||(t.keybindMetadata={}),t.keybindMetadata[a]||(t.keybindMetadata[a]={}),t.keybindMetadata[a][e]={stabilizeExecutionOrder:!0}}else o[e]=a.commands}),stoStorage.saveProfile(te.currentProfile,t),app.setModified(!0),app.renderKeyGrid();const i=`Import completed: ${n} keybinds`;return Object.keys(a.aliases).length>0?stoUI.showToast(i+` (${Object.keys(a.aliases).length} aliases ignored - use Import Aliases)`,"success"):stoUI.showToast(i,"success"),{success:!0,imported:{keys:n},errors:a.errors}}catch(e){return stoUI.showToast("Import failed: "+e.message,"error"),{success:!1,error:e.message}}}importAliasFile(e){if(!app.getCurrentProfile())return stoUI.showToast("No profile selected for import","warning"),{success:!1,error:"No active profile"};try{const t=this.parseKeybindFile(e),a=Object.keys(t.aliases).length;if(0===a)return stoUI.showToast("No aliases found in file","warning"),{success:!1,error:"No aliases found"};const n=stoStorage.getProfile(te.currentProfile);if(!n)return stoUI.showToast("Failed to get profile for import","error"),{success:!1,error:"Profile not found"};n.aliases||(n.aliases={}),Object.entries(t.aliases).forEach(([e,t])=>{n.aliases[e]={commands:t.commands,description:t.description||""}}),stoStorage.saveProfile(te.currentProfile,n),app.setModified(!0),window.stoAliases&&"function"==typeof window.stoAliases.updateCommandLibrary&&window.stoAliases.updateCommandLibrary();const o=`Import completed: ${a} aliases`;return stoUI.showToast(o,"success"),{success:!0,imported:{aliases:a},errors:t.errors}}catch(e){return stoUI.showToast("Import failed: "+e.message,"error"),{success:!1,error:e.message}}}exportProfile(e){let t="";return t+=`# ${e.name} - ${e.mode} mode\n`,t+="# Generated by STO Tools Keybind Manager\n",t+=`# ${(new Date).toLocaleString()}\n\n`,t+="# Keybind Commands\n",Object.keys(e.keys).sort(this.compareKeys.bind(this)).forEach(a=>{const n=e.keys[a];if(n&&n.length>0){let o,i=!1;if(e.keybindMetadata){const t=e.mode||"space";e.keybindMetadata[t]&&e.keybindMetadata[t][a]?i=!!e.keybindMetadata[t][a].stabilizeExecutionOrder:e.keybindMetadata[a]&&(i=!!e.keybindMetadata[a].stabilizeExecutionOrder)}o=i&&n.length>1?this.generateMirroredCommandString(n):n.map(e=>e.command).join(" $$ "),t+=`${a} "${o}" ""\n`}else t+=`${a} "" ""\n`}),t}compareKeys(e,t){const a=e.match(/^F(\d+)$/),n=t.match(/^F(\d+)$/);if(a&&n)return parseInt(a[1])-parseInt(n[1]);if(a&&!n)return-1;if(!a&&n)return 1;const o=/^\d+$/.test(e),i=/^\d+$/.test(t);if(o&&i)return parseInt(e)-parseInt(t);if(o&&!i)return-1;if(!o&&i)return 1;const s=/^[A-Z]$/.test(e),r=/^[A-Z]$/.test(t);if(s&&r)return e.localeCompare(t);if(s&&!r)return-1;if(!s&&r)return 1;const c=["Space","Tab","Enter","Escape"],l=c.indexOf(e),d=c.indexOf(t);return-1!==l&&-1!==d?l-d:-1!==l&&-1===d?-1:-1===l&&-1!==d?1:e.localeCompare(t)}isValidKey(e){return!(!e||"string"!=typeof e)&&this.validKeys.some(t=>t.toLowerCase()===e.toLowerCase())}isValidAliasName(e){return STO_DATA.validation.aliasNamePattern.test(e)}validateKeybind(e,t){const a=[];return this.isValidKey(e)||a.push(`Invalid key name: ${e}`),t&&0!==t.length?t.forEach((e,t)=>{e.command&&0!==e.command.trim().length||a.push(`Command ${t+1} is empty`)}):a.push("At least one command is required"),t&&t.length>STO_DATA.validation.maxCommandsPerKey&&a.push(`Too many commands (max ${STO_DATA.validation.maxCommandsPerKey})`),{valid:0===a.length,errors:a}}suggestKeys(e=""){const t=e.toLowerCase();return this.validKeys.filter(e=>e.toLowerCase().includes(t)).slice(0,20)}getCommonKeys(){return["Space","Tab","Enter","F1","F2","F3","F4","F5","F6","F7","F8","1","2","3","4","5","6","7","8","9","0","Ctrl+1","Ctrl+2","Ctrl+3","Ctrl+4","Alt+1","Alt+2","Alt+3","Alt+4","Shift+1","Shift+2","Shift+3","Shift+4"]}setupEventListeners(){}handleKeybindFileImport(e){const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{this.importKeybindFile(e.target.result)}catch(e){stoUI.showToast("Failed to import keybind file: "+e.message,"error")}},a.readAsText(t),e.target.value=""}generateKeybindId(){return"keybind_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}cloneKeybind(e){return JSON.parse(JSON.stringify(e))}getProfileStats(e){const t={totalKeys:Object.keys(e.keys).length,totalCommands:0,totalAliases:Object.keys(e.aliases||{}).length,commandTypes:{},mostUsedCommands:{}};return Object.values(e.keys).forEach(e=>{t.totalCommands+=e.length,e.forEach(e=>{t.commandTypes[e.type]=(t.commandTypes[e.type]||0)+1,t.mostUsedCommands[e.command]=(t.mostUsedCommands[e.command]||0)+1})}),t}},se=new class{constructor(){this.currentAlias=null}init(){this.setupEventListeners(),this.updateCommandLibrary()}setupEventListeners(){i.onDom("addAliasBtn","click","alias-manager-open",()=>{this.showAliasManager()}),i.onDom("newAliasBtn","click","alias-new",()=>{this.showEditAliasModal()}),i.onDom("saveAliasBtn","click","alias-save",()=>{this.saveAlias()}),document.addEventListener("input",e=>{["aliasName","aliasCommands","aliasDescription"].includes(e.target.id)&&this.updateAliasPreview()}),document.addEventListener("click",e=>{if(e.target.classList.contains("insert-target-btn")||e.target.closest(".insert-target-btn")){e.preventDefault();const t=(e.target.classList.contains("insert-target-btn")?e.target:e.target.closest(".insert-target-btn")).closest(".textarea-with-button"),a=t?t.querySelector("textarea"):null;a&&this.insertTargetVariable(a)}})}showAliasManager(){this.renderAliasList(),modalManager.show("aliasManagerModal")}renderAliasList(){const e=document.getElementById("aliasList");if(!e)return;const t=app.getCurrentProfile();if(!t||!t.aliases)return void(e.innerHTML='\n                <div class="empty-state">\n                    <i class="fas fa-mask"></i>\n                    <h4>No Aliases</h4>\n                    <p>Create command aliases to simplify complex command sequences.</p>\n                </div>\n            ');const a=Object.entries(t.aliases);0!==a.length?(e.innerHTML=`\n            <div class="alias-grid">\n                ${a.map(([e,t])=>this.createAliasCard(e,t)).join("")}\n            </div>\n        `,e.querySelectorAll(".alias-card").forEach(e=>{const t=e.dataset.alias;e.querySelector(".edit-alias-btn")?.addEventListener("click",()=>{this.editAlias(t)}),e.querySelector(".delete-alias-btn")?.addEventListener("click",()=>{this.confirmDeleteAlias(t)}),e.querySelector(".use-alias-btn")?.addEventListener("click",()=>{this.useAlias(t)})})):e.innerHTML='\n                <div class="empty-state">\n                    <i class="fas fa-mask"></i>\n                    <h4>No Aliases</h4>\n                    <p>Create command aliases to simplify complex command sequences.</p>\n                </div>\n            '}createAliasCard(e,t){const a=t.commands.length>60?t.commands.substring(0,60)+"...":t.commands;return`\n            <div class="alias-card" data-alias="${e}">\n                <div class="alias-header">\n                    <h4>${e}</h4>\n                    <div class="alias-actions">\n                        <button class="btn btn-small-icon edit-alias-btn" title="Edit Alias">\n                            <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="btn btn-small-icon use-alias-btn" title="Add to Current Key">\n                            <i class="fas fa-plus"></i>\n                        </button>\n                        <button class="btn btn-small-icon btn-danger delete-alias-btn" title="Delete Alias">\n                            <i class="fas fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n                <div class="alias-description">\n                    ${t.description||"No description"}\n                </div>\n                <div class="alias-commands">\n                    <code>${a}</code>\n                </div>\n                <div class="alias-usage">\n                    Usage: <code>${e}</code>\n                </div>\n            </div>\n        `}showEditAliasModal(e=null){const t=document.getElementById("editAliasTitle"),a=document.getElementById("aliasName"),n=document.getElementById("aliasDescription"),o=document.getElementById("aliasCommands");if(e){const i=app.getCurrentProfile().aliases[e];t&&(t.textContent="Edit Alias"),a&&(a.value=e,a.disabled=!0),n&&(n.value=i.description||""),o&&(o.value=i.commands),this.currentAlias=e}else t&&(t.textContent="New Alias"),a&&(a.value="",a.disabled=!1),n&&(n.value=""),o&&(o.value=""),this.currentAlias=null;this.updateAliasPreview(),modalManager.hide("aliasManagerModal"),modalManager.show("editAliasModal")}editAlias(e){this.showEditAliasModal(e)}async confirmDeleteAlias(e){await stoUI.confirm(`Are you sure you want to delete the alias "${e}"?`,"Delete Alias","danger")&&this.deleteAlias(e)}deleteAlias(e){const t=app.getCurrentProfile();t&&t.aliases&&t.aliases[e]&&(delete t.aliases[e],app.saveProfile(),app.setModified(!0),this.renderAliasList(),this.updateCommandLibrary(),stoUI.showToast(`Alias "${e}" deleted`,"success"))}useAlias(e){if(!te.selectedKey)return void stoUI.showToast("Please select a key first","warning");const t={command:e,type:"alias",icon:"üé≠",text:`Alias: ${e}`,id:app.generateCommandId()};app.addCommand(te.selectedKey,t),modalManager.hide("aliasManagerModal"),stoUI.showToast(`Alias "${e}" added to ${te.selectedKey}`,"success")}saveAlias(){const e=document.getElementById("aliasName"),t=document.getElementById("aliasDescription"),a=document.getElementById("aliasCommands");if(!e||!a)return;const n=e.value.trim(),o=t?.value.trim()||"",i=a.value.trim(),s=this.validateAlias(n,i);if(!s.valid)return void stoUI.showToast(s.error,"error");const r=app.getCurrentProfile();if(!r)return void stoUI.showToast("No active profile","error");if(r.aliases||(r.aliases={}),!this.currentAlias&&r.aliases[n])return stoUI.showToast("An alias with this name already exists","error"),void e.focus();r.aliases[n]={name:n,description:o,commands:i,created:this.currentAlias?r.aliases[n]?.created:(new Date).toISOString(),lastModified:(new Date).toISOString()},app.saveProfile(),app.setModified(!0),this.updateCommandLibrary();const c=this.currentAlias?"updated":"created";stoUI.showToast(`Alias "${n}" ${c}`,"success"),modalManager.hide("editAliasModal"),this.showAliasManager()}validateAlias(e,t){if(!e)return{valid:!1,error:"Alias name is required"};if(!STO_DATA.validation.aliasNamePattern.test(e))return{valid:!1,error:"Invalid alias name. Use only letters, numbers, and underscores. Must start with a letter."};if(e.length>30)return{valid:!1,error:"Alias name is too long (max 30 characters)"};if(["alias","bind","unbind","bind_load_file","bind_save_file"].includes(e.toLowerCase()))return{valid:!1,error:"This is a reserved command name"};if(!t)return{valid:!1,error:"Commands are required"};if(t.length>500)return{valid:!1,error:"Command sequence is too long (max 500 characters)"};if("undefined"!=typeof app&&app.getCurrentProfile){const a=app.getCurrentProfile();if(a&&a.aliases&&Object.keys(a.aliases).some(a=>t.includes(a)&&a!==e))return{valid:!1,error:"Potential circular reference detected"}}return{valid:!0}}updateAliasPreview(){const e=document.getElementById("aliasPreview"),t=document.getElementById("aliasName"),a=document.getElementById("aliasCommands");if(!e||!t||!a)return;const n=t.value.trim()||"AliasName",o=a.value.trim()||"command sequence";e.textContent=`alias ${n} <& ${o} &>`}updateCommandLibrary(){const e=app.getCurrentProfile();if(!e||!e.aliases)return;const t=document.getElementById("commandCategories");if(!t)return;const a=t.querySelector('[data-category="aliases"]');a&&a.remove();const n=t.querySelector('[data-category="vertigo-aliases"]');n&&n.remove();const o=Object.entries(e.aliases),i=o.filter(([e,t])=>!e.startsWith("dynFxSetFXExlusionList_")),s=o.filter(([e,t])=>e.startsWith("dynFxSetFXExlusionList_"));if(i.length>0){const e=this.createAliasCategoryElement(i,"aliases","Command Aliases","fas fa-mask");t.appendChild(e)}if(s.length>0){const e=this.createAliasCategoryElement(s,"vertigo-aliases","VFX Aliases","fas fa-eye-slash");t.appendChild(e)}}createAliasCategoryElement(e,t="aliases",a="Command Aliases",n="fas fa-mask"){const o=document.createElement("div");o.className="category",o.dataset.category=t;const i=`commandCategory_${t}_collapsed`,s="true"===localStorage.getItem(i),r="vertigo-aliases"===t,c=r?"üëÅÔ∏è":"üé≠",l=r?"command-item vertigo-alias-item":"command-item alias-item";return o.innerHTML=`\n            <h4 class="${s?"collapsed":""}" data-category="${t}">\n                <i class="fas fa-chevron-right category-chevron"></i>\n                <i class="${n}"></i> \n                ${a}\n                <span class="command-count">(${e.length})</span>\n            </h4>\n            <div class="category-commands ${s?"collapsed":""}">\n                ${e.map(([e,t])=>`\n                    <div class="${l}" data-alias="${e}" title="${t.description||t.commands}">\n                        ${c} ${e}\n                    </div>\n                `).join("")}\n            </div>\n        `,o.querySelector("h4").addEventListener("click",()=>{this.toggleAliasCategory(t,o)}),o.addEventListener("click",e=>{if(e.target.classList.contains("alias-item")||e.target.classList.contains("vertigo-alias-item")){const t=e.target.dataset.alias;this.addAliasToKey(t)}}),o}toggleAliasCategory(e,t){const a=t.querySelector("h4"),n=t.querySelector(".category-commands"),o=a.querySelector(".category-chevron"),i=`commandCategory_${e}_collapsed`;n.classList.contains("collapsed")?(n.classList.remove("collapsed"),a.classList.remove("collapsed"),o.style.transform="rotate(90deg)",localStorage.setItem(i,"false")):(n.classList.add("collapsed"),a.classList.add("collapsed"),o.style.transform="rotate(0deg)",localStorage.setItem(i,"true"))}addAliasToKey(e){if(!te.selectedKey)return void stoUI.showToast("Please select a key first","warning");const t=app.getCurrentProfile().aliases[e];if(!t)return void stoUI.showToast("Alias not found","error");const a={command:e,type:"alias",icon:"üé≠",text:`Alias: ${e}`,description:t.description,id:app.generateCommandId()};app.addCommand(te.selectedKey,a)}getAliasTemplates(){return{space_combat:{name:"Space Combat",description:"Aliases for space combat scenarios",templates:{AttackRun:{name:"AttackRun",description:"Full attack sequence with targeting",commands:"target_nearest_enemy $$ +STOTrayExecByTray 0 0 $$ +STOTrayExecByTray 0 1"},DefensiveMode:{name:"DefensiveMode",description:"Defensive abilities and shield management",commands:"target_self $$ +power_exec Distribute_Shields $$ +STOTrayExecByTray 2 0 $$ +STOTrayExecByTray 2 1"},HealSelf:{name:"HealSelf",description:"Self-healing sequence",commands:"target_self $$ +STOTrayExecByTray 3 0 $$ +STOTrayExecByTray 3 1"}}},ground_combat:{name:"Ground Combat",description:"Aliases for ground combat scenarios",templates:{GroundAttack:{name:"GroundAttack",description:"Basic ground combat sequence",commands:"target_nearest_enemy $$ +STOTrayExecByTray 0 0 $$ +STOTrayExecByTray 0 1"},GroundHeal:{name:"GroundHeal",description:"Ground healing sequence",commands:"target_self $$ +STOTrayExecByTray 1 0 $$ +STOTrayExecByTray 1 1"}}},communication:{name:"Communication",description:"Aliases for team communication",templates:{TeamReady:{name:"TeamReady",description:"Announce ready status to team",commands:"team Ready!"},NeedHealing:{name:"NeedHealing",description:"Request healing from team",commands:"team Need healing!"},Incoming:{name:"Incoming",description:"Warn team of incoming enemies",commands:"team Incoming enemies!"}}}}}createAliasFromTemplate(e,t){const a=this.getAliasTemplates(),n=a[e]?.templates?.[t];if(!n)return void stoUI.showToast("Template not found","error");const o=app.getCurrentProfile();o.aliases&&o.aliases[n.name]?stoUI.showToast(`Alias "${n.name}" already exists`,"warning"):(o.aliases||(o.aliases={}),o.aliases[n.name]={...n,created:(new Date).toISOString(),lastModified:(new Date).toISOString()},app.saveProfile(),app.setModified(!0),this.updateCommandLibrary(),this.renderAliasList(),stoUI.showToast(`Alias "${n.name}" created from template`,"success"))}getAliasUsage(e){const t=app.getCurrentProfile();if(!t)return[];const a=[];return Object.entries(t.keys).forEach(([t,n])=>{n.forEach((n,o)=>{(n.command===e||n.command.includes(e))&&a.push({type:"keybind",key:t,position:o+1,context:`Key "${t}", command ${o+1}`})})}),Object.entries(t.aliases||{}).forEach(([t,n])=>{t!==e&&n.commands.includes(e)&&a.push({type:"alias",alias:t,context:`Alias "${t}"`})}),a}insertTargetVariable(e){const t=e.selectionStart,a=e.value,n=a.slice(0,t)+"$Target"+a.slice(t);e.value=n,e.setSelectionRange(t+7,t+7),e.focus(),e.dispatchEvent(new Event("input",{bubbles:!0}))}},re=new class{constructor(){this.exportFormats=null}init(){this.exportFormats={sto_keybind:H.t("sto_keybind_file_txt"),json_profile:H.t("json_profile_json"),json_project:H.t("complete_project_json"),csv_data:H.t("csv_data_csv"),html_report:H.t("html_report_html"),alias_file:H.t("alias_file_txt")},this.setupEventListeners()}setupEventListeners(){i.onDom("exportKeybindsBtn","click","exportKeybinds",()=>{this.showExportOptions()}),i.onDom("confirmExportBtn","click","export-confirm",()=>{this.performExport()}),i.onDom("copyPreviewBtn","click","copyPreview",()=>{this.copyCommandPreview()})}async showExportOptions(){app.getCurrentProfile()?stoUI.showModal("exportModal"):stoUI.showToast("No profile selected to export","warning")}performExport(){const e=app.getCurrentProfile();if(!e)return void stoUI.showToast("No profile selected to export","warning");const t=document.getElementById("exportFormat"),a=t?t.value:"sto_keybind",n=document.getElementById("exportEnvironment"),o=n&&n.value?n.value:e.mode||"space";switch(a){case"sto_keybind":this.exportSTOKeybindFile(e,o);break;case"json_profile":this.exportJSONProfile(e,o);break;case"json_project":this.exportCompleteProject();break;case"csv_data":this.exportCSVData(e,o);break;case"html_report":this.exportHTMLReport(e,o);break;case"alias_file":this.exportAliases(e)}stoUI.hideModal("exportModal")}exportSTOKeybindFile(e,t=e.mode){try{const a=this.generateSTOKeybindFile(e,{environment:t});this.downloadFile(a,this.generateFileName(e,"txt",t),"text/plain"),stoUI.showToast("Keybind file exported successfully","success")}catch(e){stoUI.showToast("Failed to export keybind file: "+e.message,"error")}}generateSTOKeybindFile(e,t={}){let a="";return a+=this.generateFileHeader(e),a+=this.generateKeybindSection(e.keys,{...t,profile:e,environment:t.environment||e.mode||"space"}),a+=this.generateFileFooter(),a}generateFileHeader(e){const t=(new Date).toLocaleString();let a;return"undefined"!=typeof stoKeybinds&&stoKeybinds.getProfileStats?a=stoKeybinds.getProfileStats(e):(a={totalKeys:Object.keys(e.keys||{}).length,totalCommands:0},Object.values(e.keys||{}).forEach(e=>{a.totalCommands+=e.length})),`; ================================================================\n; ${e.name} - STO Keybind Configuration\n; ================================================================\n; Mode: ${e.mode.toUpperCase()}\n; Generated: ${t}\n; Created by: STO Tools Keybind Manager v${STO_DATA.settings.version}\n;\n; Keybind Statistics:\n; - Keys bound: ${a.totalKeys}\n; - Total commands: ${a.totalCommands}\n;\n; Note: Aliases are exported separately\n; To use this file in Star Trek Online:\n; 1. Save this file to your STO Live folder\n; 2. In game, type: /bind_load_file ${this.generateFileName(e,"txt")}\n; ================================================================\n\n`}generateAliasSection(e){if(!e||0===Object.keys(e).length)return"";let t="; Command Aliases\n; ================================================================\n; Aliases allow you to create custom commands that execute\n; multiple commands in sequence. Use them in keybinds like any\n; other command.\n; ================================================================\n\n";return Object.entries(e).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,a])=>{a.description&&(t+=`; ${a.description}\n`),t+=`alias ${e} <& ${a.commands} &>\n\n`}),t}generateKeybindSection(e,t={}){if(!e||0===Object.keys(e).length)return"; No keybinds defined\n\n";let a,n="; Keybind Commands\n; ================================================================\n; Each line binds a key to one or more commands.\n; Multiple commands are separated by $$";t.stabilizeExecutionOrder&&(n+="\n; EXECUTION ORDER STABILIZATION: ON\n; Commands are mirrored to ensure consistent execution order\n; Phase 1: left-to-right, Phase 2: right-to-left"),n+="\n; ================================================================\n\n",a="undefined"!=typeof stoKeybinds&&stoKeybinds.compareKeys?Object.keys(e).sort(stoKeybinds.compareKeys.bind(stoKeybinds)):Object.keys(e).sort(this.compareKeys.bind(this));const o=this.groupKeysByType(a,e);return Object.entries(o).forEach(([a,o])=>{0!==o.length&&(n+=`; ${a}\n`,n+=`; ${"-".repeat(a.length)}\n`,o.forEach(a=>{const o=e[a];if(o&&o.length>0){let e;const i=t.stabilizeExecutionOrder;let s=!1;if(t.profile&&t.profile.keybindMetadata)if(t.environment&&t.profile.keybindMetadata[t.environment]){const e=t.profile.keybindMetadata[t.environment];s=!!(e&&e[a]&&e[a].stabilizeExecutionOrder)}else s=!(!t.profile.keybindMetadata[a]||!t.profile.keybindMetadata[a].stabilizeExecutionOrder);e=(i||s)&&o.length>1&&stoKeybinds?stoKeybinds.generateMirroredCommandString(o):o.map(e=>e.command).join(" $$ "),n+=`${a} "${e}"\n`}}),n+="\n")}),n}compareKeys(e,t){const a=e.match(/^F(\d+)$/),n=t.match(/^F(\d+)$/);if(a&&n)return parseInt(a[1])-parseInt(n[1]);if(a&&!n)return-1;if(!a&&n)return 1;const o=/^\d+$/.test(e),i=/^\d+$/.test(t);if(o&&i)return parseInt(e)-parseInt(t);if(o&&!i)return-1;if(!o&&i)return 1;const s=/^[A-Z]$/.test(e),r=/^[A-Z]$/.test(t);if(s&&r)return e.localeCompare(t);if(s&&!r)return-1;if(!s&&r)return 1;const c=["Space","Tab","Enter","Escape"],l=c.indexOf(e),d=c.indexOf(t);return-1!==l&&-1!==d?l-d:-1!==l&&-1===d?-1:-1===l&&-1!==d?1:e.localeCompare(t)}groupKeysByType(e,t){const a={"Function Keys":[],"Number Keys":[],"Letter Keys":[],"Special Keys":[],"Modifier Combinations":[]};return e.forEach(e=>{/^F\d+$/.test(e)?a["Function Keys"].push(e):/^\d+$/.test(e)?a["Number Keys"].push(e):/^[A-Z]$/.test(e)?a["Letter Keys"].push(e):e.includes("+")?a["Modifier Combinations"].push(e):a["Special Keys"].push(e)}),a}generateFileFooter(){return"; ================================================================\n; End of keybind file\n; ================================================================\n; \n; Additional STO Commands Reference:\n; \n; Targeting:\n;   target_nearest_enemy    - Target closest hostile\n;   target_nearest_friend   - Target closest friendly\n;   target_self            - Target your own ship\n; \n; Combat:\n;   FireAll               - Fire all weapons\n;   FirePhasers          - Fire beam weapons only\n;   FireTorps            - Fire torpedo weapons only\n; \n; Shield Management:\n;   +power_exec <ability> - Execute bridge officer ability\n;   Examples: +power_exec Distribute_Shields \n; \n; Tray Execution:\n;   +STOTrayExecByTray <tray> <slot> - Execute ability from tray\n;   Example: +STOTrayExecByTray 0 0  (Tray 1, Slot 1)\n; \n; For more commands and help, visit the STO Wiki or community forums.\n; ================================================================\n"}exportJSONProfile(e,t=e.mode){try{const a={version:STO_DATA.settings.version,exported:(new Date).toISOString(),type:"profile",profile:this.sanitizeProfileForExport(e)},n=JSON.stringify(a,null,2);this.downloadFile(n,this.generateFileName(e,"json",t),"application/json"),stoUI.showToast("Profile exported as JSON","success")}catch(e){stoUI.showToast("Failed to export profile: "+e.message,"error")}}exportCompleteProject(){try{const e=stoStorage.getAllData(),t={version:STO_DATA.settings.version,exported:(new Date).toISOString(),type:"project",data:e},a=JSON.stringify(t,null,2),n=`STO_Tools_Keybinds_Project_${(new Date).toISOString().split("T")[0]}.json`;this.downloadFile(a,n,"application/json"),stoUI.showToast("Complete project exported","success")}catch(e){stoUI.showToast("Failed to export project: "+e.message,"error")}}exportCSVData(e,t=e.mode){try{const a=this.generateCSVData(e);this.downloadFile(a,this.generateFileName(e,"csv",t),"text/csv"),stoUI.showToast("Data exported as CSV","success")}catch(e){stoUI.showToast("Failed to export CSV: "+e.message,"error")}}generateCSVData(e){let t="Key,Command,Type,Description,Position\n";return Object.entries(e.keys).forEach(([e,a])=>{a.forEach((a,n)=>{const o=[this.escapeCSV(e),this.escapeCSV(a.command),this.escapeCSV(a.type),this.escapeCSV(a.text||""),n+1].join(",");t+=o+"\n"})}),t}escapeCSV(e){return"string"!=typeof e&&(e=String(e)),e.includes(",")||e.includes('"')||e.includes("\n")?'"'+e.replace(/"/g,'""')+'"':e}exportHTMLReport(e,t=e.mode){try{const a=this.generateHTMLReport(e);this.downloadFile(a,this.generateFileName(e,"html",t),"text/html"),stoUI.showToast("HTML report exported","success")}catch(e){stoUI.showToast("Failed to export HTML report: "+e.message,"error")}}generateHTMLReport(e){const t=stoKeybinds.getProfileStats(e),a=(new Date).toLocaleString();return`<!DOCTYPE html>\n<html lang="${H.language}">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${e.name} - ${H.t("sto_keybind_report")}</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }\n        .header { border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }\n        .stats { background: #f5f5f5; padding: 20px; border-radius: 5px; margin-bottom: 30px; }\n        .keybind-group { margin-bottom: 30px; }\n        .keybind-group h3 { color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px; }\n        .keybind { margin-bottom: 15px; padding: 10px; background: #fafafa; border-left: 4px solid #007acc; }\n        .key { font-weight: bold; color: #007acc; }\n        .commands { margin-top: 5px; }\n        .command { display: inline-block; margin: 2px 5px 2px 0; padding: 2px 8px; background: #e0e0e0; border-radius: 3px; font-size: 0.9em; }\n        .command.targeting { background: #d4edda; }\n        .command.combat { background: #f8d7da; }\n        .command.tray { background: #cce5ff; }\n        .command.power { background: #fff3cd; }\n        .command.alias { background: #e2e3e5; }\n        .aliases { margin-top: 30px; }\n        .alias { margin-bottom: 15px; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; }\n        .alias-name { font-weight: bold; color: #495057; }\n        .alias-commands { font-family: monospace; background: #e9ecef; padding: 5px; margin-top: 5px; border-radius: 3px; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>${e.name}</h1>\n        <p><strong>${H.t("mode")}</strong> ${e.mode.toUpperCase()}</p>\n        <p><strong>${H.t("generated")}</strong> ${a}</p>\n        <p><strong>${H.t("created_by")}</strong> STO Tools Keybind Manager v${STO_DATA.settings.version}</p>\n    </div>\n\n    <div class="stats">\n        <h2>${H.t("statistics")}</h2>\n        <ul>\n            <li><strong>${H.t("keys_bound")}</strong> ${t.totalKeys}</li>\n            <li><strong>${H.t("total_commands")}</strong> ${t.totalCommands}</li>\n            <li><strong>${H.t("aliases_defined")}</strong> ${t.totalAliases}</li>\n        </ul>\n    </div>\n\n    ${this.generateHTMLKeybindSection(e.keys)}\n    ${this.generateHTMLAliasSection(e.aliases)}\n\n    <div style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #ccc; color: #666; font-size: 0.9em;">\n        <p>${H.t("report_footer")}</p>\n    </div>\n</body>\n</html>`}generateHTMLKeybindSection(e){if(!e||0===Object.keys(e).length)return`<div class="keybind-group"><h2>${H.t("keybinds")}</h2><p>${H.t("no_keybinds_defined")}</p></div>`;const t=Object.keys(e).sort(stoKeybinds.compareKeys.bind(stoKeybinds)),a=this.groupKeysByType(t,e);let n=`<div class="keybind-group"><h2>${H.t("keybinds")}</h2>`;return Object.entries(a).forEach(([t,a])=>{0!==a.length&&(n+=`<h3>${t}</h3>`,a.forEach(t=>{const a=e[t];a&&a.length>0&&(n+=`<div class="keybind">\n                        <div class="key">${t}</div>\n                        <div class="commands">\n                            ${a.map(e=>`<span class="command ${e.type}">${e.text||e.command}</span>`).join("")}\n                        </div>\n                    </div>`)}))}),n+="</div>",n}generateHTMLAliasSection(e){if(!e||0===Object.keys(e).length)return"";let t=`<div class="aliases"><h2>${H.t("command_aliases")}</h2>`;return Object.entries(e).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,a])=>{t+=`<div class="alias">\n                <div class="alias-name">${e}</div>\n                ${a.description?`<div>${a.description}</div>`:""}\n                <div class="alias-commands">${a.commands}</div>\n            </div>`}),t+="</div>",t}copyCommandPreview(){const e=document.getElementById("commandPreview");e&&e.textContent.trim()?stoUI.copyToClipboard(e.textContent):stoUI.showToast("No command to copy","warning")}generateFileName(e,t,a=e.mode||"space"){const n=a||e.mode||"space";return`${e.name.replace(/[^a-zA-Z0-9\-_]/g,"_")}_${n}_${(new Date).toISOString().split("T")[0]}.${t}`}downloadFile(e,t,a){const n=new Blob([e],{type:a}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}sanitizeProfileForExport(e){const t=JSON.parse(JSON.stringify(e));return t.keys&&Object.values(t.keys).forEach(e=>{e.forEach(e=>{delete e.id})}),t}exportAllProfiles(){const e=stoStorage.getAllData().profiles;e&&0!==Object.keys(e).length?(Object.entries(e).forEach(([e,t])=>{setTimeout(()=>{this.exportSTOKeybindFile(t)},100)}),stoUI.showToast(`Exporting ${Object.keys(e).length} profiles...`,"info")):stoUI.showToast("No profiles to export","warning")}async importFromFile(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=n=>{try{const o=n.target.result;switch(e.name.split(".").pop().toLowerCase()){case"txt":t(stoKeybinds.importKeybindFile(o));break;case"json":t(this.importJSONFile(o));break;default:a(new Error("Unsupported file format"))}}catch(e){a(e)}},n.onerror=()=>a(new Error("Failed to read file")),n.readAsText(e)})}importJSONFile(e){try{const t=JSON.parse(e);if("profile"===t.type&&t.profile)return stoProfiles.importProfile(e);if("project"===t.type&&t.data)return stoStorage.importData(JSON.stringify(t.data));throw new Error("Unknown JSON file format")}catch(e){throw new Error("Invalid JSON file: "+e.message)}}exportAliases(e){try{const t=this.generateAliasFile(e);this.downloadFile(t,this.generateAliasFileName(e,"txt"),"text/plain"),stoUI.showToast("Aliases exported successfully","success")}catch(e){stoUI.showToast("Failed to export aliases: "+e.message,"error")}}generateAliasFile(e){let t="";const a=(new Date).toLocaleString(),n=Object.keys(e.aliases||{}).length;return t+=`; ================================================================\n; ${e.name} - STO Alias Configuration\n; ================================================================\n; Mode: ${e.mode.toUpperCase()}\n; Generated: ${a}\n; Created by: STO Tools Keybind Manager v${STO_DATA.settings.version}\n;\n; Alias Statistics:\n; - Total aliases: ${n}\n;\n; To use these aliases in Star Trek Online:\n; 1. Save this file as "CommandAliases.txt" (exactly, without quotes)\n; 2. Place it in your STO directory:\n;    [STO Install]\\Star Trek Online\\Live\\localdata\\CommandAliases.txt\n; 3. The aliases will be available when you start the game\n;\n; Alternative: You can append these aliases to an existing CommandAliases.txt\n; file if you already have one with other aliases.\n;\n; Common STO installation paths:\n; - Steam: C:\\Program Files (x86)\\Steam\\steamapps\\common\\Star Trek Online\n; - Epic: C:\\Program Files\\Epic Games\\Star Trek Online  \n; - Arc: C:\\Program Files (x86)\\Perfect World Entertainment\\Arc Games\\Star Trek Online\n; ================================================================\n\n`,e.aliases&&Object.keys(e.aliases).length>0?t+=this.generateAliasSection(e.aliases):t+="; No aliases defined\n\n",t}generateAliasFileName(e,t){const a=e.name.replace(/[^a-zA-Z0-9\-_]/g,"_"),n=(new Date).toISOString().split("T")[0];return`${a}_aliases_${e.mode||"space"}_${n}.${t}`}},ce=new class{constructor(){this.overlayId="modalOverlay"}getOverlay(){return document.getElementById(this.overlayId)}show(e){const t="string"==typeof e?document.getElementById(e):e,a=this.getOverlay();if(a&&t){a.classList.add("active"),t.classList.add("active"),document.body.classList.add("modal-open");const e=t.querySelector("input, textarea, select");return e&&setTimeout(()=>e.focus(),100),!0}return!1}hide(e){const t="string"==typeof e?document.getElementById(e):e,a=this.getOverlay();return!(!a||!t||(t.classList.remove("active"),document.querySelector(".modal.active")||(a.classList.remove("active"),document.body.classList.remove("modal-open")),0))}},le=new class{constructor(){this.toastQueue=[],this.dragState={isDragging:!1,dragElement:null,dragData:null},this.init()}init(){this.setupGlobalEventListeners(),this.setupTooltips()}showToast(e,t="info",a=3e3){const n=this.createToast(e,t,a),o=document.getElementById("toastContainer");o&&(o.appendChild(n),requestAnimationFrame(()=>{n.classList.add("show")}),setTimeout(()=>{this.removeToast(n)},a))}createToast(e,t,a){const n=document.createElement("div");n.className=`toast toast-${t}`;const o={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};return n.innerHTML=`\n            <div class="toast-content">\n                <i class="fas ${o[t]||o.info}"></i>\n                <span class="toast-message">${e}</span>\n                <button class="toast-close">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        `,n.querySelector(".toast-close").addEventListener("click",()=>{this.removeToast(n)}),n}hideToast(e){e&&e.parentNode&&this.removeToast(e)}removeToast(e){e.classList.add("removing"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}showModal(e,t=null){return document.getElementById(e),!!modalManager.show(e)&&(t&&this.populateModalData(e,t),!0)}hideModal(e){return document.getElementById(e),!!modalManager.hide(e)&&(this.clearModalData(e),!0)}hideAllModals(){document.querySelectorAll(".modal.active").forEach(e=>{modalManager.hide(e.id)})}populateModalData(e,t){const a=document.getElementById(e);a&&Object.entries(t).forEach(([e,t])=>{const n=a.querySelector(`[data-field="${e}"], #${e}`);n&&("checkbox"===n.type?n.checked=t:n.value=t)})}clearModalData(e){const t=document.getElementById(e);t&&t.querySelectorAll("input, textarea, select").forEach(e=>{"checkbox"===e.type?e.checked=!1:e.value=""})}showLoading(e,t="Loading..."){if("string"==typeof e&&(e=document.getElementById(e)),e){e.classList.add("loading");const a=e.innerHTML;e.dataset.originalContent=a,e.innerHTML=`\n                <div class="loading-spinner">\n                    <i class="fas fa-spinner fa-spin"></i>\n                    <span>${t}</span>\n                </div>\n            `,e.disabled=!0}}hideLoading(e){"string"==typeof e&&(e=document.getElementById(e)),e&&e.classList.contains("loading")&&(e.classList.remove("loading"),e.innerHTML=e.dataset.originalContent||"",e.disabled=!1,delete e.dataset.originalContent)}async confirm(e,t="Confirm",a="warning"){return new Promise(n=>{const o=this.createConfirmModal(e,t,a),i="confirmModal";o.id=i,document.body.appendChild(o);const s=e=>{modalManager.hide(i),document.body.removeChild(o),n(e)};o.querySelector(".confirm-yes").addEventListener("click",()=>{s(!0)}),o.querySelector(".confirm-no").addEventListener("click",()=>{s(!1)}),requestAnimationFrame(()=>{modalManager.show(i)})})}createConfirmModal(e,t,a){const n=document.createElement("div");n.className="modal confirm-modal";const o={warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle",info:"fa-info-circle"};return n.innerHTML=`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3>\n                        <i class="fas ${o[a]||o.warning}"></i>\n                        ${t}\n                    </h3>\n                </div>\n                <div class="modal-body">\n                    <p>${e}</p>\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary confirm-yes">Yes</button>\n                    <button class="btn btn-secondary confirm-no">No</button>\n                </div>\n            </div>\n        `,n}initDragAndDrop(e,t={}){const{dragSelector:a=".draggable",dropZoneSelector:n=".drop-zone",onDragStart:o=null,onDragEnd:i=null,onDrop:s=null}=t;e.addEventListener("dragstart",e=>{e.target.matches(a)&&(this.dragState.isDragging=!0,this.dragState.dragElement=e.target,this.dragState.dragData=e.target.dataset,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",o&&o(e,this.dragState))}),e.addEventListener("dragend",e=>{e.target.matches(a)&&(e.target.classList.remove("dragging"),this.dragState.isDragging=!1,this.dragState.dragElement=null,this.dragState.dragData=null,i&&i(e))}),e.addEventListener("dragover",e=>{e.preventDefault();const t=e.target.closest(n);t&&t.classList.add("drag-over")}),e.addEventListener("dragleave",e=>{const t=e.target.closest(n);t&&t.classList.remove("drag-over")}),e.addEventListener("drop",e=>{e.preventDefault();const t=e.target.closest(n);t&&(t.classList.remove("drag-over"),s&&s(e,this.dragState,t))})}validateForm(e){const t=[];return e.querySelectorAll("input[required], textarea[required], select[required]").forEach(e=>{const a=e.value.trim(),n=e.dataset.fieldName||e.name||e.id;a?(e.classList.remove("error"),"email"!==e.type||this.isValidEmail(a)||(t.push(`${n} must be a valid email`),e.classList.add("error"))):(t.push(`${n} is required`),e.classList.add("error"))}),{isValid:0===t.length,errors:t}}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}async copyToClipboard(e){try{return await navigator.clipboard.writeText(e),this.showToast("Copied to clipboard","success"),!0}catch(t){const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select();try{return document.execCommand("copy"),this.showToast("Copied to clipboard","success"),!0}catch(e){return this.showToast("Failed to copy to clipboard","error"),!1}finally{document.body.removeChild(a)}}}fadeIn(e,t=300){e.style.opacity="0",e.style.display="block";let a=null;const n=o=>{a||(a=o);const i=o-a,s=Math.min(i/t,1);e.style.opacity=s,i<t&&requestAnimationFrame(n)};requestAnimationFrame(n)}fadeOut(e,t=300){let a=null;const n=o=>{a||(a=o);const i=o-a,s=Math.max(1-i/t,0);e.style.opacity=s,i<t?requestAnimationFrame(n):e.style.display="none"};requestAnimationFrame(n)}debounce(e,t){let a;return function(...n){clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),e(...n)},t)}}throttle(e,t){let a;return function(){const n=arguments;a||(e.apply(this,n),a=!0,setTimeout(()=>a=!1,t))}}setupGlobalEventListeners(){document.addEventListener("keydown",e=>{"Escape"===e.key&&this.hideAllModals()}),document.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&this.hideAllModals()})}setupTooltips(){document.addEventListener("mouseenter",e=>{e.target&&"function"==typeof e.target.hasAttribute&&e.target.hasAttribute("title")&&e.target.getAttribute("title").trim()&&this.showTooltip(e.target,e.target.getAttribute("title"))},!0),document.addEventListener("mouseleave",e=>{e.target&&"function"==typeof e.target.hasAttribute&&e.target.hasAttribute("title")&&this.hideTooltip()},!0)}showTooltip(e,t){this.hideTooltip();const a=document.createElement("div");a.className="tooltip",a.textContent=t,a.id="active-tooltip",document.body.appendChild(a);const n=e.getBoundingClientRect(),o=a.getBoundingClientRect();let i=n.left+n.width/2-o.width/2,s=n.top-o.height-8;i<8&&(i=8),i+o.width>window.innerWidth-8&&(i=window.innerWidth-o.width-8),s<8&&(s=n.bottom+8,a.classList.add("tooltip-bottom")),a.style.left=i+"px",a.style.top=s+"px",requestAnimationFrame(()=>{a.classList.add("show")})}hideTooltip(){const e=document.getElementById("active-tooltip");e&&e.remove()}},de=new class{constructor(){this.currentCommand=null,this.commandBuilders=new Map,this.init()}init(){this.setupCommandBuilders(),this.setupEventListeners()}setupCommandBuilders(){this.commandBuilders.set("targeting",{build:(e,t={})=>{const a=STO_DATA.commands.targeting.commands[e];return a?{command:a.command,type:"targeting",icon:a.icon,text:a.name,description:a.description}:null},getUI:()=>this.createTargetingUI()}),this.commandBuilders.set("combat",{build:(e,t={})=>{const a=STO_DATA.commands.combat.commands[e];return a?{command:a.command,type:"combat",icon:a.icon,text:a.name,description:a.description}:null},getUI:()=>this.createCombatUI()}),this.commandBuilders.set("tray",{build:(e,t={})=>{const a=t.tray||0,n=t.slot||0;if("tray_with_backup"===e){const e=t.backup_tray||0,o=t.backup_slot||0,i=t.active||"on";return{command:`TrayExecByTrayWithBackup ${a} ${n} ${e} ${o} ${"on"===i?1:0}`,type:"tray",icon:"‚ö°",text:`Execute Tray ${a+1} Slot ${n+1} (with backup)`,description:`Execute ability in tray ${a+1}, slot ${n+1} with backup in tray ${e+1}, slot ${o+1}`,parameters:{tray:a,slot:n,backup_tray:e,backup_slot:o,active:i}}}if("tray_range"===e){const e=t.start_tray||0,a=t.start_slot||0,n=t.end_tray||0,o=t.end_slot||0,i=t.command_type||"STOTrayExecByTray";return this.generateTrayRangeCommands(e,a,n,o,i).map((t,s)=>({command:t,type:"tray",icon:"‚ö°",text:0===s?`Execute Range: Tray ${e+1} Slot ${a+1} to Tray ${n+1} Slot ${o+1}`:t,description:0===s?`Execute abilities from tray ${e+1} slot ${a+1} to tray ${n+1} slot ${o+1}`:t,parameters:0===s?{start_tray:e,start_slot:a,end_tray:n,end_slot:o,command_type:i}:void 0}))}if("tray_range_with_backup"===e){const e=t.active||1,a=t.start_tray||0,n=t.start_slot||0,o=t.end_tray||0,i=t.end_slot||0,s=t.backup_start_tray||0,r=t.backup_start_slot||0,c=t.backup_end_tray||0,l=t.backup_end_slot||0;return this.generateTrayRangeWithBackupCommands(e,a,n,o,i,s,r,c,l).map((t,d)=>({command:t,type:"tray",icon:"‚ö°",text:0===d?`Execute Range with Backup: Tray ${a+1}-${o+1}`:t,description:0===d?`Execute abilities from tray ${a+1} to ${o+1} with backup range`:t,parameters:0===d?{active:e,start_tray:a,start_slot:n,end_tray:o,end_slot:i,backup_start_tray:s,backup_start_slot:r,backup_end_tray:c,backup_end_slot:l}:void 0}))}if("whole_tray"===e){const e=t.command_type||"STOTrayExecByTray";return this.generateWholeTrayCommands(a,e).map((t,n)=>({command:t,type:"tray",icon:"‚ö°",text:0===n?`Execute Whole Tray ${a+1}`:t,description:0===n?`Execute all abilities in tray ${a+1}`:t,parameters:0===n?{tray:a,command_type:e}:void 0}))}if("whole_tray_with_backup"===e){const e=t.active||1,n=t.backup_tray||0;return this.generateWholeTrayWithBackupCommands(e,a,n).map((t,o)=>({command:t,type:"tray",icon:"‚ö°",text:0===o?`Execute Whole Tray ${a+1} (with backup Tray ${n+1})`:t,description:0===o?`Execute all abilities in tray ${a+1} with backup from tray ${n+1}`:t,parameters:0===o?{active:e,tray:a,backup_tray:n}:void 0}))}const o=t.command_type||"STOTrayExecByTray";return{command:`+${o} ${a} ${n}`,type:"tray",icon:"‚ö°",text:`Execute Tray ${a+1} Slot ${n+1}`,description:`Execute ability in tray ${a+1}, slot ${n+1}`,parameters:{tray:a,slot:n,command_type:o}}},getUI:()=>this.createTrayUI()}),this.commandBuilders.set("power",{build:(e,t={})=>{const a=STO_DATA.commands.power.commands[e];return a?{command:a.command,type:"power",icon:a.icon,text:a.name,description:a.description}:null},getUI:()=>this.createPowerUI()}),this.commandBuilders.set("movement",{build:(e,t={})=>{const a=STO_DATA.commands.movement.commands[e];if(!a)return null;let n=a.command;return a.customizable&&t&&("throttle_adjust"===e&&void 0!==t.amount?n=`${a.command} ${t.amount}`:"throttle_set"===e&&void 0!==t.position&&(n=`${a.command} ${t.position}`)),{command:n,type:"movement",icon:a.icon,text:a.name,description:a.description}},getUI:()=>this.createMovementUI()}),this.commandBuilders.set("camera",{build:(e,t={})=>{const a=STO_DATA.commands.camera.commands[e];if(!a)return null;let n=a.command;return a.customizable&&t&&"cam_distance"===e&&void 0!==t.distance&&(n=`${a.command} ${t.distance}`),{command:n,type:"camera",icon:a.icon,text:a.name,description:a.description}},getUI:()=>this.createCameraUI()}),this.commandBuilders.set("communication",{build:(e,t={})=>{const a=STO_DATA.commands.communication.commands[e];if(!a)return null;const n=t.message||"Message text here";return{command:`${a.command} ${n}`,type:"communication",icon:a.icon,text:`${a.name}: ${n}`,description:a.description,parameters:{message:n}}},getUI:()=>this.createCommunicationUI()}),this.commandBuilders.set("system",{build:(e,t={})=>{const a=STO_DATA.commands.system.commands[e];if(!a)return null;let n=a.command;return a.customizable&&t&&("bind_save_file"!==e&&"bind_load_file"!==e||!t.filename?"combat_log"===e&&void 0!==t.state&&(n=`${a.command} ${t.state}`):n=`${a.command} ${t.filename}`),{command:n,type:"system",icon:a.icon,text:a.name,description:a.description}},getUI:()=>this.createSystemUI()}),this.commandBuilders.set("alias",{build:(e,t={})=>{const a=t.alias_name||"";return a.trim()?{command:a,type:"alias",icon:"üìù",text:`Alias: ${a}`,description:"Execute custom alias",parameters:{alias_name:a}}:null},getUI:()=>this.createAliasUI()}),this.commandBuilders.set("custom",{build:(e,t={})=>{const a=t.command||"",n=t.text||"Custom Command";return{command:a,type:"custom",icon:"‚öôÔ∏è",text:n,description:"Custom command",parameters:{command:a,text:n}}},getUI:()=>this.createCustomUI()})}createTargetingUI(){const e=STO_DATA.commands.targeting.commands;return`\n            <div class="command-selector">\n                <label for="targetingCommand">Targeting Command:</label>\n                <select id="targetingCommand">\n                    <option value="">Select targeting command...</option>\n                    ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                </select>\n            </div>\n        `}createCombatUI(){const e=STO_DATA.commands.combat.commands;return`\n            <div class="command-selector">\n                <label for="combatCommand">Combat Command:</label>\n                <select id="combatCommand">\n                    <option value="">Select combat command...</option>\n                    ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                </select>\n                <div id="combatCommandWarning" class="command-warning" style="display: none;">\n                    <i class="fas fa-exclamation-triangle"></i>\n                    <span id="combatWarningText"></span>\n                </div>\n            </div>\n        `}createTrayUI(){return`\n            <div class="tray-builder">\n                <div class="form-group">\n                    <label for="trayCommandType">Command Type:</label>\n                    <select id="trayCommandType">\n                        <option value="custom_tray">Single Tray Slot</option>\n                        <option value="tray_with_backup">Single Tray with Backup</option>\n                        <option value="tray_range">Tray Range</option>\n                        <option value="tray_range_with_backup">Tray Range with Backup</option>\n                        <option value="whole_tray">Whole Tray</option>\n                        <option value="whole_tray_with_backup">Whole Tray with Backup</option>\n                    </select>\n                </div>\n                \n                \x3c!-- Single Tray Configuration --\x3e\n                <div id="singleTrayConfig" class="tray-config-section">\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label for="trayNumber">Tray Number:</label>\n                            <select id="trayNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Tray ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <label for="slotNumber">Slot Number:</label>\n                            <select id="slotNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Slot ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- Backup Configuration --\x3e\n                <div id="backupConfig" class="tray-config-section" style="display: none;">\n                    <h4>Backup Configuration</h4>\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label for="backupTrayNumber">Backup Tray:</label>\n                            <select id="backupTrayNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Tray ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <label for="backupSlotNumber">Backup Slot:</label>\n                            <select id="backupSlotNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Slot ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <label for="activeState">Active State:</label>\n                        <select id="activeState">\n                            <option value="1">Active (1)</option>\n                            <option value="0">Inactive (0)</option>\n                        </select>\n                    </div>\n                </div>\n                \n                \x3c!-- Range Configuration --\x3e\n                <div id="rangeConfig" class="tray-config-section" style="display: none;">\n                    <h4>Range Configuration</h4>\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label for="startTrayNumber">Start Tray:</label>\n                            <select id="startTrayNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Tray ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <label for="startSlotNumber">Start Slot:</label>\n                            <select id="startSlotNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Slot ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label for="endTrayNumber">End Tray:</label>\n                            <select id="endTrayNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Tray ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <label for="endSlotNumber">End Slot:</label>\n                            <select id="endSlotNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Slot ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- Backup Range Configuration --\x3e\n                <div id="backupRangeConfig" class="tray-config-section" style="display: none;">\n                    <h4>Backup Range Configuration</h4>\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label for="backupStartTrayNumber">Backup Start Tray:</label>\n                            <select id="backupStartTrayNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Tray ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <label for="backupStartSlotNumber">Backup Start Slot:</label>\n                            <select id="backupStartSlotNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Slot ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label for="backupEndTrayNumber">Backup End Tray:</label>\n                            <select id="backupEndTrayNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Tray ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <label for="backupEndSlotNumber">Backup End Slot:</label>\n                            <select id="backupEndSlotNumber">\n                                ${Array.from({length:10},(e,t)=>`<option value="${t}">Slot ${t+1}</option>`).join("")}\n                            </select>\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- Command Type Selection --\x3e\n                <div id="commandTypeConfig" class="tray-config-section" style="display: none;">\n                    <div class="form-group">\n                        <label for="trayCommandVariant">Command Variant:</label>\n                        <select id="trayCommandVariant">\n                            <option value="STOTrayExecByTray">STOTrayExecByTray (shows key binding on UI)</option>\n                            <option value="TrayExecByTray">TrayExecByTray (no UI indication)</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class="tray-visual" id="trayVisual">\n                    \x3c!-- Visual tray representation will be generated here --\x3e\n                </div>\n            </div>\n        `}createPowerUI(){const e=STO_DATA.commands.power.commands;return`\n            <div class="command-selector">\n                <label for="powerCommand">Shield Command:</label>\n                <select id="powerCommand">\n                    <option value="">Select shield command...</option>\n                    ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                </select>\n                <div id="powerCommandWarning" class="command-warning" style="display: none;">\n                    <i class="fas fa-exclamation-triangle"></i>\n                    <span id="powerWarningText"></span>\n                </div>\n            </div>\n        `}createMovementUI(){const e=STO_DATA.commands.movement.commands;return`\n            <div class="command-selector">\n                <label for="movementCommand">Movement Command:</label>\n                <select id="movementCommand">\n                    <option value="">Select movement command...</option>\n                    ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                </select>\n                <div id="movementParams" style="display: none;">\n                    <div class="form-group">\n                        <label for="movementAmount">Amount (-1 to 1):</label>\n                        <input type="number" id="movementAmount" min="-1" max="1" step="0.05" value="0.25">\n                    </div>\n                    <div class="form-group">\n                        <label for="movementPosition">Position (-1 to 1):</label>\n                        <input type="number" id="movementPosition" min="-1" max="1" step="0.1" value="1">\n                    </div>\n                </div>\n            </div>\n        `}createCommunicationUI(){const e=STO_DATA.commands.communication.commands;return`\n            <div class="communication-builder">\n                <div class="form-group">\n                    <label for="commCommand">Communication Type:</label>\n                    <select id="commCommand">\n                        <option value="">Select communication type...</option>\n                        ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                    </select>\n                </div>\n                <div class="form-group">\n                    <label for="commMessage">Message:</label>\n                    <div class="input-with-button">\n                        <input type="text" id="commMessage" placeholder="Enter your message" maxlength="100">\n                        <button type="button" class="btn btn-small insert-target-btn" title="Insert $Target variable">\n                            <i class="fas fa-crosshairs"></i> $Target\n                        </button>\n                    </div>\n                    <small>Maximum 100 characters</small>\n                </div>\n                <div class="variable-help">\n                    <h4><i class="fas fa-info-circle"></i> STO Variables</h4>\n                    <div class="variable-info">\n                        <strong>$Target</strong> - Replaced with your current target's name<br>\n                        <em>Example:</em> <code>team Attacking [$Target]</code> ‚Üí <code>team Attacking [Borg Cube]</code>\n                    </div>\n                </div>\n            </div>\n        `}createCameraUI(){const e=STO_DATA.commands.camera.commands;return`\n            <div class="command-selector">\n                <label for="cameraCommand">Camera Command:</label>\n                <select id="cameraCommand">\n                    <option value="">Select camera command...</option>\n                    ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                </select>\n                <div id="cameraParams" style="display: none;">\n                    <div class="form-group">\n                        <label for="cameraDistance">Distance:</label>\n                        <input type="number" id="cameraDistance" min="1" max="500" value="50">\n                    </div>\n                </div>\n            </div>\n        `}createSystemUI(){const e=STO_DATA.commands.system.commands;return`\n            <div class="command-selector">\n                <label for="systemCommand">System Command:</label>\n                <select id="systemCommand">\n                    <option value="">Select system command...</option>\n                    ${Object.entries(e).map(([e,t])=>`<option value="${e}">${t.name}</option>`).join("")}\n                </select>\n                <div id="systemParams" style="display: none;">\n                    <div class="form-group">\n                        <label for="systemFilename">Filename:</label>\n                        <input type="text" id="systemFilename" value="my_binds.txt">\n                    </div>\n                    <div class="form-group">\n                        <label for="systemState">State (0/1):</label>\n                        <input type="number" id="systemState" min="0" max="1" value="1">\n                    </div>\n                </div>\n            </div>\n        `}createAliasUI(){const e=app?.getCurrentProfile(),t=e?.aliases||{},a=Object.entries(t);return 0===a.length?'\n                <div class="alias-builder">\n                    <div class="empty-state">\n                        <i class="fas fa-mask"></i>\n                        <h4>No Aliases Available</h4>\n                        <p>Create aliases in the Alias Manager first.</p>\n                        <button type="button" class="btn btn-primary" id="openAliasManager">\n                            <i class="fas fa-plus"></i> Create Alias\n                        </button>\n                    </div>\n                </div>\n            ':`\n            <div class="alias-builder">\n                <div class="form-group">\n                    <label for="aliasSelect">Available Aliases:</label>\n                    <select id="aliasSelect">\n                        <option value="">Select an alias...</option>\n                        ${a.map(([e,t])=>`<option value="${e}">${e}${t.description?" - "+t.description:""}</option>`).join("")}\n                    </select>\n                </div>\n                <div id="aliasPreviewSection" style="display: none;">\n                    <div class="alias-info">\n                        <label>Alias Commands:</label>\n                        <div class="command-preview" id="selectedAliasPreview"></div>\n                    </div>\n                </div>\n            </div>\n        `}createCustomUI(){return'\n            <div class="custom-builder">\n                <div class="form-group">\n                    <label for="customCommand">Command:</label>\n                    <div class="input-with-button">\n                        <input type="text" id="customCommand" placeholder="Enter STO command" autocomplete="off">\n                        <button type="button" class="btn btn-small insert-target-btn" title="Insert $Target variable">\n                            <i class="fas fa-crosshairs"></i> $Target\n                        </button>\n                    </div>\n                    <small>Enter the exact STO command syntax</small>\n                </div>\n                <div class="form-group">\n                    <label for="customText">Display Text:</label>\n                    <input type="text" id="customText" placeholder="Descriptive name for this command" autocomplete="off">\n                </div>\n                <div class="command-help">\n                    <h4>Common Commands:</h4>\n                    <div class="command-examples">\n                        <button type="button" class="example-cmd" data-cmd="target_nearest_enemy">target_nearest_enemy</button>\n                        <button type="button" class="example-cmd" data-cmd="FireAll">FireAll</button>\n                        <button type="button" class="example-cmd" data-cmd="+power_exec Distribute_Shields">+power_exec Distribute_Shields</button>\n                        <button type="button" class="example-cmd" data-cmd="+STOTrayExecByTray 0 0">+STOTrayExecByTray 0 0</button>\n                        <button type="button" class="example-cmd" data-cmd=\'team Attacking [$Target]\'>team Attacking [$Target]</button>\n                    </div>\n                </div>\n                <div class="variable-help">\n                    <h4><i class="fas fa-info-circle"></i> STO Variables</h4>\n                    <div class="variable-info">\n                        <strong>$Target</strong> - Replaced with your current target\'s name<br>\n                        <em>Example:</em> <code>team Focus fire on [$Target]</code>\n                    </div>\n                </div>\n            </div>\n        '}setupEventListeners(){document.addEventListener("change",e=>{"commandType"===e.target.id&&this.handleCommandTypeChange(e.target.value)}),document.addEventListener("change",e=>{"trayNumber"!==e.target.id&&"slotNumber"!==e.target.id||(this.updateTrayVisual(),this.updateCommandPreview())}),document.addEventListener("input",e=>{"commMessage"===e.target.id&&this.updateCommandPreview()}),document.addEventListener("input",e=>{"customCommand"!==e.target.id&&"customText"!==e.target.id||this.updateCommandPreview()}),document.addEventListener("click",e=>{if(e.target.classList.contains("example-cmd")){const t=e.target.dataset.cmd,a=document.getElementById("customCommand");a&&(a.value=t,this.updateCommandPreview())}}),document.addEventListener("click",e=>{if(e.target.classList.contains("insert-target-btn")||e.target.closest(".insert-target-btn")){e.preventDefault();const t=(e.target.classList.contains("insert-target-btn")?e.target:e.target.closest(".insert-target-btn")).closest(".input-with-button"),a=t?t.querySelector("input"):null;a&&this.insertTargetVariable(a)}}),document.addEventListener("change",e=>{["targetingCommand","combatCommand","powerCommand","movementCommand","cameraCommand","systemCommand","commCommand","aliasSelect"].includes(e.target.id)&&this.updateCommandPreview()})}handleCommandTypeChange(e){const t=document.getElementById("commandBuilder"),a=document.getElementById("modalCommandPreview"),n=document.getElementById("saveCommandBtn");if(t)if(e&&this.commandBuilders.has(e)){const a=this.commandBuilders.get(e).getUI();t.innerHTML=a,this.setupTypeSpecificListeners(e),n&&(n.disabled=!1),this.updateCommandPreview()}else t.innerHTML='<p class="text-muted">Select a command type to configure options.</p>',a&&(a.textContent="Select a command type to see preview"),n&&(n.disabled=!0)}setupTypeSpecificListeners(e){if("tray"===e){this.updateTrayVisual();const e=document.getElementById("trayCommandType");e&&(e.addEventListener("change",()=>{this.updateTrayConfigSections(e.value),this.updateCommandPreview()}),this.updateTrayConfigSections(e.value)),["trayNumber","slotNumber","backupTrayNumber","backupSlotNumber","activeState","startTrayNumber","startSlotNumber","endTrayNumber","endSlotNumber","backupStartTrayNumber","backupStartSlotNumber","backupEndTrayNumber","backupEndSlotNumber","trayCommandVariant"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("change",()=>{this.updateTrayVisual(),this.updateCommandPreview()})})}else if("power"===e){const e=document.getElementById("powerCommand");e&&e.addEventListener("change",()=>{this.showPowerWarning(e.value)})}else if("combat"===e){const e=document.getElementById("combatCommand");e&&e.addEventListener("change",()=>{this.showCombatWarning(e.value)})}else if("alias"===e){const e=document.getElementById("aliasSelect");e&&e.addEventListener("change",()=>{this.updateAliasPreview(e.value),this.updateCommandPreview()});const t=document.getElementById("openAliasManager");t&&t.addEventListener("click",()=>{"undefined"!=typeof stoAliases&&stoAliases.showAliasManager?stoAliases.showAliasManager():(stoUI.hideModal("addCommandModal"),stoUI.showModal("aliasManagerModal"))})}}updateTrayConfigSections(e){const t={singleTrayConfig:document.getElementById("singleTrayConfig"),backupConfig:document.getElementById("backupConfig"),rangeConfig:document.getElementById("rangeConfig"),backupRangeConfig:document.getElementById("backupRangeConfig"),commandTypeConfig:document.getElementById("commandTypeConfig")};switch(Object.values(t).forEach(e=>{e&&(e.style.display="none")}),e){case"custom_tray":case"whole_tray":t.singleTrayConfig&&(t.singleTrayConfig.style.display="block"),t.commandTypeConfig&&(t.commandTypeConfig.style.display="block");break;case"tray_with_backup":case"whole_tray_with_backup":t.singleTrayConfig&&(t.singleTrayConfig.style.display="block"),t.backupConfig&&(t.backupConfig.style.display="block");break;case"tray_range":t.rangeConfig&&(t.rangeConfig.style.display="block"),t.commandTypeConfig&&(t.commandTypeConfig.style.display="block");break;case"tray_range_with_backup":t.rangeConfig&&(t.rangeConfig.style.display="block"),t.backupRangeConfig&&(t.backupRangeConfig.style.display="block"),t.backupConfig&&(t.backupConfig.style.display="block")}}showPowerWarning(e){const t=document.getElementById("powerCommandWarning"),a=document.getElementById("powerWarningText");if(t&&a){if(e&&STO_DATA.commands.power.commands[e]){const n=STO_DATA.commands.power.commands[e];if(n.warning)return a.textContent=n.warning,void(t.style.display="block")}t.style.display="none"}}showCombatWarning(e){const t=document.getElementById("combatCommandWarning"),a=document.getElementById("combatWarningText");if(t&&a){if(e&&STO_DATA.commands.combat.commands[e]){const n=STO_DATA.commands.combat.commands[e];if(n.warning)return a.textContent=n.warning,void(t.style.display="block")}t.style.display="none"}}updateAliasPreview(e){const t=document.getElementById("aliasPreviewSection"),a=document.getElementById("selectedAliasPreview");if(t&&a)if(e){const n=app?.getCurrentProfile(),o=n?.aliases?.[e];o?(a.textContent=o.commands,t.style.display="block"):t.style.display="none"}else t.style.display="none"}updateCommandPreview(){const e=document.getElementById("modalCommandPreview");if(!e)return void console.log("DEBUG: modalCommandPreview element not found");const t=this.buildCurrentCommand();if(console.log("DEBUG: buildCurrentCommand returned:",t),t){if(Array.isArray(t)){console.log("DEBUG: Command is array with length:",t.length);const a=t.map(e=>e.command);console.log("DEBUG: Command strings:",a),e.textContent=a.join(" $$ ")}else console.log("DEBUG: Command is single object:",t.command),e.textContent=t.command;e.className="command-preview valid"}else console.log("DEBUG: No command returned, showing default message"),e.textContent="Configure command options to see preview",e.className="command-preview"}buildCurrentCommand(){const e=document.getElementById("commandType");if(!e||!e.value)return null;const t=e.value,a=this.commandBuilders.get(t);if(!a)return null;let n=null,o={};switch(t){case"targeting":n=document.getElementById("targetingCommand")?.value;break;case"combat":n=document.getElementById("combatCommand")?.value;break;case"tray":switch(n=document.getElementById("trayCommandType")?.value||"custom_tray",n){case"custom_tray":o={tray:parseInt(document.getElementById("trayNumber")?.value||0),slot:parseInt(document.getElementById("slotNumber")?.value||0),command_type:document.getElementById("trayCommandVariant")?.value||"STOTrayExecByTray"};break;case"tray_with_backup":o={tray:parseInt(document.getElementById("trayNumber")?.value||0),slot:parseInt(document.getElementById("slotNumber")?.value||0),backup_tray:parseInt(document.getElementById("backupTrayNumber")?.value||0),backup_slot:parseInt(document.getElementById("backupSlotNumber")?.value||0),active:parseInt(document.getElementById("activeState")?.value||1)};break;case"tray_range":o={start_tray:parseInt(document.getElementById("startTrayNumber")?.value||0),start_slot:parseInt(document.getElementById("startSlotNumber")?.value||0),end_tray:parseInt(document.getElementById("endTrayNumber")?.value||0),end_slot:parseInt(document.getElementById("endSlotNumber")?.value||0),command_type:document.getElementById("trayCommandVariant")?.value||"STOTrayExecByTray"};break;case"tray_range_with_backup":o={active:parseInt(document.getElementById("activeState")?.value||1),start_tray:parseInt(document.getElementById("startTrayNumber")?.value||0),start_slot:parseInt(document.getElementById("startSlotNumber")?.value||0),end_tray:parseInt(document.getElementById("endTrayNumber")?.value||0),end_slot:parseInt(document.getElementById("endSlotNumber")?.value||0),backup_start_tray:parseInt(document.getElementById("backupStartTrayNumber")?.value||0),backup_start_slot:parseInt(document.getElementById("backupStartSlotNumber")?.value||0),backup_end_tray:parseInt(document.getElementById("backupEndTrayNumber")?.value||0),backup_end_slot:parseInt(document.getElementById("backupEndSlotNumber")?.value||0)};break;case"whole_tray":o={tray:parseInt(document.getElementById("trayNumber")?.value||0),command_type:document.getElementById("trayCommandVariant")?.value||"STOTrayExecByTray"};break;case"whole_tray_with_backup":o={active:parseInt(document.getElementById("activeState")?.value||1),tray:parseInt(document.getElementById("trayNumber")?.value||0),backup_tray:parseInt(document.getElementById("backupTrayNumber")?.value||0)}}break;case"power":n=document.getElementById("powerCommand")?.value;break;case"movement":n=document.getElementById("movementCommand")?.value,"throttle_adjust"===n?o.amount=parseFloat(document.getElementById("movementAmount")?.value||.25):"throttle_set"===n&&(o.position=parseFloat(document.getElementById("movementPosition")?.value||1));break;case"camera":n=document.getElementById("cameraCommand")?.value,"cam_distance"===n&&(o.distance=parseInt(document.getElementById("cameraDistance")?.value||50));break;case"communication":n=document.getElementById("commCommand")?.value,o={message:document.getElementById("commMessage")?.value||"Message text here"};break;case"system":n=document.getElementById("systemCommand")?.value,"bind_save_file"===n||"bind_load_file"===n?o.filename=document.getElementById("systemFilename")?.value||"my_binds.txt":"combat_log"===n&&(o.state=parseInt(document.getElementById("systemState")?.value||1));break;case"alias":n="alias",o={alias_name:document.getElementById("aliasSelect")?.value||""};break;case"custom":n="custom",o={command:document.getElementById("customCommand")?.value||"",text:document.getElementById("customText")?.value||"Custom Command"}}return n||"custom"===t?a.build(n,o):null}updateTrayVisual(){const e=document.getElementById("trayVisual"),t=document.getElementById("trayNumber")?.value||0,a=document.getElementById("slotNumber")?.value||0;e&&(e.innerHTML=`\n            <div class="tray-grid">\n                <div class="tray-label">Tray ${parseInt(t)+1}</div>\n                <div class="slot-grid">\n                    ${Array.from({length:10},(e,t)=>`\n                        <div class="slot ${t==a?"selected":""}" data-slot="${t}">\n                            ${t+1}\n                        </div>\n                    `).join("")}\n                </div>\n            </div>\n        `,e.querySelectorAll(".slot").forEach(e=>{e.addEventListener("click",()=>{const t=document.getElementById("slotNumber");t&&(t.value=e.dataset.slot,this.updateTrayVisual(),this.updateCommandPreview())})}))}generateTrayRangeCommands(e,t,a,n,o){const i=[],s="STOTrayExecByTray"===o?"+":"";if(e===a)for(let a=t;a<=n;a++)i.push(`${s}${o} ${e} ${a}`);else{for(let a=t;a<=9;a++)i.push(`${s}${o} ${e} ${a}`);for(let t=e+1;t<a;t++)for(let e=0;e<=9;e++)i.push(`${s}${o} ${t} ${e}`);if(a>e)for(let e=0;e<=n;e++)i.push(`${s}${o} ${a} ${e}`)}return i}generateTrayRangeWithBackupCommands(e,t,a,n,o,i,s,r,c){const l=[],d=this.generateTraySlotList(t,a,n,o),m=this.generateTraySlotList(i,s,r,c);for(let t=0;t<Math.max(d.length,m.length);t++){const a=d[t]||d[d.length-1],n=m[t]||m[m.length-1];l.push(`TrayExecByTrayWithBackup ${e} ${a.tray} ${a.slot} ${n.tray} ${n.slot}`)}return l}generateWholeTrayCommands(e,t){const a=[],n="STOTrayExecByTray"===t?"+":"";for(let o=0;o<=9;o++)a.push(`${n}${t} ${e} ${o}`);return a}generateWholeTrayWithBackupCommands(e,t,a){const n=[];for(let o=0;o<=9;o++)n.push(`TrayExecByTrayWithBackup ${e} ${t} ${o} ${a} ${o}`);return n}generateTraySlotList(e,t,a,n){const o=[];if(e===a)for(let a=t;a<=n;a++)o.push({tray:e,slot:a});else{for(let a=t;a<=9;a++)o.push({tray:e,slot:a});for(let t=e+1;t<a;t++)for(let e=0;e<=9;e++)o.push({tray:t,slot:e});if(a>e)for(let e=0;e<=n;e++)o.push({tray:a,slot:e})}return o}getCurrentCommand(){return this.buildCurrentCommand()}validateCommand(e){if(Array.isArray(e)){for(let t=0;t<e.length;t++){const a=this.validateCommand(e[t]);if(!a.valid)return{valid:!1,error:`Command ${t+1}: ${a.error}`}}return{valid:!0}}let t;if("string"==typeof e)t=e;else{if(!e||!e.command)return{valid:!1,error:"No command provided"};t=e.command}if(!t||0===t.trim().length)return{valid:!1,error:"Command cannot be empty"};const a=t.trim();return["quit","exit","shutdown"].some(e=>a.toLowerCase().includes(e))?{valid:!1,error:"Dangerous command not allowed"}:this.hasUnquotedPipeCharacter(a)?{valid:!1,error:"Invalid characters in command (|)"}:{valid:!0}}hasUnquotedPipeCharacter(e){let t=!1,a=null;for(let n=0;n<e.length;n++){const o=e[n];if(t||'"'!==o&&"'"!==o){if(t&&o===a){let o=0;for(let t=n-1;t>=0&&"\\"===e[t];t--)o++;o%2==0&&(t=!1,a=null)}else if(!t&&"|"===o)return!0}else t=!0,a=o}return!1}getTemplateCommands(e){if(!STO_DATA.templates)return[];const t=[];return Object.entries(STO_DATA.templates).forEach(([a,n])=>{Object.entries(n).forEach(([n,o])=>{o.commands.some(t=>this.detectCommandType(t)===e)&&t.push({id:`${a}_${n}`,name:o.name,description:o.description,scenario:a,commands:o.commands.map(e=>({command:e,type:this.detectCommandType(e),icon:this.getCommandIcon(e),text:this.getCommandText(e)}))})})}),t}detectCommandType(e){if(!e||"string"!=typeof e)return"custom";const t=e.toLowerCase().trim();return t.includes("+stotrayexecbytray")?"tray":t.startsWith("say ")||t.startsWith("team ")||t.startsWith("zone ")||t.startsWith("tell ")||t.includes('"')?"communication":t.includes("+power_exec")||t.includes("distribute_shields")||t.includes("reroute_shields")?"power":t.includes("+fullimpulse")||t.includes("+reverse")||t.includes("throttle")||t.includes("+turn")||t.includes("+up")||t.includes("+down")||t.includes("+left")||t.includes("+right")||t.includes("+forward")||t.includes("+backward")||t.includes("follow")?"movement":t.includes("cam")||t.includes("look")||t.includes("zoom")?"camera":t.includes("fire")||t.includes("attack")||"fireall"===t||"firephasers"===t||"firetorps"===t||"firephaserstorps"===t?"combat":t.includes("target")||"target_enemy_near"===t||"target_self"===t||"target_friend_near"===t||"target_clear"===t?"targeting":t.includes("+gentoggle")||"screenshot"===t||t.includes("hud")||"interactwindow"===t?"system":"custom"}getCommandIcon(e){return{targeting:"üéØ",combat:"üî•",tray:"‚ö°",power:"üîã",communication:"üí¨",movement:"üöÄ",camera:"üìπ",system:"‚öôÔ∏è"}[this.detectCommandType(e)]||"‚öôÔ∏è"}getCommandText(e){if(e.includes("+STOTrayExecByTray")){const t=e.match(/\+STOTrayExecByTray\s+(\d+)\s+(\d+)/);if(t)return`Execute Tray ${parseInt(t[1])+1} Slot ${parseInt(t[2])+1}`}for(const[t,a]of Object.entries(STO_DATA.commands))for(const[t,n]of Object.entries(a.commands))if(n.command===e)return n.name;return e.replace(/[_+]/g," ").replace(/([A-Z])/g," $1").trim()}insertTargetVariable(e){const t=e.selectionStart,a=e.value,n=a.slice(0,t)+"$Target"+a.slice(t);e.value=n,e.setSelectionRange(t+7,t+7),e.focus(),e.dispatchEvent(new Event("input",{bubbles:!0}))}},me=new class{constructor(){this.modalId="fileExplorerModal",this.treeId="fileTree",this.contentId="fileContent"}init(){this.setupEventListeners()}setupEventListeners(){i.onDom("fileExplorerBtn","click","fileExplorer-open",()=>{this.openExplorer()}),i.onDom(this.treeId,"click","fileExplorer-tree-click",e=>{const t=e.target.closest(".tree-node");t&&this.selectNode(t)}),i.onDom("copyFileContentBtn","click","copyFileContent",()=>{const e=document.getElementById(this.contentId);if(!e)return;const t=e.textContent||"";t.trim()?(stoUI.copyToClipboard(t),stoUI.showToast("Content copied to clipboard","success")):stoUI.showToast("Nothing to copy","warning")})}openExplorer(){this.buildTree();const e=document.getElementById(this.contentId);e&&(e.textContent="Select an item on the left to preview export"),stoUI.showModal(this.modalId)}buildTree(){const e=document.getElementById(this.treeId);if(!e)return;e.innerHTML="";const t=stoStorage.getAllData().profiles||{};Object.entries(t).forEach(([t,a])=>{const n=this.createNode("profile",a.name,{profileId:t}),o=document.createElement("div");if(o.className="tree-children",a.builds&&a.builds.space){const e=this.createNode("build","Space Build",{profileId:t,environment:"space"});o.appendChild(e)}if(a.builds&&a.builds.ground){const e=this.createNode("build","Ground Build",{profileId:t,environment:"ground"});o.appendChild(e)}const i=this.createNode("aliases","Aliases",{profileId:t});o.appendChild(i),n.appendChild(o),e.appendChild(n)})}createNode(e,t,a={}){const n=document.createElement("div");return n.className=`tree-node ${e}`,n.textContent=t,n.dataset.type=e,Object.entries(a).forEach(([e,t])=>{n.setAttribute(`data-${e}`,t)}),n}selectNode(e){const t=document.querySelector(".tree-node.selected");t&&t.classList.remove("selected"),e.classList.add("selected");const a=e.dataset.type||e.getAttribute("data-type"),n=e.getAttribute("data-profileid"),o=e.getAttribute("data-environment");if(n)try{let e="";e="build"===a?this.generateBuildExport(n,o):"aliases"===a?this.generateAliasExport(n):"Select a Space/Ground build or Aliases to preview export.";const t=document.getElementById(this.contentId);t&&(t.textContent=e||"No content available.")}catch(e){console.error("Failed to generate export content:",e),stoUI.showToast("Failed to generate export","error")}}generateBuildExport(e,t){const a=stoStorage.getProfile(e);if(!a||!a.builds||!a.builds[t])return"";const n=a.builds[t],o={name:`${a.name} ${t}`,mode:t,keys:n.keys||{},keybindMetadata:a.keybindMetadata||{},aliases:n.aliases||{}};return stoExport.generateSTOKeybindFile(o,{environment:t})}generateAliasExport(e){const t=stoStorage.getProfile(e);if(!t)return"";const a={...t.aliases||{},...t.builds?.space?.aliases||{},...t.builds?.ground?.aliases||{}},n={name:t.name,mode:t.currentEnvironment||"space",aliases:a};return stoExport.generateAliasFile(n)}},ue=new class{constructor(){this.selectedEffects={space:new Set,ground:new Set},this.showPlayerSay=!1}generateAlias(e){if(!this.selectedEffects[e])throw new InvalidEnvironmentError(e);const t=Array.from(this.selectedEffects[e]);if(0===t.length)return"";let a=`alias dynFxSetFXExlusionList_${e.charAt(0).toUpperCase()+e.slice(1)} <& dynFxSetFXExlusionList ${t.join(",")}`;return this.showPlayerSay&&(a+=" $$ PlayerSay VFX Supression Loaded"),a+=" &>",a}getSelectedEffects(e){if(!this.selectedEffects[e])throw new InvalidEnvironmentError(e);return Array.from(this.selectedEffects[e])}toggleEffect(e,t){if(!this.selectedEffects[e])throw new InvalidEnvironmentError(e);if(!t)throw new InvalidEffectError(t,e);this.selectedEffects[e].has(t)?this.selectedEffects[e].delete(t):this.selectedEffects[e].add(t)}clearAllEffects(){this.selectedEffects.space.clear(),this.selectedEffects.ground.clear()}selectAllEffects(e){if(!ae[e])throw new InvalidEnvironmentError(e);if(!this.selectedEffects[e])throw new InvalidEnvironmentError(e);ae[e].forEach(t=>{this.selectedEffects[e].add(t.effect)})}getEffectCount(e){if(!this.selectedEffects[e])throw new InvalidEnvironmentError(e);return this.selectedEffects[e].size}isEffectSelected(e,t){if(!this.selectedEffects[e])throw new InvalidEnvironmentError(e);return this.selectedEffects[e].has(t)}saveState(e){e.vertigoSettings||(e.vertigoSettings={}),e.vertigoSettings={selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay}}loadState(e){if(e&&e.vertigoSettings){const t=e.vertigoSettings;this.selectedEffects.space=new Set(t.selectedEffects?.space||[]),this.selectedEffects.ground=new Set(t.selectedEffects?.ground||[]),this.showPlayerSay=t.showPlayerSay||!1}else this.selectedEffects.space.clear(),this.selectedEffects.ground.clear(),this.showPlayerSay=!1}};Object.assign(window,{stoStorage:ne,stoProfiles:oe,stoKeybinds:ie,stoAliases:se,stoExport:re,modalManager:ce,stoUI:le,stoCommands:de,stoFileExplorer:me,vertigoManager:ue,VFX_EFFECTS:ae,VERTIGO_EFFECTS:ae});const pe=new class{constructor(){this.store=te,this.eventListeners=new Map,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}get currentProfile(){return this.store.currentProfile}set currentProfile(e){this.store.currentProfile=e}get currentMode(){return this.store.currentMode}set currentMode(e){this.store.currentMode=e}get currentEnvironment(){return this.store.currentEnvironment}set currentEnvironment(e){this.store.currentEnvironment=e}get selectedKey(){return this.store.selectedKey}set selectedKey(e){this.store.selectedKey=e}get isModified(){return this.store.isModified}set isModified(e){this.store.isModified=e}get undoStack(){return this.store.undoStack}set undoStack(e){this.store.undoStack=e}get redoStack(){return this.store.redoStack}set redoStack(e){this.store.redoStack=e}get maxUndoSteps(){return this.store.maxUndoSteps}set maxUndoSteps(e){this.store.maxUndoSteps=e}get commandIdCounter(){return this.store.commandIdCounter}set commandIdCounter(e){this.store.commandIdCounter=e}async init(){try{if("undefined"==typeof stoStorage||"undefined"==typeof stoUI)throw new Error("Required dependencies not loaded");await this.loadData(),this.applyTheme(),this.setupEventListeners(),this.setupCommandLibrary(),this.setupDragAndDrop(),this.renderProfiles(),this.renderKeyGrid(),this.renderCommandChain();const e=stoStorage.getSettings();this.updateThemeToggleButton(e.theme||"default"),this.isFirstTime()&&this.showWelcomeMessage(),stoUI.showToast("STO Tools Keybind Manager loaded successfully","success"),i.emit("sto-app-ready",{app:this})}catch(e){console.error("Failed to initialize application:",e),"undefined"!=typeof stoUI&&stoUI.showToast&&stoUI.showToast("Failed to load application","error"),i.emit("sto-app-error",{error:e})}}async loadData(){const e=stoStorage.getAllData();this.currentProfile=e.currentProfile;const t=e.profiles[this.currentProfile];this.currentEnvironment=t&&t.currentEnvironment||"space",e.profiles[this.currentProfile]||(this.currentProfile=Object.keys(e.profiles)[0],this.saveCurrentProfile())}saveData(){const e=stoStorage.getAllData();return e.currentProfile=this.currentProfile,e.lastModified=(new Date).toISOString(),!!stoStorage.saveAllData(e)&&(this.setModified(!1),!0)}saveCurrentProfile(){const e=stoStorage.getAllData();return e.currentProfile=this.currentProfile,stoStorage.saveAllData(e)}setModified(e=!0){this.isModified=e;const t=document.getElementById("modifiedIndicator");t&&(t.style.display=e?"inline":"none")}getCurrentProfile(){const e=stoStorage.getProfile(this.currentProfile);return e?this.getCurrentBuild(e):null}getCurrentBuild(e){return e?(e.builds||(e.builds={space:{keys:e.keys||{}},ground:{keys:{}}},e.currentEnvironment=e.mode||"space",delete e.mode,delete e.keys,stoStorage.saveProfile(this.currentProfile,e)),e.builds||(e.builds={space:{keys:{}},ground:{keys:{}}}),e.builds[this.currentEnvironment]||(e.builds[this.currentEnvironment]={keys:{}}),e.builds[this.currentEnvironment].keys||(e.builds[this.currentEnvironment].keys={}),{...e,keys:e.builds[this.currentEnvironment].keys,aliases:e.aliases||{},mode:this.currentEnvironment}):null}switchProfile(e){if(e!==this.currentProfile){this.currentProfile=e,this.selectedKey=null;const t=stoStorage.getProfile(e);t&&(this.currentEnvironment=t.currentEnvironment||"space"),this.saveCurrentProfile(),this.renderKeyGrid(),this.renderCommandChain(),this.updateProfileInfo();const a=this.getCurrentProfile();stoUI.showToast(`Switched to profile: ${a.name} (${this.currentEnvironment})`,"success")}}createProfile(e,t="",a="space"){const n=this.generateProfileId(e),o={name:e,description:t,mode:a,keys:{},aliases:{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()};return stoStorage.saveProfile(n,o)?(this.switchProfile(n),this.renderProfiles(),stoUI.showToast(`Profile "${e}" created`,"success"),n):(stoUI.showToast("Failed to create profile","error"),null)}cloneProfile(e,t){const a=stoStorage.getProfile(e);if(!a)return null;const n=this.generateProfileId(t),o={...JSON.parse(JSON.stringify(a)),name:t,description:`Copy of ${a.name}`,created:(new Date).toISOString(),lastModified:(new Date).toISOString()};return stoStorage.saveProfile(n,o)?(this.renderProfiles(),stoUI.showToast(`Profile "${t}" created from "${a.name}"`,"success"),n):(stoUI.showToast("Failed to clone profile","error"),null)}deleteProfile(e){const t=stoStorage.getProfile(e);if(!t)return!1;const a=stoStorage.getAllData();if(Object.keys(a.profiles).length<=1)return stoUI.showToast("Cannot delete the last profile","warning"),!1;if(stoStorage.deleteProfile(e)){if(this.currentProfile===e){const e=Object.keys(stoStorage.getAllData().profiles);this.switchProfile(e[0])}return this.renderProfiles(),stoUI.showToast(`Profile "${t.name}" deleted`,"success"),!0}return stoUI.showToast("Failed to delete profile","error"),!1}generateProfileId(e){const t=e.toLowerCase().replace(/[^a-z0-9]/g,"_");let a=t,n=1;const o=stoStorage.getAllData();for(;o.profiles[a];)a=`${t}_${n}`,n++;return a}selectKey(e){this.selectedKey=e;const t=this.getCurrentProfile(),a=document.getElementById("stabilizeExecutionOrder");if(a&&t&&t.keybindMetadata){let n=!1;if(t.keybindMetadata[this.currentEnvironment]){const a=t.keybindMetadata[this.currentEnvironment];n=!(!a[e]||!a[e].stabilizeExecutionOrder)}!n&&t.keybindMetadata[e]&&(n=!!t.keybindMetadata[e].stabilizeExecutionOrder),a.checked=n}else a&&(a.checked=!1);this.renderKeyGrid(),this.renderCommandChain(),this.updateChainActions()}addKey(e){if(!this.isValidKeyName(e))return stoUI.showToast("Invalid key name","error"),!1;const t=this.getCurrentProfile();return t.keys[e]?(stoUI.showToast(`Key "${e}" already exists`,"warning"),!1):(t.keys[e]=[],stoStorage.saveProfile(this.currentProfile,t),this.renderKeyGrid(),this.selectKey(e),this.setModified(!0),stoUI.showToast(`Key "${e}" added`,"success"),!0)}deleteKey(e){const t=this.getCurrentProfile();return!!t.keys[e]&&(delete t.keys[e],stoStorage.saveProfile(this.currentProfile,t),this.selectedKey===e&&(this.selectedKey=null),this.renderKeyGrid(),this.renderCommandChain(),this.setModified(!0),stoUI.showToast(`Key "${e}" deleted`,"success"),!0)}isValidKeyName(e){return STO_DATA.validation.keyNamePattern.test(e)&&e.length<=20}addCommand(e,t){const a=this.getCurrentProfile();a.keys[e]||(a.keys[e]=[]),Array.isArray(t)?(t.forEach(t=>{t.id||(t.id=this.generateCommandId()),a.keys[e].push(t)}),stoUI.showToast(`${t.length} commands added`,"success")):(t.id||(t.id=this.generateCommandId()),a.keys[e].push(t),stoUI.showToast("Command added","success")),stoStorage.saveProfile(this.currentProfile,a),this.renderCommandChain(),this.renderKeyGrid(),this.setModified(!0)}deleteCommand(e,t){const a=this.getCurrentProfile();a.keys[e]&&a.keys[e][t]&&(a.keys[e].splice(t,1),stoStorage.saveProfile(this.currentProfile,a),this.renderCommandChain(),this.renderKeyGrid(),this.setModified(!0),stoUI.showToast("Command deleted","success"))}moveCommand(e,t,a){const n=this.getCurrentProfile(),o=n.keys[e];if(o&&t>=0&&t<o.length&&a>=0&&a<o.length){const[e]=o.splice(t,1);o.splice(a,0,e),stoStorage.saveProfile(this.currentProfile,n),this.renderCommandChain(),this.setModified(!0)}}generateCommandId(){return"cmd_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}renderProfiles(){const e=document.getElementById("profileSelect");if(!e)return;const t=stoStorage.getAllData();if(e.innerHTML="",0===Object.keys(t.profiles).length){const t=document.createElement("option");t.value="",t.textContent="No profiles available",t.disabled=!0,e.appendChild(t)}else Object.entries(t.profiles).forEach(([t,a])=>{const n=document.createElement("option");n.value=t,n.textContent=a.name,t===this.currentProfile&&(n.selected=!0),e.appendChild(n)});this.updateProfileInfo()}updateProfileInfo(){const e=this.getCurrentProfile();document.querySelectorAll(".mode-btn").forEach(t=>{t.classList.toggle("active",e&&t.dataset.mode===this.currentEnvironment),t.disabled=!e});const t=document.getElementById("keyCount");if(t)if(e){const a=Object.keys(e.keys).length;t.textContent=`${a} key${1!==a?"s":""}`}else t.textContent="No profile"}renderKeyGrid(){const e=document.getElementById("keyGrid");if(!e)return;const t=this.getCurrentProfile();if(!t)return;if(e.innerHTML="",!t)return void(e.innerHTML='\n                <div class="empty-state">\n                    <i class="fas fa-folder-open"></i>\n                    <h4>No Profile Selected</h4>\n                    <p>Create a new profile or load default data to get started.</p>\n                </div>\n            ');const a=Object.keys(t.keys),n=[...new Set([...a,"Space","1","2","3","4","5","F1","F2","F3","F4"])].sort(),o=localStorage.getItem("keyViewMode")||"key-types";"categorized"===o?this.renderCategorizedKeyView(e,t,n):"key-types"===o?this.renderKeyTypeView(e,t,n):this.renderSimpleKeyGrid(e,n),this.updateViewToggleButton(o);const i=document.getElementById("keyFilter");i&&i.value.trim()&&this.filterKeys(i.value.trim())}renderSimpleKeyGrid(e,t){e.classList.remove("categorized"),t.forEach(t=>{const a=this.createKeyElement(t);e.appendChild(a)})}renderCategorizedKeyView(e,t,a){e.classList.add("categorized");const n=this.categorizeKeys(t.keys,a);Object.entries(n).sort(([e,t],[a,n])=>t.priority!==n.priority?t.priority-n.priority:t.name.localeCompare(n.name)).forEach(([t,a])=>{const n=this.createKeyCategoryElement(t,a);e.appendChild(n)})}categorizeKeys(e,t){const a={};return a.unknown={name:"Unknown",icon:"fas fa-question-circle",keys:new Set,priority:0},Object.entries(STO_DATA.commands).forEach(([e,t])=>{a[e]={name:t.name,icon:t.icon,keys:new Set,priority:1}}),t.forEach(t=>{const n=e[t]||[];if(!n||0===n.length)return void a.unknown.keys.add(t);const o=new Set;n.forEach(e=>{if(e.type&&a[e.type])o.add(e.type);else if(window.stoCommands){const t=window.stoCommands.detectCommandType(e.command);a[t]&&o.add(t)}}),o.size>0?o.forEach(e=>{a[e].keys.add(t)}):(a.custom||(a.custom={name:"Custom Commands",icon:"fas fa-cog",keys:new Set,priority:2}),a.custom.keys.add(t))}),Object.values(a).forEach(e=>{e.keys=Array.from(e.keys).sort(this.compareKeys.bind(this))}),a}createKeyCategoryElement(e,t,a="command"){const n=document.createElement("div");n.className="category",n.dataset.category=e;const o="key-type"===a?`keyTypeCategory_${e}_collapsed`:`keyCategory_${e}_collapsed`,i="true"===localStorage.getItem(o);return n.innerHTML=`\n            <h4 class="${i?"collapsed":""}" data-category="${e}" data-mode="${a}">\n                <i class="fas fa-chevron-right category-chevron"></i>\n                <i class="${t.icon}"></i> \n                ${t.name} \n                <span class="key-count">(${t.keys.length})</span>\n            </h4>\n            <div class="category-commands ${i?"collapsed":""}">\n                ${t.keys.map(e=>this.createKeyElementHTML(e)).join("")}\n            </div>\n        `,n.querySelector("h4").addEventListener("click",()=>{this.toggleKeyCategory(e,n,a)}),n.querySelectorAll(".command-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.key;this.selectKey(t)})}),n}createKeyElementHTML(e){const t=this.getCurrentProfile().keys[e]||[],a=this.selectedKey===e,n=e.length;let o;return o=n<=6?"short":n<=12?"medium":"long",`\n            <div class="command-item ${a?"active":""}" data-key="${e}" data-length="${o}">\n                <span class="key-label">${e}</span>\n                ${t.length>0?`\n                    <span class="command-count-badge">${t.length}</span>\n                `:""}\n            </div>\n        `}toggleKeyCategory(e,t,a="command"){const n=t.querySelector("h4"),o=t.querySelector(".category-commands"),i=n.querySelector(".category-chevron"),s="key-type"===a?`keyTypeCategory_${e}_collapsed`:`keyCategory_${e}_collapsed`;o.classList.contains("collapsed")?(o.classList.remove("collapsed"),n.classList.remove("collapsed"),i.style.transform="rotate(90deg)",localStorage.setItem(s,"false")):(o.classList.add("collapsed"),n.classList.add("collapsed"),i.style.transform="rotate(0deg)",localStorage.setItem(s,"true"))}formatKeyName(e){return e.includes("+")?e.replace(/\+/g,"<br>+<br>"):e}detectKeyTypes(e){const t=[];e.includes("+")&&e.split("+").some(e=>e.match(/^(Ctrl|Control|Alt|Shift|Win|Cmd|Super)$/i))&&t.push("modifiers");const a=e.split("+").pop();return a.match(/^F\d+$/)?t.push("function"):a.match(/^(Lbutton|Rbutton|Mbutton|Leftdrag|Rightdrag|Middledrag|Leftclick|Rightclick|Middleclick|Leftdoubleclick|Rightdoubleclick|Middledoubleclick|Wheelplus|Wheelminus|Mousechord|Mouse|Wheel|LMouse|RMouse|MMouse|XMouse|Drag)/i)?t.push("mouse"):a.match(/^(Numpad|Keypad)/i)?t.push("numberpad"):a.match(/^(Ctrl|Control|Alt|Shift|Win|Cmd|Super)$/i)?t.includes("modifiers")||t.push("modifiers"):a.match(/^(Up|Down|Left|Right|Home|End|PageUp|PageDown|Insert|Delete)$/i)?t.push("navigation"):a.match(/^(Space|Tab|Enter|Return|Escape|Esc|Backspace|CapsLock|ScrollLock|NumLock|PrintScreen|Pause|Break)$/i)?t.push("system"):a.match(/^[0-9]$/)||a.match(/^[A-Za-z]$/)?t.push("alphanumeric"):a.match(/^[`~!@#$%^&*()_+\-=\[\]{}\\|;':",./<>?]$/)||a.match(/^(Comma|Period|Semicolon|Quote|Slash|Backslash|Minus|Plus|Equals|Bracket|Grave|Tilde)$/i)?t.push("symbols"):t.push("other"),t.length>0?t:["other"]}categorizeKeysByType(e,t){const a={function:{name:"Function Keys",icon:"fas fa-keyboard",keys:new Set,priority:1},alphanumeric:{name:"Letters & Numbers",icon:"fas fa-font",keys:new Set,priority:2},numberpad:{name:"Numberpad",icon:"fas fa-calculator",keys:new Set,priority:3},modifiers:{name:"Modifier Keys",icon:"fas fa-hand-paper",keys:new Set,priority:4},navigation:{name:"Navigation",icon:"fas fa-arrows-alt",keys:new Set,priority:5},system:{name:"System Keys",icon:"fas fa-cogs",keys:new Set,priority:6},mouse:{name:"Mouse & Wheel",icon:"fas fa-mouse",keys:new Set,priority:7},symbols:{name:"Symbols & Punctuation",icon:"fas fa-at",keys:new Set,priority:8},other:{name:"Other Keys",icon:"fas fa-question-circle",keys:new Set,priority:9}};return t.forEach(e=>{this.detectKeyTypes(e).forEach(t=>{a[t]?a[t].keys.add(e):a.other.keys.add(e)})}),Object.values(a).forEach(e=>{e.keys=Array.from(e.keys).sort(this.compareKeys.bind(this))}),a}renderKeyTypeView(e,t,a){e.classList.add("categorized");const n=this.categorizeKeysByType(t.keys,a);Object.entries(n).sort(([e,t],[a,n])=>t.priority-n.priority).forEach(([t,a])=>{const n=this.createKeyCategoryElement(t,a,"key-type");e.appendChild(n)})}compareKeys(e,t){const a=e=>"Space"===e?0:e.match(/^[0-9]$/)?1:e.match(/^F[0-9]+$/)?2:e.includes("Ctrl+")?3:e.includes("Alt+")?4:e.includes("Shift+")?5:6,n=a(e),o=a(t);return n!==o?n-o:e.localeCompare(t)}createKeyElement(e){const t=this.getCurrentProfile().keys[e]||[],a=e===this.selectedKey,n=document.createElement("div");n.className="key-item "+(a?"active":""),n.dataset.key=e,n.title=`${e}: ${t.length} command${1!==t.length?"s":""}`;const o=this.formatKeyName(e);let i;if(o.includes("<br>")){const t=e.split("+"),a=Math.max(...t.map(e=>e.length));i=a<=4?"short":a<=8?"medium":"long"}else{const t=e.length;i=t<=3?"short":t<=5?"medium":t<=8?"long":"extra-long"}return n.dataset.length=i,n.innerHTML=`\n            <div class="key-label">${o}</div>\n            ${t.length>0?`\n                <div class="activity-bar" style="width: ${Math.min(15*t.length,100)}%"></div>\n                <div class="command-count-badge">${t.length}</div>\n            `:""}\n        `,n.addEventListener("click",()=>{this.selectKey(e)}),n}updateViewToggleButton(e){const t=document.getElementById("toggleKeyViewBtn");if(t){const a=t.querySelector("i");"categorized"===e?(a.className="fas fa-sitemap",t.title="Switch to key type view"):"key-types"===e?(a.className="fas fa-th",t.title="Switch to grid view"):(a.className="fas fa-list",t.title="Switch to command categories")}}toggleKeyView(){const e=localStorage.getItem("keyViewMode")||"key-types";let t;t="key-types"===e?"grid":"grid"===e?"categorized":"key-types",localStorage.setItem("keyViewMode",t),this.renderKeyGrid()}renderCommandChain(){const e=document.getElementById("commandList"),t=document.getElementById("chainTitle"),a=document.getElementById("commandPreview"),n=document.getElementById("commandCount"),o=document.getElementById("emptyState");if(!e||!t||!a)return;if(!this.selectedKey){if(t.textContent="Select a key to edit",a.textContent="Select a key to see the generated command",n)if(n.querySelector('[data-i18n="commands"]')){const e="undefined"!=typeof i18next?i18next.t("commands"):"commands";n.innerHTML=`0 <span data-i18n="commands">${e}</span>`}else n.textContent="0 commands";return o&&(o.style.display="block"),void(e.innerHTML='<div class="empty-state" id="emptyState"><i class="fas fa-keyboard"></i><h4>No Key Selected</h4><p>Select a key from the left panel to view and edit its command chain.</p></div>')}const i=this.getCurrentProfile().keys[this.selectedKey]||[];if(t.textContent=`Command Chain for ${this.selectedKey}`,n)if(n.querySelector('[data-i18n="commands"]')){const e="undefined"!=typeof i18next?i18next.t("commands"):"commands";n.innerHTML=`${i.length} <span data-i18n="commands">${e}</span>`}else n.textContent=`${i.length} command${1!==i.length?"s":""}`;if(0===i.length)e.innerHTML=`\n                <div class="empty-state">\n                    <i class="fas fa-plus-circle"></i>\n                    <h4>No Commands</h4>\n                    <p>Click "Add Command" to start building your command chain for ${this.selectedKey}.</p>\n                </div>\n            `,a.textContent=`${this.selectedKey} ""`;else{e.innerHTML="",i.forEach((t,a)=>{const n=this.createCommandElement(t,a);e.appendChild(n)});const t=document.getElementById("stabilizeExecutionOrder");let n;n=t&&t.checked&&i.length>1?stoKeybinds.generateMirroredCommandString(i):i.map(e=>e.command).join(" $$ "),a.textContent=`${this.selectedKey} "${n}"`}}createCommandElement(e,t){const a=document.createElement("div");a.className="command-item-row",a.dataset.index=t,a.draggable=!0;const n=this.findCommandDefinition(e),o=n&&n.customizable;let i=e.text,s=e.icon;if(n)if(i=n.name,s=n.icon,o&&e.parameters){if("tray_with_backup"===n.commandId){const t=e.parameters;i=`${n.name} (${t.active} ${t.tray} ${t.slot} ${t.backup_tray} ${t.backup_slot})`}else if("custom_tray"===n.commandId){const t=e.parameters;i=`${n.name} (${t.tray} ${t.slot})`}else if("target"===n.commandId){const t=e.parameters;i=`${n.name}: ${t.entityName}`}}else if(o)if(e.command.includes("TrayExecByTrayWithBackup")){const t=e.command.split(" ");t.length>=6&&(i=`${n.name} (${t[1]} ${t[2]} ${t[3]} ${t[4]} ${t[5]})`)}else if(e.command.includes("TrayExec")){const t=e.command.replace("+","").split(" ");t.length>=3&&(i=`${n.name} (${t[1]} ${t[2]})`)}else if(e.command.includes("Target ")){const t=e.command.match(/Target "([^"]+)"/);t&&(i=`${n.name}: ${t[1]}`)}o&&(a.dataset.parameters="true",a.classList.add("customizable"));const r=this.getCommandWarning(e),c=r?`<span class="command-warning-icon" title="${r}"><i class="fas fa-exclamation-triangle"></i></span>`:"",l=o?' <span class="param-indicator" title="Editable parameters">‚öôÔ∏è</span>':"";return a.innerHTML=`\n            <div class="command-number">${t+1}</div>\n            <div class="command-content">\n                <span class="command-icon">${s}</span>\n                <span class="command-text">${i}${l}</span>\n                ${c}\n            </div>\n            <span class="command-type ${e.type}">${e.type}</span>\n            <div class="command-actions">\n                <button class="btn btn-small-icon" onclick="app.editCommand(${t})" title="Edit Command">\n                    <i class="fas fa-edit"></i>\n                </button>\n                <button class="btn btn-small-icon btn-danger" onclick="app.deleteCommand('${this.selectedKey}', ${t})" title="Delete Command">\n                    <i class="fas fa-times"></i>\n                </button>\n                <button class="btn btn-small-icon" onclick="app.moveCommand('${this.selectedKey}', ${t}, ${t-1})" \n                        title="Move Up" ${0===t?"disabled":""}>\n                    <i class="fas fa-chevron-up"></i>\n                </button>\n                <button class="btn btn-small-icon" onclick="app.moveCommand('${this.selectedKey}', ${t}, ${t+1})" \n                        title="Move Down" ${t===this.getCurrentProfile().keys[this.selectedKey].length-1?"disabled":""}>\n                    <i class="fas fa-chevron-down"></i>\n                </button>\n            </div>\n        `,a}getCommandWarning(e){const t=STO_DATA.commands;for(const[a,n]of Object.entries(t))for(const[t,a]of Object.entries(n.commands))if(a.command===e.command||a.name===e.text||e.command.includes(a.command))return a.warning||null;return null}setupCommandLibrary(){const e=document.getElementById("commandCategories");e&&(e.innerHTML="",Object.entries(STO_DATA.commands).forEach(([t,a])=>{const n=this.createCategoryElement(t,a);e.appendChild(n)}),this.filterCommandLibrary())}createCategoryElement(e,t){const a=document.createElement("div");a.className="category",a.dataset.category=e;const n=`commandCategory_${e}_collapsed`,o="true"===localStorage.getItem(n);return a.innerHTML=`\n            <h4 class="${o?"collapsed":""}" data-category="${e}">\n                <i class="fas fa-chevron-right category-chevron"></i>\n                <i class="${t.icon}"></i> \n                ${t.name}\n                <span class="command-count">(${Object.keys(t.commands).length})</span>\n            </h4>\n            <div class="category-commands ${o?"collapsed":""}">\n                ${Object.entries(t.commands).map(([e,t])=>`\n                    <div class="command-item ${t.customizable?"customizable":""}" data-command="${e}" title="${t.description}${t.customizable?" (Customizable)":""}">\n                        ${t.icon} ${t.name}${t.customizable?' <span class="param-indicator">‚öôÔ∏è</span>':""}\n                    </div>\n                `).join("")}\n            </div>\n        `,a.querySelector("h4").addEventListener("click",()=>{this.toggleCommandCategory(e,a)}),a.addEventListener("click",t=>{if(t.target.classList.contains("command-item")){const a=t.target.dataset.command;this.addCommandFromLibrary(e,a)}}),a}toggleCommandCategory(e,t){const a=t.querySelector("h4"),n=t.querySelector(".category-commands"),o=a.querySelector(".category-chevron"),i=`commandCategory_${e}_collapsed`;n.classList.contains("collapsed")?(n.classList.remove("collapsed"),a.classList.remove("collapsed"),o.style.transform="rotate(90deg)",localStorage.setItem(i,"false")):(n.classList.add("collapsed"),a.classList.add("collapsed"),o.style.transform="rotate(0deg)",localStorage.setItem(i,"true"))}addCommandFromLibrary(e,t){if(!this.selectedKey)return void stoUI.showToast("Please select a key first","warning");const a=STO_DATA.commands[e].commands[t];if(!a)return;if(a.customizable&&a.parameters)return void this.showParameterModal(e,t,a);const n={command:a.command,type:e,icon:a.icon,text:a.name,id:this.generateCommandId()};this.addCommand(this.selectedKey,n)}setupDragAndDrop(){const e=document.getElementById("commandList");e&&stoUI.initDragAndDrop(e,{dragSelector:".command-item-row",dropZoneSelector:".command-item-row",onDrop:(e,t,a)=>{if(!this.selectedKey)return;const n=parseInt(t.dragElement.dataset.index),o=parseInt(a.dataset.index);n!==o&&this.moveCommand(this.selectedKey,n,o)}})}updateChainActions(){const e=!!this.selectedKey;["addCommandBtn","addFromTemplateBtn","importFromKeyBtn","deleteKeyBtn","duplicateKeyBtn"].forEach(t=>{const a=document.getElementById(t);a&&(a.disabled=!e)})}setupEventListeners(){const e=document.getElementById("profileSelect");e?.addEventListener("change",e=>{this.switchProfile(e.target.value)}),document.querySelectorAll(".mode-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.mode;this.switchMode(t)})}),i.onDom("openProjectBtn","click","project-open",()=>{this.openProject()}),i.onDom("saveProjectBtn","click","project-save",()=>{this.saveProject()}),i.onDom("exportKeybindsBtn","click","keybinds-export",()=>{this.exportKeybinds()}),i.onDom("vertigoBtn","click","vertigo-open",()=>{this.showVertigoModal()}),i.onDom("addKeyBtn","click","key-add",()=>{this.showKeySelectionModal()}),i.onDom("deleteKeyBtn","click","key-delete",()=>{this.selectedKey&&this.confirmDeleteKey(this.selectedKey)}),i.onDom("duplicateKeyBtn","click","key-duplicate",()=>{this.selectedKey&&this.duplicateKey(this.selectedKey)}),i.onDom("addCommandBtn","click","command-add",()=>{modalManager.show("addCommandModal")}),i.onDom("addFromTemplateBtn","click","command-add-template",()=>{this.showTemplateModal()}),i.onDom("clearChainBtn","click","command-chain-clear",()=>{this.selectedKey&&this.confirmClearChain(this.selectedKey)}),i.onDom("validateChainBtn","click","command-chain-validate",()=>{this.validateCurrentChain()}),i.onDom("stabilizeExecutionOrder","change","stabilize-change",e=>{if(this.selectedKey){const t=this.currentEnvironment,a=stoStorage.getProfile(this.currentProfile);a&&(a.keybindMetadata||(a.keybindMetadata={}),a.keybindMetadata[t]||(a.keybindMetadata[t]={}),a.keybindMetadata[t][this.selectedKey]||(a.keybindMetadata[t][this.selectedKey]={}),a.keybindMetadata[t][this.selectedKey].stabilizeExecutionOrder=e.target.checked,stoStorage.saveProfile(this.currentProfile,a),this.setModified(!0))}this.renderCommandChain()}),i.onDom("keyFilter","input","key-filter",e=>{this.filterKeys(e.target.value)}),i.onDom("commandSearch","input","command-search",e=>{this.filterCommands(e.target.value)}),i.onDom("showAllKeysBtn","click","show-all-keys",()=>{this.showAllKeys()}),i.onDom("toggleKeyViewBtn","click","toggle-key-view",()=>{this.toggleKeyView()}),i.onDom("toggleLibraryBtn","click","toggle-library",()=>{this.toggleLibrary()}),this.setupModalHandlers(),setInterval(()=>{this.isModified&&this.saveData()},3e4)}setupModalHandlers(){i.onDom("confirmAddKeyBtn","click","key-add-confirm",()=>{const e=document.getElementById("newKeyName")?.value.trim();e&&(this.addKey(e),modalManager.hide("addKeyModal"))}),document.querySelectorAll(".key-suggestion").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.key,a=document.getElementById("newKeyName");a&&(a.value=t)})}),i.onDom("saveCommandBtn","click","command-save",()=>{this.saveCommandFromModal()}),document.querySelectorAll(".modal-close, [data-modal]").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.modal||e.target.closest("button").dataset.modal;t&&(modalManager.hide(t),"vertigoModal"===t&&(this.vertigoInitialState&&!this.vertigoSaving&&(vertigoManager.selectedEffects.space=new Set(this.vertigoInitialState.selectedEffects.space),vertigoManager.selectedEffects.ground=new Set(this.vertigoInitialState.selectedEffects.ground),vertigoManager.showPlayerSay=this.vertigoInitialState.showPlayerSay),delete this.vertigoInitialState,this.vertigoSaving=!1))})})}saveProfile(){const e=this.getCurrentProfile();if(!e)return;this.saveCurrentBuild();const t=stoStorage.getProfile(this.currentProfile);if(!t)return;const a={...t,name:e.name,description:e.description||t.description,aliases:e.aliases||{},keybindMetadata:e.keybindMetadata||t.keybindMetadata,created:t.created,lastModified:(new Date).toISOString(),currentEnvironment:this.currentEnvironment};stoStorage.saveProfile(this.currentProfile,a)}switchMode(e){if(this.currentEnvironment!==e){this.saveCurrentBuild(),this.currentEnvironment=e;const t=stoStorage.getProfile(this.currentProfile);t&&(t.currentEnvironment=e,stoStorage.saveProfile(this.currentProfile,t)),this.updateModeButtons(),this.updateProfileInfo(),this.renderKeyGrid(),this.renderCommandChain(),this.filterCommandLibrary(),this.setModified(!0),stoUI.showToast(`Switched to ${e} mode`,"success")}}updateModeButtons(){const e=document.querySelector('[data-mode="space"]'),t=document.querySelector('[data-mode="ground"]');e&&t&&(e.classList.toggle("active","space"===this.currentEnvironment),t.classList.toggle("active","ground"===this.currentEnvironment))}saveCurrentBuild(){const e=stoStorage.getProfile(this.currentProfile),t=this.getCurrentProfile();e&&t&&(e.builds||(e.builds={space:{keys:{}},ground:{keys:{}}}),e.builds[this.currentEnvironment]={keys:t.keys||{}},stoStorage.saveProfile(this.currentProfile,e))}async confirmDeleteKey(e){await stoUI.confirm(`Are you sure you want to delete the key "${e}" and all its commands?`,"Delete Key","danger")&&this.deleteKey(e)}async confirmClearChain(e){await stoUI.confirm(`Are you sure you want to clear all commands for "${e}"?`,"Clear Commands","warning")&&(this.getCurrentProfile().keys[e]=[],this.saveCurrentBuild(),this.renderCommandChain(),this.renderKeyGrid(),this.setModified(!0),stoUI.showToast(`Commands cleared for ${e}`,"success"))}openProject(){const e=document.getElementById("fileInput");e.accept=".json",e.onchange=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{try{stoStorage.importData(e.target.result)?(this.loadData(),this.renderProfiles(),this.renderKeyGrid(),this.renderCommandChain(),stoUI.showToast("Project loaded successfully","success")):stoUI.showToast("Failed to load project file","error")}catch(e){stoUI.showToast("Invalid project file","error")}},e.readAsText(t)}},e.click()}saveProject(){const e=stoStorage.exportData(),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="sto_keybinds.json",n.click(),URL.revokeObjectURL(a),stoUI.showToast("Project exported successfully","success")}exportKeybinds(){const e=this.getCurrentProfile();if(!e)return;const t=stoExport.generateSTOKeybindFile(e,{environment:this.currentEnvironment}),a=new Blob([t],{type:"text/plain"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n;const i=e.name.replace(/[^a-zA-Z0-9]/g,"_");o.download=`${i}_${this.currentEnvironment}_keybinds.txt`,o.click(),URL.revokeObjectURL(n),stoUI.showToast(`${this.currentEnvironment} keybinds exported successfully`,"success")}isFirstTime(){return!localStorage.getItem("sto_keybind_manager_visited")}showWelcomeMessage(){localStorage.setItem("sto_keybind_manager_visited","true"),modalManager.show("aboutModal")}duplicateKey(e){const t=this.getCurrentProfile(),a=t.keys[e];if(!a||0===a.length)return void stoUI.showToast("No commands to duplicate","warning");let n=e+"_copy",o=1;for(;t.keys[n];)n=`${e}_copy_${o}`,o++;const i=a.map(e=>({...e,id:this.generateCommandId()}));t.keys[n]=i,stoStorage.saveProfile(this.currentProfile,t),this.renderKeyGrid(),this.setModified(!0),stoUI.showToast(`Key "${e}" duplicated as "${n}"`,"success")}showTemplateModal(){stoUI.showToast("Template system coming soon","info")}validateCurrentChain(){if(!this.selectedKey)return void stoUI.showToast("No key selected","warning");const e=this.getCurrentProfile().keys[this.selectedKey]||[];if(0===e.length)return void stoUI.showToast("No commands to validate","warning");const t=stoKeybinds.validateKeybind(this.selectedKey,e);if(t.valid)stoUI.showToast("Command chain is valid","success");else{const e="Validation errors:\n"+t.errors.join("\n");stoUI.showToast(e,"error",5e3)}}filterKeys(e){const t=e.toLowerCase();document.querySelectorAll(".key-item").forEach(a=>{const n=a.dataset.key.toLowerCase(),o=!e||n.includes(t);a.style.display=o?"flex":"none"}),document.querySelectorAll(".command-item[data-key]").forEach(a=>{const n=a.dataset.key.toLowerCase(),o=!e||n.includes(t);a.style.display=o?"flex":"none"}),document.querySelectorAll(".category").forEach(t=>{const a=t.querySelectorAll('.command-item[data-key]:not([style*="display: none"])'),n=!e||a.length>0;t.style.display=n?"block":"none"})}filterCommands(e){const t=document.querySelectorAll(".command-item"),a=e.toLowerCase();t.forEach(t=>{const n=t.textContent.toLowerCase(),o=!e||n.includes(a);t.style.display=o?"flex":"none"}),document.querySelectorAll(".category").forEach(t=>{const a=t.querySelectorAll('.command-item:not([style*="display: none"])'),n=!e||a.length>0;t.style.display=n?"block":"none"})}showAllKeys(){document.querySelectorAll(".key-item").forEach(e=>{e.style.display="flex"}),document.querySelectorAll(".command-item[data-key]").forEach(e=>{e.style.display="flex"}),document.querySelectorAll(".category").forEach(e=>{e.style.display="block"});const e=document.getElementById("keyFilter");e&&(e.value="")}toggleLibrary(){const e=document.getElementById("libraryContent"),t=document.getElementById("toggleLibraryBtn");if(e&&t){const a="none"===e.style.display;e.style.display=a?"block":"none";const n=t.querySelector("i");n&&(n.className=a?"fas fa-chevron-up":"fas fa-chevron-down")}}saveCommandFromModal(){if(!this.selectedKey)return void stoUI.showToast("Please select a key first","warning");const e=stoCommands.getCurrentCommand();if(!e)return void stoUI.showToast("Please configure a command","warning");const t=stoCommands.validateCommand(e);t.valid?(this.addCommand(this.selectedKey,e),modalManager.hide("addCommandModal")):stoUI.showToast(t.error,"error")}showParameterModal(e,t,a){this.currentParameterCommand={categoryId:e,commandId:t,commandDef:a},document.getElementById("parameterModal")||this.createParameterModal(),this.populateParameterModal(a),modalManager.show("parameterModal")}createParameterModal(){const e=document.createElement("div");e.className="modal",e.id="parameterModal",e.innerHTML='\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3 id="parameterModalTitle">Configure Command Parameters</h3>\n                    <button class="modal-close" data-modal="parameterModal">\n                        <i class="fas fa-times"></i>\n                    </button>\n                </div>\n                <div class="modal-body">\n                    <div id="parameterInputs">\n                        \x3c!-- Parameter inputs will be populated here --\x3e\n                    </div>\n                    <div class="command-preview-modal">\n                        <label>Generated Command:</label>\n                        <div class="command-preview" id="parameterCommandPreview">\n                            \x3c!-- Command preview will be shown here --\x3e\n                        </div>\n                    </div>\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary" id="saveParameterCommandBtn">Add Command</button>\n                    <button class="btn btn-secondary" data-modal="parameterModal">Cancel</button>\n                </div>\n            </div>\n        ',document.body.appendChild(e),i.onDom("saveParameterCommandBtn","click","parameter-command-save",()=>{this.saveParameterCommand()}),e.querySelectorAll('.modal-close, [data-modal="parameterModal"]').forEach(e=>{e.addEventListener("click",()=>{this.cancelParameterCommand()})})}cancelParameterCommand(){this.currentParameterCommand=null;const e=document.getElementById("saveParameterCommandBtn");e&&(e.textContent="Add Command"),modalManager.hide("parameterModal")}populateParameterModal(e){const t=document.getElementById("parameterInputs");document.getElementById("parameterModalTitle").textContent=`Configure: ${e.name}`,t.innerHTML="",Object.entries(e.parameters).forEach(([e,a])=>{const n=document.createElement("div");n.className="form-group";const o=document.createElement("label");let i;if(o.textContent=this.formatParameterName(e),o.setAttribute("for",`param_${e}`),"message"===e){const t=document.createElement("div");t.className="input-with-button",i=document.createElement("input"),i.type="text",i.id=`param_${e}`,i.name=e,i.value=a.default||"",a.placeholder&&(i.placeholder=a.placeholder);const s=document.createElement("button");s.type="button",s.className="btn btn-small insert-target-btn",s.title="Insert $Target variable",s.innerHTML='<i class="fas fa-crosshairs"></i> $Target',t.appendChild(i),t.appendChild(s);const r=document.createElement("small");r.textContent=this.getParameterHelp(e,a);const c=document.createElement("div");c.className="variable-help",c.innerHTML="<strong>$Target</strong> - Use to include your current target's name in the message",n.appendChild(o),n.appendChild(t),n.appendChild(r),n.appendChild(c)}else{"select"===a.type?(i=document.createElement("select"),i.id=`param_${e}`,i.name=e,a.options.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent="STOTrayExecByTray"===e?"STOTrayExecByTray (shows key binding on UI)":"TrayExecByTray (no UI indication)",e===a.default&&(t.selected=!0),i.appendChild(t)})):(i=document.createElement("input"),i.type="number"===a.type?"number":"text",i.id=`param_${e}`,i.name=e,i.value=a.default||"",a.placeholder&&(i.placeholder=a.placeholder),"number"===a.type&&(void 0!==a.min&&(i.min=a.min),void 0!==a.max&&(i.max=a.max),void 0!==a.step&&(i.step=a.step)));const t=document.createElement("small");t.textContent=this.getParameterHelp(e,a),n.appendChild(o),n.appendChild(i),n.appendChild(t)}t.appendChild(n),i.addEventListener("input",()=>{this.updateParameterPreview()}),"SELECT"===i.tagName&&i.addEventListener("change",()=>{this.updateParameterPreview()})}),this.updateParameterPreview()}formatParameterName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}getParameterHelp(e,t){return{entityName:"Name of the entity to target (e.g., ship name, player name)",active:"Whether the command is active (1 = active, 0 = inactive)",tray:"Primary tray number (0-9, where 0 is the first tray)",slot:"Primary slot number (0-9, where 0 is the first slot)",backup_tray:"Backup tray number (0-9, where 0 is the first tray)",backup_slot:"Backup slot number (0-9, where 0 is the first slot)",amount:"Throttle adjustment amount (-1 to 1)",position:"Throttle position (-1 = full reverse, 0 = stop, 1 = full forward)",distance:"Camera distance from target",filename:"Name of the keybind file (without extension)",message:"Text message to send",state:"Enable (1) or disable (0) combat log",command_type:"STOTrayExecByTray shows key binding on UI, TrayExecByTray does not"}[e]||`${t.type} value ${void 0!==t.min?`(${t.min} to ${t.max})`:""}`}updateParameterPreview(){if(!this.currentParameterCommand)return;const{categoryId:e,commandId:t,commandDef:a}=this.currentParameterCommand,n=this.getParameterValues(),o=this.buildParameterizedCommand(e,t,a,n),i=document.getElementById("parameterCommandPreview");if(i&&o)if(Array.isArray(o)){const e=o.map(e=>e.command);i.textContent=e.join(" $$ ")}else i.textContent=o.command}getParameterValues(){const e={};return document.querySelectorAll("#parameterInputs input, #parameterInputs select").forEach(t=>{const a=t.name;let n=t.value;"number"===t.type&&(n=parseFloat(n)||0),e[a]=n}),e}buildParameterizedCommand(e,t,a,n){const o={targeting:e=>"target"===t&&e.entityName?{command:`${a.command} "${e.entityName}"`,text:`Target: ${e.entityName}`}:{command:a.command,text:a.name},tray:n=>{const o=n.tray||0,i=n.slot||0;if("tray_with_backup"===t){const e=void 0!==n.active?n.active:1,t=n.backup_tray||0,a=n.backup_slot||0;return{command:`TrayExecByTrayWithBackup ${e} ${o} ${i} ${t} ${a}`,text:`Execute Tray ${o+1} Slot ${i+1} (backup: Tray ${t+1} Slot ${a+1})`}}if("tray_range"===t){const t=n.start_tray||0,o=n.start_slot||0,i=n.end_tray||0,s=n.end_slot||0,r=n.command_type||"STOTrayExecByTray";return stoCommands.generateTrayRangeCommands(t,o,i,s,r).map((n,r)=>{let c,l;try{const e=n.replace("+","").trim().split(/\s+/);c=parseInt(e[1]),l=parseInt(e[2])}catch(e){c=void 0,l=void 0}return{command:n,type:e,icon:a.icon,text:0===r?`Execute Range: Tray ${t+1} Slot ${o+1} to Tray ${i+1} Slot ${s+1}`:n,id:this.generateCommandId(),parameters:{tray:c,slot:l}}})}if("tray_range_with_backup"===t){const t=n.active||1,o=n.start_tray||0,i=n.start_slot||0,s=n.end_tray||0,r=n.end_slot||0,c=n.backup_start_tray||0,l=n.backup_start_slot||0,d=n.backup_end_tray||0,m=n.backup_end_slot||0;return stoCommands.generateTrayRangeWithBackupCommands(t,o,i,s,r,c,l,d,m).map((t,n)=>{let i,r,c,l,d;try{const e=t.trim().split(/\s+/);i=parseInt(e[1]),r=parseInt(e[2]),c=parseInt(e[3]),l=parseInt(e[4]),d=parseInt(e[5])}catch(e){}return{command:t,type:e,icon:a.icon,text:0===n?`Execute Range with Backup: Tray ${o+1}-${s+1}`:t,id:this.generateCommandId(),parameters:{active:i,tray:r,slot:c,backup_tray:l,backup_slot:d}}})}if("whole_tray"===t){const t=n.command_type||"STOTrayExecByTray";return stoCommands.generateWholeTrayCommands(o,t).map((t,n)=>{let i;try{const e=t.replace("+","").trim().split(/\s+/);i=parseInt(e[2])}catch(e){i=void 0}return{command:t,type:e,icon:a.icon,text:0===n?`Execute Whole Tray ${o+1}`:t,id:this.generateCommandId(),parameters:{tray:o,slot:i}}})}if("whole_tray_with_backup"===t){const t=n.active||1,i=n.backup_tray||0;return stoCommands.generateWholeTrayWithBackupCommands(t,o,i).map((t,n)=>{let s,r,c,l,d;try{const e=t.trim().split(/\s+/);s=parseInt(e[1]),r=parseInt(e[2]),c=parseInt(e[3]),l=parseInt(e[4]),d=parseInt(e[5])}catch(e){}return{command:t,type:e,icon:a.icon,text:0===n?`Execute Whole Tray ${o+1} (with backup Tray ${i+1})`:t,id:this.generateCommandId(),parameters:{active:s,tray:r,slot:c,backup_tray:l,backup_slot:d}}})}{const e=this.currentParameterCommand&&this.currentParameterCommand.isEditing,t=n.command_type||"STOTrayExecByTray",a="+";if(e){const e=this.getCurrentProfile().keys[this.selectedKey][this.currentParameterCommand.editIndex];if(e&&(e.command.startsWith("TrayExecByTray")||e.command.startsWith("+TrayExecByTray")))return{command:`+TrayExecByTray ${o} ${i}`,text:`Execute Tray ${o+1} Slot ${i+1}`}}return{command:`${a}${t} ${o} ${i}`,text:`Execute Tray ${o+1} Slot ${i+1}`}}},movement:e=>{let n=a.command;return"throttle_adjust"===t&&void 0!==e.amount?n=`${a.command} ${e.amount}`:"throttle_set"===t&&void 0!==e.position&&(n=`${a.command} ${e.position}`),{command:n,text:a.name}},camera:e=>{let n=a.command;return"cam_distance"===t&&void 0!==e.distance&&(n=`${a.command} ${e.distance}`),{command:n,text:a.name}},communication:e=>({command:`${a.command} ${e.message||"Message text here"}`,text:`${a.name}: ${e.message||"Message text here"}`}),system:e=>{let n=a.command;return"bind_save_file"!==t&&"bind_load_file"!==t||!e.filename?"combat_log"===t&&void 0!==e.state&&(n=`${a.command} ${e.state}`):n=`${a.command} ${e.filename}`,{command:n,text:a.name}}},i=o[e];if(i){const t=i(n);return Array.isArray(t)?t:{command:t.command,type:e,icon:a.icon,text:t.text,id:this.generateCommandId(),parameters:n}}return null}saveParameterCommand(){if(!this.selectedKey||!this.currentParameterCommand)return;const{categoryId:e,commandId:t,commandDef:a,editIndex:n,isEditing:o}=this.currentParameterCommand,i=this.getParameterValues(),s=this.buildParameterizedCommand(e,t,a,i);if(s){if(o&&void 0!==n)if(Array.isArray(s)){const e=this.getCurrentProfile();e.keys[this.selectedKey].splice(n,1,...s),stoStorage.saveProfile(this.currentProfile,e),this.renderCommandChain(),this.setModified(!0),stoUI.showToast(`${s.length} commands updated successfully`,"success")}else{const e=this.getCurrentProfile();e.keys[this.selectedKey][n]=s,stoStorage.saveProfile(this.currentProfile,e),this.renderCommandChain(),this.setModified(!0),stoUI.showToast("Command updated successfully","success")}else this.addCommand(this.selectedKey,s);modalManager.hide("parameterModal"),this.currentParameterCommand=null,document.getElementById("saveParameterCommandBtn").textContent="Add Command"}}editCommand(e){if(!this.selectedKey)return;const t=this.getCurrentProfile().keys[this.selectedKey];if(!t||!t[e])return;const a=t[e];if(a.parameters&&a.type){const t=this.findCommandDefinition(a);if(t&&t.customizable)return void this.editParameterizedCommand(e,a,t)}const n=this.findCommandDefinition(a);n&&n.customizable?this.editParameterizedCommand(e,a,n):stoUI.showToast(`Command: ${a.command}\nType: ${a.type}`,"info",3e3)}findCommandDefinition(e){if(e.command.includes("TrayExec")){const t=STO_DATA.commands.tray;if(t)if(e.command.includes("TrayExecByTrayWithBackup")&&e.command.includes("$$")){if(e.command.split("$$").map(e=>e.trim()).length>1){const e=t.commands.tray_range_with_backup;if(e)return{commandId:"tray_range_with_backup",...e}}}else if((e.command.includes("STOTrayExecByTray")||e.command.includes("TrayExecByTray"))&&e.command.includes("$$")&&!e.command.includes("WithBackup")){if(e.command.split("$$").map(e=>e.trim()).length>1){const e=t.commands.tray_range;if(e)return{commandId:"tray_range",...e}}}else if(e.command.includes("TrayExecByTrayWithBackup")){const e=t.commands.tray_with_backup;if(e)return{commandId:"tray_with_backup",...e}}else if(e.command.includes("STOTrayExecByTray")||e.command.includes("TrayExecByTray")&&!e.command.includes("WithBackup")){const e=t.commands.custom_tray;if(e)return{commandId:"custom_tray",...e}}}const t=STO_DATA.commands[e.type];if(!t)return null;for(const[a,n]of Object.entries(t.commands))if(n.command===e.command)return{commandId:a,...n};for(const[a,n]of Object.entries(t.commands))if(n.customizable&&e.command.startsWith(n.command.split(" ")[0]))return{commandId:a,...n};return null}editParameterizedCommand(e,t,a){this.currentParameterCommand={categoryId:t.type,commandId:a.commandId,commandDef:a,editIndex:e,isEditing:!0},document.getElementById("parameterModal")||this.createParameterModal(),this.populateParameterModalForEdit(a,t.parameters),document.getElementById("parameterModalTitle").textContent=`Edit: ${a.name}`,document.getElementById("saveParameterCommandBtn").textContent="Update Command",modalManager.show("parameterModal")}populateParameterModalForEdit(e,t){const a=document.getElementById("parameterInputs");a.innerHTML="",Object.entries(e.parameters).forEach(([e,n])=>{const o=document.createElement("div");o.className="form-group";const i=document.createElement("label");let s;if(i.textContent=this.formatParameterName(e),i.setAttribute("for",`param_${e}`),"select"===n.type){s=document.createElement("select"),s.id=`param_${e}`,s.name=e,n.options.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent="STOTrayExecByTray"===e?"STOTrayExecByTray (shows key binding on UI)":"TrayExecByTray (no UI indication)",s.appendChild(t)});const a=t&&void 0!==t[e]?t[e]:n.default;s.value=null!=a?a:n.default}else{s=document.createElement("input"),s.type="number"===n.type?"number":"text",s.id=`param_${e}`,s.name=e;const a=t&&void 0!==t[e]?t[e]:n.default;s.value=null!=a?a:"",n.placeholder&&(s.placeholder=n.placeholder),"number"===n.type&&(void 0!==n.min&&(s.min=n.min),void 0!==n.max&&(s.max=n.max),void 0!==n.step&&(s.step=n.step))}const r=document.createElement("small");r.textContent=this.getParameterHelp(e,n),o.appendChild(i),o.appendChild(s),o.appendChild(r),a.appendChild(o),s.addEventListener("input",()=>{this.updateParameterPreview()}),"SELECT"===s.tagName&&s.addEventListener("change",()=>{this.updateParameterPreview()})}),this.updateParameterPreview()}filterCommandLibrary(){document.querySelectorAll(".command-item").forEach(e=>{const t=e.dataset.command;if(!t)return;let a=null;for(const[e,n]of Object.entries(STO_DATA.commands))if(n.commands[t]){a=n.commands[t];break}if(a){let t=!0;t=!a.environment||a.environment===this.currentEnvironment,e.style.display=t?"flex":"none"}}),document.querySelectorAll(".category").forEach(e=>{const t=e.querySelectorAll('.command-item:not([style*="display: none"])').length>0;e.style.display=t?"block":"none"})}showKeySelectionModal(){this.setupKeySelectionModal(),modalManager.show("keySelectionModal")}setupKeySelectionModal(){this.populateCommonKeys();const e=document.getElementById("findOtherKeysBtn");e&&(e.onclick=()=>this.showFullKeyList());const t=document.getElementById("keySearchInput");t&&(t.oninput=e=>this.filterKeyList(e.target.value))}populateCommonKeys(){const e=document.getElementById("commonKeysGrid");if(!e)return;const t=STO_DATA.keys.common.keys;e.innerHTML="",t.forEach(t=>{const a=document.createElement("div");a.className="key-button",a.onclick=()=>this.selectKeyFromModal(t.key),a.innerHTML=`\n                <div class="key-name">${t.key}</div>\n                <div class="key-desc">${t.description}</div>\n            `,e.appendChild(a)})}showFullKeyList(){const e=document.getElementById("fullKeysSection"),t=document.getElementById("findOtherKeysBtn");e&&t&&(e.style.display="block",t.style.display="none",this.populateKeyCategories())}populateKeyCategories(){const e=document.getElementById("keyCategories");e&&(e.innerHTML="",Object.entries(STO_DATA.keys).forEach(([t,a])=>{if("common"===t)return;if(console.log("Processing category:",t,a),!a||!a.name||!a.keys)return void console.warn(`Invalid category data for categoryId: ${t}`,a);const n=document.createElement("div");n.className="key-category";const o=document.createElement("div");o.className="key-category-header",o.onclick=()=>this.toggleKeySelectionCategory(t),o.innerHTML=`\n                <div>\n                    <h5>${a.name}</h5>\n                    <div class="category-desc">${a.description||""}</div>\n                </div>\n                <i class="fas fa-chevron-right category-chevron"></i>\n            `;const i=document.createElement("div");i.className="key-category-content collapsed",i.id=`key-category-${t}`,Array.isArray(a.keys)&&a.keys.forEach(e=>{if(e&&e.key){const t=document.createElement("div");t.className="key-button",t.onclick=()=>this.selectKeyFromModal(e.key),t.innerHTML=`\n                            <div class="key-name">${e.key}</div>\n                            <div class="key-desc">${e.description||""}</div>\n                        `,i.appendChild(t)}}),n.appendChild(o),n.appendChild(i),e.appendChild(n)}))}toggleKeySelectionCategory(e){const t=document.getElementById(`key-category-${e}`);if(!t)return void console.warn(`Key selection category content not found for categoryId: ${e}`);const a=t.previousElementSibling;if(t&&a)if(t.classList.contains("collapsed")){t.classList.remove("collapsed"),a.classList.remove("collapsed");const e=a.querySelector(".category-chevron");e&&(e.style.transform="rotate(90deg)")}else{t.classList.add("collapsed"),a.classList.add("collapsed");const e=a.querySelector(".category-chevron");e&&(e.style.transform="rotate(0deg)")}}filterKeyList(e){const t=e.toLowerCase().trim();document.querySelectorAll("#keyCategories .key-button").forEach(e=>{const a=e.querySelector(".key-name").textContent.toLowerCase(),n=e.querySelector(".key-desc").textContent.toLowerCase(),o=a.includes(t)||n.includes(t);e.style.display=o?"flex":"none"}),document.querySelectorAll(".key-category").forEach(e=>{const a=e.querySelectorAll('.key-button:not([style*="display: none"])').length>0;if(""===t)e.style.display="block";else if(e.style.display=a?"block":"none",a){const t=e.querySelector(".key-category-content"),a=e.querySelector(".key-category-header");t&&a&&(t.classList.remove("collapsed"),a.classList.remove("collapsed"))}})}selectKeyFromModal(e){modalManager.hide("keySelectionModal"),this.selectKey(e)}insertTargetVariable(e){const t=e.selectionStart,a=e.value,n=a.slice(0,t)+"$Target"+a.slice(t);e.value=n,e.setSelectionRange(t+7,t+7),e.focus(),e.dispatchEvent(new Event("input",{bubbles:!0}))}showVertigoModal(){const e=stoStorage.getProfile(this.currentProfile);e&&vertigoManager.loadState(e),this.vertigoInitialState={selectedEffects:{space:new Set(vertigoManager.selectedEffects.space),ground:new Set(vertigoManager.selectedEffects.ground)},showPlayerSay:vertigoManager.showPlayerSay},this.populateVertigoModal(),this.setupVertigoEventListeners(),modalManager.show("vertigoModal")}populateVertigoModal(){const e=document.getElementById("spaceEffectsList");e&&(e.innerHTML="",VFX_EFFECTS.space.forEach(t=>{const a=this.createEffectItem("space",t);e.appendChild(a)}));const t=document.getElementById("groundEffectsList");t&&(t.innerHTML="",VFX_EFFECTS.ground.forEach(e=>{const a=this.createEffectItem("ground",e);t.appendChild(a)})),this.updateVertigoCheckboxes("space"),this.updateVertigoCheckboxes("ground");const a=document.getElementById("vertigoShowPlayerSay");a&&(a.checked=vertigoManager.showPlayerSay),this.updateVertigoEffectCounts(),this.updateVertigoPreview()}createEffectItem(e,t){const a=document.createElement("div");a.className="effect-item",a.innerHTML=`\n            <input type="checkbox" id="effect_${e}_${t.effect.replace(/[^a-zA-Z0-9]/g,"_")}" \n                   data-environment="${e}" \n                   data-effect="${t.effect}">\n            <label for="effect_${e}_${t.effect.replace(/[^a-zA-Z0-9]/g,"_")}" \n                   class="effect-label">${t.label}</label>\n        `;const n=a.querySelector('input[type="checkbox"]');return n.addEventListener("change",()=>{vertigoManager.toggleEffect(e,t.effect),this.updateVertigoEffectCounts(),this.updateVertigoPreview(),a.classList.toggle("selected",n.checked)}),a.querySelector(".effect-label").addEventListener("click",()=>{n.checked=!n.checked,n.dispatchEvent(new Event("change"))}),a}setupVertigoEventListeners(){["spaceSelectAll","spaceClearAll","groundSelectAll","groundClearAll","vertigoShowPlayerSay","saveVertigoBtn"].forEach(e=>{const t=document.getElementById(e);t&&t.replaceWith(t.cloneNode(!0))}),i.onDom("spaceSelectAll","click","vertigo-space-select-all",()=>{try{vertigoManager.selectAllEffects("space"),this.updateVertigoCheckboxes("space"),this.updateVertigoEffectCounts(),this.updateVertigoPreview()}catch(e){e instanceof InvalidEnvironmentError?stoUI.showToast(`Error: ${e.message}`,"error"):(stoUI.showToast("Failed to select all space effects","error"),console.error("Error selecting all space effects:",e))}}),i.onDom("spaceClearAll","click","vertigo-space-clear-all",()=>{vertigoManager.selectedEffects.space.clear(),this.updateVertigoCheckboxes("space"),this.updateVertigoEffectCounts(),this.updateVertigoPreview()}),i.onDom("groundSelectAll","click","vertigo-ground-select-all",()=>{try{vertigoManager.selectAllEffects("ground"),this.updateVertigoCheckboxes("ground"),this.updateVertigoEffectCounts(),this.updateVertigoPreview()}catch(e){e instanceof InvalidEnvironmentError?stoUI.showToast(`Error: ${e.message}`,"error"):(stoUI.showToast("Failed to select all ground effects","error"),console.error("Error selecting all ground effects:",e))}}),i.onDom("groundClearAll","click","vertigo-ground-clear-all",()=>{vertigoManager.selectedEffects.ground.clear(),this.updateVertigoCheckboxes("ground"),this.updateVertigoEffectCounts(),this.updateVertigoPreview()}),i.onDom("vertigoShowPlayerSay","change","vertigo-show-playersay",e=>{vertigoManager.showPlayerSay=e.target.checked,this.updateVertigoPreview()}),i.onDom("saveVertigoBtn","click","vertigo-save",()=>{this.generateVertigoAliases()})}updateVertigoCheckboxes(e){document.querySelectorAll(`input[data-environment="${e}"]`).forEach(t=>{const a=t.dataset.effect,n=vertigoManager.isEffectSelected(e,a);t.checked=n,t.closest(".effect-item").classList.toggle("selected",n)})}updateVertigoEffectCounts(){const e=vertigoManager.getEffectCount("space"),t=vertigoManager.getEffectCount("ground"),a=document.getElementById("spaceEffectCount"),n=document.getElementById("groundEffectCount");a&&(a.textContent=`${e} selected`),n&&(n.textContent=`${t} selected`)}updateVertigoPreview(){const e=document.getElementById("spaceAliasCommand"),t=document.getElementById("groundAliasCommand");if(e)try{const t=vertigoManager.generateAlias("space");e.textContent=t||"No space effects selected"}catch(t){t instanceof InvalidEnvironmentError?(e.textContent="Error: Invalid environment",stoUI.showToast(`Space preview error: ${t.message}`,"error")):(e.textContent="Error generating preview",console.error("Error generating space alias preview:",t))}if(t)try{const e=vertigoManager.generateAlias("ground");t.textContent=e||"No ground effects selected"}catch(e){e instanceof InvalidEnvironmentError?(t.textContent="Error: Invalid environment",stoUI.showToast(`Ground preview error: ${e.message}`,"error")):(t.textContent="Error generating preview",console.error("Error generating ground alias preview:",e))}}generateVertigoAliases(){let e="",t="";try{e=vertigoManager.generateAlias("space")}catch(e){return e instanceof InvalidEnvironmentError?void stoUI.showToast(`Space alias error: ${e.message}`,"error"):(stoUI.showToast("Failed to generate space alias","error"),void console.error("Error generating space alias:",e))}try{t=vertigoManager.generateAlias("ground")}catch(e){return e instanceof InvalidEnvironmentError?void stoUI.showToast(`Ground alias error: ${e.message}`,"error"):(stoUI.showToast("Failed to generate ground alias","error"),void console.error("Error generating ground alias:",e))}if(!e&&!t)return void stoUI.showToast("No effects selected. Please select at least one effect to generate aliases.","warning");if(!this.getCurrentProfile())return void stoUI.showToast("No profile selected","error");const a=stoStorage.getProfile(this.currentProfile);if(!a)return void stoUI.showToast("No profile found","error");let n=0;if(a.aliases||(a.aliases={}),e){const t="dynFxSetFXExlusionList_Space",o=e.match(/alias\s+\w+\s+<&\s+(.+?)&>/),i=o?o[1]:"";a.aliases[t]={name:t,description:"VFX - Disable Space Visual Effects",commands:i,created:(new Date).toISOString(),lastModified:(new Date).toISOString()},n++}if(t){const e="dynFxSetFXExlusionList_Ground",o=t.match(/alias\s+\w+\s+<&\s+(.+?)&>/),i=o?o[1]:"";a.aliases[e]={name:e,description:"VFX - Disable Ground Visual Effects",commands:i,created:(new Date).toISOString(),lastModified:(new Date).toISOString()},n++}vertigoManager.saveState(a),stoStorage.saveProfile(this.currentProfile,a),this.saveProfile(),this.setModified(!0),"undefined"!=typeof stoAliases&&stoAliases.updateCommandLibrary&&stoAliases.updateCommandLibrary(),this.vertigoInitialState={selectedEffects:{space:new Set(vertigoManager.selectedEffects.space),ground:new Set(vertigoManager.selectedEffects.ground)},showPlayerSay:vertigoManager.showPlayerSay},this.vertigoSaving=!0,modalManager.hide("vertigoModal"),stoUI.showToast(`Generated ${n} Vertigo alias${n>1?"es":""}! Check the Alias Manager to bind them to keys.`,"success")}applyTheme(){const e=stoStorage.getSettings().theme||"default";"dark"===e?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme"),this.updateThemeToggleButton(e)}toggleTheme(){const e=stoStorage.getSettings(),t="dark"===(e.theme||"default")?"default":"dark";e.theme=t,stoStorage.saveSettings(e),this.applyTheme();const a="dark"===t?"Dark Mode":"Light Mode";stoUI.showToast(`Switched to ${a}`,"success")}updateThemeToggleButton(e){const t=document.getElementById("themeToggleBtn"),a=document.getElementById("themeToggleText"),n=t?.querySelector("i");t&&a&&n&&("dark"===e?(n.className="fas fa-sun",a.textContent="Light Mode"):(n.className="fas fa-moon",a.textContent="Dark Mode"))}};window.app=pe,i.on("sto-app-ready",()=>{oe.init(),ie.init(),se.init(),re.init(),me.init()});
//# sourceMappingURL=bundle.js.map
