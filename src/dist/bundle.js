const e="v2025.11.14",t=["Alt+F4","Alt+Tab","Alt+Space","LALT+F4","RALT+F4","LALT+Tab","RALT+Tab","LALT+Space","RALT+Space"],i=new Map,a=new Set;function n(e,t){return i.has(e)||i.set(e,new Set),i.get(e).add(t),()=>{s(e,t)}}function s(e,t){const a=i.get(e);a&&a.delete(t)}function r(e,t,a={}){const n=i.get(e);if(!n)return Promise.resolve();if(a.synchronous){const i=[];return n.forEach(a=>{try{const e=a(t);e&&"function"==typeof e.then&&i.push(e)}catch(t){console.error(`Error in event listener for ${e}:`,t),i.push(Promise.reject(t))}}),Promise.allSettled?Promise.allSettled(i):Promise.all(i.map(e=>e.catch(e=>e)))}return n.forEach(i=>{try{i(t)}catch(t){console.error(`Error in event listener for ${e}:`,t)}}),Promise.resolve()}function o(e,t,i,n){if("string"==typeof e){"function"==typeof i&&void 0===n&&(n=i,i=t);const s=/^[.\[#]/.test(e)?e:`#${e}`,o=e=>{if(e.target.closest(s)){if(n)try{n(e)}catch(e){console.error(e)}r(i||t,e)}};document.addEventListener(t,o,!0);const c=()=>{document.removeEventListener(t,o,!0),a.delete(c)};return a.add(c),c}if(!e||!e.addEventListener)return()=>{};if("function"==typeof i&&(n=i,i=t),i||(i=t),n){const s=e=>{try{n(e)}catch(e){console.error(e)}r(i,e)};e.addEventListener(t,s);const o=()=>{e.removeEventListener(t,s),a.delete(o)};return a.add(o),o}{const n=e=>r(i,e);e.addEventListener(t,n);const s=()=>{e.removeEventListener(t,n),a.delete(s)};return a.add(s),s}}var c={on:n,off:s,emit:r,onDom:o,onDomDebounced:function(e,t,i,a,n=250){"number"==typeof a&&(n=a,a=void 0);const s=function(e,t=250){let i;return(...a)=>{clearTimeout(i),i=setTimeout(()=>e.apply(this,a),t)}}(a||(()=>{}),n);return o(e,t,i,e=>{s(e)})},once:function(e,t){const i=a=>{s(e,i),t(a)};n(e,i)},clear:function(){i.clear(),a.forEach(e=>{try{e()}catch(e){console.error("Error cleaning up DOM event listener:",e)}}),a.clear()},get listeners(){return i}};const l={commands:{custom:{name:"Custom",icon:"fas fa-plus",description:"Create commands from raw STO command strings",commands:{add_custom_command:{name:"Add Custom Command",command:"",description:"Add any STO command as raw text",syntax:"<raw command>",icon:"â•",customizable:!0,parameters:{rawCommand:{type:"text",default:"",placeholder:"command_definitions.parameter_placeholders.any_sto_command",label:"Command:"}}}}},targeting:{name:"Targeting",icon:"fas fa-crosshairs",description:"Target selection and management",commands:{target:{name:"Target by Name",command:"Target",description:"Target entity by name (requires quotes)",syntax:'Target "EntityName"',icon:"ğŸ¯",customizable:!0,parameters:{entityName:{type:"text",default:"EntityName",placeholder:"command_definitions.parameter_placeholders.entity_name"}}},target_enemy_near:{name:"Target Nearest Enemy",command:"Target_Enemy_Near",description:"Target the nearest enemy in view",syntax:"Target_Enemy_Near",icon:"ğŸ¯"},target_friend_near:{name:"Target Nearest Friend",command:"Target_Friend_Near",description:"Target the nearest friendly entity",syntax:"Target_Friend_Near",icon:"ğŸ¤"},target_self:{name:"Target Self",command:"Target_Self",description:"Target your own ship/character",syntax:"Target_Self",icon:"ğŸ‘¤"},target_clear:{name:"Clear Target",command:"Target_Clear",description:"Remove current target lock",syntax:"Target_Clear",icon:"âŒ"},target_teammate_1:{name:"Target Teammate 1",command:"Target_Teammate 1",description:"Target first team member",syntax:"Target_Teammate 1",icon:"ğŸ‘¥"},target_teammate_2:{name:"Target Teammate 2",command:"Target_Teammate 2",description:"Target second team member",syntax:"Target_Teammate 2",icon:"ğŸ‘¥"},target_teammate_3:{name:"Target Teammate 3",command:"Target_Teammate 3",description:"Target third team member",syntax:"Target_Teammate 3",icon:"ğŸ‘¥"},target_teammate_4:{name:"Target Teammate 4",command:"Target_Teammate 4",description:"Target fourth team member",syntax:"Target_Teammate 4",icon:"ğŸ‘¥"}}},combat:{name:"Combat",icon:"fas fa-fire",description:"Weapon firing and combat actions",commands:{fire_all:{name:"Fire All Weapons",command:"FireAll",description:"Fire all weapons",syntax:"FireAll",environment:"space",icon:"ğŸ”¥",warning:"spam_bar_warning"},fire_phasers:{name:"Fire Energy Weapons",command:"FirePhasers",description:"Fire all Energy Weapons",syntax:"FirePhasers",environment:"space",icon:"âš¡",warning:"spam_bar_warning"},fire_torps:{name:"Fire Torpedoes",command:"FireTorps",description:"Fire all Torpedos",syntax:"FireTorps",environment:"space",icon:"ğŸš€",warning:"spam_bar_warning"},fire_mines:{name:"Fire Mines",command:"FireMines",description:"Fire all Mines",syntax:"FireMines",environment:"space",icon:"ğŸ’£",warning:"spam_bar_warning"},fire_phasers_torps:{name:"Fire Phasers & Torpedoes",command:"FirePhasersTorps",description:"Fire phasers & torpedos",syntax:"FirePhasersTorps",environment:"space",icon:"ğŸ’¥",warning:"spam_bar_warning"},fire_projectiles:{name:"Fire Projectiles",command:"FireProjectiles",description:"Fire torpedos & mines",syntax:"FireProjectiles",environment:"space",icon:"ğŸ¯",warning:"spam_bar_warning"},aim:{name:"Aim/Scope",command:"aim",description:"Toggle scope on/off. In scope mode the player does more damage. Can either be used as a toggle or a press and hold",syntax:"aim",environment:"ground",icon:"ğŸ¯"},holster:{name:"Holster Weapon",command:"Holster",description:"Attempt to holster your active weapon",syntax:"Holster",environment:"ground",icon:"ğŸ”«"},holster_toggle:{name:"Holster Toggle",command:"HolsterToggle",description:"Attempt to holster or draw your weapons",syntax:"HolsterToggle",environment:"ground",icon:"ğŸ”„"},unholster:{name:"Unholster Weapon",command:"Unholster",description:"Attempt to draw your active weapon",syntax:"Unholster",environment:"ground",icon:"ğŸ”«"},toggle_shooter_mode:{name:"Toggle Shooter Mode",command:"ToggleShooterMode",description:"Toggle shooter mode on/off",syntax:"ToggleShooterMode",environment:"ground",icon:"ğŸ®"},shooter_primary:{name:"Shooter Primary",command:"ShooterPrimary",description:"Primary shooter mode action",syntax:"ShooterPrimary",environment:"ground",icon:"ğŸ¯"},shooter_secondary:{name:"Shooter Secondary",command:"Shootersecondary",description:"Secondary shooter mode action",syntax:"Shootersecondary",environment:"ground",icon:"ğŸ¯"},shooter_tertiary:{name:"Shooter Tertiary",command:"Shootertertiary",description:"Tertiary shooter mode action",syntax:"Shootertertiary",environment:"ground",icon:"ğŸ¯"},shooter_clear_offset_tray_binds:{name:"Shooter Clear Offset Tray Binds",command:"ShooterClearOffsetTrayBinds",description:"Clear the starting location and movement of the yellow action box that appears on the tray while in shooter mode",syntax:"ShooterClearOffsetTrayBinds",environment:"ground",icon:"ğŸ§¹"},shooter_clear_overlay_tray_binds:{name:"Shooter Clear Overlay Tray Binds",command:"ShooterClearOverlayTrayBinds",description:"Clear overlay tray bindings for shooter mode",syntax:"ShooterClearOverlayTrayBinds",environment:"ground",icon:"ğŸ§¹"},shooter_set_offset_tray_binds:{name:"Shooter Set Offset Tray Binds",command:"ShooterSetOffsetTrayBinds",description:"Set the starting location and movement of the yellow action box that appears on the tray while in shooter mode",syntax:"ShooterSetOffsetTrayBinds",environment:"ground",icon:"âš™ï¸"},shooter_set_overlay_tray_binds:{name:"Shooter Set Overlay Tray Binds",command:"ShooterSetOverlayTrayBinds",description:"Set overlay tray bindings for shooter mode",syntax:"ShooterSetOverlayTrayBinds",environment:"ground",icon:"âš™ï¸"}}},cosmetic:{name:"Cosmetic",icon:"fas fa-palette",description:"Character appearance and customization",commands:{setactivecostume:{name:"Set Active Costume",command:"setactivecostume",description:"Sets current active costume. Requires two modifiers.",syntax:"setactivecostume <modifier1> <modifier2>",environment:"ground",icon:"ğŸ‘•",customizable:!0,parameters:{modifier1:{type:"text",default:"modifier1",placeholder:"command_definitions.parameter_placeholders.first_modifier"},modifier2:{type:"text",default:"modifier2",placeholder:"command_definitions.parameter_placeholders.second_modifier"}}}}},bridge_officer:{name:"Bridge Officer",icon:"fas fa-user-friends",description:"Ground bridge officer control commands",commands:{setrallypoint:{name:"Set Rally Point",command:"Setrallypoint",description:"Set a rally point for your current target",syntax:"Setrallypoint",environment:"ground",icon:"ğŸ“"},setrallypointconsole:{name:"Set Rally Point (Console)",command:"Setrallypointconsole",description:"Set a rally point for your current target (console variant)",syntax:"Setrallypointconsole",environment:"ground",icon:"ğŸ–¥ï¸"},clearrallypoint:{name:"Clear Rally Point",command:"Clearrallypoint",description:"Clear the rally point for your current target",syntax:"Clearrallypoint",environment:"ground",icon:"âŒ"},clearallrallypoints:{name:"Clear All Rally Points",command:"Clearallrallypoints",description:"Clear all the rally points",syntax:"Clearallrallypoints",environment:"ground",icon:"ğŸ§¹"},assist:{name:"Assist",command:"Assist",description:'Assist "<name>": Assists the Entity with the matching name. If no name is given, assists your current target.',syntax:"Assist <name>",environment:"ground",icon:"ğŸ¤",customizable:!0,parameters:{name:{type:"text",default:"",placeholder:"command_definitions.parameter_placeholders.entity_name_optional"}}}}},tray:{name:"Tray Execution",icon:"fas fa-th",description:"Execute abilities from action trays",commands:{custom_tray:{name:"Tray Execution",command:"+STOTrayExecByTray 0 0",description:"Execute specific tray slot",syntax:"+STOTrayExecByTray <tray> <slot>",icon:"âš¡",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},slot:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"TrayExecByTray"}}},tray_with_backup:{name:"Tray Execution with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute specific tray slot with backup ability",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot>",icon:"âš¡",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},slot:{type:"number",min:0,max:9,default:0},backup_tray:{type:"number",min:0,max:9,default:0},backup_slot:{type:"number",min:0,max:9,default:0}}},tray_range:{name:"Tray Range Execution",command:"+STOTrayExecByTray 0 0",description:"Execute a range of tray slots",syntax:"+STOTrayExecByTray <tray> <slot> $$ ... (range)",icon:"âš¡",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},start_tray:{type:"number",min:0,max:9,default:0},start_slot:{type:"number",min:0,max:9,default:0},end_tray:{type:"number",min:0,max:9,default:0},end_slot:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"TrayExecByTray"}}},tray_range_with_backup:{name:"Tray Range with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute a range of tray slots with backup abilities",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot> $$ ... (range)",icon:"âš¡",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},start_tray:{type:"number",min:0,max:9,default:0},start_slot:{type:"number",min:0,max:9,default:0},end_tray:{type:"number",min:0,max:9,default:0},end_slot:{type:"number",min:0,max:9,default:0},backup_start_tray:{type:"number",min:0,max:9,default:0},backup_start_slot:{type:"number",min:0,max:9,default:0},backup_end_tray:{type:"number",min:0,max:9,default:0},backup_end_slot:{type:"number",min:0,max:9,default:0}}},whole_tray:{name:"Whole Tray Execution",command:"+STOTrayExecByTray 0 0",description:"Execute all slots in a tray",syntax:"+STOTrayExecByTray <tray> <slot> $$ ... (all slots)",icon:"âš¡",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"TrayExecByTray"}}},whole_tray_with_backup:{name:"Whole Tray with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute all slots in a tray with backup tray",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot> $$ ... (all slots)",icon:"âš¡",customizable:!0,parameters:{active:{type:"number",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},backup_tray:{type:"number",min:0,max:9,default:0}}}}},power:{name:"Shield Management",icon:"fas fa-shield-alt",description:"Shield power and distribution management",commands:{distribute_shields:{name:"Distribute Shields",command:"+power_exec Distribute_Shields",description:"Evenly distributes shields as if clicking in the middle of the ship and shields icon",syntax:"+power_exec Distribute_Shields",environment:"space",icon:"ğŸ›¡ï¸",warning:"spam_bar_warning"},reroute_shields_rear:{name:"Reroute Shields Rear",command:"+power_exec reroute_shields_rear",description:"Route shield power to rear facing",syntax:"+power_exec reroute_shields_rear",environment:"space",icon:"ğŸ›¡ï¸",warning:"spam_bar_warning"},reroute_shields_left:{name:"Reroute Shields Left",command:"+power_exec reroute_shields_left",description:"Route shield power to left side",syntax:"+power_exec reroute_shields_left",environment:"space",icon:"ğŸ›¡ï¸",warning:"spam_bar_warning"},reroute_shields_right:{name:"Reroute Shields Right",command:"+power_exec reroute_shields_right",description:"Route shield power to right side",syntax:"+power_exec reroute_shields_right",environment:"space",icon:"ğŸ›¡ï¸",warning:"spam_bar_warning"},reroute_shields_forward:{name:"Reroute Shields Forward",command:"+power_exec reroute_shields_forward",description:"Route shield power to forward facing",syntax:"+power_exec reroute_shields_forward",environment:"space",icon:"ğŸ›¡ï¸",warning:"spam_bar_warning"}}},movement:{name:"Movement",icon:"fas fa-arrows-alt",description:"Ship movement and navigation",commands:{full_impulse:{name:"Full Impulse",command:"+fullimpulse",description:"Engage full impulse drive",syntax:"+fullimpulse",environment:"space",icon:"ğŸš€"},reverse:{name:"Reverse",command:"+reverse",description:"Reverse engines",syntax:"+reverse",icon:"â¬…ï¸"},throttle_adjust:{name:"Throttle Adjust",command:"ThrottleAdjust",description:"Increase or decrease the throttle by amount",syntax:"ThrottleAdjust <amount>",icon:"âš¡",customizable:!0,parameters:{amount:{type:"number",min:-1,max:1,default:.25,step:.05}}},throttle_set:{name:"Throttle Set",command:"ThrottleSet",description:"Set the throttle to a specific position (negative = reverse, 0 = stop)",syntax:"ThrottleSet <position>",icon:"ğŸ›ï¸",customizable:!0,parameters:{position:{type:"number",min:-1,max:1,default:1,step:.1}}},throttle_toggle:{name:"Throttle Toggle",command:"ThrottleToggle",description:"Alternates between full throttle and full stop",syntax:"ThrottleToggle",icon:"ğŸ”„"},turn_left:{name:"Turn Left",command:"+turnleft",description:"Turn ship left (continuous while held)",syntax:"+turnleft",icon:"â†ªï¸"},turn_right:{name:"Turn Right",command:"+turnright",description:"Turn ship right (continuous while held)",syntax:"+turnright",icon:"â†©ï¸"},pitch_up:{name:"Pitch Up",command:"+up",description:"Pitch ship nose up (space altitude change)",syntax:"+up",icon:"â¬†ï¸"},pitch_down:{name:"Pitch Down",command:"+down",description:"Pitch ship nose down (space altitude change)",syntax:"+down",icon:"â¬‡ï¸"},strafe_left:{name:"Strafe Left",command:"+left",description:"Strafe ship left",syntax:"+left",icon:"â¬…ï¸"},strafe_right:{name:"Strafe Right",command:"+right",description:"Strafe ship right",syntax:"+right",icon:"â¡ï¸"},forward:{name:"Forward",command:"+forward",description:"Move forward",syntax:"+forward",icon:"â¬†ï¸"},backward:{name:"Backward",command:"+backward",description:"Move backward",syntax:"+backward",icon:"â¬‡ï¸"},auto_forward:{name:"Auto Forward",command:"autoForward",description:"Character moves forward until given new movement commands",syntax:"autoForward",environment:"ground",icon:"ğŸƒ"},follow:{name:"Follow Target",command:"Follow",description:"Follow the targeted entity",syntax:"Follow",icon:"ğŸ‘¥"},follow_cancel:{name:"Cancel Follow",command:"Follow_Cancel",description:"Stop following and forget about the target",syntax:"Follow_Cancel",icon:"âŒ"}}},camera:{name:"Camera",icon:"fas fa-video",description:"Camera control and view management",commands:{zoom_in:{name:"Zoom In",command:"Camzoomin",description:"Zoom the camera in",syntax:"Camzoomin",icon:"ğŸ”"},zoom_out:{name:"Zoom Out",command:"Camzoomout",description:"Zoom the camera out",syntax:"Camzoomout",icon:"ğŸ”"},zoom_in_small:{name:"Zoom In Small",command:"Camzoominsmall",description:"Zoom the camera in slightly",syntax:"Camzoominsmall",icon:"ğŸ”"},zoom_out_small:{name:"Zoom Out Small",command:"Camzoomoutsmall",description:"Zoom the camera out slightly",syntax:"Camzoomoutsmall",icon:"ğŸ”"},cam_distance:{name:"Set Camera Distance",command:"camdist",description:"Sets the camera distance from the player",syntax:"camdist <distance>",icon:"ğŸ“",customizable:!0,parameters:{distance:{type:"number",min:1,max:500,default:50}}},cam_reset:{name:"Reset Camera",command:"CamReset",description:"Reset the camera position to default",syntax:"CamReset",icon:"ğŸ”„"},cam_target_lock:{name:"Lock Camera to Target",command:"Camsetlocktotarget",description:"Lock or unlock the camera to the target",syntax:"Camsetlocktotarget",icon:"ğŸ¯"},cam_cycle_distance:{name:"Cycle Camera Distance",command:"camCycleDist",description:"Cycle the camera distance between several preset values",syntax:"camCycleDist",icon:"ğŸ”„"},cam_mouse_look:{name:"Mouse Look",command:"+camMouseLook",description:"Enable mouse look camera control",syntax:"+camMouseLook",icon:"ğŸ–±ï¸"},cam_turn_to_face:{name:"Turn to Face Camera",command:"+camTurnToFace",description:"Turn ship to face camera direction",syntax:"+camTurnToFace",icon:"â†ªï¸"},look_up:{name:"Look Up",command:"lookUp",description:"Change point of view to look straight up",syntax:"lookUp",icon:"â¬†ï¸"},look_down:{name:"Look Down",command:"lookDown",description:"Change point of view to look straight down",syntax:"lookDown",icon:"â¬‡ï¸"}}},communication:{name:"Communication",icon:"fas fa-comments",description:"Chat and team communication",commands:{team_message:{name:"Team Message",command:"team",description:"Send message to team",syntax:"team message",icon:"ğŸ’¬",customizable:!0,parameters:{verb:{type:"select",default:"team",options:["say","team","zone"]},message:{type:"text",default:"Message text here"}}},local_message:{name:"Local Message",command:"say",description:"Send message to local area",syntax:"say message",icon:"ğŸ“¢",customizable:!0,parameters:{verb:{type:"select",default:"say",options:["say","team","zone"]},message:{type:"text",default:"Message text here"}}},zone_message:{name:"Zone Message",command:"zone",description:"Send message to zone",syntax:"zone message",icon:"ğŸ“¡",customizable:!0,parameters:{verb:{type:"select",default:"zone",options:["say","team","zone"]},message:{type:"text",default:"Message text here"}}}}},system:{name:"System",icon:"fas fa-cogs",description:"UI and system commands",commands:{toggle_hud:{name:"Toggle HUD",command:"++ShowGameUI",description:"Toggle HUD visibility",syntax:"++ShowGameUI",icon:"ğŸ‘ï¸"},screenshot:{name:"Screenshot",command:"screenshot",description:"Take a screenshot",syntax:"screenshot",icon:"ğŸ“·"},screenshot_jpg:{name:"Screenshot JPG",command:"screenshot_jpg",description:"Save a screenshot as JPG",syntax:"screenshot_jpg",icon:"ğŸ“·"},autofire_set:{name:"Set Autofire",command:"defaultautoattack",description:"Turn weapon autofire off and on. X = 1 turns it on and X = 0 turns it off.",syntax:"defaultautoattack <x>",icon:"ğŸ”",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},bind_save_file:{name:"Save Binds to File",command:"bind_save_file",description:"Save all your binds to a text file",syntax:"bind_save_file <filename>",icon:"ğŸ’¾",customizable:!0,parameters:{filename:{type:"text",default:"my_binds.txt"}}},bind_load_file:{name:"Load Binds from File",command:"bind_load_file",description:"Load a bind file into the client",syntax:"bind_load_file <filename>",icon:"ğŸ“",customizable:!0,parameters:{filename:{type:"text",default:"my_binds.txt"}}},combat_log:{name:"Toggle Combat Log",command:"CombatLog",description:"Turn combat log recording on/off (1=on, 0=off)",syntax:"CombatLog <1/0>",icon:"ğŸ“Š",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},chat_log:{name:"Toggle Chat Log",command:"ChatLog",description:"Turn chat log recording on/off (1=on, 0=off)",syntax:"ChatLog <1/0>",icon:"ğŸ’¬",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},missions:{name:"Show/Hide Missions",command:"missions",description:"Show/hide the mission journal",syntax:"missions",icon:"ğŸ“‹"},inventory:{name:"Show/Hide Inventory",command:"Inventory",description:"Show/hide your inventory",syntax:"Inventory",icon:"ğŸ’"},map:{name:"Show/Hide Map",command:"Map",description:"Show/hide the map window",syntax:"Map",icon:"ğŸ—ºï¸"},logout:{name:"Logout",command:"logout",description:"Log out the current character",syntax:"logout",icon:"ğŸšª"},quit:{name:"Quit Game",command:"quit",description:"Close the window",syntax:"quit",icon:"âŒ"},goto_character_select:{name:"Go to Character Select",command:"gotoCharacterSelect",description:"Go to the character select screen without logging out",syntax:"gotoCharacterSelect",icon:"ğŸ‘¤"},ui_load:{name:"Load UI Settings",command:"ui_load",description:"Loads default UI Windows save file, usually Live\\ui_settings.txt",syntax:"ui_load",icon:"ğŸ“‚"},ui_load_file:{name:"Load UI Settings File",command:"ui_load_file",description:"Loads named UI Windows save file",syntax:"ui_load_file <filename>",icon:"ğŸ“‚",customizable:!0,parameters:{filename:{type:"text",default:"ui_settings.txt"}}},ui_save:{name:"Save UI Settings",command:"ui_save",description:"Saves UI layout to default UI Window save file, usually Live\\ui_settings.txt",syntax:"ui_save",icon:"ğŸ’¾"},ui_save_file:{name:"Save UI Settings File",command:"ui_save_file",description:"Saves UI layout to named UI Window save file",syntax:"ui_save_file <filename>",icon:"ğŸ’¾",customizable:!0,parameters:{filename:{type:"text",default:"ui_settings.txt"}}},ui_cancel:{name:"UI Cancel",command:"uiCancel",description:'Respond "Cancel" to an open dialog box; may not work in all dialogs',syntax:"uiCancel",icon:"âŒ"},ui_ok:{name:"UI OK",command:"uiOK",description:'Respond "OK" to an open dialog box; may not work in all dialogs',syntax:"uiOK",icon:"âœ…"},ui_gen_layers_reset:{name:"Reset UI Layout",command:"ui_GenLayersReset",description:"Resets the layout, used for when the server updates movable window positions",syntax:"ui_GenLayersReset",icon:"ğŸ”„"},ui_resolution:{name:"Print UI Resolution",command:"ui_resolution",description:"Print the current UI screen resolution",syntax:"ui_resolution",icon:"ğŸ“"},ui_tooltip_delay:{name:"Set Tooltip Delay",command:"ui_TooltipDelay",description:"Sets the additional delay, in seconds, before tooltips appear",syntax:"ui_TooltipDelay <seconds>",icon:"â±ï¸",customizable:!0,parameters:{seconds:{type:"number",min:0,max:10,default:.5,step:.1}}},remember_ui_lists:{name:"Remember UI Lists",command:"RememberUILists",description:"Whether to remember UI List Column placement and width",syntax:"RememberUILists <1/0>",icon:"ğŸ“‹",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},ui_remember_positions:{name:"Remember UI Positions",command:"UIRememberPositions",description:"Whether to remember UI sizes and positions. On by default",syntax:"UIRememberPositions <1/0>",icon:"ğŸ“",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},safe_login:{name:"Safe Login",command:"SafeLogin",description:"If true, then log the player back into their most recent static map instead of anything else",syntax:"SafeLogin <1/0>",icon:"ğŸ›¡ï¸",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},show_game_ui:{name:"Show Game UI",command:"ShowGameUI",description:"Show the game UI",syntax:"ShowGameUI",icon:"ğŸ®"},show_game_ui_no_extra_keybinds:{name:"Show Game UI (No Extra Keybinds)",command:"ShowGameUINoExtraKeyBinds",description:"This command does not add any keybinds for showing the UI when the user presses escape",syntax:"ShowGameUINoExtraKeyBinds",icon:"ğŸ®"},change_instance:{name:"Change Instance",command:"ChangeInstance",description:"Change to an already created instance of the same map. Only works while not at red alert",syntax:"ChangeInstance",icon:"ğŸ”„"},net_timing_graph:{name:"Net Timing Graph",command:"netTimingGraph",description:"Enable or disable the network timing graph (0=disable, 1=enable)",syntax:"netTimingGraph <0/1>",icon:"ğŸ“Š",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},net_timing_graph_alpha:{name:"Net Timing Graph Alpha",command:"netTimingGraphAlpha",description:"Set transparency level for network timing graph (50=highest transparency, 255=no transparency)",syntax:"netTimingGraphAlpha <50-255>",icon:"ğŸ¨",customizable:!0,parameters:{alpha:{type:"number",min:50,max:255,default:255}}},net_timing_graph_paused:{name:"Net Timing Graph Paused",command:"netTimingGraphPaused",description:"Pause or resume the network timing graph (0=pause disabled, 1=pause enabled)",syntax:"netTimingGraphPaused <0/1>",icon:"â¸ï¸",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:0}}},netgraph:{name:"Net Graph",command:"netgraph",description:"Display SND and RCV network data as text (1=enabled, 0=disabled)",syntax:"netgraph <0/1>",icon:"ğŸŒ",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}}}}},templates:{space_combat:{basic_attack:{name:"Basic Attack Sequence",description:"Target enemy and fire all weapons",commands:["Target_Enemy_Near","FireAll"]},defensive_sequence:{name:"Defensive Sequence",description:"Target self and activate defensive abilities",commands:["Target_Self","+power_exec Distribute_Shields"]},alpha_strike:{name:"Alpha Strike",description:"Full offensive sequence with buffs",commands:["Target_Enemy_Near","FireAll"]},healing_sequence:{name:"Emergency Healing",description:"Self-healing and damage control",commands:["Target_Self","+power_exec Distribute_Shields"]}},ground_combat:{basic_ground_attack:{name:"Basic Ground Attack",description:"Target and attack sequence for ground combat",commands:["Target_Enemy_Near","+STOTrayExecByTray 0 0"]}}},defaultProfiles:{default:{name:"Default",description:"Default keybind configuration",currentEnvironment:"space",builds:{space:{keys:{Space:["+TrayExecByTray 8 0","+TrayExecByTray 8 1","+TrayExecByTray 8 2","+TrayExecByTray 8 3","+TrayExecByTray 8 4","+TrayExecByTray 8 5","+TrayExecByTray 8 6","+TrayExecByTray 8 7","+TrayExecByTray 8 8","+TrayExecByTray 8 9"],F1:["+TrayExecByTray 9 0","+TrayExecByTray 9 1","+TrayExecByTray 9 2","+TrayExecByTray 9 3","+TrayExecByTray 9 4","+TrayExecByTray 9 5","+TrayExecByTray 9 6","+TrayExecByTray 9 7","+TrayExecByTray 9 8","+TrayExecByTray 9 9"],F2:["+TrayExecByTray 3 0","+TrayExecByTray 3 1","+TrayExecByTray 3 2","+TrayExecByTray 3 3","+TrayExecByTray 3 4"],F3:["+TrayExecByTray 3 5","+TrayExecByTray 3 6","+TrayExecByTray 3 7","+TrayExecByTray 3 8","+TrayExecByTray 3 9"],F4:["+TrayExecByTray 4 0","+TrayExecByTray 4 1","+TrayExecByTray 4 2","+TrayExecByTray 4 3","+TrayExecByTray 4 4"],F5:["+TrayExecByTray 4 5","+TrayExecByTray 4 6","+TrayExecByTray 4 7","+TrayExecByTray 4 8","+TrayExecByTray 4 9"],Z:["+TrayExecByTray 6 0","+TrayExecByTray 6 1","+TrayExecByTray 6 2","+TrayExecByTray 6 3","+TrayExecByTray 6 4"],C:["+TrayExecByTray 6 5","+TrayExecByTray 6 6","+TrayExecByTray 6 7","+TrayExecByTray 6 8","+TrayExecByTray 6 9"],"`":["Target_Enemy_Near_ForArc 90","PlayerSay Target Arc=90"],"Alt+`":["Target_Enemy_Near_ForArc 180","PlayerSay Target Arc=180"],LSHIFT:["FireAll"],F9:["dynFxSetFXExclusionList_Space"],F10:["toggle_combatlog"],F11:["bind_load_file Default_space.txt"],numpad0:["toggle_default_auto_attack_off"],numpad1:["toggle_default_auto_attack_on"]}},ground:{keys:{X:["+TrayExecByTray 7 0","+TrayExecByTray 7 1","+TrayExecByTray 7 2","+TrayExecByTray 7 3","+TrayExecByTray 7 4","+TrayExecByTray 7 5","+TrayExecByTray 7 6","+TrayExecByTray 7 7","+TrayExecByTray 7 8","+TrayExecByTray 7 9"],F1:["+TrayExecByTray 6 0","+TrayExecByTray 6 1","+TrayExecByTray 6 2"],F2:["+TrayExecByTray 6 3","+TrayExecByTray 6 4","+TrayExecByTray 6 5"],F3:["+TrayExecByTray 6 6","+TrayExecByTray 6 7","+TrayExecByTray 6 8","+TrayExecByTray 6 9"],T:["+TrayExecByTray 5 0","+TrayExecByTray 5 1","+TrayExecByTray 5 2","+TrayExecByTray 5 3","+TrayExecByTray 5 4"],Y:["+TrayExecByTray 5 5","+TrayExecByTray 5 6","+TrayExecByTray 5 7","+TrayExecByTray 5 8","+TrayExecByTray 5 9"],F9:["dynFxSetFXExclusionList_Ground"],F10:["toggle_combatlog"],F11:["bind_load_file Default_ground.txt"]}},alias:{keys:{}}},aliases:{toggle_combatlog:{commands:["toggle_combatlog_on"],description:""},toggle_combatlog_off:{commands:["combatlog 0","PlayerSay Toggle Combat Log: Off",'alias toggle_combatlog "toggle_combatlog_on"',"combatlog"],description:""},toggle_combatlog_on:{commands:["combatlog 1","PlayerSay Toggle Combat Log: On",'alias toggle_combatlog "toggle_combatlog_off"',"combatlog"],description:""},toggle_default_auto_attack:{commands:["toggle_default_auto_attack_on"],description:""},toggle_default_auto_attack_off:{commands:["defaultautoattack 0","PlayerSay Toggle Default Auto Attack: Off",'alias toggle_default_auto_attack "toggle_default_auto_attack_on"'],description:""},toggle_default_auto_attack_on:{commands:["defaultautoattack 1","PlayerSay Toggle Default Auto Attack: On",'alias toggle_default_auto_attack "toggle_default_auto_attack_off"'],description:""}},created:"2025-07-11T00:19:39.458Z",lastModified:"2025-07-11T02:01:08.466Z",migrationVersion:"2.0.0",id:"default_space",keybindMetadata:{space:{Space:{stabilizeExecutionOrder:!0},F1:{stabilizeExecutionOrder:!0},F2:{stabilizeExecutionOrder:!0},F3:{stabilizeExecutionOrder:!0},F4:{stabilizeExecutionOrder:!0},F5:{stabilizeExecutionOrder:!0},Z:{stabilizeExecutionOrder:!0},C:{stabilizeExecutionOrder:!0}},ground:{X:{stabilizeExecutionOrder:!0},F3:{stabilizeExecutionOrder:!0},F2:{stabilizeExecutionOrder:!0},F1:{stabilizeExecutionOrder:!0},T:{stabilizeExecutionOrder:!0},Y:{stabilizeExecutionOrder:!0}}},aliasMetadata:{},selections:{space:"F1",alias:"toggle_combatlog",ground:"F1"},vertigoSettings:{selectedEffects:{space:[],ground:[]},showPlayerSay:!0}}},keys:{common:{name:"Common Keys",description:"Most frequently used keys",keys:[{key:"Space",description:"Spacebar"},{key:"1",description:"Number 1"},{key:"2",description:"Number 2"},{key:"3",description:"Number 3"},{key:"4",description:"Number 4"},{key:"5",description:"Number 5"},{key:"F1",description:"Function Key 1"},{key:"F2",description:"Function Key 2"},{key:"F3",description:"Function Key 3"},{key:"F4",description:"Function Key 4"},{key:"Tab",description:"Tab"},{key:"enter",description:"Main Enter Key"},{key:"Shift",description:"Shift"},{key:"Control",description:"Control"},{key:"ALT",description:"Alt"}]},letters:{name:"Letter Keys",description:"A-Z keyboard letters",keys:[{key:"A",description:"Key A"},{key:"B",description:"Key B"},{key:"C",description:"Key C"},{key:"D",description:"Key D"},{key:"E",description:"Key E"},{key:"F",description:"Key F"},{key:"G",description:"Key G"},{key:"H",description:"Key H"},{key:"I",description:"Key I"},{key:"J",description:"Key J"},{key:"K",description:"Key K"},{key:"L",description:"Key L"},{key:"M",description:"Key M"},{key:"N",description:"Key N"},{key:"O",description:"Key O"},{key:"P",description:"Key P"},{key:"Q",description:"Key Q"},{key:"R",description:"Key R"},{key:"S",description:"Key S"},{key:"T",description:"Key T"},{key:"U",description:"Key U"},{key:"V",description:"Key V"},{key:"W",description:"Key W"},{key:"X",description:"Key X"},{key:"Y",description:"Key Y"},{key:"Z",description:"Key Z"}]},numbers:{name:"Number Keys",description:"Number row and numpad",keys:[{key:"0",description:"Number 0"},{key:"6",description:"Number 6"},{key:"7",description:"Number 7"},{key:"8",description:"Number 8"},{key:"9",description:"Number 9"},{key:"numpad0",description:"Numerical Keypad 0"},{key:"numpad1",description:"Numerical Keypad 1"},{key:"numpad2",description:"Numerical Keypad 2"},{key:"numpad3",description:"Numerical Keypad 3"},{key:"numpad4",description:"Numerical Keypad 4"},{key:"numpad5",description:"Numerical Keypad 5"},{key:"numpad6",description:"Numerical Keypad 6"},{key:"numpad7",description:"Numerical Keypad 7"},{key:"numpad8",description:"Numerical Keypad 8"},{key:"numpad9",description:"Numerical Keypad 9"},{key:"Decimal",description:"Numerical Keypad Decimal"},{key:"Divide",description:"Numerical Keypad Divide"},{key:"Multiply",description:"Multiply (*)"},{key:"Subtract",description:"Subtract (-)"},{key:"Add",description:"Add (+)"},{key:"numpadenter",description:"Numerical Keypad Enter"}]},function:{name:"Function Keys",description:"F1-F24 function keys",keys:[{key:"F5",description:"Function Key 5"},{key:"F6",description:"Function Key 6"},{key:"F7",description:"Function Key 7"},{key:"F8",description:"Function Key 8"},{key:"F9",description:"Function Key 9"},{key:"F10",description:"Function Key 10"},{key:"F11",description:"Function Key 11"},{key:"F12",description:"Function Key 12"},{key:"F13",description:"Function Key 13"},{key:"F14",description:"Function Key 14"},{key:"F15",description:"Function Key 15"},{key:"F16",description:"Function Key 16"},{key:"F17",description:"Function Key 17"},{key:"F18",description:"Function Key 18"},{key:"F19",description:"Function Key 19"},{key:"F20",description:"Function Key 20"},{key:"F21",description:"Function Key 21"},{key:"F22",description:"Function Key 22"},{key:"F23",description:"Function Key 23"},{key:"F24",description:"Function Key 24"}]},arrows:{name:"Arrow & Navigation",description:"Arrow keys and navigation",keys:[{key:"Up",description:"Arrow Key: Up"},{key:"Down",description:"Arrow Key: Down"},{key:"Left",description:"Arrow Key: Left"},{key:"Right",description:"Arrow Key: Right"},{key:"Home",description:"Home"},{key:"End",description:"End"},{key:"PageUp",description:"Page Up"},{key:"PageDown",description:"Page Down"},{key:"insert",description:"Insert"},{key:"delete",description:"Delete"}]},modifiers:{name:"Modifier Keys",description:"Shift, Ctrl, Alt variations",keys:[{key:"ALT",description:"Alt"},{key:"LALT",description:"Alt (Left)"},{key:"RALT",description:"Alt (Right)"},{key:"CTRL",description:"Control"},{key:"LCTRL",description:"Control (Left)"},{key:"RCTRL",description:"Control (Right)"}]},symbols:{name:"Symbol Keys",description:"Punctuation and symbols",keys:[{key:"[",description:"["},{key:"]",description:"]"},{key:"\\",description:"\\"},{key:",",description:"Comma (,)"},{key:".",description:"Period (.)"},{key:"/",description:"Divide (/)"},{key:"`",description:"Tilda Key (~)"}]},mouse:{name:"Mouse Controls",description:"Mouse buttons and scroll",keys:[{key:"Lbutton",description:"Mouse Left Press"},{key:"Rbutton",description:"Mouse Right Press"},{key:"Middleclick",description:"Mouse Middle Click"},{key:"Button1",description:"Mouse Button 1"},{key:"Button2",description:"Mouse Button 2"},{key:"Button3",description:"Mouse Button 3"},{key:"Button4",description:"Mouse Button 4"},{key:"Button5",description:"Mouse Button 5"},{key:"Button6",description:"Mouse Button 6"},{key:"Button7",description:"Mouse Button 7"},{key:"Button8",description:"Mouse Button 8"},{key:"Button9",description:"Mouse Button 9"},{key:"Button10",description:"Mouse Button 10"},{key:"Wheelplus",description:"Mouse Scroll Up"},{key:"Wheelminus",description:"Mouse Scroll Down"}]},gamepad:{name:"Xbox Controller",description:"Xbox/Gamepad controls",keys:[{key:"Joy1",description:"XBOX Contr [Start]"},{key:"Joy2",description:"XBOX Contr [Back]"},{key:"Joy3",description:"XBOX Contr [L Thumb depress]"},{key:"Joy4",description:"XBOX Contr [R Thumb depress]"},{key:"Joy5",description:"XBOX Contr [Left Bumper]"},{key:"Joy6",description:"XBOX Contr [Right Bumper]"},{key:"Joy7",description:"XBOX Contr [Left Trigger]"},{key:"Joy8",description:"XBOX Contr [Right Trigger]"},{key:"Joy9",description:"XBOX Contr [A Button]"},{key:"Joy10",description:"XBOX Contr [B Button]"},{key:"Joy11",description:"XBOX Contr [X Button]"},{key:"Joy12",description:"XBOX Contr [Y Button]"},{key:"Joypad_up",description:"XBOX Contr [Pad up]"},{key:"Joypad_down",description:"XBOX Contr [Pad down]"},{key:"Joypad_left",description:"XBOX Contr [Pad left]"},{key:"Joypad_right",description:"XBOX Contr [Pad right]"},{key:"Lstick_up",description:"XBOX Contr [Left Stick up]"},{key:"Lstick_down",description:"XBOX Contr [Left Stick down]"},{key:"Lstick_left",description:"XBOX Contr [Left Stick left]"},{key:"Lstick_right",description:"XBOX Contr [Left Stick right]"},{key:"Rstick_up",description:"XBOX Contr [Right Stick up]"},{key:"Rstick_down",description:"XBOX Contr [Right Stick down]"},{key:"Rstick_left",description:"XBOX Contr [Right Stick left]"},{key:"Rstick_right",description:"XBOX Contr [Right Stick right]"}]}},validation:{keyNamePattern:"USE_STO_KEY_NAMES",aliasNamePattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,maxCommandsPerKey:20,maxKeysPerProfile:100},settings:{version:"1.0.0",autoSave:!0,maxUndoSteps:50,defaultMode:"space",language:"en"},variables:{target:{variable:"$Target",description:"Replaced with the name of your current target",example:"team Target [$Target]",usableIn:["communication","custom","aliases"],notes:"If your target's name is 'froggyMonster', this will output 'Target [froggyMonster]'"}},vfxEffects:{space:[{label:"Advanced inhibiting turret shield bubble",effect:"Fx_Rep_Temporal_Ship_Chroniton_Stabilization_Proc"},{label:"Approaching Agony",effect:"Cfx_Lockboxfx_Cb29_Ship_Agony_Field"},{label:"Attack Pattern Alpha",effect:"Fx_Ship_Tac_Attackpatternalpha"},{label:"Attack Pattern Beta",effect:"Fx_Ship_Tac_Attackpatternbeta"},{label:"Attack Pattern Delta",effect:"Fx_Ship_Tac_Attackpatterndelta"},{label:"Attack Pattern Omega",effect:"Fx_Ship_Tac_Attackpatternomega"},{label:"Beacon of Kahless",effect:"Fx_Er_Bbs_Beacon_Of_Kahless_Flash"},{label:"Boost Morale",effect:"Fx_Ship_Spec_Powers_Command_Boost_Morale_Bufffx,Cfx_Ship_Spec_Powers_Command_Boost_Morale_Activate"},{label:"Brace for Impact",effect:"Fx_Bop_Braceforimpact,Cfx_Ship_Sci_Hazardemitter_Buff"},{label:"Breath of the Dragon",effect:"Fx_Ship_Cp_T6_Hysperian_Dragonbreath"},{label:"Call Emergency Artillery",effect:"Fx_Ships_Boffs_Cmd_Callartillery_Activate,Fx_Ships_Boffs_Cmd_Callartillery_Explosion"},{label:"Competitive Engine Buff Effect",effect:"Fx_Ship_Mod_Haste_Buff_Gen"},{label:"Co-opt Energy Weapons",effect:"Fx_Capt_Powers_Ship_Sci_Coopt_Energy_Wep_Aoe,Cfx_Capt_Powers_Ship_Sci_Coopt_Energy_Wep_Area"},{label:"Concentrate Fire Power",effect:"Fx_Ships_Boff_Cmd_Confire_Activatefx,Cfx_Ships_Boff_Cmd_Confire_Mark"},{label:"Cnidarian Jellyfish AoE",effect:"Cfx_Ship_Sp_T6_Jellyfish_Cnidarian_Defense_Aoe"},{label:"Dark Matter Anomaly",effect:"Cfx_Ship_Console_Dark_Matter_Anamoly_Costumefx"},{label:"Delphic Tear",effect:"Fx_Ships_Consoles_Cb21_Delphictear"},{label:"Destabilising Resonance Beam",effect:"P_Er_Ship_Destabilizing_Resonance_Beam_Aoe_Particles"},{label:"Elachi Walker Combat Pet (3 effects)",effect:"Soundfx_Elachiwalker_Footstep_Pet,Fx_Er_Tfo_Elachi_Walker_Combat_Pet_Deathfx,Soundfx_Elachiwalker_Petsummon"},{label:"Electrified Anomalies Trait",effect:"Fx_Tp_Ship_T6_Risian_Science_Electrified_Anomalies_Arc_Foe,Fx_Tp_Ship_T6_Risian_Science_Electrified_Anomalies_Arc_Friend"},{label:"Emergency Pwr to Shields",effect:"Fx_Ship_Eng_Emergencypowershields"},{label:"Emergency Pwr to Wep",effect:"Fx_Ship_Eng_Emergencypowerweapons"},{label:"Engineering Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Engineering_Teambuff"},{label:"Engineering Team",effect:"Cfx_Ship_Crewteam_Engineeringteam_Buff"},{label:"EPS Power Transfer",effect:"Cfx_Ship_Eng_Epspowertransfer_Target"},{label:"Focus Frenzy",effect:"Fx_Skilltree_Ship_Ffrenzy_Activatefx"},{label:"Go Down Fighting",effect:"Fx_Bop_Godownfighting"},{label:"Hangar Pet Rank Up",effect:"Fx_Ship_Levelup_Fighter_Rankup"},{label:"Hazard Emitters",effect:"Cfx_Ship_Sci_Hazardemitter_Buff"},{label:"Intel Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Intel_Teambuff"},{label:"Intel Team (uses 3 effects)",effect:"Cfx_Ship_Cruiser_Auras_Taunt,Cfx_Spc_Boffpowers_Intel_Intelteam_Buff,Fx_Ships_Intel_Lyinginwait"},{label:"Kemocite on ship animation",effect:"C1_E_Ship_Xindi_Lockboxcb15_Kemocite_Weaponry_Bufffx"},{label:"Kemocite HitFX ring",effect:"Fx_Ship_Xindi_Lockboxcb15_Kemocite_Weaponry_Aoe_Proc"},{label:"Kentari Ferocity Weapons Glow",effect:"P_Trait_Powers_Ship_Lukari_Colony_Kentari_Ferocity_Weapons_Glow"},{label:"Kobayashi Maru powerup silenced",effect:"Fx_Evr_Kmaru_Ship_Dev_Resupply_Drop_Powerup_Bufffx,Fx_Evr_Kmaru_Ship_Dev_Resupply_Drop_Powerup"},{label:"Less Obvious Loot Drop Common",effect:"Cfx_Space_Loot_Drop_Common_Costumefx"},{label:"Less Obvious Loot Drop Uncommon",effect:"Cfx_Space_Loot_Drop_Uncommon_Costumefx"},{label:"Less Obvious Loot Drop Rare",effect:"Cfx_Space_Loot_Drop_Rare_Costumefx"},{label:"Less Obvious Loot Drop Very Rare",effect:"Cfx_Space_Loot_Drop_Veryrare_Costumefx"},{label:"Less Obvious Loot Drop Lock Box",effect:"Cfx_Space_Loot_Drop_Chancebox_Costumefx"},{label:"Less Obvious Loot Drop Dilithium",effect:"Cfx_Space_Loot_Drop_Dilithium_Costumefx"},{label:"Miraculous Repairs",effect:"Fx_Bop_Miracleworker"},{label:"MW - Align Shield Frequencies",effect:"Fx_Spc_Boffpowers_Miracleworker_Alignshieldfrequencies_Hitfx"},{label:"MW - Destabilize Warp Core",effect:"Fx_Spc_Boffpowers_Miracleworker_Destabilizewarpcore"},{label:"MW - Exceed rated limits",effect:"Fx_Spc_Boffpowers_Miracleworker_Energyweaponsexceedratedlimits_Dot_Hitfx,Fx_Spc_Boffpowers_Miracleworker_Energyweaponsexceedratedlimits"},{label:"MW - Fix em up (and other green glows)",effect:"Fx_Ship_Mod_Damage_Buff"},{label:"MW - Mixed Armaments Synergy",effect:"Fx_Spc_Boffpowers_Miracleworker_Mixedarmamentssynergy"},{label:"MW - Narrow Sensor Bands",effect:"Fx_Spc_Boffpowers_Miracleworker_Narrowsensorbands"},{label:"MW - Null Pointer Flood",effect:"Fx_Spc_Boffpowers_Miracleworker_Nullpointerflood"},{label:"MW - Reroute shilds to Hull containment",effect:"Fx_Spc_Boffpowers_Miracleworker_Rerouteshieldstohullcontainment,Cfx_Spc_Boffpowers_Miracleworker_Rerouteshieldstohullcontainment"},{label:"Nadion Inversion",effect:"Fx_Bop_Nadioinversion"},{label:"Nanoprobe Shield Generator (Dyson Rep)",effect:"Cfx_Rp_Dyson_Ship_Reactive_Shielding"},{label:"Neutronic Eddies",effect:"Cfx_Ships_Cp_T6_Risian_Science_Neutronic_Edides_Costumefx"},{label:"Overwhelm Emitters",effect:"Fx_Ships_Boff_Cmd_Owemitters_Activatefx"},{label:"Photonic Officer",effect:"Fx_Bop_Photonicofficer_activate"},{label:"PILOT - Clean Getaway",effect:"Fx_Spc_Boff_Pilot_Cleangetaway_Activate"},{label:"PILOT - Coolant Ignition (mostly)",effect:"Fx_Spc_Boff_Pilot_Coolantinjection_Ignite,Fx_Spc_Boff_Pilot_Coolantinjection_Costumefx"},{label:"PILOT - Deploy Countermeasures",effect:"Fx_Spc_Boff_Pilot_Deploycm"},{label:"PILOT - Fly her apart",effect:"Cfx_Spc_Boff_Pilot_Flyapart_Dot"},{label:"PILOT - Form Up (mostly)",effect:"Fx_Spc_Boff_Pilot_Formup_Teleport,Fx_Spc_Boff_Pilot_Formup_Buff_Wepbuff"},{label:"PILOT - hold Together",effect:"Cfx_Spc_Boff_Pilot_Holdtogether"},{label:"PILOT - Lambda",effect:"Fx_Ship_Mod_Damage_Buff,Fx_Spc_Boff_Pilot_Aplambda_Bufffx,Fx_Spc_Boff_Pilot_Aplambda"},{label:"PILOT - Lock Trajectory",effect:"Fx_Spc_Boff_Pilot_Flares_Switch,Cfx_Spc_Boff_Pilot_Locktrajectory"},{label:"PILOT - Pilot Team",effect:"Cfx_Spc_Boff_Pilot_Pilotteam_Buff"},{label:"PILOT - Reroute Reserves to Weapons",effect:"Fx_Spc_Boff_Pilot_Reroute_Wepbuff,Fx_Spc_Boff_Pilot_Reroute_Activate"},{label:"PILOT - Subspace Boom",effect:"Cfx_Spc_Boff_Pilot_Ssboom_Costumefx_Neverdie,Fx_Spc_Boff_Pilot_Ssboom_Boom"},{label:"Plasma Storm",effect:"Cfx_Ship_Cp_Cb27_Generate_Plasma_Storm_Costumefx"},{label:"Rally Point Marker",effect:"Cfx_Ships_Boff_Cmd_Rallypoint_Marker"},{label:"Reverse Shield Polarity",effect:"Cfx_Ship_Eng_Reverseshieldpolarity_Buff"},{label:"Scattering Field",effect:"Cfx_Ship_Sci_Dampeningfield_Aoe,Cfx_Ship_Sci_Dampeningfield_Shield_Buff"},{label:"Science Team",effect:"Cfx_Ship_Crewteam_Scienceteam_Buff"},{label:"Science Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Science_Teambuff"},{label:"Soliton Wave Generator (uses 4 effects)",effect:"Cfx_Ship_Risa_Loot_Soliton_Wave_Suckfx_Target,Cfx_Ship_Risa_Loot_Soliton_Wave_Suckfx,Cfx_Ship_Risa_Loot_Soliton_Wave_Out,Cfx_Ship_Risa_Loot_Soliton_Wave_In"},{label:"Spore Infused Anomalies",effect:"Fx_Trait_Powers_Ship_T6_Somerville_Sia_Blast"},{label:"Subspace Vortex Teleport Effect",effect:"Fx_Ship_Xindi_Lockboxcb15_Subspace_Vortex_Teleport"},{label:"Suppression Barrage",effect:"Cfx_Ships_Boff_Cmd_Sbarrage_Buff"},{label:"Surgical Strikes",effect:"Fx_Spc_Boffpowers_Int_Sstrikes_Buff"},{label:"Tactical Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Tactical_Teambuff"},{label:"Tactical Initiative",effect:"Fx_Bop_Tacticalinitiative"},{label:"Tactical Team",effect:"Cfx_Ship_Crewteam_Tacticalteam_Buff"},{label:"Target Rich Environment",effect:"Fx_Ship_Trait_Cb20_Targetrichenvironment"},{label:"Temporal Anchor",effect:"Cfx_Ship_Trait_Temporal_Anchor_Costumefx"},{label:"Temporal Vortex Probe",effect:"C1_Eventreward_Fcd_Temporal_Vortex_Costumefx,Fx_Eventreward_Fcd_Temporal_Vortex_Blast"},{label:"Timeline Collapse (5 effects!)",effect:"Cfx_Ship_Temp_Tcollapse_Costume,Fx_Ship_Temp_Tcollapse_Hitfx,Fx_Ship_Temp_Tcollapse_Explode,Fx_Ship_Temp_Tcollapse_Beamhitfx,Fx_Ship_Temp_Tcollapse"},{label:"V'Ger Torpedo (Volatile Digital Transformation)",effect:"Fx_Ship_Torpedo_Plasma_Vger_Anniv_Explode,Cfx_Ship_Torpedo_Vger_Disintegrate_In_Tintable"},{label:"Viral Impulse Burst",effect:"Fx_Spc_Boffpowers_int_Viralimpulse"},{label:"Vulcan Jelly Fish Eject Red Matter",effect:"Cfx_ship_jellyfish_eject_red_matter_costumefx"},{label:"Vulnerability Assessment Sweep",effect:"Fx_Capt_Powers_Ship_Tac_Vulnerability_Assessment_Sweep"}],ground:[{label:"Agony Field Generator",effect:"Fx_Ground_Lockboxfx_Cb29_Agony_Field_Generator"},{label:"Anti-time ground",effect:"Cfx_Rep_Temp_Char_Kit_Sci_Antitime_Entanglement_Field_Costumefx"},{label:"Ball Lightning",effect:"Cfx_Char_Kit_Univ_Sum_Ball_Lightning_Costumefx"},{label:"Chaos Blaze",effect:"Cfx_Char_Chaos_Blaze_Aoe"},{label:"Conussive Tachyon Emission",effect:"fx_Char_Delta_Rep_Cte_Aoe"},{label:"Disco Ball (Party Bomb)",effect:"Cfx_Char_Device_Partybomb"},{label:"Dot-7 Drone Support Field",effect:"Cfx_Er_Bbs_char_Dot7_Drone_support_Field"},{label:"Eng Proficiency (Character Glow)",effect:"Cfx_Ground_Kit_Eng_Engineeringproficiency"},{label:"Ever Watchful",effect:"Cfx_Ground_Kit_Tac_Overwatch_Bufffx,Fx_Ground_Kit_Tac_Overwatch_Activatefx"},{label:"Herald AP Beam Projector ground weapon",effect:"Fx_Char_Icoenergy_Rifle_Energyblast,Fx_Char_Icoenergy_Assault_Beam_Lockbox"},{label:"Lava Floor",effect:"Cfx_Char_Kit_Univ_Sum_The_Floor_Is_Lava_Costumefx,Cfx_Char_Kit_Univ_Sum_The_Floor_Is_Lava_Geyser"},{label:"Less Obvious Loot Drop Common",effect:"Cfx_Gnd_Loot_Drop_Common_Costumefx"},{label:"Less Obvious Loot Drop Uncommon",effect:"Cfx_Gnd_Loot_Drop_Uncommon_Costumefx"},{label:"Less Obvious Loot Drop Rare",effect:"Cfx_Gnd_Loot_Drop_Rare_Costumefx"},{label:"Less Obvious Loot Drop Very Rare",effect:"Cfx_Gnd_Loot_Drop_Veryrare_Costumefx"},{label:"Less Obvious Loot Drop Lock Box",effect:"Cfx_Gnd_Loot_Drop_Chancebox_Costumefx"},{label:"Less Obvious Loot Drop Dilithium",effect:"Cfx_Gnd_Loot_Drop_Dilithium_Costumefx"},{label:"Motivation (Tac Kit Module)",effect:"Cfx_Ground_Kit_Tac_Motivation_Buff,Fx_Ground_Kit_Tac_Motivation"},{label:"Orbital Devastation",effect:"Fx_Char_Voth_Orbitalstrike_Chasebeam"},{label:"Pahvan Crystal Prism noisy tether",effect:"Cfx_Er_Tfo_Pahvan_Crystal_Prism_Tether_Beam"},{label:"Rally Cry",effect:"Fx_Ground_Kit_Tac_Rallycry"},{label:"Red Riker Gun Sound effect",effect:"Cfx_Ep_Winterevent_Redriker_Sniper_Chargefx"},{label:"Scientific Aptitude (character glow)",effect:"Cfx_Ground_Kit_Sci_Scientificaptitude"},{label:"Solar Gateway",effect:"Fx_Char_Ico_Capt_Portal,Fx_Char_Ico_Capt_Portal_Sunbeam"},{label:"Smoke Grenade",effect:"Fx_Char_Grenade_smoke_costume,Fx_Char_Grenade_Smoke_Explode"},{label:"Sompek Energy Rebounder",effect:"Fx_Env_Gnd_Qadhos_Arena_Phaserhazard_Cylinder_Turret"},{label:"Strike Team III (character red glow)",effect:"Cfx_Ground_Kit_Tac_Striketeam"},{label:"Symphony of Lightning Char Glow",effect:"Fx_Er_Featured_Char_Kuumaarke_Wristgun_Tir_bufffx"},{label:"Symphony of Lightning Drone AoE",effect:"Cfx_Er_Featured_Char_Kuumaarke_Set_Symphony_Of_Lightning_Drone_Aoe"},{label:"Symphony of Lightning STRIKE",effect:"Fx_Er_Featured_Char_Kuumaarke_Set_Symphony_Of_Lightning_Strike"},{label:"Trajectory Bending",effect:"Cfx_Char_Xindi_Cb15_Tac_Kit_Trajectory_Bending"},{label:"Visual Dampening Field",effect:"Cfx_Char_Trait_Mirror_Vdfield"}]}};window.STO_DATA=l,window.VFX_EFFECTS=l.vfxEffects,window.COMMAND_CATEGORIES=l.commands,window.COMMANDS={},Object.entries(l.commands).forEach(([e,t])=>{Object.entries(t.commands).forEach(([t,i])=>{window.COMMANDS[t]={...i,category:e,key:t}})}),window.KEY_LAYOUTS=l.keyLayouts||{qwerty:{name:"QWERTY",rows:[[{key:"Escape",display:"Esc"},{key:"F1",display:"F1"},{key:"F2",display:"F2"},{key:"F3",display:"F3"},{key:"F4",display:"F4"},{key:"F5",display:"F5"},{key:"F6",display:"F6"},{key:"F7",display:"F7"},{key:"F8",display:"F8"},{key:"F9",display:"F9"},{key:"F10",display:"F10"},{key:"F11",display:"F11"},{key:"F12",display:"F12"}],[{key:"`",display:"`"},{key:"1",display:"1"},{key:"2",display:"2"},{key:"3",display:"3"},{key:"4",display:"4"},{key:"5",display:"5"},{key:"6",display:"6"},{key:"7",display:"7"},{key:"8",display:"8"},{key:"9",display:"9"},{key:"0",display:"0"},{key:"-",display:"-"},{key:"=",display:"="},{key:"Backspace",display:"Backspace"}],[{key:"Tab",display:"Tab"},{key:"Q",display:"Q"},{key:"W",display:"W"},{key:"E",display:"E"},{key:"R",display:"R"},{key:"T",display:"T"},{key:"Y",display:"Y"},{key:"U",display:"U"},{key:"I",display:"I"},{key:"O",display:"O"},{key:"P",display:"P"},{key:"[",display:"["},{key:"]",display:"]"},{key:"\\",display:"\\"}],[{key:"CapsLock",display:"Caps"},{key:"A",display:"A"},{key:"S",display:"S"},{key:"D",display:"D"},{key:"F",display:"F"},{key:"G",display:"G"},{key:"H",display:"H"},{key:"J",display:"J"},{key:"K",display:"K"},{key:"L",display:"L"},{key:";",display:";"},{key:"'",display:"'"},{key:"Enter",display:"Enter"}],[{key:"Shift",display:"Shift"},{key:"Z",display:"Z"},{key:"X",display:"X"},{key:"C",display:"C"},{key:"V",display:"V"},{key:"B",display:"B"},{key:"N",display:"N"},{key:"M",display:"M"},{key:",",display:","},{key:".",display:"."},{key:"/",display:"/"},{key:"Shift",display:"Shift"}],[{key:"Ctrl",display:"Ctrl"},{key:"Alt",display:"Alt"},{key:"Space",display:"Space"},{key:"Alt",display:"Alt"},{key:"Ctrl",display:"Ctrl"}]]}},window.DEFAULT_SETTINGS={keyLayout:"qwerty",autoSave:l.settings?.autoSave||!0,showTooltips:!0,exportFormat:"txt",maxUndoSteps:l.settings?.maxUndoSteps||50,defaultMode:l.settings?.defaultMode||"space",language:l.settings?.language||"en"},window.SAMPLE_PROFILES=Object.values(l.defaultProfiles).map(e=>({id:e.name.toLowerCase().replace(/\s+/g,"_"),name:e.name,description:e.description,currentEnvironment:e.currentEnvironment||"space",builds:e.builds||{space:{keys:{}},ground:{keys:{}}},created:(new Date).toISOString(),modified:(new Date).toISOString()})),window.SAMPLE_ALIASES={attack_sequence:{name:"Attack Sequence",commands:["Target_Enemy_Near","FireAll"],description:"Target and attack nearest enemy"},defensive_sequence:{name:"Defensive Sequence",commands:["Target_Self","+power_exec Distribute_Shields"],description:"Self-target and activate defensive abilities"},heal_sequence:{name:"Healing Sequence",commands:["Target_Self","+STOTrayExecByTray 3 0 $$ +STOTrayExecByTray 3 1"],description:"Emergency healing and repair sequence"}},window.TRAY_CONFIG={maxTrays:10,slotsPerTray:10,defaultTray:0,maxCommandsPerSlot:1},window.localizeCommandData=function(){const e=window.i18next;e&&Object.entries(l.commands).forEach(([t,i])=>{i.name&&(i.name=e.t(`command_categories.${t}`)),i.description&&(i.description=e.t(`category_descriptions.${t}`)),Object.entries(i.commands).forEach(([t,i])=>{i.name&&(i.name=e.t(`command_definitions.${t}.name`)),i.description&&(i.description=e.t(`command_definitions.${t}.description`))})})};class d extends Error{constructor(e,t="STO_ERROR"){super(e),this.name="STOError",this.code=t}}class m extends d{constructor(e,t="VFX_ERROR"){super(e,t),this.name="VertigoError"}}"undefined"!=typeof window&&(window.STOError=d,window.VertigoError=m,window.InvalidEnvironmentError=class extends m{constructor(e){super(`Invalid environment '${e}'. Valid environments are: space, ground`,"INVALID_ENVIRONMENT"),this.environment=e}},window.InvalidEffectError=class extends m{constructor(e,t){super(`Invalid effect '${e}' for environment '${t}'`,"INVALID_EFFECT"),this.effectName=e,this.environment=t}});const h=e=>"string"==typeof e,u=()=>{let e,t;const i=new Promise((i,a)=>{e=i,t=a});return i.resolve=e,i.reject=t,i},p=e=>null==e?"":""+e,f=/###/g,y=e=>e&&e.indexOf("###")>-1?e.replace(f,"."):e,_=e=>!e||h(e),g=(e,t,i)=>{const a=h(t)?t.split("."):t;let n=0;for(;n<a.length-1;){if(_(e))return{};const t=y(a[n]);!e[t]&&i&&(e[t]=new i),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++n}return _(e)?{}:{obj:e,k:y(a[n])}},b=(e,t,i)=>{const{obj:a,k:n}=g(e,t,Object);if(void 0!==a||1===t.length)return void(a[n]=i);let s=t[t.length-1],r=t.slice(0,t.length-1),o=g(e,r,Object);for(;void 0===o.obj&&r.length;)s=`${r[r.length-1]}.${s}`,r=r.slice(0,r.length-1),o=g(e,r,Object),o?.obj&&void 0!==o.obj[`${o.k}.${s}`]&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=i},v=(e,t)=>{const{obj:i,k:a}=g(e,t);if(i&&Object.prototype.hasOwnProperty.call(i,a))return i[a]},w=(e,t,i)=>{for(const a in t)"__proto__"!==a&&"constructor"!==a&&(a in e?h(e[a])||e[a]instanceof String||h(t[a])||t[a]instanceof String?i&&(e[a]=t[a]):w(e[a],t[a],i):e[a]=t[a]);return e},k=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const x=e=>h(e)?e.replace(/[&<>"'\/]/g,e=>S[e]):e,T=[" ",",","?","!",";"],C=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}(20),$=(e,t,i=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const a=t.split(i);let n=e;for(let e=0;e<a.length;){if(!n||"object"!=typeof n)return;let t,s="";for(let r=e;r<a.length;++r)if(r!==e&&(s+=i),s+=a[r],t=n[s],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&r<a.length-1)continue;e+=r-e+1;break}n=t}return n},B=e=>e?.replace("_","-"),E={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class A{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||E,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,a){return a&&!this.debug?null:(h(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new A(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new A(this.logger,e)}}var I=new A;class F{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const i=this.observers[e].get(t)||0;this.observers[e].set(t,i+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([e,i])=>{for(let a=0;a<i;a++)e(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,a])=>{for(let n=0;n<a;n++)i.apply(i,[e,...t])})}}class P extends F{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i,a={}){const n=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,s=void 0!==a.ignoreJSONStructure?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let r;e.indexOf(".")>-1?r=e.split("."):(r=[e,t],i&&(Array.isArray(i)?r.push(...i):h(i)&&n?r.push(...i.split(n)):r.push(i)));const o=v(this.data,r);return!o&&!t&&!i&&e.indexOf(".")>-1&&(e=r[0],t=r[1],i=r.slice(2).join(".")),!o&&s&&h(i)?$(this.data?.[e]?.[t],i,n):o}addResource(e,t,i,a,n={silent:!1}){const s=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator;let r=[e,t];i&&(r=r.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(r=e.split("."),a=t,t=r[1]),this.addNamespaces(t),b(this.data,r,a),n.silent||this.emit("added",e,t,i,a)}addResources(e,t,i,a={silent:!1}){for(const a in i)(h(i[a])||Array.isArray(i[a]))&&this.addResource(e,t,a,i[a],{silent:!0});a.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,a,n,s={silent:!1,skipCopy:!1}){let r=[e,t];e.indexOf(".")>-1&&(r=e.split("."),a=i,i=t,t=r[1]),this.addNamespaces(t);let o=v(this.data,r)||{};s.skipCopy||(i=JSON.parse(JSON.stringify(i))),a?w(o,i,n):o={...o,...i},b(this.data,r,o),s.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var M={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,i,a,n){return e.forEach(e=>{t=this.processors[e]?.process(t,i,a,n)??t}),t}};const N={},D=e=>!h(e)&&"boolean"!=typeof e&&"number"!=typeof e;class L extends F{constructor(e,t={}){var i,a;super(),i=e,a=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{i[e]&&(a[e]=i[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=I.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const i={...t};if(null==e)return!1;const a=this.resolve(e,i);return void 0!==a?.res}extractFromKey(e,t){let i=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===i&&(i=":");const a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let n=t.ns||this.options.defaultNS||[];const s=i&&e.indexOf(i)>-1,r=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,i)=>{t=t||"",i=i||"";const a=T.filter(e=>t.indexOf(e)<0&&i.indexOf(e)<0);if(0===a.length)return!0;const n=C.getRegExp(`(${a.map(e=>"?"===e?"\\?":e).join("|")})`);let s=!n.test(e);if(!s){const t=e.indexOf(i);t>0&&!n.test(e.substring(0,t))&&(s=!0)}return s})(e,i,a));if(s&&!r){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:h(n)?[n]:n};const s=e.split(i);(i!==a||i===a&&this.options.ns.indexOf(s[0])>-1)&&(n=s.shift()),e=s.join(a)}return{key:e,namespaces:h(n)?[n]:n}}translate(e,t,i){let a="object"==typeof t?{...t}:t;if("object"!=typeof a&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(a={...a}),a||(a={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const n=void 0!==a.returnDetails?a.returnDetails:this.options.returnDetails,s=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,{key:r,namespaces:o}=this.extractFromKey(e[e.length-1],a),c=o[o.length-1];let l=void 0!==a.nsSeparator?a.nsSeparator:this.options.nsSeparator;void 0===l&&(l=":");const d=a.lng||this.language,m=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===d?.toLowerCase())return m?n?{res:`${c}${l}${r}`,usedKey:r,exactUsedKey:r,usedLng:d,usedNS:c,usedParams:this.getUsedParamsDetails(a)}:`${c}${l}${r}`:n?{res:r,usedKey:r,exactUsedKey:r,usedLng:d,usedNS:c,usedParams:this.getUsedParamsDetails(a)}:r;const u=this.resolve(e,a);let p=u?.res;const f=u?.usedKey||r,y=u?.exactUsedKey||r,_=void 0!==a.joinArrays?a.joinArrays:this.options.joinArrays,g=!this.i18nFormat||this.i18nFormat.handleAsObject,b=void 0!==a.count&&!h(a.count),v=L.hasDefaultValue(a),w=b?this.pluralResolver.getSuffix(d,a.count,a):"",k=a.ordinal&&b?this.pluralResolver.getSuffix(d,a.count,{ordinal:!1}):"",S=b&&!a.ordinal&&0===a.count,x=S&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${w}`]||a[`defaultValue${k}`]||a.defaultValue;let T=p;g&&!p&&v&&(T=x);const C=D(T),$=Object.prototype.toString.apply(T);if(!(g&&T&&C&&["[object Number]","[object Function]","[object RegExp]"].indexOf($)<0)||h(_)&&Array.isArray(T))if(g&&h(_)&&Array.isArray(p))p=p.join(_),p&&(p=this.extendTranslation(p,e,a,i));else{let t=!1,n=!1;!this.isValidLookup(p)&&v&&(t=!0,p=x),this.isValidLookup(p)||(n=!0,p=r);const o=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&n?void 0:p,m=v&&x!==p&&this.options.updateMissing;if(n||t||m){if(this.logger.log(m?"updateKey":"missingKey",d,c,r,m?x:p),s){const e=this.resolve(r,{...a,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let i=0;i<t.length;i++)e.push(t[i]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(a.lng||this.language):e.push(a.lng||this.language);const i=(e,t,i)=>{const n=v&&i!==p?i:o;this.options.missingKeyHandler?this.options.missingKeyHandler(e,c,t,n,m,a):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,c,t,n,m,a),this.emit("missingKey",e,c,t,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&b?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,a);S&&a[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{i([e],r+t,a[`defaultValue${t}`]||x)})}):i(e,r,x))}p=this.extendTranslation(p,e,a,u,i),n&&p===r&&this.options.appendNamespaceToMissingKey&&(p=`${c}${l}${r}`),(n||t)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}${l}${r}`:r,t?p:void 0,a))}else{if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,T,{...a,ns:o}):`key '${r} (${this.language})' returned an object instead of string.`;return n?(u.res=e,u.usedParams=this.getUsedParamsDetails(a),u):e}if(s){const e=Array.isArray(T),t=e?[]:{},i=e?y:f;for(const e in T)if(Object.prototype.hasOwnProperty.call(T,e)){const n=`${i}${s}${e}`;t[e]=v&&!p?this.translate(n,{...a,defaultValue:D(x)?x[e]:void 0,joinArrays:!1,ns:o}):this.translate(n,{...a,joinArrays:!1,ns:o}),t[e]===n&&(t[e]=T[e])}p=t}}return n?(u.res=p,u.usedParams=this.getUsedParamsDetails(a),u):p}extendTranslation(e,t,i,a,n){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const s=h(e)&&(void 0!==i?.interpolation?.skipOnVariables?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let r;if(s){const t=e.match(this.interpolator.nestingRegexp);r=t&&t.length}let o=i.replace&&!h(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),e=this.interpolator.interpolate(e,o,i.lng||this.language||a.usedLng,i),s){const t=e.match(this.interpolator.nestingRegexp);r<(t&&t.length)&&(i.nest=!1)}!i.lng&&a&&a.res&&(i.lng=this.language||a.usedLng),!1!==i.nest&&(e=this.interpolator.nest(e,(...e)=>n?.[0]!==e[0]||i.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),i)),i.interpolation&&this.interpolator.reset()}const s=i.postProcess||this.options.postProcess,r=h(s)?[s]:s;return null!=e&&r?.length&&!1!==i.applyPostProcessor&&(e=M.handle(r,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e,t={}){let i,a,n,s,r;return h(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(i))return;const o=this.extractFromKey(e,t),c=o.key;a=c;let l=o.namespaces;this.options.fallbackNS&&(l=l.concat(this.options.fallbackNS));const d=void 0!==t.count&&!h(t.count),m=d&&!t.ordinal&&0===t.count,u=void 0!==t.context&&(h(t.context)||"number"==typeof t.context)&&""!==t.context,p=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);l.forEach(e=>{this.isValidLookup(i)||(r=e,N[`${p[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(r)||(N[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${a}" for languages "${p.join(", ")}" won't get resolved as namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(a=>{if(this.isValidLookup(i))return;s=a;const r=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(r,c,a,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(a,t.count,t));const i=`${this.options.pluralSeparator}zero`,n=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(r.push(c+e),t.ordinal&&0===e.indexOf(n)&&r.push(c+e.replace(n,this.options.pluralSeparator)),m&&r.push(c+i)),u){const a=`${c}${this.options.contextSeparator}${t.context}`;r.push(a),d&&(r.push(a+e),t.ordinal&&0===e.indexOf(n)&&r.push(a+e.replace(n,this.options.pluralSeparator)),m&&r.push(a+i))}}let o;for(;o=r.pop();)this.isValidLookup(i)||(n=o,i=this.getResource(a,e,o,t))}))})}),{res:i,usedKey:a,exactUsedKey:n,usedLng:s,usedNS:r}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,i,a={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,a):this.resourceStore.getResource(e,t,i,a)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!h(e.replace);let a=i?e.replace:e;if(i&&void 0!==e.count&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!i){a={...a};for(const e of t)delete a[e]}return a}static hasDefaultValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}class K{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=I.create("languageUtils")}getScriptPartFromCode(e){if(!(e=B(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=B(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(h(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const i=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(i)||(t=i)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const i=this.getScriptPartFromCode(e);if(this.isSupportedCode(i))return t=i;const a=this.getLanguagePartFromCode(e);if(this.isSupportedCode(a))return t=a;t=this.options.supportedLngs.find(e=>e===a?e:e.indexOf("-")<0&&a.indexOf("-")<0?void 0:e.indexOf("-")>0&&a.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===a||0===e.indexOf(a)&&a.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),h(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),a=[],n=e=>{e&&(this.isSupportedCode(e)?a.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return h(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&n(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&n(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&n(this.getLanguagePartFromCode(e))):h(e)&&n(this.formatLanguageCode(e)),i.forEach(e=>{a.indexOf(e)<0&&n(this.formatLanguageCode(e))}),a}}const j={zero:0,one:1,two:2,few:3,many:4,other:5},z={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class O{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=I.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const i=B("dev"===e?"en":e),a=t.ordinal?"ordinal":"cardinal",n=JSON.stringify({cleanedCode:i,type:a});if(n in this.pluralRulesCache)return this.pluralRulesCache[n];let s;try{s=new Intl.PluralRules(i,{type:a})}catch(i){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),z;if(!e.match(/-|_/))return z;const a=this.languageUtils.getLanguagePartFromCode(e);s=this.getRule(a,t)}return this.pluralRulesCache[n]=s,s}needsPlural(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,i={}){return this.getSuffixes(e,i).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((e,t)=>j[e]-j[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,i={}){const a=this.getRule(e,i);return a?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const R=(e,t,i,a=".",n=!0)=>{let s=((e,t,i)=>{const a=v(e,i);return void 0!==a?a:v(t,i)})(e,t,i);return!s&&n&&h(i)&&(s=$(e,i,a),void 0===s&&(s=$(t,i,a))),s},U=e=>e.replace(/\$/g,"$$$$");class q{constructor(e={}){this.logger=I.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:a,prefix:n,prefixEscaped:s,suffix:r,suffixEscaped:o,formatSeparator:c,unescapeSuffix:l,unescapePrefix:d,nestingPrefix:m,nestingPrefixEscaped:h,nestingSuffix:u,nestingSuffixEscaped:p,nestingOptionsSeparator:f,maxReplaces:y,alwaysFormat:_}=e.interpolation;this.escape=void 0!==t?t:x,this.escapeValue=void 0===i||i,this.useRawValueToEscape=void 0!==a&&a,this.prefix=n?k(n):s||"{{",this.suffix=r?k(r):o||"}}",this.formatSeparator=c||",",this.unescapePrefix=l?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=m?k(m):h||k("$t("),this.nestingSuffix=u?k(u):p||k(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=y||1e3,this.alwaysFormat=void 0!==_&&_,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,a){let n,s,r;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const n=R(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(n,void 0,i,{...a,...t,interpolationkey:e}):n}const n=e.split(this.formatSeparator),s=n.shift().trim(),r=n.join(this.formatSeparator).trim();return this.format(R(t,o,s,this.options.keySeparator,this.options.ignoreJSONStructure),r,i,{...a,...t,interpolationkey:s})};this.resetRegExp();const l=a?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=void 0!==a?.interpolation?.skipOnVariables?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>U(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?U(this.escape(e)):U(e)}].forEach(t=>{for(r=0;n=t.regex.exec(e);){const i=n[1].trim();if(s=c(i),void 0===s)if("function"==typeof l){const t=l(e,n,a);s=h(t)?t:""}else if(a&&Object.prototype.hasOwnProperty.call(a,i))s="";else{if(d){s=n[0];continue}this.logger.warn(`missed to pass in variable ${i} for interpolating ${e}`),s=""}else h(s)||this.useRawValueToEscape||(s=p(s));const o=t.safeValue(s);if(e=e.replace(n[0],o),d?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=n[0].length):t.regex.lastIndex=0,r++,r>=this.maxReplaces)break}}),e}nest(e,t,i={}){let a,n,s;const r=(e,t)=>{const i=this.nestingOptionsSeparator;if(e.indexOf(i)<0)return e;const a=e.split(new RegExp(`${i}[ ]*{`));let n=`{${a[1]}`;e=a[0],n=this.interpolate(n,s);const r=n.match(/'/g),o=n.match(/"/g);((r?.length??0)%2==0&&!o||o.length%2!=0)&&(n=n.replace(/'/g,'"'));try{s=JSON.parse(n),t&&(s={...t,...s})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${i}${n}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,e};for(;a=this.nestingRegexp.exec(e);){let o=[];s={...i},s=s.replace&&!h(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let c=!1;if(-1!==a[0].indexOf(this.formatSeparator)&&!/{.*}/.test(a[1])){const e=a[1].split(this.formatSeparator).map(e=>e.trim());a[1]=e.shift(),o=e,c=!0}if(n=t(r.call(this,a[1].trim(),s),s),n&&a[0]===e&&!h(n))return n;h(n)||(n=p(n)),n||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),n=""),c&&(n=o.reduce((e,t)=>this.format(e,t,i.lng,{...i,interpolationkey:a[1].trim()}),n.trim())),e=e.replace(a[0],n),this.regexp.lastIndex=0}return e}}const V=e=>{const t={};return(i,a,n)=>{let s=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(s={...s,[n.interpolationkey]:void 0});const r=a+JSON.stringify(s);let o=t[r];return o||(o=e(B(a),n),t[r]=o),o(i)}},G=e=>(t,i,a)=>e(B(i),a)(t);class W{constructor(e={}){this.logger=I.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const i=t.cacheInBuiltFormats?V:G;this.formats={number:i((e,t)=>{const i=new Intl.NumberFormat(e,{...t});return e=>i.format(e)}),currency:i((e,t)=>{const i=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>i.format(e)}),datetime:i((e,t)=>{const i=new Intl.DateTimeFormat(e,{...t});return e=>i.format(e)}),relativetime:i((e,t)=>{const i=new Intl.RelativeTimeFormat(e,{...t});return e=>i.format(e,t.range||"day")}),list:i((e,t)=>{const i=new Intl.ListFormat(e,{...t});return e=>i.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=V(t)}format(e,t,i,a={}){const n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(e=>e.indexOf(")")>-1)){const e=n.findIndex(e=>e.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,e)].join(this.formatSeparator)}return n.reduce((e,t)=>{const{formatName:n,formatOptions:s}=(e=>{let t=e.toLowerCase().trim();const i={};if(e.indexOf("(")>-1){const a=e.split("(");t=a[0].toLowerCase().trim();const n=a[1].substring(0,a[1].length-1);"currency"===t&&n.indexOf(":")<0?i.currency||(i.currency=n.trim()):"relativetime"===t&&n.indexOf(":")<0?i.range||(i.range=n.trim()):n.split(";").forEach(e=>{if(e){const[t,...a]=e.split(":"),n=a.join(":").trim().replace(/^'+|'+$/g,""),s=t.trim();i[s]||(i[s]=n),"false"===n&&(i[s]=!1),"true"===n&&(i[s]=!0),isNaN(n)||(i[s]=parseInt(n,10))}})}return{formatName:t,formatOptions:i}})(t);if(this.formats[n]){let t=e;try{const r=a?.formatParams?.[a.interpolationkey]||{},o=r.locale||r.lng||a.locale||a.lng||i;t=this.formats[n](e,o,{...s,...a,...r})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${n}`),e},e)}}class X extends F{constructor(e,t,i,a={}){super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=a,this.logger=I.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,a.backend,a)}queueLoad(e,t,i,a){const n={},s={},r={},o={};return e.forEach(e=>{let a=!0;t.forEach(t=>{const r=`${e}|${t}`;!i.reload&&this.store.hasResourceBundle(e,t)?this.state[r]=2:this.state[r]<0||(1===this.state[r]?void 0===s[r]&&(s[r]=!0):(this.state[r]=1,a=!1,void 0===s[r]&&(s[r]=!0),void 0===n[r]&&(n[r]=!0),void 0===o[t]&&(o[t]=!0)))}),a||(r[e]=!0)}),(Object.keys(n).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(n),pending:Object.keys(s),toLoadLanguages:Object.keys(r),toLoadNamespaces:Object.keys(o)}}loaded(e,t,i){const a=e.split("|"),n=a[0],s=a[1];t&&this.emit("failedLoading",n,s,t),!t&&i&&this.store.addResourceBundle(n,s,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const r={};this.queue.forEach(i=>{((e,t,i)=>{const{obj:a,k:n}=g(e,t,Object);a[n]=a[n]||[],a[n].push(i)})(i.loaded,[n],s),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(i,e),t&&i.errors.push(t),0!==i.pendingCount||i.done||(Object.keys(i.loaded).forEach(e=>{r[e]||(r[e]={});const t=i.loaded[e];t.length&&t.forEach(t=>{void 0===r[e][t]&&(r[e][t]=!0)})}),i.done=!0,i.errors.length?i.callback(i.errors):i.callback())}),this.emit("loaded",r),this.queue=this.queue.filter(e=>!e.done)}read(e,t,i,a=0,n=this.retryTimeout,s){if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:i,tried:a,wait:n,callback:s});this.readingCalls++;const r=(r,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}r&&o&&a<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,i,a+1,2*n,s)},n):s(r,o)},o=this.backend[i].bind(this.backend);if(2!==o.length)return o(e,t,r);try{const i=o(e,t);i&&"function"==typeof i.then?i.then(e=>r(null,e)).catch(r):r(null,i)}catch(e){r(e)}}prepareLoading(e,t,i={},a){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();h(e)&&(e=this.languageUtils.toResolveHierarchy(e)),h(t)&&(t=[t]);const n=this.queueLoad(e,t,i,a);if(!n.toLoad.length)return n.pending.length||a(),null;n.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e,t=""){const i=e.split("|"),a=i[0],n=i[1];this.read(a,n,"read",void 0,void 0,(i,s)=>{i&&this.logger.warn(`${t}loading namespace ${n} for language ${a} failed`,i),!i&&s&&this.logger.log(`${t}loaded namespace ${n} for language ${a}`,s),this.loaded(e,i,s)})}saveMissing(e,t,i,a,n,s={},r=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=i&&""!==i){if(this.backend?.create){const o={...s,isUpdate:n},c=this.backend.create.bind(this.backend);if(c.length<6)try{let n;n=5===c.length?c(e,t,i,a,o):c(e,t,i,a),n&&"function"==typeof n.then?n.then(e=>r(null,e)).catch(r):r(null,n)}catch(e){r(e)}else c(e,t,i,a,r,o)}e&&e[0]&&this.store.addResource(e[0],t,i,a)}}else this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const H=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),h(e[1])&&(t.defaultValue=e[1]),h(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const i=e[3]||e[2];Object.keys(i).forEach(e=>{t[e]=i[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Z=e=>(h(e.ns)&&(e.ns=[e.ns]),h(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),h(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),J=()=>{};class Y extends F{constructor(e={},t){var i;if(super(),this.options=Z(e),this.services={},this.logger=I,this.modules={external:[]},i=this,Object.getOwnPropertyNames(Object.getPrototypeOf(i)).forEach(e=>{"function"==typeof i[e]&&(i[e]=i[e].bind(i))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(h(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const i=H();this.options={...i,...this.options,...Z(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator);const a=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?I.init(a(this.modules.logger),this.options):I.init(null,this.options),e=this.modules.formatter?this.modules.formatter:W;const t=new K(this.options);this.store=new P(this.options.resources,this.options);const n=this.services;n.logger=I,n.resourceStore=this.store,n.languageUtils=t,n.pluralResolver=new O(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!e||this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format||(n.formatter=a(e),n.formatter.init(n,this.options),this.options.interpolation.format=n.formatter.format.bind(n.formatter)),n.interpolator=new q(this.options),n.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},n.backendConnector=new X(a(this.modules.backend),n.resourceStore,n,this.options),n.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(n.languageDetector=a(this.modules.languageDetector),n.languageDetector.init&&n.languageDetector.init(n,this.options.detection,this.options)),this.modules.i18nFormat&&(n.i18nFormat=a(this.modules.i18nFormat),n.i18nFormat.init&&n.i18nFormat.init(this)),this.translator=new L(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=J),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const n=u(),s=()=>{const e=(e,i)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),n.resolve(i),t(e,i)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?s():setTimeout(s,0),n}loadResources(e,t=J){let i=t;const a=h(e)?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===a?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return i();const e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};a?t(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),i(e)})}else i(null)}reloadResources(e,t,i){const a=u();return"function"==typeof e&&(i=e,e=void 0),"function"==typeof t&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=J),this.services.backendConnector.reload(e,t,e=>{a.resolve(),i(e)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&M.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const i=u();this.emit("languageChanging",e);const a=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},n=(n,s)=>{s?this.isLanguageChangingTo===e&&(a(s),this.translator.changeLanguage(s),this.isLanguageChangingTo=void 0,this.emit("languageChanged",s),this.logger.log("languageChanged",s)):this.isLanguageChangingTo=void 0,i.resolve((...e)=>this.t(...e)),t&&t(n,(...e)=>this.t(...e))},s=t=>{e||t||!this.services.languageDetector||(t=[]);const i=h(t)?t:t&&t[0],s=this.store.hasLanguageSomeTranslations(i)?i:this.services.languageUtils.getBestMatchFromCodes(h(t)?[t]:t);s&&(this.language||a(s),this.translator.language||this.translator.changeLanguage(s),this.services.languageDetector?.cacheUserLanguage?.(s)),this.loadResources(s,e=>{n(e,s)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),i}getFixedT(e,t,i){const a=(e,t,...n)=>{let s;s="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(n)):{...t},s.lng=s.lng||a.lng,s.lngs=s.lngs||a.lngs,s.ns=s.ns||a.ns,""!==s.keyPrefix&&(s.keyPrefix=s.keyPrefix||i||a.keyPrefix);const r=this.options.keySeparator||".";let o;return o=s.keyPrefix&&Array.isArray(e)?e.map(e=>`${s.keyPrefix}${r}${e}`):s.keyPrefix?`${s.keyPrefix}${r}${e}`:e,this.t(o,s)};return h(e)?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=i,a}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,n=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;const s=(e,t)=>{const i=this.services.backendConnector.state[`${e}|${t}`];return-1===i||0===i||2===i};if(t.precheck){const e=t.precheck(this,s);if(void 0!==e)return e}return!(!this.hasResourceBundle(i,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!s(i,e)||a&&!s(n,e)))}loadNamespaces(e,t){const i=u();return this.options.ns?(h(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=u();h(e)&&(e=[e]);const a=this.options.preload||[],n=e.filter(e=>a.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return n.length?(this.options.preload=a.concat(n),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services?.languageUtils||new K(H());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){return new Y(e,t)}cloneInstance(e={},t=J){const i=e.forkResourceStore;i&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},n=new Y(a);if(void 0===e.debug&&void 0===e.prefix||(n.logger=n.logger.clone(e)),["store","services","language"].forEach(e=>{n[e]=this[e]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},i){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((i,a)=>(i[a]={...e[t][a]},i),e[t]),e),{});n.store=new P(e,a),n.services.resourceStore=n.store}return n.translator=new L(n.services,a),n.translator.on("*",(e,...t)=>{n.emit(e,...t)}),n.init(a,t),n.translator.options=a,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Q=Y.createInstance();Q.createInstance=Y.createInstance,Q.createInstance,Q.dir,Q.init,Q.loadResources,Q.reloadResources,Q.use,Q.changeLanguage,Q.getFixedT,Q.t,Q.exists,Q.setDefaultNamespace,Q.hasLoadedNamespace,Q.loadNamespaces,Q.loadLanguages;var ee={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Save",explorer:"Explorer",import_keybinds:"Import Keybinds",import_environment:"Import Keybinds",import_environment_question:"Choose an environment to import this keybind file to",aliases:"Aliases",import_aliases:"Import Aliases",import_kbf_file:"Import KBF File",select_bindsets_to_import:"Select Bindsets to Import",select_bindsets_to_import_question:"This KBF file contains multiple bindsets. Choose which bindsets you want to import:",import_selected:"Import Selected",kbf_import_progress:"Importing KBF File",kbf_import_progress_message:"Please wait while the KBF file is being processed...",kbf_progress_layer:"Layer {{layer}}",kbf_progress_initializing:"Initializing...",kbf_progress_preparing:"Preparing to import...",import:"Import",backup:"Backup",backup_menu:"Backup",backup_application_state:"Backup Application State",restore_application_state:"Restore Application State",preferences:"Preferences",language:"Language",sync_folder_label:"Synchronization Folder:",no_folder_selected:"No folder selected",download:"Download",vfx:"VFX",dark_mode:"Dark Mode",light_mode:"Light Mode",load_default_data:"Load Default Data",reset_application:"Reset Application",set_sync_folder:"Set Sync Folder",sync_now:"Sync Now",about:"About",create:"Create",rename:"Rename",delete:"Delete",space:"Space",ground:"Ground",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"aliases",modified:"Modified",valid:"Valid",keys:"keys",keys_firstupper:"Keys",copy:"Copy",select_a_key_to_edit:"Select a key to edit",select_an_alias_to_edit:"Select an alias to edit",commands:"commands",command_singular:"command",no_key_selected:"No Key Selected",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"Select a key from the left panel to view and edit its command chain.",generated_command:"Generated Command:",generated_alias:"Generated Alias:",select_a_key_to_see_the_generated_command:"Select a key to see the generated command",select_an_alias_to_see_the_generated_command:"Select an alias to see the generated command",add_command:"Add Command",import_from_key_or_alias:"Import from Key or Alias",select_source_to_import_from:"Select source to import from:",clear_destination_chain_prior_to_import:"Clear destination chain prior to import",no_sources_available:"No sources available",error_loading_sources:"Error loading sources",please_select_a_source:"Please select a source",source_has_no_commands:"Source has no commands to import",commands_imported_successfully:"Imported {{count}} commands from {{source}}",cross_environment_import_warning:"Warning: {{dropped}} {{sourceEnv}}-specific commands were dropped when importing to {{targetEnv}}",no_compatible_commands_to_import:"No compatible commands to import after filtering",command_library:"Command Library",add_new_key:"Add New Key",ctrl:"Ctrl",alt:"Alt",shift:"Shift",cancel:"Cancel",custom:"Custom",profile:"Profile",profile_name:"Profile Name:",description_optional:"Description (optional):",alias_name:"Alias Name:",select_key_dialog_title:"Select Key",space_effects:"Space Effects",selected:"selected",ground_effects:"Ground Effects",generated_aliases:"Generated Aliases:",space_alias:"Space Alias",ground_alias:"Ground Alias",about_sto_tools_keybind_manager:"About STO Tools Keybind Manager",features:"Features:",visual_keybind_editor:"Visual keybind editor",sto_command_library_with_search_and_categorization:"STO command library with search and categorization",multiple_profile_management_create_clone_rename_delete:"Multiple profile management (create, clone, rename, delete)",custom_alias_system_for_complex_command_sequences:"Custom alias system for complex command sequences",vertigo_inspired_vfx_manager_for_visual_effects_control:"VERTIGO-inspired VFX Manager for visual effects control",import_export_keybind_and_alias_files_and_project_backups:"Import/export keybind and alias files, and project backups",real_time_validation_and_command_preview:"Real-time validation and command preview",quick_start:"Quick Start:",create_a_new_profile_or_use_the_default_profile:"Create a new profile or use the default profile",default_profile_exists_title:"Default Profile Exists",default_profile_exists_message:'A profile named "Default" already exists. Loading default data would overwrite it. Do you want to continue?',select_keys_from_the_grid_and_add_commands_from_the_library:"Select keys from the grid and add commands from the library",use_the_command_chain_editor_to_build_complex_sequences:"Use the command chain editor to build complex sequences",export_your_keybinds_as_txt_files_for_use_in_sto:"Export your keybinds as .txt files for use in STO",resources:"Resources:",copyright:"Â© 2025 STO Tools. All rights reserved.",got_it:"Got it!",file_explorer:"File Explorer",select_an_item_on_the_left_to_preview_export:"Select an item on the left to preview export",close:"Close",filter_keys:"Filter keys...",filter_aliases:"Filter aliases...",search_commands:"Search commands...",enter_profile_name:"Enter profile name",describe_this_keybind_profile:"Describe this keybind profile",search_keys:"Search keys...",settings:"Settings",select_profile:"Select Profile",new_profile:"New Profile",clone_profile:"Clone Profile",rename_profile:"Rename Profile",delete_profile:"Delete Profile",space_mode:"Space Mode",ground_mode:"Ground Mode",alias_mode:"Alias Mode",unsaved_changes:"Unsaved Changes",unknown_command:"Unknown Command",validation_status:"Validation Status",bound_keys:"Bound Keys",toggle_between_grid_and_categorized_view:"Toggle between grid and categorized view",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Ensures consistent execution order by mirroring commands (Phase 1: left-to-right, Phase 2: right-to-left)",validate_command_chain:"Validate Command Chain",command_chain:"Command Chain",alias_chain:"Alias Chain",chain_for_key:"{{chainType}} for {{key}}",clear_all_commands:"Clear All Commands",copy_to_clipboard:"Copy to Clipboard",environment:"Environment",generated:"Generated",created_by:"Created by",statistics:"Statistics",total_commands:"Total Commands:",command_aliases:"Command Aliases",vfx_aliases:"VFX Aliases",bindset_enable:"Enable",vfx_alias_space:"VFX Alias: Space",vfx_alias_ground:"VFX Alias: Ground",vfx_alias_combined:"VFX Alias: Combined Space/Ground",vfx_suppression_loaded:"VFX Suppression Loaded",vfx_suppression_for_environment:"VFX suppression for {{environment}} environment",vfx_suppression_for_all_environments:"VFX suppression for all environments",command_categories:{targeting:"Targeting",combat:"Combat",cosmetic:"Cosmetic",bridge_officer:"Bridge Officer",tray:"Tray Execution",power:"Shield Management",movement:"Movement",camera:"Camera",communication:"Communication",system:"System",custom:"Custom"},key_type:{function_keys:"Function Keys",letters_numbers:"Letters & Numbers",numberpad:"Numberpad",modifier_keys:"Modifier Keys",navigation:"Navigation",system_keys:"System Keys",mouse_wheel:"Mouse & Wheel",symbols_punctuation:"Symbols & Punctuation",other_keys:"Other Keys"},command_definitions:{add_custom_command:{name:"Add Custom Command",description:"Add any STO command as raw text"},target:{name:"Target by Name",description:"Target entity by name (requires quotes)"},target_enemy_near:{name:"Target Nearest Enemy",description:"Target the nearest enemy in view"},target_friend_near:{name:"Target Nearest Friend",description:"Target the nearest friendly entity"},target_self:{name:"Target Self",description:"Target your own ship/character"},target_clear:{name:"Clear Target",description:"Remove current target lock"},target_teammate_1:{name:"Target Teammate 1",description:"Target first team member"},target_teammate_2:{name:"Target Teammate 2",description:"Target second team member"},target_teammate_3:{name:"Target Teammate 3",description:"Target third team member"},target_teammate_4:{name:"Target Teammate 4",description:"Target fourth team member"},fire_all:{name:"Fire All Weapons",description:"Fire all weapons"},fire_phasers:{name:"Fire Energy Weapons",description:"Fire all Energy Weapons"},fire_torps:{name:"Fire Torpedoes",description:"Fire all Torpedos"},fire_mines:{name:"Fire Mines",description:"Fire all Mines"},fire_phasers_torps:{name:"Fire Phasers & Torpedoes",description:"Fire phasers & torpedos"},fire_projectiles:{name:"Fire Projectiles",description:"Fire torpedos & mines"},setactivecostume:{name:"Set Active Costume",description:"Sets current active costume. Requires two modifiers."},custom_tray:{name:"Tray Execution",description:"Execute specific tray slot"},tray_with_backup:{name:"Tray Execution with Backup",description:"Execute specific tray slot with backup ability"},tray_range:{name:"Tray Range Execution",description:"Execute a range of tray slots"},tray_range_with_backup:{name:"Tray Range with Backup",description:"Execute a range of tray slots with backup abilities"},whole_tray:{name:"Whole Tray Execution",description:"Execute all slots in a tray"},whole_tray_with_backup:{name:"Whole Tray with Backup",description:"Execute all slots in a tray with backup tray"},distribute_shields:{name:"Distribute Shields",description:"Evenly distributes shields as if clicking in the middle of the ship and shields icon"},reroute_shields_rear:{name:"Reroute Shields Rear",description:"Route shield power to rear facing"},reroute_shields_left:{name:"Reroute Shields Left",description:"Route shield power to left side"},reroute_shields_right:{name:"Reroute Shields Right",description:"Route shield power to right side"},reroute_shields_forward:{name:"Reroute Shields Forward",description:"Route shield power to forward facing"},full_impulse:{name:"Full Impulse",description:"Engage full impulse drive"},reverse:{name:"Reverse",description:"Reverse engines"},throttle_adjust:{name:"Throttle Adjust",description:"Increase or decrease the throttle by amount"},throttle_set:{name:"Throttle Set",description:"Set the throttle to a specific position (negative = reverse, 0 = stop)"},throttle_toggle:{name:"Throttle Toggle",description:"Alternates between full throttle and full stop"},turn_left:{name:"Turn Left",description:"Turn ship left (continuous while held)"},turn_right:{name:"Turn Right",description:"Turn ship right (continuous while held)"},pitch_up:{name:"Pitch Up",description:"Pitch ship nose up (space altitude change)"},pitch_down:{name:"Pitch Down",description:"Pitch ship nose down (space altitude change)"},strafe_left:{name:"Strafe Left",description:"Strafe ship left"},strafe_right:{name:"Strafe Right",description:"Strafe ship right"},forward:{name:"Forward",description:"Move forward"},backward:{name:"Backward",description:"Move backward"},auto_forward:{name:"Auto Forward",description:"Character moves forward until given new movement commands"},follow:{name:"Follow Target",description:"Follow the targeted entity"},follow_cancel:{name:"Cancel Follow",description:"Stop following and forget about the target"},zoom_in:{name:"Zoom In",description:"Zoom the camera in"},zoom_out:{name:"Zoom Out",description:"Zoom the camera out"},zoom_in_small:{name:"Zoom In Small",description:"Zoom the camera in slightly"},zoom_out_small:{name:"Zoom Out Small",description:"Zoom the camera out slightly"},cam_distance:{name:"Set Camera Distance",description:"Sets the camera distance from the player"},cam_reset:{name:"Reset Camera",description:"Reset the camera position to default"},cam_target_lock:{name:"Lock Camera to Target",description:"Lock or unlock the camera to the target"},cam_cycle_distance:{name:"Cycle Camera Distance",description:"Cycle the camera distance between several preset values"},cam_mouse_look:{name:"Mouse Look",description:"Enable mouse look camera control"},cam_turn_to_face:{name:"Turn to Face Camera",description:"Turn ship to face camera direction"},look_up:{name:"Look Up",description:"Change point of view to look straight up"},look_down:{name:"Look Down",description:"Change point of view to look straight down"},team_message:{name:"Team Message",description:"Send message to team"},local_message:{name:"Local Message",description:"Send message to local area"},zone_message:{name:"Zone Message",description:"Send message to zone"},toggle_hud:{name:"Toggle HUD",description:"Toggle HUD visibility"},screenshot:{name:"Screenshot",description:"Take a screenshot"},screenshot_jpg:{name:"Screenshot JPG",description:"Save a screenshot as JPG"},autofire_set:{name:"Set Autofire",description:"Turn weapon autofire off and on. X = 1 turns it on and X = 0 turns it off."},bind_save_file:{name:"Save Binds to File",description:"Save all your binds to a text file"},bind_load_file:{name:"Load Binds from File",description:"Load a bind file into the client"},combat_log:{name:"Toggle Combat Log",description:"Turn on combat log. 1=on, 0=off, no param=print status. Prepending the command with ++ turns it into a toggle"},missions:{name:"Show/Hide Missions",description:"Show/hide the mission journal"},inventory:{name:"Show/Hide Inventory",description:"Show/hide your inventory"},map:{name:"Show/Hide Map",description:"Show/hide the map window"},logout:{name:"Logout",description:"Log out the current character."},quit:{name:"Quit Game",description:"Close the window."},ui_load:{name:"Load UI Settings",description:"Loads default UI Windows save file, usually Live\\ui_settings.txt"},ui_save:{name:"Save UI Settings",description:"Saves UI layout to default UI Window save file, usually Live\\ui_settings.txt"},ui_load_file:{name:"Load UI Settings File",description:"Loads named UI Windows save file"},ui_save_file:{name:"Save UI Settings File",description:"Saves UI layout to named UI Window save file"},ui_cancel:{name:"UI Cancel",description:'Respond "Cancel" to an open dialog box; may not work in all dialogs.'},ui_ok:{name:"UI OK",description:'Respond "OK" to an open dialog box; may not work in all dialogs.'},chat_log:{name:"Toggle Chat Log",description:"Turn on chat log. 1=on, 0=off, no param=print status. Prepending the command with ++ turns it into a toggle"},remember_ui_lists:{name:"Remember UI Lists",description:"Whether to remember UI List Column placement and width."},ui_remember_positions:{name:"Remember UI Positions",description:"Whether to remember UI sizes and positions. On by default."},safe_login:{name:"Safe Login",description:"If true, then log the player back into their most recent static map instead of anything else."},goto_character_select:{name:"Go to Character Select",description:"Go to the character select screen without logging out."},ui_gen_layers_reset:{name:"Reset UI Layout",description:"Resets the layout, used for when the server updates movable window positions"},ui_resolution:{name:"Print UI Resolution",description:"Print the current UI screen resolution."},ui_tooltip_delay:{name:"Set Tooltip Delay",description:"Sets the additional delay, in seconds, before tooltips appear"},show_game_ui:{name:"Show Game UI",description:"Show the game UI"},show_game_ui_no_extra_keybinds:{name:"Show Game UI (No Extra Keybinds)",description:"This command does not add any keybinds for showing the UI when the user presses escape"},change_instance:{name:"Change Instance",description:"Change to an already created instance of the same map. Only works while not at red alert."},aim:{name:"Aim/Scope",description:"Toggle scope on/off. In scope mode the player does more damage. Can either be used as a toggle or a press and hold"},holster:{name:"Holster Weapon",description:"Attempt to holster your active weapon"},holster_toggle:{name:"Holster Toggle",description:"Attempt to holster or draw your weapons"},unholster:{name:"Unholster Weapon",description:"Attempt to draw your active weapon"},toggle_shooter_mode:{name:"Toggle Shooter Mode",description:"Toggle shooter mode on/off"},shooter_primary:{name:"Shooter Primary",description:"Primary shooter mode action"},shooter_secondary:{name:"Shooter Secondary",description:"Secondary shooter mode action"},shooter_tertiary:{name:"Shooter Tertiary",description:"Tertiary shooter mode action"},shooter_clear_offset_tray_binds:{name:"Shooter Clear Offset Tray Binds",description:"Clear the starting location and movement of the yellow action box that appears on the tray while in shooter mode"},shooter_clear_overlay_tray_binds:{name:"Shooter Clear Overlay Tray Binds",description:"Clear overlay tray bindings for shooter mode"},shooter_set_offset_tray_binds:{name:"Shooter Set Offset Tray Binds",description:"Set the starting location and movement of the yellow action box that appears on the tray while in shooter mode"},shooter_set_overlay_tray_binds:{name:"Shooter Set Overlay Tray Binds",description:"Set overlay tray bindings for shooter mode"},setrallypoint:{name:"Set Rally Point",description:"Set a rally point for your current target"},setrallypointconsole:{name:"Set Rally Point (Console)",description:"Set a rally point for your current target (console variant)"},clearrallypoint:{name:"Clear Rally Point",description:"Clear the rally point for your current target"},clearallrallypoints:{name:"Clear All Rally Points",description:"Clear all the rally points"},assist:{name:"Assist",description:"Assist '<name>': Assists the Entity with the matching name. If no name is given, assists your current target."},net_timing_graph:{name:"Net Timing Graph",description:"Enable or disable the network timing graph (0=disable, 1=enable)"},net_timing_graph_alpha:{name:"Net Timing Graph Alpha",description:"Set transparency level for network timing graph (50=highest transparency, 255=no transparency)"},net_timing_graph_paused:{name:"Net Timing Graph Paused",description:"Pause or resume the network timing graph (0=pause disabled, 1=pause enabled)"},netgraph:{name:"Net Graph",description:"Display SND and RCV network data as text (1=enabled, 0=disabled)"},parameter_placeholders:{any_sto_command:"Enter any STO command (e.g., Target_Enemy_Near)",entity_name:"Enter entity name",first_modifier:"First modifier",second_modifier:"Second modifier",entity_name_optional:"Entity name (optional)"}},category_descriptions:{targeting:"Target selection and management",combat:"Weapon firing and combat actions",tray:"Execute abilities from action trays",power:"Shield power and distribution management",movement:"Ship movement and navigation",camera:"Camera control and view management",communication:"Chat and team communication",system:"UI and system commands",custom:"Custom commands"},no_aliases_defined:"No aliases defined",create_alias_to_get_started:"Create an alias to get started",please_select_a_key_first:"Please select a key first",please_select_an_alias_first:"Please select an alias first",no_active_profile:"No active profile",import_failed:"Import failed: {{error}}",storage_not_available:"Storage not available",no_aliases_found_in_file:"No aliases found in file",import_completed_keybinds:"Import completed: {{count}} keybinds",import_completed_aliases:"Import completed: {{count}} aliases",kbf_import_completed:"KBF import completed: {{bindsets}} bindset(s), {{keys}} key(s), {{aliases}} alias(es)",project_imported_successfully:"Project imported successfully: {{profileCount}} profiles",sync_folder_set:"Sync folder selected",failed_to_set_sync_folder:"Failed to select sync folder: {{error}}",sync_not_supported_firefox:"Sync folder functionality requires a Chromium-based browser (Chrome, Edge, etc.). Firefox does not support the required File System Access API.",sync_not_supported_title:"Sync Not Supported",sync_not_supported_detailed:"Sync functionality is not available in Firefox due to browser limitations. The File System Access API required for folder synchronization is only supported in Chromium-based browsers. You can still manually backup and restore your application state or use the File Explorer to copy your keybind and alias files.",sync_not_supported_secure_context:"Sync service is unavailable when served over HTTP. Please use HTTPS or access via file:// protocol to enable sync functionality.",sync_not_supported_secure_context_title:"Secure Context Required",sync_not_supported_secure_context_detailed:"Sync functionality requires a secure connection (HTTPS) or local file access (file://) to work. The File System Access API needed for folder synchronization is only available in secure contexts to protect your data. Please access this application via HTTPS or open it as a local file.",sync_not_supported_browser:"Your browser does not support the File System Access API required for sync functionality.",sync_not_supported_browser_title:"Browser Not Supported",sync_not_supported_browser_detailed:"Your browser does not support the File System Access API required for folder synchronization. Please try using a Chromium-based browser (Chrome, Edge, etc.) with a secure connection (HTTPS) or local file access.",no_sync_folder_selected:"No sync folder selected",project_synced_successfully:"Project synchronized successfully",sync_folder_contains_project_title:"Existing Sync Data Found",sync_folder_contains_project_prompt:"This folder already contains a project.json from a previous sync. Import it now instead of overwriting?",project_imported_from_sync_folder:"Application state imported from sync folder",sync_overwrite_existing_title:"Overwrite Sync Data?",sync_overwrite_existing_prompt:"Import declined. Overwrite the sync folder with current application state?",sync_operation_cancelled:"Sync cancelled",failed_to_import_project:"Failed to import project: {{error}}",permission_denied_to_folder:"Permission denied to write to folder",failed_to_sync_project:"Failed to sync project: {{error}}",synchronization:"Synchronization",advanced:"Advanced",synchronization_settings:"Synchronization Settings",advanced_settings:"Advanced Settings",sync_folder_description:"Choose a folder to automatically sync your projects",auto_sync:"Auto Sync",auto_sync_description:"Automatically sync changes to the selected folder",auto_sync_interval:"Auto Sync Interval",auto_sync_interval_description:"How often to automatically sync your changes",after_every_change:"After every change",every_1_minute:"Every 1 minute",every_2_minutes:"Every 2 minutes",every_5_minutes:"Every 5 minutes",bind_to_alias_mode:"Create keybind chains as aliases",bind_to_alias_mode_description:"When enabled, keybind chains are generated as aliases named by environment and key (e.g., 'space_q'), with keys bound to call the aliases.",preferences_saved:"Preferences saved successfully",vfx_manager_description:"Select visual effects to disable using dynFxSetFXExlusionList aliases. Effects are organized by environment.",app_description:"A comprehensive web-based tool for creating, editing, and managing Star Trek Online keybind configurations with visual editing and advanced features.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"Select a Space/Ground build or Aliases to preview export.",no_alias_selected:"No Alias Selected",select_alias_from_left_panel:"Select an alias from the left panel to view and edit its command chain.",select_key_from_left_panel:"Select a key from the left panel to view and edit its command chain.",failed_to_load_application:"Failed to load application",profile_created:'Profile "{{name}}" created',failed_to_create_profile:"Failed to create profile",failed_to_clone_profile:"Failed to clone profile",cannot_delete_the_last_profile:"Cannot delete the last profile",profile_deleted:'Profile "{{profileName}}" deleted',failed_to_delete_profile:"Failed to delete profile",invalid_key_name:"Invalid key name",key_added:'Key "{{keyName}}" added',key_already_exists:'Key "{{keyName}}" already exists',key_deleted:'Key "{{keyName}}" deleted',key_duplicated:'Key "{{from}}" duplicated as "{{to}}"',failed_to_delete_key:"Failed to delete key",key_not_found:'Key "{{keyName}}" not found',failed_to_duplicate_key:"Failed to duplicate key",alias_created:"Alias created successfully",alias_deleted:'Alias "{{aliasName}}" deleted',alias_duplicated:'Alias "{{from}}" duplicated as "{{to}}"',failed_to_add_alias:"Failed to create alias",failed_to_delete_alias:"Failed to delete alias",failed_to_duplicate_alias:"Failed to duplicate alias",alias_not_found:'Alias "{{name}}" not found',alias_already_exists:'Alias "{{name}}" already exists',invalid_alias_name:"Invalid alias name",invalid_project_file:"Invalid project file",invalid_kbf_file_format:"Invalid KBF file format",no_commands_to_duplicate:"No commands to duplicate",command_chain_is_valid:"Command chain is valid",no_profile_selected:"No profile selected",language_updated:"Language updated",nothing_to_copy:"Nothing to copy",content_copied_to_clipboard:"Content copied to clipboard",failed_to_generate_export:"Failed to generate export",no_profile_selected_to_clone:"No profile selected to clone",no_profile_selected_to_rename:"No profile selected to rename",profile_name_is_required:"Profile name is required",failed_to_save_profile:"Failed to save profile: {{error}}",no_profile_selected_to_delete:"No profile selected to delete",no_keybinds_to_export:"No keybinds to export",no_aliases_to_export:"No aliases to export",export_generated_aliases_note:"Keybind lines that call generated aliases",export_alias_definitions_note:"(Alias definitions are in the alias file)",export_user_and_generated_aliases:"This file contains both user-created aliases and generated aliases",export_generated_aliases_count:"from bind-to-alias mode ({{count}} generated aliases)",sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager loaded successfully",switched_to_profile:"Switched to profile: {{name}} ({{environment}})",profile_created_from:'Profile "{{newName}}" created from "{{sourceProfile}}"',no_effects_selected:"No effects selected. Please select at least one effect to generate aliases.",profile_renamed:'Profile renamed from "{{oldName}}" to "{{name}}"',application_reset_successfully:"Application reset successfully. All data cleared.",failed_to_copy_to_clipboard:"Failed to copy to clipboard",confirm_delete_alias:'Are you sure you want to delete the alias "{{aliasName}}"?',confirm_delete_key:'Are you sure you want to delete the key "{{keyName}}" and all its commands?',confirm_clear:"Confirm Clear",confirm_clear_commands:'Are you sure you want to clear all commands for "{{keyName}}"?',confirm_delete_profile:'Are you sure you want to delete the profile "{{profileName}}"?\n\nThis action cannot be undone.',confirm_reset_application:"Are you sure you want to reset the application?\n\nThis will delete all profiles, keybinds, and settings. This action cannot be undone.",yes:"Yes",no:"No",ok:"OK",no_commands:"No commands",profile_not_found:"Profile not found",click_add_command_to_start_building_your_command_chain:"Select items in the Command Library to start building your key command chain for",click_add_command_to_start_building_your_alias_chain:"Select items in the Command Library to start building your alias command chain for",create_alias:"Create Alias",key:"key",no_profile:"No profile",stotrayexecbytray_description:"STOTrayExecByTray (shows key binding on UI)",trayexecbytray_description:"TrayExecByTray (no UI indication)",parameter_configuration:"Parameter Configuration",configure_colon:"Configure:",edit_colon:"Edit:",vfx_manager:"VFX Manager",select_all:"Select All",clear_all:"Clear All",no_space_effects_selected:"No space effects selected",no_ground_effects_selected:"No ground effects selected",show_player_say:"Show Player Say",generate_aliases:"Generate Aliases",delete_selected_key:"Delete Selected Key",duplicate_selected_key:"Duplicate Selected Key",show_all_keys:"Show All Keys",failed_to_load_profile_data:"Failed to load profile data",already_on_profile:"Already on this profile",source_profile_not_found:"Source profile not found",source_profile_and_new_name_required:"Source profile ID and new name are required",profile_name_required:"Profile name is required",confirm_reset_app:"Confirm Reset Application",switch_to_key_type_view:"Switch to key type view",switch_to_grid_view:"Switch to grid view",switch_to_command_categories:"Switch to command categories",no_profiles_available:"No profiles available",verb:{say:"Say (Local)",team:"Team",zone:"Zone",tell:"Tell"},duplicate_alias:"Duplicate Alias",enter_new_alias_name:"Enter new alias name",alias_name_in_use:"Alias name already exists",duplicate:"Duplicate",reserved_command_name:"Name conflicts with a STO command",backup_created_successfully:"Application backup created successfully",failed_to_create_backup:"Failed to create backup: {{error}}",backup_restored_successfully:"Application state restored successfully",backup_restore_failed:"Failed to restore backup: {{error}}",distinguish_left_right_modifiers:"Distinguish left/right modifiers",clear_filter:"Clear filter",warning:"Warning",error:"Error",validation_details:"Validation Details",command_chain_near_limit:"Command chain is getting long ({{length}} characters). Exceeding 999 may break.",command_chain_too_long:"Command chain is too long ({{length}} characters) and may fail in game.",sto_tray_exec_optimization_suggestion:"Command chain is {{currentLength}} characters. Replacing {{count}} instance(s) of STOTrayExecByTray with TrayExecByTray would save {{potentialSavings}} characters (new length: {{newLength}}).",stabilized_non_tray_warning:"Stabilized execution should be used with tray execution abilities only.",too_many_commands_on_key:"Binding {{count}} commands to one key may fail in game (max recommended 20).",alias_mixed_environment_warning:"Alias contains both space-only and ground-only commands; this is not recommended.",spam_bar_warning:"Not recommended on spam bars as it interferes with firing cycles",press_any_key_combination:"Press any key combination...",capture_instructions:"Use your keyboard or mouse, or switch to manual to click keys below",switch_to_manual:"Switch to Manual",start_capture:"Start Capture",selected_key:"Selected Key",confirm_selection:"Confirm Selection",key_selection_failed:"Failed to select key",error_generating_command:"Error generating command",please_enter_a_raw_command:"Please enter a raw command",unsafe_keybind:"Unsafe keybind combination: {{key}} is not allowed",bindsets_enabled:"Enable Bindsets",bindsets_enabled_description:"When enabled, allows creation and loading of bindsets (requires 'Create keybind chains as aliases').",translate_generated_messages:"Translate generated messages",translate_generated_messages_description:"When enabled, automatically generated messages (like VFX suppression notifications) will be translated to the selected language. When disabled, they remain in English.",bindsets:"Bindsets",bindset_manager:"Bindset Manager",create_bindset:"Create Bindset",enter_bindset_name:"Enter bindset name:",bindset_name:"Bindset name",bindset_name_in_use:"Bindset name already in use",bindset_not_empty:"Bindset has keybinds and cannot be deleted",invalid_name:"Invalid name",rename_bindset:"Rename Bindset",name_required:"Name is required",name_exists:"Name already exists",name_unchanged:"Name is unchanged",confirm_delete_bindset:'Delete bindset "{{name}}"?',not_found:"Not found",add_new_alias:"Add New Alias",add_key_to_bindset:"Add key to bindset",duplicate_selected_alias:"Duplicate selected alias",delete_selected_alias:"Delete selected alias",search_aliases:"Search aliases...",add_key_to_bindset_confirm:'Add key "{{key}}" to bindset "{{bindset}}"?',manage_bindsets:"Manage Bindsets",primary_bindset:"Primary Bindset",remove_key_from_bindset:"Remove key from bindset",remove_key_from_bindset_confirm:'Remove key "{{key}}" from bindset "{{bindset}}"?',select_bindset:"Select Bindset",confirm_add:"Confirm Add",confirm_remove:"Confirm Remove",confirm_delete:"Are you sure you want to delete?",enter_new_name:"Enter new name:",failed_to_rename_profile:"Failed to rename profile: {{error}}",ground_build:"Ground Build",import_failed_invalid_json:"Import failed: Invalid JSON format",import_failed_unsupported_format:"Import failed: Unsupported file format",no_content_available:"No content available",no_valid_profile:"No valid profile available",profile_already_exists:"Profile already exists",profile_id_required:"Profile ID is required",space_build:"Space Build",syncing:"Syncing...",command_parameters:{active:{label:"Active",help:"0: Disabled, 1: Enabled"},tray:{label:"Tray",help:"Tray number (0-9)"},slot:{label:"Slot",help:"Slot number (0-9)"},start_tray:{label:"Start Tray",help:"Starting tray number"},end_tray:{label:"End Tray",help:"Ending tray number"},start_slot:{label:"Start Slot",help:"Starting slot number"},end_slot:{label:"End Slot",help:"Ending slot number"},backup_tray:{label:"Backup Tray",help:"Backup tray number"},backup_slot:{label:"Backup Slot",help:"Backup slot number"},backup_start_tray:{label:"Backup Start Tray",help:"Backup start tray number"},backup_end_tray:{label:"Backup End Tray",help:"Backup end tray number"},backup_start_slot:{label:"Backup Start Slot",help:"Backup start slot number"},backup_end_slot:{label:"Backup End Slot",help:"Backup end slot number"},command_type:{label:"Command Type",help:"Command execution type (STOTrayExecByTray shows UI, TrayExecByTray does not)"},entityName:{label:"Entity Name",help:"Name of the entity to target"},message:{label:"Message",help:"Message text to send"},distance:{label:"Distance",help:"Camera distance value"},amount:{label:"Amount",help:"Throttle adjustment amount"},position:{label:"Position",help:"Throttle position (0-100)"},filename:{label:"Filename",help:"File name (without extension)"},state:{label:"State",help:"1 to enable, 0 to disable"},verb:{label:"Channel",help:"Communication channel (say, team, zone)"},alias_name:{label:"Alias Name",help:"Name of the alias to execute"},rawCommand:{label:"Command",help:"Raw STO command text"},seconds:{label:"Seconds",help:"Delay in seconds"},alpha:{label:"Alpha",help:"Transparency value (0-255)"},modifier1:{label:"Modifier 1",help:"First modifier key combination"},modifier2:{label:"Modifier 2",help:"Second modifier key combination"},name:{label:"Name",help:"Name of the target or object"}},error_add_failed:"Failed to add key to bindset",error_remove_failed:"Failed to remove key from bindset"},te={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Speichern",explorer:"Explorer",import_keybinds:"Tastaturbelegung importieren",import_environment:"Tastaturbelegung importieren",import_environment_question:"WÃ¤hlen Sie eine Umgebung fÃ¼r den Import dieser Tastaturbelegungsdatei",aliases:"Aliase",import_aliases:"Aliase importieren",import:"Importieren",backup:"Sicherung",backup_menu:"Sicherung",backup_application_state:"Anwendungsstatus sichern",restore_application_state:"Anwendungsstatus wiederherstellen",preferences:"Einstellungen",language:"Sprache",sync_folder_label:"Synchronisationsordner:",no_folder_selected:"Kein Ordner ausgewÃ¤hlt",download:"Herunterladen",vfx:"VFX",dark_mode:"Dunkler Modus",light_mode:"Heller Modus",load_default_data:"Standarddaten laden",reset_application:"Anwendung zurÃ¼cksetzen",set_sync_folder:"Sync-Ordner festlegen",sync_now:"Jetzt synchronisieren",about:"Ãœber",rename:"Umbenennen",delete:"LÃ¶schen",space:"Weltraum",ground:"Boden",modified:"GeÃ¤ndert",valid:"GÃ¼ltig",keys:"Tasten",keys_firstupper:"Tasten",copy:"Kopieren",select_a_key_to_edit:"WÃ¤hlen Sie eine Taste zum Bearbeiten",commands:"Befehle",command_singular:"Befehl",no_key_selected:"Keine Taste ausgewÃ¤hlt",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"WÃ¤hlen Sie eine Taste aus dem linken Panel, um ihre Befehlskette anzuzeigen und zu bearbeiten.",generated_command:"Generierter Befehl:",select_a_key_to_see_the_generated_command:"WÃ¤hlen Sie eine Taste, um den generierten Befehl zu sehen",add_command:"Befehl hinzufÃ¼gen",command_library:"Befehlsbibliothek",add_new_key:"Neue Taste hinzufÃ¼gen",ctrl:"Strg",alt:"Alt",shift:"Umschalt",cancel:"Abbrechen",custom:"Benutzerdefiniert",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"aliase",profile:"Profil",profile_name:"Profilname:",description_optional:"Beschreibung (optional):",alias_name:"Alias-Name:",select_key_dialog_title:"Taste auswÃ¤hlen",vfx_manager:"VFX-Manager",space_effects:"Weltraum-Effekte",select_all:"Alle auswÃ¤hlen",clear_all:"Alle lÃ¶schen",selected:"ausgewÃ¤hlt",ground_effects:"Boden-Effekte",generated_aliases:"Generierte Aliase:",no_space_effects_selected:"Keine Weltraum-Effekte ausgewÃ¤hlt",no_ground_effects_selected:"Keine Boden-Effekte ausgewÃ¤hlt",show_player_say:"Spieler-Say anzeigen",generate_aliases:"Aliase generieren",about_sto_tools_keybind_manager:"Ãœber STO Tools Keybind Manager",features:"Funktionen:",visual_keybind_editor:"Visueller Keybind-Editor",sto_command_library_with_search_and_categorization:"STO-Befehlsbibliothek mit Suche und Kategorisierung",multiple_profile_management_create_clone_rename_delete:"Mehrfache Profilverwaltung (erstellen, klonen, umbenennen, lÃ¶schen)",custom_alias_system_for_complex_command_sequences:"Benutzerdefiniertes Alias-System fÃ¼r komplexe Befehlssequenzen",vertigo_inspired_vfx_manager_for_visual_effects_control:"VERTIGO-inspirierter VFX-Manager zur Kontrolle visueller Effekte",import_export_keybind_and_alias_files_and_project_backups:"Import/Export von Keybind- und Alias-Dateien sowie Projekt-Backups",real_time_validation_and_command_preview:"Echtzeit-Validierung und Befehlsvorschau",quick_start:"Schnellstart:",create_a_new_profile_or_use_the_default_profile:"Erstellen Sie ein neues Profil oder verwenden Sie das Standardprofil",select_keys_from_the_grid_and_add_commands_from_the_library:"WÃ¤hlen Sie Tasten aus dem Raster und fÃ¼gen Sie Befehle aus der Bibliothek hinzu",use_the_command_chain_editor_to_build_complex_sequences:"Verwenden Sie den Befehlsketten-Editor, um komplexe Sequenzen zu erstellen",export_your_keybinds_as_txt_files_for_use_in_sto:"Exportieren Sie Ihre Keybinds als .txt-Dateien fÃ¼r die Verwendung in STO",resources:"Ressourcen:",copyright:"Â© 2025 STO Tools. Alle Rechte vorbehalten.",got_it:"Verstanden!",file_explorer:"Datei-Explorer",select_an_item_on_the_left_to_preview_export:"WÃ¤hlen Sie ein Element links aus, um den Export in der Vorschau anzuzeigen",close:"SchlieÃŸen",filter_keys:"Tasten filtern...",search_commands:"Befehle suchen...",enter_profile_name:"Profilnamen eingeben",describe_this_keybind_profile:"Dieses Keybind-Profil beschreiben",search_keys:"Tasten suchen...",settings:"Einstellungen",select_profile:"Profil auswÃ¤hlen",new_profile:"Neues Profil",clone_profile:"Profil klonen",rename_profile:"Profil umbenennen",delete_profile:"Profil lÃ¶schen",space_mode:"Weltraum-Modus",ground_mode:"Boden-Modus",unsaved_changes:"Ungespeicherte Ã„nderungen",validation_status:"Validierungsstatus",bound_keys:"Gebundene Tasten",toggle_between_grid_and_categorized_view:"Zwischen Raster- und kategorisierter Ansicht wechseln",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"GewÃ¤hrleistet konsistente AusfÃ¼hrungsreihenfolge durch Spiegelung der Befehle (Phase 1: links nach rechts, Phase 2: rechts nach links)",validate_command_chain:"Befehlskette validieren",command_chain:"Befehlskette",alias_chain:"Alias-Kette",chain_for_key:"{{chainType}} fÃ¼r {{key}}",clear_all_commands:"Alle Befehle lÃ¶schen",copy_to_clipboard:"In Zwischenablage kopieren",generated:"Generiert:",created_by:"Erstellt von:",statistics:"Statistiken",total_commands:"Gesamtbefehle:",command_aliases:"Befehlsaliase",key_type:{function_keys:"Funktionstasten",letters_numbers:"Buchstaben & Zahlen",numberpad:"Nummernblock",modifier_keys:"Modifikatortasten",navigation:"Navigation",system_keys:"Systemtasten",mouse_wheel:"Maus & Rad",symbols_punctuation:"Symbole & Zeichensetzung",other_keys:"Andere Tasten"},command_categories:{targeting:"Zielauswahl",combat:"Kampf",cosmetic:"Kosmetik",bridge_officer:"BrÃ¼ckenoffizier",tray:"FachausfÃ¼hrung",power:"Schildverwaltung",movement:"Bewegung",camera:"Kamera",communication:"Kommunikation",system:"System",custom:"Benutzerdefiniert"},command_definitions:{add_custom_command:{name:"Benutzerdefinierten Befehl hinzufÃ¼gen",description:"Beliebigen STO-Befehl als Rohtext hinzufÃ¼gen"},target:{name:"Ziel nach Name",description:"Ziel nach Namen anvisieren (benÃ¶tigt AnfÃ¼hrungszeichen)"},target_enemy_near:{name:"NÃ¤chsten Feind anvisieren",description:"Den nÃ¤chsten sichtbaren Feind anvisieren"},target_friend_near:{name:"NÃ¤chsten VerbÃ¼ndeten anvisieren",description:"Die nÃ¤chste befreundete Einheit anvisieren"},target_self:{name:"Sich selbst anvisieren",description:"Das eigene Schiff/den eigenen Charakter anvisieren"},target_clear:{name:"Ziel aufheben",description:"Aktuelle Zielerfassung aufheben"},target_teammate_1:{name:"Teammitglied 1 anvisieren",description:"Erstes Teammitglied anvisieren"},target_teammate_2:{name:"Teammitglied 2 anvisieren",description:"Zweites Teammitglied anvisieren"},target_teammate_3:{name:"Teammitglied 3 anvisieren",description:"Drittes Teammitglied anvisieren"},target_teammate_4:{name:"Teammitglied 4 anvisieren",description:"Viertes Teammitglied anvisieren"},fire_all:{name:"Alle Waffen feuern",description:"Alle Waffen feuern"},fire_phasers:{name:"Energiewaffen feuern",description:"Alle Energiewaffen feuern"},fire_torps:{name:"Torpedos feuern",description:"Alle Torpedos feuern"},fire_mines:{name:"Minen feuern",description:"Alle Minen feuern"},fire_phasers_torps:{name:"Phaser & Torpedos feuern",description:"Phaser & Torpedos feuern"},fire_projectiles:{name:"Projektile feuern",description:"Torpedos & Minen feuern"},custom_tray:{name:"Tray-AusfÃ¼hrung",description:"Bestimmten Tray-Slot ausfÃ¼hren"},tray_with_backup:{name:"Tray-AusfÃ¼hrung mit Backup",description:"Bestimmten Tray-Slot mit Backup-FÃ¤higkeit ausfÃ¼hren"},tray_range:{name:"Tray-Bereich-AusfÃ¼hrung",description:"Einen Bereich von Tray-Slots ausfÃ¼hren"},tray_range_with_backup:{name:"Tray-Bereich mit Backup",description:"Einen Bereich von Tray-Slots mit Backup-FÃ¤higkeiten ausfÃ¼hren"},whole_tray:{name:"Gesamtes Tray ausfÃ¼hren",description:"Alle Slots in einem Tray ausfÃ¼hren"},whole_tray_with_backup:{name:"Gesamtes Tray mit Backup",description:"Alle Slots in einem Tray mit Backup-Tray ausfÃ¼hren"},distribute_shields:{name:"Schilde verteilen",description:"Schilde gleichmÃ¤ÃŸig verteilen, als wÃ¼rde man in die Mitte des Schiff- und Schildsymbols klicken"},reroute_shields_rear:{name:"Schilde nach hinten umleiten",description:"Schildenergie zur Heckseite umleiten"},reroute_shields_left:{name:"Schilde nach links umleiten",description:"Schildenergie zur linken Seite umleiten"},reroute_shields_right:{name:"Schilde nach rechts umleiten",description:"Schildenergie zur rechten Seite umleiten"},reroute_shields_forward:{name:"Schilde nach vorne umleiten",description:"Schildenergie zur Bugseite umleiten"},full_impulse:{name:"Vollimpuls",description:"Vollimpulsantrieb einschalten"},reverse:{name:"RÃ¼ckwÃ¤rts",description:"Triebwerke rÃ¼ckwÃ¤rts"},throttle_adjust:{name:"Schub anpassen",description:"Schub um Betrag erhÃ¶hen oder verringern"},throttle_set:{name:"Schub setzen",description:"Schub auf bestimmte Position setzen (negativ = rÃ¼ckwÃ¤rts, 0 = stopp)"},throttle_toggle:{name:"Schub umschalten",description:"Zwischen Vollschub und Vollstopp wechseln"},turn_left:{name:"Links drehen",description:"Schiff nach links drehen (kontinuierlich wÃ¤hrend gehalten)"},turn_right:{name:"Rechts drehen",description:"Schiff nach rechts drehen (kontinuierlich wÃ¤hrend gehalten)"},pitch_up:{name:"AufwÃ¤rts neigen",description:"Schiffsnase nach oben neigen (HÃ¶henÃ¤nderung im Weltraum)"},pitch_down:{name:"AbwÃ¤rts neigen",description:"Schiffsnase nach unten neigen (HÃ¶henÃ¤nderung im Weltraum)"},strafe_left:{name:"Links seitlich bewegen",description:"Schiff nach links seitlich bewegen"},strafe_right:{name:"Rechts seitlich bewegen",description:"Schiff nach rechts seitlich bewegen"},forward:{name:"VorwÃ¤rts",description:"VorwÃ¤rts bewegen"},backward:{name:"RÃ¼ckwÃ¤rts",description:"RÃ¼ckwÃ¤rts bewegen"},auto_forward:{name:"Auto-VorwÃ¤rts",description:"Charakter bewegt sich vorwÃ¤rts bis neue Bewegungsbefehle gegeben werden"},follow:{name:"Ziel folgen",description:"Der anvisierten Einheit folgen"},follow_cancel:{name:"Folgen abbrechen",description:"AufhÃ¶ren zu folgen und Ziel vergessen"},zoom_in:{name:"Hineinzoomen",description:"Kamera hineinzoomen"},zoom_out:{name:"Herauszoomen",description:"Kamera herauszoomen"},zoom_in_small:{name:"Leicht hineinzoomen",description:"Kamera leicht hineinzoomen"},zoom_out_small:{name:"Leicht herauszoomen",description:"Kamera leicht herauszoomen"},cam_distance:{name:"Kameraentfernung setzen",description:"Kameraentfernung vom Spieler setzen"},cam_reset:{name:"Kamera zurÃ¼cksetzen",description:"Kameraposition auf Standard zurÃ¼cksetzen"},cam_target_lock:{name:"Kamera an Ziel fixieren",description:"Kamera am Ziel fixieren oder lÃ¶sen"},cam_cycle_distance:{name:"Kameraentfernung wechseln",description:"Kameraentfernung zwischen mehreren voreingestellten Werten wechseln"},cam_mouse_look:{name:"Maus-Blick",description:"Maus-Blick-Kamerasteuerung aktivieren"},cam_turn_to_face:{name:"Zur Kamera drehen",description:"Schiff in Kamerarichtung drehen"},look_up:{name:"Nach oben blicken",description:"Blickwinkel Ã¤ndern um geradeaus nach oben zu blicken"},look_down:{name:"Nach unten blicken",description:"Blickwinkel Ã¤ndern um geradeaus nach unten zu blicken"},team_message:{name:"Team-Nachricht",description:"Nachricht an Team senden"},local_message:{name:"Lokale Nachricht",description:"Nachricht an lokalen Bereich senden"},zone_message:{name:"Zonen-Nachricht",description:"Nachricht an Zone senden"},toggle_hud:{name:"HUD umschalten",description:"HUD-Sichtbarkeit umschalten"},screenshot:{name:"Screenshot",description:"Einen Screenshot machen"},screenshot_jpg:{name:"Screenshot JPG",description:"Einen Screenshot als JPG speichern"},autofire_set:{name:"Autofeuer einstellen",description:"Waffen-Autofeuer ein- und ausschalten. X = 1 schaltet es ein und X = 0 schaltet es aus."},bind_save_file:{name:"Binds in Datei speichern",description:"Alle Binds in eine Textdatei speichern"},bind_load_file:{name:"Binds aus Datei laden",description:"Eine Bind-Datei in den Client laden"},combat_log:{name:"Kampflog umschalten",description:"Kampflog-Aufzeichnung ein-/ausschalten (1=ein, 0=aus)"},missions:{name:"Missionen anzeigen/verbergen",description:"Missionstagebuch anzeigen/verbergen"},inventory:{name:"Inventar anzeigen/verbergen",description:"Inventar anzeigen/verbergen"},map:{name:"Karte",description:"Karte anzeigen/verbergen"},assist:{name:"UnterstÃ¼tzen",description:"UnterstÃ¼tzen '<name>': UnterstÃ¼tzt die EntitÃ¤t mit dem Ã¼bereinstimmenden Namen. Wenn kein Name angegeben wird, unterstÃ¼tzt Ihr aktuelles Ziel."},net_timing_graph:{name:"Netzwerk-Timing-Graph",description:"Netzwerk-Timing-Graph aktivieren oder deaktivieren (0=deaktivieren, 1=aktivieren)"},net_timing_graph_alpha:{name:"Netzwerk-Timing-Graph Alpha",description:"Transparenzstufe fÃ¼r Netzwerk-Timing-Graph setzen (50=hÃ¶chste Transparenz, 255=keine Transparenz)"},net_timing_graph_paused:{name:"Netzwerk-Timing-Graph Pausiert",description:"Netzwerk-Timing-Graph pausieren oder fortsetzen (0=Pause deaktiviert, 1=Pause aktiviert)"},netgraph:{name:"Netzwerk-Graph",description:"SND und RCV Netzwerkdaten als Text anzeigen (1=aktiviert, 0=deaktiviert)"},setrallypoint:{name:"Sammelpunkt setzen",description:"Einen Sammelpunkt fÃ¼r Ihr aktuelles Ziel setzen"},setrallypointconsole:{name:"Sammelpunkt setzen (Konsole)",description:"Einen Sammelpunkt fÃ¼r Ihr aktuelles Ziel setzen (Konsolenvariante)"},clearrallypoint:{name:"Sammelpunkt lÃ¶schen",description:"Den Sammelpunkt fÃ¼r Ihr aktuelles Ziel lÃ¶schen"},clearallrallypoints:{name:"Alle Sammelpunkte lÃ¶schen",description:"Alle Sammelpunkte lÃ¶schen"},aim:{name:"Zielen",description:"Zielt auf das Ziel"},change_instance:{name:"Instanz wechseln",description:"Wechselt zu einer bereits erstellten Instanz derselben Karte. Funktioniert nur auÃŸerhalb des Roten Alarms."},chat_log:{name:"Chat-Log umschalten",description:"Chat-Log-Aufzeichnung ein-/ausschalten (1=an, 0=aus)"},goto_character_select:{name:"Zum Charakterauswahlbildschirm",description:"Zum Charakterauswahlbildschirm wechseln, ohne sich abzumelden."},holster:{name:"Waffe ablegen",description:"Waffe ablegen"},holster_toggle:{name:"Waffe umschalten",description:"Waffe ein-/ausblenden"},logout:{name:"Abmelden",description:"Aktuellen Charakter abmelden"},quit:{name:"Spiel beenden",description:"Fenster schlieÃŸen"},remember_ui_lists:{name:"UI-Listen merken",description:"Ob die Platzierung und Breite der UI-Listen gemerkt werden soll"},safe_login:{name:"Sicherer Login",description:"Bei Aktivierung wird der Spieler auf die zuletzt besuchte statische Karte eingeloggt"},setactivecostume:{name:"Aktives KostÃ¼m setzen",description:"Setzt das aktuelle aktive KostÃ¼m. Erfordert zwei Modifikatoren."},shooter_clear_offset_tray_binds:{name:"Shooter Offset-Tray-Bindings lÃ¶schen",description:"LÃ¶scht Offset-Tray-Bindings im Shooter-Modus"},shooter_clear_overlay_tray_binds:{name:"Shooter Overlay-Tray-Bindings lÃ¶schen",description:"LÃ¶scht Overlay-Tray-Bindings im Shooter-Modus"},shooter_primary:{name:"Shooter PrimÃ¤r",description:"PrimÃ¤rangriff im Shooter-Modus"},shooter_secondary:{name:"Shooter SekundÃ¤r",description:"SekundÃ¤rangriff im Shooter-Modus"},shooter_set_offset_tray_binds:{name:"Shooter Offset-Tray-Bindings setzen",description:"Setzt Offset-Tray-Bindings im Shooter-Modus"},shooter_set_overlay_tray_binds:{name:"Shooter Overlay-Tray-Bindings setzen",description:"Setzt Overlay-Tray-Bindings im Shooter-Modus"},shooter_tertiary:{name:"Shooter TertiÃ¤r",description:"TertiÃ¤rangriff im Shooter-Modus"},show_game_ui:{name:"Spiel-UI anzeigen",description:"Zeigt die Spiel-BenutzeroberflÃ¤che an"},show_game_ui_no_extra_keybinds:{name:"Spiel-UI anzeigen (ohne zusÃ¤tzliche Keybinds)",description:"Zeigt die Spiel-UI ohne zusÃ¤tzliche Escape-Keybinds an"},toggle_shooter_mode:{name:"Shooter-Modus umschalten",description:"Zwischen Shooter- und RPG-Modus umschalten"},ui_cancel:{name:"UI Abbrechen",description:"Antwortet mit 'Abbrechen' auf ein offenes Dialogfeld; funktioniert nicht in allen Dialogen"},ui_gen_layers_reset:{name:"UI-Layout zurÃ¼cksetzen",description:"Setzt das Layout zurÃ¼ck, wenn der Server die Position beweglicher Fenster aktualisiert"},ui_load:{name:"UI-Einstellungen laden",description:"LÃ¤dt die Standard-UI-Einstellungsdatei, normalerweise Live\\ui_settings.txt"},ui_load_file:{name:"UI-Einstellungsdatei laden",description:"LÃ¤dt eine benannte UI-Einstellungsdatei"},ui_ok:{name:"UI OK",description:"Antwortet mit 'OK' auf ein offenes Dialogfeld; funktioniert nicht in allen Dialogen"},ui_remember_positions:{name:"UI-Positionen merken",description:"Ob UI-GrÃ¶ÃŸen und -Positionen gemerkt werden sollen. StandardmÃ¤ÃŸig aktiviert."},ui_resolution:{name:"UI-AuflÃ¶sung anzeigen",description:"Zeigt die aktuelle UI-BildschirmauflÃ¶sung an"},ui_save:{name:"UI-Einstellungen speichern",description:"Speichert das UI-Layout in der Standard-UI-Einstellungsdatei, normalerweise Live\\ui_settings.txt"},ui_save_file:{name:"UI-Einstellungsdatei speichern",description:"Speichert das UI-Layout in einer benannten UI-Einstellungsdatei"},ui_tooltip_delay:{name:"Tooltip-VerzÃ¶gerung setzen",description:"Setzt die zusÃ¤tzliche VerzÃ¶gerung in Sekunden, bevor Tooltips angezeigt werden"},unholster:{name:"Waffe ziehen",description:"Waffe ziehen"},parameter_placeholders:{any_sto_command:"Beliebigen STO-Befehl eingeben (z.B. Target_Enemy_Near)",entity_name:"EntitÃ¤tsnamen eingeben",first_modifier:"Erster Modifikator",second_modifier:"Zweiter Modifikator",entity_name_optional:"EntitÃ¤tsname (optional)"}},category_descriptions:{targeting:"Zielauswahl und -verwaltung",combat:"Waffenfeuer und Kampfaktionen",tray:"FÃ¤higkeiten aus Aktions-Trays ausfÃ¼hren",power:"Schildenergie und Verteilungsverwaltung",movement:"Schiffsbewegung und Navigation",camera:"Kamerasteuerung und Ansichtsverwaltung",communication:"Chat und Teamkommunikation",system:"UI- und Systembefehle",custom:"Benutzerdefinierte Befehle"},no_aliases_defined:"Keine Aliase definiert",create_alias_to_get_started:"Erstellen Sie einen Alias um zu beginnen",alias_deleted:'Alias "{{aliasName}}" gelÃ¶scht',please_select_a_key_first:"Bitte wÃ¤hlen Sie zuerst eine Taste",no_active_profile:"Kein aktives Profil",alias_not_found:'Alias "{{name}}" nicht gefunden',alias_created:"Alias erfolgreich erstellt",import_failed:"Import fehlgeschlagen: {{error}}",storage_not_available:"Speicher nicht verfÃ¼gbar",no_aliases_found_in_file:"Keine Aliase in Datei gefunden",import_completed_keybinds:"Import abgeschlossen: {{count}} Keybinds",import_completed_aliases:"Import abgeschlossen: {{count}} Aliase",project_imported_successfully:"Projekt erfolgreich importiert: {{profileCount}} Profile",sync_folder_set:"Sync-Ordner ausgewÃ¤hlt",failed_to_set_sync_folder:"Sync-Ordner auswÃ¤hlen fehlgeschlagen: {{error}}",sync_not_supported_firefox:"Die Sync-Ordner-FunktionalitÃ¤t erfordert einen Chromium-basierten Browser (Chrome, Edge, etc.). Firefox unterstÃ¼tzt die erforderliche File System Access API nicht.",sync_not_supported_title:"Sync nicht unterstÃ¼tzt",sync_not_supported_detailed:"Die Sync-FunktionalitÃ¤t ist in Firefox aufgrund von Browser-BeschrÃ¤nkungen nicht verfÃ¼gbar. Die fÃ¼r die Ordner-Synchronisation erforderliche File System Access API wird nur in Chromium-basierten Browsern unterstÃ¼tzt. Sie kÃ¶nnen Ihren Anwendungsstatus manuell sichern und wiederherstellen oder den Datei-Explorer verwenden, um Ihre Keybind- und Alias-Dateien zu kopieren.",sync_not_supported_secure_context:"Sync-Service ist nicht verfÃ¼gbar, wenn Ã¼ber HTTP bereitgestellt. Bitte verwenden Sie HTTPS oder greifen Sie Ã¼ber das file://-Protokoll zu, um die Sync-FunktionalitÃ¤t zu aktivieren.",sync_not_supported_secure_context_title:"Sicherer Kontext erforderlich",sync_not_supported_secure_context_detailed:"Die Sync-FunktionalitÃ¤t erfordert eine sichere Verbindung (HTTPS) oder lokalen Dateizugriff (file://), um zu funktionieren. Die fÃ¼r die Ordner-Synchronisation erforderliche File System Access API ist nur in sicheren Kontexten verfÃ¼gbar, um Ihre Daten zu schÃ¼tzen. Bitte greifen Sie auf diese Anwendung Ã¼ber HTTPS zu oder Ã¶ffnen Sie sie als lokale Datei.",sync_not_supported_browser:"Ihr Browser unterstÃ¼tzt die fÃ¼r die Sync-FunktionalitÃ¤t erforderliche File System Access API nicht.",sync_not_supported_browser_title:"Browser nicht unterstÃ¼tzt",sync_not_supported_browser_detailed:"Ihr Browser unterstÃ¼tzt die fÃ¼r die Ordner-Synchronisation erforderliche File System Access API nicht. Bitte versuchen Sie, einen Chromium-basierten Browser (Chrome, Edge, etc.) mit einer sicheren Verbindung (HTTPS) oder lokalem Dateizugriff zu verwenden.",no_sync_folder_selected:"Kein Sync-Ordner ausgewÃ¤hlt",project_synced_successfully:"Projekt erfolgreich synchronisiert",sync_folder_contains_project_title:"Vorhandene Sync-Daten gefunden",sync_folder_contains_project_prompt:"Dieser Ordner enthÃ¤lt bereits eine project.json von einer vorherigen Synchronisation. Jetzt importieren anstatt zu Ã¼berschreiben?",project_imported_from_sync_folder:"Anwendungsstatus aus Sync-Ordner importiert",sync_overwrite_existing_title:"Sync-Daten Ã¼berschreiben?",sync_overwrite_existing_prompt:"Import abgelehnt. Sync-Ordner mit aktuellem Anwendungsstatus Ã¼berschreiben?",sync_operation_cancelled:"Synchronisation abgebrochen",failed_to_import_project:"Projektimport fehlgeschlagen: {{error}}",permission_denied_to_folder:"Berechtigung zum Schreiben in Ordner verweigert",failed_to_sync_project:"Projekt-Synchronisation fehlgeschlagen: {{error}}",synchronization:"Synchronisation",advanced:"Erweitert",synchronization_settings:"Synchronisationseinstellungen",advanced_settings:"Erweiterte Einstellungen",sync_folder_description:"WÃ¤hlen Sie einen Ordner zum automatischen Synchronisieren Ihrer Projekte",auto_sync:"Automatische Synchronisation",auto_sync_description:"Ã„nderungen automatisch mit dem ausgewÃ¤hlten Ordner synchronisieren",auto_sync_interval:"Auto-Sync-Intervall",auto_sync_interval_description:"Wie oft Ihre Ã„nderungen automatisch synchronisiert werden sollen",after_every_change:"Nach jeder Ã„nderung",every_1_minute:"Jede Minute",every_2_minutes:"Alle 2 Minuten",every_5_minutes:"Alle 5 Minuten",bind_to_alias_mode:"Keybind-Ketten als Aliase erstellen",bind_to_alias_mode_description:"Wenn aktiviert, werden Keybind-Ketten als Aliase generiert, benannt nach Umgebung und Taste (z.B. 'space_q'), und die Tasten werden so gebunden, dass sie diese Aliase aufrufen.",preferences_saved:"Einstellungen erfolgreich gespeichert",vfx_manager_description:"WÃ¤hlen Sie visuelle Effekte aus, die mit dynFxSetFXExlusionList-Aliasen deaktiviert werden sollen. Effekte sind nach Umgebung organisiert.",app_description:"Ein umfassendes webbasiertes Tool zum Erstellen, Bearbeiten und Verwalten von Star Trek Online Keybind-Konfigurationen mit visueller Bearbeitung und erweiterten Funktionen.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"WÃ¤hlen Sie einen Raum-/Boden-Build oder Aliase aus, um die Exportvorschau anzuzeigen.",alias_mode:"Alias-Modus",create:"Erstellen",filter_aliases:"Aliase filtern",select_an_alias_to_edit:"WÃ¤hlen Sie einen Alias zum Bearbeiten",select_an_alias_to_see_the_generated_command:"WÃ¤hlen Sie einen Alias um den generierten Befehl zu sehen",no_alias_selected:"Kein Alias ausgewÃ¤hlt",select_alias_from_left_panel:"WÃ¤hlen Sie einen Alias aus dem linken Bereich aus, um seine Befehlssequenz anzuzeigen und zu bearbeiten.",select_key_from_left_panel:"WÃ¤hlen Sie eine Taste aus dem linken Bereich aus, um ihre Befehlssequenz anzuzeigen und zu bearbeiten.",failed_to_load_application:"Anwendung konnte nicht geladen werden",profile_created:'Profil "{{name}}" erstellt',failed_to_create_profile:"Profil konnte nicht erstellt werden",failed_to_clone_profile:"Profil konnte nicht geklont werden",cannot_delete_the_last_profile:"Das letzte Profil kann nicht gelÃ¶scht werden",profile_deleted:'Profil "{{profileName}}" gelÃ¶scht',failed_to_delete_profile:"Profil konnte nicht gelÃ¶scht werden",invalid_key_name:"UngÃ¼ltiger Tastenname",key_added:'Taste "{{keyName}}" hinzugefÃ¼gt',key_already_exists:'Taste "{{keyName}}" existiert bereits',key_deleted:'Taste "{{keyName}}" gelÃ¶scht',key_duplicated:'Taste "{{from}}" dupliziert als "{{to}}"',failed_to_delete_key:"Taste konnte nicht gelÃ¶scht werden",key_not_found:'Taste "{{keyName}}" nicht gefunden',failed_to_duplicate_key:"Taste konnte nicht dupliziert werden",alias_duplicated:'Alias "{{from}}" dupliziert als "{{to}}"',failed_to_add_alias:"Alias konnte nicht erstellt werden",failed_to_delete_alias:"Alias konnte nicht gelÃ¶scht werden",failed_to_duplicate_alias:"Alias konnte nicht dupliziert werden",alias_already_exists:'Alias "{{name}}" existiert bereits',invalid_alias_name:"UngÃ¼ltiger Alias-Name",invalid_project_file:"UngÃ¼ltige Projektdatei",no_commands_to_duplicate:"Keine Befehle zum Duplizieren",command_chain_is_valid:"Befehlskette ist gÃ¼ltig",no_profile_selected:"Kein Profil ausgewÃ¤hlt",language_updated:"Sprache aktualisiert",nothing_to_copy:"Nichts zu kopieren",content_copied_to_clipboard:"Inhalt in Zwischenablage kopiert",failed_to_generate_export:"Export konnte nicht generiert werden",no_profile_selected_to_clone:"Kein Profil zum Klonen ausgewÃ¤hlt",no_profile_selected_to_rename:"Kein Profil zum Umbenennen ausgewÃ¤hlt",profile_name_is_required:"Profilname ist erforderlich",failed_to_save_profile:"Profil konnte nicht gespeichert werden: {{error}}",no_profile_selected_to_delete:"Kein Profil zum LÃ¶schen ausgewÃ¤hlt",no_keybinds_to_export:"Keine Keybinds zum Exportieren",no_aliases_to_export:"Keine Aliase zum Exportieren",application_reset_successfully:"Anwendung erfolgreich zurÃ¼ckgesetzt",confirm_clear:"LÃ¶schen bestÃ¤tigen",confirm_clear_commands:'Sind Sie sicher, dass Sie alle Befehle fÃ¼r "{{keyName}}" lÃ¶schen mÃ¶chten?',confirm_delete_alias:'Sind Sie sicher, dass Sie den Alias "{{aliasName}}" lÃ¶schen mÃ¶chten?',confirm_delete_key:'Sind Sie sicher, dass Sie die Taste "{{keyName}}" und alle ihre Befehle lÃ¶schen mÃ¶chten?',confirm_delete_profile:'Sind Sie sicher, dass Sie das Profil "{{profileName}}" lÃ¶schen mÃ¶chten?\n\nDiese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.',failed_to_copy_to_clipboard:"In Zwischenablage kopieren fehlgeschlagen",no_effects_selected:"Keine Effekte ausgewÃ¤hlt. Bitte wÃ¤hlen Sie mindestens einen Effekt aus, um Aliase zu generieren.",profile_created_from:'Profil "{{newName}}" aus "{{sourceProfile}}" erstellt',profile_renamed:'Profil von "{{oldName}}" zu "{{name}}" umbenannt',sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager erfolgreich geladen",switched_to_profile:"Zu Profil gewechselt: {{name}} ({{environment}})",yes:"Ja",no:"Nein",ok:"OK",no_commands:"Keine Befehle",profile_not_found:"Profil nicht gefunden",click_add_command_to_start_building_your_command_chain:"WÃ¤hlen Sie Elemente in der Befehlsbibliothek aus, um mit dem Erstellen Ihrer Tasten-Befehlsfolge fÃ¼r zu beginnen",click_add_command_to_start_building_your_alias_chain:"WÃ¤hlen Sie Elemente in der Befehlsbibliothek aus, um mit dem Erstellen Ihrer Alias-Befehlsfolge fÃ¼r zu beginnen",create_alias:"Alias erstellen",key:"Taste",no_profile:"Kein Profil",parameter_configuration:"Parameter-Konfiguration",stotrayexecbytray_description:"STOTrayExecByTray (zeigt Tastenbelegung in der UI an)",trayexecbytray_description:"TrayExecByTray (keine UI-Anzeige)",vfx_aliases:"VFX-Aliase",bindset_enable:"Aktivieren",vfx_alias_space:"VFX-Alias: Raum",vfx_alias_ground:"VFX-Alias: Boden",vfx_alias_combined:"VFX-Alias: Kombiniert Raum/Boden",vfx_suppression_loaded:"VFX-UnterdrÃ¼ckung geladen",vfx_suppression_for_environment:"VFX-UnterdrÃ¼ckung fÃ¼r {{environment}}-Umgebung",vfx_suppression_for_all_environments:"VFX-UnterdrÃ¼ckung fÃ¼r alle Umgebungen",delete_selected_key:"AusgewÃ¤hlte Taste lÃ¶schen",duplicate_selected_key:"AusgewÃ¤hlte Taste duplizieren",show_all_keys:"Alle Tasten anzeigen",duplicate:"Duplizieren",reserved_command_name:"Name steht im Konflikt mit einem STO-Befehl",backup_created_successfully:"Anwendungsbackup erfolgreich erstellt",failed_to_create_backup:"Backup erstellen fehlgeschlagen: {{error}}",backup_restored_successfully:"Anwendungsstatus erfolgreich wiederhergestellt",import_from_key_or_alias:"Von Taste oder Alias importieren",select_source_to_import_from:"Quelle zum Importieren auswÃ¤hlen:",clear_destination_chain_prior_to_import:"Zielkette vor Import lÃ¶schen",no_sources_available:"Keine Quellen verfÃ¼gbar",error_loading_sources:"Fehler beim Laden der Quellen",please_select_a_source:"Bitte wÃ¤hlen Sie eine Quelle",source_has_no_commands:"Quelle hat keine Befehle zum Importieren",commands_imported_successfully:"{{count}} Befehle von {{source}} importiert",cross_environment_import_warning:"Warnung: {{dropped}} {{sourceEnv}}-spezifische Befehle wurden beim Import nach {{targetEnv}} entfernt",no_compatible_commands_to_import:"Keine kompatiblen Befehle zum Importieren nach Filterung",failed_to_load_profile_data:"Fehler beim Laden der Profildaten",already_on_profile:"Bereits bei diesem Profil",source_profile_not_found:"Quellprofil nicht gefunden",profile_name_required:"Profilname ist erforderlich",switch_to_key_type_view:"Zur Tastentypansicht wechseln",switch_to_grid_view:"Zur Rasteransicht wechseln",switch_to_command_categories:"Zu Befehlskategorien wechseln",no_profiles_available:"Keine Profile verfÃ¼gbar",verb:{say:"Sagen (Lokal)",team:"Team",zone:"Zone",tell:"FlÃ¼stern"},duplicate_alias:"Alias duplizieren",enter_new_alias_name:"Neuen Alias-Namen eingeben",alias_name_in_use:"Alias-Name bereits vergeben",failed_to_rename_profile:"Fehler beim Umbenennen des Profils: {{error}}",ground_build:"Boden-Build",import_failed_invalid_json:"Import fehlgeschlagen: UngÃ¼ltiges JSON-Format",import_failed_unsupported_format:"Import fehlgeschlagen: Nicht unterstÃ¼tztes Dateiformat",no_content_available:"Kein Inhalt verfÃ¼gbar",no_valid_profile:"Kein gÃ¼ltiges Profil verfÃ¼gbar",profile_already_exists:"Profil existiert bereits",profile_id_required:"Profil-ID ist erforderlich",space_build:"Weltraum-Build",syncing:"Synchronisiere...",command_parameters:{active:{label:"Aktiv",help:"0: Deaktiviert, 1: Aktiviert"},tray:{label:"Fach",help:"Fachnummer (0-9)"},slot:{label:"Slot",help:"Slotnummer (0-9)"},start_tray:{label:"Startfach",help:"Startfachnummer"},end_tray:{label:"Endfach",help:"Endfachnummer"},start_slot:{label:"Startslot",help:"Startslotnummer"},end_slot:{label:"Endslot",help:"Endslotnummer"},backup_tray:{label:"Backup-Fach",help:"Backup-Fachnummer"},backup_slot:{label:"Backup-Slot",help:"Backup-Slotnummer"},backup_start_tray:{label:"Backup-Startfach",help:"Backup-Startfachnummer"},backup_end_tray:{label:"Backup-Endfach",help:"Backup-Endfachnummer"},backup_start_slot:{label:"Backup-Startslot",help:"Backup-Startslotnummer"},backup_end_slot:{label:"Backup-Endslot",help:"Backup-Endslotnummer"},command_type:{label:"Befehlstyp",help:"BefehlsausfÃ¼hrungstyp (STOTrayExecByTray zeigt UI, TrayExecByTray nicht)"},entityName:{label:"EntitÃ¤tsname",help:"Name der zu zielenden EntitÃ¤t"},message:{label:"Nachricht",help:"Nachrichtentext zum Senden"},distance:{label:"Entfernung",help:"Kameraentfernungswert"},amount:{label:"Betrag",help:"Drosselstellungsbetrag"},position:{label:"Position",help:"Drosselstellung (0-100)"},filename:{label:"Dateiname",help:"Dateiname (ohne Erweiterung)"},state:{label:"Status",help:"1 zum Aktivieren, 0 zum Deaktivieren"},verb:{label:"Kanal",help:"Kommunikationskanal (sagen, Team, Zone)"},alias_name:{label:"Alias-Name",help:"Name des auszufÃ¼hrenden Alias"},rawCommand:{label:"Befehl",help:"Roher STO-Befehlstext"},seconds:{label:"Sekunden",help:"VerzÃ¶gerung in Sekunden"},alpha:{label:"Alpha",help:"Transparenzwert (0-255)"},modifier1:{label:"Modifikator 1",help:"Erste Modifikator-Tastenkombination"},modifier2:{label:"Modifikator 2",help:"Zweite Modifikator-Tastenkombination"},name:{label:"Name",help:"Name des Ziels oder Objekts"}},add_new_alias:"Neuen Alias hinzufÃ¼gen",delete_selected_alias:"AusgewÃ¤hlten Alias lÃ¶schen",duplicate_selected_alias:"AusgewÃ¤hlten Alias duplizieren",search_aliases:"Aliase suchen...",clear_filter:"Filter lÃ¶schen",warning:"Warnung",error:"Fehler",validation_details:"Validierungsdetails",command_chain_near_limit:"Befehlsfolge ist fast zu lang ({{length}} Zeichen). Ãœberschreiten von 999 kann zu Fehlern fÃ¼hren.",command_chain_too_long:"Befehlsfolge ist zu lang ({{length}} Zeichen) und kann im Spiel fehlschlagen.",sto_tray_exec_optimization_suggestion:"Befehlsfolge ist {{currentLength}} Zeichen lang. Das Ersetzen von {{count}} Vorkommen von STOTrayExecByTray durch TrayExecByTray wÃ¼rde {{potentialSavings}} Zeichen sparen (neue LÃ¤nge: {{newLength}}).",stabilized_non_tray_warning:"Stabilisierte AusfÃ¼hrung sollte nur mit Tray-AusfÃ¼hrungsfÃ¤higkeiten verwendet werden.",too_many_commands_on_key:"Die Zuordnung von {{count}} Befehlen zu einer Taste kann im Spiel fehlschlagen (empfohlene Obergrenze 20).",alias_mixed_environment_warning:"Alias enthÃ¤lt sowohl weltraum- als auch bodenspezifische Befehle; dies ist nicht empfohlen.",spam_bar_warning:"Nicht fÃ¼r Spam-Leisten empfohlen, da es die Feuerzyklen stÃ¶rt",press_any_key_combination:"DrÃ¼cken Sie eine beliebige Tastenkombination...",capture_instructions:"Verwende deine Tastatur oder Maus, oder wechsle in den manuellen Modus, um unten Tasten anzuklicken",switch_to_manual:"Manuelle Auswahl",start_capture:"Aufnahme starten",selected_key:"AusgewÃ¤hlte Taste",confirm_selection:"Auswahl bestÃ¤tigen",key_selection_failed:"Tastenauswahl fehlgeschlagen",error_generating_command:"Fehler beim Generieren des Befehls",please_enter_a_raw_command:"Bitte geben Sie einen Befehl ein",unsafe_keybind:"Unsichere Tastenkombination: {{key}} ist nicht zulÃ¤ssig",generated_alias:"Generierter Alias:",bindsets_enabled:"Bindsets aktivieren",bindsets_enabled_description:"ErmÃ¶glicht die Erstellung und das Laden von Bindsets (erfordert 'Keybind-Ketten als Aliase erstellen').",bindsets:"Bindsets",bindset_manager:"Bindset-Manager",create_bindset:"Bindset erstellen",enter_bindset_name:"Bindset-Name eingeben:",bindset_name:"Bindset-Name",bindset_name_in_use:"Bindset-Name bereits vergeben",bindset_not_empty:"Bindset enthÃ¤lt Keybinds und kann nicht gelÃ¶scht werden",invalid_name:"UngÃ¼ltiger Name",add_key_to_bindset:"Taste zu Bindset hinzufÃ¼gen",add_key_to_bindset_confirm:'Taste "{{key}}" zu Bindset "{{bindset}}" hinzufÃ¼gen?',manage_bindsets:"Bindsets verwalten",primary_bindset:"PrimÃ¤res Bindset",remove_key_from_bindset:"Taste aus Bindset entfernen",remove_key_from_bindset_confirm:'Taste "{{key}}" aus Bindset "{{bindset}}" entfernen?',select_bindset:"Bindset auswÃ¤hlen",confirm_delete:"Sind Sie sicher, dass Sie lÃ¶schen mÃ¶chten?",enter_new_name:"Neuen Namen eingeben:",translate_generated_messages:"Generierte Nachrichten Ã¼bersetzen",translate_generated_messages_description:"Wenn aktiviert, werden automatisch generierte Nachrichten (wie VFX-UnterdrÃ¼ckungsbenachrichtigungen) in die ausgewÃ¤hlte Sprache Ã¼bersetzt. Wenn deaktiviert, bleiben sie auf Englisch.",distinguish_left_right_modifiers:"Linke/rechte Modifikatoren unterscheiden",confirm_reset_application:"Sind Sie sicher, dass Sie die Anwendung zurÃ¼cksetzen mÃ¶chten?\n\nDies lÃ¶scht alle Profile, Keybinds und Einstellungen. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.",environment:"Umgebung",export_alias_definitions_note:"(Alias-Definitionen sind in der Alias-Datei)",export_generated_aliases_count:"aus Alias-an-Tasten-Modus ({{count}} generierte Aliase)",export_generated_aliases_note:"Keybind-Zeilen, die generierte Aliase aufrufen",export_user_and_generated_aliases:"Diese Datei enthÃ¤lt sowohl benutzererstellte Aliase als auch generierte Aliase",please_select_an_alias_first:"Bitte wÃ¤hlen Sie zuerst einen Alias",confirm_reset_app:"Anwendung zurÃ¼cksetzen bestÃ¤tigen",configure_colon:"Konfigurieren:",edit_colon:"Bearbeiten:",default_profile_exists_message:'Ein Profil namens "Default" existiert bereits. Das Laden der Standarddaten wÃ¼rde es Ã¼berschreiben. MÃ¶chten Sie fortfahren?',default_profile_exists_title:"Standard-Profil existiert",ground_alias:"Boden-Alias",space_alias:"Raum-Alias",backup_restore_failed:"Wiederherstellung der Sicherung fehlgeschlagen: {{error}}",confirm_add:"HinzufÃ¼gen bestÃ¤tigen",confirm_delete_bindset:'Bindset "{{name}}" lÃ¶schen?',confirm_remove:"Entfernen bestÃ¤tigen",error_add_failed:"Fehler beim HinzufÃ¼gen der Taste zum Bindset",error_remove_failed:"Fehler beim Entfernen der Taste aus dem Bindset",name_exists:"Name existiert bereits",name_required:"Name ist erforderlich",name_unchanged:"Name ist unverÃ¤ndert",not_found:"Nicht gefunden",rename_bindset:"Bindset umbenennen",source_profile_and_new_name_required:"Quellprofil-ID und neuer Name sind erforderlich",unknown_command:"Unbekannter Befehl"},ie={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Enregistrer",explorer:"Explorateur",import_keybinds:"Importer les raccourcis",import_environment:"Importer les raccourcis",import_environment_question:"Choisissez un environnement pour importer ce fichier de raccourcis",aliases:"Alias",import_aliases:"Importer les alias",import:"Importer",backup:"Sauvegarde",backup_menu:"Sauvegarde",backup_application_state:"Sauvegarder l'Ã©tat de l'application",restore_application_state:"Restaurer l'Ã©tat de l'application",preferences:"PrÃ©fÃ©rences",language:"Langue",sync_folder_label:"Dossier de synchronisation :",no_folder_selected:"Aucun dossier sÃ©lectionnÃ©",download:"TÃ©lÃ©charger",vfx:"VFX",dark_mode:"Mode sombre",light_mode:"Mode clair",load_default_data:"Charger les donnÃ©es par dÃ©faut",reset_application:"RÃ©initialiser l'application",set_sync_folder:"DÃ©finir dossier de synchronisation",sync_now:"Synchroniser maintenant",about:"Ã€ propos",rename:"Renommer",delete:"Supprimer",space:"Espace",ground:"Sol",modified:"ModifiÃ©",valid:"Valide",keys:"touches",keys_firstupper:"Touches",copy:"Copier",select_a_key_to_edit:"SÃ©lectionnez une touche Ã  modifier",commands:"commandes",command_singular:"commande",no_key_selected:"Aucune touche sÃ©lectionnÃ©e",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"SÃ©lectionnez une touche dans le panneau de gauche pour voir et modifier sa chaÃ®ne de commandes.",generated_command:"Commande gÃ©nÃ©rÃ©e :",select_a_key_to_see_the_generated_command:"SÃ©lectionnez une touche pour voir la commande gÃ©nÃ©rÃ©e",add_command:"Ajouter une commande",command_library:"BibliothÃ¨que de commandes",add_new_key:"Ajouter une nouvelle touche",ctrl:"Ctrl",alt:"Alt",shift:"Maj",cancel:"Annuler",custom:"PersonnalisÃ©",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"alias",profile:"Profil",profile_name:"Nom du profil :",description_optional:"Description (optionnelle) :",alias_name:"Nom de l'alias :",select_key_dialog_title:"SÃ©lectionner la Touche",vfx_manager:"Gestionnaire VFX",space_effects:"Effets d'espace",select_all:"Tout sÃ©lectionner",clear_all:"Tout effacer",selected:"sÃ©lectionnÃ©",ground_effects:"Effets de sol",generated_aliases:"Alias gÃ©nÃ©rÃ©s :",no_space_effects_selected:"Aucun effet d'espace sÃ©lectionnÃ©",no_ground_effects_selected:"Aucun effet de sol sÃ©lectionnÃ©",show_player_say:"Afficher le Say du joueur",generate_aliases:"GÃ©nÃ©rer des Alias",about_sto_tools_keybind_manager:"Ã€ propos de STO Tools Keybind Manager",features:"FonctionnalitÃ©s :",visual_keybind_editor:"Ã‰diteur visuel de raccourcis",sto_command_library_with_search_and_categorization:"BibliothÃ¨que de commandes STO avec recherche et catÃ©gorisation",multiple_profile_management_create_clone_rename_delete:"Gestion de profils multiples (crÃ©er, cloner, renommer, supprimer)",custom_alias_system_for_complex_command_sequences:"SystÃ¨me d'alias personnalisÃ© pour les sÃ©quences de commandes complexes",vertigo_inspired_vfx_manager_for_visual_effects_control:"Gestionnaire VFX inspirÃ© de VERTIGO pour le contrÃ´le des effets visuels",import_export_keybind_and_alias_files_and_project_backups:"Import/export de fichiers de raccourcis et d'alias, et sauvegardes de projet",real_time_validation_and_command_preview:"Validation en temps rÃ©el et aperÃ§u des commandes",quick_start:"DÃ©marrage rapide :",create_a_new_profile_or_use_the_default_profile:"CrÃ©ez un nouveau profil ou utilisez le profil par dÃ©faut",select_keys_from_the_grid_and_add_commands_from_the_library:"SÃ©lectionnez des touches dans la grille et ajoutez des commandes depuis la bibliothÃ¨que",use_the_command_chain_editor_to_build_complex_sequences:"Utilisez l'Ã©diteur de chaÃ®nes de commandes pour construire des sÃ©quences complexes",export_your_keybinds_as_txt_files_for_use_in_sto:"Exportez vos raccourcis en fichiers .txt pour utilisation dans STO",resources:"Ressources :",copyright:"Â© 2025 STO Tools. Tous droits rÃ©servÃ©s.",got_it:"Compris !",file_explorer:"Explorateur de fichiers",select_an_item_on_the_left_to_preview_export:"SÃ©lectionnez un Ã©lÃ©ment Ã  gauche pour prÃ©visualiser l'export",close:"Fermer",filter_keys:"Filtrer les touches...",search_commands:"Rechercher des commandes...",enter_profile_name:"Entrez le nom du profil",describe_this_keybind_profile:"DÃ©crivez ce profil de raccourcis",search_keys:"Rechercher des touches...",settings:"ParamÃ¨tres",select_profile:"SÃ©lectionner un profil",new_profile:"Nouveau profil",clone_profile:"Cloner le profil",rename_profile:"Renommer le profil",delete_profile:"Supprimer le profil",space_mode:"Mode espace",ground_mode:"Mode sol",unsaved_changes:"Modifications non enregistrÃ©es",validation_status:"Statut de validation",bound_keys:"Touches liÃ©es",toggle_between_grid_and_categorized_view:"Basculer entre la vue grille et catÃ©gorisÃ©e",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Assure un ordre d'exÃ©cution cohÃ©rent en miroir des commandes (Phase 1 : gauche Ã  droite, Phase 2 : droite Ã  gauche)",validate_command_chain:"Valider la chaÃ®ne de commandes",command_chain:"ChaÃ®ne de commandes",alias_chain:"ChaÃ®ne d'alias",chain_for_key:"{{chainType}} pour {{key}}",clear_all_commands:"Effacer toutes les commandes",copy_to_clipboard:"Copier dans le presse-papiers",generated:"GÃ©nÃ©rÃ© :",created_by:"CrÃ©Ã© par :",statistics:"Statistiques",total_commands:"Total des commandes :",command_aliases:"Alias de commandes",key_type:{function_keys:"Touches de fonction",letters_numbers:"Lettres et nombres",numberpad:"PavÃ© numÃ©rique",modifier_keys:"Touches modificatrices",navigation:"Navigation",system_keys:"Touches systÃ¨me",mouse_wheel:"Souris et molette",symbols_punctuation:"Symboles et ponctuation",other_keys:"Autres touches"},command_categories:{targeting:"Ciblage",combat:"Combat",cosmetic:"CosmÃ©tique",bridge_officer:"Officier de passerelle",tray:"ExÃ©cution de Plateau",power:"Gestion des Boucliers",movement:"Mouvement",camera:"CamÃ©ra",communication:"Communication",system:"SystÃ¨me",custom:"PersonnalisÃ©"},command_definitions:{add_custom_command:{name:"Ajouter une commande personnalisÃ©e",description:"Ajouter n'importe quelle commande STO comme texte brut"},target:{name:"Cibler par nom",description:"Cibler une entitÃ© par son nom (nÃ©cessite des guillemets)"},target_enemy_near:{name:"Cibler l'ennemi le plus proche",description:"Cibler l'ennemi le plus proche en vue"},target_friend_near:{name:"Cibler l'alliÃ© le plus proche",description:"Cibler l'entitÃ© amie la plus proche"},target_self:{name:"Se cibler soi-mÃªme",description:"Cibler votre propre vaisseau/personnage"},target_clear:{name:"Effacer la cible",description:"Supprimer le verrouillage de cible actuel"},target_teammate_1:{name:"Cibler coÃ©quipier 1",description:"Cibler le premier membre de l'Ã©quipe"},target_teammate_2:{name:"Cibler coÃ©quipier 2",description:"Cibler le deuxiÃ¨me membre de l'Ã©quipe"},target_teammate_3:{name:"Cibler coÃ©quipier 3",description:"Cibler le troisiÃ¨me membre de l'Ã©quipe"},target_teammate_4:{name:"Cibler coÃ©quipier 4",description:"Cibler le quatriÃ¨me membre de l'Ã©quipe"},fire_all:{name:"Tirer toutes les armes",description:"Tirer toutes les armes"},fire_phasers:{name:"Tirer armes Ã  Ã©nergie",description:"Tirer toutes les armes Ã  Ã©nergie"},fire_torps:{name:"Tirer torpilles",description:"Tirer toutes les torpilles"},fire_mines:{name:"Tirer mines",description:"Tirer toutes les mines"},fire_phasers_torps:{name:"Tirer phasers et torpilles",description:"Tirer phasers et torpilles"},fire_projectiles:{name:"Tirer les Projectiles",description:"Tirer les torpilles et mines"},setactivecostume:{name:"DÃ©finir le Costume Actif",description:"DÃ©finit le costume actif actuel. NÃ©cessite deux modificateurs."},custom_tray:{name:"ExÃ©cution de plateau",description:"ExÃ©cuter un emplacement de plateau spÃ©cifique"},tray_with_backup:{name:"ExÃ©cution de plateau avec sauvegarde",description:"ExÃ©cuter un emplacement de plateau spÃ©cifique avec capacitÃ© de sauvegarde"},tray_range:{name:"ExÃ©cution de plage de plateau",description:"ExÃ©cuter une plage d'emplacements de plateau"},tray_range_with_backup:{name:"Plage de plateau avec sauvegarde",description:"ExÃ©cuter une plage d'emplacements de plateau avec capacitÃ©s de sauvegarde"},whole_tray:{name:"ExÃ©cution de plateau entier",description:"ExÃ©cuter tous les emplacements d'un plateau"},whole_tray_with_backup:{name:"Plateau entier avec sauvegarde",description:"ExÃ©cuter tous les emplacements d'un plateau avec plateau de sauvegarde"},distribute_shields:{name:"Distribuer les boucliers",description:"Distribue uniformÃ©ment les boucliers comme si on cliquait au milieu de l'icÃ´ne vaisseau et boucliers"},reroute_shields_rear:{name:"Rediriger boucliers arriÃ¨re",description:"Rediriger l'Ã©nergie des boucliers vers l'arriÃ¨re"},reroute_shields_left:{name:"Rediriger boucliers gauche",description:"Rediriger l'Ã©nergie des boucliers vers la gauche"},reroute_shields_right:{name:"Rediriger boucliers droite",description:"Rediriger l'Ã©nergie des boucliers vers la droite"},reroute_shields_forward:{name:"Rediriger boucliers avant",description:"Rediriger l'Ã©nergie des boucliers vers l'avant"},full_impulse:{name:"Impulsion maximale",description:"Engager le moteur Ã  impulsion maximale"},reverse:{name:"Marche arriÃ¨re",description:"Moteurs en marche arriÃ¨re"},throttle_adjust:{name:"Ajuster les gaz",description:"Augmenter ou diminuer les gaz d'une certaine quantitÃ©"},throttle_set:{name:"RÃ©gler les gaz",description:"RÃ©gler les gaz Ã  une position spÃ©cifique (nÃ©gatif = marche arriÃ¨re, 0 = arrÃªt)"},throttle_toggle:{name:"Basculer les gaz",description:"Alterner entre gaz maximum et arrÃªt complet"},turn_left:{name:"Tourner Ã  gauche",description:"Tourner le vaisseau Ã  gauche (continu tant que maintenu)"},turn_right:{name:"Tourner Ã  droite",description:"Tourner le vaisseau Ã  droite (continu tant que maintenu)"},pitch_up:{name:"Cabrer",description:"Cabrer le nez du vaisseau vers le haut (changement d'altitude dans l'espace)"},pitch_down:{name:"Piquer",description:"Piquer le nez du vaisseau vers le bas (changement d'altitude dans l'espace)"},strafe_left:{name:"DÃ©placement latÃ©ral gauche",description:"DÃ©placer le vaisseau latÃ©ralement Ã  gauche"},strafe_right:{name:"DÃ©placement latÃ©ral droite",description:"DÃ©placer le vaisseau latÃ©ralement Ã  droite"},forward:{name:"Avancer",description:"Avancer"},backward:{name:"Reculer",description:"Reculer"},auto_forward:{name:"Avance automatique",description:"Le personnage avance jusqu'Ã  ce que de nouvelles commandes de mouvement soient donnÃ©es"},follow:{name:"Suivre la cible",description:"Suivre l'entitÃ© ciblÃ©e"},follow_cancel:{name:"Annuler le suivi",description:"ArrÃªter de suivre et oublier la cible"},zoom_in:{name:"Zoomer",description:"Zoomer la camÃ©ra"},zoom_out:{name:"DÃ©zoomer",description:"DÃ©zoomer la camÃ©ra"},zoom_in_small:{name:"Zoomer lÃ©gÃ¨rement",description:"Zoomer lÃ©gÃ¨rement la camÃ©ra"},zoom_out_small:{name:"DÃ©zoomer lÃ©gÃ¨rement",description:"DÃ©zoomer lÃ©gÃ¨rement la camÃ©ra"},cam_distance:{name:"DÃ©finir distance camÃ©ra",description:"DÃ©finir la distance de la camÃ©ra par rapport au joueur"},cam_reset:{name:"RÃ©initialiser camÃ©ra",description:"RÃ©initialiser la position de la camÃ©ra par dÃ©faut"},cam_target_lock:{name:"Verrouiller camÃ©ra sur cible",description:"Verrouiller ou dÃ©verrouiller la camÃ©ra sur la cible"},cam_cycle_distance:{name:"Alterner distance camÃ©ra",description:"Alterner la distance de la camÃ©ra entre plusieurs valeurs prÃ©dÃ©finies"},cam_mouse_look:{name:"Vue souris",description:"Activer le contrÃ´le de camÃ©ra par vue souris"},cam_turn_to_face:{name:"Tourner vers la camÃ©ra",description:"Tourner le vaisseau pour faire face Ã  la direction de la camÃ©ra"},look_up:{name:"Regarder vers le haut",description:"Changer le point de vue pour regarder droit vers le haut"},look_down:{name:"Regarder vers le bas",description:"Changer le point de vue pour regarder droit vers le bas"},team_message:{name:"Message d'Ã©quipe",description:"Envoyer un message Ã  l'Ã©quipe"},local_message:{name:"Message local",description:"Envoyer un message Ã  la zone locale"},zone_message:{name:"Message de zone",description:"Envoyer un message Ã  la zone"},toggle_hud:{name:"Basculer HUD",description:"Basculer la visibilitÃ© du HUD"},screenshot:{name:"Capture d'Ã©cran",description:"Prendre une capture d'Ã©cran"},screenshot_jpg:{name:"Capture d'Ã©cran JPG",description:"Sauvegarder une capture d'Ã©cran en JPG"},autofire_set:{name:"DÃ©finir tir automatique",description:"Activer et dÃ©sactiver le tir automatique des armes. X = 1 l'active et X = 0 le dÃ©sactive."},bind_save_file:{name:"Sauvegarder raccourcis vers fichier",description:"Sauvegarder tous vos raccourcis dans un fichier texte"},bind_load_file:{name:"Charger raccourcis depuis fichier",description:"Charger un fichier de raccourcis dans le client"},combat_log:{name:"Basculer journal de combat",description:"Activer/dÃ©sactiver l'enregistrement du journal de combat (1=activÃ©, 0=dÃ©sactivÃ©)"},missions:{name:"Afficher/Masquer missions",description:"Afficher/masquer le journal des missions"},inventory:{name:"Afficher/Masquer inventaire",description:"Afficher/masquer votre inventaire"},map:{name:"Afficher/Masquer carte",description:"Afficher/masquer la fenÃªtre de carte"},logout:{name:"Se dÃ©connecter",description:"Se dÃ©connecter du personnage actuel."},quit:{name:"Quitter le jeu",description:"Fermer la fenÃªtre."},ui_load:{name:"Charger les paramÃ¨tres UI",description:"Charge le fichier de sauvegarde par dÃ©faut des fenÃªtres UI, gÃ©nÃ©ralement Live\\ui_settings.txt"},ui_save:{name:"Sauvegarder les paramÃ¨tres UI",description:"Sauvegarde la mise en page UI dans le fichier de sauvegarde par dÃ©faut des fenÃªtres UI, gÃ©nÃ©ralement Live\\ui_settings.txt"},ui_load_file:{name:"Charger le fichier de paramÃ¨tres UI",description:"Charge le fichier de sauvegarde des fenÃªtres UI nommÃ©"},ui_save_file:{name:"Sauvegarder le fichier de paramÃ¨tres UI",description:"Sauvegarde la mise en page UI dans le fichier de sauvegarde des fenÃªtres UI nommÃ©"},ui_cancel:{name:"UI Annuler",description:'RÃ©pond "Annuler" Ã  une boÃ®te de dialogue ouverte; peut ne pas fonctionner dans tous les dialogues.'},ui_ok:{name:"UI OK",description:'RÃ©pond "OK" Ã  une boÃ®te de dialogue ouverte; peut ne pas fonctionner dans tous les dialogues.'},chat_log:{name:"Basculer le journal de chat",description:"Activer/dÃ©sactiver le journal de chat. 1=activÃ©, 0=dÃ©sactivÃ©, pas de paramÃ¨tre=afficher le statut. PrÃ©fixer ++ le transforme en bascule"},remember_ui_lists:{name:"MÃ©moriser les listes UI",description:"S'il faut mÃ©moriser le placement et la largeur des colonnes des listes UI."},ui_remember_positions:{name:"MÃ©moriser les positions UI",description:"S'il faut mÃ©moriser les tailles et positions UI. ActivÃ© par dÃ©faut."},safe_login:{name:"Connexion sÃ©curisÃ©e",description:"Si vrai, alors connecte le joueur Ã  sa carte statique la plus rÃ©cente au lieu de n'importe quoi d'autre."},goto_character_select:{name:"Aller Ã  la sÃ©lection de personnage",description:"Aller Ã  l'Ã©cran de sÃ©lection de personnage sans se dÃ©connecter."},ui_gen_layers_reset:{name:"RÃ©initialiser la mise en page UI",description:"RÃ©initialise la mise en page, utilisÃ© quand le serveur met Ã  jour les positions des fenÃªtres mobiles"},ui_resolution:{name:"Afficher la rÃ©solution UI",description:"Affiche la rÃ©solution d'Ã©cran UI actuelle."},ui_tooltip_delay:{name:"DÃ©finir le dÃ©lai d'infobulle",description:"DÃ©finit le dÃ©lai supplÃ©mentaire, en secondes, avant que les infobulles apparaissent"},show_game_ui:{name:"Afficher l'UI du jeu",description:"Afficher l'UI du jeu"},show_game_ui_no_extra_keybinds:{name:"Afficher l'UI du jeu (sans raccourcis supplÃ©mentaires)",description:"Cette commande n'ajoute aucun raccourci pour afficher l'UI quand l'utilisateur appuie sur Ã©chap"},change_instance:{name:"Changer d'instance",description:"Changer vers une instance dÃ©jÃ  crÃ©Ã©e de la mÃªme carte. Ne fonctionne que quand pas en alerte rouge."},aim:{name:"Viser/Lunette",description:"Activer/dÃ©sactiver la lunette. En mode lunette le joueur fait plus de dÃ©gÃ¢ts. Peut Ãªtre utilisÃ© comme bascule ou appuyer et maintenir"},holster:{name:"Ranger l'arme",description:"Tenter de ranger votre arme active"},holster_toggle:{name:"Basculer ranger l'arme",description:"Tenter de ranger ou dÃ©gainer vos armes"},unholster:{name:"DÃ©gainer l'arme",description:"Tenter de dÃ©gainer votre arme active"},toggle_shooter_mode:{name:"Basculer le mode tireur",description:"Activer/dÃ©sactiver le mode tireur"},shooter_primary:{name:"Tireur primaire",description:"Action primaire du mode tireur"},shooter_secondary:{name:"Tireur secondaire",description:"Action secondaire du mode tireur"},shooter_tertiary:{name:"Tireur tertiaire",description:"Action tertiaire du mode tireur"},shooter_clear_offset_tray_binds:{name:"Effacer les liaisons de plateau de dÃ©calage du tireur",description:"Effacer l'emplacement de dÃ©part et le mouvement de la boÃ®te d'action jaune qui apparaÃ®t sur le plateau en mode tireur"},shooter_clear_overlay_tray_binds:{name:"Effacer les liaisons de plateau superposÃ© du tireur",description:"Effacer les liaisons de plateau superposÃ© pour le mode tireur"},shooter_set_offset_tray_binds:{name:"DÃ©finir les liaisons de plateau de dÃ©calage du tireur",description:"DÃ©finir l'emplacement de dÃ©part et le mouvement de la boÃ®te d'action jaune qui apparaÃ®t sur le plateau en mode tireur"},shooter_set_overlay_tray_binds:{name:"DÃ©finir les liaisons de plateau superposÃ© du tireur",description:"DÃ©finir les liaisons de plateau superposÃ© pour le mode tireur"},setrallypoint:{name:"DÃ©finir Point de Ralliement",description:"DÃ©finit un point de ralliement pour votre cible actuelle"},setrallypointconsole:{name:"DÃ©finir Point de Ralliement (Console)",description:"DÃ©finit un point de ralliement pour votre cible actuelle (variante console)"},clearrallypoint:{name:"Effacer Point de Ralliement",description:"Efface le point de ralliement pour votre cible actuelle"},clearallrallypoints:{name:"Effacer Tous les Points de Ralliement",description:"Efface tous les points de ralliement"},assist:{name:"Assister",description:"Assister '<name>': Assiste l'entitÃ© portant le nom correspondant. Si aucun nom n'est donnÃ©, assiste votre cible actuelle."},net_timing_graph:{name:"Graphique de Timing RÃ©seau",description:"Activer ou dÃ©sactiver le graphique de timing rÃ©seau (0=dÃ©sactiver, 1=activer)"},net_timing_graph_alpha:{name:"Alpha du Graphique de Timing RÃ©seau",description:"DÃ©finir le niveau de transparence pour le graphique de timing rÃ©seau (50=transparence maximale, 255=aucune transparence)"},net_timing_graph_paused:{name:"Graphique de Timing RÃ©seau en Pause",description:"Mettre en pause ou reprendre le graphique de timing rÃ©seau (0=pause dÃ©sactivÃ©e, 1=pause activÃ©e)"},netgraph:{name:"Graphique RÃ©seau",description:"Afficher les donnÃ©es rÃ©seau SND et RCV sous forme de texte (1=activÃ©, 0=dÃ©sactivÃ©)"},parameter_placeholders:{any_sto_command:"Entrez n'importe quelle commande STO (ex: Target_Enemy_Near)",entity_name:"Entrez le nom de l'entitÃ©",first_modifier:"Premier modificateur",second_modifier:"DeuxiÃ¨me modificateur",entity_name_optional:"Nom de l'entitÃ© (optionnel)"}},category_descriptions:{targeting:"SÃ©lection et gestion des cibles",combat:"Tir d'armes et actions de combat",tray:"ExÃ©cuter des capacitÃ©s depuis les plateaux d'action",power:"Gestion de l'Ã©nergie et distribution des boucliers",movement:"Mouvement et navigation du vaisseau",camera:"ContrÃ´le de camÃ©ra et gestion de vue",communication:"Chat et communication d'Ã©quipe",system:"Commandes UI et systÃ¨me",custom:"Commandes personnalisÃ©es"},no_aliases_defined:"Aucun alias dÃ©fini",create_alias_to_get_started:"CrÃ©ez un alias pour commencer",alias_deleted:'Alias "{{aliasName}}" supprimÃ©',please_select_a_key_first:"Veuillez d'abord sÃ©lectionner une touche",no_active_profile:"Aucun profil actif",alias_not_found:'Alias "{{name}}" introuvable',alias_created:"Alias crÃ©Ã© avec succÃ¨s",import_failed:"Ã‰chec de l'importation : {{error}}",storage_not_available:"Stockage non disponible",no_aliases_found_in_file:"Aucun alias trouvÃ© dans le fichier",import_completed_keybinds:"Importation terminÃ©e : {{count}} raccourcis",import_completed_aliases:"Importation terminÃ©e : {{count}} alias",project_imported_successfully:"Projet importÃ© avec succÃ¨s : {{profileCount}} profils",sync_folder_set:"Dossier de synchronisation sÃ©lectionnÃ©",failed_to_set_sync_folder:"Ã‰chec de la sÃ©lection du dossier de synchronisation : {{error}}",sync_not_supported_firefox:"La fonctionnalitÃ© de dossier de synchronisation nÃ©cessite un navigateur basÃ© sur Chromium (Chrome, Edge, etc.). Firefox ne prend pas en charge l'API File System Access requise.",sync_not_supported_title:"Synchronisation non prise en charge",sync_not_supported_detailed:"La fonctionnalitÃ© de synchronisation n'est pas disponible dans Firefox en raison des limitations du navigateur. L'API File System Access requise pour la synchronisation des dossiers n'est prise en charge que dans les navigateurs basÃ©s sur Chromium. Vous pouvez toujours sauvegarder et restaurer manuellement l'Ã©tat de votre application ou utiliser l'Explorateur de Fichiers pour copier vos fichiers de keybind et d'alias.",sync_not_supported_secure_context:"Le service de synchronisation n'est pas disponible lorsqu'il est servi sur HTTP. Veuillez utiliser HTTPS ou accÃ©der via le protocole file:// pour activer la fonctionnalitÃ© de synchronisation.",sync_not_supported_secure_context_title:"Contexte sÃ©curisÃ© requis",sync_not_supported_secure_context_detailed:"La fonctionnalitÃ© de synchronisation nÃ©cessite une connexion sÃ©curisÃ©e (HTTPS) ou un accÃ¨s aux fichiers locaux (file://) pour fonctionner. L'API File System Access nÃ©cessaire pour la synchronisation des dossiers n'est disponible que dans des contextes sÃ©curisÃ©s pour protÃ©ger vos donnÃ©es. Veuillez accÃ©der Ã  cette application via HTTPS ou ouvrez-la en tant que fichier local.",sync_not_supported_browser:"Votre navigateur ne prend pas en charge l'API File System Access requise pour la fonctionnalitÃ© de synchronisation.",sync_not_supported_browser_title:"Navigateur non pris en charge",sync_not_supported_browser_detailed:"Votre navigateur ne prend pas en charge l'API File System Access requise pour la synchronisation des dossiers. Veuillez essayer d'utiliser un navigateur basÃ© sur Chromium (Chrome, Edge, etc.) avec une connexion sÃ©curisÃ©e (HTTPS) ou un accÃ¨s aux fichiers locaux.",no_sync_folder_selected:"Aucun dossier de synchronisation sÃ©lectionnÃ©",project_synced_successfully:"Projet synchronisÃ© avec succÃ¨s",sync_folder_contains_project_title:"DonnÃ©es de Synchronisation Existantes TrouvÃ©es",sync_folder_contains_project_prompt:"Ce dossier contient dÃ©jÃ  un project.json d'une synchronisation prÃ©cÃ©dente. L'importer maintenant au lieu d'Ã©craser ?",project_imported_from_sync_folder:"Ã‰tat de l'application importÃ© depuis le dossier de synchronisation",sync_overwrite_existing_title:"Ã‰craser les DonnÃ©es de Synchronisation ?",sync_overwrite_existing_prompt:"Importation refusÃ©e. Ã‰craser le dossier de synchronisation avec l'Ã©tat actuel de l'application ?",sync_operation_cancelled:"Synchronisation annulÃ©e",failed_to_import_project:"Ã‰chec de l'importation du projet : {{error}}",permission_denied_to_folder:"Permission refusÃ©e pour Ã©crire dans le dossier",failed_to_sync_project:"Ã‰chec de la synchronisation du projet : {{error}}",synchronization:"Synchronisation",advanced:"AvancÃ©",synchronization_settings:"ParamÃ¨tres de synchronisation",advanced_settings:"ParamÃ¨tres avancÃ©s",sync_folder_description:"Choisissez un dossier pour synchroniser automatiquement vos projets",auto_sync:"Synchronisation automatique",auto_sync_description:"Synchroniser automatiquement les modifications avec le dossier sÃ©lectionnÃ©",auto_sync_interval:"Intervalle de synchronisation automatique",auto_sync_interval_description:"Ã€ quelle frÃ©quence synchroniser automatiquement vos modifications",after_every_change:"AprÃ¨s chaque modification",every_1_minute:"Chaque minute",every_2_minutes:"Toutes les 2 minutes",every_5_minutes:"Toutes les 5 minutes",preferences_saved:"PrÃ©fÃ©rences sauvegardÃ©es avec succÃ¨s",vfx_manager_description:"SÃ©lectionnez les effets visuels Ã  dÃ©sactiver en utilisant les alias dynFxSetFXExlusionList. Les effets sont organisÃ©s par environnement.",app_description:"Un outil web complet pour crÃ©er, Ã©diter et gÃ©rer les configurations de raccourcis de Star Trek Online avec Ã©dition visuelle et fonctionnalitÃ©s avancÃ©es.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"SÃ©lectionnez une construction Espace/Sol ou des Alias pour prÃ©visualiser l'exportation.",alias_mode:"Mode alias",create:"CrÃ©er",filter_aliases:"Filtrer les alias",select_an_alias_to_edit:"SÃ©lectionnez un alias Ã  modifier",select_an_alias_to_see_the_generated_command:"SÃ©lectionnez un alias pour voir la commande gÃ©nÃ©rÃ©e",no_alias_selected:"Aucun alias sÃ©lectionnÃ©",select_alias_from_left_panel:"SÃ©lectionnez un alias dans le panneau de gauche pour afficher et modifier sa chaÃ®ne de commandes.",select_key_from_left_panel:"SÃ©lectionnez une touche dans le panneau de gauche pour afficher et modifier sa chaÃ®ne de commandes.",failed_to_load_application:"Impossible de charger l'application",profile_created:'Profil "{{name}}" crÃ©Ã©',failed_to_create_profile:"Impossible de crÃ©er le profil",failed_to_clone_profile:"Impossible de cloner le profil",cannot_delete_the_last_profile:"Impossible de supprimer le dernier profil",profile_deleted:'Profil "{{profileName}}" supprimÃ©',failed_to_delete_profile:"Impossible de supprimer le profil",invalid_key_name:"Nom de touche invalide",key_added:'Touche "{{keyName}}" ajoutÃ©e',key_already_exists:'La touche "{{keyName}}" existe dÃ©jÃ ',key_deleted:'Touche "{{keyName}}" supprimÃ©e',key_duplicated:'Touche "{{from}}" dupliquÃ©e en "{{to}}"',failed_to_delete_key:"Ã‰chec de la suppression de la touche",key_not_found:'Touche "{{keyName}}" introuvable',failed_to_duplicate_key:"Ã‰chec de la duplication de la touche",alias_duplicated:'Alias "{{from}}" dupliquÃ© en "{{to}}"',failed_to_add_alias:"Ã‰chec de la crÃ©ation de l'alias",failed_to_delete_alias:"Ã‰chec de la suppression de l'alias",failed_to_duplicate_alias:"Ã‰chec de la duplication de l'alias",alias_already_exists:'L\'alias "{{name}}" existe dÃ©jÃ ',invalid_alias_name:"Nom d'alias invalide",invalid_project_file:"Fichier de projet invalide",no_commands_to_duplicate:"Aucune commande Ã  dupliquer",command_chain_is_valid:"ChaÃ®ne de commandes valide",no_profile_selected:"Aucun profil sÃ©lectionnÃ©",language_updated:"Langue mise Ã  jour",nothing_to_copy:"Rien Ã  copier",content_copied_to_clipboard:"Contenu copiÃ© dans le presse-papiers",failed_to_generate_export:"Impossible de gÃ©nÃ©rer l'export",no_profile_selected_to_clone:"Aucun profil sÃ©lectionnÃ© pour cloner",no_profile_selected_to_rename:"Aucun profil sÃ©lectionnÃ© pour renommer",profile_name_is_required:"Le nom du profil est requis",failed_to_save_profile:"Impossible de sauvegarder le profil : {{error}}",no_profile_selected_to_delete:"Aucun profil sÃ©lectionnÃ© pour supprimer",no_keybinds_to_export:"Aucun raccourci Ã  exporter",no_aliases_to_export:"Aucun alias Ã  exporter",application_reset_successfully:"Application rÃ©initialisÃ©e avec succÃ¨s",confirm_clear:"Confirmer l'effacement",confirm_clear_commands:'ÃŠtes-vous sÃ»r de vouloir effacer toutes les commandes pour "{{keyName}}" ?',confirm_delete_alias:'ÃŠtes-vous sÃ»r de vouloir supprimer l\'alias "{{aliasName}}" ?',confirm_delete_key:'ÃŠtes-vous sÃ»r de vouloir supprimer la touche "{{keyName}}" et toutes ses commandes ?',confirm_delete_profile:'ÃŠtes-vous sÃ»r de vouloir supprimer le profil "{{profileName}}" ?\n\nCette action ne peut pas Ãªtre annulÃ©e.',failed_to_copy_to_clipboard:"Ã‰chec de la copie dans le presse-papiers",no_effects_selected:"Aucun effet sÃ©lectionnÃ©. Veuillez sÃ©lectionner au moins un effet pour gÃ©nÃ©rer des alias.",profile_created_from:'Profil "{{newName}}" crÃ©Ã© Ã  partir de "{{sourceProfile}}"',profile_renamed:'Profil renommÃ© de "{{oldName}}" Ã  "{{name}}"',sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager chargÃ© avec succÃ¨s",switched_to_profile:"PassÃ© au profil : {{name}} ({{environment}})",yes:"Oui",no:"Non",ok:"OK",no_commands:"Aucune commande",profile_not_found:"Profil introuvable",click_add_command_to_start_building_your_command_chain:"SÃ©lectionnez des Ã©lÃ©ments dans la BibliothÃ¨que de commandes pour commencer Ã  construire votre chaÃ®ne de commandes de touches pour",click_add_command_to_start_building_your_alias_chain:"SÃ©lectionnez des Ã©lÃ©ments dans la BibliothÃ¨que de commandes pour commencer Ã  construire votre chaÃ®ne de commandes d'alias pour",create_alias:"CrÃ©er un Alias",key:"touche",no_profile:"Aucun profil",stotrayexecbytray_description:"STOTrayExecByTray (affiche la liaison de touche dans l'UI)",trayexecbytray_description:"TrayExecByTray (aucune indication d'UI)",parameter_configuration:"Configuration des paramÃ¨tres",vfx_aliases:"Alias VFX",bindset_enable:"Activer",vfx_alias_space:"Alias VFX: Espace",vfx_alias_ground:"Alias VFX: Sol",vfx_alias_combined:"Alias VFX: Espace/Sol combinÃ©",vfx_suppression_loaded:"Suppression VFX ChargÃ©e",vfx_suppression_for_environment:"Suppression VFX pour l'environnement {{environment}}",vfx_suppression_for_all_environments:"Suppression VFX pour tous les environnements",delete_selected_key:"Supprimer la touche sÃ©lectionnÃ©e",duplicate_selected_key:"Dupliquer la touche sÃ©lectionnÃ©e",show_all_keys:"Afficher toutes les touches",duplicate:"Dupliquer",reserved_command_name:"Le nom entre en conflit avec une commande STO",backup_created_successfully:"Sauvegarde de l'application crÃ©Ã©e avec succÃ¨s",failed_to_create_backup:"Ã‰chec de la crÃ©ation de la sauvegarde : {{error}}",backup_restored_successfully:"Ã‰tat de l'application restaurÃ© avec succÃ¨s",import_from_key_or_alias:"Importer depuis Touche ou Alias",select_source_to_import_from:"SÃ©lectionner la source Ã  importer :",clear_destination_chain_prior_to_import:"Effacer la chaÃ®ne de destination avant l'import",no_sources_available:"Aucune source disponible",error_loading_sources:"Erreur lors du chargement des sources",please_select_a_source:"Veuillez sÃ©lectionner une source",source_has_no_commands:"La source n'a aucune commande Ã  importer",commands_imported_successfully:"{{count}} commandes importÃ©es depuis {{source}}",cross_environment_import_warning:"Attention : {{dropped}} commandes spÃ©cifiques Ã  {{sourceEnv}} ont Ã©tÃ© supprimÃ©es lors de l'importation vers {{targetEnv}}",no_compatible_commands_to_import:"Aucune commande compatible Ã  importer aprÃ¨s filtrage",failed_to_load_profile_data:"Ã‰chec du chargement des donnÃ©es de profil",already_on_profile:"DÃ©jÃ  sur ce profil",source_profile_not_found:"Profil source non trouvÃ©",profile_name_required:"Nom de profil requis",switch_to_key_type_view:"Basculer vers la vue par type de touche",switch_to_grid_view:"Basculer vers la vue grille",switch_to_command_categories:"Basculer vers les catÃ©gories de commandes",no_profiles_available:"Aucun profil disponible",verb:{say:"Dire (Local)",team:"Ã‰quipe",zone:"Zone",tell:"Chuchoter"},duplicate_alias:"Dupliquer l'Alias",enter_new_alias_name:"Entrer un nouveau nom d'alias",alias_name_in_use:"Le nom d'alias existe dÃ©jÃ ",failed_to_rename_profile:"Ã‰chec du renommage du profil : {{error}}",ground_build:"Construction Sol",import_failed_invalid_json:"Importation Ã©chouÃ©e : Format JSON invalide",import_failed_unsupported_format:"Importation Ã©chouÃ©e : Format de fichier non pris en charge",no_content_available:"Aucun contenu disponible",no_valid_profile:"Aucun profil valide disponible",profile_already_exists:"Le profil existe dÃ©jÃ ",profile_id_required:"ID de profil requis",space_build:"Construction Espace",syncing:"Synchronisation en cours...",command_parameters:{active:{label:"Actif",help:"0: DÃ©sactivÃ©, 1: ActivÃ©"},tray:{label:"Plateau",help:"NumÃ©ro de plateau (0-9)"},slot:{label:"Emplacement",help:"NumÃ©ro d'emplacement (0-9)"},start_tray:{label:"Plateau de DÃ©but",help:"NumÃ©ro de plateau de dÃ©but"},end_tray:{label:"Plateau de Fin",help:"NumÃ©ro de plateau de fin"},start_slot:{label:"Emplacement de DÃ©but",help:"NumÃ©ro d'emplacement de dÃ©but"},end_slot:{label:"Emplacement de Fin",help:"NumÃ©ro d'emplacement de fin"},backup_tray:{label:"Plateau de Sauvegarde",help:"NumÃ©ro de plateau de sauvegarde"},backup_slot:{label:"Emplacement de Sauvegarde",help:"NumÃ©ro d'emplacement de sauvegarde"},backup_start_tray:{label:"Plateau de DÃ©but de Sauvegarde",help:"NumÃ©ro de plateau de dÃ©but de sauvegarde"},backup_end_tray:{label:"Plateau de Fin de Sauvegarde",help:"NumÃ©ro de plateau de fin de sauvegarde"},backup_start_slot:{label:"Emplacement de DÃ©but de Sauvegarde",help:"NumÃ©ro d'emplacement de dÃ©but de sauvegarde"},backup_end_slot:{label:"Emplacement de Fin de Sauvegarde",help:"NumÃ©ro d'emplacement de fin de sauvegarde"},command_type:{label:"Type de Commande",help:"Type d'exÃ©cution de commande (STOTrayExecByTray affiche l'UI, TrayExecByTray non)"},entityName:{label:"Nom d'EntitÃ©",help:"Nom de l'entitÃ© Ã  cibler"},message:{label:"Message",help:"Texte du message Ã  envoyer"},distance:{label:"Distance",help:"Valeur de distance de camÃ©ra"},amount:{label:"QuantitÃ©",help:"QuantitÃ© d'ajustement des gaz"},position:{label:"Position",help:"Position des gaz (0-100)"},filename:{label:"Nom de Fichier",help:"Nom de fichier (sans extension)"},state:{label:"Ã‰tat",help:"1 pour activer, 0 pour dÃ©sactiver"},verb:{label:"Canal",help:"Canal de communication (dire, Ã©quipe, zone)"},alias_name:{label:"Nom d'Alias",help:"Nom de l'alias Ã  exÃ©cuter"},rawCommand:{label:"Commande",help:"Texte de commande STO brut"},seconds:{label:"Secondes",help:"DÃ©lai en secondes"},alpha:{label:"Alpha",help:"Valeur de transparence (0-255)"},modifier1:{label:"Modificateur 1",help:"PremiÃ¨re combinaison de touches modificatrices"},modifier2:{label:"Modificateur 2",help:"Seconde combinaison de touches modificatrices"},name:{label:"Nom",help:"Nom de la cible ou de l'objet"}},add_new_alias:"Ajouter un Nouvel Alias",delete_selected_alias:"Supprimer l'Alias SÃ©lectionnÃ©",duplicate_selected_alias:"Dupliquer l'Alias SÃ©lectionnÃ©",search_aliases:"Rechercher des alias...",clear_filter:"Effacer le filtre",warning:"Avertissement",error:"Erreur",validation_details:"DÃ©tails de la validation",command_chain_near_limit:"La chaÃ®ne de commandes devient longue ({{length}} caractÃ¨res). DÃ©passer 999 peut Ã©chouer.",command_chain_too_long:"La chaÃ®ne de commandes est trop longue ({{length}} caractÃ¨res) et peut Ã©chouer dans le jeu.",sto_tray_exec_optimization_suggestion:"La chaÃ®ne de commandes fait {{currentLength}} caractÃ¨res. Remplacer {{count}} occurrence(s) de STOTrayExecByTray par TrayExecByTray permettrait d'Ã©conomiser {{potentialSavings}} caractÃ¨res (nouvelle longueur : {{newLength}}).",stabilized_non_tray_warning:"L'exÃ©cution stabilisÃ©e ne doit Ãªtre utilisÃ©e qu'avec des capacitÃ©s d'exÃ©cution de barre.",too_many_commands_on_key:"Associer {{count}} commandes Ã  une seule touche peut Ã©chouer en jeu (maximum recommandÃ© 20).",alias_mixed_environment_warning:"L'alias contient des commandes exclusives espace et sol ; ceci n'est pas recommandÃ©.",spam_bar_warning:"Non recommandÃ© sur les barres de spam car cela perturbe les cycles de tir",press_any_key_combination:"Appuyez sur n'importe quelle combinaison de touches...",capture_instructions:"Utilisez votre clavier ou votre souris, ou passez en mode manuel pour cliquer sur les touches ci-dessous",switch_to_manual:"Basculer en manuel",start_capture:"DÃ©marrer la capture",selected_key:"Touche sÃ©lectionnÃ©e",confirm_selection:"Confirmer la sÃ©lection",key_selection_failed:"Ã‰chec de la sÃ©lection de la touche",error_generating_command:"Erreur lors de la gÃ©nÃ©ration de la commande",please_enter_a_raw_command:"Veuillez saisir une commande",unsafe_keybind:"Combinaison de touches dangereuse : {{key}} n'est pas autorisÃ©e",generated_alias:"Alias gÃ©nÃ©rÃ© :",bind_to_alias_mode:"CrÃ©er des chaÃ®nes de commandes comme alias",bind_to_alias_mode_description:"Lorsqu'elle est activÃ©e, les chaÃ®nes de commandes sont gÃ©nÃ©rÃ©es sous forme d'alias nommÃ©s selon l'environnement et la touche (par ex. \"space_q\"), et les touches sont liÃ©es pour appeler ces alias.",bindsets_enabled:"Activer les ensembles de liens",bindsets_enabled_description:"Permet la crÃ©ation et le chargement d'ensembles de liens (nÃ©cessite 'CrÃ©er des chaÃ®nes de keybinds en tant qu'alias').",bindsets:"Ensembles de liens",bindset_manager:"Gestionnaire d'ensembles de liens",create_bindset:"CrÃ©er un ensemble de liens",enter_bindset_name:"Entrez le nom de l'ensemble de liens :",bindset_name:"Nom de l'ensemble de liens",bindset_name_in_use:"Le nom de l'ensemble de liens est dÃ©jÃ  utilisÃ©",bindset_not_empty:"L'ensemble de liens contient des keybinds et ne peut pas Ãªtre supprimÃ©",invalid_name:"Nom invalide",add_key_to_bindset:"Ajouter la touche Ã  l'ensemble de liens",add_key_to_bindset_confirm:'Ajouter la touche "{{key}}" Ã  l\'ensemble de liens "{{bindset}}" ?',manage_bindsets:"GÃ©rer les Ensembles de Liens",primary_bindset:"Ensemble de Liens Principal",remove_key_from_bindset:"Retirer la touche de l'ensemble de liens",remove_key_from_bindset_confirm:'Retirer la touche "{{key}}" de l\'ensemble de liens "{{bindset}}" ?',select_bindset:"SÃ©lectionner un Ensemble de Liens",confirm_delete:"ÃŠtes-vous sÃ»r de vouloir supprimer ?",enter_new_name:"Entrer le nouveau nom :",translate_generated_messages:"Traduire les messages gÃ©nÃ©rÃ©s",translate_generated_messages_description:"Lorsqu'elle est activÃ©e, les messages gÃ©nÃ©rÃ©s automatiquement (comme les notifications de suppression VFX) seront traduits dans la langue sÃ©lectionnÃ©e. Lorsqu'elle est dÃ©sactivÃ©e, ils restent en anglais.",distinguish_left_right_modifiers:"Distinguer les modificateurs gauche/droite",confirm_reset_application:"ÃŠtes-vous sÃ»r de vouloir rÃ©initialiser l'application ?\n\nCela supprimera tous les profils, raccourcis et paramÃ¨tres. Cette action ne peut pas Ãªtre annulÃ©e.",environment:"Environnement",export_alias_definitions_note:"(Les dÃ©finitions d'alias sont dans le fichier d'alias)",export_generated_aliases_count:"du mode alias vers touches ({{count}} alias gÃ©nÃ©rÃ©s)",export_generated_aliases_note:"Lignes de raccourcis qui appellent des alias gÃ©nÃ©rÃ©s",export_user_and_generated_aliases:"Ce fichier contient Ã  la fois des alias crÃ©Ã©s par l'utilisateur et des alias gÃ©nÃ©rÃ©s",please_select_an_alias_first:"Veuillez d'abord sÃ©lectionner un alias",confirm_reset_app:"Confirmer la RÃ©initialisation de l'Application",configure_colon:"Configurer :",edit_colon:"Ã‰diter :",default_profile_exists_message:'Un profil nommÃ© "Default" existe dÃ©jÃ . Le chargement des donnÃ©es par dÃ©faut l\'Ã©craserait. Voulez-vous continuer ?',default_profile_exists_title:"Profil par DÃ©faut Existe",ground_alias:"Alias Sol",space_alias:"Alias Espace",backup_restore_failed:"Ã‰chec de la restauration de la sauvegarde : {{error}}",confirm_add:"Confirmer l'ajout",confirm_delete_bindset:'Supprimer l\'ensemble de liens "{{name}}" ?',confirm_remove:"Confirmer la suppression",error_add_failed:"Ã‰chec de l'ajout de la touche Ã  l'ensemble de liens",error_remove_failed:"Ã‰chec de la suppression de la touche de l'ensemble de liens",name_exists:"Le nom existe dÃ©jÃ ",name_required:"Nom requis",name_unchanged:"Le nom n'a pas changÃ©",not_found:"Non trouvÃ©",rename_bindset:"Renommer l'ensemble de liens",source_profile_and_new_name_required:"Le profil source et le nouveau nom sont requis",unknown_command:"Commande inconnue"},ae={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Guardar",explorer:"Explorador",import_keybinds:"Importar atajos de teclado",import_environment:"Importar atajos de teclado",import_environment_question:"Elige un entorno para importar este archivo de atajos de teclado",aliases:"Alias",import_aliases:"Importar alias",import:"Importar",backup:"Respaldo",backup_menu:"Respaldo",backup_application_state:"Respaldar estado de la aplicaciÃ³n",restore_application_state:"Restaurar estado de la aplicaciÃ³n",preferences:"Preferencias",language:"Idioma",sync_folder_label:"Carpeta de sincronizaciÃ³n:",no_folder_selected:"Ninguna carpeta seleccionada",download:"Descargar",vfx:"VFX",dark_mode:"Modo oscuro",light_mode:"Modo claro",load_default_data:"Cargar datos predeterminados",reset_application:"Restablecer aplicaciÃ³n",set_sync_folder:"Establecer carpeta de sincronizaciÃ³n",sync_now:"Sincronizar ahora",about:"Acerca de",rename:"Renombrar",delete:"Eliminar",space:"Espacio",ground:"Suelo",modified:"Modificado",valid:"VÃ¡lido",keys:"teclas",keys_firstupper:"Teclas",copy:"Copiar",select_a_key_to_edit:"Selecciona una tecla para editar",commands:"comandos",command_singular:"comando",no_key_selected:"Ninguna tecla seleccionada",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"Selecciona una tecla del panel izquierdo para ver y editar su cadena de comandos.",generated_command:"Comando generado:",generated_alias:"Alias generado:",select_a_key_to_see_the_generated_command:"Selecciona una tecla para ver el comando generado",add_command:"Agregar comando",command_library:"Biblioteca de comandos",add_new_key:"Agregar nueva tecla",ctrl:"Ctrl",alt:"Alt",shift:"MayÃºs",cancel:"Cancelar",custom:"Personalizado",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"alias",profile:"Perfil",profile_name:"Nombre del perfil:",description_optional:"DescripciÃ³n (opcional):",alias_name:"Nombre del alias:",select_key_dialog_title:"Seleccionar Tecla",vfx_manager:"Gestor VFX",space_effects:"Efectos de espacio",select_all:"Seleccionar Todo",clear_all:"Limpiar Todo",selected:"seleccionado",ground_effects:"Efectos de suelo",generated_aliases:"Alias generados:",no_space_effects_selected:"No hay efectos espaciales seleccionados",no_ground_effects_selected:"No hay efectos terrestres seleccionados",show_player_say:"Mostrar Decir del Jugador",generate_aliases:"Generar Alias",about_sto_tools_keybind_manager:"Acerca de STO Tools Keybind Manager",features:"CaracterÃ­sticas:",visual_keybind_editor:"Editor visual de atajos de teclado",sto_command_library_with_search_and_categorization:"Biblioteca de comandos STO con bÃºsqueda y categorizaciÃ³n",multiple_profile_management_create_clone_rename_delete:"GestiÃ³n de mÃºltiples perfiles (crear, clonar, renombrar, eliminar)",custom_alias_system_for_complex_command_sequences:"Sistema de alias personalizado para secuencias de comandos complejas",vertigo_inspired_vfx_manager_for_visual_effects_control:"Gestor VFX inspirado en VERTIGO para control de efectos visuales",import_export_keybind_and_alias_files_and_project_backups:"Importar/exportar archivos de atajos y alias, y respaldos de proyecto",real_time_validation_and_command_preview:"ValidaciÃ³n en tiempo real y vista previa de comandos",quick_start:"Inicio rÃ¡pido:",create_a_new_profile_or_use_the_default_profile:"Crea un nuevo perfil o usa el perfil predeterminado",select_keys_from_the_grid_and_add_commands_from_the_library:"Selecciona teclas de la cuadrÃ­cula y agrega comandos desde la biblioteca",use_the_command_chain_editor_to_build_complex_sequences:"Usa el editor de cadenas de comandos para construir secuencias complejas",export_your_keybinds_as_txt_files_for_use_in_sto:"Exporta tus atajos como archivos .txt para usar en STO",resources:"Recursos:",copyright:"Â© 2025 STO Tools. Todos los derechos reservados.",got_it:"Â¡Entendido!",file_explorer:"Explorador de archivos",select_an_item_on_the_left_to_preview_export:"Selecciona un elemento a la izquierda para previsualizar exportaciÃ³n",close:"Cerrar",filter_keys:"Filtrar teclas...",search_commands:"Buscar comandos...",enter_profile_name:"Ingresa nombre del perfil",describe_this_keybind_profile:"Describe este perfil de atajos de teclado",search_keys:"Buscar teclas...",settings:"ConfiguraciÃ³n",select_profile:"Seleccionar perfil",new_profile:"Nuevo perfil",clone_profile:"Clonar perfil",rename_profile:"Renombrar perfil",delete_profile:"Eliminar perfil",space_mode:"Modo espacio",ground_mode:"Modo suelo",unsaved_changes:"Cambios no guardados",validation_status:"Estado de validaciÃ³n",bound_keys:"Teclas vinculadas",toggle_between_grid_and_categorized_view:"Alternar entre vista de cuadrÃ­cula y categorizada",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Asegura orden de ejecuciÃ³n consistente reflejando comandos (Fase 1: izquierda a derecha, Fase 2: derecha a izquierda)",validate_command_chain:"Validar cadena de comandos",command_chain:"Cadena de comandos",alias_chain:"Cadena de alias",chain_for_key:"{{chainType}} para {{key}}",clear_all_commands:"Limpiar todos los comandos",copy_to_clipboard:"Copiar al portapapeles",generated:"Generado:",created_by:"Creado por:",statistics:"EstadÃ­sticas",total_commands:"Total de comandos:",command_aliases:"Alias de comandos",vfx_aliases:"Alias VFX",bindset_enable:"Habilitar",vfx_alias_space:"Alias VFX: Espacio",vfx_alias_ground:"Alias VFX: Tierra",vfx_alias_combined:"Alias VFX: Espacio/Tierra combinado",vfx_suppression_loaded:"SupresiÃ³n VFX Cargada",vfx_suppression_for_environment:"SupresiÃ³n VFX para entorno {{environment}}",vfx_suppression_for_all_environments:"SupresiÃ³n VFX para todos los entornos",key_type:{function_keys:"Teclas de funciÃ³n",letters_numbers:"Letras y nÃºmeros",numberpad:"Teclado numÃ©rico",modifier_keys:"Teclas modificadoras",navigation:"NavegaciÃ³n",system_keys:"Teclas del sistema",mouse_wheel:"RatÃ³n y rueda",symbols_punctuation:"SÃ­mbolos y puntuaciÃ³n",other_keys:"Otras teclas"},command_categories:{targeting:"Apuntado",combat:"Combate",cosmetic:"CosmÃ©tico",bridge_officer:"Oficial de Puente",tray:"EjecuciÃ³n de Bandeja",power:"GestiÃ³n de Escudos",movement:"Movimiento",camera:"CÃ¡mara",communication:"ComunicaciÃ³n",system:"Sistema",custom:"Personalizado"},command_definitions:{add_custom_command:{name:"Agregar Comando Personalizado",description:"Agregar cualquier comando STO como texto sin formato"},target:{name:"Apuntar por nombre",description:"Apuntar entidad por nombre (requiere comillas)"},target_enemy_near:{name:"Apuntar enemigo mÃ¡s cercano",description:"Apuntar al enemigo mÃ¡s cercano visible"},target_friend_near:{name:"Apuntar aliado mÃ¡s cercano",description:"Apuntar a la entidad aliada mÃ¡s cercana"},target_self:{name:"Apuntarse a sÃ­ mismo",description:"Apuntar a tu propia nave/personaje"},target_clear:{name:"Limpiar objetivo",description:"Eliminar el bloqueo de objetivo actual"},target_teammate_1:{name:"Apuntar compaÃ±ero 1",description:"Apuntar al primer miembro del equipo"},target_teammate_2:{name:"Apuntar compaÃ±ero 2",description:"Apuntar al segundo miembro del equipo"},target_teammate_3:{name:"Apuntar compaÃ±ero 3",description:"Apuntar al tercer miembro del equipo"},target_teammate_4:{name:"Apuntar compaÃ±ero 4",description:"Apuntar al cuarto miembro del equipo"},fire_all:{name:"Disparar todas las armas",description:"Disparar todas las armas"},fire_phasers:{name:"Disparar armas de energÃ­a",description:"Disparar todas las armas de energÃ­a"},fire_torps:{name:"Disparar torpedos",description:"Disparar todos los torpedos"},fire_mines:{name:"Disparar minas",description:"Disparar todas las minas"},fire_phasers_torps:{name:"Disparar phasers y torpedos",description:"Disparar phasers y torpedos"},fire_projectiles:{name:"Disparar Proyectiles",description:"Disparar torpedos y minas"},setactivecostume:{name:"Establecer Disfraz Activo",description:"Establece el disfraz activo actual. Requiere dos modificadores."},custom_tray:{name:"EjecuciÃ³n de bandeja",description:"Ejecutar ranura especÃ­fica de bandeja"},tray_with_backup:{name:"EjecuciÃ³n de bandeja con respaldo",description:"Ejecutar ranura especÃ­fica de bandeja con habilidad de respaldo"},tray_range:{name:"EjecuciÃ³n de rango de bandeja",description:"Ejecutar un rango de ranuras de bandeja"},tray_range_with_backup:{name:"Rango de bandeja con respaldo",description:"Ejecutar un rango de ranuras de bandeja con habilidades de respaldo"},whole_tray:{name:"EjecuciÃ³n de bandeja completa",description:"Ejecutar todas las ranuras de una bandeja"},whole_tray_with_backup:{name:"Bandeja completa con respaldo",description:"Ejecutar todas las ranuras de una bandeja con bandeja de respaldo"},distribute_shields:{name:"Distribuir escudos",description:"Distribuye uniformemente los escudos como si hicieras clic en el medio del Ã­cono de nave y escudos"},reroute_shields_rear:{name:"Redirigir escudos traseros",description:"Redirigir energÃ­a de escudos hacia atrÃ¡s"},reroute_shields_left:{name:"Redirigir escudos izquierdos",description:"Redirigir energÃ­a de escudos hacia la izquierda"},reroute_shields_right:{name:"Redirigir escudos derechos",description:"Redirigir energÃ­a de escudos hacia la derecha"},reroute_shields_forward:{name:"Redirigir escudos delanteros",description:"Redirigir energÃ­a de escudos hacia adelante"},full_impulse:{name:"Impulso completo",description:"Activar motor de impulso completo"},reverse:{name:"Reversa",description:"Motores en reversa"},throttle_adjust:{name:"Ajustar acelerador",description:"Aumentar o disminuir el acelerador por cantidad"},throttle_set:{name:"Establecer acelerador",description:"Establecer el acelerador a una posiciÃ³n especÃ­fica (negativo = reversa, 0 = parar)"},throttle_toggle:{name:"Alternar acelerador",description:"Alternar entre acelerador completo y parada completa"},turn_left:{name:"Girar izquierda",description:"Girar nave a la izquierda (continuo mientras se mantiene)"},turn_right:{name:"Girar derecha",description:"Girar nave a la derecha (continuo mientras se mantiene)"},pitch_up:{name:"Cabecear arriba",description:"Cabecear nariz de nave hacia arriba (cambio de altitud espacial)"},pitch_down:{name:"Cabecear abajo",description:"Cabecear nariz de nave hacia abajo (cambio de altitud espacial)"},strafe_left:{name:"Desplazamiento lateral izquierdo",description:"Desplazar nave lateralmente a la izquierda"},strafe_right:{name:"Desplazamiento lateral derecho",description:"Desplazar nave lateralmente a la derecha"},forward:{name:"Adelante",description:"Moverse adelante"},backward:{name:"AtrÃ¡s",description:"Moverse atrÃ¡s"},auto_forward:{name:"Avance automÃ¡tico",description:"El personaje se mueve adelante hasta que se den nuevos comandos de movimiento"},follow:{name:"Seguir objetivo",description:"Seguir a la entidad objetivo"},follow_cancel:{name:"Cancelar seguimiento",description:"Dejar de seguir y olvidar el objetivo"},zoom_in:{name:"Acercar zoom",description:"Acercar la cÃ¡mara"},zoom_out:{name:"Alejar zoom",description:"Alejar la cÃ¡mara"},zoom_in_small:{name:"Acercar zoom ligeramente",description:"Acercar la cÃ¡mara ligeramente"},zoom_out_small:{name:"Alejar zoom ligeramente",description:"Alejar la cÃ¡mara ligeramente"},cam_distance:{name:"Establecer distancia de cÃ¡mara",description:"Establecer la distancia de la cÃ¡mara del jugador"},cam_reset:{name:"Reiniciar cÃ¡mara",description:"Reiniciar la posiciÃ³n de la cÃ¡mara por defecto"},cam_target_lock:{name:"Bloquear cÃ¡mara al objetivo",description:"Bloquear o desbloquear la cÃ¡mara al objetivo"},cam_cycle_distance:{name:"Alternar distancia de cÃ¡mara",description:"Alternar la distancia de la cÃ¡mara entre varios valores preestablecidos"},cam_mouse_look:{name:"Vista de ratÃ³n",description:"Activar control de cÃ¡mara con vista de ratÃ³n"},cam_turn_to_face:{name:"Girar hacia la cÃ¡mara",description:"Girar nave para mirar hacia la direcciÃ³n de la cÃ¡mara"},look_up:{name:"Mirar arriba",description:"Cambiar punto de vista para mirar directamente arriba"},look_down:{name:"Mirar abajo",description:"Cambiar punto de vista para mirar directamente abajo"},team_message:{name:"Mensaje de equipo",description:"Enviar mensaje al equipo"},local_message:{name:"Mensaje local",description:"Enviar mensaje al Ã¡rea local"},zone_message:{name:"Mensaje de zona",description:"Enviar mensaje a la zona"},toggle_hud:{name:"Alternar HUD",description:"Alternar visibilidad del HUD"},screenshot:{name:"Captura de pantalla",description:"Tomar una captura de pantalla"},screenshot_jpg:{name:"Captura de pantalla JPG",description:"Guardar una captura de pantalla como JPG"},autofire_set:{name:"Establecer disparo automÃ¡tico",description:"Activar y desactivar el disparo automÃ¡tico de armas. X = 1 lo activa y X = 0 lo desactiva."},bind_save_file:{name:"Guardar atajos a archivo",description:"Guardar todos tus atajos en un archivo de texto"},bind_load_file:{name:"Cargar atajos desde archivo",description:"Cargar un archivo de atajos en el cliente"},combat_log:{name:"Alternar registro de combate",description:"Activar/desactivar grabaciÃ³n del registro de combate (1=activado, 0=desactivado)"},missions:{name:"Mostrar/Ocultar misiones",description:"Mostrar/ocultar el diario de misiones"},inventory:{name:"Mostrar/Ocultar inventario",description:"Mostrar/ocultar tu inventario"},map:{name:"Mostrar/Ocultar mapa",description:"Mostrar/ocultar la ventana del mapa"},logout:{name:"Cerrar sesiÃ³n",description:"Cerrar sesiÃ³n del personaje actual."},quit:{name:"Salir del juego",description:"Cerrar la ventana."},ui_load:{name:"Cargar configuraciÃ³n de UI",description:"Carga el archivo de guardado predeterminado de ventanas de UI, generalmente Live\\ui_settings.txt"},ui_save:{name:"Guardar configuraciÃ³n de UI",description:"Guarda el diseÃ±o de UI en el archivo de guardado predeterminado de ventanas de UI, generalmente Live\\ui_settings.txt"},ui_load_file:{name:"Cargar archivo de configuraciÃ³n de UI",description:"Carga archivo de guardado de ventanas de UI con nombre"},ui_save_file:{name:"Guardar archivo de configuraciÃ³n de UI",description:"Guarda el diseÃ±o de UI en archivo de guardado de ventanas de UI con nombre"},ui_cancel:{name:"UI Cancelar",description:'Responde "Cancelar" a un cuadro de diÃ¡logo abierto; puede no funcionar en todos los diÃ¡logos.'},ui_ok:{name:"UI OK",description:'Responde "OK" a un cuadro de diÃ¡logo abierto; puede no funcionar en todos los diÃ¡logos.'},chat_log:{name:"Alternar registro de chat",description:"Activar/desactivar registro de chat. 1=activado, 0=desactivado, sin parÃ¡metro=imprimir estado. Anteponer ++ lo convierte en alternador"},remember_ui_lists:{name:"Recordar listas de UI",description:"Si se deben recordar la colocaciÃ³n y ancho de columnas de listas de UI."},ui_remember_positions:{name:"Recordar posiciones de UI",description:"Si se deben recordar tamaÃ±os y posiciones de UI. Activado por defecto."},safe_login:{name:"Inicio de sesiÃ³n seguro",description:"Si es verdadero, entonces inicia sesiÃ³n al jugador en su mapa estÃ¡tico mÃ¡s reciente en lugar de cualquier otra cosa."},goto_character_select:{name:"Ir a selecciÃ³n de personaje",description:"Ir a la pantalla de selecciÃ³n de personaje sin cerrar sesiÃ³n."},ui_gen_layers_reset:{name:"Restablecer diseÃ±o de UI",description:"Restablece el diseÃ±o, usado cuando el servidor actualiza posiciones de ventanas movibles"},ui_resolution:{name:"Imprimir resoluciÃ³n de UI",description:"Imprime la resoluciÃ³n de pantalla de UI actual."},ui_tooltip_delay:{name:"Establecer retraso de tooltip",description:"Establece el retraso adicional, en segundos, antes de que aparezcan los tooltips"},show_game_ui:{name:"Mostrar UI del juego",description:"Mostrar la UI del juego"},show_game_ui_no_extra_keybinds:{name:"Mostrar UI del juego (sin keybinds extra)",description:"Este comando no agrega ningÃºn keybind para mostrar la UI cuando el usuario presiona escape"},change_instance:{name:"Cambiar instancia",description:"Cambiar a una instancia ya creada del mismo mapa. Solo funciona cuando no estÃ¡ en alerta roja."},aim:{name:"Apuntar/Mira",description:"Activar/desactivar mira. En modo mira el jugador hace mÃ¡s daÃ±o. Puede usarse como alternador o presionar y mantener"},holster:{name:"Enfundar arma",description:"Intentar enfundar tu arma activa"},holster_toggle:{name:"Alternar enfundar arma",description:"Intentar enfundar o desenfundar tus armas"},unholster:{name:"Desenfundar arma",description:"Intentar desenfundar tu arma activa"},toggle_shooter_mode:{name:"Alternar modo tirador",description:"Activar/desactivar modo tirador"},shooter_primary:{name:"Tirador primario",description:"AcciÃ³n primaria del modo tirador"},shooter_secondary:{name:"Tirador secundario",description:"AcciÃ³n secundaria del modo tirador"},shooter_tertiary:{name:"Tirador terciario",description:"AcciÃ³n terciaria del modo tirador"},shooter_clear_offset_tray_binds:{name:"Limpiar enlaces de bandeja de compensaciÃ³n del tirador",description:"Limpiar la ubicaciÃ³n inicial y movimiento de la caja de acciÃ³n amarilla que aparece en la bandeja en modo tirador"},shooter_clear_overlay_tray_binds:{name:"Limpiar enlaces de bandeja superpuesta del tirador",description:"Limpiar enlaces de bandeja superpuesta para modo tirador"},shooter_set_offset_tray_binds:{name:"Establecer enlaces de bandeja de compensaciÃ³n del tirador",description:"Establecer la ubicaciÃ³n inicial y movimiento de la caja de acciÃ³n amarilla que aparece en la bandeja en modo tirador"},shooter_set_overlay_tray_binds:{name:"Establecer enlaces de bandeja superpuesta del tirador",description:"Establecer enlaces de bandeja superpuesta para modo tirador"},setrallypoint:{name:"Establecer Punto de Encuentro",description:"Establece un punto de encuentro para tu objetivo actual"},setrallypointconsole:{name:"Establecer Punto de Encuentro (Consola)",description:"Establece un punto de encuentro para tu objetivo actual (variante consola)"},clearrallypoint:{name:"Borrar Punto de Encuentro",description:"Borra el punto de encuentro para tu objetivo actual"},clearallrallypoints:{name:"Borrar Todos los Puntos de Encuentro",description:"Borra todos los puntos de encuentro"},assist:{name:"Asistir",description:"Asistir '<name>': Asiste a la entidad con el nombre coincidente. Si no se da un nombre, asiste a tu objetivo actual."},net_timing_graph:{name:"GrÃ¡fico de Tiempo de Red",description:"Activar o desactivar el grÃ¡fico de tiempo de red (0=desactivar, 1=activar)"},net_timing_graph_alpha:{name:"GrÃ¡fico de Tiempo de Red Alpha",description:"Establecer nivel de transparencia para el grÃ¡fico de tiempo de red (50=mayor transparencia, 255=sin transparencia)"},net_timing_graph_paused:{name:"GrÃ¡fico de Tiempo de Red Pausado",description:"Pausar o reanudar el grÃ¡fico de tiempo de red (0=pausa desactivada, 1=pausa activada)"},netgraph:{name:"GrÃ¡fico de Red",description:"Mostrar datos de red SND y RCV como texto (1=activado, 0=desactivado)"},parameter_placeholders:{any_sto_command:"Ingresa cualquier comando STO (ej., Target_Enemy_Near)",entity_name:"Ingresa nombre de entidad",first_modifier:"Primer modificador",second_modifier:"Segundo modificador",entity_name_optional:"Nombre de entidad (opcional)"}},category_descriptions:{targeting:"SelecciÃ³n y gestiÃ³n de objetivos",combat:"Disparo de armas y acciones de combate",tray:"Ejecutar habilidades desde bandejas de acciÃ³n",power:"GestiÃ³n de energÃ­a y distribuciÃ³n de escudos",movement:"Movimiento y navegaciÃ³n de nave",camera:"Control de cÃ¡mara y gestiÃ³n de vista",communication:"Chat y comunicaciÃ³n de equipo",system:"Comandos de UI y sistema",custom:"Comandos personalizados"},no_aliases_defined:"Sin alias definidos",create_alias_to_get_started:"Crea un alias para comenzar",alias_deleted:'Alias "{{aliasName}}" eliminado',please_select_a_key_first:"Por favor selecciona una tecla primero",no_active_profile:"Sin perfil activo",alias_not_found:'Alias "{{name}}" no encontrado',alias_created:"Alias creado exitosamente",import_failed:"ImportaciÃ³n fallÃ³: {{error}}",storage_not_available:"Almacenamiento no disponible",no_aliases_found_in_file:"No se encontraron alias en el archivo",import_completed_keybinds:"ImportaciÃ³n completada: {{count}} atajos",import_completed_aliases:"ImportaciÃ³n completada: {{count}} alias",project_imported_successfully:"Proyecto importado exitosamente: {{profileCount}} perfiles",sync_folder_set:"Carpeta de sincronizaciÃ³n seleccionada",failed_to_set_sync_folder:"FallÃ³ al seleccionar carpeta de sincronizaciÃ³n: {{error}}",sync_not_supported_firefox:"La funcionalidad de carpeta de sincronizaciÃ³n requiere un navegador basado en Chromium (Chrome, Edge, etc.). Firefox no soporta la File System Access API requerida.",sync_not_supported_title:"SincronizaciÃ³n no soportada",sync_not_supported_detailed:"La funcionalidad de sincronizaciÃ³n no estÃ¡ disponible en Firefox debido a limitaciones del navegador. La File System Access API requerida para la sincronizaciÃ³n de carpetas solo es soportada en navegadores basados en Chromium. AÃºn puedes respaldar y restaurar manualmente el estado de tu aplicaciÃ³n o usar el Explorador de Archivos para copiar tus archivos de keybind y alias.",sync_not_supported_secure_context:"El servicio de sincronizaciÃ³n no estÃ¡ disponible cuando se sirve a travÃ©s de HTTP. Por favor use HTTPS o acceda a travÃ©s del protocolo file:// para habilitar la funcionalidad de sincronizaciÃ³n.",sync_not_supported_secure_context_title:"Se requiere contexto seguro",sync_not_supported_secure_context_detailed:"La funcionalidad de sincronizaciÃ³n requiere una conexiÃ³n segura (HTTPS) o acceso a archivos locales (file://) para funcionar. La File System Access API necesaria para la sincronizaciÃ³n de carpetas solo estÃ¡ disponible en contextos seguros para proteger sus datos. Por favor acceda a esta aplicaciÃ³n a travÃ©s de HTTPS o Ã¡brala como un archivo local.",sync_not_supported_browser:"Su navegador no soporta la File System Access API requerida para la funcionalidad de sincronizaciÃ³n.",sync_not_supported_browser_title:"Navegador no soportado",sync_not_supported_browser_detailed:"Su navegador no soporta la File System Access API requerida para la sincronizaciÃ³n de carpetas. Por favor intente usar un navegador basado en Chromium (Chrome, Edge, etc.) con una conexiÃ³n segura (HTTPS) o acceso a archivos locales.",no_sync_folder_selected:"Ninguna carpeta de sincronizaciÃ³n seleccionada",project_synced_successfully:"Proyecto sincronizado exitosamente",sync_folder_contains_project_title:"Datos de SincronizaciÃ³n Existentes Encontrados",sync_folder_contains_project_prompt:"Esta carpeta ya contiene un project.json de una sincronizaciÃ³n anterior. Â¿Importarlo ahora en lugar de sobrescribir?",project_imported_from_sync_folder:"Estado de la aplicaciÃ³n importado desde la carpeta de sincronizaciÃ³n",sync_overwrite_existing_title:"Â¿Sobrescribir Datos de SincronizaciÃ³n?",sync_overwrite_existing_prompt:"ImportaciÃ³n rechazada. Â¿Sobrescribir la carpeta de sincronizaciÃ³n con el estado actual de la aplicaciÃ³n?",sync_operation_cancelled:"SincronizaciÃ³n cancelada",failed_to_import_project:"FallÃ³ al importar proyecto: {{error}}",permission_denied_to_folder:"Permiso denegado para escribir en la carpeta",failed_to_sync_project:"FallÃ³ al sincronizar proyecto: {{error}}",synchronization:"SincronizaciÃ³n",advanced:"Avanzado",synchronization_settings:"ConfiguraciÃ³n de sincronizaciÃ³n",advanced_settings:"ConfiguraciÃ³n avanzada",sync_folder_description:"Elige una carpeta para sincronizar automÃ¡ticamente tus proyectos",auto_sync:"SincronizaciÃ³n automÃ¡tica",auto_sync_description:"Sincronizar automÃ¡ticamente los cambios con la carpeta seleccionada",auto_sync_interval:"Intervalo de sincronizaciÃ³n automÃ¡tica",auto_sync_interval_description:"Con quÃ© frecuencia sincronizar automÃ¡ticamente sus cambios",after_every_change:"DespuÃ©s de cada cambio",every_1_minute:"Cada minuto",every_2_minutes:"Cada 2 minutos",every_5_minutes:"Cada 5 minutos",bind_to_alias_mode:"Crear cadenas de keybind como alias",bind_to_alias_mode_description:"Cuando estÃ¡ activado, las cadenas de keybind se generan como alias nombrados por entorno y tecla (por ejemplo, 'space_q'), y las teclas se vinculan para llamar a dichos alias.",preferences_saved:"Preferencias guardadas exitosamente",vfx_manager_description:"Selecciona efectos visuales para desactivar usando alias de dynFxSetFXExlusionList. Los efectos estÃ¡n organizados por entorno.",app_description:"Una herramienta integral basada en web para crear, editar y gestionar configuraciones de atajos de Star Trek Online con ediciÃ³n visual y caracterÃ­sticas avanzadas.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"Selecciona una construcciÃ³n de Espacio/Tierra o Alias para previsualizar la exportaciÃ³n.",alias_mode:"Modo de alias",create:"Crear",filter_aliases:"Filtrar alias",select_an_alias_to_edit:"Selecciona un alias para editar",select_an_alias_to_see_the_generated_command:"Selecciona un alias para ver el comando generado",no_alias_selected:"NingÃºn alias seleccionado",select_alias_from_left_panel:"Selecciona un alias del panel izquierdo para ver y editar su cadena de comandos.",select_key_from_left_panel:"Selecciona una tecla del panel izquierdo para ver y editar su cadena de comandos.",failed_to_load_application:"No se pudo cargar la aplicaciÃ³n",profile_created:'Perfil "{{name}}" creado',failed_to_create_profile:"No se pudo crear el perfil",failed_to_clone_profile:"No se pudo clonar el perfil",cannot_delete_the_last_profile:"No se puede eliminar el Ãºltimo perfil",profile_deleted:'Perfil "{{profileName}}" eliminado',failed_to_delete_profile:"No se pudo eliminar el perfil",invalid_key_name:"Nombre de tecla invÃ¡lido",key_added:'Tecla "{{keyName}}" agregada',key_already_exists:'La tecla "{{keyName}}" ya existe',key_deleted:'Tecla "{{keyName}}" eliminada',key_duplicated:'Tecla "{{from}}" duplicada como "{{to}}"',failed_to_delete_key:"No se pudo eliminar la tecla",key_not_found:'Tecla "{{keyName}}" no encontrada',failed_to_duplicate_key:"No se pudo duplicar la tecla",alias_duplicated:'Alias "{{from}}" duplicado como "{{to}}"',failed_to_add_alias:"No se pudo crear el alias",failed_to_delete_alias:"No se pudo eliminar el alias",failed_to_duplicate_alias:"No se pudo duplicar el alias",alias_already_exists:'El alias "{{name}}" ya existe',invalid_alias_name:"Nombre de alias invÃ¡lido",invalid_project_file:"Archivo de proyecto invÃ¡lido",no_commands_to_duplicate:"No hay comandos para duplicar",command_chain_is_valid:"Cadena de comandos es vÃ¡lida",no_profile_selected:"NingÃºn perfil seleccionado",language_updated:"Idioma actualizado",nothing_to_copy:"Nada que copiar",content_copied_to_clipboard:"Contenido copiado al portapapeles",failed_to_generate_export:"No se pudo generar la exportaciÃ³n",no_profile_selected_to_clone:"NingÃºn perfil seleccionado para clonar",no_profile_selected_to_rename:"NingÃºn perfil seleccionado para renombrar",profile_name_is_required:"El nombre del perfil es requerido",failed_to_save_profile:"No se pudo guardar el perfil: {{error}}",no_profile_selected_to_delete:"NingÃºn perfil seleccionado para eliminar",no_keybinds_to_export:"No hay atajos para exportar",no_aliases_to_export:"No hay alias para exportar",application_reset_successfully:"AplicaciÃ³n restablecida exitosamente",confirm_clear:"Confirmar limpieza",confirm_clear_commands:'Â¿EstÃ¡s seguro de que quieres limpiar todos los comandos para "{{keyName}}"?',confirm_delete_alias:'Â¿EstÃ¡s seguro de que quieres eliminar el alias "{{aliasName}}"?',confirm_delete_key:'Â¿EstÃ¡s seguro de que quieres eliminar la tecla "{{keyName}}" y todos sus comandos?',confirm_delete_profile:'Â¿EstÃ¡s seguro de que quieres eliminar el perfil "{{profileName}}"?\n\nEsta acciÃ³n no se puede deshacer.',failed_to_copy_to_clipboard:"FallÃ³ al copiar al portapapeles",no_effects_selected:"No hay efectos seleccionados. Por favor selecciona al menos un efecto para generar alias.",profile_created_from:'Perfil "{{newName}}" creado desde "{{sourceProfile}}"',profile_renamed:'Perfil renombrado de "{{oldName}}" a "{{name}}"',sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager cargado exitosamente",switched_to_profile:"Cambiado al perfil: {{name}} ({{environment}})",yes:"SÃ­",no:"No",ok:"OK",no_commands:"No hay comandos",profile_not_found:"Perfil no encontrado",click_add_command_to_start_building_your_command_chain:"Seleccione elementos en la Biblioteca de Comandos para comenzar a construir su cadena de comandos de teclas para",click_add_command_to_start_building_your_alias_chain:"Seleccione elementos en la Biblioteca de Comandos para comenzar a construir su cadena de comandos de alias para",create_alias:"Crear Alias",key:"tecla",no_profile:"Sin perfil",stotrayexecbytray_description:"STOTrayExecByTray (muestra el enlace de tecla en la UI)",trayexecbytray_description:"TrayExecByTray (sin indicaciÃ³n de UI)",parameter_configuration:"ConfiguraciÃ³n de parÃ¡metros",delete_selected_key:"Eliminar tecla seleccionada",duplicate_selected_key:"Duplicar tecla seleccionada",show_all_keys:"Mostrar todas las teclas",duplicate:"Duplicar",reserved_command_name:"El nombre entra en conflicto con un comando STO",backup_created_successfully:"Copia de seguridad de la aplicaciÃ³n creada exitosamente",failed_to_create_backup:"FallÃ³ al crear copia de seguridad: {{error}}",backup_restored_successfully:"Estado de la aplicaciÃ³n restaurado exitosamente",import_from_key_or_alias:"Importar desde Tecla o Alias",select_source_to_import_from:"Seleccionar fuente para importar:",clear_destination_chain_prior_to_import:"Limpiar cadena de destino antes de importar",no_sources_available:"No hay fuentes disponibles",error_loading_sources:"Error cargando fuentes",please_select_a_source:"Por favor selecciona una fuente",source_has_no_commands:"La fuente no tiene comandos para importar",commands_imported_successfully:"{{count}} comandos importados desde {{source}}",cross_environment_import_warning:"Advertencia: {{dropped}} comandos especÃ­ficos de {{sourceEnv}} fueron descartados al importar a {{targetEnv}}",no_compatible_commands_to_import:"No hay comandos compatibles para importar despuÃ©s del filtrado",failed_to_load_profile_data:"Error al cargar datos del perfil",already_on_profile:"Ya estÃ¡ en este perfil",source_profile_not_found:"Perfil fuente no encontrado",profile_name_required:"Se requiere nombre de perfil",switch_to_key_type_view:"Cambiar a vista de tipo de tecla",switch_to_grid_view:"Cambiar a vista de cuadrÃ­cula",switch_to_command_categories:"Cambiar a categorÃ­as de comandos",no_profiles_available:"No hay perfiles disponibles",verb:{say:"Decir (Local)",team:"Equipo",zone:"Zona",tell:"Susurrar"},duplicate_alias:"Duplicar Alias",enter_new_alias_name:"Ingresar nuevo nombre de alias",alias_name_in_use:"El nombre del alias ya existe",failed_to_rename_profile:"Error al renombrar perfil: {{error}}",ground_build:"ConstrucciÃ³n Terrestre",import_failed_invalid_json:"ImportaciÃ³n fallÃ³: Formato JSON invÃ¡lido",import_failed_unsupported_format:"ImportaciÃ³n fallÃ³: Formato de archivo no soportado",no_content_available:"No hay contenido disponible",no_valid_profile:"No hay perfil vÃ¡lido disponible",profile_already_exists:"El perfil ya existe",profile_id_required:"Se requiere ID de perfil",space_build:"ConstrucciÃ³n Espacial",syncing:"Sincronizando...",command_parameters:{active:{label:"Activo",help:"0: Desactivado, 1: Activado"},tray:{label:"Bandeja",help:"NÃºmero de bandeja (0-9)"},slot:{label:"Ranura",help:"NÃºmero de ranura (0-9)"},start_tray:{label:"Bandeja de Inicio",help:"NÃºmero de bandeja de inicio"},end_tray:{label:"Bandeja de Fin",help:"NÃºmero de bandeja de fin"},start_slot:{label:"Ranura de Inicio",help:"NÃºmero de ranura de inicio"},end_slot:{label:"Ranura de Fin",help:"NÃºmero de ranura de fin"},backup_tray:{label:"Bandeja de Respaldo",help:"NÃºmero de bandeja de respaldo"},backup_slot:{label:"Ranura de Respaldo",help:"NÃºmero de ranura de respaldo"},backup_start_tray:{label:"Bandeja de Inicio de Respaldo",help:"NÃºmero de bandeja de inicio de respaldo"},backup_end_tray:{label:"Bandeja de Fin de Respaldo",help:"NÃºmero de bandeja de fin de respaldo"},backup_start_slot:{label:"Ranura de Inicio de Respaldo",help:"NÃºmero de ranura de inicio de respaldo"},backup_end_slot:{label:"Ranura de Fin de Respaldo",help:"NÃºmero de ranura de fin de respaldo"},command_type:{label:"Tipo de Comando",help:"Tipo de ejecuciÃ³n de comando (STOTrayExecByTray muestra UI, TrayExecByTray no)"},entityName:{label:"Nombre de Entidad",help:"Nombre de la entidad a objetivo"},message:{label:"Mensaje",help:"Texto del mensaje a enviar"},distance:{label:"Distancia",help:"Valor de distancia de cÃ¡mara"},amount:{label:"Cantidad",help:"Cantidad de ajuste del acelerador"},position:{label:"PosiciÃ³n",help:"PosiciÃ³n del acelerador (0-100)"},filename:{label:"Nombre de Archivo",help:"Nombre de archivo (sin extensiÃ³n)"},state:{label:"Estado",help:"1 para activar, 0 para desactivar"},verb:{label:"Canal",help:"Canal de comunicaciÃ³n (decir, equipo, zona)"},alias_name:{label:"Nombre de Alias",help:"Nombre del alias a ejecutar"},rawCommand:{label:"Comando",help:"Texto de comando STO sin formato"},seconds:{label:"Segundos",help:"Retraso en segundos"},alpha:{label:"Alfa",help:"Valor de transparencia (0-255)"},modifier1:{label:"Modificador 1",help:"Primera combinaciÃ³n de teclas modificadoras"},modifier2:{label:"Modificador 2",help:"Segunda combinaciÃ³n de teclas modificadoras"},name:{label:"Nombre",help:"Nombre del objetivo u objeto"}},add_new_alias:"Agregar Nuevo Alias",delete_selected_alias:"Eliminar Alias Seleccionado",duplicate_selected_alias:"Duplicar Alias Seleccionado",search_aliases:"Buscar alias...",clear_filter:"Limpiar filtro",warning:"Advertencia",error:"Error",validation_details:"Detalles de validaciÃ³n",command_chain_near_limit:"La cadena de comandos es demasiado larga ({{length}} caracteres). Superar 999 puede fallar.",command_chain_too_long:"La cadena de comandos es demasiado larga ({{length}} caracteres) y puede fallar en el juego.",sto_tray_exec_optimization_suggestion:"La cadena de comandos tiene {{currentLength}} caracteres. Reemplazar {{count}} instancia(s) de STOTrayExecByTray por TrayExecByTray ahorrarÃ­a {{potentialSavings}} caracteres (nueva longitud: {{newLength}}).",stabilized_non_tray_warning:"La ejecuciÃ³n estabilizada solo debe usarse con habilidades de ejecuciÃ³n de barra.",too_many_commands_on_key:"Asignar {{count}} comandos a una tecla puede fallar en el juego (mÃ¡ximo recomendado 20).",alias_mixed_environment_warning:"El alias contiene comandos exclusivos de espacio y de tierra; esto no se recomienda.",spam_bar_warning:"No se recomienda en barras de spam ya que interfiere con los ciclos de disparo",press_any_key_combination:"Presione cualquier combinaciÃ³n de teclas...",capture_instructions:"Utiliza tu teclado o ratÃ³n, o cambia a modo manual para hacer clic en las teclas de abajo",switch_to_manual:"Cambiar a Manual",start_capture:"Iniciar captura",selected_key:"Tecla seleccionada",confirm_selection:"Confirmar selecciÃ³n",key_selection_failed:"Error al seleccionar la tecla",error_generating_command:"Error al generar el comando",please_enter_a_raw_command:"Por favor, introduzca un comando",unsafe_keybind:"CombinaciÃ³n de teclas insegura: {{key}} no estÃ¡ permitida",bindsets_enabled:"Habilitar conjuntos de enlaces",bindsets_enabled_description:"Permite la creaciÃ³n y carga de conjuntos de enlaces (requiere 'Crear cadenas de keybind como alias').",bindsets:"Conjuntos de enlaces",bindset_manager:"Administrador de conjuntos de enlaces",create_bindset:"Crear conjunto de enlaces",enter_bindset_name:"Ingrese el nombre del conjunto de enlaces:",bindset_name:"Nombre del conjunto de enlaces",bindset_name_in_use:"El nombre del conjunto de enlaces ya estÃ¡ en uso",bindset_not_empty:"El conjunto de enlaces tiene keybinds y no se puede eliminar",invalid_name:"Nombre invÃ¡lido",add_key_to_bindset:"Agregar tecla al conjunto de enlaces",add_key_to_bindset_confirm:'Â¿Agregar la tecla "{{key}}" al conjunto de enlaces "{{bindset}}"?',manage_bindsets:"Administrar Conjuntos de Enlaces",primary_bindset:"Conjunto de Enlaces Principal",remove_key_from_bindset:"Quitar tecla del conjunto de enlaces",remove_key_from_bindset_confirm:'Â¿Quitar la tecla "{{key}}" del conjunto de enlaces "{{bindset}}"?',select_bindset:"Seleccionar Conjunto de Enlaces",confirm_delete:"Â¿EstÃ¡s seguro de que quieres eliminar?",enter_new_name:"Ingresar nuevo nombre:",translate_generated_messages:"Traducir mensajes generados",translate_generated_messages_description:"Cuando estÃ¡ habilitado, los mensajes generados automÃ¡ticamente (como notificaciones de supresiÃ³n VFX) se traducirÃ¡n al idioma seleccionado. Cuando estÃ¡ deshabilitado, permanecen en inglÃ©s.",distinguish_left_right_modifiers:"Distinguir modificadores izquierdo/derecho",confirm_reset_application:"Â¿EstÃ¡s seguro de que quieres restablecer la aplicaciÃ³n?\n\nEsto eliminarÃ¡ todos los perfiles, atajos de teclado y configuraciones. Esta acciÃ³n no se puede deshacer.",environment:"Entorno",export_alias_definitions_note:"(Las definiciones de alias estÃ¡n en el archivo de alias)",export_generated_aliases_count:"del modo de alias a teclas ({{count}} alias generados)",export_generated_aliases_note:"LÃ­neas de atajos que llaman a alias generados",export_user_and_generated_aliases:"Este archivo contiene tanto alias creados por el usuario como alias generados",please_select_an_alias_first:"Por favor selecciona un alias primero",confirm_reset_app:"Confirmar Restablecimiento de AplicaciÃ³n",configure_colon:"Configurar:",edit_colon:"Editar:",default_profile_exists_message:'Ya existe un perfil llamado "Default". Cargar los datos predeterminados lo sobrescribirÃ­a. Â¿Desea continuar?',default_profile_exists_title:"Perfil Predeterminado Existe",ground_alias:"Alias de Tierra",space_alias:"Alias de Espacio",backup_restore_failed:"FallÃ³ la restauraciÃ³n de la copia de seguridad: {{error}}",confirm_add:"Confirmar Agregar",confirm_delete_bindset:'Â¿Eliminar conjunto de enlaces "{{name}}"?',confirm_remove:"Confirmar Eliminar",error_add_failed:"FallÃ³ al agregar la tecla al conjunto de enlaces",error_remove_failed:"FallÃ³ al eliminar la tecla del conjunto de enlaces",name_exists:"El nombre ya existe",name_required:"Se requiere nombre",name_unchanged:"El nombre no ha cambiado",not_found:"No encontrado",rename_bindset:"Renombrar Conjunto de Enlaces",source_profile_and_new_name_required:"Se requieren el perfil de origen y el nuevo nombre",unknown_command:"Comando desconocido"};function ne(e){return null==e?"[UNDEFINED_TOPIC]":"string"==typeof e?e:String(e)}function se(e=c,t,i,a=5e3){if(!e)throw new Error(`Request failed: eventBus is null/undefined for topic "${ne(t)}". Component may not be properly initialized.`);const n=`rpc:${t}`,s=e.listeners.get(n);if(!s||0===s.size)throw new Error(`Request failed: No handler registered for topic "${ne(t)}". Component may not be properly initialized.`);const r=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,o=`${t}::reply::${r}`;return new Promise((n,s)=>{const c=setTimeout(()=>{d(),s(new Error("Request timed out"))},a);function l(e){d(),e&&Object.prototype.hasOwnProperty.call(e,"error")?s(new Error(e.error)):n(e?e.data:void 0)}function d(){clearTimeout(c),e.off(o,l)}e.on(o,l),e.emit(`rpc:${t}`,{requestId:r,replyTopic:o,payload:i})})}function re(e=c,t,i){async function a(a){if(!a)return;const{requestId:n,replyTopic:s,payload:r}=a;if(s)try{const a=await i(r);"undefined"!=typeof window&&console.log(`[requestResponse] respond â† ${t}`,a),e.emit(s,{requestId:n,data:a})}catch(t){const i=t&&t.message?t.message:String(t);e.emit(s,{requestId:n,error:i})}}return e.on(`rpc:${t}`,a),()=>e.off(`rpc:${t}`,a)}class oe{static cleanupRegistry=new FinalizationRegistry(e=>{e&&e.component&&e.component.destroy&&(console.log(`[ComponentBase] Finalizing ${e.constructorName||"Component"}`),e.component.destroy())});constructor(e=null){this.eventBus=e,this.initialized=!1,this.destroyed=!1,this.eventListeners=new Map,this.domEventListeners=[],oe.cleanupRegistry.register(this,{component:this,constructorName:this.constructor.name})}init(){this.initialized||(this.initialized=!0,this.destroyed=!1,this.initializeCache(),this.addEventListener("component:register",this.i.bind(this)),this.o=`component:registered:reply:${this.getComponentName()}:${Date.now()}`,this.addEventListener(this.o,this.l.bind(this)),this.emit("component:register",{name:this.getComponentName(),replyTopic:this.o}),this.m(),this.uiInit&&this.uiInit(),this.onInit())}initializeCache(e={}){this.cache||(this.cache={selectedKey:null,selectedAlias:null,currentEnvironment:"space",currentProfile:null,profile:null,keys:{},aliases:{},builds:{},preferences:{},activeBindset:"Primary Bindset",bindsetNames:["Primary Bindset"],...e})}extendCache(e={}){this.cache?Object.assign(this.cache,e):this.initializeCache(e)}m(){this.initializeCache(),this.addEventListener("key-selected",e=>{this.cache.selectedKey=e.key,this.cache.selectedAlias=null}),this.addEventListener("alias-selected",e=>{this.cache.selectedAlias=e.name,this.cache.selectedKey=null}),this.addEventListener("environment:changed",e=>{const t="string"==typeof e?e:e?.environment;t&&(this.cache.currentEnvironment=t,this.cache.builds&&this.cache.builds[t]&&(this.cache.keys=this.cache.builds[t].keys||{}))}),this.addEventListener("profile:updated",({profileId:e,profile:t})=>{if(this.cache&&e===this.cache.currentProfile){if(this.cache.profile=t,!t)return this.cache.builds=null,this.cache.keys={},void(this.cache.aliases={});if(t.builds){this.cache.builds=t.builds;const e=t.builds[this.cache.currentEnvironment];this.cache.keys=e?.keys||{}}else t.keys&&(this.cache.keys=t.keys);this.cache.aliases=t.aliases||{}}}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{if(this.cache.currentProfile=e,this.cache.profile=t,this.cache.currentEnvironment=i||"space",this.h=this.cache.currentEnvironment,this.u=e,!t)return this.cache.builds=null,this.cache.keys={},void(this.cache.aliases={});if(t.builds){this.cache.builds=t.builds;const e=t.builds[this.cache.currentEnvironment];this.cache.keys=e?.keys||{}}else t.keys&&(this.cache.keys=t.keys);this.cache.aliases=t.aliases||{}}),this.addEventListener("preferences:changed",e=>{e.changes?Object.assign(this.cache.preferences,e.changes):e.key&&void 0!==e.value&&(this.cache.preferences[e.key]=e.value)}),this.addEventListener("preferences:loaded",e=>{console.log(`[${this.componentName}] preferences:loaded received:`,e),e.settings&&(Object.assign(this.cache.preferences,e.settings),console.log(`[${this.componentName}] Updated preferences cache from preferences:loaded`))}),this.addEventListener("bindset-selector:active-changed",e=>{this.cache.activeBindset=e.bindset}),this.addEventListener("bindsets:changed",e=>{e.names&&Array.isArray(e.names)&&(this.cache.bindsetNames=e.names)}),this.addEventListener("preferences:saved",e=>{console.log(`[${this.componentName}] preferences:saved received:`,e),e.settings&&(Object.assign(this.cache.preferences,e.settings),console.log(`[${this.componentName}] Updated preferences cache from preferences:saved`))})}destroy(){this.destroyed?console.warn(`${this.constructor.name} is already destroyed`):(this.destroyed=!0,this.initialized=!1,this.cleanupEventListeners(),this.onDestroy())}onInit(){}onDestroy(){}addEventListener(e,t,i=null){this.eventBus&&(this.eventBus.on(e,t,i),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push({handler:t,context:i}))}addDomEventListener(e){"function"==typeof e&&this.domEventListeners.push(e)}onDom(e,t,i,a){if(!this.eventBus)return()=>{};const n=this.eventBus.onDom(e,t,i,a);return this.addDomEventListener(n),n}onDomDebounced(e,t,i,a,n){if(!this.eventBus)return()=>{};const s=this.eventBus.onDomDebounced(e,t,i,a,n);return this.addDomEventListener(s),s}removeEventListener(e,t){if(!this.eventBus)return;this.eventBus.off(e,t);const i=this.eventListeners.get(e);if(i){const e=i.findIndex(e=>e.handler===t);-1!==e&&i.splice(e,1)}}emit(e,t=null,i={}){return"undefined"!=typeof window&&console.log(`[${this.getComponentName()}] emit â†’ ${e} (options: ${JSON.stringify(i)})`,t),this.eventBus&&"function"==typeof this.eventBus.emit?this.eventBus.emit(e,t,i):(this.eventBus,Promise.resolve())}cleanupEventListeners(){if(this.eventBus){for(const[e,t]of this.eventListeners)t.forEach(({handler:t})=>{this.eventBus.off(e,t)});this.eventListeners.clear(),this.domEventListeners.forEach(e=>{try{e()}catch(e){console.error("Error cleaning up DOM event listener:",e)}}),this.domEventListeners=[]}}isInitialized(){return this.initialized&&!this.destroyed}getComponentName(){return this.componentName||this.constructor.name}i({name:e,replyTopic:t}={}){e!==this.getComponentName()&&this.initialized&&!this.destroyed&&this.emit(t,{sender:this.getComponentName(),state:this.getCurrentState()})}p(e,t){if(t){if(this.cache||(this.cache={}),"DataCoordinator"===e){const e=t.currentProfile||t.currentProfileData&&t.currentProfileData.id,i=t.currentProfileData;if(e&&(this.cache.currentProfile=e),i?(this.cache.profile=i,this.cache.currentEnvironment=i.environment||"space"):t.currentEnvironment&&(this.cache.currentEnvironment=t.currentEnvironment),i){if(i.builds){this.cache.builds=i.builds;const e=i.builds[this.cache.currentEnvironment];this.cache.keys=e?.keys||{}}else i.keys&&(this.cache.keys=i.keys);this.cache.aliases=i.aliases||{}}console.log(`[ComponentBase] ${this.getComponentName()} cached DataCoordinator state:`,{currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment})}"SelectionService"===e&&t&&(void 0!==t.selectedKey&&(this.cache.selectedKey=t.selectedKey),void 0!==t.selectedAlias&&(this.cache.selectedAlias=t.selectedAlias),void 0!==t.currentEnvironment&&(this.cache.currentEnvironment=t.currentEnvironment),void 0!==t.editingContext&&(this.cache.editingContext=t.editingContext),void 0!==t.cachedSelections&&(this.cache.cachedSelections=t.cachedSelections),console.log(`[ComponentBase] ${this.getComponentName()} cached SelectionService state:`,{selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,currentEnvironment:this.cache.currentEnvironment})),"PreferencesService"===e&&t&&t.settings&&"object"==typeof t.settings&&(Object.assign(this.cache.preferences,t.settings),console.log(`[ComponentBase] ${this.getComponentName()} cached PreferencesService state:`,{bindToAliasMode:this.cache.preferences.bindToAliasMode,bindsetsEnabled:this.cache.preferences.bindsetsEnabled,settingsCount:Object.keys(t.settings).length})),"BindsetService"===e&&t&&t.bindsets&&Array.isArray(t.bindsets)&&(this.cache.bindsetNames=t.bindsets,console.log(`[ComponentBase] ${this.getComponentName()} cached BindsetService state:`,{bindsetNames:this.cache.bindsetNames}))}}l({sender:e,state:t}={}){"undefined"!=typeof window&&console.log(`[ComponentBase] ${this.getComponentName()} received initial state from ${e}`,t),this.p(e,t),"function"==typeof this.handleInitialState&&this.handleInitialState(e,t)}getCurrentState(){return null}handleInitialState(e,t){}async request(e,t={}){return"undefined"!=typeof window&&console.log(`[${this.getComponentName()}] request â†’ ${e}`,t),await se(this.eventBus,e,t)}respond(e,t){return re(this.eventBus,e,async i=>("undefined"!=typeof window&&console.log(`[${this.getComponentName()}] respond handler â†’ ${e}`,i),await t(i)))}}class ce extends oe{constructor({storage:e,eventBus:t,i18n:i}={}){super(t),this.componentName="PreferencesService",this.storage=e,this.i18n=i,this.defaultSettings={theme:"default",autoSave:!0,showTooltips:!0,confirmDeletes:!0,maxUndoSteps:50,defaultMode:"space",compactView:!1,language:"en",syncFolderName:null,syncFolderPath:null,autoSync:!1,autoSyncInterval:"change",bindToAliasMode:!1,bindsetsEnabled:!1,translateGeneratedMessages:!1},this.settings={...this.defaultSettings},this.eventBus&&(this.respond("preferences:init",()=>{this.loadSettings(),this.applySettings()}),this.respond("preferences:load-settings",()=>this.loadSettings()),this.respond("preferences:save-settings",()=>this.saveSettings()),this.respond("preferences:get-settings",()=>this.getSettings()),this.respond("preferences:set-setting",({key:e,value:t})=>this.setSetting(e,t)),this.respond("preferences:set-settings",e=>this.setSettings(e)),this.respond("preferences:get-setting",({key:e})=>this.getSetting(e)),this.setupEventListeners())}setupEventListeners(){this.eventBus&&(this.eventBus.on("theme:toggle",()=>{this.toggleTheme()}),this.eventBus.on("language:change",({language:e})=>{e&&this.changeLanguage(e)}))}onInit(){this.loadSettings(),this.applySettings()}loadSettings(){try{if(!this.storage)return;const e=this.storage.getSettings();this.settings={...this.defaultSettings,...e},console.log("[PreferencesService] loadSettings",{settings:{...this.settings}}),this.emit("preferences:loaded",{settings:this.getSettings()})}catch(e){console.error("[PreferencesService] loadSettings failed",e),this.settings={...this.defaultSettings}}}async saveSettings(){if(!this.storage)return!1;const e=this.storage.saveSettings(this.settings);return console.log("[PreferencesService] saveSettings",{ok:e,settings:{...this.settings}}),e&&await this.emit("preferences:saved",{settings:this.getSettings()},{synchronous:!0}),e}getSettings(){return{...this.settings}}getSetting(e){return this.settings[e]}setSetting(e,t){this.settings[e]=t,console.log("[PreferencesService] setSetting",{key:e,value:t}),this.saveSettings(),this.applySettings(),this.emit("preferences:changed",{key:e,value:t})}setSettings(e={}){const t={...this.settings};this.settings={...this.defaultSettings,...e},console.log("[PreferencesService] setSettings",{changed:Object.keys(e)}),this.saveSettings(),this.applySettings();const i={};for(const[a,n]of Object.entries(e))t[a]!==n&&(i[a]=n);Object.keys(i).length>0&&this.emit("preferences:changed",{changes:i})}getCurrentState(){return{settings:{...this.settings}}}applySettings(){this.applyTheme(),this.applyLanguage(),this.applyOtherSettings()}applyTheme(){if("undefined"==typeof document)return;const e=this.settings.theme||"default";"dark"===e?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme"),this.updateThemeToggleButton(e)}async applyLanguage(){const e=this.settings.language||"en";this.i18n&&this.i18n.language!==e&&await this.i18n.changeLanguage(e),"undefined"!=typeof window&&"function"==typeof window.applyTranslations&&window.applyTranslations(),this.updateLanguageFlag(e)}applyOtherSettings(){if("undefined"!=typeof document&&(this.settings.compactView?document.body.classList.add("compact-view"):document.body.classList.remove("compact-view")),"undefined"!=typeof window&&window.app){const e=window.app;"autoSave"in e&&(e.autoSave=this.settings.autoSave),"maxUndoSteps"in e&&(e.maxUndoSteps=this.settings.maxUndoSteps)}}toggleTheme(){const e="dark"===(this.settings.theme||"default")?"default":"dark";this.setSetting("theme",e)}updateThemeToggleButton(e){if("undefined"==typeof document)return;const t=document.getElementById("themeToggleBtn"),i=document.getElementById("themeToggleText"),a=t?.querySelector("i");t&&i&&a&&("dark"===e?(a.className="fas fa-sun",i.setAttribute("data-i18n","light_mode"),i.textContent=this.i18n.t("light_mode")):(a.className="fas fa-moon",i.setAttribute("data-i18n","dark_mode"),i.textContent=this.i18n.t("dark_mode")))}async changeLanguage(e){this.setSetting("language",e),"undefined"!=typeof window&&window.localizeCommandData&&window.localizeCommandData(),this.emit("language:changed",{language:e})}updateLanguageFlag(e){if("undefined"==typeof document)return;const t=document.getElementById("languageFlag");t&&(t.className={en:"fi fi-gb",de:"fi fi-de",es:"fi fi-es",fr:"fi fi-fr"}[e]||"fi fi-gb")}}const le=globalThis.STO_DATA||{};class de extends oe{constructor({storage:e=null,ui:t=null,app:i=null,eventBus:a=null,i18n:n=null}={}){super(a),this.componentName="ProjectManagementService",this.storage=e,this.ui=t,this.i18n=n,this.app=i,this.eventBus&&(this.setupEventHandlers(),this.setupRequestHandlers())}onInit(){console.log("[ProjectManagementService] Initialized and ready")}setupEventHandlers(){this.eventBus.on("project:save",()=>{this.backupApplicationState()}),this.eventBus.on("project:open",()=>{this.restoreApplicationState()})}setupRequestHandlers(){this.respond("project:restore-from-content",async({content:e,fileName:t}={})=>(console.log("[ProjectManagementService] request project:restore-from-content",{fileName:t,size:e?.length}),await this.restoreFromProjectContent(e,t)))}async backupApplicationState(){try{const e=this.storage.getAllData(),t={version:le?.settings?.version||"1.0.0",exported:(new Date).toISOString(),type:"project",data:{profiles:e.profiles||{},settings:e.settings||{},currentProfile:e.currentProfile}},i=JSON.stringify(t,null,2),a=new Blob([i],{type:"application/json"}),n=URL.createObjectURL(a),s=`STO_Tools_Backup_${(new Date).toISOString().split("T")[0]}.json`,r=document.createElement("a");return r.href=n,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),this.ui?.showToast(this.i18n.t("backup_created_successfully"),"success"),this.emit("project-backup-created",{filename:s,data:t}),{success:!0,filename:s}}catch(e){return console.error("[ProjectManagementService] backupApplicationState failed",e),this.ui?.showToast(this.i18n.t("failed_to_create_backup",{error:e.message}),"error"),this.emit("project-backup-failed",{error:e}),{success:!1,error:e.message}}}async restoreApplicationState(){try{const e=document.createElement("input");return e.type="file",e.accept=".json,application/json",new Promise((t,i)=>{e.onchange=async e=>{try{const i=e.target.files[0];if(!i)return void t({success:!1,cancelled:!0});const a=await i.text();console.log("[ProjectManagementService] restoreApplicationState: file selected",{name:i.name,size:a.length});const n=await this.restoreFromProjectContent(a,i.name);t(n)}catch(e){console.error("[ProjectManagementService] restoreApplicationState failed:",e),this.ui?.showToast(this.i18n.t("backup_restore_failed",{error:e.message}),"error"),t({success:!1,error:e.message})}},e.oncancel=()=>{t({success:!1,cancelled:!0})},e.click()})}catch(e){return console.error("[ProjectManagementService] restoreApplicationState failed:",e),{success:!1,error:e.message}}}async restoreFromProjectContent(e,t="project.json"){try{console.log("[ProjectManagementService] restoreFromProjectContent: begin",{fileName:t,size:e?.length}),console.log("[ProjectManagementService] About to call ImportService with content length:",e?.length);const i=await this.request("import:project-file",{content:e});if(console.log("[ProjectManagementService] import:project-file result",{success:i?.success,error:i?.error,params:i?.params}),!i?.success){const e=i?.error||"import_failed",t=i?.params?.reason||"",a=t?`${e}: ${t}`:e;throw new Error(a)}try{const e=await this.request("data:reload-state");console.log("[ProjectManagementService] data:reload-state done",e)}catch(e){}if(i.currentProfile)try{const e=await this.request("data:switch-profile",{profileId:i.currentProfile});console.log("[ProjectManagementService] data:switch-profile done",e)}catch(e){console.warn("Could not switch to imported current profile:",e?.message)}return this.ui?.showToast(this.i18n.t("backup_restored_successfully"),"success"),await this.emit("project-backup-restored",{filename:t,currentProfile:i.currentProfile,imported:i.imported},{synchronous:!0}),console.log("[ProjectManagementService] restoreFromProjectContent: success"),{success:!0,currentProfile:i.currentProfile,imported:i.imported}}catch(e){return console.error("[ProjectManagementService] restoreFromProjectContent: failed",e),{success:!1,error:e.message}}}}class me extends oe{constructor({eventBus:e,storage:t,syncManager:i,ui:a}={}){super(e),this.componentName="AutoSync",this.storage=t,this.syncManager=i,this.ui=a,this.isEnabled=!1,this.interval="change",this._=null,this.lastSync=null,this.v=null,this.j=500,this.q=()=>this.debouncedSync(),this.setupPreferencesListeners()}onInit(){this.setupFromSettings()}setupPreferencesListeners(){this.eventBus.on("preferences:autosync-settings-changed",()=>{this.setupFromSettings()}),this.eventBus.on("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};void 0===t.autoSync&&void 0===t.autoSyncInterval||this.setupFromSettings(),this.isEnabled&&(console.log("[AutoSync] Preference setting changed, triggering immediate sync"),this.sync())})}setupFromSettings(){if(!this.storage)return;const e=this.storage.getSettings();e.autoSync?this.enable(e.autoSyncInterval||"change"):this.disable()}enable(e="change"){if(this.disable(),this.isEnabled=!0,this.interval=e,"change"===e)this.eventBus.on("storage:data-changed",this.q);else{const t=parseInt(e,10);if(isNaN(t)||t<=0)console.warn(`[AutoSync] Invalid interval '${e}', falling back to 'change' mode`),this.interval="change",this.eventBus.on("storage:data-changed",this.q);else{const e=1e3*t;this._=setInterval(()=>this.sync(),e)}}console.log(`[AutoSync] Enabled with interval: ${this.interval}`)}disable(){this.isEnabled=!1,this.eventBus.off("storage:data-changed",this.q),this._&&(clearInterval(this._),this._=null),this.v&&(clearTimeout(this.v),this.v=null),console.log("[AutoSync] Disabled")}debouncedSync(){this.v&&clearTimeout(this.v),this.v=setTimeout(()=>{this.v=null,this.sync()},this.j)}async sync(){if(this.isEnabled&&this.syncManager)try{await this.syncManager.syncProject("auto"),this.lastSync=new Date,this.ee("synced")}catch(e){console.error("[AutoSync] sync failed",e),this.ee("error")}}ee(e){if(!this.ui||"undefined"==typeof document)return;const t=document.getElementById("modifiedIndicator");if(t)switch(t.classList.remove("syncing","synced","error"),e){case"synced":t.style.display="inline",t.classList.add("synced"),t.innerHTML='<i class="fas fa-check"></i> Synced',setTimeout(()=>{t.style.display="none",t.classList.remove("synced")},2e3);break;case"error":t.style.display="inline",t.classList.add("error"),t.innerHTML='<i class="fas fa-exclamation-triangle"></i> Sync Error',setTimeout(()=>{t.style.display="none",t.classList.remove("error")},5e3)}}}class he extends oe{constructor({eventBus:e=c,storageKey:t="sto_keybind_manager",backupKey:i="sto_keybind_manager_backup",settingsKey:a="sto_keybind_settings",version:n="1.0.0",dataService:s=null,data:r={},i18n:o=null}={}){super(e),this.componentName="StorageService",this.storageKey=t,this.backupKey=i,this.settingsKey=a,this.version=n,this.dataService=s,this.data=r||{},this.i18n=o}onInit(){this.migrateData(),this.ensureStorageStructure(),this.setupEventListeners(),this.emit("storage:ready",{service:this})}setupEventListeners(){this.addEventListener("app:reset-confirmed",()=>{this.handleAppReset()})}async handleAppReset(){console.log("[StorageService] Handling application reset");try{if(this.clearAllData()){if(console.log("[StorageService] Application reset successful - data cleared"),this.data=this.getEmptyData(),this.emit("storage:data-reset",{data:this.data},{synchronous:!0}),this.emit("app:reset-complete",{},{synchronous:!0}),"undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast){const e=this.i18n.t("application_reset_successfully");window.stoUI.showToast(e,"success")}}else console.error("[StorageService] Application reset failed"),this.emit("app:reset-failed")}catch(e){console.error("[StorageService] Error during application reset:",e),this.emit("app:reset-failed",{error:e})}}getAllData(e=!1){if(!e&&this.te)return this.te;try{const e=localStorage.getItem(this.storageKey),t=localStorage.getItem("sto_app_reset");if(!e)return t?(localStorage.removeItem("sto_app_reset"),this.getEmptyData()):this.getDefaultData();const i=JSON.parse(e);return this.isValidDataStructure(i,!0)?(this.te=i,i):this.getDefaultData()}catch(e){console.error("Error loading data from storage:",e);const t=this.getDefaultData();return this.te=t,t}}saveAllData(e){try{this.createBackup();const t={...e,version:this.version,lastModified:(new Date).toISOString(),lastBackup:(new Date).toISOString()};return localStorage.setItem(this.storageKey,JSON.stringify(t)),this.te=t,this.emit("storage:data-changed",{data:t}),!0}catch(e){return console.error("Error saving data to storage:",e),!1}}getProfile(e){return this.getAllData().profiles[e]||null}saveProfile(e,t){const i=this.getAllData(!0);return i.profiles[e]={...t,lastModified:(new Date).toISOString()},this.saveAllData(i)}deleteProfile(e){const t=this.getAllData();if(t.profiles[e]){if(delete t.profiles[e],t.currentProfile===e){const e=Object.keys(t.profiles);t.currentProfile=e.length>0?e[0]:null}return this.saveAllData(t)}return!1}getSettings(){try{const e=localStorage.getItem(this.settingsKey);if(!e)return this.getDefaultSettings();const t=JSON.parse(e);return{...this.getDefaultSettings(),...t}}catch(e){return console.error("Error loading settings:",e),this.getDefaultSettings()}}saveSettings(e){try{const t={...this.getSettings(),...e};return localStorage.setItem(this.settingsKey,JSON.stringify(t)),this.emit("storage:settings-changed",{settings:t}),!0}catch(e){return console.error("Error saving settings:",e),!1}}createBackup(){try{const e=localStorage.getItem(this.storageKey);if(e){const t={data:e,timestamp:(new Date).toISOString(),version:this.version};localStorage.setItem(this.backupKey,JSON.stringify(t)),this.emit("storage:backup-created",{backup:t})}}catch(e){console.error("Error creating backup:",e)}}clearAllData(){try{return localStorage.removeItem(this.storageKey),localStorage.removeItem(this.backupKey),localStorage.removeItem(this.settingsKey),localStorage.setItem("sto_app_reset","true"),this.emit("storage:data-cleared"),!0}catch(e){return console.error("Error clearing data:",e),!1}}getDefaultData(){return{version:this.version,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),currentProfile:null,profiles:{},globalAliases:{},settings:this.getDefaultSettings()}}getEmptyData(){return{version:this.version,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),currentProfile:null,profiles:{},globalAliases:{},settings:this.getDefaultSettings()}}getDefaultSettings(){return{theme:"default",autoSave:!0,showTooltips:!0,confirmDeletes:!0,maxUndoSteps:50,defaultMode:"space",compactView:!1,language:this.detectBrowserLanguage(),syncFolderName:null,syncFolderPath:null,autoSync:!1,autoSyncInterval:"change"}}detectBrowserLanguage(){try{if("undefined"==typeof navigator)return"en";const e=navigator.languages&&navigator.languages[0]||navigator.language;if(!e)return"en";const t=e.toLowerCase().split(/[-_]/)[0];return["en","de","es","fr"].includes(t)?t:"en"}catch(e){return console.error("Error detecting browser language:",e),"en"}}isValidDataStructure(e,t=!1){if(!e||"object"!=typeof e)return!1;const i=["profiles","currentProfile"];for(const t of i)if(!(t in e))return!1;if("object"!=typeof e.profiles)return!1;for(const[i,a]of Object.entries(e.profiles)){const e=this.isValidProfile(a),i=t&&this.needsProfileMigration(a);if(!e&&!i)return!1}return!0}isValidProfile(e){if(!e||"object"!=typeof e)return!1;if(!e.name)return!1;if(e.builds&&"object"==typeof e.builds){const t=e.builds;if(!t.space&&!t.ground)return!1;for(const[e,i]of Object.entries(t))if("space"===e||"ground"===e){if(!i||"object"!=typeof i)return!1;if(!i.keys||"object"!=typeof i.keys)return!1}return!0}return!(!e.mode||!e.keys||"object"!=typeof e.keys)}ensureStorageStructure(){const e=this.getAllData();e.globalAliases||(e.globalAliases={}),e.settings||(e.settings=this.getDefaultSettings()),Object.keys(e.profiles).length>0&&!e.profiles[e.currentProfile]&&(e.currentProfile=Object.keys(e.profiles)[0]),this.saveAllData(e)}migrateData(){const e=this.getAllData();let t=!1;e.version!==this.version&&(console.log(`Migrating data from ${e.version} to ${this.version}`),t=!0);for(const[i,a]of Object.entries(e.profiles))this.needsProfileMigration(a)&&(console.log(`Migrating profile "${a.name}" from old format to new format`),e.profiles[i]=this.migrateProfile(a),t=!0);t&&(e.version=this.version,this.saveAllData(e),console.log("Data migration completed"))}needsProfileMigration(e){return!(!(e&&e.mode&&e.keys)||e.builds)}migrateProfile(e){console.log(`Migrating profile: ${e.name}`);const t={name:e.name,description:e.description||"",currentEnvironment:this.mapOldModeToEnvironment(e.mode),builds:{space:{keys:{}},ground:{keys:{}}},aliases:e.aliases||{},keybindMetadata:e.keybindMetadata||{},created:e.created||(new Date).toISOString(),lastModified:(new Date).toISOString()},i=this.mapOldModeToEnvironment(e.mode);if(t.builds[i].keys=e.keys||{},e.keybindMetadata&&"object"==typeof e.keybindMetadata){const a=e.keybindMetadata.space||e.keybindMetadata.ground;t.keybindMetadata=a?e.keybindMetadata:{[i]:e.keybindMetadata}}return t}mapOldModeToEnvironment(e){if(!e)return"space";const t=("string"==typeof e?e:String(e)).toLowerCase();return"ground"===t||"ground mode"===t?"ground":"space"}getCurrentState(){return{service:this,isReady:this.isInitialized()}}}class ue extends oe{constructor({eventBus:e,i18n:t,ui:i,modalManager:a}){super(e),this.componentName="CommandLibraryService",this.ie=`${Date.now()}_${Math.random().toString(36).substring(2,11)}`,this.i18n=t,this.ui=i,this.modalManager=a,this.ae=[],this.eventBus&&this.ae.push(this.respond("command:find-definition",({command:e})=>this.findCommandDefinition(e)),this.respond("command:get-warning",({command:e})=>this.getCommandWarning(e)),this.respond("command:get-categories",()=>this.getCommandCategories()),this.respond("command:generate-id",()=>this.generateCommandId()),this.respond("command:get-combined-aliases",async()=>await this.getCombinedAliases()),this.respond("command:filter-library",()=>(this.filterCommandLibrary(),!0)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("environment:changed",e=>{const t="string"==typeof e?e:e?.environment;"undefined"!=typeof window&&console.log("[CommandLibraryService] environment:changed event received. data:",e,`parsed env: ${t}`),t&&(this.filterCommandLibrary(),"undefined"!=typeof window&&console.log(`[CommandLibraryService] after environment change to ${t}`))}),this.addEventListener("language:changed",async()=>{try{await this.request("parser:clear-cache")}catch(e){console.warn("[CommandLibraryService] Could not clear parser cache:",e)}await this.updateCombinedAliases(),this.emit("aliases-changed",{aliases:this.cache.combinedAliases})}),this.addEventListener("vfx:settings-changed",async()=>{await this.updateCombinedAliases(),this.emit("aliases-changed",{aliases:this.cache.combinedAliases})})}async getCombinedAliases(){const e={...this.cache.aliases};try{const t=await this.request("vfx:get-virtual-aliases")||{};return{...e,...t}}catch(t){return e}}async updateCombinedAliases(){this.cache.combinedAliases=await this.getCombinedAliases()}async findCommandDefinition(e){try{if(!await this.request("data:has-commands"))return null;const t=await this.request("data:get-commands"),i="string"==typeof e?e.trim():(e?.command||"").trim(),a="string"==typeof e?e.trim():(e?.text||"").trim();for(const[e,n]of Object.entries(t))for(const[t,s]of Object.entries(n.commands))if(s.command===i||s.name===a)return{...this.translateCommandDefinition(s,t),commandId:t,categoryId:e};for(const[e,a]of Object.entries(t))for(const[t,n]of Object.entries(a.commands))if(i){const a=n.command.split(/\s+/)[0],s=a.replace(/^\+/,""),r=a.replace(/^\+?STO/,""),o=a.replace(/^\+?STO/,"+"),c=new Set([a,s,r,o]),l=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=Array.from(c).filter(Boolean).map(e=>new RegExp(`^${l(e)}(\\s|$)`,"i")),m=i.replace(/^\+/,""),h=d.some(e=>e.test(i)||e.test(m));if(/TrayExec/i.test(i)&&h||h)return{...this.translateCommandDefinition(n,t),commandId:t,categoryId:e}}return null}catch(e){return null}}translateCommandDefinition(e,t){if(!this.i18n)return e;const i={...e},a=`command_definitions.${t}.name`;i.name=this.i18n.t(a,{defaultValue:e.name});const n=`command_definitions.${t}.description`;return i.description=this.i18n.t(n,{defaultValue:e.description}),i}async getCommandWarning(e){try{if(!await this.request("data:has-commands"))return null;const t=await this.request("data:get-commands"),i="string"==typeof e?e.trim():(e?.command||"").trim();for(const[a,n]of Object.entries(t))for(const[t,a]of Object.entries(n.commands))if(i&&a.command===i||"object"==typeof e&&(a.command===e.command||a.name===e.text))return a.warning||null;for(const[a,n]of Object.entries(t))for(const[t,a]of Object.entries(n.commands)){const t=i||e.command;if(t&&t.includes(a.command)){const e=t.includes("TrayExec"),i=t.startsWith(a.command);if(e||i)return a.warning||null}}return null}catch(e){return null}}generateCommandId(){return`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}async getCommandCategories(){try{if(!await this.request("data:has-commands"))return{};const e=await this.request("data:get-commands");return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}catch(e){return{}}}async filterCommandLibrary(){try{if(!await this.request("data:has-commands"))return;const e=document.querySelectorAll(".command-item"),t=await this.request("data:get-commands");e.forEach(e=>{const i=e.dataset.command;if(!i)return;let a=null;for(const[e,n]of Object.entries(t))if(n.commands[i]){a=n.commands[i];break}if(a){let t;t="alias"===this.cache.currentEnvironment||!a.environment||a.environment===this.cache.currentEnvironment,e.dataset.envHidden=(!t).toString(),t?""!==e.style.display&&"none"!==e.style.display||(e.style.display="flex"):e.style.display="none"}}),document.querySelectorAll(".category").forEach(e=>{const t=e.querySelectorAll('.command-item:not([style*="display: none"])').length>0;e.style.display=t?"block":"none"})}catch(e){console.warn("CommandLibraryService: filterCommandLibrary failed:",e)}}handleInitialState(e,t){"VFXManagerService"===e&&t&&(console.log("[CommandLibraryService] Received VFX state via late-join:",t),this.updateCombinedAliases().then(()=>{console.log("[CommandLibraryService] Updated combined aliases after VFX late-join"),this.emit("aliases-changed",{aliases:this.cache.combinedAliases})}).catch(e=>{console.error("[CommandLibraryService] Failed to update combined aliases after VFX late-join:",e)}))}onDestroy(){this.ae&&(this.ae.forEach(e=>{"function"==typeof e&&e()}),this.ae=[])}}async function pe(e,t,i={}){if("string"!=typeof e)return console.warn("enrichForDisplay: commandString must be a string, got:",typeof e),ge(e,t);const a=i.eventBus||globalThis.eventBus||c;try{const i=await se(a,"parser:parse-command-string",{commandString:e,options:{generateDisplayText:!0}});if(!i||!i.commands||0===i.commands.length)return ge(e,t);const n=i.commands[0];let s=null;try{s=await se(a,"command:find-definition",{command:e})}catch(e){}const r={command:e,text:n.displayText||e,displayText:n.displayText||e,icon:n.icon||"âš™ï¸",type:n.category||"custom",category:n.category||"custom",parameters:n.parameters||{},signature:n.signature,baseCommand:n.baseCommand,id:n.id||`display_${Date.now()}_${Math.random()}`};if(s&&(r.icon=s.icon||r.icon,r.type=s.categoryId||r.type,r.category=s.categoryId||r.category,s.customizable&&r.parameters?(r.text=function(e,t){if(!e||!t)return e?.name||"Parameterized Command";const{commandId:i,categoryId:a}=e;if("communication"===a||"communication"===i){if(t.verb&&t.message)return`${t.verb}: "${t.message}"`}else if("tray_with_backup"===i){if(void 0!==t.tray&&void 0!==t.slot)return`${e.name} (${t.tray} ${t.slot} ${t.backup_tray??""} ${t.backup_slot??""})`}else if("custom_tray"===i){if(void 0!==t.tray&&void 0!==t.slot)return`${e.name} (${t.tray} ${t.slot})`}else if("target"===i&&t.entityName)return`${e.name}: ${t.entityName}`;return e.name||"Parameterized Command"}(s,r.parameters),r.displayText=r.text):s.name&&(new Set(["custom_tray","tray_with_backup"]).has(s.commandId)||(r.text=s.name,r.displayText=s.name))),t&&"function"==typeof t.t){const e=function(e,t){return t?.translationKey?t.translationKey:e?.baseCommand?`command.${e.baseCommand.toLowerCase()}`:e?.signature?`command.${e.signature.split("(")[0].toLowerCase()}`:null}(n,s);if(e){const i=t.t(e,r.parameters);if(i&&i!==e)if("object"==typeof n.displayText&&n.displayText?.params){const{tray:e,slot:t,backup_tray:a,backup_slot:s}=n.displayText.params;let o="";void 0!==a&&void 0!==s?o=` (${e} ${t} -> ${a} ${s})`:void 0!==e&&void 0!==t&&(o=` (${e} ${t})`),r.text=`${i}${o}`,r.displayText=r.text}else r.text=i,r.displayText=i}}if("object"==typeof r.displayText&&r.displayText&&!("key"in r.displayText)){const t=r.displayText.fallback||r.displayText.text||e;r.displayText=t,r.text=t}return r}catch(i){return console.warn("enrichForDisplay: Failed to parse command:",e,i),ge(e,t)}}function fe(e){return"string"==typeof e?e.trim():e&&"object"==typeof e?(e.command||e.text||"").trim():""}async function ye(e,t={}){const i=fe(e);if(!i)return"";const a=t.eventBus||globalThis.eventBus||c;try{const e=await se(a,"parser:parse-command-string",{commandString:i,options:{generateDisplayText:!1}});if(e?.commands?.[0]){const t=e.commands[0];if(t.signature&&(t.signature.includes("TrayExecByTray")||t.signature.includes("TrayExecByTrayWithBackup"))&&t.parameters){const e=t.parameters,i=void 0!==e.active?e.active:1;if(t.signature.includes("TrayExecByTrayWithBackup")){if(1===i){return`+${(e.baseCommand||"TrayExecByTrayWithBackup").replace(/^\+/,"")} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`}return`${(e.baseCommand||"TrayExecByTrayWithBackup").replace(/^\+/,"")} ${i} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`}if(1===i){return`+${(e.baseCommand||"TrayExecByTray").replace(/^\+/,"")} ${e.tray} ${e.slot}`}return`${(e.baseCommand||"TrayExecByTray").replace(/^\+/,"")} ${i} ${e.tray} ${e.slot}`}}}catch(e){console.warn("normalizeToOptimizedString: Failed to parse command for optimization:",i,e)}return i}function _e(e){if(!Array.isArray(e)){const t=fe(e);return t?[t]:[]}return e.map(fe).filter(e=>e.length>0)}function ge(e,t){const i=String(e||"").trim();return{command:i,text:i||t.t("unknown_command"),displayText:i||t.t("unknown_command"),icon:"âš™ï¸",type:"custom",category:"custom",parameters:{},signature:"UnknownCommand()",baseCommand:"Unknown",id:`fallback_${Date.now()}_${Math.random()}`}}const be={"`":"0x29"},ve=Object.fromEntries(Object.entries(be).map(([e,t])=>[t,e]));function we(e){return"string"!=typeof e?e:e.includes("+")?e.split("+").map(e=>{const t=e.trim();return be[t]||t}).join("+"):be[e]||e}function ke(e){return"string"!=typeof e?e:e.includes("+")?e.split("+").map(e=>{const t=e.trim();return ve[t]||t}).join("+"):ve[e]||e}var Se=Object.freeze({__proto__:null,decodeKeyFromImport:ke,encodeKeyForExport:we});function xe(e,t={},i=!0){let a="";return i&&t.description&&(a+=`; ${t.description}\n`),a+=`alias ${e} <& ${t.commands} &>\n`,a}function Te(e,t=[]){const i=we(e);if(Array.isArray(t)&&0===t.length)return`${i} ""\n`;const a=t.map(e=>"string"==typeof e?e.trim():e&&"string"==typeof e.command?e.command.trim():"").filter(e=>e.length>0);return 0===a.length?`${i} ""\n`:`${i} "${a.join(" $$ ")}"\n`}class Ce extends oe{constructor({storage:e,eventBus:t,i18n:i,profileService:a=null,modalManager:n=null}){super(t),this.componentName="CommandService",this.i18n=i,this.ae=[],this.eventBus&&this.ae.push(this.respond("command:add",async({command:e,key:t,position:i,bindset:a})=>this.addCommand(t,e,a||i)),this.respond("command:edit",async({key:e,index:t,updatedCommand:i,bindset:a})=>this.editCommand(e,t,i,a)),this.respond("command:validate",({command:e})=>this.validateCommand(e)),this.respond("command:delete",async({key:e,index:t,bindset:i})=>this.deleteCommand(e,t,i)),this.respond("command:move",async({key:e,fromIndex:t,toIndex:i,bindset:a})=>this.moveCommand(e,t,i,a)),this.respond("command:get-for-selected-key",this.getCommandsForSelectedKey.bind(this)),this.respond("command:get-empty-state-info",async()=>await this.getEmptyStateInfo()),this.respond("command:check-environment-compatibility",({command:e,environment:t})=>this.isCommandCompatible(e,t)),this.respond("command:get-import-sources",({environment:e,currentKey:t})=>this.getImportSources(e,t)),this.respond("command:import-from-source",({sourceValue:e,targetKey:t,clearDestination:i,currentEnvironment:a})=>this.importFromSource(e,t,i,a)),this.respond("command:generate-command-preview",({key:e,commands:t,stabilize:i=!1})=>this.generateCommandPreview(e,t,i)),this.respond("command:generate-mirrored-commands",async({commands:e=[]})=>this.generateMirroredCommands(e)))}onInit(){this.setupEventListeners()}getCurrentProfile(){return this.cache.currentProfile?this.getCurrentBuild(this.cache.profile):null}getCurrentBuild(e){if(!e)return null;const t=this.cache.builds||{space:{keys:{}},ground:{keys:{}}};return t[this.cache.currentEnvironment]||(t[this.cache.currentEnvironment]={keys:{}}),t[this.cache.currentEnvironment].keys||(t[this.cache.currentEnvironment].keys={}),{...e,keys:t[this.cache.currentEnvironment].keys,aliases:this.cache.aliases||{}}}async addCommand(e,t,i=null){const a=this.getCurrentProfile();if(!a)return this.ui?.showToast?.(this.i18n.t("no_valid_profile"),"error"),!1;const n=i&&"Primary Bindset"!==i&&"alias"!==this.cache.currentEnvironment,s=this.cache.aliases&&this.cache.aliases[e];let r=[];s&&Array.isArray(s.commands)&&(r=[...s.commands]);const o=(Array.isArray(t)?_e(t):[fe(t)]).filter(e=>e.length>0);if(0===o.length)return console.warn("CommandService: No valid commands to add"),!1;r.push(...o);let c=[];c=n?a.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];const l=[...c,...o];try{const s={};if("alias"===this.cache.currentEnvironment)console.log("[CommandService] addCommand: alias"),a.aliases?.[e]?s.modify={aliases:{[e]:{...a.aliases[e]||{},commands:r}}}:s.add={aliases:{[e]:{commands:r,description:"",type:"alias"}}};else if(n){const t=!!a.bindsets?.[i],n=!!a.bindsets?.[i]?.[this.cache.currentEnvironment],r=a.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys||{};t&&n?s.modify={bindsets:{[i]:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}}}:s.add={bindsets:{[i]:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}}},console.log("[CommandService] addCommand: bindset update",{bindset:i,environment:this.cache.currentEnvironment,key:e,bindsetExists:t,envExists:n,ops:s,currentKeys:r,profileBindsets:a.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys})}else a.builds?.[this.cache.currentEnvironment]?.keys?.[e]?s.modify={builds:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}}:s.add={builds:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}};return await this.request("data:update-profile",{profileId:this.cache.currentProfile,...s}),this.emit("command-added",{key:e,command:t}),!0}catch(e){return console.error("Failed to add command:",e),this.ui?.showToast?.("Failed to add command","error"),!1}}async deleteCommand(e,t,i=null){const a=i&&"Primary Bindset"!==i&&"alias"!==this.cache.currentEnvironment,n=this.getCurrentProfile();if(!n)return!1;if(!e||void 0===t)return!1;let s=null,r=null;if("alias"===this.cache.currentEnvironment||this.cache.aliases&&Object.prototype.hasOwnProperty.call(this.cache.aliases,e)){const i=this.cache.aliases[e];if(!i||!Array.isArray(i.commands))return!1;const a=[...i.commands];if(t<0||t>=a.length)return!1;a.splice(t,1),r=[...a],s={modify:{aliases:{[e]:{...i,commands:a}}}}}else{const o=a?n.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];if(!o[t])return!1;const c=[...o];c.splice(t,1),r=[...c],s=a?{modify:{bindsets:{[i]:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}:{modify:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}if(!s)return!1;try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,...s}),this.emit("command-deleted",{key:e,index:t,commands:r}),!0}catch(e){return console.error("Failed to delete command:",e),this.ui?.showToast?.("Failed to delete command","error"),!1}}async moveCommand(e,t,i,a=null){const n=a&&"Primary Bindset"!==a&&"alias"!==this.cache.currentEnvironment,s=this.getCurrentProfile();if(!s)return!1;let r=null;if("alias"===this.cache.currentEnvironment){const a=this.cache.aliases&&this.cache.aliases[e];if(!a||!Array.isArray(a.commands))return!1;const n=[...a.commands];if(t<0||t>=n.length||i<0||i>=n.length)return!1;const[s]=n.splice(t,1);n.splice(i,0,s),r={modify:{aliases:{[e]:{...a,commands:n}}}}}else{const o=n?s.bindsets?.[a]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];if(t<0||t>=o.length||i<0||i>=o.length)return!1;const c=[...o],[l]=c.splice(t,1);c.splice(i,0,l),r=n?{modify:{bindsets:{[a]:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}:{modify:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}try{await this.request("data:update-profile",{profileId:this.cache.currentProfile,...r});const n=await this.fetchCommandsForKey(e,a);return this.emit("command-moved",{key:e,fromIndex:t,toIndex:i,commands:n}),!0}catch(e){return console.error("Failed to move command:",e),!1}}async editCommand(e,t,i,a=null){if(console.log("[CommandService] editCommand called with:",{key:e,index:t,updatedCommand:i}),!e||void 0===t||!i)return console.warn("CommandService: Cannot edit command - missing key, index, or updated command"),!1;const n=a&&"Primary Bindset"!==a&&"alias"!==this.cache.currentEnvironment,s=this.getCurrentProfile();if(!s)return this.ui?.showToast?.("No valid profile","error"),!1;let r=null;if("alias"===this.cache.currentEnvironment){const a=this.cache.aliases[e];if(!a||!Array.isArray(a.commands))return!1;const n=[...a.commands];if(t<0||t>=n.length)return!1;const s=fe(i);n[t]=s,r={modify:{aliases:{[e]:{...a,commands:n}}}}}else{const o=n?s.bindsets?.[a]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];if(t<0||t>=o.length)return!1;const c=[...o];c[t]=fe(i),r=n?{modify:{bindsets:{[a]:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}:{modify:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}console.log("[CommandService] editCommand updates:",r);try{await this.request("data:update-profile",{profileId:this.cache.currentProfile,...r}),console.log("[CommandService] editCommand completed successfully");const n=await this.fetchCommandsForKey(e,a);return this.emit("command-edited",{key:e,index:t,updatedCommand:i,commands:n}),!0}catch(e){return console.error("Failed to edit command:",e),this.ui?.showToast?.("Failed to update command","error"),!1}}setupEventListeners(){this.addEventListener("command:add",async e=>{console.log("[CommandService] command:add received:",e);const{command:t,key:i,bindset:a}=e;console.log("[CommandService] extracted:",{command:t,key:i,bindset:a});const n=await this.addCommand(i,t,a);console.log("[CommandService] addCommand result:",n)}),this.addEventListener("command:edit",async e=>{console.log("[CommandService] command:edit received:",e);const{key:t,index:i,updatedCommand:a,bindset:n=null}=e;console.log("[CommandService] extracted:",{key:t,index:i,updatedCommand:a,bindset:n});const s=await this.editCommand(t,i,a,n);console.log("[CommandService] editCommand result:",s)}),this.addEventListener("bindset-selector:active-changed",({bindset:e})=>{console.log("[CommandService] bindset-selector:active-changed received:",e)}),this.addEventListener("key-selected",({key:e,name:t})=>{const i=e||t;console.log("[CommandService] key-selected received:",i),i&&"Primary Bindset"!==this.cache.activeBindset&&(console.log("[CommandService] Resetting active bindset to Primary Bindset for new key selection"),this.emit("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"}))})}validateCommand(e){return e?{valid:!0}:{valid:!1,reason:"empty"}}onDestroy(){this.ae&&(this.ae.forEach(e=>{"function"==typeof e&&e()}),this.ae=[])}async fetchCommandsForKey(e,t=null){try{if("alias"===this.cache.currentEnvironment)return this.getCommandsForSelectedKey({key:e});if(t&&"Primary Bindset"!==t){const i=await this.request("bindset:get-key-commands",{bindset:t,environment:this.cache.currentEnvironment,key:e});return Array.isArray(i)?i:[]}return await this.request("data:get-key-commands",{environment:this.cache.currentEnvironment,key:e})}catch{return[]}}async getEmptyStateInfo(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(console.log("[CommandService] getEmptyStateInfo DEBUG:",{currentEnvironment:this.cache.currentEnvironment,selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,resolvedSelectedKey:e}),!e)return{title:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_edit"):this.i18n.t("select_a_key_to_edit"),preview:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_see_the_generated_command"):this.i18n.t("select_a_key_to_see_the_generated_command"),icon:"alias"===this.cache.currentEnvironment?"fas fa-mask":"fas fa-keyboard",emptyTitle:"alias"===this.cache.currentEnvironment?this.i18n.t("no_alias_selected"):this.i18n.t("no_key_selected"),emptyDesc:"alias"===this.cache.currentEnvironment?this.i18n.t("select_alias_from_left_panel"):this.i18n.t("select_key_from_left_panel"),commandCount:"0"};const t=await this.getCommandsForSelectedKey(),i=e=>{if("string"!=typeof e)return e;const t=document.createElement("textarea");return t.innerHTML=e,t.value},a="alias"===this.cache.currentEnvironment?i(this.i18n.t("alias_chain")):i(this.i18n.t("command_chain"));let n=!1;if(e&&(n="alias"===this.cache.currentEnvironment?!(this.cache.aliases&&this.cache.aliases[e]):void 0===(this.cache.keys&&this.cache.keys[e])),n)return console.log(`[CommandService] Detected stale selection "${e}" in environment ${this.cache.currentEnvironment} - treating as no selection`),{title:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_edit"):this.i18n.t("select_a_key_to_edit"),preview:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_see_the_generated_command"):this.i18n.t("select_a_key_to_see_the_generated_command"),icon:"alias"===this.cache.currentEnvironment?"fas fa-mask":"fas fa-keyboard",emptyTitle:"alias"===this.cache.currentEnvironment?this.i18n.t("no_alias_selected"):this.i18n.t("no_key_selected"),emptyDesc:"alias"===this.cache.currentEnvironment?this.i18n.t("select_alias_from_left_panel"):this.i18n.t("select_key_from_left_panel"),commandCount:"0"};if(0===t.length){const t="alias"===this.cache.currentEnvironment?`${this.i18n.t("click_add_command_to_start_building_your_alias_chain")} ${e}.`:`${this.i18n.t("click_add_command_to_start_building_your_command_chain")} ${e}.`;return{title:i(this.i18n.t("chain_for_key",{chainType:a,key:e})),preview:await this.getCommandChainPreview(),icon:"fas fa-plus-circle",emptyTitle:this.i18n.t("no_commands"),emptyDesc:t,commandCount:"0"}}return{title:i(this.i18n.t("chain_for_key",{chainType:a,key:e})),preview:await this.getCommandChainPreview(),commandCount:t.length.toString()}}getCommandsForSelectedKey(e={}){console.log("[CommandService] getCommandsForSelectedKey called with params:",e),console.log("[CommandService] Current state:",{currentEnvironment:this.cache.currentEnvironment,selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,cache:this.cache}),this.cache||(console.warn("[CommandService] Cache not initialized, initializing empty cache"),this.cache={});const t=e.environment||this.cache.currentEnvironment||"space";let i=e.key;if(!i&&(i="alias"===t?this.cache.selectedAlias:this.cache.selectedKey,!i))return console.warn("[CommandService] No key/alias selected for environment:",t),[];if(!i)return[];const a=this.cache.profile;if(!a)return console.warn("[CommandService] No profile in cache"),[];if("alias"===t){const e=a.aliases&&a.aliases[i];return e&&Array.isArray(e.commands)?[...e.commands]:[]}if(this.cache.activeBindset&&"Primary Bindset"!==this.cache.activeBindset){const e=a.bindsets?.[this.cache.activeBindset]?.[t]?.keys?.[i];return console.log("[CommandService] Using active bindset:",this.cache.activeBindset,"commands:",e),Array.isArray(e)?[...e]:[]}const n=this.cache.keys&&this.cache.keys[i]?this.cache.keys[i]:[];return Array.isArray(n)?[...n]:[]}async getCommandChainPreview(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(console.log("[CommandService] getCommandChainPreview DEBUG:",{currentEnvironment:this.cache.currentEnvironment,selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,resolvedSelectedKey:e}),!e)return"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_see_the_generated_command"):this.i18n.t("select_a_key_to_see_the_generated_command");const t=await this.getCommandsForSelectedKey();if(0===t.length)return"alias"===this.cache.currentEnvironment?xe(e,{commands:""}).trim():`${e} ""`;if("alias"===this.cache.currentEnvironment){const i=this.getCurrentProfile();console.log("[CommandLibraryService] alias : getCommandChainPreview: profile",i);let a,n=!1;return i&&i.aliasMetadata&&i.aliasMetadata[e]&&i.aliasMetadata[e].stabilizeExecutionOrder&&(n=!0),a=n&&t.length>1?await this.generateMirroredCommandString(t):(await this.normalizeCommandsForDisplay(t)).join(" $$ "),xe(e,{commands:a}).trim()}{const i=this.getCurrentProfile();console.log("[CommandLibraryService] keybind : getCommandChainPreview: profile",i);let a,n=!1;return i&&i.keybindMetadata&&i.keybindMetadata[this.cache.currentEnvironment]&&i.keybindMetadata[this.cache.currentEnvironment][e]&&i.keybindMetadata[this.cache.currentEnvironment][e].stabilizeExecutionOrder&&(n=!0),a=n&&t.length>1?await this.generateMirroredCommandString(t):(await this.normalizeCommandsForDisplay(t)).join(" $$ "),`${e} "${a}"`}}async normalizeCommandsForDisplay(e){const t=[];for(const i of e){const e="string"==typeof i?i:i&&i.command||"";if(e)try{const i=await this.request("parser:parse-command-string",{commandString:e,options:{generateDisplayText:!1}});if(i.commands&&i.commands[0]){const a=i.commands[0];if(a.signature&&(a.signature.includes("TrayExecByTray")||a.signature.includes("TrayExecByTrayWithBackup"))&&a.parameters){const e=a.parameters,i=void 0!==e.active?e.active:1;if(a.signature.includes("TrayExecByTrayWithBackup")){const a=(e.baseCommand||"TrayExecByTrayWithBackup").replace(/^\+/,"");1===i?t.push(`+${a} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`):t.push(`${a} ${i} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`)}else{const a=(e.baseCommand||"TrayExecByTray").replace(/^\+/,"");1===i?t.push(`+${a} ${e.tray} ${e.slot}`):t.push(`${a} ${i} ${e.tray} ${e.slot}`)}}else t.push(e)}else t.push(e)}catch(i){console.warn("[CommandLibraryService] Failed to normalize command for display:",e,i),t.push(e)}}return t}async generateMirroredCommandString(e){return await this.generateMirroredCommands(e)}async generateMirroredCommands(e=[]){if(!Array.isArray(e)||0===e.length)return"";const t=e.map(e=>"string"==typeof e?{command:e}:e&&"string"==typeof e.command?e:null).filter(Boolean);if(t.length<=1)return(await this.normalizeCommandsForDisplay(t)).join(" $$ ");const i=await this.normalizeCommandsForDisplay(t);return[...i,...i.slice(0,-1).reverse()].join(" $$ ")}generateCommandPreview(e,t,i=!1){if(!Array.isArray(t)||0===t.length)return`${e} ""`;let a;if(i&&t.length>1){const e=t.map(e=>"string"==typeof e?e:e.command);a=[...e,...e.slice(0,-1).reverse()].join(" $$ ")}else a=t.map(e=>e.command||e).join(" $$ ");return`${e} "${a}"`}async isCommandCompatible(e,t){if(!e)return console.warn("isCommandCompatible called with undefined commandName"),!0;try{const i=await this.request("data:find-command-by-name",{command:e});return!i||!i.environment||i.environment===t}catch(t){return console.warn(`CommandService: Could not check compatibility for command "${e}":`,t),!0}}async getImportSources(e,t){const i=[];try{if("alias"===e){const e=await this.request("data:get-keys",{environment:"space"})||{};Object.keys(e).forEach(t=>{Object.keys(e[t]||{}).length>0&&i.push({value:`space:${t}`,label:`Space: ${t}`,type:"key"})});const a=await this.request("data:get-keys",{environment:"ground"})||{};Object.keys(a).forEach(e=>{Object.keys(a[e]||{}).length>0&&i.push({value:`ground:${e}`,label:`Ground: ${e}`,type:"key"})});const n=await this.request("alias:get-all")||{};Object.keys(n).forEach(e=>{e!==t&&n[e]?.commands&&i.push({value:`alias:${e}`,label:`Alias: ${e}`,type:"alias"})})}else{const a=await this.request("data:get-keys",{environment:"space"})||{};Object.keys(a).forEach(n=>{("space"!==e||n!==t)&&Object.keys(a[n]||{}).length>0&&i.push({value:`space:${n}`,label:`Space: ${n}`,type:"key"})});const n=await this.request("data:get-keys",{environment:"ground"})||{};Object.keys(n).forEach(a=>{("ground"!==e||a!==t)&&Object.keys(n[a]||{}).length>0&&i.push({value:`ground:${a}`,label:`Ground: ${a}`,type:"key"})});const s=await this.request("alias:get-all")||{};Object.keys(s).forEach(e=>{s[e]?.commands&&i.push({value:`alias:${e}`,label:`Alias: ${e}`,type:"alias"})})}return i}catch(e){return console.error("CommandService: Failed to get import sources:",e),[]}}async importFromSource(e,t,i,a){if(!e||!t)throw new Error("Source and target are required for import");try{const[n,s]=e.split(":");let r=[];if("alias"===n){const e=(await this.request("alias:get-all")||{})[s];if(e&&e.commands){let t;t=Array.isArray(e.commands)?e.commands.join(" $$ "):e.commands,t&&t.trim()&&(r=(await this.request("parser:parse-command-string",{commandString:t})).commands||[])}}else r=await this.request("data:get-key-commands",{environment:n,key:s})||[];if(0===r.length)throw new Error("Source has no commands to import");let o=r,c=0;if("alias"!==a&&"alias"!==n&&n!==a){const e=r.length,t=r.map(async e=>({command:e,isCompatible:await this.isCommandCompatible(e,a)}));o=(await Promise.all(t)).filter(e=>e.isCompatible).map(e=>e.command),c=e-o.length}if(0===o.length)throw new Error("No compatible commands found for import");i&&await this.request("data:clear-key-commands",{environment:a,key:t});for(const e of o)await this.addCommand(t,e);return{success:!0,importedCount:o.length,droppedCount:c,sourceType:n,sourceName:s}}catch(e){throw console.error("CommandService: Failed to import from source:",e),e}}}class $e extends oe{constructor({eventBus:e,storage:t,app:i}){super(e),this.componentName="InterfaceModeService",this.storage=t,this.app=i,this.ne="space",this.se=!1,this.re=null,this.oe=null,this.eventBus&&(this.oe=this.respond("environment:switch",async({mode:e}={})=>e?(await this.switchMode(e),{success:!0,mode:this.ne}):{success:!1,error:"No mode provided"}))}onInit(){this.setupEventListeners()}get currentMode(){return this.ne}set currentMode(e){this.switchMode(e).catch(e=>{console.error("[InterfaceModeService] Error in currentMode setter:",e)})}get currentEnvironment(){return this.ne}set currentEnvironment(e){this.switchMode(e).catch(e=>{console.error("[InterfaceModeService] Error in currentEnvironment setter:",e)})}setupEventListeners(){this.se||(this.re=e=>{e.profileId&&"undefined"!=typeof window&&console.log(`[InterfaceModeService] Profile switched to: ${e.profileId}`),e.environment&&this.switchMode(e.environment).catch(e=>{console.error("[InterfaceModeService] Error in profile switched handler:",e)})},this.eventBus.on("profile:switched",this.re),this.se=!0)}async switchMode(e){if(e===this.ne)return;"undefined"!=typeof window&&console.log(`[InterfaceModeService] switchMode from ${this.ne} to ${e}`);const t=this.ne;this.ne=e;try{await this.updateProfileMode(e)}catch(e){console.error("[InterfaceModeService] Failed to persist environment change:",e)}this.emit("environment:changed",{environment:e,toEnvironment:e,fromEnvironment:t},{synchronous:!0})}async updateProfileMode(e){if(this.cache.currentProfile){console.log(`[InterfaceModeService] updateProfileMode called with mode: ${e}`),console.log(`[InterfaceModeService] Current profile ID: ${this.cache.currentProfile}`);try{const t=await this.request("data:update-profile",{profileId:this.cache.currentProfile,properties:{currentEnvironment:e}});t?.success?console.log(`[InterfaceModeService] Environment persisted to storage: ${e} for profile: ${this.cache.currentProfile}`):console.error("[InterfaceModeService] Failed to persist environment:",t)}catch(e){console.error("[InterfaceModeService] Error updating profile mode:",e)}}else console.warn("[InterfaceModeService] Cannot update profile mode: no current profile ID")}onDestroy(){this.se&&(this.eventBus.off("profile:switched",this.re),this.se=!1),this.oe&&(this.oe(),this.oe=null)}getCurrentState(){return{currentMode:this.ne,environment:this.ne,currentEnvironment:this.ne}}handleInitialState(e,t){if(t&&"DataCoordinator"===e){const e=t.currentEnvironment||t.currentProfileData&&t.currentProfileData.currentEnvironment;if(e){const t=this.ne;this.ne=e,t!==this.ne&&this.emit("environment:changed",{environment:this.ne,isInitialization:!0},{synchronous:!0})}}}}const Be="sync-folder";class Ee extends oe{constructor({dbName:e="sto-sync-handles",storeName:t="directories",eventBus:i}={}){super(i),this.componentName="FileSystemService",this.dbName=e,this.storeName=t}openDB(){return new Promise((e,t)=>{const i=indexedDB.open(this.dbName,1);i.onupgradeneeded=()=>{i.result.createObjectStore(this.storeName)},i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)})}async saveDirectoryHandle(e,t){const i=await this.openDB(),a=i.transaction(this.storeName,"readwrite");a.objectStore(this.storeName).put(t,e),await new Promise((e,t)=>{a.oncomplete=()=>e(),a.onerror=()=>t(a.error),a.onabort=()=>t(a.error)}),i.close()}async getDirectoryHandle(e){const t=await this.openDB(),i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e),a=await new Promise((e,t)=>{i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)});return t.close(),a||null}async writeFile(e,t,i){const a=t.split("/"),n=a.pop();let s=e;for(const e of a)s=await s.getDirectoryHandle(e,{create:!0});const r=await s.getFileHandle(n,{create:!0}),o=await r.createWritable();await o.write(i),await o.close()}static#e=null;static ce(){return this.#e||(this.#e=new Ee),this.#e}static saveDirectoryHandle(e,t){return this.ce().saveDirectoryHandle(e,t)}static getDirectoryHandle(e){return this.ce().getDirectoryHandle(e)}static writeFile(e,t,i){return this.ce().writeFile(e,t,i)}}const Ae=(...e)=>Ee.writeFile(...e);class Ie extends oe{constructor({eventBus:e,storage:t,ui:i,fs:a,i18n:n}={}){super(e),this.componentName="SyncService",this.storage=t,this.ui=i,this.i18n=n,this.fs=a||new Ee({eventBus:e}),this.awaitingSyncDecisionApply=!1,this.pendingSyncAction=null,this.deferredImportContent=null,console.log("[SyncService] constructed"),this.invokeRequest=this.request.bind(this),this.fs||(this.fs=new Ee({eventBus:e})),this.eventBus&&(this.respond("sync:sync-project",({source:e}={})=>this.syncProject(e)),this.addEventListener("preferences:saved",async()=>{if(console.log("[SyncService] preferences:saved received",{awaiting:this.awaitingSyncDecisionApply,pending:this.pendingSyncAction}),this.awaitingSyncDecisionApply)try{const e=await this.getSyncFolderHandle();if(!e)return;const t=this.pendingSyncAction;if(console.log("[SyncService] applying pending action",{action:t}),"import"===t)try{let t,i;if(this.deferredImportContent&&this.deferredImportContent.content)t=this.deferredImportContent.content,i=this.deferredImportContent.fileName||"project.json";else{const a=await e.getFileHandle("project.json",{create:!1}),n=await a.getFile();t=await n.text(),i="project.json"}try{console.log("[SyncService] invoking project:restore-from-content",{size:t?.length});const e=await this.invokeRequest("project:restore-from-content",{content:t,fileName:i});if(console.log("[SyncService] project:restore-from-content result",e),e?.success)this.deferredImportContent=null,this.ui?.showToast(this.i18n.t("project_imported_from_sync_folder"),"success");else{const t=e?.error||"Unknown error";this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:t}),"error")}}catch(e){this.deferredImportContent={content:t,fileName:i},console.log("[SyncService] deferring import until sto-app-ready")}}catch(e){this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:e.message}),"error")}else if("overwrite"===t)try{await this.invokeRequest("export:sync-to-folder",{dirHandle:e}),console.log("[SyncService] overwrite: export:sync-to-folder completed"),this.ui?.showToast(this.i18n.t("project_synced_successfully"),"success")}catch(e){this.ui?.showToast(this.i18n.t("failed_to_sync_project",{error:e.message}),"error")}}finally{this.pendingSyncAction=null,this.awaitingSyncDecisionApply=!1,console.log("[SyncService] cleared pending action and awaiting flag")}}),this.addEventListener("modal:hidden",({modalId:e})=>{console.log("[SyncService] modal:hidden received",{modalId:e,awaiting:this.awaitingSyncDecisionApply,pending:this.pendingSyncAction}),"preferencesModal"===e&&setTimeout(()=>{this.awaitingSyncDecisionApply&&(this.pendingSyncAction=null,this.awaitingSyncDecisionApply=!1,console.log("[SyncService] preferences modal closed without save; pending cleared (deferred)"))},0)}),this.addEventListener("sto-app-ready",async()=>{if(console.log("[SyncService] sto-app-ready received; checking deferred import",{hasDeferred:!!this.deferredImportContent}),!this.deferredImportContent)return;const{content:e,fileName:t}=this.deferredImportContent;this.deferredImportContent=null;try{const i=await this.invokeRequest("project:restore-from-content",{content:e,fileName:t});if(console.log("[SyncService] deferred project:restore-from-content result",i),!i?.success){const e=i?.error||"Unknown error";this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:e}),"error")}}catch(e){this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:e.message}),"error")}}))}isFirefox(){return"undefined"!=typeof navigator&&/firefox/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent)}isSecureContext(){if("undefined"==typeof window)return!1;if(void 0!==window.isSecureContext)return window.isSecureContext;const e=window.location?.protocol,t=window.location?.hostname;return"https:"===e||"file:"===e||"chrome-extension:"===e||"localhost"===t||"127.0.0.1"===t||t&&t.endsWith(".localhost")}async setSyncFolder(e=!1){try{let t,i;if(console.log("[SyncService] setSyncFolder called",{autoSync:e}),this.isFirefox())return this.ui?.showToast(this.i18n.t("sync_not_supported_firefox"),"error"),"undefined"!=typeof window&&window.confirmDialog&&window.confirmDialog.inform&&await window.confirmDialog.inform(this.i18n.t("sync_not_supported_detailed"),this.i18n.t("sync_not_supported_title"),"info","syncNotSupported"),null;if(!this.isSecureContext())return this.ui?.showToast(this.i18n.t("sync_not_supported_secure_context"),"error"),"undefined"!=typeof window&&window.confirmDialog&&window.confirmDialog.inform&&await window.confirmDialog.inform(this.i18n.t("sync_not_supported_secure_context_detailed"),this.i18n.t("sync_not_supported_secure_context_title"),"info","syncSecureContext"),null;if(!("showDirectoryPicker"in window))return this.ui?.showToast(this.i18n.t("sync_not_supported_browser"),"error"),"undefined"!=typeof window&&window.confirmDialog&&window.confirmDialog.inform&&await window.confirmDialog.inform(this.i18n.t("sync_not_supported_browser_detailed"),this.i18n.t("sync_not_supported_browser_title"),"info","syncNotSupportedBrowser"),null;if(t=await window.showDirectoryPicker(),await this.fs.saveDirectoryHandle(Be,t),i=t.name,console.log("[SyncService] setSyncFolder: directory selected",{folderName:i}),this.storage){const a=this.storage.getSettings();a.syncFolderName=i,a.syncFolderPath=`Selected folder: ${i}`,a.syncFolderFallback=!1,a.autoSync=e;try{const e=await t.getFileHandle("project.json",{create:!1});if(e&&"undefined"!=typeof window&&window.confirmDialog?.confirm){const t=await e.getFile(),i=await t.text(),a=this.i18n.t("sync_folder_contains_project_title"),n=this.i18n.t("sync_folder_contains_project_prompt"),s=await window.confirmDialog.confirm(n,a,"warning","syncImportProject");let r=null;if(s)r="import",console.log("[SyncService] setSyncFolder: user chose IMPORT"),this.deferredImportContent={content:i,fileName:"project.json"};else{const e=this.i18n.t("sync_overwrite_existing_title"),t=this.i18n.t("sync_overwrite_existing_prompt");await window.confirmDialog.confirm(t,e,"warning","syncOverwriteProject")?(r="overwrite",console.log("[SyncService] setSyncFolder: user chose OVERWRITE")):(this.ui?.showToast(this.i18n.t("sync_operation_cancelled"),"info"),console.log("[SyncService] setSyncFolder: user CANCELLED"))}r&&(this.pendingSyncAction=r,this.awaitingSyncDecisionApply=!0,console.log("[SyncService] setSyncFolder: pending action recorded",{pending:r}))}}catch(e){console.log("[SyncService] setSyncFolder: no existing project.json found")}this.storage.saveSettings(a),console.log("[SyncService] setSyncFolder: settings saved")}return this.pendingSyncAction||this.ui?.showToast(this.i18n.t("sync_folder_set"),"success"),await this.emit("sync:folder-set",{handle:t},{synchronous:!0}),t}catch(e){return"AbortError"!==e?.name&&this.ui?.showToast(this.i18n.t("failed_to_set_sync_folder",{error:e.message}),"error"),null}}async getSyncFolderHandle(){try{return await this.fs.getDirectoryHandle(Be)}catch(e){return console.error("[SyncService] getSyncFolderHandle failed",e),null}}async ensurePermission(e){if(!e)return!1;try{const t={mode:"readwrite"};return"granted"===await e.queryPermission(t)||"granted"===await e.requestPermission(t)}catch(e){return console.error("[SyncService] ensurePermission failed",e),!1}}async syncProject(e="auto"){if(console.log("[SyncService] syncProject called",{source:e}),this.isFirefox())return void this.ui?.showToast(this.i18n.t("sync_not_supported_firefox"),"warning");if(!this.isSecureContext())return void this.ui?.showToast(this.i18n.t("sync_not_supported_secure_context"),"warning");const t=await this.getSyncFolderHandle();if(t)if(await this.ensurePermission(t))try{await this.invokeRequest("export:sync-to-folder",{dirHandle:t}),console.log("[SyncService] export:sync-to-folder completed");const i=this.storage?.getSettings()||{},a=i.autoSync,n=i.autoSyncInterval||"change";("manual"===e||"auto"===e&&!(a&&"change"===n))&&this.ui?.showToast(this.i18n.t("project_synced_successfully"),"success"),await this.emit("project-synced",null,{synchronous:!0})}catch(e){this.ui?.showToast(this.i18n.t("failed_to_sync_project",{error:e.message}),"error")}else this.ui?.showToast(this.i18n.t("permission_denied_to_folder"),"error");else this.ui?.showToast(this.i18n.t("no_sync_folder_selected"),"warning")}}class Fe extends oe{constructor({eventBus:e,i18n:t,ui:i}={}){super(e),this.componentName="KeyService",this.i18n=t,this.ui=i,this.initializeCache(),this.validKeys=this.generateValidKeys(),this.eventBus&&(this.respond("key:add",({key:e}={})=>this.addKey(e)),this.respond("key:delete",({key:e}={})=>this.deleteKey(e)),this.respond("key:duplicate",({key:e}={})=>this.duplicateKey(e)),this.respond("key:duplicate-with-name",({sourceKey:e,newKey:t}={})=>this.duplicateKeyWithName(e,t)))}setupEventListeners(){this.eventBus&&(this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profile:e})=>{this.updateCacheFromProfile(e)}),this.addEventListener("environment:changed",()=>{}))}updateCacheFromProfile(e){e&&console.log("[KeyService] Profile updated - ComponentBase handles caching automatically")}async addKey(e){if(!await this.isValidKeyName(e))return{success:!1,error:"invalid_key_name",params:{keyName:e}};if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(this.cache.keys[e])return{success:!1,error:"key_already_exists",params:{keyName:e}};try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:[]}}}}}),await this.request("selection:select-key",{keyName:e,environment:this.cache.currentEnvironment}),this.emit("key-added",{key:e}),{success:!0,key:e,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to add key:",e),{success:!1,error:"failed_to_add_key"}}}async deleteKey(e){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!this.cache.keys[e])return{success:!1,error:"key_not_found",params:{keyName:e}};try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,delete:{builds:{[this.cache.currentEnvironment]:{keys:[e]}}}}),this.emit("key-deleted",{keyName:e}),{success:!0,key:e,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to delete key:",e),{success:!1,error:"failed_to_delete_key"}}}async duplicateKey(e){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!this.cache.keys[e])return{success:!1,error:"key_not_found",params:{keyName:e}};const t=this.cache.keys[e];if(!t||0===t.length)return{success:!1,error:"failed_to_duplicate_key"};try{let i=`${e}_copy`,a=1;for(;this.cache.keys[i];)i=`${e}_copy_${a}`,a++;const n=t.map(e=>({...e,id:this.generateKeyId()}));return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{builds:{[this.cache.currentEnvironment]:{keys:{[i]:n}}}}}),this.emit("key-duplicated",{from:e,to:i}),{success:!0,sourceKey:e,newKey:i,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to duplicate key:",e),{success:!1,error:"failed_to_duplicate_key"}}}async duplicateKeyWithName(e,t){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!e||"string"!=typeof e)return{success:!1,error:"failed_to_duplicate_key"};if(!t||"string"!=typeof t)return{success:!1,error:"invalid_key_name",params:{keyName:t||""}};if(!this.cache.keys[e])return{success:!1,error:"key_not_found",params:{keyName:e}};if(!await this.isValidKeyName(t))return{success:!1,error:"invalid_key_name",params:{keyName:t}};if(this.cache.keys[t])return{success:!1,error:"key_already_exists",params:{keyName:t}};const i=this.cache.keys[e];if(!Array.isArray(i)||0===i.length)return{success:!1,error:"no_commands_to_duplicate"};try{const a=JSON.parse(JSON.stringify(i));return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{builds:{[this.cache.currentEnvironment]:{keys:{[t]:a}}}}}),this.cache.keys[t]=JSON.parse(JSON.stringify(a)),this.emit("key-duplicated",{from:e,to:t}),{success:!0,sourceKey:e,newKey:t,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to duplicate key with name:",e),{success:!1,error:"failed_to_duplicate_key"}}}async isValidKeyName(e){if(!e||"string"!=typeof e)return!1;try{const t=await this.request("data:get-key-name-pattern")||/^[A-Za-z0-9_+]+$/,i=t?.pattern??t;if("USE_STO_KEY_NAMES"===i){const{STO_KEY_NAMES:t}=await Promise.resolve().then(function(){return ti});return e.includes("+")?this.isValidChordCombination(e,t):t.includes(e)&&e.length<=20}return i instanceof RegExp?i.test(e)&&e.length<=20:/^[A-Za-z0-9_+]+$/.test(e)&&e.length<=20}catch(t){return/^[A-Za-z0-9_+]+$/.test(e)&&e.length<=20}}isValidChordCombination(e,t){const i=e.split("+");return!(i.length<2)&&(i.map(e=>{const i=e.trim(),a=this.normalizeKeyName(i,t);return t.includes(a)}).every(e=>e)&&e.length<=20)}normalizeKeyName(e,t){const i=new Map;if(t.forEach(e=>{i.set(e.toLowerCase(),e)}),t.includes(e))return e;const a=e.toLowerCase();return i.has(a)?i.get(a):e}generateValidKeys(){const e=[];for(let t=1;t<=12;t++)e.push(`F${t}`),e.push(`Alt+F${t}`);e.push("Space","Tab","Enter","Shift+Space");for(let t=65;t<=90;t++){const i=String.fromCharCode(t);e.push(i),e.push(`Ctrl+${i}`),e.push(`Control+${i}`),e.push(`Alt+${i}`),e.push(`Shift+${i}`)}for(let t=0;t<=9;t++)e.push(String(t)),e.push(`Ctrl+${t}`),e.push(`Alt+${t}`),e.push(`Shift+${t}`);return e.push("Lbutton","Rbutton","Button4","Wheelplus"),e}generateKeyId(){return`key_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}onInit(){this.setupEventListeners()}}class Pe{constructor(e={}){this.options={enableProgressCallbacks:!0,validateUtf8:!0,strictMode:!1,maxFileSize:1048576,...e},this.activityTranslations=new Map,this.keyTokenMap=new Map,this.parseState={currentLayer:0,processedBytes:0,totalBytes:0,errors:[],warnings:[]}}parseFile(e,t={}){this.initializeParsing();const{onProgress:i,targetEnvironment:a="space",includeMetadata:n=!0}=t;i&&"function"==typeof i&&(this.parseState.progressCallback=i);try{const t=this.decodeLayer1(e);if(!t)return this.buildParseResult();const i=this.parseLayer2(t);if(!i.success||0===i.keysets.length)return this.buildParseResult();const s={bindsets:{},aliases:{},errors:[],warnings:[],stats:{totalBindsets:0,totalKeys:0,totalAliases:0,processedLayers:[],skippedActivities:0}};for(const e of i.keysets)try{const t=this.parseLayer3(e);if(!t.success)continue;const i=t.name,r=t.keys;s.bindsets[i]={keys:{},aliases:{},metadata:{}};for(const e of r)try{const t=this.parseLayer4(e);if(!t.success)continue;const{key:r,modifiers:o,combo:c,activities:l,priorityOrder:d}=t,m=this.mapKeyToken(r,o,c);if(!m){this.addWarning(`Failed to create canonical key for token: ${r}`,{keyToken:r,modifiers:o,combo:c});continue}s.bindsets[i].keys[m]={commands:[],metadata:{}},1===d&&n&&(s.bindsets[i].keys[m].metadata.stabilizeExecutionOrder=!0);const h=[];for(const e of l)try{const t=this.parseLayer5(e);if(!t.success)continue;const{activity:n,text:r,text2:l,n1:d,n2:u,n3:p,order:f}=t,y=r?this.decodeLayer6(r):"",_=l?this.decodeLayer6(l):"",g={environment:a,bindsetName:i,keyToken:m,modifiers:o||{},combo:c||[],sanitize:e=>this.sanitizeBindsetName(e)},b=this.translateActivity(n,{...g,text:y,text2:_,n1:d,n2:u,n3:p,order:f});if(b.commands&&b.commands.length>0){if(h.push({activity:n,commands:b.commands,order:f||0}),b.aliases&&b.aliases.length>0)for(const e of b.aliases)s.aliases[e.name]=e}else s.stats.skippedActivities++}catch(t){this.addWarning(`Failed to process activity for key ${m}`,{key:m,activity:e,error:t.message}),s.stats.skippedActivities++}h.sort((e,t)=>e.order-t.order);for(const e of h)s.bindsets[i].keys[m].commands.push(...e.commands);s.stats.totalKeys++}catch(t){this.addWarning("Failed to process key data",{keyData:e,error:t.message})}s.stats.totalBindsets++}catch(t){this.addError("Failed to process KEYSET record",{keysetRecord:e,error:t.message})}return s.errors=[...this.parseState.errors],s.warnings=[...this.parseState.warnings],s.stats.totalAliases=Object.keys(s.aliases).length,s.stats.processedLayers=[1,2,3,4,5,6],this.reportProgress("parse-complete",100),s}catch(e){return this.addError(`Critical parsing error: ${e.message}`,{error:e.name,stack:e.stack}),this.buildParseResult()}}validateFormat(e){const t=Date.now(),i={isValid:!1,isKBF:!1,isLegacy:!1,estimatedSize:0,estimatedKeysets:0,format:"unknown",errors:[],warnings:[],processingTime:0};try{if(!e)return i.errors.push("No content provided for validation"),i;if(!("string"==typeof e||e instanceof ArrayBuffer||e&&"object"==typeof e&&void 0!==e.byteLength))return i.errors.push("Invalid content type. Expected string or ArrayBuffer"),i;let t;if(e instanceof ArrayBuffer||e&&"object"==typeof e&&void 0!==e.byteLength)try{t=new TextDecoder("utf-8").decode(e),i.estimatedSize=e.byteLength}catch(e){return i.errors.push(`Failed to decode ArrayBuffer: ${e.message}`),i}else t=e,i.estimatedSize=e.length;if(t.length<8)return i.errors.push("Content too small to be a valid KBF file"),i;const a=t.trim().replace(/\s+/g,"").replace(/[\r\n\t]/g,"");if(!/^[A-Za-z0-9+/]*={0,2}$/.test(a))return i.errors.push("Invalid Base64 format"),i;if(a.length<8)return i.errors.push("Base64 content too small to contain valid KBF data"),i;let n;try{n=atob(a)}catch(e){return i.errors.push(`Base64 decoding failed: ${e.message}`),i}if(!n||0===n.length)return i.errors.push("Base64 decoding produced empty result"),i;const s=n.includes(";"),r=(/^(GROUPSET|KEYSET|NAME|KEY)[\s:]/m.test(n),n.includes("KEYSET:")),o=n.includes("GROUPSET:"),c=n.includes("KEY:"),l=n.includes("NAME:");if(r||o)if(s){i.isKBF=!0,i.format=o?"kbf-groupset":"kbf-keyset";const e=(n.match(/KEYSET:/g)||[]).length;i.estimatedKeysets=Math.max(1,e)}else i.format="partial-kbf",i.warnings.push("Partial KBF format detected - missing semicolon structure"),i.estimatedKeysets=1;else if(s&&l&&c){i.isLegacy=!0,i.format="legacy",i.warnings.push("Detected legacy KEY-only format without KEYSET wrapper");const e=(n.match(/NAME:/g)||[]).length;i.estimatedKeysets=Math.max(1,e)}else{if(!c&&!l)return i.errors.push("Content does not appear to be a valid KBF format"),i;i.format="partial-kbf",i.warnings.push("Partial KBF format detected - some expected markers are missing"),i.estimatedKeysets=1}if(i.isKBF&&!i.isLegacy){(n.match(/;/g)||[]).length<2&&i.warnings.push("Very few records detected - file may be incomplete");const e=/^[A-Z_]+:[^;]*;/gm;(n.match(e)||[]).length/(n.match(/;/g)||[]).length<.8&&i.warnings.push("Many records appear to have invalid format")}i.isValid=i.isKBF||i.isLegacy||"partial-kbf"===i.format}catch(e){i.errors.push(`Validation error: ${e.message}`),i.isValid=!1}finally{i.processingTime=Date.now()-t}return i}getSupportedActivities(){throw new Error("getSupportedActivities method not implemented yet")}decodeLayer1(e){let t;if(this.parseState.currentLayer=1,this.reportProgress("decode-layer1",0),e instanceof ArrayBuffer)try{t=new TextDecoder("utf-8").decode(e)}catch(t){return this.addError(`Failed to decode ArrayBuffer to string: ${t.message}`,{contentType:"ArrayBuffer",contentSize:e.byteLength}),""}else{if("string"!=typeof e)return this.addError("Invalid content type for Layer 1 decoding",{contentType:typeof e,expectedType:"string|ArrayBuffer"}),"";t=e}const i=t.trim().replace(/\s+/g,"").replace(/[\r\n\t]/g,"");if(!this.isValidBase64(i))return this.addError("Invalid Base64 format in Layer 1 content",{contentPreview:i.slice(0,100),contentLength:i.length}),"";if(i.length<8)return this.addError("Layer 1 content too small to contain valid KBF data",{contentLength:i.length,minimumExpected:8}),"";let a;this.reportProgress("decode-layer1",25);try{a=atob(i)}catch(e){return this.addError(`Layer 1 Base64 decoding failed: ${e.message}`,{errorType:e.name,contentLength:i.length}),""}if(this.reportProgress("decode-layer1",75),!a||0===a.length)return this.addError("Layer 1 decoding produced empty result",{originalLength:i.length}),"";const n=a.includes(";"),s=/[A-Z]+/i.test(a);return n&&s||this.addWarning("Layer 1 decoded content may not be valid KBF Layer 2 format",{hasSemicolons:n,hasRecordMarkers:s,decodedLength:a.length,decodedPreview:a.slice(0,100)}),this.parseState.processedBytes=i.length,this.parseState.totalBytes=a.length,this.reportProgress("decode-layer1",100),a}parseLayer2(e){this.parseState.currentLayer=2,this.parseState.errors=[],this.parseState.warnings=[],this.reportProgress("parse-layer2",0);const t={keysets:[],errors:[],warnings:[]};if("string"!=typeof e)return this.addError("Invalid Layer 2 content: expected string",{contentType:typeof e,isEmpty:!e}),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t;if(null==e)return this.addError("Invalid Layer 2 content: expected string",{contentType:typeof e,isEmpty:!0}),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t;const i=e.trim();if(0===i.length)return this.addError("Layer 2 content is empty after trimming"),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t;this.reportProgress("parse-layer2",25);const a=this.parseSemicolonRecords(i);if(0===a.length)return this.addError("No records found in Layer 2 content",{contentLength:i.length,contentPreview:i.slice(0,100)}),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t;this.reportProgress("parse-layer2",50);let n=null;const s=[];for(let e=0;e<a.length;e++){const t=a[e];if(t&&t.fieldName)try{switch(t.fieldName.toUpperCase()){case"GROUPSET":n=this.parseGroupsetRecord(t);break;case"KEYSET":s.push(this.parseKeysetRecord(t,e));break;case"KEY":this.addWarning("Legacy KEY record found at top level - this indicates implicit KEYSET format",{recordIndex:e,hasGroupset:!!n});break;default:this.addWarning(`Ignoring unknown record type: ${t.fieldName}`,{recordIndex:e,fieldName:t.fieldName,hasValue:!!t.value})}}catch(i){this.addError(`Failed to process record ${t.fieldName} at position ${e}: ${i.message}`,{recordIndex:e,fieldName:t.fieldName,record:t})}else this.addWarning(`Skipping empty or invalid record at position ${e}`,{recordIndex:e,record:t})}return this.reportProgress("parse-layer2",75),0===s.length?(this.addError("No KEYSET records found in Layer 2 content",{foundRecords:a.length,hasGroupset:!!n}),this.isLegacyImplicitFormat(a)?(this.addWarning("Detected legacy implicit KEYSET format - attempting legacy parsing",{totalRecords:a.length,hasGroupset:!!n}),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],{keysets:[{isLegacyImplicit:!0,rawData:i,groupsetVersion:n}],errors:t.errors,warnings:t.warnings}):(t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t)):(t.keysets=s.filter(e=>e&&e.payload),0===t.keysets.length&&this.addError("All KEYSET records were invalid or empty",{originalCount:s.length}),t.keysets.forEach(e=>{e.groupsetVersion=n}),this.reportProgress("parse-layer2",100),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t)}parseSemicolonRecords(e){const t=[],i=e.split(";");for(let e=0;e<i.length;e++){const a=i[e].trim();if(0===a.length)continue;const n=a.indexOf(":");if(-1===n){this.addWarning(`Record without colon separator: "${a}"`,{recordIndex:e,segment:a}),t.push({fieldName:a,value:"",hasColon:!1});continue}const s=a.slice(0,n).trim(),r=a.slice(n+1).trim();0!==s.length?t.push({fieldName:s,value:r,hasColon:!0}):this.addWarning(`Record with empty field name: "${a}"`,{recordIndex:e,segment:a})}return t}parseGroupsetRecord(e){if(!e.hasColon||!e.value)return this.addWarning("Invalid GROUPSET record: missing colon or value",{fieldName:e.fieldName,value:e.value}),null;const t=e.value.trim();return/^\d+$/.test(t)||this.addWarning(`Unexpected GROUPSET version format: "${t}"`,{version:t,expectedFormat:"numeric string"}),t}parseKeysetRecord(e,t){if(!e.hasColon||!e.value)return this.addError("Invalid KEYSET record: missing colon or value",{fieldName:e.fieldName,value:e.value,recordIndex:t}),null;const i=e.value.trim();return 0===i.length?(this.addError("Empty KEYSET payload",{recordIndex:t}),null):(this.isValidBase64(i)||this.addWarning("KEYSET payload may not be valid Base64 data",{recordIndex:t,payloadLength:i.length,payloadPreview:i.slice(0,50)}),{type:"KEYSET",payload:i,recordIndex:t,payloadSize:i.length})}isLegacyImplicitFormat(e){if(0===e.length)return!1;let t=!1,i=!1;for(const a of e)switch(a.fieldName?.toUpperCase()){case"NAME":t=!0;break;case"KEY":i=!0;break;case"KEYSET":return!1}return t&&i}parseLayer3(e){this.parseState.currentLayer=3,this.parseState.errors=[],this.parseState.warnings=[],this.reportProgress("parse-layer3",0);const t={name:null,displayName:null,keys:[],errors:[],warnings:[],recordIndex:e?.recordIndex||0,groupsetVersion:e?.groupsetVersion||null};if(!e||"object"!=typeof e)return this.addError("Invalid keysetRecord parameter for Layer 3 parsing",{keysetRecord:e,expectedType:"object"}),t.errors=[...this.parseState.errors],t;if(!e.payload||"string"!=typeof e.payload)return this.addError("KEYSET payload is missing, invalid, or empty",{keysetRecord:e,payloadType:typeof e.payload}),t.errors=[...this.parseState.errors],t;if(0===e.payload.trim().length)return this.addError("KEYSET payload is empty",{recordIndex:e.recordIndex}),t.errors=[...this.parseState.errors],t;const i=e.payload.trim();if(this.reportProgress("parse-layer3",25),!/^[A-Za-z0-9+/]*={0,2}$/.test(i))return this.addError("KEYSET payload contains invalid Base64 data",{recordIndex:e.recordIndex,payloadLength:i.length,payloadPreview:i.slice(0,50)}),t.errors=[...this.parseState.errors],t;let a;try{a=atob(i)}catch(t){this.addError("Base64 decoding failed",{recordIndex:e.recordIndex,errorType:t.name,payloadLength:i.length}),a=""}if(this.reportProgress("parse-layer3",50),!(a&&0!==a.length||this.parseState.errors.some(e=>e.message.includes("Base64 decoding failed"))))return this.addError("Layer 3 decoding produced empty result",{recordIndex:e.recordIndex,originalPayloadLength:i.length}),t.errors=[...this.parseState.errors],t;const n=a.includes(";"),s=/[A-Z]+:/i.test(a);!s&&a.length>0&&this.addWarning("Layer 3 decoded content may not be valid KEYSET format",{recordIndex:e.recordIndex,hasSemicolons:n,hasFieldMarkers:s,decodedLength:a.length,decodedPreview:a.slice(0,100)}),this.reportProgress("parse-layer3",75);const r=this.parseSemicolonRecords(a);0===r.length&&this.addError("No records found in KEYSET payload",{recordIndex:e.recordIndex,decodedLength:a.length});let o=!1;for(let i=0;i<r.length;i++){const a=r[i];if(a&&a.fieldName)try{switch(a.fieldName.toUpperCase()){case"NAME":{if(o){this.addWarning("Multiple NAME fields found in KEYSET, using first one",{keysetRecordIndex:e.recordIndex,recordIndex:i});continue}const n=this.parseNameField(a,i);n&&(t.name=n.sanitized,t.displayName=n.display,o=!0);break}case"KEY":{const n=this.parseKeyField(a,i,e.recordIndex);n&&t.keys.push(n);break}default:this.addWarning(`Ignoring unknown KEYSET record type: ${a.fieldName}`,{keysetRecordIndex:e.recordIndex,recordIndex:i,fieldName:a.fieldName,hasValue:!!a.value}),a.fieldName.toUpperCase().includes("UNKNOWN")&&this.addWarning(`Ignoring UNKNOWN record type: ${a.fieldName}`,{keysetRecordIndex:e.recordIndex,recordIndex:i,fieldName:a.fieldName,hasValue:!!a.value})}}catch(t){this.addError(`Failed to process KEYSET record ${a.fieldName} at position ${i}: ${t.message}`,{keysetRecordIndex:e.recordIndex,recordIndex:i,fieldName:a.fieldName,record:a})}else this.addWarning(`Skipping empty or invalid record in KEYSET at position ${i}`,{keysetRecordIndex:e.recordIndex,recordIndex:i,record:a})}if(this.reportProgress("parse-layer3",90),!o||!t.name){const i=`Imported_Keyset_${e.recordIndex}`;t.name=this.sanitizeBindsetName(i),t.displayName=i,this.addWarning("No NAME field found in KEYSET, using generated name",{keysetRecordIndex:e.recordIndex,generatedName:t.displayName})}return 0===t.keys.length&&this.addWarning("No KEY entries found in KEYSET",{keysetRecordIndex:e.recordIndex,keysetName:t.displayName}),e.groupsetVersion&&(t.groupsetVersion=e.groupsetVersion),this.reportProgress("parse-layer3",100),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t}parseNameField(e,t){if(!e.hasColon||!e.value)return this.addError("Invalid NAME record: missing colon or value",{fieldName:e.fieldName,value:e.value,recordIndex:t}),null;const i=e.value.trim();return 0===i.length?(this.addError("Empty NAME field",{recordIndex:t}),null):{display:i,sanitized:this.sanitizeBindsetName(i)}}parseKeyField(e,t,i){if(!e.hasColon||!e.value)return this.addError("Invalid KEY record: missing colon or value",{keysetRecordIndex:i,recordIndex:t,fieldName:e.fieldName,value:e.value}),null;const a=e.value.trim();return 0===a.length?(this.addError("Empty KEY payload",{keysetRecordIndex:i,recordIndex:t}),null):(/^[A-Za-z0-9+/=_-]*$/.test(a)||this.addWarning("KEY payload may not be valid Base64 data",{keysetRecordIndex:i,recordIndex:t,payloadLength:a.length,payloadPreview:a.slice(0,50)}),{type:"KEY",payload:a,recordIndex:t,keysetRecordIndex:i,payloadSize:a.length})}sanitizeBindsetName(e){if(null==e)return"unknown_bindset";if("string"!=typeof e)return"unknown_bindset";if(0===e.length)return"unnamed_bindset";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t="bs_"+t),0===t.length&&(t="unnamed_bindset"),t}parseLayer4(e){this.parseState.currentLayer=4,this.parseState.errors=[],this.parseState.warnings=[],this.reportProgress("parse-layer4",0);const t={key:null,priorityOrder:0,modifiers:{control:!1,alt:!1,shift:!1},combo:[],activities:[],errors:[],warnings:[],recordIndex:e?.recordIndex||0,keysetRecordIndex:e?.keysetRecordIndex||0};let i;if("string"==typeof e)i=e;else{if(!e||"object"!=typeof e||!e.payload)return this.addError("Invalid keyData parameter for Layer 4 parsing",{keyData:e,expectedType:"string|object"}),t.errors=[...this.parseState.errors],t;i=e.payload,t.recordIndex=e.recordIndex||0,t.keysetRecordIndex=e.keysetRecordIndex||0}if(!i||"string"!=typeof i)return this.addError("KEY payload is missing, invalid, or empty",{keyData:e,payloadType:typeof i}),t.errors=[...this.parseState.errors],t;if(0===i.trim().length)return this.addError("KEY payload is empty",{recordIndex:t.recordIndex}),t.errors=[...this.parseState.errors],t;const a=i.trim();if(this.reportProgress("parse-layer4",25),!/^[A-Za-z0-9+/]*={0,2}$/.test(a))return this.addError("KEY payload contains invalid Base64 data",{recordIndex:t.recordIndex,payloadLength:a.length,payloadPreview:a.slice(0,50)}),t.errors=[...this.parseState.errors],t;let n;try{n=atob(a)}catch(e){return this.addError("Layer 4 Base64 decoding failed",{recordIndex:t.recordIndex,errorType:e.name,payloadLength:a.length}),t.errors=[...this.parseState.errors],t}if(this.reportProgress("parse-layer4",50),!n||0===n.length)return this.addError("Layer 4 decoding produced empty result",{recordIndex:t.recordIndex,originalPayloadLength:a.length}),t.errors=[...this.parseState.errors],t;const s=n.includes(";"),r=/[A-Z]+:/i.test(n);r||this.addWarning("Layer 4 decoded content may not be valid KEY format",{recordIndex:t.recordIndex,hasSemicolons:s,hasFieldMarkers:r,decodedLength:n.length,decodedPreview:n.slice(0,100)}),this.reportProgress("parse-layer4",75);const o=this.parseSemicolonRecords(n);if(0===o.length)return this.addError("No records found in KEY payload",{recordIndex:t.recordIndex,decodedLength:n.length}),t.errors=[...this.parseState.errors],t;const c={},l=[];for(let e=0;e<o.length;e++){const i=o[e];if(!i||!i.fieldName){this.addWarning(`Skipping empty or invalid record in KEY at position ${e}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e,record:i});continue}const a=i.fieldName.toUpperCase();try{switch(a){case"KEY":if(c.key){this.addWarning("Multiple Key fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e});continue}c.key=this.parseKeyTokenField(i,e);break;case"PRIORITYORDER":if(void 0!==c.priorityOrder){this.addWarning("Multiple PriorityOrder fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e});continue}c.priorityOrder=this.parseNumericField(i,e,"PriorityOrder",0,1);break;case"CONTROL":if(void 0!==c.control){this.addWarning("Multiple Control fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e});continue}c.control=this.parseBooleanField(i,e,"Control");break;case"ALT":if(void 0!==c.alt){this.addWarning("Multiple Alt fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e});continue}c.alt=this.parseBooleanField(i,e,"Alt");break;case"SHIFT":if(void 0!==c.shift){this.addWarning("Multiple Shift fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e});continue}c.shift=this.parseBooleanField(i,e,"Shift");break;case"COMBO":if(void 0!==c.combo){this.addWarning("Multiple Combo fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e});continue}c.combo=this.parseComboField(i,e);break;case"ACT":{const t=this.parseActivityField(i,e);t&&l.push(t);break}default:this.addWarning(`Ignoring unknown KEY record type: ${i.fieldName}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e,fieldName:i.fieldName,hasValue:!!i.value})}}catch(a){this.addError(`Failed to process KEY record ${i.fieldName} at position ${e}: ${a.message}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e,fieldName:i.fieldName,record:i})}}return this.reportProgress("parse-layer4",90),c.key?(t.key=c.key,t.priorityOrder=c.priorityOrder||0,t.modifiers.control=!!c.control,t.modifiers.alt=!!c.alt,t.modifiers.shift=!!c.shift,t.combo=c.combo||[],t.activities=l,this.reportProgress("parse-layer4",100),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t):(this.addError("Missing required Key field in KEY payload",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex}),t.errors=[...this.parseState.errors],t)}parseKeyTokenField(e,t){if(!e.hasColon)return this.addError("Invalid Key field: missing colon",{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;if(null===e.value||void 0===e.value)return this.addError("Empty Key field: null or undefined value",{fieldName:e.fieldName,fieldIndex:t}),null;let i=e.value.trim();return 0===i.length?(this.addError("Empty Key field",{fieldIndex:t}),null):("SemiColon"===i?i=";":"Space"===i&&(i=" "),i)}parseNumericField(e,t,i,a=null,n=null){if(!e.hasColon||!e.value)return this.addError(`Invalid ${i} field: missing colon or value`,{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;const s=e.value.trim();if(0===s.length)return this.addError(`Empty ${i} field`,{fieldIndex:t}),null;if(!/^-?\d+$/.test(s))return this.addError(`Invalid ${i} field: must be numeric`,{fieldIndex:t,value:s}),null;const r=parseInt(s,10);return null!==a&&r<a?(this.addWarning(`${i} value below minimum, using minimum`,{fieldIndex:t,value:r,minValue:a}),a):null!==n&&r>n?(this.addWarning(`${i} value above maximum, using maximum`,{fieldIndex:t,value:r,maxValue:n}),n):r}parseBooleanField(e,t,i){if(!e.hasColon||!e.value)return this.addError(`Invalid ${i} field: missing colon or value`,{fieldName:e.fieldName,value:e.value,fieldIndex:t}),!1;const a=e.value.trim();return 0===a.length?(this.addError(`Empty ${i} field`,{fieldIndex:t}),!1):"1"===a||("0"===a||this.addWarning(`Invalid ${i} field: expected 0 or 1, using false`,{fieldIndex:t,value:a}),!1)}parseComboField(e,t){if(!e.hasColon)return this.addError("Invalid Combo field: missing colon",{fieldName:e.fieldName,value:e.value,fieldIndex:t}),[];const i=e.value.trim();if(0===i.length)return[];const a=i.split("*").filter(e=>e.length>0);if(0===a.length)return[];const n=[];for(let e=0;e<a.length;e++){const i=a[e].trim();if(0!==i.length)if(/^[A-Za-z0-9+/]*={0,2}$/.test(i))try{const e=atob(i);e.length>0&&n.push(e)}catch(a){this.addWarning(`Failed to decode combo token: ${a.message}`,{fieldIndex:t,tokenIndex:e,token:i,errorType:a.name})}else this.addWarning("Combo token may not be valid Base64 data",{fieldIndex:t,tokenIndex:e,token:i})}return n}parseActivityField(e,t){if(!e.hasColon||!e.value)return this.addError("Invalid ACT field: missing colon or value",{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;const i=e.value.trim();return 0===i.length?(this.addError("Empty ACT payload",{fieldIndex:t}),null):(/^[A-Za-z0-9+/]*={0,2}$/.test(i)||this.addWarning("ACT payload may not be valid Base64 data",{fieldIndex:t,payloadLength:i.length,payloadPreview:i.slice(0,50)}),{type:"ACT",payload:i,fieldIndex:t,payloadSize:i.length})}parseBase64TextField(e,t){if(!e.hasColon)return this.addError(`Invalid ${e.fieldName} field: missing colon`,{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;if(null===e.value||void 0===e.value)return"";const i=e.value.trim();if(0===i.length)return"";/^[A-Za-z0-9+/]*={0,2}$/.test(i)||this.addWarning(`${e.fieldName} field may not be valid Base64 data`,{fieldIndex:t,textLength:i.length,textPreview:i.slice(0,50)});try{const a=atob(i),n=new Uint8Array(a.length);for(let e=0;e<a.length;e++)n[e]=a.charCodeAt(e);try{return new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch(i){this.addWarning(`${e.fieldName} field contains invalid UTF-8 data, using fallback decoding`,{fieldIndex:t,errorType:i.name,errorMessage:i.message});try{return new TextDecoder("utf-8",{fatal:!1}).decode(n)}catch(i){return this.addError(`Complete ${e.fieldName} field UTF-8 decoding failure`,{fieldIndex:t,errorType:i.name,errorMessage:i.message}),""}}}catch(a){return this.addError(`Failed to Base64 decode ${e.fieldName} field`,{fieldIndex:t,errorType:a.name,errorMessage:a.message,textLength:i.length}),""}}parseLayer5(e){this.parseState.currentLayer=5,this.parseState.errors=[],this.parseState.warnings=[],this.reportProgress("parse-layer5",0);const t={activity:null,text:null,text2:null,n1:null,n2:null,n3:null,order:0,errors:[],warnings:[],fieldIndex:e?.fieldIndex||0,recordIndex:e?.recordIndex||0,keysetRecordIndex:e?.keysetRecordIndex||0};let i;if("string"==typeof e)i=e;else{if(!e||"object"!=typeof e||!e.payload)return this.addError("Invalid activityData parameter for Layer 5 parsing",{activityData:e,expectedType:"string|object"}),t.errors=[...this.parseState.errors],t;i=e.payload,t.fieldIndex=e.fieldIndex||0,t.recordIndex=e.recordIndex||0,t.keysetRecordIndex=e.keysetRecordIndex||0}if(!i||"string"!=typeof i)return this.addError("ACT payload is missing, invalid, or empty",{activityData:e,payloadType:typeof i}),t.errors=[...this.parseState.errors],t;if(0===i.trim().length)return this.addError("ACT payload is empty",{fieldIndex:t.fieldIndex}),t.errors=[...this.parseState.errors],t;const a=i.trim();if(this.reportProgress("parse-layer5",25),!/^[A-Za-z0-9+/]*={0,2}$/.test(a))return this.addError("ACT payload contains invalid Base64 data",{fieldIndex:t.fieldIndex,payloadLength:a.length,payloadPreview:a.slice(0,50)}),t.errors=[...this.parseState.errors],t;let n;try{n=atob(a)}catch(e){return this.addError("Layer 5 Base64 decoding failed",{fieldIndex:t.fieldIndex,errorType:e.name,payloadLength:a.length}),t.errors=[...this.parseState.errors],t}if(this.reportProgress("parse-layer5",50),!n||0===n.length)return this.addError("Layer 5 decoding produced empty result",{fieldIndex:t.fieldIndex,originalPayloadLength:a.length}),t.errors=[...this.parseState.errors],t;const s=n.includes(";"),r=/^[A-Za-z]+:/i.test(n);s&&r||this.addWarning("Layer 5 decoded content may not be valid ACT format",{fieldIndex:t.fieldIndex,hasSemicolons:s,hasFieldMarkers:r,decodedLength:n.length,decodedPreview:n.slice(0,100)}),this.reportProgress("parse-layer5",75);const o=this.parseSemicolonRecords(n);if(0===o.length)return this.addError("No records found in ACT payload",{fieldIndex:t.fieldIndex,decodedLength:n.length}),t.errors=[...this.parseState.errors],t;const c={};for(let e=0;e<o.length;e++){const i=o[e];if(!i||!i.fieldName){this.addWarning(`Skipping empty or invalid record in ACT at position ${e}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e,record:i});continue}const a=i.fieldName.toUpperCase();try{switch(a){case"ACTIVITY":if(void 0!==c.activity){this.addWarning("Multiple Activity fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.activity=this.parseNumericField(i,e,"Activity");break;case"TEXT":if(void 0!==c.text){this.addWarning("Multiple Text fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.text=this.parseBase64TextField(i,e);break;case"TEXT2":if(void 0!==c.text2){this.addWarning("Multiple Text2 fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.text2=this.parseBase64TextField(i,e);break;case"N1":if(void 0!==c.n1){this.addWarning("Multiple N1 fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.n1=this.parseNumericField(i,e,"N1");break;case"N2":if(void 0!==c.n2){this.addWarning("Multiple N2 fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.n2=this.parseNumericField(i,e,"N2");break;case"N3":if(void 0!==c.n3){this.addWarning("Multiple N3 fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.n3=this.parseNumericField(i,e,"N3");break;case"O":if(void 0!==c.order){this.addWarning("Multiple O fields found in ACT, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e});continue}c.order=this.parseNumericField(i,e,"O",0);break;default:this.addWarning(`Ignoring unknown ACT record type: ${i.fieldName}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e,fieldName:i.fieldName,hasValue:!!i.value})}}catch(a){this.addError(`Failed to process ACT record ${i.fieldName} at position ${e}: ${a.message}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityFieldIndex:e,fieldName:i.fieldName,record:i})}}return this.reportProgress("parse-layer5",90),null===c.activity||void 0===c.activity?(this.addError("Missing required Activity field in ACT payload",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex}),t.errors=[...this.parseState.errors],t):((c.activity<0||c.activity>123)&&this.addWarning("Activity ID outside expected range (0-123)",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:t.fieldIndex,activityId:c.activity,expectedRange:"0-123"}),t.activity=c.activity,t.text=void 0!==c.text?c.text:null,t.text2=void 0!==c.text2?c.text2:null,t.n1=null!==c.n1&&void 0!==c.n1?c.n1:null,t.n2=null!==c.n2&&void 0!==c.n2?c.n2:null,t.n3=null!==c.n3&&void 0!==c.n3?c.n3:null,t.order=c.order||0,this.reportProgress("parse-layer5",100),t.errors=[...this.parseState.errors],t.warnings=[...this.parseState.warnings],t)}isValidUtf8Sequence(e){if("string"!=typeof e)return!1;try{const t=new TextEncoder,i=new TextDecoder("utf-8",{fatal:!0}),a=t.encode(e);return i.decode(a)===e}catch(e){return!1}}decodeLayer6(e){if(this.parseState.currentLayer=6,this.reportProgress("decode-layer6",0),"string"!=typeof e)return this.addError("Invalid input for Layer 6 decoding: expected string",{inputType:typeof e,isEmpty:!e}),"";if(null==e)return"";const t=e.trim();if(0===t.length)return"";this.reportProgress("decode-layer6",25),/^[A-Za-z0-9+/]*={0,2}$/.test(t)||this.addWarning("Layer 6 text may not be valid Base64 data",{textLength:t.length,textPreview:t.slice(0,50)}),this.reportProgress("decode-layer6",50);try{const e=atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);this.reportProgress("decode-layer6",75);try{const e=new TextDecoder("utf-8",{fatal:!0}).decode(i);if(this.isValidUtf8Sequence(e))return this.reportProgress("decode-layer6",100),e;this.addWarning("Layer 6 decoded text contains invalid UTF-8 sequences",{textLength:e.length,textPreview:e.slice(0,100)})}catch(e){this.addWarning("Layer 6 text contains invalid UTF-8 sequences, using fallback decoding",{errorType:e.name,errorMessage:e.message,textLength:t.length});try{const e=new TextDecoder("utf-8",{fatal:!1}).decode(i);return this.reportProgress("decode-layer6",100),e}catch(e){return this.addError("Complete Layer 6 UTF-8 decoding failure",{errorType:e.name,errorMessage:e.message,textLength:t.length}),this.reportProgress("decode-layer6",100),""}}}catch(e){return this.addError("Failed to Base64 decode Layer 6 text",{errorType:e.name,errorMessage:e.message,textLength:t.length}),this.reportProgress("decode-layer6",100),""}return this.reportProgress("decode-layer6",100),""}translateActivity(e,t){if("number"!=typeof e||!Number.isInteger(e))return this.addValidationError("activity","must be a valid integer",e,{fieldType:"number",expectedValue:"integer between 0-123",suggestion:"Activity ID must be an integer value"}),this.createUnknownActivityResult(e,t);if(e<0||e>123)return this.addValidationError("activity",`value ${e} is outside valid range (0-123)`,e,{fieldType:"number",actualValue:e,expectedValue:"0-123",suggestion:"Activity IDs must be between 0 and 123 inclusive"}),this.createUnknownActivityResult(e,t);const i={environment:t?.environment||"space",bindsetName:t?.bindsetName||"unknown_bindset",keyToken:t?.keyToken||"unknown_key",modifiers:{control:t?.modifiers?.control||!1,alt:t?.modifiers?.alt||!1,shift:t?.modifiers?.shift||!1},combo:t?.combo||[],sanitize:t?.sanitize||(e=>this.sanitizeBindsetName(e)),...t};["space","ground"].includes(i.environment)||(this.addWarning(`Invalid environment "${i.environment}", defaulting to "space"`,{category:"validation",fieldName:"environment",actualValue:i.environment,expectedValue:"space|ground",suggestion:'Environment must be either "space" or "ground"'}),i.environment="space");const a=this.getActivityHandler(e);if(!a)return this.addUnknownElementWarning("activity",e,{recordType:"ACT",fieldName:"Activity",activity:e,context:i.keyToken,environment:i.environment,bindsetName:i.bindsetName,suggestion:"This activity may be from a newer KBF version or custom extension. The activity will be skipped but parsing will continue."}),this.createUnknownActivityResult(e,i);try{const t=a.call(this,i);return t&&"object"==typeof t?t:(this.addError(`Activity handler returned invalid result for activity ${e}`,{category:"handler_error",severity:"error",activity:e,actualValue:t,expectedValue:"object with commands/aliases/metadata",recoverable:!0,suggestion:"Handler implementation may be broken"}),this.createUnknownActivityResult(e,i))}catch(t){return this.addError(`Activity translation failed for ${e}: ${t.message}`,{category:"handler_error",severity:"error",activity:e,error:t.name,errorStack:t.stack,context:i.keyToken,environment:i.environment,bindsetName:i.bindsetName,recoverable:!0,suggestion:`Handler for activity ${e} encountered an error. This may indicate a bug in the translation logic.`}),this.createUnknownActivityResult(e,i)}}getActivityHandler(e){return this.isFileOperation(e)?this.translateFileOperationActivity:this.isPhase11Activity(e)?this.translatePhase11Activity:this.isPhase12Activity(e)?this.translatePhase12Activity:this.isPhase13Activity(e)?this.translatePhase13Activity:null}isPhase11Activity(e){return e>=0&&e<=13||e>=30&&e<=96||e>=102&&e<=123}isPhase12Activity(e){return 14===e||97===e||101===e||e>=17&&e<=29}isPhase13Activity(e){return 15===e||16===e||100===e}translatePhase11Activity(e){const t=e.activity||e.activityData?.activity;if("number"!=typeof t)return this.addWarning("Invalid activity data in Phase 1.1 translation",{activity:t,context:e.keyToken}),this.createUnknownActivityResult(t,e);const i=e.activityData||{};if(this.isFileOperation(t))return this.translateFileOperation(t,i,e);const a=this.getPhase11Command(t,i);return{commands:[a],aliases:[],metadata:{type:"phase11_single_command",originalActivity:t,environment:e.environment,bindsetName:e.bindsetName,keyToken:e.keyToken,command:a},success:!0}}isFileOperation(e){return 99===e||104===e||105===e}translateFileOperationActivity(e){const t=e.activity||e.activityData?.activity;if("number"!=typeof t)return this.addWarning("Invalid activity data in file operation translation",{activity:t,context:e.keyToken}),this.createUnknownActivityResult(t,e);const i=e.activityData||{};return this.translateFileOperation(t,i,e)}translateFileOperation(e,t,i){const{text:a,text2:n}=t;let s="",r={};switch(e){case 99:if(a){const e=this.normalizeFilename(a);s=`bind_load_file ${e}`,r={originalFilename:a,normalizedFilename:e,pathType:this.detectPathType(a),operation:"load"}}else s="bind_load_file",r={operation:"load",pathType:"none"};break;case 104:if(n){const e=this.normalizeFilename(n);s=`bind_load_file ${e}`,r={originalFilename:n,normalizedFilename:e,pathType:this.detectPathType(n),operation:"load_bindset"}}else s="bind_load_file",r={operation:"load_bindset",pathType:"none"};break;case 105:if(!a)return this.addWarning("SaveBindFile activity missing filename",{activity:e,context:i.keyToken}),{commands:[],aliases:[],metadata:{type:"file_operation",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,command:"",fileOperation:{operation:"save",error:"Missing filename for SaveBindFile"}},success:!1,error:"Missing filename for SaveBindFile"};{let e=a;e.endsWith(".txt")||(e=e.endsWith(".")?e+"txt":e+".txt");const t=this.normalizeFilename(e);s=`bind_save_file ${t}`,r={originalFilename:a,normalizedFilename:t,pathType:this.detectPathType(a),operation:"save",suffixAdded:!a.endsWith(".txt")}}break;default:return this.createUnknownActivityResult(e,i)}return{commands:[s],aliases:[],metadata:{type:"file_operation",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,command:s,fileOperation:r},success:!0}}normalizeFilename(e){return e.replace(/\s+/g,"_")}detectPathType(e){return/^[A-Za-z]:\\|^\//.test(e)?"absolute":"relative"}getPhase11Command(e,t){const i=t.activityData||{},{text:a,n1:n,n2:s}=i;switch(e){case 0:return a?`team ${a}`:"team ";case 1:return"target_clear";case 2:return"Target_Enemy_Near";case 3:return"Target_Enemy_Next";case 4:return"number"==typeof n?`Target_Teammate ${n}`:"Target_Teammate";case 5:return a?`Target ${a.trim()}`:"Target";case 6:return"Target_Friend_Next";case 7:return"Target_Enemy_Next_Exposed";case 8:return"StatsPreset_Load Preset_1";case 9:return"StatsPreset_Load Preset_2";case 10:return"StatsPreset_Load Preset_3";case 11:return"StatsPreset_Load Preset_4";case 12:return a?`Assist ${a.trim()}`:"Assist";case 13:return"number"==typeof n&&"number"==typeof s?`+TrayExecByTray ${n} ${s}`:"+TrayExecByTray"}return e>=30&&e<=96?this.getMovementOrUICommand(e,i):e>=102&&e<=123?this.getAdvancedCommand(e,i):(this.addWarning(`Unexpected Phase 1.1 activity ID: ${e}`,{activity:e,context:t.keyToken}),"")}getMovementOrUICommand(e,t){const{text:i,n1:a,n2:n,n3:s}=t;switch(e){case 30:case 32:return"+left";case 31:case 33:return"+right";case 34:return"+up";case 35:return"+down";case 36:case 39:return"number"==typeof a?`+TrayExecByTray ${a} 0`:"+TrayExecByTray";case 37:case 40:return"number"==typeof a?`+TrayExecByTray ${a} 1`:"+TrayExecByTray";case 38:case 41:return"GenSendMessage Hud_QuickTray_Stop";case 42:case 44:return i||"";case 43:case 45:return i?`GenSendMessage Macro_Stop ${i}`:"GenSendMessage Macro_Stop";case 46:case 56:case 57:return"InteractWindow";case 47:return"Target_Self";case 48:return"Target_Nearest";case 49:return i?`TryTrayPowerExecName ${i}`:"TryTrayPowerExecName";case 50:return i?`TryTrayPowerExecNameReverse ${i}`:"TryTrayPowerExecNameReverse";case 51:return i?`GenSendMessage TryTrayPowerExec_Stop ${i}`:"GenSendMessage TryTrayPowerExec_Stop";case 52:return"Target_Self_Heal";case 53:return"Target_Team";case 54:return"+PowerExec Disengage";case 55:return"GenSendMessage Hud_Reticle Stop";case 58:return"GenSendMessage QuickCam Change";case 59:return"GenSendMessage QuickCam SetFollow";case 60:return"GenSendMessage QuickCam SetFree";case 61:return"number"==typeof a&&"number"==typeof n?`+TrayExecByTray ${a} ${n}`:"+TrayExecByTray";case 62:return"number"==typeof a&&"number"==typeof n?`+TrayExecByTray ${a} ${n}_reverse`:"+TrayExecByTray_reverse";case 63:return"GenSendMessage Tray_Stop";case 64:return"GenSendMessage Hud_StatusBuffs Toggle";case 65:return"GenSendMessage Hud_SpaceTray Toggle";case 66:return"GenSendMessage FleetWindow Toggle";case 67:return"GenSendMessage TeamHud Toggle";case 68:case 81:return"GenSendMessage JournalWindow Toggle";case 69:return"GenSendMessage StatusWindow Toggle";case 70:return"GenSendMessage InventoryWindow Toggle";case 71:return"GenSendMessage PowersWindow Toggle";case 72:return"GenSendMessage PvpQueueWindow Toggle";case 73:return"GenSendMessage CrewWindow Toggle";case 74:return"GenSendMessage ContactsWindow Toggle";case 75:return"GenSendMessage ChatWindow Toggle";case 76:return"GenSendMessage SocialWindow Toggle";case 77:return"GenSendMessage HelpWindow Toggle";case 78:return"GenSendMessage BridgeInviteWindow Toggle";case 79:return"GenSendMessage AdmiraltyWindow Toggle";case 80:return"GenSendMessage DutyOfficerWindow Toggle";case 82:return"GenSendMessage ReputationWindow Toggle";case 83:return"GenSendMessage UpgradeWindow Toggle";case 84:return"GenSendMessage TailorWindow Toggle";case 85:return"GenSendMessage ExchangeWindow Toggle";case 86:return"GenSendMessage BankWindow Toggle";case 87:return"GenSendMessage MailWindow Toggle";case 88:return"GenSendMessage FleetRosterWindow Toggle";case 89:return"GenSendMessage ChatSettingsWindow Toggle";case 90:return"GenSendMessage MailComposeWindow Toggle";case 91:if("number"==typeof a){const e=(a/100).toFixed(2);return`GenSetEarlyOverrideFloat Hud_AllBuffs scale ${e}`}return"GenSetEarlyOverrideFloat Hud_AllBuffs scale 1.0";case 92:return"number"==typeof a?`GenSetEarlyOverrideFloat Hud_Spacetraywindow_Large scale ${(a/100).toFixed(2)}`:"GenSetEarlyOverrideFloat Hud_Spacetraywindow_Large scale 1.0";case 93:return"number"==typeof a?`GenSetEarlyOverrideFloat Hud_Buffs scale ${(a/100).toFixed(2)}`:"GenSetEarlyOverrideFloat Hud_AllBuffs scale 1.0";case 94:return"number"==typeof a?`GenSetEarlyOverrideFloat Hud_Spacetraywindow_Secondary scale ${(a/100).toFixed(2)}`:"GenSetEarlyOverrideFloat Hud_Spacetraywindow_Secondary scale 1.0";case 95:return"number"==typeof a&&"number"==typeof n&&"number"==typeof s?`+TrayExecByTray ${a} ${n}-${s}`:"number"==typeof a&&"number"==typeof n?`+TrayExecByTray ${a} ${n}`:"+TrayExecByTray";case 96:return i?`emote_notext ${i}`:"emote_notext";case 99:return i?`bind_load_file ${i.replace(/\s+/g,"_")}`:"bind_load_file";default:return""}}getAdvancedCommand(e,t){const{text:i,text2:a,n1:n,n2:s}=t;switch(e){case 102:return"target Armored Bio-Neural Warhead";case 103:return"InteractWindow";case 104:return a?`bind_load_file ${a}`:"bind_load_file";case 105:return i&&i.endsWith(".txt")?`bind_save_file ${i.replace(/\s+/g,"_")}`:"";case 106:return"CombatLog 1";case 107:return"CombatLog 0";case 108:return"CombatLog";case 109:return"defaultautoattack 1";case 110:return"defaultautoattack 0";case 111:return"unbind_all";case 112:return i?`unbind_local ${i}`:"unbind_local";case 113:return i&&a?`chan ${i} ${a.trim()}`:i?`chan ${i}`:"chan";case 114:return i?`unbind ${i}`:"unbind";case 115:return"GenSendMessage Doff_Recipe_Start_Action Clicked";case 116:return"number"==typeof n?`GenSliderSetNotch Doff_Recipe_Quantity_Slider ${n}`:"GenSliderSetNotch Doff_Recipe_Quantity_Slider 0";case 117:return"GenSendMessage Doff_Recipe_Actions_Starttask Clicked";case 118:return"LootRollNeed";case 119:return"LootRollGreed";case 120:return"LootRollPass";case 121:return"number"==typeof n&&"number"==typeof s?`trayelemdestroy ${n} ${s}`:"trayelemdestroy";case 122:return"number"==typeof n?`trayelemdestroy ${n} 0-9`:"trayelemdestroy";case 123:return"ScanForClickies";default:return""}}translatePhase12Activity(e){const t=e.activity||e.activityData?.activity;if("number"!=typeof t)return this.addWarning("Invalid activity data in Phase 1.2 translation",{activity:t,context:e.keyToken}),this.createUnknownActivityResult(t,e);const i=e.activityData||{},a=this.generateCycleAliases(t,i,e);return{commands:[`$${a.controllerAliasName}`],aliases:a.aliases,metadata:{type:"phase12_cycle",originalActivity:t,environment:e.environment,bindsetName:e.bindsetName,keyToken:e.keyToken,controllerAlias:a.controllerAliasName,stepAliases:a.aliases.length},success:!0}}generateCycleAliases(e,t,i){const a=this.sanitizeBindsetNameForAlias(i.bindsetName||"default"),n=this.sanitizeKeyToken(i.keyToken||"unknown"),s=`sto_kb_cycle_${i.environment}_${a}_${n}`,r=this.getPhase12CycleCommands(e,t);if(!r||0===r.length)return this.addWarning(`No cycle commands found for activity ${e}`,{keyToken:i.keyToken,environment:i.environment}),{controllerAliasName:s,aliases:[]};const o=[];for(let t=0;t<r.length;t++){const a=t+1,n=`${s}_${a}`,c=r[t],l=a===r.length?`${s}_1`:`${s}_${a+1}`,d=[];c.runAtFront&&c.runAtFront.length>0&&d.push(...c.runAtFront),c.forward&&c.forward.length>0&&d.push(...c.forward),d.push(`alias ${s} ${l}`),c.runAtEnd&&c.runAtEnd.length>0&&d.push(...c.runAtEnd),o.push({name:n,commands:d,description:`Cycle step ${a} for ${i.keyToken} (${i.environment})`,metadata:{type:"cycle_step",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,stepNumber:a,controllerAlias:s,nextStepAlias:l}})}return{controllerAliasName:s,aliases:[{name:s,commands:[`$${s}_1`],description:`Cycle controller for ${i.keyToken} (${i.environment})`,metadata:{type:"cycle_controller",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,totalSteps:r.length}},...o]}}getPhase12CycleCommands(e,t){const{text:i="",n1:a=0,n2:n=0,n3:s=0}=t;switch(e){case 14:return[{forward:[`+TrayExecByTray ${a} ${n}`],runAtFront:[],runAtEnd:[]},{forward:[`+TrayExecByTray ${a} ${s}`],runAtFront:[],runAtEnd:[]}];case 17:case 18:case 22:case 24:return[{forward:[`+TrayExecByTray ${a} ${n}`],runAtFront:[],runAtEnd:[]}];case 19:case 23:case 25:return[{forward:[`+TrayExecByTray ${a} ${s}`],runAtFront:[],runAtEnd:[]}];case 20:case 26:case 29:return[{forward:["+TrayExecByTrayStop"],runAtFront:[],runAtEnd:[]}];case 27:return[{forward:[`TraySetExecByTray ${a} ${n}`],runAtFront:[],runAtEnd:[]}];case 28:return[{forward:[`TraySetExecByTray ${a} ${s}`],runAtFront:[],runAtEnd:[]}];case 97:return i?i.split(/[,\s]+/).filter(e=>e.trim()).map(e=>({forward:[`emote_notext ${e.trim()}`],runAtFront:[],runAtEnd:[]})):[];case 101:return i?i.split(/[,\s]+/).filter(e=>e.trim()).map(e=>({forward:[`emote ${e.trim()}`],runAtFront:[],runAtEnd:[]})):[];default:return[]}}sanitizeBindsetNameForAlias(e=""){if(!e)return"default";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t=`bs_${t}`),t}sanitizeKeyToken(e=""){if(!e)return"unknown";const t={"[":"leftbracket","]":"rightbracket","(":"leftparen",")":"rightparen","{":"leftbrace","}":"rightbrace","<":"less",">":"greater","=":"equals","-":"minus","+":"_","\\":"backslash","/":"slash","|":"pipe","`":"backtick","~":"tilde","!":"exclamation","@":"at","#":"hash",$:"dollar","%":"percent","^":"caret","&":"ampersand","*":"asterisk","?":"question",":":"colon",";":"semicolon",'"':"quote","'":"apostrophe",",":"comma",".":"period"," ":"space"};let i=e.toLowerCase();for(const[e,a]of Object.entries(t)){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");i=i.replace(new RegExp(t,"g"),a)}return i=i.replace(/[^a-z0-9_]/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"),/^[0-9]/.test(i)&&(i=`k${i}`),i||"unknown"}translatePhase13Activity(e){const t=e.activity||e.activityData?.activity;if("number"!=typeof t)return this.addWarning("Invalid activity data in Phase 1.3 translation",{activity:t,context:e.keyToken}),this.createUnknownActivityResult(t,e);const i=e.activityData||{},a=this.generateInlineAlias(t,i,e);return{commands:a.commands,aliases:a.aliases,metadata:{type:"phase13_inline_alias",originalActivity:t,environment:e.environment,bindsetName:e.bindsetName,keyToken:e.keyToken,aliasName:a.aliasName,...a.metadata},success:!0}}generateInlineAlias(e,t,i){const{N1:a=0,N2:n=0}=t,s=this.sanitizeBindsetNameForAlias(i.bindsetName||"default"),r=this.sanitizeKeyToken(i.keyToken||"unknown");switch(e){case 15:{const t=a,n=`sto_kb_completetray_${i.environment}_${s}_${r}_tray${t}`,o=[];for(let e=0;e<=9;e++)o.push(`+TrayExecByTray ${t} ${e}`);return{commands:[`$${n}`],aliases:[{name:n,commands:o,description:`Complete tray execution for tray ${t} (KBF Activity 15)`,metadata:{type:"phase13_inline",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,trayIndex:t,totalSlots:10}}],aliasName:n,metadata:{type:"phase13_completetray",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,trayIndex:t,totalSlots:10,description:"CompleteTray alias - executes all slots on specified tray"}}}case 16:{const t=a,o=n,c=`sto_kb_traypower_${i.environment}_${s}_${r}_tray${t}_slot${o}`;return{commands:[`$${c}`],aliases:[{name:c,commands:[`+TrayExecByTray ${t} ${o}`],description:`Tray power execution for tray ${t}, slot ${o} (KBF Activity 16)`,metadata:{type:"phase13_inline",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,trayIndex:t,slotIndex:o}}],aliasName:c,metadata:{type:"phase13_traypower",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,trayIndex:t,slotIndex:o,description:"TrayPowerExec alias - executes specific tray slot power"}}}case 100:{const t=`sto_kb_assist_${i.environment}_${s}_${r}`;return{commands:[`$${t}`],aliases:[{name:t,commands:["assist {}$$assistcurrenttarget $target"],description:"Assist current target command chain (KBF Activity 100)",metadata:{type:"phase13_inline",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken}}],aliasName:t,metadata:{type:"phase13_assist",originalActivity:e,environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken,description:"AssistCurrentTarget alias - chains assist command to current target"}}}default:return this.addWarning(`Unknown Phase 1.3 activity: ${e}`),{commands:[],aliases:[],aliasName:null,metadata:{error:`Unknown Phase 1.3 activity: ${e}`}}}}createUnknownActivityResult(e,t){const i={commands:[],aliases:[],metadata:{type:"unknown",originalActivity:e,environment:t?.environment||"space",bindsetName:t?.bindsetName||"unknown",keyToken:t?.keyToken||"unknown",warnings:[`Activity ${e} translation not implemented or failed`,"This activity will be skipped but parsing will continue with other activities"],recoveryAction:"skipped",parseTimestamp:Date.now()},success:!1,error:`Activity translation failed: ${e}`,errorCategory:this.determineActivityErrorCategory(e),suggestion:this.getActivitySuggestion(e)};return e>96&&e<=123&&i.metadata.warnings.push(`High activity ID ${e} may indicate custom or future KBF format extension`),"number"!=typeof e&&i.metadata.warnings.push(`Invalid activity type: ${typeof e}, expected number`),i}determineActivityErrorCategory(e){return"number"!=typeof e?"invalid_type":e<0||e>123?"out_of_range":e>96?"future_extension":e>=30&&e<=96?"unimplemented_standard":"unknown_basic"}getActivitySuggestion(e){return"number"!=typeof e?"Activity IDs should be numeric values":e<0||e>123?"Valid activity IDs range from 0 to 123":e>96?"This may be from a newer KBF version or contain custom extensions":"This activity may not be implemented yet in the current parser version"}mapKeyToken(e,t={},i=null){if("string"!=typeof e)return this.addWarning("Invalid key token type: "+typeof e,{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"string",suggestion:"Key tokens should be string identifiers from the KBF specification"}),e;if(0===e.length)return this.addWarning("Empty key token provided",{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"non-empty string",suggestion:"Key tokens must have at least one character"}),"";/^[A-Za-z0-9_]+$/.test(e)||["SemiColon","Space"].includes(e)||this.addWarning(`Key token "${e}" contains unexpected characters`,{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"alphanumeric or special tokens (SemiColon, Space)",suggestion:"Key tokens should be alphanumeric according to KBF specification"}),0===this.keyTokenMap.size&&this.initializeKeyTokenMap();let a=e;if("SemiColon"===e)a=";";else if("Space"===e)a=" ";else{const t=this.keyTokenMap.get(e);t?a=t:(this.addWarning(`Unknown key token "${e}" will be used as-is`,{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"known key token",suggestion:"Key token may be from a newer KBF version or custom extension"}),a=e)}const n=this.validateAndSanitizeModifiers(t),s=[];n.control&&s.push("Ctrl"),n.alt&&s.push("Alt"),n.shift&&s.push("Shift"),a&&a.length>0?s.push(a):(s.push("UnknownKey"),this.addWarning('Mapped key token is empty, using fallback "UnknownKey"',{category:"validation",fieldName:"mappedToken",originalToken:e,mappedToken:a,suggestion:"Key token mapping resulted in empty value"}));const r=s.join("+");if(0===r.length)return this.addError("Canonical key generation failed - empty result",{category:"handler_error",severity:"error",originalToken:e,modifiers:n,mappedToken:a,recoverable:!0,suggestion:"Key generation failed but will continue with fallback"}),"UnknownKey";if(i&&"string"==typeof i&&i.trim().length>0)try{return this.processComboChord(r,i)}catch(e){return this.addError(`Combo chord processing failed: ${e.message}`,{category:"handler_error",severity:"warning",canonicalKey:r,combo:i,error:e.name,recoverable:!0,suggestion:"Combo chord processing failed, using base key without chord"}),r}return r}validateAndSanitizeModifiers(e){const t={control:!1,alt:!1,shift:!1};return e&&"object"==typeof e?(Object.keys(t).forEach(i=>{void 0!==e[i]&&("boolean"==typeof e[i]?t[i]=e[i]:1===e[i]||"1"===e[i]?t[i]=!0:0!==e[i]&&"0"!==e[i]&&e[i]?(this.addWarning(`Invalid ${i} modifier value: ${e[i]}, using false`,{category:"validation",fieldName:`modifiers.${i}`,actualValue:e[i],expectedValue:"boolean or 0/1",suggestion:`Modifier ${i} should be true/false or 0/1`}),t[i]=!1):t[i]=!1)}),t):(null!=e&&this.addWarning("Invalid modifiers object, using defaults",{category:"validation",fieldName:"modifiers",actualValue:e,expectedValue:"object with control/alt/shift boolean properties",suggestion:"Modifiers should be an object with boolean properties"}),t)}provideTokenFallback(e){const t=e.toLowerCase();return t.startsWith("f")&&/^\d+$/.test(t.slice(1))?e.toUpperCase():t.startsWith("numpad")?e.charAt(0).toUpperCase()+e.slice(1):t.includes("mouse")||t.includes("button")?"MouseButton":e.length<=3?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}initializeKeyTokenMap(){const e=new Map([["[","["],["\\\\","\\"],["]","]"],[",",","],["/","/"],[".","."],["`","`"],["ALT","Alt"],["LALT","Alt"],["RALT","Alt"],["Control","Ctrl"],["LCTRL","Ctrl"],["RCTRL","Ctrl"],["Shift","Shift"],["Down","ArrowDown"],["Left","ArrowLeft"],["Right","ArrowRight"],["Up","ArrowUp"],["F1","F1"],["F2","F2"],["F3","F3"],["F4","F4"],["F5","F5"],["F6","F6"],["F7","F7"],["F8","F8"],["F9","F9"],["F10","F10"],["F11","F11"],["F12","F12"],["F13","F13"],["F14","F14"],["F15","F15"],["F16","F16"],["F17","F17"],["F18","F18"],["F19","F19"],["F20","F20"],["F21","F21"],["F22","F22"],["F23","F23"],["F24","F24"],["Delete","Delete"],["End","End"],["Home","Home"],["Insert","Insert"],["PageDown","PageDown"],["PageUp","PageUp"],["Tab","Tab"],["enter","Enter"],["numpad0","Numpad0"],["numpad1","Numpad1"],["numpad2","Numpad2"],["numpad3","Numpad3"],["numpad4","Numpad4"],["numpad5","Numpad5"],["numpad6","Numpad6"],["numpad7","Numpad7"],["numpad8","Numpad8"],["numpad9","Numpad9"],["Decimal","NumpadDecimal"],["Divide","NumpadDivide"],["numpadenter","NumpadEnter"],["Add","+"],["Multiply","*"],["Subtract","-"],["A","A"],["B","B"],["C","C"],["D","D"],["E","E"],["F","F"],["G","G"],["H","H"],["I","I"],["J","J"],["K","K"],["L","L"],["M","M"],["N","N"],["O","O"],["P","P"],["Q","Q"],["R","R"],["S","S"],["T","T"],["U","U"],["V","V"],["W","W"],["X","X"],["Y","Y"],["Z","Z"],["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["Button1","Mouse1"],["Button2","Mouse2"],["Button3","Mouse3"],["Button4","Mouse4"],["Button5","Mouse5"],["Button6","Mouse6"],["Button7","Mouse7"],["Button8","Mouse8"],["Button9","Mouse9"],["Button10","Mouse10"],["Lbutton","MouseLeft"],["Middleclick","MouseMiddle"],["Rbutton","MouseRight"],["Wheelminus","MouseWheelDown"],["Wheelplus","MouseWheelUp"],["Joy1","XboxStart"],["Joy2","XboxBack"],["Joy3","XboxLThumb"],["Joy4","XboxRThumb"],["Joy5","XboxLB"],["Joy6","XboxRB"],["Joy7","XboxLT"],["Joy8","XboxRT"],["Joy9","XboxA"],["Joy10","XboxB"],["Joy11","XboxX"],["Joy12","XboxY"],["Lstick_up","XboxLStickUp"],["Lstick_down","XboxLStickDown"],["Lstick_left","XboxLStickLeft"],["Lstick_right","XboxLStickRight"],["Rstick_up","XboxRStickUp"],["Rstick_down","XboxRStickDown"],["Rstick_left","XboxRStickLeft"],["Rstick_right","XboxRStickRight"],["Joypad_up","XboxDPadUp"],["Joypad_down","XboxDPadDown"],["Joypad_left","XboxDPadLeft"],["Joypad_right","XboxDPadRight"]]);this.keyTokenMap=e}processCombo(e){if(!e)return this.addValidationError("comboData","combo data is required for combo processing",e,{fieldType:null===e?"null":"undefined",expectedValue:"string with Base64 encoded combo tokens",suggestion:"Combo data should be a string containing Base64 encoded tokens separated by *"}),[];if("string"!=typeof e)return this.addValidationError("comboData","must be a string value",e,{fieldType:typeof e,expectedValue:"string",suggestion:"Combo data should be a string containing Base64 encoded tokens"}),[];const t=e.trim();if(0===t.length)return this.addWarning("Combo data is empty after trimming",{category:"validation",fieldName:"comboData",actualValue:e,suggestion:"Combo data should contain at least one Base64 encoded token"}),[];!t.includes("*")&&t.length>50&&this.addWarning(`Combo data may be malformed: very long single token (${t.length} chars)`,{category:"format",fieldName:"comboData",dataLength:t.length,suggestion:"Combo data should contain Base64 tokens separated by * delimiters"});const i=t.split("*").filter(e=>e.length>0);if(0===i.length)return this.addWarning("No valid tokens found in combo data after splitting",{category:"format",fieldName:"comboData",originalData:e,suggestion:"Combo data should contain Base64 encoded tokens separated by * delimiters"}),[];i.length>10&&this.addWarning(`Large number of combo tokens (${i.length}) may indicate data corruption`,{category:"format",fieldName:"comboData",tokenCount:i.length,suggestion:"Typical combo chords have 2-5 tokens. Large numbers may indicate parsing errors."});const a=[];let n=0,s=0;for(let e=0;e<i.length;e++){const t=i[e].trim();if(0===t.length)continue;if(t.length<1){this.addWarning(`Combo token ${e} is empty`,{category:"validation",fieldName:"comboToken",tokenIndex:e,suggestion:"Empty tokens should be removed from combo data"});continue}if(t.length>100&&this.addWarning(`Combo token ${e} is unusually long (${t.length} chars)`,{category:"format",fieldName:"comboToken",tokenIndex:e,tokenLength:t.length,suggestion:"Combo tokens should typically be under 100 characters"}),!/^[A-Za-z0-9+/]*={0,2}$/.test(t)){s++,this.addDecodingError("combo token","Invalid Base64 format: contains invalid characters",{tokenIndex:e,token:t,tokenLength:t.length,recoverable:!0,suggestion:"Combo tokens should contain only valid Base64 characters (A-Z, a-z, 0-9, +, /, =)"});continue}const r=(t.match(/=/g)||[]).length;r>2&&this.addWarning(`Combo token ${e} has excessive Base64 padding (${r} equals signs)`,{category:"format",fieldName:"comboToken",tokenIndex:e,paddingCount:r,suggestion:"Base64 tokens should have at most 2 padding characters"});try{const i=atob(t);if(0===i.length){this.addWarning(`Combo token ${e} decoded to empty string`,{category:"decoding",fieldName:"comboToken",tokenIndex:e,originalToken:t,suggestion:"Token may contain only padding characters or be invalid"});continue}/^[\x20-\x7E]*$/.test(i)||this.addWarning(`Combo token ${e} decoded to non-printable characters`,{category:"validation",fieldName:"decodedComboToken",tokenIndex:e,decodedToken:i.slice(0,20),suggestion:"Decoded combo tokens should contain printable ASCII characters for key bindings"}),a.push(i),n++}catch(i){s++,this.addDecodingError("combo token",`${i.message} (token: ${t.slice(0,20)}${t.length>20?"...":""})`,{tokenIndex:e,token:t,tokenLength:t.length,errorType:i.name,critical:!1,recoverable:!0,suggestion:"Token may be corrupted or not properly Base64 encoded"})}}return s>0&&this.addWarning(`Combo processing completed with ${s} invalid tokens out of ${i.length} total`,{category:"processing_summary",fieldName:"comboData",totalTokens:i.length,validTokens:n,invalidTokens:s,successRate:`${Math.round(n/i.length*100)}%`,suggestion:"Some combo tokens were invalid but processing continued with valid tokens"}),0===n&&i.length>0&&this.addError("All combo tokens failed to decode",{category:"processing_summary",severity:"warning",totalTokens:i.length,suggestion:"Combo data may be corrupted or encoded incorrectly"}),a}processComboChord(e,t){if(!t||"string"!=typeof t)return e;if(0===t.trim().length)return e;const i=this.processCombo(t);return 0===i.length?e:`${e}+${i.join("+")}`}resetParseState(){this.parseState={currentLayer:0,processedBytes:0,totalBytes:0,errors:[],warnings:[]}}addError(e,t={}){const i={message:e,layer:this.parseState.currentLayer,timestamp:Date.now(),category:t.category||"general",severity:t.severity||"error",recoverable:!1!==t.recoverable,recordIndex:t.recordIndex,recordType:t.recordType,fieldName:t.fieldName,fieldType:t.fieldType,expectedValue:t.expectedValue,actualValue:t.actualValue,position:t.position,line:t.line,column:t.column,byteOffset:t.byteOffset,suggestion:t.suggestion,...t};if(delete i.category,delete i.severity,delete i.recoverable,delete i.recordIndex,delete i.recordType,delete i.fieldName,delete i.fieldType,delete i.expectedValue,delete i.actualValue,delete i.position,delete i.line,delete i.column,delete i.byteOffset,delete i.suggestion,this.parseState.errors.push(i),this.options.strictMode&&"critical"===i.severity)throw new Error(`KBF Parser Critical Error [Layer ${this.parseState.currentLayer} - ${i.category}]: ${e}`)}addWarning(e,t={}){const i={message:e,layer:this.parseState.currentLayer,timestamp:Date.now(),category:t.category||"general",severity:t.severity||"warning",recordIndex:t.recordIndex,recordType:t.recordType,fieldName:t.fieldName,fieldType:t.fieldType,expectedValue:t.expectedValue,actualValue:t.actualValue,suggestion:t.suggestion,...t};delete i.category,delete i.severity,delete i.recordIndex,delete i.recordType,delete i.fieldName,delete i.fieldType,delete i.expectedValue,delete i.actualValue,delete i.suggestion,this.parseState.warnings.push(i)}addValidationError(e,t,i,a={}){this.addError(`Validation failed for ${e}: ${t}`,{category:"validation",fieldName:e,actualValue:i,fieldType:typeof i,recoverable:!0,suggestion:a.suggestion,...a})}addDecodingError(e,t,i={}){this.addError(`${e} decoding failed: ${t}`,{category:"decoding",severity:i.critical?"critical":"error",recoverable:!i.critical,suggestion:`Check file integrity and format. ${i.suggestion||""}`,...i})}addFormatError(e,t,i={}){this.addError(`Format error in ${e}: ${t}`,{category:"format",recoverable:!0,suggestion:`Ensure ${e} follows KBF specification. ${i.suggestion||""}`,...i})}addUnknownElementWarning(e,t,i={}){this.addWarning(`Unknown ${e}: ${t}`,{category:"unknown_element",severity:"warning",suggestion:`This ${e} may be from a newer KBF version or custom extension. It will be skipped.`,...i})}reportProgress(e,t){this.options.enableProgressCallbacks&&this.options.onProgress&&this.options.onProgress({stage:e,progress:t,layer:this.parseState.currentLayer,errors:this.parseState.errors.length,warnings:this.parseState.warnings.length})}isValidBase64(e){try{return btoa(atob(e))===e}catch(e){return!1}}safeBase64Decode(e,t={}){if(!e)return this.addValidationError("base64String","Base64 string is required for decoding",e,{fieldType:null===e?"null":"undefined",expectedValue:"string containing Base64 encoded data",suggestion:"Base64 strings cannot be null or undefined",...t}),"";if("string"!=typeof e)return this.addValidationError("base64String","must be a string value",e,{fieldType:typeof e,expectedValue:"string containing Base64 encoded data",suggestion:"Provide a string with valid Base64 encoded content",...t}),"";const i=e.trim();if(0===i.length)return this.addWarning("Base64 string is empty after trimming",{category:"validation",fieldName:"base64String",actualValue:e,suggestion:"Base64 strings should contain encoded data",...t}),"";const a=/^[A-Za-z0-9+/]*={0,2}$/;if(!a.test(i))return this.addDecodingError("Base64 format","String contains invalid Base64 characters",{stringLength:i.length,invalidChars:i.replace(a.source,"").slice(0,20),preview:i.slice(0,50),recoverable:!1,suggestion:"Ensure string contains only valid Base64 characters: A-Z, a-z, 0-9, +, /, and = for padding",...t}),"";const n=(i.match(/=/g)||[]).length;n>2&&this.addWarning(`Base64 string has excessive padding: ${n} equals signs`,{category:"format",fieldName:"base64String",paddingCount:n,stringLength:i.length,suggestion:"Base64 strings should have at most 2 padding characters at the end",...t});const s=i.indexOf("=");if(-1!==s&&s!==i.lastIndexOf("=")&&(i.slice(0,s)+i.slice(s).replace(/=/g,"")).includes("=")&&this.addWarning("Base64 string has padding in non-trailing position",{category:"format",fieldName:"base64String",firstPaddingIndex:s,suggestion:"Base64 padding should only appear at the end of the string",...t}),i.length%4!=0)return this.addDecodingError("Base64 format",`String length ${i.length} is not a multiple of 4`,{stringLength:i.length,remainder:i.length%4,suggestion:"Base64 strings must have a length that is a multiple of 4",recoverable:!1,...t}),"";i.length>1e6&&this.addWarning(`Base64 string is very large: ${i.length} characters`,{category:"performance",fieldName:"base64String",stringLength:i.length,suggestion:"Very large Base64 strings may cause memory issues. Consider chunking or streaming.",...t});try{const e=atob(i);return!e&&i.length>0?(this.addDecodingError("Base64 decoding","Decoded to empty string despite non-empty input",{inputLength:i.length,suggestion:"Input may contain only padding characters or be corrupted",recoverable:!0,...t}),""):(e&&/^[\0]+$/.test(e)&&this.addWarning("Base64 decoded to null bytes only",{category:"data_quality",fieldName:"decodedString",decodedLength:e.length,suggestion:"Decoded data may be corrupted or contain only padding",...t}),e)}catch(e){return this.addDecodingError("Base64",`${e.name}: ${e.message}`,{stringLength:i.length,errorType:e.name,errorMessage:e.message,preview:i.slice(0,50),recoverable:!1,critical:!1,suggestion:"Check Base64 string format and integrity. Common issues include invalid characters, incorrect padding, or corruption.",...t}),""}}safeUtf8Decode(e,t={}){if(!e)return this.addValidationError("bytes","UTF-8 byte array is required for decoding",e,{fieldType:null===e?"null":"undefined",expectedValue:"Uint8Array containing UTF-8 encoded bytes",suggestion:"UTF-8 byte arrays cannot be null or undefined",...t}),"";if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))return this.addValidationError("bytes","must be a Uint8Array or ArrayBuffer",e,{fieldType:typeof e,constructorName:e?.constructor?.name,expectedValue:"Uint8Array or ArrayBuffer containing UTF-8 encoded data",suggestion:"Provide UTF-8 data as a Uint8Array or convert from other formats",...t}),"";const i=e instanceof ArrayBuffer?new Uint8Array(e):e;if(0===i.length)return this.addWarning("UTF-8 byte array is empty",{category:"validation",fieldName:"bytes",actualLength:0,suggestion:"UTF-8 byte arrays should contain encoded data",...t}),"";i.length>1e7&&this.addWarning(`UTF-8 byte array is very large: ${i.length} bytes`,{category:"performance",fieldName:"bytes",arrayLength:i.length,suggestion:"Large UTF-8 data may cause memory issues. Consider chunking or streaming.",...t});const a=this.analyzeUtf8Bytes(i);a.hasIssues&&this.addWarning("UTF-8 byte array contains potentially problematic patterns",{category:"data_quality",fieldName:"bytes",...a,suggestion:"Data may contain corruption or invalid UTF-8 sequences",...t});try{const e=new TextDecoder("utf-8",{fatal:this.options.validateUtf8}).decode(i);return!e&&i.length>0&&this.addDecodingError("UTF-8","Decoded to empty string despite non-empty byte array",{inputLength:i.length,bytePreview:Array.from(i.slice(0,16)).map(e=>`0x${e.toString(16).padStart(2,"0")}`).join(" "),suggestion:"Byte array may contain only null bytes or invalid UTF-8 sequences",recoverable:!0,...t}),e&&this.validateDecodedUtf8Content(e,t),e}catch(e){this.addDecodingError("UTF-8",`${e.name}: ${e.message}`,{errorType:e.name,errorMessage:e.message,inputLength:i.length,bytePreview:Array.from(i.slice(0,16)).map(e=>`0x${e.toString(16).padStart(2,"0")}`).join(" "),recoverable:!0,critical:!1,suggestion:"UTF-8 data contains invalid sequences. Attempting fallback decoding.",...t});try{const a=new TextDecoder("utf-8",{fatal:!1}).decode(i);if(a&&a.length>0)return this.addWarning("UTF-8 fallback decoding succeeded with replacement characters",{category:"recovery",fieldName:"bytes",originalError:e.message,fallbackLength:a.length,suggestion:"Invalid UTF-8 sequences were replaced with Unicode replacement characters (ï¿½)",...t}),a;this.addDecodingError("UTF-8 fallback","Even fallback decoding produced empty result",{inputLength:i.length,critical:!1,recoverable:!0,suggestion:"Data may be severely corrupted or not UTF-8 encoded",...t})}catch(i){this.addDecodingError("UTF-8 fallback",`Complete UTF-8 decoding failure: ${i.message}`,{originalError:e.message,fallbackError:i.message,fallbackErrorType:i.name,critical:!0,recoverable:!1,suggestion:"Byte array cannot be decoded as UTF-8 and may be corrupted or in a different encoding",...t})}return""}}analyzeUtf8Bytes(e){const t={hasIssues:!1,nullBytes:0,highAsciiBytes:0,invalidUtf8Sequences:0,controlChars:0,binaryDataRatio:0};let i=0;for(;i<e.length;){const a=e[i];if(0===a&&t.nullBytes++,a>127&&t.highAsciiBytes++,a<32&&9!==a&&10!==a&&13!==a&&t.controlChars++,a>244)t.invalidUtf8Sequences++;else if(a>=240){if(i+3>=e.length||!this.isValidUtf8Continuation(e,i+1,3)){t.invalidUtf8Sequences++,i+=4;continue}i+=4}else if(a>=224){if(i+2>=e.length||!this.isValidUtf8Continuation(e,i+1,2)){t.invalidUtf8Sequences++,i+=3;continue}i+=3}else if(a>=192){if(i+1>=e.length||!this.isValidUtf8Continuation(e,i+1,1)){t.invalidUtf8Sequences++,i+=2;continue}i+=2}else i++}return t.binaryDataRatio=e.length>0?t.highAsciiBytes/e.length:0,t.hasIssues=t.nullBytes>.1*e.length||t.invalidUtf8Sequences>0||t.binaryDataRatio>.8,t}isValidUtf8Continuation(e,t,i){for(let a=0;a<i;a++)if(t+a>=e.length||128!=(192&e[t+a]))return!1;return!0}validateDecodedUtf8Content(e,t){const i=Array.from(e).filter(e=>{const t=e.charCodeAt(0);return t>=0&&t<=8||11===t||12===t||t>=14&&t<=31||127===t}).length;i>.05*e.length&&this.addWarning(`Decoded UTF-8 content contains many control characters: ${i}`,{category:"data_quality",fieldName:"decodedContent",controlCharCount:i,contentLength:e.length,controlCharRatio:`${Math.round(i/e.length*100)}%`,suggestion:"Content may contain binary data or control characters that are not typical for text",...t});const a=(e.match(/\uFFFD/g)||[]).length;a>0&&this.addWarning(`Decoded UTF-8 content contains ${a} replacement characters`,{category:"data_quality",fieldName:"decodedContent",replacementCharCount:a,suggestion:"Some characters could not be properly decoded and were replaced with ï¿½",...t});const n=(e.match(/[\x20-\x7E]/g)||[]).length,s=e.length>0?n/e.length:0;s<.3&&e.length>10&&this.addWarning("Decoded UTF-8 content appears to be binary data",{category:"data_quality",fieldName:"decodedContent",printableRatio:`${Math.round(100*s)}%`,suggestion:"Content may not be valid text data or may be encoded incorrectly",...t})}initializeParsing(){this.parseState={currentLayer:0,processedBytes:0,totalBytes:0,errors:[],warnings:[],progressCallback:null}}buildParseResult(){return{bindsets:{},aliases:{},errors:[...this.parseState.errors],warnings:[...this.parseState.warnings],stats:{totalBindsets:0,totalKeys:0,totalAliases:0,processedLayers:[],skippedActivities:0},parsingState:this.getParsingStatistics()}}generateErrorSummary(){const e={totalErrors:this.parseState.errors.length,totalWarnings:this.parseState.warnings.length,errorsByCategory:{},errorsByLayer:{},errorsBySeverity:{critical:0,error:0,warning:0},warningsByCategory:{},warningsByLayer:{},recoverableErrors:0,nonRecoverableErrors:0,hasCriticalErrors:!1,suggestions:[],recoveryActions:[]};return this.parseState.errors.forEach(t=>{const i=t.category||"general",a=t.layer||"unknown",n=t.severity||"error",s=!1!==t.recoverable;e.errorsByCategory[i]=(e.errorsByCategory[i]||0)+1,e.errorsByLayer[a]=(e.errorsByLayer[a]||0)+1,e.errorsBySeverity[n]=(e.errorsBySeverity[n]||0)+1,s?e.recoverableErrors++:e.nonRecoverableErrors++,"critical"===n&&(e.hasCriticalErrors=!0),t.suggestion&&e.suggestions.push(t.suggestion)}),this.parseState.warnings.forEach(t=>{const i=t.category||"general",a=t.layer||"unknown";e.warningsByCategory[i]=(e.warningsByCategory[i]||0)+1,e.warningsByLayer[a]=(e.warningsByLayer[a]||0)+1,t.suggestion&&e.suggestions.push(t.suggestion)}),e.recoveryActions=this.generateRecoveryActions(e),e.suggestions=[...new Set(e.suggestions)],e}generateRecoveryActions(e){const t=[];e.hasCriticalErrors&&t.push({type:"critical",action:"file_format_issues",description:"Critical errors detected - file format may be corrupted",suggestion:"Verify file integrity and source. Consider obtaining a fresh copy of the KBF file."}),e.errorsByCategory.decoding>0&&t.push({type:"decoding",action:"base64_utf8_issues",description:`${e.errorsByCategory.decoding} decoding errors found`,suggestion:"Check file encoding. File may be corrupted or encoded in an unexpected format."}),e.errorsByCategory.validation>5&&t.push({type:"validation",action:"data_validation_failures",description:`${e.errorsByCategory.validation} validation errors`,suggestion:"Multiple data validation failures. File may be from an incompatible KBF version or corrupted."}),e.warningsByCategory.unknown_element>0&&t.push({type:"unknown_elements",action:"version_compatibility",description:`${e.warningsByCategory.unknown_element} unknown elements found`,suggestion:"File may contain elements from a newer KBF version. Consider updating the parser."}),e.errorsByLayer[1]>0&&t.push({type:"layer_specific",action:"layer_1_issues",description:"Layer 1 (Base64) decoding issues",suggestion:"File may not be a valid KBF file or may be severely corrupted."});const i=e.totalErrors>0?Math.round(e.recoverableErrors/e.totalErrors*100):100;return i<50&&t.push({type:"overall_health",action:"low_success_rate",description:`Low recovery rate: ${i}% of errors are recoverable`,suggestion:"Consider using a different file or checking file integrity."}),t}attemptErrorRecovery(e={}){const t={recovered:!1,appliedStrategies:[],modifications:{},success:!1,message:""},i=this.generateErrorSummary();if(i.errorsByCategory.decoding>0&&e.enableBase64Recovery){const e=this.attemptBase64Recovery();e.success&&(t.appliedStrategies.push("base64_fix"),t.modifications.base64=e.fixes)}if(i.warningsByCategory.data_quality>0&&e.enableUtf8Recovery){const e=this.attemptUtf8Recovery();e.success&&(t.appliedStrategies.push("utf8_fix"),t.modifications.utf8=e.fixes)}if(i.warningsByCategory.unknown_element>0&&e.enableTokenRecovery){const e=this.attemptTokenRecovery();e.success&&(t.appliedStrategies.push("token_fix"),t.modifications.tokens=e.fixes)}return t.recovered=t.appliedStrategies.length>0,t.success=t.recovered,t.success?t.message=`Applied ${t.appliedStrategies.length} recovery strategies`:t.message="No recovery strategies were applicable or successful",t}attemptBase64Recovery(){return{success:!1,fixes:[],message:"Base64 recovery not implemented yet"}}attemptUtf8Recovery(){return{success:!1,fixes:[],message:"UTF-8 recovery not implemented yet"}}attemptTokenRecovery(){return{success:!1,fixes:[],message:"Token recovery not implemented yet"}}getParsingStatistics(){const e=this.generateErrorSummary();return{layer:this.parseState.currentLayer,processedBytes:this.parseState.processedBytes,totalBytes:this.parseState.totalBytes,errors:e.totalErrors,warnings:e.totalWarnings,criticalErrors:e.errorsBySeverity.critical,recoverableErrors:e.recoverableErrors,nonRecoverableErrors:e.nonRecoverableErrors,healthScore:this.calculateHealthScore(e),completionEstimate:this.calculateCompletionEstimate(),recommendations:this.getRecommendations(e)}}calculateHealthScore(e){let t=100;return t-=5*e.totalErrors,t-=1*e.totalWarnings,t-=e.hasCriticalErrors?50:0,t-=20*e.errorsBySeverity.critical,e.recoverableErrors>0&&(t+=Math.min(10,2*e.recoverableErrors)),Math.max(0,Math.min(100,t))}calculateCompletionEstimate(){if(0===this.parseState.currentLayer)return 0;if(this.parseState.currentLayer>=6)return 100;const e=this.parseState.currentLayer/6*100,t=Math.min(20,2*this.parseState.errors.length);return Math.max(0,e-t)}getRecommendations(e){const t=[];return e.hasCriticalErrors&&t.push("Stop parsing and report critical errors"),e.errorsByCategory.decoding>.5*e.totalErrors&&t.push("File may be corrupted - verify source and integrity"),e.errorsByCategory.validation>10&&t.push("Consider using a different file or checking file format compatibility"),e.warningsByCategory.unknown_element>.3*e.totalWarnings&&t.push("File may be from a newer KBF version - consider updating parser"),e.recoverableErrors>.8*e.totalErrors&&t.push("Most errors are recoverable - continue parsing with recovery enabled"),t}}class Me extends oe{constructor({eventBus:e,storage:t,i18n:i,ui:a}={}){super(e),this.componentName="ImportService",this.storage=t,this.i18n=i,this.ui=a,this.kbfParser=new Pe}setupRequestHandlers(){this.eventBus&&(this.respond("import:keybind-file",({content:e,profileId:t,environment:i,options:a={}})=>this.importKeybindFile(e,t,i,a)),this.respond("import:alias-file",({content:e,profileId:t,options:i={}})=>this.importAliasFile(e,t,i)),this.respond("import:kbf-file",({content:e,profileId:t,environment:i,options:a={}})=>this.importKBFFile(e,t,i,a)),this.respond("import:project-file",({content:e,options:t={}})=>this.importProjectFile(e,t)),this.respond("import:from-file",({file:e})=>this.importFromFile(e)),this.respond("import:validate-keybind-file",({content:e})=>this.validateKeybindFile(e)),this.respond("import:validate-kbf-file",({content:e})=>this.validateKBFFile(e)))}async parseKeybindFile(e){const t={},i=[];if(!e||"string"!=typeof e)return{keybinds:t,errors:["Invalid file content"]};const a=e.split("\n");for(let e=0;e<a.length;e++){const n=a[e].trim();if(n&&!n.startsWith(";")&&!n.startsWith("#"))try{const a=n.match(/^(\S+)\s+"([^"]+)"/);if(a){const[,e,i]=a,n=ke(e),s=await this.request("parser:parse-command-string",{commandString:i});t[n]={raw:i,commands:s.commands};continue}if(n.startsWith("alias "))continue;n.length>0&&i.push(`Line ${e+1}: Unrecognized format: ${n}`)}catch(t){i.push(`Line ${e+1}: Parse error: ${t.message}`)}}return{keybinds:t,errors:i}}async parseAliasFile(e){const t={},i=[];if(!e||"string"!=typeof e)return{aliases:t,errors:["Invalid file content"]};const a=e.split("\n");for(let e=0;e<a.length;e++){const n=a[e].trim();if(n&&!n.startsWith(";")&&!n.startsWith("#"))try{const a=n.match(/^alias\s+(\w+)\s+"([^"]+)"/);if(a){const[,e,i]=a;t[e]={commands:i};continue}const s=n.match(/^alias\s+(\w+)\s+<&\s*(.+?)\s*&>/);if(s){const[,e,i]=s;t[e]={commands:i};continue}if(n.match(/^[A-Z]\d+\s+"[^"]+"/))continue;n.length>0&&i.push(`Line ${e+1}: Unrecognized alias format: ${n}`)}catch(t){i.push(`Line ${e+1}: Parse error: ${t.message}`)}}return{aliases:t,errors:i}}async importKeybindFile(e,t,i,a={}){try{const a=await this.parseKeybindFile(e),n=Object.keys(a.keybinds).length;if(0===n)return{success:!1,error:"no_keybinds_found_in_file"};if(!this.storage)return{success:!1,error:"storage_not_available"};if(!t)return{success:!1,error:"no_active_profile"};const s=["space","ground"];if(i){if(!s.includes(i))return{success:!1,error:"invalid_environment",params:{environment:i,validEnvironments:s}}}else console.warn("[ImportService] No environment specified for keybind import, defaulting to space"),i="space";const r=this.storage.getProfile(t)||{builds:{space:{keys:{}},ground:{keys:{}}}};r.builds||(r.builds={space:{keys:{}},ground:{keys:{}}});const o=i;r.builds[o]||(r.builds[o]={keys:{}});const c=r.builds[o].keys;for(const[e,t]of Object.entries(a.keybinds)){const i=t.raw;if((await this.request("parser:parse-command-string",{commandString:i})).isMirrored){const t=this.extractOriginalFromMirrored(i),a=_e((await this.request("parser:parse-command-string",{commandString:t.join(" $$ ")})).commands),n=[];for(const e of a){const t=await ye(e,{eventBus:this.eventBus});n.push(t)}c[e]=n,r.keybindMetadata||(r.keybindMetadata={}),r.keybindMetadata[o]||(r.keybindMetadata[o]={}),r.keybindMetadata[o][e]||(r.keybindMetadata[o][e]={}),r.keybindMetadata[o][e].stabilizeExecutionOrder=!0}else{const i=_e(t.commands),a=[];for(const e of i){const t=await ye(e,{eventBus:this.eventBus});a.push(t)}c[e]=a}}return this.storage.saveProfile(t,r),this.emit("profile:updated",{profileId:t,profile:r,environment:o}),"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,imported:{keys:n},errors:a.errors,message:"import_completed_keybinds"}}catch(e){return{success:!1,error:"import_failed",params:{reason:e.message}}}}async importAliasFile(e,t,i={}){try{const i=await this.parseAliasFile(e),a=Object.keys(i.aliases).filter(e=>!e.startsWith("sto_kb_")).length;if(0===a)return{success:!1,error:"no_aliases_found_in_file"};if(!this.storage||!t)return{success:!1,error:"no_active_profile"};const n=this.storage.getProfile(t)||{aliases:{}};n.aliases||(n.aliases={});for(const[e,t]of Object.entries(i.aliases)){if(e.startsWith("sto_kb_")){console.log(`[ImportService] Skipping generated alias: ${e}`);continue}const i=t.commands||"",a=i.trim()?i.trim().split(/\s*\$\$\s*/).filter(e=>e.trim()):[],s=[];for(const e of a){const t=await ye(e,{eventBus:this.eventBus});s.push(t)}n.aliases[e]={commands:s,description:t.description||""}}return this.storage.saveProfile(t,n),this.emit("profile:updated",{profileId:t,profile:n}),"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,imported:{aliases:a},errors:i.errors,message:"import_completed_aliases"}}catch(e){return{success:!1,error:"import_failed",params:{reason:e.message}}}}async importKBFFile(e,t,i,a={}){const n={startTime:Date.now(),profileId:t,environment:i,options:a,errors:[],warnings:[],layerErrors:{1:[],2:[],3:[],4:[],5:[],6:[]},recoveryActions:[],originalProfile:null,transactionInProgress:!1,lastProgressMessage:null,processedBindsets:new Set,failedBindsets:new Set};try{if(!e||"string"!=typeof e)return n.errors.push({message:"Invalid KBF file content: expected string data",phase:"validation",layer:"input",recoverable:!1,context:{contentType:typeof e}}),this.buildKBFErrorResult(n,"invalid_kbf_file_content",{reason:"File content validation failed"});if(!this.storage)return n.errors.push({message:"Storage service not available for KBF import",phase:"initialization",layer:"service",recoverable:!1}),this.buildKBFErrorResult(n,"storage_not_available",{});if(!t)return n.errors.push({message:"No active profile specified for KBF import",phase:"initialization",layer:"profile",recoverable:!1}),this.buildKBFErrorResult(n,"no_active_profile",{});const s=["space","ground"];if(i){if(!s.includes(i))return n.errors.push({message:`Invalid environment "${i}" specified for KBF import`,phase:"validation",layer:"environment",recoverable:!1,context:{providedEnvironment:i,validEnvironments:s}}),this.buildKBFErrorResult(n,"invalid_environment",{environment:i,validEnvironments:s})}else console.warn("[ImportService] No environment specified for KBF import, defaulting to space"),i="space",n.warnings.push({message:"No environment specified, defaulting to space",phase:"initialization",layer:"environment",recoverable:!0,context:{defaultEnvironment:i}});n.originalProfile=this.storage.getProfile(t),n.transactionInProgress=!0,n.lastProgressMessage="Validating KBF file format";const r=this.kbfParser.validateFormat(e);if(r.errors&&(r.errors.forEach(e=>{n.layerErrors.validation=n.layerErrors.validation||[],n.layerErrors.validation.push({message:e,timestamp:Date.now(),recoverable:!0,context:{phase:"format_validation"}})}),n.errors.push(...r.errors.map(e=>({message:e,phase:"validation",layer:"format",recoverable:!0})))),r.warnings&&n.warnings.push(...r.warnings.map(e=>({message:e,phase:"validation",layer:"format"}))),!r.isValid)return this.buildKBFErrorResult(n,"invalid_kbf_file_format",{validationErrors:r.errors,validationWarnings:r.warnings});if(r.isLegacy)return n.errors.push({message:"Legacy KEY-only KBF files are not supported",phase:"validation",layer:"format",recoverable:!1,context:{format:r.format,reason:"Legacy KEY-only format not supported"}}),this.buildKBFErrorResult(n,"legacy_kbf_format_not_supported",{message:"Legacy KEY-only KBF files are not supported. Please use a modern KBF file with KEYSET structure.",validationErrors:r.errors,validationWarnings:r.warnings});if(!r.isKBF)return n.errors.push({message:"KBF file does not contain valid KEYSET records",phase:"validation",layer:"format",recoverable:!1,context:{format:r.format}}),this.buildKBFErrorResult(n,"no_keyset_records_found",{message:"KBF file does not contain valid KEYSET records. Only KEYSET-based KBF files are supported.",format:r.format,validationWarnings:r.warnings});const o=a.onProgress||((e,t)=>{console.log(`[ImportService] KBF parsing progress - Layer ${e}: ${t}`),n.currentLayer=e,n.lastProgressMessage=t});n.lastProgressMessage="Parsing KBF file layers";const c=await this.kbfParser.parseFile(e,{onProgress:o,targetEnvironment:i||"space",includeMetadata:!0});if(c.errors&&c.errors.forEach(e=>{const t=e.layer||"unknown";n.layerErrors[t]||(n.layerErrors[t]=[]),n.layerErrors[t].push({message:e.message,timestamp:e.timestamp||Date.now(),recoverable:!1!==e.recoverable,recordIndex:e.recordIndex,context:e.context}),n.errors.push({message:`Layer ${t} error: ${e.message}`,phase:"parsing",layer:t,recoverable:!1!==e.recoverable,context:{recordIndex:e.recordIndex,...e.context}})}),c.warnings&&n.warnings.push(...c.warnings.map(e=>({message:e.message||e,phase:"parsing",layer:e.layer||"unknown",context:e.context}))),0===c.stats.totalBindsets)return n.errors.push({message:"KBF file contains no valid bindsets that could be imported",phase:"validation",layer:"results",recoverable:!1,context:{totalBindsets:c.stats.totalBindsets,processedLayers:c.stats.processedLayers}}),this.buildKBFErrorResult(n,"no_valid_bindsets_found",{message:"KBF file contains no valid bindsets that could be imported.",parserErrors:c.errors,parserWarnings:c.warnings});n.lastProgressMessage="Processing KBF data and updating profile";let l=this.createEnhancedProfileStructure(n,t);const d=i,m=await this.processKBFBindsetsAtomic(n,l,c,d,a);if(!m.success)return this.rollbackAndBuildError(n,m.errorType,m.errorParams);l=m.profile;const{totalKeysImported:h,totalAliasesImported:u,hasPrimaryBindset:p,masterBindsetName:f,actualBindsetsProcessed:y,isSingleBindsetFile:_,onlyBindsetIsMaster:g,requiresBindsetSelection:b}=m.stats;try{n.lastProgressMessage="Saving profile with atomic transaction",this.atomicSaveProfile(n,t,l),n.transactionInProgress=!1,n.recoveryActions.push({action:"profile_saved",description:"Successfully saved profile with KBF import data",profileId:t,timestamp:Date.now()}),this.emit("profile:updated",{profileId:t,profile:l,environment:d}),"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0)}catch(e){try{n.originalProfile&&(this.storage.saveProfile(t,n.originalProfile),n.recoveryActions.push({action:"profile_rollback",description:"Successfully rolled back profile due to save failure",profileId:t,recoverable:!1}))}catch(i){n.errors.push({message:`Critical: Failed to rollback profile after save failure: ${i.message}`,phase:"rollback",layer:"critical",recoverable:!1,context:{profileId:t,originalError:e.message}})}return this.rollbackAndBuildError(n,"profile_save_failed",{originalError:e.message,profileId:t})}n.lastProgressMessage="Processing global aliases",await this.processGlobalAliasesAtomic(n,l,c),n.lastProgressMessage="Processing LoadBindSet activities";const v=this.processLoadBindSetActivities(c,d);if(v.aliases&&Object.keys(v.aliases).length>0)for(const[e,t]of Object.entries(v.aliases))try{const i=_e(t.commands||[]),a=[];for(const e of i){const t=await ye(e,{eventBus:this.eventBus});a.push(t)}const n={...t.metadata,type:"bindset_loader",environment:d,isLoaderAlias:!0,createdAt:(new Date).toISOString(),bindsetLoaderInfo:{targetBindset:t.metadata?.targetBindset,sourceBindset:t.metadata?.sourceBindset,sourceKey:t.metadata?.sourceKey,originalFilename:t.metadata?.originalFilename}};l.aliases[e]={commands:a,description:t.description||"",metadata:n},u+=1;const s=t.metadata?.targetBindset;s&&l.bindsetMetadata[s]&&(l.bindsetMetadata[s][d].loaderAliases||(l.bindsetMetadata[s][d].loaderAliases={}),l.bindsetMetadata[s][d].loaderAliases[e]={sourceKey:t.metadata?.sourceKey,sourceBindset:t.metadata?.sourceBindset,originalFilename:t.metadata?.originalFilename,createdAt:(new Date).toISOString()})}catch(i){n.errors.push({message:`Failed to process loader alias "${e}": ${i.message}`,phase:"loader_alias_processing",layer:"processing",recoverable:!0,context:{aliasName:e,aliasData:t}})}v.warnings&&v.warnings.length>0&&n.warnings.push(...v.warnings.map(e=>({message:e,phase:"bindset_resolution",layer:"processing",recoverable:!0})));try{n.lastProgressMessage="Final profile save with all imported data",this.atomicSaveProfile(n,t,l),n.transactionInProgress=!1}catch(e){return this.rollbackAndBuildError(n,"final_profile_save_failed",{originalError:e.message,profileId:t})}const w=Date.now()-n.startTime;return n.recoveryActions.push({action:"import_completed",description:"KBF import completed successfully",profileId:t,totalBindsets:y,totalKeys:h,totalAliases:u,processingTime:w,timestamp:Date.now()}),{success:!0,message:"kbf_import_completed",imported:{bindsets:y,keys:h,aliases:u,failedBindsets:n.failedBindsets.size},stats:{processedLayers:c.stats.processedLayers,skippedActivities:c.stats.skippedActivities,totalActivities:c.stats.totalActivities||0,totalErrors:n.errors.length,totalWarnings:n.warnings.length,processingTimeMs:w},errors:n.errors,warnings:n.warnings,layerErrors:n.layerErrors,recoveryActions:n.recoveryActions,bindsetNames:Object.keys(c.bindsets),processedBindsets:Array.from(n.processedBindsets),failedBindsets:Array.from(n.failedBindsets),masterBindset:{hasMasterBindset:p,masterBindsetName:f,mappedToPrimary:p,displayName:p?"Primary Bindset":null},singleBindsetFile:{isSingleBindset:_,onlyBindsetIsMaster:g,requiresBindsetSelection:b,totalBindsetsAvailable:c.stats.totalBindsets,selectedBindsetsCount:y}}}catch(e){return this.rollbackAndBuildError(n,"kbf_import_critical_error",{originalError:e.message,stack:e.stack,currentPhase:n.lastProgressMessage||"unknown",processedBindsets:n.processedBindsets.size,failedBindsets:n.failedBindsets.size})}}async importProjectFile(e,t={}){try{const i=JSON.parse(e);if(!i.data||"project"!==i.type)return{success:!1,error:"invalid_project_file"};const a=i.data;let n=0,s=!1;if(a.profiles)for(const[e,t]of Object.entries(a.profiles)){const i=this.sanitizeProfileData(t);this.storage.saveProfile(e,i),n++}if(a.settings&&!1!==t.importSettings){const e=this.storage.getSettings()||{},t={...e,...a.settings,version:e.version||a.settings.version,firstRun:e.firstRun};this.storage.saveSettings(t),s=!0}return"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,message:"project_imported_successfully",imported:{profiles:n,settings:s},currentProfile:a.settings?.currentProfile||null}}catch(e){return{success:!1,error:"import_failed_invalid_json",params:{reason:e.message}}}}async importFromFile(e){const t=await e.text(),i=e.name.toLowerCase();if(!i.endsWith(".json")){if(i.endsWith(".txt")){const e=this.getCurrentProfileId();if(!e)throw new Error(this.i18n.t("no_profile_selected_for_import"));return this.importKeybindFile(t,e)}throw new Error(this.i18n.t("import_failed_unsupported_format"))}try{const e=JSON.parse(t);if("project"===e.type)return this.importProjectFile(t);if(e.name)return this.importProfileFile(t);throw new Error("Unknown JSON file format")}catch(e){throw new Error(this.i18n.t("import_failed_invalid_json"))}}async validateKeybindFile(e){try{const t=await this.parseKeybindFile(e);return{valid:!0,stats:{keybinds:Object.keys(t.keybinds).length,aliases:Object.keys(t.aliases).length,errors:t.errors.length},errors:t.errors}}catch(e){return{valid:!1,error:e.message}}}validateKBFFile(e){try{if(!e||"string"!=typeof e)return{valid:!1,error:"Invalid file content: expected string",errors:["No content provided for validation"]};const t=this.kbfParser.validateFormat(e);return{valid:t.isValid,format:t.format,isKBF:t.isKBF,isLegacy:t.isLegacy,stats:{estimatedSize:t.estimatedSize,estimatedKeysets:t.estimatedKeysets,processingTime:t.processingTime,errors:t.errors.length,warnings:t.warnings.length},errors:t.errors,warnings:t.warnings,supportedFormat:t.isKBF&&!t.isLegacy,rejectionReason:t.isLegacy?"Legacy KEY-only format not supported":t.isKBF?null:"No valid KEYSET records found"}}catch(e){return{valid:!1,error:`KBF validation error: ${e.message}`,errors:[e.message]}}}processLoadBindSetActivities(e,t){const i={},a=[],n=(e="")=>{if(!e)return"";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t=`bs_${t}`),t},s=(e,t,i)=>t&&"Primary Bindset"!==t?`sto_kb_${e}_${n(t)}_${i}`:`sto_kb_${e}_${i}`,r=(e,t)=>{if(!e)return null;const i=e.split(/[/\\]/).pop().replace(/\.[^/.]+$/,""),a=i.match(/^.*C_(.+)$/);if(a){const e=a[1],i=t.find(t=>t.toLowerCase()===e.toLowerCase());if(i)return i}return t.find(e=>e.toLowerCase()===i.toLowerCase())||null},o=Object.keys(e.bindsets||{});for(const[c,l]of Object.entries(e.bindsets||{})){const d=[...l.space?.keys?Object.entries(l.space.keys):[],...l.ground?.keys?Object.entries(l.ground.keys):[],...l.space?.aliases?Object.entries(l.space.aliases):[],...l.ground?.aliases?Object.entries(l.ground.aliases):[]];for(const[l,m]of d)if(Array.isArray(m))for(const d of m){const m=d.match(/^bind_load_file\s+(.+)$/i);if(!m)continue;const h=m[1].trim().replace(/"/g,""),u=r(h,o);if(!u){a.push(`LoadBindSet activity in key "${l}" references unknown bindset: "${h}"`);continue}const p=`sto_kb_bindset_enable_${t}_${n(u)}`,f=e.bindsets[u];if(!f){a.push(`Target bindset "${u}" not found in parsed data`);continue}const y=Object.keys(e.bindsets.Master?.[t]?.keys||{}),_=Object.keys(f[t]?.keys||{}),g=new Set([...y,..._]),b=[];for(const i of g){const a=f[t]?.keys?.[i];if(a){const e=s(t,u,i);b.push(`bind ${i} "${e}"`)}else{const a=e.bindsets.Master?.[t]?.keys?.[i];if(a){const e=s(t,"Primary Bindset",i);b.push(`bind ${i} "${e}"`)}else b.push(`unbind ${i}`)}}if(b.length>0){const e=b.join(" $$ ");i[p]={commands:[e],description:`Enable ${u} for ${t}`,metadata:{type:"bindset_loader",environment:t,targetBindset:u,originalFilename:h,sourceKey:l,sourceBindset:c}}}}}return{aliases:i,warnings:a}}getCurrentProfileId(){if("undefined"!=typeof globalThis&&globalThis.app?.getCurrentProfileId)return globalThis.app.getCurrentProfileId();const e=this.storage?.getSettings?.();return e?.currentProfile}extractOriginalFromMirrored(e){const t=e.split(/\s*\$\$\s*/);if(t.length<3||t.length%2==0)return t;const i=Math.floor(t.length/2);return t.slice(0,i+1)}sanitizeProfileData(e){const t={name:e.name,currentEnvironment:e.currentEnvironment||e.mode||"space",builds:{space:{keys:{},aliases:{}},ground:{keys:{},aliases:{}}},aliases:{},keybindMetadata:{},aliasMetadata:{},bindsetMetadata:{}};if(e.builds)e.builds.space&&(t.builds.space={keys:e.builds.space.keys||{},aliases:e.builds.space.aliases||{}}),e.builds.ground&&(t.builds.ground={keys:e.builds.ground.keys||{},aliases:e.builds.ground.aliases||{}});else if(e.keys||e.keybinds){const i=e.keys||e.keybinds||{};t.builds.space.keys=i}return e.aliases&&(t.aliases=e.aliases),e.keybindMetadata&&(t.keybindMetadata=e.keybindMetadata),e.aliasMetadata&&(t.aliasMetadata=e.aliasMetadata),e.bindsetMetadata&&(t.bindsetMetadata=e.bindsetMetadata),t}extractActivityOrderingInfo(e){const t={hasActivityOrdering:!1,activityCount:e.length,orderedActivities:[],preservedExecutionOrder:!1};if(!Array.isArray(e)||0===e.length)return t;let i=!1;const a=[];for(let t=0;t<e.length;t++){const n=e[t];if("string"==typeof n&&n.includes("sto_kb_cycle_")){i=!0;const e=n.match(/sto_kb_cycle_(\w+)_(\w+)(?:_(\d+))?/);e&&a.push({type:"cycle",environment:e[1],key:e[2],step:e[3]||"controller",position:t,command:n})}if("string"==typeof n&&n.startsWith("alias ")){const e=n.match(/alias\s+(\w+)(?:_\d+)?\s+<&\s*(.+?)\s*&>/);e&&(i=!0,a.push({type:"alias_definition",aliasName:e[1],position:t,command:n}))}}return(i||a.length>0)&&(t.hasActivityOrdering=!0,t.orderedActivities=a,t.preservedExecutionOrder=i),t}extractLoadBindSetMappings(e,t){const i=[];if(!Array.isArray(e)||0===e.length)return i;for(const a of e){if("string"!=typeof a)continue;const e=a.match(/^bind_load_file\s+(.+)$/i);if(!e)continue;const n=e[1].trim().replace(/"/g,"");let s=null;const r=n.split(/[/\\]/).pop().replace(/\.[^/.]+$/,""),o=r.match(/^.*C_(.+)$/);s=o?o[1]:r,i.push({type:"LoadBindSet",sourceKey:t,originalCommand:a,targetFilename:n,targetBindsetName:s,extractedAt:(new Date).toISOString()})}return i}extractCycleAliasOrderingInfo(e,t){const i={hasCycleOrdering:!1,isCycleStep:!1,isCycleController:!1,runAtFrontCommands:[],runAtEndCommands:[],stepNumber:null,cycleKey:null};if(!Array.isArray(e)||0===e.length)return i;if(!t.includes("sto_kb_cycle_")&&!e.some(e=>"string"==typeof e&&e.includes("sto_kb_cycle_")))return i;i.hasCycleOrdering=!0;const a=t.split("_");if(a.length>=5){const e=a[3];let t=a[4],n=null;if(a.length>=6){const e=a[a.length-1];/^\d+$/.test(e)&&(n=parseInt(e,10),t=a.slice(4,-1).join("_"))}i.cycleKey=`${e}_${t}`,i.stepNumber=n,i.isCycleController=!n,i.isCycleStep=!!n}const n=e.flat();let s=!1;const r=[],o=[];for(let e=0;e<n.length;e++){const t=n[e];"string"==typeof t&&t.includes("alias ")&&t.includes("sto_kb_cycle_")?s=!0:s?o.push(t):r.push(t)}return i.runAtFrontCommands=r,i.runAtEndCommands=o,i}buildKBFErrorResult(e,t,i={}){const a=Date.now()-e.startTime;if(e.transactionInProgress&&e.originalProfile)try{this.storage.saveProfile(e.profileId,e.originalProfile),e.recoveryActions.push({action:"auto_rollback",description:`Automatic rollback due to ${t}`,profileId:e.profileId,timestamp:Date.now()})}catch(t){e.errors.push({message:`Critical: Failed to rollback profile during error handling: ${t.message}`,phase:"error_rollback",layer:"critical",recoverable:!1,context:{profileId:e.profileId,originalError:t.message}})}return{success:!1,error:t,params:{...i,processingTimeMs:a,totalErrors:e.errors.length,totalWarnings:e.warnings.length,errors:e.errors,warnings:e.warnings},errors:e.errors,warnings:e.warnings,layerErrors:e.layerErrors,recoveryActions:e.recoveryActions,processedBindsets:Array.from(e.processedBindsets),failedBindsets:Array.from(e.failedBindsets)}}rollbackAndBuildError(e,t,i={}){const a=Date.now()-e.startTime;if(e.transactionInProgress&&e.originalProfile)try{this.storage.saveProfile(e.profileId,e.originalProfile),e.recoveryActions.push({action:"error_rollback",description:`Profile rollback due to ${t}`,profileId:e.profileId,timestamp:Date.now(),recoverable:!0}),e.errors.push({message:`Profile successfully rolled back due to import failure: ${t}`,phase:"rollback",layer:"recovery",recoverable:!0,context:{errorType:t,profileId:e.profileId,rollbackSuccess:!0}})}catch(i){e.errors.push({message:`Critical: Failed to rollback profile during error handling: ${i.message}`,phase:"rollback",layer:"critical",recoverable:!1,context:{profileId:e.profileId,originalError:i.message,errorType:t}}),e.recoveryActions.push({action:"rollback_failed",description:`Failed to rollback profile during ${t} error handling`,profileId:e.profileId,timestamp:Date.now(),recoverable:!1})}return{success:!1,error:t,params:{...i,processingTimeMs:a,totalErrors:e.errors.length,totalWarnings:e.warnings.length,rollbackAttempted:e.transactionInProgress,rollbackSuccess:e.recoveryActions.some(e=>"error_rollback"===e.action),errors:e.errors,warnings:e.warnings},errors:e.errors,warnings:e.warnings,layerErrors:e.layerErrors,recoveryActions:e.recoveryActions,processedBindsets:Array.from(e.processedBindsets),failedBindsets:Array.from(e.failedBindsets)}}createEnhancedProfileStructure(e,t){try{const i=this.storage.getProfile(t)||{builds:{space:{keys:{},aliases:{}},ground:{keys:{},aliases:{}}},bindsets:{},aliases:{},keybindMetadata:{},bindsetMetadata:{}},a=[{path:"builds",defaultValue:{space:{keys:{},aliases:{}},ground:{keys:{},aliases:{}}}},{path:"bindsets",defaultValue:{}},{path:"aliases",defaultValue:{}},{path:"keybindMetadata",defaultValue:{}},{path:"bindsetMetadata",defaultValue:{}}];for(const t of a)i[t.path]||(i[t.path]=t.defaultValue,e.warnings.push({message:`Created missing profile structure: ${t.path}`,phase:"profile_validation",layer:"structure",recoverable:!0,context:{path:t.path}}));const n=e.environment;return i.builds[n]||(i.builds[n]={keys:{},aliases:{}},e.warnings.push({message:`Created missing environment build structure: ${n}`,phase:"profile_validation",layer:"structure",recoverable:!0,context:{environment:n}})),i}catch(i){throw e.errors.push({message:`Failed to create enhanced profile structure: ${i.message}`,phase:"profile_creation",layer:"structure",recoverable:!1,context:{profileId:t,originalError:i.message}}),i}}async processKBFBindsetsAtomic(e,t,i,a,n){let s=0,r=0,o=!1,c=null;try{const l=Object.keys(i.bindsets),d=1===l.length,m=d&&"master"===l[0].toLowerCase(),h=n.selectedBindsets?l.filter(e=>n.selectedBindsets.includes(e)):l;e.warnings.push({message:`Processing ${h.length} of ${l.length} available bindsets`,phase:"bindset_selection",layer:"processing",recoverable:!0,context:{totalAvailable:l.length,selectedForProcessing:h.length,selectedNames:h}});for(const[l,d]of Object.entries(i.bindsets))if(!n.selectedBindsets||n.selectedBindsets.includes(l))try{const i=await this.processSingleBindsetAtomic(e,t,l,d,a);i.success?(e.processedBindsets.add(l),s+=i.stats.keysImported,r+=i.stats.aliasesImported,"master"===l.toLowerCase()&&(o=!0,c=l)):(e.failedBindsets.add(l),e.errors.push({message:`Failed to process bindset "${l}": ${i.error}`,phase:"bindset_processing",layer:"processing",recoverable:!0,context:{bindsetName:l,originalError:i.error}}))}catch(t){e.failedBindsets.add(l),e.errors.push({message:`Critical error processing bindset "${l}": ${t.message}`,phase:"bindset_processing",layer:"critical",recoverable:!0,context:{bindsetName:l,originalError:t.message,stack:t.stack}})}return{success:!0,profile:t,stats:{totalKeysImported:s,totalAliasesImported:r,hasPrimaryBindset:o,masterBindsetName:c,actualBindsetsProcessed:e.processedBindsets.size,isSingleBindsetFile:d,onlyBindsetIsMaster:m,requiresBindsetSelection:!d&&i.stats.totalBindsets>1}}}catch(t){return{success:!1,error:t.message,errorType:"bindset_processing_failed",errorParams:{originalError:t.message,processedBindsets:e.processedBindsets.size,failedBindsets:e.failedBindsets.size}}}}async processSingleBindsetAtomic(e,t,i,a,n){try{const s=this.getEnvironmentSpecificBindsetName(t,i,n);let r=0,o=0;if("master"===i.toLowerCase()){const s=await this.processMasterBindsetAtomic(e,t,i,a,n);if(!s.success)return s;r=s.stats.keysImported,o=s.stats.aliasesImported}else{const c=await this.processNamedBindsetAtomic(e,t,i,a,n,s);if(!c.success)return c;r=c.stats.keysImported,o=c.stats.aliasesImported}return await this.storeEnhancedBindsetMetadata(e,t,i,a,n,s,"master"===i.toLowerCase()),{success:!0,stats:{keysImported:r,aliasesImported:o}}}catch(e){return{success:!1,error:e.message,context:{bindsetName:i,environment:n}}}}getEnvironmentSpecificBindsetName(e,t,i){if("master"===t.toLowerCase())return"Primary Bindset";const a=t,n="space"===i?"ground":"space";return e.bindsets[a]&&(e.bindsets[a][n].keys&&Object.keys(e.bindsets[a][n].keys).length>0||e.bindsets[a][n].aliases&&Object.keys(e.bindsets[a][n].aliases).length>0)?`${a}_${i}`:a}async processMasterBindsetAtomic(e,t,i,a,n){try{let s=0,r=0;for(const[r,o]of Object.entries(a.keys||{}))try{let e=o,i={};o&&"object"==typeof o&&o.commands&&(e=o.commands,i=o.metadata||{});const a=_e(e),c=[];for(const e of a){const t=await ye(e,{eventBus:this.eventBus});c.push(t)}t.builds[n].keys[r]=c,s++,i.stabilizeExecutionOrder&&(t.keybindMetadata||(t.keybindMetadata={}),t.keybindMetadata[n]||(t.keybindMetadata[n]={}),t.keybindMetadata[n][r]||(t.keybindMetadata[n][r]={}),t.keybindMetadata[n][r].stabilizeExecutionOrder=!0)}catch(t){e.errors.push({message:`Failed to process key "${r}" in master bindset: ${t.message}`,phase:"key_processing",layer:"processing",recoverable:!0,context:{bindsetName:i,key:r,originalError:t.message}})}for(const[s,o]of Object.entries(a.aliases||{}))try{const e=_e(o.commands||[]),i=[];for(const t of e){const e=await ye(t,{eventBus:this.eventBus});i.push(e)}t.builds[n].aliases[s]={commands:i,description:o.description||""},r++}catch(t){e.errors.push({message:`Failed to process alias "${s}" in master bindset: ${t.message}`,phase:"alias_processing",layer:"processing",recoverable:!0,context:{bindsetName:i,aliasName:s,originalError:t.message}})}return{success:!0,stats:{keysImported:s,aliasesImported:r}}}catch(e){return{success:!1,error:e.message,context:{bindsetName:i,environment:n}}}}async processNamedBindsetAtomic(e,t,i,a,n,s){try{let r=0,o=0;t.bindsets[s]||(t.bindsets[s]={space:{keys:{},aliases:{}},ground:{keys:{},aliases:{}}});for(const[o,c]of Object.entries(a.keys||{}))try{let e=c,i={};c&&"object"==typeof c&&c.commands&&(e=c.commands,i=c.metadata||{});const a=_e(e),l=[];for(const e of a){const t=await ye(e,{eventBus:this.eventBus});l.push(t)}t.bindsets[s][n].keys[o]=l,r++,i.stabilizeExecutionOrder&&(t.keybindMetadata||(t.keybindMetadata={}),t.keybindMetadata[n]||(t.keybindMetadata[n]={}),t.keybindMetadata[n][o]||(t.keybindMetadata[n][o]={}),t.keybindMetadata[n][o].stabilizeExecutionOrder=!0)}catch(t){e.errors.push({message:`Failed to process key "${o}" in bindset "${i}": ${t.message}`,phase:"key_processing",layer:"processing",recoverable:!0,context:{bindsetName:i,finalBindsetName:s,key:o,originalError:t.message}})}for(const[r,c]of Object.entries(a.aliases||{}))try{const e=_e(c.commands||[]),i=[];for(const t of e){const e=await ye(t,{eventBus:this.eventBus});i.push(e)}t.bindsets[s][n].aliases[r]={commands:i,description:c.description||""},o++}catch(t){e.errors.push({message:`Failed to process alias "${r}" in bindset "${i}": ${t.message}`,phase:"alias_processing",layer:"processing",recoverable:!0,context:{bindsetName:i,finalBindsetName:s,aliasName:r,originalError:t.message}})}return{success:!0,stats:{keysImported:r,aliasesImported:o}}}catch(e){return{success:!1,error:e.message,context:{bindsetName:i,finalBindsetName:s,environment:n}}}}async storeEnhancedBindsetMetadata(e,t,i,a,n,s,r){try{t.bindsetMetadata[s]||(t.bindsetMetadata[s]={});const e={...a.metadata,originalName:i,displayName:r?"Primary Bindset":i,isMasterBindset:r,activityOrdering:{},cycleAliasOrdering:{},loaderAliasMapping:{},keyMetadata:{},kbfImportInfo:{originalBindsetName:i,importEnvironment:n,importedAt:(new Date).toISOString(),totalKeys:Object.keys(a.keys||{}).length,totalAliases:Object.keys(a.aliases||{}).length}};for(const[t,i]of Object.entries(a.keys||{})){let a=i,n={};if(i&&"object"==typeof i&&(a=i.commands||i,n=i.metadata||{}),Object.keys(n).length>0&&(e.keyMetadata[t]={...n,importedAt:(new Date).toISOString()}),Array.isArray(a)){const i=this.extractActivityOrderingInfo(a);i.hasActivityOrdering&&(e.activityOrdering[t]=i)}}for(const[t,i]of Object.entries(a.aliases||{})){let a=i.commands||[],n={};if(i&&"object"==typeof i&&(a=i.commands||i,n=i.metadata||{}),Array.isArray(a)){const i=this.extractCycleAliasOrderingInfo(a,t);i.hasCycleOrdering&&(e.cycleAliasOrdering[t]={...i,...n})}}for(const[t,i]of Object.entries(a.keys||{})){let a=i;if(i&&"object"==typeof i&&i.commands&&(a=i.commands),Array.isArray(a)){const i=this.extractLoadBindSetMappings(a,t);i.length>0&&(e.loaderAliasMapping[t]=i)}}t.bindsetMetadata[s][n]=e}catch(t){e.errors.push({message:`Failed to store enhanced metadata for bindset "${i}": ${t.message}`,phase:"metadata_processing",layer:"processing",recoverable:!0,context:{bindsetName:i,finalBindsetName:s,originalError:t.message}})}}async processGlobalAliasesAtomic(e,t,i){if(i.aliases&&0!==Object.keys(i.aliases).length)try{let a=0;for(const[n,s]of Object.entries(i.aliases))try{const e=_e(s.commands||[]),i=[];for(const t of e){const e=await ye(t,{eventBus:this.eventBus});i.push(e)}let r=s.metadata||{};if(n.includes("sto_kb_cycle_")){const e=this.extractCycleAliasOrderingInfo(i,n);e.hasCycleOrdering&&(r={...r,cycleOrdering:e})}t.aliases[n]={commands:i,description:s.description||"",metadata:r},a++}catch(t){e.errors.push({message:`Failed to process global alias "${n}": ${t.message}`,phase:"global_alias_processing",layer:"processing",recoverable:!0,context:{aliasName:n,aliasData:s}})}e.warnings.push({message:`Processed ${a} global aliases from KBF data`,phase:"global_alias_processing",layer:"processing",recoverable:!0,context:{totalAliases:a}})}catch(t){e.errors.push({message:`Critical error processing global aliases: ${t.message}`,phase:"global_alias_processing",layer:"critical",recoverable:!0,context:{originalError:t.message}})}}atomicSaveProfile(e,t,i){try{const a=this.validateProfileStructure(i);if(!a.isValid)throw new Error(`Profile structure validation failed: ${a.errors.join(", ")}`);this.storage.saveProfile(t,i),e.recoveryActions.push({action:"profile_saved",description:"Profile saved successfully with atomic transaction",profileId:t,timestamp:Date.now(),recoverable:!0})}catch(i){throw e.errors.push({message:`Failed to save profile atomically: ${i.message}`,phase:"profile_save",layer:"critical",recoverable:!1,context:{profileId:t,originalError:i.message}}),i}}validateProfileStructure(e){const t=[];if(!e||"object"!=typeof e)return t.push("Profile is not a valid object"),{isValid:!1,errors:t};const i=["builds","bindsets","aliases"];for(const a of i)e[a]&&"object"==typeof e[a]||t.push(`Missing or invalid profile field: ${a}`);if(e.builds){const i=["space","ground"];for(const a of i)e.builds[a]&&"object"==typeof e.builds[a]?(e.builds[a].keys&&"object"==typeof e.builds[a].keys||t.push(`Missing or invalid keys structure for environment: ${a}`),e.builds[a].aliases&&"object"==typeof e.builds[a].aliases||t.push(`Missing or invalid aliases structure for environment: ${a}`)):t.push(`Missing or invalid build environment: ${a}`)}return{isValid:0===t.length,errors:t}}onInit(){this.setupRequestHandlers(),this.emit("import-service-ready")}}const Ne=globalThis.STO_DATA||{};class De extends oe{constructor({eventBus:e,storage:t,i18n:i}={}){super(e),this.componentName="ExportService",this.storage=t,this.i18n=i}onInit(){this.extendCache({profiles:{}}),this.setupRequestHandlers(),this.setupEventListeners()}setupRequestHandlers(){this.respond("export:generate-filename",async({profile:e,extension:t,environment:i})=>await this.generateFileName(e,t,i)),this.respond("export:generate-alias-filename",({profile:e,extension:t})=>this.generateAliasFileName(e,t)),this.respond("export:import-from-file",async({file:e})=>await this.importFromFile(e)),this.respond("export:extract-keys",({profile:e,environment:t})=>this.extractKeys(e,t)),this.respond("export:generate-keybind-file",async({profileId:e,environment:t="space",syncMode:i=!1})=>{const a=this.getProfileFromCache(e);if(!a)throw new Error(`Profile ${e} not found in ExportService cache`);return await this.generateSTOKeybindFile(a,{environment:t,syncMode:i})}),this.respond("export:generate-alias-file",async({profileId:e})=>{const t=this.getProfileFromCache(e);if(!t)throw new Error(`Profile ${e} not found`);return await this.generateAliasFile(t)}),this.respond("export:sync-to-folder",async({dirHandle:e})=>await this.syncToFolder(e))}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e&&t&&(this.cache.profiles[e]=t)}),this.addEventListener("profile:switched",({profileId:e,environment:t,profile:i})=>{i&&(this.cache.profiles[e]=i)})}le(){return console.log("[ExportService] _getBindToAliasMode called"),console.log("[ExportService] cache:",this.cache),console.log("[ExportService] preferences:",this.cache?.preferences),console.log("[ExportService] bindToAliasMode:",this.cache?.preferences?.bindToAliasMode),this.cache?.preferences?.bindToAliasMode||!1}me(){return console.log("[ExportService] _getBindsetsEnabled called"),console.log("[ExportService] cache:",this.cache),console.log("[ExportService] preferences:",this.cache?.preferences),console.log("[ExportService] bindsetsEnabled:",this.cache?.preferences?.bindsetsEnabled),this.cache?.preferences?.bindsetsEnabled||!1}sanitizeBindsetName(e=""){if(!e)return"";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t=`bs_${t}`),t}async generateBindsetAliasName(e,t,i){const{generateBindToAliasName:a}=await Promise.resolve().then(function(){return Dt});return t&&"Primary Bindset"!==t?a(e,i,t):a(e,i)}async generateSTOKeybindFile(e,t={}){const{environment:i="space",syncMode:a=!1}=t,n=this.extractKeys(e,i);if(!(n&&Object.keys(n).length>0))return"; "+this.i18n.t("no_keybinds_to_export")+"\n";const s=`${e.name.replace(/[^a-zA-Z0-9_-]/g,"_")}_${i}.txt`;let r=await this.generateFileHeader(e,s,i);return r+=await this.generateKeybindSection(n,{environment:i,profile:e,syncMode:a}),r}async generateFileHeader(e,t=null,i=null){const a=(new Date).toLocaleString(),n=i||e.currentEnvironment||"space",s=Object.keys(this.extractKeys(e,n)).length;return Object.keys(e.aliases||{}).length,`; ================================================================\n; ${e.name} - STO Keybind Configuration\n; ================================================================\n; ${this.i18n.t("environment")} ${n.toUpperCase()}\n; ${this.i18n.t("generated")} ${a}\n; ${this.i18n.t("created_by")} STO Tools Keybind Manager v${Ne?.settings?.version??"unknown"}\n;\n; ${this.i18n.t("statistics")}:\n; - ${this.i18n.t("total_commands")}: ${s}\n;\n; To use this keybind file in Star Trek Online:\n; 1. Save this file in your STO Live folder as a .txt file\n; 2. In-game, type: /bind_load_file ${t}\n; 3. Your keybinds will be applied immediately\n; ================================================================\n\n`}async generateKeybindSection(e,t={}){const{environment:i="space",syncMode:a=!1,profile:n}=t;if(!e||0===Object.keys(e).length)return"; "+this.i18n.t("no_keybinds_to_export")+"\n";const s=this.le();console.log("[ExportService] this: ",this);let r="; ==============================================================================\n";if(r+=`; ${i.toUpperCase()} KEYBINDS\n`,r+="; ==============================================================================\n\n",s){const{generateBindToAliasName:t}=await Promise.resolve().then(function(){return Dt});r+=`; ${this.i18n.t("export_generated_aliases_note")}\n`,r+=`; ${this.i18n.t("export_alias_definitions_note")}\n`,r+="; ------------------------------------------------------------------------------\n";for(const[a,n]of Object.entries(e)){const e=t(i,a);if(!e)continue;const{encodeKeyForExport:n}=await Promise.resolve().then(function(){return Se});r+=`${n(a)} "${e}"\n`}}else for(const[t,a]of Object.entries(e)){let e=a||[];n.keybindMetadata&&n.keybindMetadata[i]&&n.keybindMetadata[i][t]&&n.keybindMetadata[i][t].stabilizeExecutionOrder&&Array.isArray(e)&&e.length>1&&(e=this.mirrorCommands(e));const s=[];for(const t of e){const e=await ye(t,{eventBus:this.eventBus});s.push(e)}r+=Te(t,s)}return r+="\n",r}async generateAliasFile(e){const t=e.aliases||{};let i={};try{i=await this.request("vfx:get-virtual-aliases")||{}}catch(e){console.log("[ExportService] VFXManagerService not available, skipping VFX aliases")}const a={};if(this.le()){const{generateBindToAliasName:t}=await Promise.resolve().then(function(){return Dt}),i=["space","ground"];for(const n of i){const i=this.extractKeys(e,n);if(i&&0!==Object.keys(i).length)for(const[s,r]of Object.entries(i)){const i=t(n,s);if(!i)continue;let o=r||[];e.keybindMetadata&&e.keybindMetadata[n]&&e.keybindMetadata[n][s]&&e.keybindMetadata[n][s].stabilizeExecutionOrder&&Array.isArray(r)&&r.length>1&&(o=this.mirrorCommands(r)),a[i]={name:i,commands:o,description:`Generated alias for ${n} key: ${s}`,isGenerated:!0}}}}const n={},s={};if(this.me()){const t=e.bindsets||{},i=Object.keys(t),a=["space","ground"];for(const r of a){const a=Object.keys(e.builds?.[r]?.keys||{}),o=new Set(a);for(const e of i)Object.keys(t[e]?.[r]?.keys||{}).forEach(e=>o.add(e));for(const a of i){const i=t[a]?.[r]?.keys||{};for(const[t,s]of Object.entries(i)){let i=s||[];Array.isArray(i)||(i=[i]),e.bindsetMetadata&&e.bindsetMetadata[a]&&e.bindsetMetadata[a][r]&&e.bindsetMetadata[a][r][t]&&e.bindsetMetadata[a][r][t].stabilizeExecutionOrder&&i.length>1&&(i=this.mirrorCommands(i));const o=await this.generateBindsetAliasName(r,a,t);o&&(n[o]={name:o,commands:i,description:`Bindset ${a} â€“ ${r} key ${t}`,isGenerated:!0})}}const c=["Primary Bindset",...i];for(const a of c){const n=`sto_kb_bindset_enable_${r}_${this.sanitizeBindsetName(a)}`,c=[];for(const n of o){let s;const o="Primary Bindset"!==a&&t[a]?.[r]?.keys?.[n],l=e.builds?.[r]?.keys?.[n];if("Primary Bindset"===a){if(i.some(e=>t[e]?.[r]?.keys?.[n])){if(!l){c.push(`unbind ${n}`);continue}s=await this.generateBindsetAliasName(r,"Primary Bindset",n)}}else o&&(s=await this.generateBindsetAliasName(r,a,n));if(s){const{encodeKeyForExport:e}=await Promise.resolve().then(function(){return Se}),t=e(n);c.push(`bind ${t} "${s}"`)}}if(c.length>0){const e=c.join(" $$ ");s[n]={name:n,commands:[e],description:`Enable ${a} for ${r}`,isLoader:!0,category:"Bindsets"}}}}}const r={...t,...i,...a,...n,...s};if(0===Object.keys(r).length)return"; "+this.i18n.t("no_aliases_to_export")+"\n";let o=await this.generateAliasFileHeader(e);Object.keys(a).length>0&&(o+=`; ${this.i18n.t("export_user_and_generated_aliases")}\n`,o+=`; ${this.i18n.t("export_generated_aliases_count",{count:Object.keys(a).length})}\n`,o+="; ================================================================\n\n");const c=Object.entries(r).sort(([e],[t])=>e.localeCompare(t));for(const[t,i]of c){let a=Array.isArray(i.commands)?i.commands:[];if(!i.isGenerated&&!i.isLoader&&e.aliasMetadata&&e.aliasMetadata[t]&&e.aliasMetadata[t].stabilizeExecutionOrder&&a.length>1){const e=a.map(e=>({command:e}));a=(await this.request("command:generate-mirrored-commands",{commands:e})).split(/\s*\$\$\s*/).filter(Boolean)}const n=[];for(const e of a){const t=await ye(e,{eventBus:this.eventBus});n.push(t)}const s=n.join(" $$ ");o+=xe(t,{...i,commands:s}),o+="\n"}return o}async generateAliasFileHeader(e){const t=(new Date).toLocaleString(),i=Object.keys(e.aliases||{}).length;return`; ================================================================\n; ${e.name} - STO Alias Configuration\n; ================================================================\n; ${this.i18n.t("environment")} Alias\n; ${this.i18n.t("generated")} ${t}\n; ${this.i18n.t("created_by")} STO Tools Keybind Manager v${Ne?.settings?.version??"unknown"}\n;\n; Alias Statistics:\n; - Total aliases: ${i}\n;\n; To use these aliases in Star Trek Online:\n; 1. Save this file as "CommandAliases.txt" (exactly, without quotes)\n; 2. Place it in your STO directory:\n;    [STO Install]\\Star Trek Online\\Live\\localdata\\CommandAliases.txt\n; 3. The aliases will be available when you start the game\n;\n; Alternative: You can append these aliases to an existing CommandAliases.txt\n; file if you already have one with other aliases.\n;\n; Common STO installation paths:\n; - Steam: C:\\Program Files (x86)\\Steam\\steamapps\\common\\Star Trek Online\n; - Epic: C:\\Program Files\\Epic Games\\Star Trek Online\n; - Arc: C:\\Program Files (x86)\\Perfect World Entertainment\\Arc Games\\Star Trek Online\n; ================================================================\n\n`}async syncToFolder(e){const t=this.storage.getAllData(),i=t.profiles||{};try{for(const[t,a]of Object.entries(i)){if(!a||!a.name)continue;const t=a.name.replace(/[^a-zA-Z0-9_-]/g,"_"),i=`${t}`;for(const n of["space","ground"])if(a.builds?.[n]?.keys&&Object.keys(a.builds[n].keys).length>0){const s=await this.generateSTOKeybindFile(a,{environment:n,profile:a,syncMode:!0}),r=`${i}/${t}_${n}.txt`;await Ae(e,r,s)}const n=await this.generateAliasFile(a),s=`${i}/${t}_aliases.txt`;await Ae(e,s,n)}const a={version:Ne?.settings?.version||"1.0.0",exported:(new Date).toISOString(),type:"project",data:{profiles:i,settings:t.settings||{},currentProfile:t.currentProfile}};await Ae(e,"project.json",JSON.stringify(a,null,2))}catch(e){throw e}}generateFileName(e,t,i=e.currentEnvironment||"space"){return`${e.name.replace(/[^a-zA-Z0-9_-]/g,"_")}_${i}_${(new Date).toISOString().split("T")[0]}.${t}`}generateAliasFileName(e,t){return`${e.name.replace(/[^a-zA-Z0-9_-]/g,"_")}_aliases.${t}`}extractKeys(e={},t="space"){return e.keys&&!e.builds?e.keys:e.builds&&e.builds[t]&&e.builds[t].keys?e.builds[t].keys:e.keybinds&&e.keybinds[t]?e.keybinds[t]:{}}mirrorCommands(e){if(!Array.isArray(e)||e.length<=1)return e;const t=_e(e);return[...t,...t.slice(0,-1).reverse()]}getCurrentState(){return{currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment,profiles:this.cache.profiles}}handleInitialState(e,t){}getProfileFromCache(e){return e&&this.cache.profiles[e]?this.cache.profiles[e]:this.storage&&"function"==typeof this.storage.getProfile?this.storage.getProfile(e):null}}class Le extends oe{constructor({eventBus:e,i18n:t,containerId:i="toastContainer"}={}){super(e),this.componentName="ToastService",this.i18n=t,this.containerId=i,this.eventBus&&(this.respond("ui:show-toast",({message:e,type:t="info",duration:i=3e3})=>(this.showToast(e,t,i),!0)),this.addEventListener("toast:show",({message:e,type:t="info",duration:i=3e3})=>{this.showToast(e,t,i)}))}showToast(e,t="info",i=3e3){const a=this.createToast(e,t,i),n=document.getElementById(this.containerId);n?(n.appendChild(a),requestAnimationFrame(()=>{a.classList.add("show")}),setTimeout(()=>{this.removeToast(a)},i)):console.warn(`ToastService: Toast container '${this.containerId}' not found in DOM`)}createToast(e,t,i){const a=document.createElement("div");a.className=`toast toast-${t}`;const n={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"},s=document.createElement("div");s.className="toast-content";const r=document.createElement("i");r.className=`fas ${n[t]||n.info}`,s.appendChild(r);const o=document.createElement("span");o.className="toast-message",o.textContent=e,s.appendChild(o);const c=document.createElement("button");c.className="toast-close",c.setAttribute("aria-label","close toast");const l=document.createElement("i");return l.className="fas fa-times",c.appendChild(l),s.appendChild(c),a.appendChild(s),c.addEventListener("click",()=>{this.removeToast(a)}),a}removeToast(e){e&&(e.classList.add("removing"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}}class Ke extends oe{constructor(e){super(e),this.componentName="UIUtilityService",this.dragState={isDragging:!1,dragElement:null,dragData:null},this.setupEventListeners()}onDestroy(){this.requestDetachers&&(this.requestDetachers.forEach(e=>e()),this.requestDetachers=[]),super.onDestroy()}setupEventListeners(){this.eventBus.on("ui:copy-to-clipboard",this.handleCopyToClipboard.bind(this)),this.eventBus.on("ui:init-drag-drop",this.handleInitDragDrop.bind(this)),this.setupRequestHandlers()}setupRequestHandlers(){this.requestDetachers=[];const e=async({text:e}={})=>this.copyToClipboard(e);this.requestDetachers.push(this.respond("ui:copy-to-clipboard",e)),this.requestDetachers.push(this.respond("utility:copy-to-clipboard",e))}async handleCopyToClipboard({text:e}){const t=await this.copyToClipboard(e);this.emit("ui:clipboard-result",{success:t,text:e})}async handleInitDragDrop({container:e,containerId:t,options:i={}}){const a=e||document.getElementById(t);this.initDragAndDrop(a,i),this.emit("ui:drag-drop-initialized",{containerId:t,options:i})}async copyToClipboard(e){try{return await navigator.clipboard.writeText(e),{success:!0,message:"content_copied_to_clipboard"}}catch(t){const i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.select();try{return document.execCommand("copy"),{success:!0,message:"content_copied_to_clipboard"}}catch(e){return{success:!1,message:"failed_to_copy_to_clipboard"}}finally{document.body.removeChild(i)}}}initDragAndDrop(e,t={}){if(!e)return;const{draggableSelector:i=".draggable",dropZoneSelector:a=i,onDragStart:n=null,onDragEnd:s=null,onDrop:r=null}=t;e.addEventListener("dragstart",e=>{const t=e.target.closest(i);t&&(this.dragState.isDragging=!0,this.dragState.dragElement=t,this.dragState.dragData=t.dataset,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML),n&&n(e,this.dragState))}),e.addEventListener("dragend",e=>{e.target.closest(i)&&(this.dragState.isDragging=!1,this.dragState.dragElement=null,this.dragState.dragData=null,s&&s(e,this.dragState))});let o=null;e.addEventListener("dragover",e=>{if(e.preventDefault(),!a)return;const t=e.target.closest?e.target.closest(a):null;t&&t!==o&&(o=t)}),e.addEventListener("drop",e=>{e.preventDefault();let t=null;if(a){if("function"==typeof e.target.closest&&(t=e.target.closest(a)),!t&&"undefined"!=typeof document&&document.elementFromPoint){const i=document.elementFromPoint(e.clientX,e.clientY);t=i?.closest?i.closest(a):null}t||(t=o)}t&&t&&r&&r(e,this.dragState,t)})}}class je extends oe{constructor({eventBus:e=null,document:t=("undefined"!=typeof window?window.document:void 0),i18n:i}={}){super(e),this.componentName="KeyCaptureService",this.document=t,this.i18n=i,this.isCapturing=!1,this.pressedCodes=new Set,this.currentContext="keySelectionModal",this.hasCapturedValidKey=!1,this.locationSpecific=!1,this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleKeyUp=this.handleKeyUp.bind(this),this.boundHandleMouseDown=this.handleMouseDown.bind(this),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleMouseMove=this.handleMouseMove.bind(this),this.boundHandleWheel=this.handleWheel.bind(this),this.mouseState={isDown:!1,button:null,startX:0,startY:0,pressTimer:null,dragThreshold:5,pressTimeout:200}}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("keycapture:start",({context:e}={})=>this.startCapture(e)),this.addEventListener("keycapture:stop",()=>this.stopCapture()),this.addEventListener("keycapture:set-location-specific",({value:e}={})=>{this.setLocationSpecific(e)})}startCapture(e="keySelectionModal"){this.isCapturing||(this.resetState(),this.currentContext=e,this.isCapturing=!0,this.document.addEventListener("keydown",this.boundHandleKeyDown),this.document.addEventListener("keyup",this.boundHandleKeyUp),this.document.addEventListener("mousedown",this.boundHandleMouseDown),this.document.addEventListener("mouseup",this.boundHandleMouseUp),this.document.addEventListener("mousemove",this.boundHandleMouseMove),this.document.addEventListener("wheel",this.boundHandleWheel,{passive:!1}),this.emit("capture-start",{context:e}))}stopCapture(){this.isCapturing&&(this.isCapturing=!1,this.document.removeEventListener("keydown",this.boundHandleKeyDown),this.document.removeEventListener("keyup",this.boundHandleKeyUp),this.document.removeEventListener("mousedown",this.boundHandleMouseDown),this.document.removeEventListener("mouseup",this.boundHandleMouseUp),this.document.removeEventListener("mousemove",this.boundHandleMouseMove),this.document.removeEventListener("wheel",this.boundHandleWheel,{passive:!1}),this.pressedCodes.clear(),this.hasCapturedValidKey=!1,this.resetMouseState(),this.emit("capture-stop",{context:this.currentContext}),this.currentContext="keySelectionModal")}setLocationSpecific(e){this.locationSpecific=!!e}resetState(){this.pressedCodes.clear(),this.hasCapturedValidKey=!1,this.resetMouseState()}resetMouseState(){this.mouseState.pressTimer&&(clearTimeout(this.mouseState.pressTimer),this.mouseState.pressTimer=null),this.mouseState.isDown=!1,this.mouseState.button=null,this.mouseState.startX=0,this.mouseState.startY=0}async handleKeyDown(e){if(!this.isCapturing)return;if(this.isModifier(e.code))return this.pressedCodes.add(e.code),void this.emit("update",{chord:this.chordToString(this.pressedCodes),codes:[...this.pressedCodes],context:this.currentContext});this.pressedCodes.add(e.code);const t=this.chordToString(this.pressedCodes);if(this.isRejectedChord(t))return this.i18n.t("unsafe_keybind",{key:t}),this.resetState(),void e.preventDefault();this.emit("chord-captured",{chord:t,context:this.currentContext}),this.hasCapturedValidKey=!0,e.preventDefault()}handleKeyUp(e){if(this.isCapturing&&!this.hasCapturedValidKey){if(this.isModifier(e.code)&&this.pressedCodes.has(e.code)&&1===this.pressedCodes.size){const t=this.chordToString(this.pressedCodes);return this.emit("chord-captured",{chord:t,context:this.currentContext}),this.hasCapturedValidKey=!0,void e.preventDefault()}this.pressedCodes.delete(e.code),this.emit("update",{chord:this.chordToString(this.pressedCodes),codes:[...this.pressedCodes],context:this.currentContext})}}handleMouseDown(e){this.isCapturing&&(e.preventDefault(),this.mouseState.isDown=!0,this.mouseState.button=e.button,this.mouseState.startX=e.clientX,this.mouseState.startY=e.clientY,this.mouseState.pressTimer=setTimeout(()=>{if(this.mouseState.isDown){const e=this.getButtonGesture(this.mouseState.button,"press");this.captureMouseGesture(e)}},this.mouseState.pressTimeout))}handleMouseUp(e){if(this.isCapturing){if(e.preventDefault(),this.mouseState.pressTimer&&(clearTimeout(this.mouseState.pressTimer),this.mouseState.pressTimer=null),this.mouseState.isDown&&this.mouseState.button===e.button){const t=Math.abs(e.clientX-this.mouseState.startX),i=Math.abs(e.clientY-this.mouseState.startY);if(t>this.mouseState.dragThreshold||i>this.mouseState.dragThreshold){const t=this.getButtonGesture(e.button,"drag");this.captureMouseGesture(t)}else{const t=this.getButtonGesture(e.button,"click");this.captureMouseGesture(t)}}this.resetMouseState()}}handleMouseMove(e){if(!this.isCapturing||!this.mouseState.isDown)return;const t=Math.abs(e.clientX-this.mouseState.startX),i=Math.abs(e.clientY-this.mouseState.startY);(t>this.mouseState.dragThreshold||i>this.mouseState.dragThreshold)&&this.mouseState.pressTimer&&(clearTimeout(this.mouseState.pressTimer),this.mouseState.pressTimer=null)}handleWheel(e){if(!this.isCapturing)return;e.preventDefault();const t=e.deltaY>0?"wheeldown":"wheelup";this.captureMouseGesture(t)}getButtonGesture(e,t){if(e<=2){const i={0:"l",1:"m",2:"r"}[e]||"l";return"click"===t?`${i}click`:"press"===t?`${i}press`:"drag"===t?`${i}drag`:`${i}click`}const i=`Button${e+1}`;return"click"===t?i:"press"===t?`${i}press`:"drag"===t?`${i}drag`:i}captureMouseGesture(e){const t=[...[...this.pressedCodes].filter(e=>this.isModifier(e)),e],i=this.chordToString(new Set(t));this.emit("chord-captured",{chord:i,context:this.currentContext}),this.hasCapturedValidKey=!0}isModifier(e){return["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"].includes(e)}chordToString(e){const t=this.locationSpecific;return[...e].sort().map(e=>{if(/^Button\d+/.test(e))return e;if("string"==typeof e&&(e.startsWith("l")||e.startsWith("r")||e.startsWith("m")||"wheelup"===e||"wheeldown"===e))return e;if(e.startsWith("Control"))return t?e.endsWith("Left")?"LCTRL":"RCTRL":"Ctrl";if(e.startsWith("Alt"))return t?e.endsWith("Left")?"LALT":"RALT":"Alt";if(e.startsWith("Shift"))return t?e.endsWith("Left")?"LSHIFT":"RSHIFT":"Shift";if(e.startsWith("Meta"))return"Meta";const i=e.match(/^Digit(\d)$/);if(i)return i[1];const a=e.match(/^Key([A-Z])$/);if(a)return a[1];if(e.startsWith("F")&&/^F\d+$/.test(e))return e;const n=e.match(/^Numpad(\d)$/);if(n)return`numpad${n[1]}`;const s={NumpadAdd:"Add",NumpadSubtract:"Subtract",NumpadMultiply:"Multiply",NumpadDivide:"Divide",NumpadDecimal:"Decimal",NumpadEnter:"numpadenter"};if(s[e])return s[e];const r={Space:"Space",Enter:"Enter",Tab:"Tab",Escape:"Escape",Backspace:"Backspace",Delete:"Delete",Home:"Home",End:"End",PageUp:"PageUp",PageDown:"PageDown",ArrowUp:"Up",ArrowDown:"Down",ArrowLeft:"Left",ArrowRight:"Right",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/",Backslash:"\\",Minus:"-",Equal:"=",Backquote:"`",IntlBackslash:"\\"};return r[e]?r[e]:e.replace(/^Key/,"")}).join("+")}isRejectedChord(e){return!!e&&t.some(t=>t.toUpperCase()===e.toUpperCase())}}class ze extends oe{constructor({eventBus:e,i18n:t}={}){super(e),this.componentName="ModalManagerService",this.i18n=t,this.overlayId="modalOverlay",this.regenerateCallbacks={},this.isInitialized=!1,this.registerAllModalCallbacks(),this.setupEventListeners(),this.i18n&&this.i18n.on("languageChanged",()=>{const e=document.querySelector(".modal.active");if(!e)return;const t=e.id;this.regenerateCallbacks[t]?(this.regenerateCallbacks[t](),this.emit("modal:regenerated",{modalId:t})):"function"==typeof window.applyTranslations&&window.applyTranslations(e)})}onInit(){this.isInitialized?console.log(`[${this.componentName}] Already initialized`):(this.isInitialized=!0,console.log(`[${this.componentName}] Initialized`))}setupEventListeners(){this.eventBus.on("modal:show",this.handleShowModal.bind(this)),this.eventBus.on("modal:hide",this.handleHideModal.bind(this)),this.setupGlobalModalEventListeners()}setupGlobalModalEventListeners(){document.addEventListener("click",e=>{const t=e.target.closest("[data-modal]");if(t){const i=t.getAttribute("data-modal");i&&(this.hide(i),e.preventDefault(),e.stopPropagation())}}),document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.querySelector(".modal.active");e&&this.hide(e.id)}}),document.addEventListener("click",e=>{if(e.target.id===this.overlayId||e.target.classList.contains("modal-overlay")){const e=document.querySelector(".modal.active");e&&this.hide(e.id)}})}async handleShowModal({modalId:e}){const t=this.show(e);return this.emit("modal:shown",{modalId:e,success:t}),t}async handleHideModal({modalId:e}){const t=this.hide(e);return this.emit("modal:hidden",{modalId:e,success:t}),t}getOverlay(){return document.getElementById(this.overlayId)}show(e){const t="string"==typeof e?document.getElementById(e):e,i=this.getOverlay();if(!i||!t)return!1;i.classList.add("active"),t.classList.add("active"),document.body.classList.add("modal-open"),"function"==typeof window.applyTranslations&&window.applyTranslations(t);const a=t.querySelector("input, textarea, select");a&&setTimeout(()=>a.focus(),100);const n="string"==typeof e?e:t.id;return this.emit("modal:shown",{modalId:n,success:!0}),!0}hide(e){const t="string"==typeof e?document.getElementById(e):e,i=this.getOverlay();return!(!i||!t||(t.classList.remove("active"),document.querySelector(".modal.active")||(i.classList.remove("active"),document.body.classList.remove("modal-open")),0))}registerRegenerateCallback(e,t){this.regenerateCallbacks[e]=t}unregisterRegenerateCallback(e){delete this.regenerateCallbacks[e]}registerAllModalCallbacks(){this.registerRegenerateCallback("parameterModal",()=>{if(window.app?.populateParameterModal){const e=document.getElementById("parameterModal"),t=e?.getAttribute("data-command-def");if(t)try{window.app.populateParameterModal(JSON.parse(t))}catch(e){}}}),this.registerRegenerateCallback("keySelectionModal",()=>{const e=document.getElementById("keySelectionModal"),t=e?.querySelector(".tab-content .tab-pane.active");if(t){const e=t.id.replace("Tab","");window.app?.populateKeyTab?.(e)}}),this.registerRegenerateCallback("vertigoModal",()=>{this.eventBus?this.emit("vfx:modal-regenerate-requested"):window.app?.populateVertigoModal?.()}),this.registerRegenerateCallback("profileModal",()=>{const e=document.getElementById("profileModal");window.applyTranslations?.(e)}),this.registerRegenerateCallback("fileExplorerModal",()=>{window.stoFileExplorer?.refreshFileList?.()}),this.registerRegenerateCallback("aboutModal",()=>{const e=document.getElementById("aboutModal");window.applyTranslations?.(e)})}}class Oe extends oe{constructor(e,t){super(e),this.componentName="VFXManagerService",this.i18n=t,this.selectedEffects={space:new Set,ground:new Set},this.showPlayerSay=!1,this.isInitialized=!1,this.eventBus&&this.respond("vfx:get-virtual-aliases",()=>this.getVirtualVFXAliases())}onInit(){this.isInitialized?console.log(`[${this.componentName}] Already initialized`):(this.setupEventListeners(),this.isInitialized=!0,console.log(`[${this.componentName}] Initialized`))}handleInitialState(e,t){t&&"DataCoordinator"===e&&t.currentProfileData&&(this.cache.currentProfile=t.currentProfileData.id,this.loadState(t.currentProfileData),console.log(`[${this.componentName}] Loaded initial VFX state from DataCoordinator via late-join`))}setupEventListeners(){this.eventBus.on("vfx:show-modal",this.showModal.bind(this)),this.eventBus.on("vfx:save-effects",this.saveEffects.bind(this)),this.addEventListener("profile:switched",({profileId:e,profile:t,updateSource:i})=>{"VFXManagerService"!==i?(this.cache.currentProfile=e,t&&(this.loadState(t),console.log(`[${this.componentName}] Loaded VFX state for switched profile: ${e}`))):console.log(`[${this.componentName}] Ignoring profile:switched event from our own update`)}),this.addEventListener("profile:updated",({profileId:e,profile:t,updateSource:i})=>{"VFXManagerService"!==i?e===this.cache.currentProfile&&t&&(this.loadState(t),console.log(`[${this.componentName}] Refreshed VFX state for updated profile: ${e}`)):console.log(`[${this.componentName}] Ignoring profile:updated event from our own update`)})}generateAlias(e){return 0===Array.from(this.selectedEffects[e]).length?this.i18n.t("no_effects_selected"):xe(`dynFxSetFXExclusionList_${e.charAt(0).toUpperCase()+e.slice(1)}`,{commands:this.generateAliasCommand(e).join(" $$ ")}).trim()}generateAliasCommand(e){if(!this.selectedEffects||!this.selectedEffects[e])return console.warn(`[${this.componentName}] generateAliasCommand: selectedEffects not properly initialized for ${e}`),console.warn(`[${this.componentName}] selectedEffects state:`,this.selectedEffects),[];const t=Array.from(this.selectedEffects[e]);if(console.log(`[${this.componentName}] generateAliasCommand(${e}): found ${t.length} effects:`,t),0===t.length)return console.log(`[${this.componentName}] generateAliasCommand(${e}): No effects selected, returning empty command`),[];const i=[`dynFxSetFXExlusionList ${t.join(",")}`];if(this.showPlayerSay){const e=this.cache.preferences.translateGeneratedMessages?this.i18n.t("vfx_suppression_loaded"):"VFX Suppression Loaded";i.push(`PlayerSay ${e}`)}return console.log(`[${this.componentName}] generateAliasCommand(${e}): generated commands:`,i),i}generateCombinedAliasCommand(e){const t=Array.isArray(e)?e:[e];if(!this.selectedEffects)return console.warn(`[${this.componentName}] generateCombinedAliasCommand: selectedEffects not properly initialized, returning empty command`),[];const i=[];for(const e of t){if(!this.selectedEffects[e]){console.warn(`[${this.componentName}] generateCombinedAliasCommand: selectedEffects not properly initialized for ${e}, skipping`);continue}const t=Array.from(this.selectedEffects[e]);0!==t.length&&i.push(...t)}if(0===i.length)return[];const a=[`dynFxSetFXExlusionList ${i.join(",")}`];if(this.showPlayerSay){const e=this.cache.preferences.translateGeneratedMessages?this.i18n.t("vfx_suppression_loaded"):"VFX Suppression Loaded";a.push(`PlayerSay ${e}`)}return a}toggleEffect(e,t){if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);if(!t)throw new Error(`Invalid effect: ${t} for environment: ${e}`);this.selectedEffects[e].has(t)?this.selectedEffects[e].delete(t):this.selectedEffects[e].add(t)}selectAllEffects(e){if(!window.VFX_EFFECTS[e])throw new Error(`Invalid environment: ${e}`);if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);window.VFX_EFFECTS[e].forEach(t=>{this.selectedEffects[e].add(t.effect)})}getEffectCount(e){if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);return this.selectedEffects[e].size}isEffectSelected(e,t){if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);return this.selectedEffects[e].has(t)}loadState(e){if(this.selectedEffects||(this.selectedEffects={space:new Set,ground:new Set},console.log(`[${this.componentName}] loadState: Initialized selectedEffects object`)),e&&e.vertigoSettings){const t=e.vertigoSettings;console.log(`[${this.componentName}] loadState: Found vertigoSettings in profile:`,t),this.selectedEffects.space=new Set(t.selectedEffects?.space||[]),this.selectedEffects.ground=new Set(t.selectedEffects?.ground||[]),console.log(`[${this.componentName}] loadState: Loaded space effects:`,Array.from(this.selectedEffects.space)),console.log(`[${this.componentName}] loadState: Loaded ground effects:`,Array.from(this.selectedEffects.ground)),this.showPlayerSay=t.showPlayerSay||!1}else console.log(`[${this.componentName}] loadState: No vertigoSettings found in profile, resetting to defaults`),console.log(`[${this.componentName}] loadState: Profile structure:`,e),this.selectedEffects.space.clear(),this.selectedEffects.ground.clear(),this.showPlayerSay=!1;this.emit("vfx:settings-changed",{selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay})}getVirtualVFXAliases(){const e={},t=["space","ground"];t.forEach(t=>{const i=this.generateAliasCommand(t),a=`dynFxSetFXExclusionList_${t.charAt(0).toUpperCase()+t.slice(1)}`;e[a]={commands:i,description:this.i18n.t("vfx_suppression_for_environment",{environment:t}),type:"vfx-alias",virtual:!0}});const i=this.generateCombinedAliasCommand(t);return e.dynFxSetFXExclusionList_Combined={commands:i,description:this.i18n.t("vfx_suppression_for_all_environments"),type:"vfx-alias",virtual:!0},e}async showModal(){if(console.log(`[${this.componentName}] Showing VFX modal`),this.cache.currentProfile)try{const e=(await this.request("data:get-all-profiles"))[this.cache.currentProfile];e&&(this.loadState(e),console.log(`[${this.componentName}] Loaded VFX state from profile via DataCoordinator`))}catch(e){console.error(`[${this.componentName}] Failed to load profile state:`,e)}this.emit("vfx:modal-populate",{vfxManager:this})}async saveEffects(){if(console.log(`[${this.componentName}] Saving VFX effects`),this.selectedEffects&&this.selectedEffects.space&&this.selectedEffects.ground){if(console.log(`[${this.componentName}] Current selected effects:`,this.selectedEffects),console.log(`[${this.componentName}] Show player say:`,this.showPlayerSay),console.log(`[${this.componentName}] Current profile:`,this.cache.currentProfile),this.cache.currentProfile)try{if((await this.request("data:get-all-profiles"))[this.cache.currentProfile]){console.log(`[${this.componentName}] Retrieved profile via DataCoordinator`);const e={selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay};try{await this.request("data:update-profile",{profileId:this.cache.currentProfile,properties:{vertigoSettings:e},updateSource:"VFXManagerService"}),console.log(`[${this.componentName}] VFX settings saved to profile: ${this.cache.currentProfile}`),this.emit("vfx:settings-changed",{selectedEffects:e.selectedEffects,showPlayerSay:this.showPlayerSay})}catch(e){console.error(`[${this.componentName}] ERROR: Failed to update profile:`,e)}}else console.error(`[${this.componentName}] ERROR: Could not retrieve profile: ${this.cache.currentProfile}`)}catch(e){console.error(`[${this.componentName}] ERROR: Failed to save VFX effects:`,e)}else console.error(`[${this.componentName}] ERROR: No current profile set`);this.emit("modal:hide",{modalId:"vertigoModal"})}else console.error(`[${this.componentName}] ERROR: selectedEffects not properly initialized:`,this.selectedEffects)}getCurrentState(){return{selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay}}}const Re="2.1.1",Ue={"2.0.0":{targetVersion:"2.1.0",migrations:["removeVFXAliases"]},"2.1.0":{targetVersion:"2.1.1",migrations:["fixVFXCommandSpelling"]}};function qe(e){if("string"!=typeof e)return e;let t=e.match(/^(?:STO)?TrayExecByTray\s+1\s+(\d+)\s+(\d+)$/i);return t?`+TrayExecByTray ${t[1]} ${t[2]}`:(t=e.match(/^TrayExecByTrayWithBackup\s+1\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)$/i),t?`+TrayExecByTrayWithBackup ${t[1]} ${t[2]} ${t[3]} ${t[4]}`:e)}function Ve(e){return _e(e).map(qe)}function Ge(e){if(!e||"object"!=typeof e)return e;let t=!1;const i=e.migrationVersion||"2.0.0",a=function(e,t){const i=[];let a=e||"2.0.0";for(;a!==t&&Ue[a];){const e=Ue[a];i.push({fromVersion:a,toVersion:e.targetVersion,migrations:e.migrations}),a=e.targetVersion}return i}(i,Re);for(const i of a){console.log(`[ProfileNormalizer] Migrating from ${i.fromVersion} to ${i.toVersion}`);for(const a of i.migrations)"removeVFXAliases"===a?t=We(e)||t:"fixVFXCommandSpelling"===a&&(t=Xe(e)||t)}return t=function(e){let t=!1;if(e.builds&&"object"==typeof e.builds)for(const[i,a]of Object.entries(e.builds))if(a&&a.keys&&"object"==typeof a.keys)for(const[n,s]of Object.entries(a.keys)){const a=Ze(s);JSON.stringify(a)!==JSON.stringify(s)&&(e.builds[i].keys[n]=a,t=!0)}if(e.aliases&&"object"==typeof e.aliases)for(const[i,a]of Object.entries(e.aliases))if(a&&"object"==typeof a){const n=Je(a.commands);JSON.stringify(n)!==JSON.stringify(a.commands)&&(e.aliases[i].commands=n,t=!0)}return t}(e)||t,(t||i!==Re)&&(e.lastModified=(new Date).toISOString(),e.migrationVersion=Re),e}function We(e){let t=!1;if(e.aliases&&"object"==typeof e.aliases)for(const[i,a]of Object.entries(e.aliases))a&&"object"==typeof a&&("vfx-alias"===a.type||i.startsWith("dynFxSetFXExclusionList"))&&(console.log(`[ProfileNormalizer] Removing old VFX alias: ${i}`),delete e.aliases[i],t=!0);return t}function Xe(e){let t=!1;const i=["dynFxSetFXExclusionList_Combined","dynFxSetFXExclusionList_Space","dynFxSetFXExclusionList_Ground"];if(e.aliases&&"object"==typeof e.aliases)for(const a of i)if(e.aliases[a]&&"object"==typeof e.aliases[a]){const i=e.aliases[a];if(i.commands){const n=He(i.commands);JSON.stringify(n)!==JSON.stringify(i.commands)&&(console.log(`[ProfileNormalizer] Fixing VFX command spelling in alias: ${a}`),e.aliases[a].commands=n,t=!0)}}return t}function He(e){return e?"string"==typeof e?e.replace(/\bdynFxSetFXExclusionList\b/g,"dynFxSetFXExlusionList"):Array.isArray(e)?e.map(e=>"string"==typeof e?e.replace(/\bdynFxSetFXExclusionList\b/g,"dynFxSetFXExlusionList"):e):e:e}function Ze(e){if(!e)return[];if("string"==typeof e)return e.includes("$$")?e.split(/\s*\$\$\s*/).map(e=>e.trim()).filter(e=>e.length>0):e.trim()?[e.trim()]:[];if(Array.isArray(e))return Ve(e);if("object"==typeof e){const t=fe(e);return t?[t]:[]}return console.warn("normalizeKeyCommands: Unknown format for key commands:",e),[]}function Je(e){if(!e)return[];if("string"==typeof e)return e.includes("$$")?e.split(/\s*\$\$\s*/).map(e=>e.trim()).filter(e=>e.length>0):e.trim()?[e.trim()]:[];if(Array.isArray(e))return Ve(e);if("object"==typeof e){const t=fe(e);return t?[t]:[]}return console.warn("normalizeAliasCommands: Unknown format for alias commands:",e),[]}function Ye(e){return!(!e||"object"!=typeof e)&&e.migrationVersion!==Re&&e.migrationVersion!==Re}class Qe extends oe{constructor({eventBus:e,storage:t,i18n:i}){super(e),this.componentName="DataCoordinator",this.storage=t,this.i18n=i,this.state={currentProfile:null,currentEnvironment:"space",profiles:{},settings:{},metadata:{lastModified:null,version:"1.0.0"}},this.setupRequestHandlers()}async onInit(){console.log(`[${this.componentName}] Initializing...`),this.setupEventListeners(),await this.loadInitialState(),console.log(`[${this.componentName}] Initialization complete`)}setupEventListeners(){this.addEventListener("storage:data-reset",({data:e})=>{console.log("[DataCoordinator] Handling storage reset, reloading state"),this.state.currentProfile=null,this.state.profiles={},this.state.settings=e?.settings||{},this.state.currentEnvironment="space",this.emit("profile:updated",{profileId:null,profile:null,updateSource:"DataCoordinator-Reset"},{synchronous:!0}),this.emit("profile:switched",{profileId:null,profile:null,environment:"space",updateSource:"DataCoordinator-Reset"},{synchronous:!0})}),this.addEventListener("data:load-default",()=>{this.handleLoadDefaultData()})}async handleLoadDefaultData(){console.log("[DataCoordinator] Handling load default data request");try{const e=Object.entries(this.state.profiles).find(([e,t])=>t.name&&"default"===t.name.toLowerCase());if(e){const[t,i]=e;if(console.log(`[DataCoordinator] Default profile already exists: ${t} - "${i.name}"`),"undefined"==typeof window||!window.confirmDialog)return void("undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Default profile already exists. Will not overwrite.","warning"));{const e=this.i18n.t("default_profile_exists_message"),t=this.i18n.t("default_profile_exists_title");if(!await window.confirmDialog.confirm(e,t,"warning","loadDefaultData"))return void console.log("[DataCoordinator] User cancelled default data load")}}console.log("[DataCoordinator] Loading default data...");const t=await this.loadDefaultData();t.success?("undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Default data loaded successfully.","success"),console.log("[DataCoordinator] Default data loaded successfully")):("undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Failed to load default data.","error"),console.error("[DataCoordinator] Failed to load default data:",t.error))}catch(e){console.error("[DataCoordinator] Error handling load default data:",e),"undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Error loading default data.","error")}}setupRequestHandlers(){this.respond("data:get-current-state",()=>this.getCurrentState()),this.respond("data:get-all-profiles",()=>this.getAllProfiles()),this.respond("data:switch-profile",({profileId:e})=>this.switchProfile(e)),this.respond("data:create-profile",({name:e,description:t,mode:i})=>this.createProfile(e,t,i)),this.respond("data:clone-profile",({sourceId:e,newName:t})=>this.cloneProfile(e,t)),this.respond("data:rename-profile",({profileId:e,newName:t,description:i})=>this.renameProfile(e,t,i)),this.respond("data:delete-profile",({profileId:e})=>this.deleteProfile(e)),this.respond("data:update-profile",(e={})=>{const{profileId:t,updates:i}=e||{};let a=i;if(!a){const{add:t,delete:i,modify:n,properties:s}=e;(t||i||n||s)&&(a={add:t,delete:i,modify:n,properties:s})}return!e.updateSource||a&&a.updateSource||(a||(a={}),a.updateSource=e.updateSource),this.updateProfile(t,a)}),this.respond("data:set-environment",({environment:e})=>this.setEnvironment(e)),this.respond("data:get-settings",()=>this.getSettings()),this.respond("data:update-settings",({settings:e})=>this.updateSettings(e)),this.respond("data:load-default-data",()=>this.loadDefaultData()),this.respond("data:reload-state",()=>this.reloadState()),this.respond("data:get-keys",({environment:e}={})=>this.getKeys(e)),this.respond("data:get-key-commands",({environment:e,key:t}={})=>this.getKeyCommands(e,t))}async loadInitialState(){try{const e=this.storage.getAllData();if(this.state.currentProfile=e.currentProfile,this.state.profiles=e.profiles||{},this.state.settings=e.settings||{},await this.normalizeAllProfiles(),0===Object.keys(this.state.profiles).length&&(localStorage.getItem("sto_keybind_manager_visited")?console.log(`[${this.componentName}] No profiles found, but not first run - leaving empty (user may have reset)`):(this.needsDefaultProfiles=!0,console.log(`[${this.componentName}] First time run - no profiles found, will create defaults when DataService is available`),this.tryCreateDefaultProfiles())),!this.state.currentProfile&&Object.keys(this.state.profiles).length>0){this.state.currentProfile=Object.keys(this.state.profiles)[0];const e=this.storage.getAllData();e.currentProfile=this.state.currentProfile,await this.storage.saveAllData(e)}this.state.currentProfile&&this.state.profiles[this.state.currentProfile]&&(this.state.currentEnvironment=this.state.profiles[this.state.currentProfile].currentEnvironment||"space"),this.state.metadata={lastModified:e.lastModified,version:e.version||"1.0.0"},console.log(`[${this.componentName}] Loaded initial state:`,{currentProfile:this.state.currentProfile,environment:this.state.currentEnvironment,profileCount:Object.keys(this.state.profiles).length})}catch(e){console.error(`[${this.componentName}] Failed to load initial state:`,e);const t=this.i18n.t("failed_to_load_profile_data",{error:e.message});throw new Error(t)}}getCurrentState(){let e=null;if(this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const t=this.state.profiles[this.state.currentProfile];e=this.buildVirtualProfile(t,this.state.currentEnvironment),e.id=this.state.currentProfile}return{currentProfile:this.state.currentProfile,currentEnvironment:this.state.currentEnvironment,profiles:{...this.state.profiles},settings:{...this.state.settings},metadata:{...this.state.metadata},currentProfileData:e}}async getAllProfiles(){return{...this.state.profiles}}buildVirtualProfile(e,t){if(!e)return null;e.builds||(e.builds={space:{keys:{}},ground:{keys:{}}}),e.builds[t]||(e.builds[t]={keys:{}});let i={...e.builds[t].keys||{}};return{...e,keys:i,aliases:e.aliases||{},keybindMetadata:e.keybindMetadata||{},aliasMetadata:e.aliasMetadata||{},environment:t}}async switchProfile(e){if(e===this.state.currentProfile){let e=null;if(this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const t=this.state.profiles[this.state.currentProfile];e=this.buildVirtualProfile(t,this.state.currentEnvironment)}return{success:!0,switched:!1,message:this.i18n.t("already_on_profile"),profile:e}}const t=this.state.profiles[e];if(!t)throw new Error(`Profile ${e} not found`);const i=this.state.currentProfile;this.state.currentProfile=e,this.state.currentEnvironment=t.currentEnvironment||"space";const a=this.storage.getAllData();a.currentProfile=e,await this.storage.saveAllData(a),this.state.metadata.lastModified=(new Date).toISOString();const n=this.buildVirtualProfile(t,this.state.currentEnvironment);return this.emit("profile:switched",{fromProfile:i,toProfile:e,profileId:e,profile:n,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0}),{success:!0,switched:!0,profile:n,message:this.i18n.t("switched_to_profile",{name:t.name,environment:this.state.currentEnvironment})}}async createProfile(e,t="",i="space"){if(!e||!e.trim()){const e=this.i18n.t("profile_name_is_required");throw new Error(e)}const a=this.generateProfileId(e);if(this.state.profiles[a]){const e=this.i18n.t("profile_already_exists");throw new Error(e)}const n={name:e.trim(),description:t.trim(),currentEnvironment:i,builds:{space:{keys:{}},ground:{keys:{}}},aliases:{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()};try{return await this.storage.saveProfile(a,n),this.state.profiles[a]=n,this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:created",{profileId:a,profile:n,timestamp:Date.now()}),{success:!0,profileId:a,profile:n,message:this.i18n.t("profile_created",{name:e})}}catch(e){const t=this.i18n.t("failed_to_create_profile",{error:e.message});throw new Error(t)}}async cloneProfile(e,t){if(!e||!t||!t.trim()){const e=this.i18n.t("source_profile_and_new_name_required");throw new Error(e)}const i=this.state.profiles[e];if(!i){const e=this.i18n.t("source_profile_not_found");throw new Error(e)}const a=this.generateProfileId(t);if(this.state.profiles[a]){const e=this.i18n.t("profile_already_exists");throw new Error(e)}const n={...JSON.parse(JSON.stringify(i)),name:t.trim(),description:`Copy of ${i.name}`,created:(new Date).toISOString(),lastModified:(new Date).toISOString()};try{return await this.storage.saveProfile(a,n),this.state.profiles[a]=n,this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:created",{profileId:a,profile:n,clonedFrom:e,timestamp:Date.now()}),{success:!0,profileId:a,profile:n,message:this.i18n.t("profile_created_from",{newName:t,sourceProfile:i.name})}}catch(e){const t=this.i18n.t("failed_to_clone_profile",{error:e.message});throw new Error(t)}}async renameProfile(e,t,i=""){if(!e||!t||!t.trim()){const e=this.i18n.t("profile_name_is_required");throw new Error(e)}const a=this.state.profiles[e];if(!a){const e=this.i18n.t("profile_not_found");throw new Error(e)}const n={...a,name:t.trim(),description:i.trim(),lastModified:(new Date).toISOString()};try{return await this.storage.saveProfile(e,n),this.state.profiles[e]=n,this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:updated",{profileId:e,profile:n,changes:{name:t,description:i},timestamp:Date.now()}),{success:!0,profile:n,message:`Profile renamed to "${t}"`}}catch(e){const t=this.i18n.t("failed_to_rename_profile",{error:e.message});throw new Error(t)}}async deleteProfile(e){if(!e){const e=this.i18n.t("profile_id_required");throw new Error(e)}const t=this.state.profiles[e];if(!t){const e=this.i18n.t("profile_not_found");throw new Error(e)}if(Object.keys(this.state.profiles).length<=1){const e=this.i18n.t("cannot_delete_the_last_profile");throw new Error(e)}try{await this.storage.deleteProfile(e),delete this.state.profiles[e];let i=null;if(this.state.currentProfile===e){const t=Object.keys(this.state.profiles);this.state.currentProfile=t[0];const a=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=a.currentEnvironment||"space";const n=this.storage.getAllData();n.currentProfile=this.state.currentProfile,await this.storage.saveAllData(n),i=this.buildVirtualProfile(a,this.state.currentEnvironment),this.emit("profile:switched",{fromProfile:e,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:i,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}return this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:deleted",{profileId:e,profile:t,switchedProfile:i,timestamp:Date.now()}),{success:!0,deletedProfile:t,switchedProfile:i,message:this.i18n.t("profile_deleted",{profileName:t.name})}}catch(e){const t=this.i18n.t("failed_to_delete_profile",{error:e.message});throw new Error(t)}}processUpdateOperations(e,t){const i=JSON.parse(JSON.stringify(e));if(t.delete){if(t.delete.aliases&&t.delete.aliases.forEach(e=>{i.aliases&&delete i.aliases[e]}),t.delete.builds)for(const[e,a]of Object.entries(t.delete.builds))i.builds?.[e]?.keys&&a.keys&&a.keys.forEach(t=>{delete i.builds[e].keys[t]});t.delete.bindsets&&Array.isArray(t.delete.bindsets)&&t.delete.bindsets.forEach(e=>{i.bindsets&&delete i.bindsets[e]})}if(t.add){if(t.add.aliases&&(i.aliases={...i.aliases||{},...t.add.aliases}),t.add.builds){i.builds=i.builds||{space:{keys:{}},ground:{keys:{}}};for(const[e,a]of Object.entries(t.add.builds))i.builds[e]=i.builds[e]||{keys:{}},a.keys&&(i.builds[e].keys={...i.builds[e].keys||{},...a.keys})}t.add.bindsets&&(i.bindsets={...i.bindsets||{},...t.add.bindsets})}if(t.modify){if(t.modify.aliases){i.aliases=i.aliases||{};for(const[e,a]of Object.entries(t.modify.aliases))i.aliases[e]&&(i.aliases[e]={...i.aliases[e],...a})}if(t.modify.keybindMetadata){i.keybindMetadata=i.keybindMetadata||{};for(const[e,a]of Object.entries(t.modify.keybindMetadata)){i.keybindMetadata[e]=i.keybindMetadata[e]||{};for(const[t,n]of Object.entries(a))0===Object.keys(n).length?delete i.keybindMetadata[e][t]:i.keybindMetadata[e][t]=n}}if(t.modify.aliasMetadata){i.aliasMetadata=i.aliasMetadata||{};for(const[e,a]of Object.entries(t.modify.aliasMetadata))0===Object.keys(a).length?delete i.aliasMetadata[e]:i.aliasMetadata[e]=a}if(t.modify.builds){i.builds=i.builds||{space:{keys:{}},ground:{keys:{}}};for(const[e,a]of Object.entries(t.modify.builds))if(i.builds[e]=i.builds[e]||{keys:{}},a.keys){i.builds[e].keys=i.builds[e].keys||{};for(const[t,n]of Object.entries(a.keys))i.builds[e].keys[t]&&(i.builds[e].keys[t]=n)}}if(t.modify.bindsets){i.bindsets=i.bindsets||{};for(const[e,a]of Object.entries(t.modify.bindsets)){i.bindsets[e]=i.bindsets[e]||{space:{keys:{}},ground:{keys:{}}};for(const[t,n]of Object.entries(a))if(i.bindsets[e][t]=i.bindsets[e][t]||{keys:{}},n.keys){i.bindsets[e][t].keys=i.bindsets[e][t].keys||{},console.log("[DataCoordinator] Incoming envData.keys for bindset",e,t,JSON.stringify(n.keys));for(const[a,s]of Object.entries(n.keys))null===s?delete i.bindsets[e][t].keys[a]:i.bindsets[e][t].keys[a]=s;console.log("[DataCoordinator] Resulting keys for bindset",e,t,JSON.stringify(i.bindsets[e][t].keys))}}}if(t.modify.bindsetMetadata){i.bindsetMetadata=i.bindsetMetadata||{};for(const[e,a]of Object.entries(t.modify.bindsetMetadata)){i.bindsetMetadata[e]=i.bindsetMetadata[e]||{};for(const[t,n]of Object.entries(a)){i.bindsetMetadata[e][t]=i.bindsetMetadata[e][t]||{};for(const[a,s]of Object.entries(n))0===Object.keys(s).length?delete i.bindsetMetadata[e][t][a]:i.bindsetMetadata[e][t][a]={...i.bindsetMetadata[e][t][a]||{},...s}}}}}return t.properties&&Object.assign(i,t.properties),i}async updateProfile(e,t){if(!e)throw new Error("Profile ID is required");if(!t||null===t)throw new Error("Updates are required");const i=this.state.profiles[e];if(!i)throw new Error(`Profile ${e} not found`);const{updateSource:a,...n}=t;if(!(n.add||n.delete||n.modify||n.properties))throw new Error("Explicit operations (add/delete/modify/properties) required");const s=this.processUpdateOperations(i,{...n,properties:{...n.properties||{},lastModified:(new Date).toISOString()}});try{return console.log(`[${this.componentName}] Saving profile ${e} to storage:`,s),await this.storage.saveProfile(e,s),this.state.profiles[e]=s,this.state.metadata.lastModified=(new Date).toISOString(),!!(n.add||n.delete||n.modify)&&this.emit("profile:updated",{profileId:e,profile:s,updates:n,updateSource:a,timestamp:Date.now()}),{success:!0,profile:s}}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}}async setEnvironment(e){if(!e||!["space","ground","alias"].includes(e))throw new Error("Invalid environment");const t=this.state.currentEnvironment;if(this.state.currentEnvironment=e,this.state.currentProfile){const t={properties:{currentEnvironment:e}};await this.updateProfile(this.state.currentProfile,t)}return this.emit("environment:changed",{fromEnvironment:t,toEnvironment:e,environment:e,timestamp:Date.now()},{synchronous:!0}),{success:!0,environment:e}}getKeys(e){if(!this.state.currentProfile)return{};const t=this.state.profiles[this.state.currentProfile];if(!t||!t.builds||!t.builds[e])return{};const i=t.builds[e].keys||{},a=this.state.currentBindset||"Primary Bindset";if("Primary Bindset"===a)return i;const n=t.bindsets?.[a]?.[e]?.keys||{};return{...i,...n}}getKeyCommands(e,t){const i=this.getKeys(e)[t]||[];return Array.isArray(i)?[...i]:i}async getSettings(){return{...this.state.settings}}async updateSettings(e){if(!e)throw new Error("Settings are required");return this.state.settings={...this.state.settings,...e},await this.storage.saveSettings(this.state.settings),this.state.metadata.lastModified=(new Date).toISOString(),this.emit("settings:changed",{settings:this.state.settings,updates:e,timestamp:Date.now()}),{success:!0,settings:this.state.settings}}async loadDefaultData(){console.log(`[${this.componentName}] Explicitly loading default data...`);try{const e=await this.request("data:get-default-profiles");return e&&0!==Object.keys(e).length?(await this.createDefaultProfilesFromData(e),console.log(`[${this.componentName}] Successfully loaded default data`),{success:!0,profilesCreated:Object.keys(e).length,currentProfile:this.state.currentProfile}):(console.warn(`[${this.componentName}] No default profiles available from DataService`),{success:!1,error:"No default profiles available"})}catch(e){return console.error(`[${this.componentName}] Failed to load default data:`,e),{success:!1,error:e.message}}}async tryCreateDefaultProfiles(){if(this.needsDefaultProfiles)try{console.log(`[${this.componentName}] Attempting to get default profiles from DataService...`);const e=await this.request("data:get-default-profiles");e&&Object.keys(e).length>0?(console.log(`[${this.componentName}] Got default profiles from DataService, creating...`),await this.createDefaultProfilesFromData(e),this.needsDefaultProfiles=!1):console.log(`[${this.componentName}] No default profiles from DataService, will try again later`)}catch(e){console.error(`[${this.componentName}] Failed to create default profiles:`,e.message),this.emit("profiles:creation-failed",{error:e.message})}}async handleInitialState(e,t){console.log(`[${this.componentName}] handleInitialState called - sender: "${e}", needsDefaultProfiles: ${this.needsDefaultProfiles}`),console.log(`[${this.componentName}] Received state from ${e}:`,t),"DataService"===e&&this.needsDefaultProfiles&&(console.log(`[${this.componentName}] DataService is now available, trying to create default profiles...`),await this.tryCreateDefaultProfiles())}async createDefaultProfilesFromData(e){if(!e||0===Object.keys(e).length)return console.warn(`[${this.componentName}] No default profiles data available, creating minimal fallback`),void await this.createFallbackProfiles();const t={};for(const[i,a]of Object.entries(e)){const e={name:a.name,description:a.description||"",currentEnvironment:a.currentEnvironment||"space",builds:a.builds||{space:{keys:{}},ground:{keys:{}}},aliases:a.aliases||{},selections:a.selections||{},keybindMetadata:a.keybindMetadata||{},aliasMetadata:a.aliasMetadata||{},bindsetMetadata:a.bindsetMetadata||{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()};Ge(e),t[i]=e}for(const[e,i]of Object.entries(t))try{await this.storage.saveProfile(e,i),this.state.profiles[e]=i}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}let i=!1;if(!this.state.currentProfile&&Object.keys(t).length>0){this.state.currentProfile=Object.keys(t)[0],i=!0;const e=this.storage.getAllData();e.currentProfile=this.state.currentProfile,await this.storage.saveAllData(e);const a=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=a.currentEnvironment||"space"}if(this.state.metadata.lastModified=(new Date).toISOString(),console.log(`[${this.componentName}] Created ${Object.keys(t).length} default profiles from DataService`),this.emit("profiles:initialized",{profiles:this.state.profiles,currentProfile:this.state.currentProfile,timestamp:Date.now()}),i&&this.state.currentProfile){const e=this.state.profiles[this.state.currentProfile],t=this.buildVirtualProfile(e,this.state.currentEnvironment);console.log(`[${this.componentName}] Emitting profile:switched for initial profile activation: ${this.state.currentProfile}`),this.emit("profile:switched",{fromProfile:null,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:t,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}}async createFallbackProfiles(){const e={default:{name:"Default",description:"Basic space build profile",currentEnvironment:"space",builds:{space:{keys:{}},ground:{keys:{}}},aliases:{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()}};for(const[t,i]of Object.entries(e)){Ge(i);try{await this.storage.saveProfile(t,i),this.state.profiles[t]=i}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}}let t=!1;if(!this.state.currentProfile){this.state.currentProfile="default",t=!0;const e=this.storage.getAllData();e.currentProfile=this.state.currentProfile,await this.storage.saveAllData(e);const i=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=i.currentEnvironment||"space"}if(this.state.metadata.lastModified=(new Date).toISOString(),console.log(`[${this.componentName}] Created ${Object.keys(e).length} fallback profiles`),this.emit("profiles:initialized",{profiles:this.state.profiles,currentProfile:this.state.currentProfile,timestamp:Date.now()}),t&&this.state.currentProfile){const e=this.state.profiles[this.state.currentProfile],t=this.buildVirtualProfile(e,this.state.currentEnvironment);console.log(`[${this.componentName}] Emitting profile:switched for initial fallback profile activation: ${this.state.currentProfile}`),this.emit("profile:switched",{fromProfile:null,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:t,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}}generateProfileId(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,50)}async normalizeAllProfiles(){let e=0;for(const[t,i]of Object.entries(this.state.profiles))if(Ye(i)){console.log(`[${this.componentName}] Migrating profile: ${t}`);const a=i.migrationVersion||"2.0.0";Ge(i);const n=i.migrationVersion;try{await this.storage.saveProfile(t,i),e++,console.log(`[${this.componentName}] Profile ${t} migrated from ${a} to ${n}`)}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}}e>0&&console.log(`[${this.componentName}] Migrated ${e} profiles`)}async reloadState(){console.log(`[${this.componentName}] Reloading state from storage...`);try{const e=this.storage.getAllData();if(this.state.profiles=e.profiles||{},this.state.currentProfile=e.currentProfile||null,this.state.settings=e.settings||{},await this.normalizeAllProfiles(),this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const e=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=e.currentEnvironment||"space"}else this.state.currentEnvironment="space";if(this.state.metadata.lastModified=(new Date).toISOString(),console.log(`[${this.componentName}] State reloaded. Current profile: ${this.state.currentProfile}, Environment: ${this.state.currentEnvironment}`),this.emit("profiles:initialized",{profiles:this.state.profiles,currentProfile:this.state.currentProfile,timestamp:Date.now()}),this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const e=this.state.profiles[this.state.currentProfile],t=this.buildVirtualProfile(e,this.state.currentEnvironment);this.emit("profile:switched",{fromProfile:null,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:t,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}return this.emit("environment:changed",{fromEnvironment:null,toEnvironment:this.state.currentEnvironment,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0}),this.emit("settings:changed",{settings:this.state.settings,updates:this.state.settings,timestamp:Date.now()}),console.log(`[${this.componentName}] Emitted refresh events after state reload`),{success:!0,profiles:Object.keys(this.state.profiles).length,currentProfile:this.state.currentProfile,environment:this.state.currentEnvironment}}catch(e){return console.error(`[${this.componentName}] Failed to reload state:`,e),{success:!1,error:e.message}}}}class et{constructor({id:e,defaultSeverity:t,messageKey:i,tags:a=[]}={}){if(!e)throw new Error('Validator requires "id"');if(!t)throw new Error('Validator requires "defaultSeverity"');if(!i)throw new Error('Validator requires "messageKey"');this.id=e,this.level=t,this.messageKey=i,this.tags=a}validate(){throw new Error("validate(ctx) not implemented")}run(e){const t=this.validate(e);return t?{id:this.id,severity:t.severity||this.level,key:"function"==typeof t.key?t.key(e):t.key||this.messageKey,params:t.params||{},defaultMessage:t.defaultMessage}:null}}const tt=/trayexec|slot|stotrayexec/i,it="undefined"!=typeof window&&window.COMMANDS?window.COMMANDS:{};function at(e){if(!e)return null;const t=e.trim().split(/\s+/)[0].toLowerCase();for(const e in it){const i=it[e];if(i&&i.command&&i.command.toLowerCase()===t)return i.environment||null}return null}const nt="undefined"!=typeof window&&window.COMMANDS?window.COMMANDS:{};function st(e){if(!e)return null;const t=e.trim().toLowerCase();for(const e in nt){const i=nt[e];if(!i||!i.command)continue;const a=i.command.trim().toLowerCase();if(t===a)return{...i,he:e};if(t.startsWith(a))return{...i,he:e};if(t.split(/\s+/)[0]===a)return{...i,he:e}}return null}const rt=new Set(t.map(e=>e.toUpperCase())),ot=[new class extends et{constructor(){super({id:"maxLength",defaultSeverity:"warning",messageKey:"command_chain_near_limit",tags:["length","performance"]})}validate(e){const{length:t}=e;return t>=990?{severity:"error",key:"command_chain_too_long",params:{length:t},defaultMessage:`Command chain exceeds safe length (${t}/999). It may fail in game.`}:t>=900?{params:{length:t},defaultMessage:`Command chain is ${t} characters; consider shortening (limit 999).`}:null}},new class extends et{constructor(){super({id:"stabilizedTrayOnly",defaultSeverity:"warning",messageKey:"stabilized_non_tray_warning"})}validate(e){const{stabilized:t,commands:i}=e;return t&&Array.isArray(i)&&0!==i.length&&i.some(e=>{const t="string"==typeof e?e:e.command||"";return!tt.test(t)})?{severity:"warning",key:"stabilized_non_tray_warning",defaultMessage:"Stabilized execution should only be used with tray execution abilities."}:null}},new class extends et{constructor(){super({id:"keyCommandCount",defaultSeverity:"warning",messageKey:"too_many_commands_on_key"})}validate(e){const{isAlias:t,commands:i}=e;return t||!Array.isArray(i)?null:i.length>20?{severity:"warning",key:"too_many_commands_on_key",params:{count:i.length},defaultMessage:`Binding ${i.length} commands to one key may fail in game (max recommended 20).`}:null}},new class extends et{constructor(){super({id:"aliasMixedEnvironment",defaultSeverity:"warning",messageKey:"alias_mixed_environment_warning"})}validate(e){const{isAlias:t,commands:i}=e;if(!t||!Array.isArray(i))return null;let a=!1,n=!1;for(const e of i){const t=at("string"==typeof e?e:e.command||"");if("space"===t?a=!0:"ground"===t&&(n=!0),a&&n)break}return a&&n?{severity:"warning",key:"alias_mixed_environment_warning",defaultMessage:"Alias contains both space-only and ground-only commands; consider splitting for reliability."}:null}},new class extends et{constructor(){super({id:"commandWarnings",defaultSeverity:"warning",messageKey:"_internal_command_warning"})}get i18n(){return"undefined"!=typeof window&&window.i18next?window.i18next:null}validate(e){const{commands:t}=e;if(!Array.isArray(t)||0===t.length)return null;const i=[];for(const e of t){const t="string"==typeof e?e:e.command||"",a=st(t);if(a&&a.warning){let e=a.name||t;if(a.he&&this.i18n){const t=`command_definitions.${a.he}.name`,i=this.i18n.t(t);i&&i!==t&&(e=i)}let n=a.warning;if(this.i18n){const e=this.i18n.t(a.warning);n=e&&e!==a.warning?e:a.warning}i.push({name:e,warnText:n})}}return i}run(e){const t=this.validate(e);return t&&0!==t.length?t.map(({name:e,warnText:t})=>({id:this.id,severity:"warning",defaultMessage:`${e} - ${t}`})):null}}({i18n:"undefined"!=typeof window&&window.i18next?window.i18next:null}),new class extends et{constructor(){super({id:"unsafeKeybind",defaultSeverity:"warning",messageKey:"unsafe_keybind"})}validate(e){const{key:t}=e||{};if(!t)return null;const i=t.trim().toUpperCase();return rt.has(i)?{severity:"warning",params:{key:t}}:null}},new class extends et{constructor(){super({id:"stoTrayExecOptimization",defaultSeverity:"warning",messageKey:"sto_tray_exec_optimization_suggestion",tags:["length","optimization","tray"]})}validate(e){const{length:t,generatedCommand:i}=e;if(t<900)return null;const a=i.match(/STOTrayExecByTray/g),n=a?a.length:0;if(n>0){const e=3*n,i=t-e;return{severity:"warning",key:"sto_tray_exec_optimization_suggestion",params:{currentLength:t,potentialSavings:e,newLength:i,count:n},defaultMessage:`Command chain is ${t} characters. Replacing ${n} instance(s) of STOTrayExecByTray with TrayExecByTray would save ${e} characters (new length: ${i}).`}}return null}}];class ct extends oe{constructor({eventBus:e,i18n:t,ui:i=null}={}){super(e),this.componentName="CommandChainValidatorService",this.i18n=t,this.ui=i}onInit(){this.addEventListener("command-chain:validate",async({key:e,stabilized:t,isAlias:i})=>{await this.validateChain(e,t,i)})}async validateChain(e,t=void 0,i=void 0){if(!this.ue){this.ue=!0;try{const a=await this.request("command:get-for-selected-key");Array.isArray(a)||console.warn("[CommandChainValidatorService] No commands array returned â€“ proceeding with empty list");const n=Array.isArray(a)?a:[],s=await this.request("command:generate-command-preview",{key:e,commands:n,stabilize:!1}),r=void 0!==t&&t,o=void 0!==i&&i;let c,l;if(r&&n.length>1){const t=await this.request("command:generate-command-preview",{key:e,commands:n,stabilize:!0});c=t.length,l=t}else c=s.length,l=s;const d={key:e,commands:n,length:c,stabilized:r,isAlias:o,generatedCommand:l},m=ot.flatMap(e=>{const t=e.run(d);return t?Array.isArray(t)?t:[t]:[]}),h=m.filter(e=>"error"===e.severity),u=m.filter(e=>"warning"===e.severity),p=h.length?"error":u.length?"warning":"success";this.emit("command-chain:validation-result",{key:e,length:c,severity:p,warnings:u,errors:h}),this.pe||(this.pe={}),this.pe[e],this.pe[e]=p}catch(e){console.error("[CommandChainValidatorService] validateChain failed:",e)}finally{this.ue=!1}}}}class lt extends oe{constructor(e=null){super(e),this.pendingInitialRender=!1}uiInit(){this.hasRequiredData()?this.performInitialRender():this.pendingInitialRender=!0}onInit(){}handleInitialState(e,t){super.handleInitialState(e,t),this.pendingInitialRender&&this.hasRequiredData()&&(this.pendingInitialRender=!1,this.performInitialRender())}hasRequiredData(){return!0}performInitialRender(){}showToast(e,t="info"){this.emit("toast:show",{message:e,type:t})}}class dt extends lt{constructor({eventBus:e,storage:t,ui:i,fileSystem:a,document:n=window.document,i18n:s}={}){super(e),this.componentName="FileExplorerUI",this.storage=t||window.storageService||null,this.ui=i||window.stoUI||null,this.fileSystem=a||Ee.ce(),this.document=n,this.i18n=s,this.modalId="fileExplorerModal",this.treeId="fileTree",this.contentId="fileContent",this.selectedNode=null}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventBus.on("file-explorer:open",()=>{this.openExplorer()}),this.onDom("fileExplorerBtn","click","fileExplorer-open",()=>{this.openExplorer()}),this.onDom(this.treeId,"click","fileExplorer-tree-click",e=>{const t=e.target.closest(".tree-node");t&&this.selectNode(t)}),this.onDom("copyFileContentBtn","click","fileExplorer-copy-content",async()=>{const e=this.document.getElementById(this.contentId);if(!e)return;const t=e.textContent||"";if(!t.trim())return void this.showToast(i18next.t("nothing_to_copy"),"warning");const i=await this.request("utility:copy-to-clipboard",{text:t});i?.success?this.showToast(i18next.t?.(i?.message),"success"):this.showToast(i18next.t?.(i?.message),"error")}),this.onDom("downloadFileBtn","click","fileExplorer-download",async()=>{if(!this.selectedNode)return;const{type:e,profileId:t,environment:i}=this.selectedNode,a=this.document.getElementById(this.contentId);if(!a)return;const n=a.textContent||"";if(!n.trim())return;let s=i18next.t("default_export_filename");if(this.storage){const a=this.storage.getProfile(t);try{"build"===e?s=await this.request("export:generate-filename",{profile:a,extension:"txt",environment:i}):"aliases"===e&&(s=await this.request("export:generate-alias-filename",{profile:a,extension:"txt"}))}catch(e){console.error("Failed to generate filename via ExportService:",e)}}this.downloadFile(n,s,"text/plain")})}openExplorer(){this.buildTree();const e=this.document.getElementById(this.contentId);e&&(e.textContent=i18next.t("select_an_item_on_the_left_to_preview_export")),this.emit("modal:show",{modalId:this.modalId})}buildTree(){const e=this.document.getElementById(this.treeId);if(!e||!this.storage)return;e.innerHTML="";const t=this.storage.getAllData().profiles||{};Object.entries(t).forEach(([t,i])=>{const a=this.createNode("profile",i.name,{profileId:t}),n=this.document.createElement("div");if(n.className="tree-children",i.builds&&i.builds.space){const e=this.createNode("build",this.i18n.t("space_build"),{profileId:t,environment:"space"});n.appendChild(e)}if(i.builds&&i.builds.ground){const e=this.createNode("build",this.i18n.t("ground_build"),{profileId:t,environment:"ground"});n.appendChild(e)}const s=this.createNode("aliases",this.i18n.t("aliases"),{profileId:t});n.appendChild(s),a.appendChild(n),e.appendChild(a)})}createNode(e,t,i={}){const a=this.document.createElement("div");return a.className=`tree-node ${e}`,a.textContent=t,a.dataset.type=e,Object.entries(i).forEach(([e,t])=>a.setAttribute(`data-${e}`,t)),a}async selectNode(e){const t=this.document.querySelector(".tree-node.selected");t&&t.classList.remove("selected"),e.classList.add("selected");const i=e.dataset.type||e.getAttribute("data-type"),a=e.getAttribute("data-profileid"),n=e.getAttribute("data-environment");if(this.selectedNode={type:i,profileId:a,environment:n},a&&this.storage)try{let e="";e="build"===i?await this.generateBuildExport(a,n):"aliases"===i?await this.generateAliasExport(a):i18next.t("select_a_space_ground_build_or_aliases_to_preview_export");const t=this.document.getElementById(this.contentId);t&&(t.textContent=e||i18next.t("no_content_available"))}catch(e){console.error("Failed to generate export content:",e),this.ui?.showToast(i18next.t("failed_to_generate_export"),"error")}}async generateBuildExport(e,t){const i=this.storage.getProfile(e);return i&&i.builds&&i.builds[t]?await this.request("export:generate-keybind-file",{profileId:e,environment:t}).catch(e=>(console.error("Failed to generate keybind export via ExportService:",e),`; Failed to generate export: ${e.message}`)):""}async generateAliasExport(e){const t=this.storage.getProfile(e);return t?await this.request("export:generate-alias-file",{profileId:e}).catch(e=>(console.error("Failed to generate alias export via ExportService:",e),`; Failed to generate export: ${e.message}`)):""({...t.aliases||{},...t.builds?.space?.aliases||{},...t.builds?.ground?.aliases||{}})}downloadFile(e,t,i){const a=new Blob([e],{type:i}),n=URL.createObjectURL(a),s=this.document.createElement("a");s.href=n,s.download=t,this.document.body.appendChild(s),s.click(),this.document.body.removeChild(s),URL.revokeObjectURL(n)}}const mt=new Proxy({currentProfile:null,currentMode:"space",currentEnvironment:"space",selectedKey:null,isModified:!1,undoStack:[],redoStack:[],maxUndoSteps:50,commandIdCounter:0},{set:(e,t,i)=>(e[t]=i,c&&c.emit&&c.emit(`store:${t}`,i),!0)});class ht extends lt{constructor({eventBus:e,ui:t=null,modalManager:i=null,confirmDialog:a=null,document:n=null,i18n:s}){super(e),this.componentName="ProfileUI",this.ui=t,this.modalManager=i,this.confirmDialog=a||("undefined"!=typeof window?window.confirmDialog:null),this.document=n||("undefined"!=typeof window?window.document:null),this.i18n=s,this.fe=!1,this.currentModal=null,this.eventListenersSetup=!1}onInit(){this.setupEventListeners(),this.renderProfiles(),this.updateProfileInfo()}setupEventListeners(){if(this.eventListenersSetup)return;this.eventListenersSetup=!0;const e=this.document.getElementById("profileSelect");e&&this.onDom(e,"change","profile-switch",e=>{this.handleProfileSwitch(e.target.value)}),this.onDom("newProfileBtn","click","profile-new",()=>{this.showNewProfileModal()}),this.onDom("cloneProfileBtn","click","profile-clone",()=>{this.showCloneProfileModal()}),this.onDom("renameProfileBtn","click","profile-rename",()=>{this.showRenameProfileModal()}),this.onDom("deleteProfileBtn","click","profile-delete",()=>{this.confirmDeleteProfile()}),this.onDom("saveProfileBtn","click","profile-save",()=>{this.handleProfileSave()}),this.addEventListener("profile:switched",({profileId:e,environment:t,profile:i}={})=>{this.fe=!1,this.renderProfiles(),this.updateProfileInfo()}),this.addEventListener("environment:changed",({environment:e}={})=>{this.updateProfileInfo()}),this.addEventListener("profile-modified",()=>{this.fe=!0,this.updateProfileInfo()}),this.addEventListener("current-profile:updated",({profile:e})=>{this.updateProfileInfo()})}async handleProfileSwitch(e){try{const t=await this.request("data:switch-profile",{profileId:e});t?.switched&&(this.updateProfileInfo(),this.showToast(t.message,"success"))}catch(e){this.showToast(e.message,"error")}}async renderProfiles(){const e=this.document.getElementById("profileSelect");if(!e)return;const t=await this.request("data:get-all-profiles");e.innerHTML="";const i=Object.entries(t||{});if(0===i.length){const t=this.document.createElement("option");t.value="",t.textContent=this.i18n.t("no_profiles_available"),t.disabled=!0,e.appendChild(t)}else i.forEach(([t,i])=>{const a=this.document.createElement("option");a.value=t,a.textContent=i.name,t===this.cache.currentProfile&&(a.selected=!0),e.appendChild(a)});this.updateProfileInfo()}updateProfileInfo(){this.document.querySelectorAll(".mode-btn").forEach(e=>{e.classList.toggle("active",this.cache.profile&&e.dataset.mode===this.cache.currentEnvironment),e.disabled=!this.cache.currentProfile});const e=this.document.getElementById("keyCount"),t=this.document.getElementById("aliasCount");if(!e||!t)return;if("alias"===this.cache.currentEnvironment){e.style.display="none",t.style.display="";const i=Object.keys(this.cache.aliases||{}).length,a=1===i?this.i18n.t("alias_lowercase"):this.i18n.t("aliases_lowercase");t.textContent=`${i} ${a}`}else if(e.style.display="",t.style.display="none",this.cache.profile){const t=this.cache.profile.builds?.[this.cache.currentEnvironment],i=Object.keys(t?.keys||{}).length,a=1===i?this.i18n.t("key"):this.i18n.t("keys");e.textContent=`${i} ${a}`}else e.textContent=this.i18n.t("no_profile");const i=this.document.getElementById("modifiedIndicator");i&&(i.style.display=this.fe?"inline":"none")}showNewProfileModal(){this.document.getElementById("profileModal");const e=this.document.getElementById("profileModalTitle"),t=this.document.getElementById("profileName"),i=this.document.getElementById("profileDescription");e&&(e.textContent=this.i18n.t("new_profile")),t&&(t.value="",t.placeholder="Enter profile name"),i&&(i.value=""),this.currentModal="new",this.modalManager.show("profileModal")}showCloneProfileModal(){if(!this.cache.profile)return void this.showToast(this.i18n.t("no_profile_selected_to_clone"),"warning");this.document.getElementById("profileModal");const e=this.document.getElementById("profileModalTitle"),t=this.document.getElementById("profileName"),i=this.document.getElementById("profileDescription");e&&(e.textContent=this.i18n.t("clone_profile")),t&&(t.value=`${this.cache.profile.name} Copy`,t.placeholder="Enter new profile name"),i&&(i.value=`Copy of ${this.cache.profile.name}`),this.currentModal="clone",this.modalManager.show("profileModal")}showRenameProfileModal(){if(!this.cache.profile)return void this.showToast(this.i18n.t("no_profile_selected_to_rename"),"warning");this.document.getElementById("profileModal");const e=this.document.getElementById("profileModalTitle"),t=this.document.getElementById("profileName"),i=this.document.getElementById("profileDescription");e&&(e.textContent=this.i18n.t("rename_profile")),t&&(t.value=this.cache.profile.name,t.placeholder="Enter profile name"),i&&(i.value=this.cache.profile.description||""),this.currentModal="rename",this.modalManager.show("profileModal")}async handleProfileSave(){const e=this.document.getElementById("profileName"),t=this.document.getElementById("profileDescription");if(!e)return;const i=e.value.trim(),a=t?t.value.trim():"";if(i)try{let e;switch(this.currentModal){case"new":e=await this.request("data:create-profile",{name:i,description:a}),e?.success&&(await this.request("data:switch-profile",{profileId:e.profileId}),await this.renderProfiles(),this.updateProfileInfo(),this.showToast(e.message,"success"));break;case"clone":e=await this.request("data:clone-profile",{sourceId:this.cache.currentProfile,newName:i}),e?.success&&(await this.renderProfiles(),this.showToast(e.message,"success"));break;case"rename":e=await this.request("data:rename-profile",{profileId:this.cache.currentProfile,newName:i,description:a}),e?.success&&(await this.renderProfiles(),this.updateProfileInfo(),this.showToast(e.message||this.i18n.t("profile_renamed"),"success"))}this.modalManager.hide("profileModal"),this.currentModal=null}catch(e){this.showToast(e.message,"error")}else this.showToast(this.i18n.t("profile_name_required"),"error")}async confirmDeleteProfile(){if(!this.cache.profile)return void this.showToast(this.i18n.t("no_profile_selected_to_delete"),"warning");if(!this.confirmDialog)return;const e=this.i18n.t("confirm_delete_profile",{profileName:this.cache.profile.name}),t=this.i18n.t("confirm_delete");await this.confirmDialog.confirm(e,t,"danger","profileDelete")&&this.deleteCurrentProfile()}async deleteCurrentProfile(){try{const e=await this.request("data:delete-profile",{profileId:this.cache.currentProfile});e.success&&(e.switchedProfile&&this.updateProfileInfo(),this.renderProfiles(),this.showToast(e.message,"success"))}catch(e){this.showToast(e.message,"error")}}handleInitialState(e,t){t&&"DataCoordinator"===e&&(this.renderProfiles(),this.updateProfileInfo())}getCurrentState(){return{currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment,modified:this.fe}}}class ut extends lt{constructor({eventBus:e,modalManager:t=null,i18n:i=null,ui:a=null,document:n=null}={}){super(e),this.componentName="ParameterCommandUI",this.modalManager=t,this.i18n=i,this.ui=a,this.document=n||("undefined"!=typeof window?window.document:null),this.currentParameterCommand=null}safeParseNumber(e,t){if(""===e||null==e)return;const i=Number(e);if(Number.isNaN(i))throw new d(`Invalid number for ${t}: '${e}' is not a valid number`,"INVALID_PARAMETER_NUMBER");return i}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("parameter-command:edit",({index:e,command:t,commandDef:i,categoryId:a,commandId:n})=>{i&&a&&n&&this.editParameterizedCommand(e,t,i)}),this.addEventListener("language:changed",()=>{})}showParameterModal(e,t,i){this.currentParameterCommand={categoryId:e,commandId:t,commandDef:i},this.document.getElementById("parameterModal")?this.modalManager?.registerRegenerateCallback("parameterModal",()=>{this.regenerateParameterModal()}):this.createParameterModal();const a=this.document.getElementById("parameterModal");a&&a.setAttribute("data-command-def",JSON.stringify(i)),this.populateParameterModal(i),this.modalManager?.show("parameterModal")}createParameterModal(){const e=this.document.createElement("div");e.className="modal",e.id="parameterModal",e.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3 id="parameterModalTitle" data-i18n="parameter_configuration">Parameter Configuration</h3>\n          <button class="modal-close" data-modal="parameterModal">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body">\n          <div id="parameterInputs"></div>\n          <div class="command-preview-modal">\n            <label data-i18n="generated_command">${this.i18n.t("generated_command")}</label>\n            <div class="command-preview" id="parameterCommandPreview"></div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" id="saveParameterCommandBtn">${this.i18n.t("add_command")}</button>\n          <button class="btn btn-secondary" data-modal="parameterModal">${this.i18n.t("cancel")}</button>\n        </div>\n      </div>`,this.document.body.appendChild(e),this.modalManager?.registerRegenerateCallback("parameterModal",()=>{this.regenerateParameterModal()}),this.attachModalEventHandlers()}cancelParameterCommand(){this.emit("parameter-edit:end"),this.currentParameterCommand=null;const e=this.document.getElementById("saveParameterCommandBtn");e&&(e.textContent=this.i18n.t("add_command")),this.modalManager?.hide("parameterModal")}regenerateParameterModal(){if(!this.currentParameterCommand)return;const{commandDef:e,isEditing:t,editIndex:i,originalCommand:a}=this.currentParameterCommand,n=this.getParameterValues(),s=this.document.getElementById("parameterModal");if(s)if(s.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3 id="parameterModalTitle" data-i18n="parameter_configuration">Parameter Configuration</h3>\n          <button class="modal-close" data-modal="parameterModal">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body">\n          <div id="parameterInputs"></div>\n          <div class="command-preview-modal">\n            <label data-i18n="generated_command">${this.i18n.t("generated_command")}</label>\n            <div class="command-preview" id="parameterCommandPreview"></div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" id="saveParameterCommandBtn">${this.i18n.t(t?"save":"add_command")}</button>\n          <button class="btn btn-secondary" data-modal="parameterModal">${this.i18n.t("cancel")}</button>\n        </div>\n      </div>`,this.attachModalEventHandlers(),t){this.populateParameterModalForEdit(e,n);const t=this.document.getElementById("saveParameterCommandBtn");t&&(t.textContent=this.i18n.t("save"))}else this.populateParameterModal(e)}attachModalEventHandlers(){this.onDom("saveParameterCommandBtn","click","parameter-command-save",()=>{this.saveParameterCommand()});const e=this.document.getElementById("parameterModal");e&&e.querySelectorAll('.modal-close, [data-modal="parameterModal"]').forEach(e=>{this.onDom(e,"click","parameter-modal-close",()=>{this.cancelParameterCommand()})})}populateParameterModal(e){const t=this.document.getElementById("parameterInputs"),i=this.document.getElementById("parameterModalTitle");t&&i&&(i.textContent=`${this.i18n.t("configure_colon")} ${e.name}`,t.innerHTML="",this.buildParameterInputs(t,e),this.updateParameterPreview())}editParameterizedCommand(e,t,i){const a=fe(t);this.currentParameterCommand={categoryId:i.categoryId,commandId:i.commandId,commandDef:i,editIndex:e,originalCommand:t,isEditing:!0},this.document.getElementById("parameterModal")||this.createParameterModal();const n=this.document.getElementById("parameterModal");n&&n.setAttribute("data-command-def",JSON.stringify(i)),(async()=>{try{const e=(await pe(a,this.i18n,{eventBus:this.eventBus})).parameters||{};this.populateParameterModalForEdit(i,e);const t=this.document.getElementById("saveParameterCommandBtn");t&&(t.textContent=this.i18n.t("save")),this.modalManager?.show("parameterModal")}catch(e){console.error("[ParameterCommandUI] Error enriching command for editing:",e),this.populateParameterModalForEdit(i,{}),this.modalManager?.show("parameterModal")}})()}populateParameterModalForEdit(e,t={}){const i=this.document.getElementById("parameterInputs"),a=this.document.getElementById("parameterModalTitle");i&&a&&(a.textContent=`${this.i18n.t("edit_colon")} ${e.name}`,i.innerHTML="",this.buildParameterInputs(i,e,t),this.updateParameterPreview())}async updateParameterPreview(){if(!this.currentParameterCommand)return;const{categoryId:e,commandId:t}=this.currentParameterCommand,i=this.currentParameterCommand;let a;try{a=this.getParameterValues()}catch(e){const t=this.document.getElementById("parameterCommandPreview");return void(t&&(t.textContent=e.message||"Invalid parameter values",t.style.color="#d63031"))}try{const n=await this.request("parameter-command:build",{categoryId:e,commandId:t,commandDef:i,params:a}),s=this.document.getElementById("parameterCommandPreview");if(!s||!n)return;if(Array.isArray(n))s.textContent=n.map(e=>e.command||e).filter(e=>e).join(" $$ ");else{let e="";e="string"==typeof n?n:n.command?n.command:"Error: Invalid command format",s.textContent=e}s.style.color=""}catch(e){const t=this.document.getElementById("parameterCommandPreview");if(t)if("please_enter_a_raw_command"===e.message){const e=this.i18n.t("please_enter_a_raw_command");t.textContent=e}else{console.error("Error updating parameter preview:",e);const i=this.i18n.t("error_generating_command");t.textContent=i}}}getParameterValues(){const e=this.document.getElementById("parameterInputs");if(!e)return{};const t={};return e.querySelectorAll("input, select").forEach(e=>{const i=e.name;i&&("number"===e.type?t[i]=this.safeParseNumber(e.value,i):t[i]=e.value)}),t}async saveParameterCommand(...e){const t=this.cache.currentEnvironment||"space",i="alias"===t?this.cache.selectedAlias:this.cache.selectedKey;if(!i||!this.currentParameterCommand){const e="alias"===t?this.i18n.t("please_select_an_alias_first"):this.i18n.t("please_select_a_key_first");return void this.ui?.showToast?.(e,"warning")}const{categoryId:a,commandId:n}=this.currentParameterCommand,s=this.currentParameterCommand;let r;try{r=this.getParameterValues()}catch(e){return void this.ui?.showToast?.(e.message||"Invalid parameter values","error")}try{const e=await this.request("parameter-command:build",{categoryId:a,commandId:n,commandDef:s,params:r});if(!e)return;if(this.currentParameterCommand.isEditing&&void 0!==this.currentParameterCommand.editIndex){const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;console.log("[ParameterCommandUI] emitting command:edit [parameterized]",{key:i,index:this.currentParameterCommand.editIndex,updatedCommand:e,bindset:t}),this.emit("command:edit",{key:i,index:this.currentParameterCommand.editIndex,updatedCommand:e,bindset:t})}else{const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;Array.isArray(e)?(console.log("[ParameterCommandUI] emitting command:add [bulk parameterized]",{commands:e,key:i}),this.emit("command:add",{command:e,key:i,bindset:t})):(console.log("[ParameterCommandUI] emitting command:add [single parameterized]",{command:e,key:i}),this.emit("command:add",{command:e,key:i,bindset:t}))}}catch(e){if(console.error("Error building parameterized command:",e),"please_enter_a_raw_command"===e.message){const e=this.i18n.t("please_enter_a_raw_command");this.ui?.showToast?.(e,"warning")}else{const e=this.i18n.t("error_generating_command");this.ui?.showToast?.(e,"error")}return}this.modalManager?.hide("parameterModal"),this.emit("parameter-edit:end"),this.currentParameterCommand=null;const o=this.document.getElementById("saveParameterCommandBtn");o&&(o.textContent=this.i18n.t("add_command"))}formatParameterName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}getParameterHelp(e,t){return t.help?t.help:this.i18n.t(`command_parameters.${e}.help`)||this.i18n.t("parameter_value")}getOptionLabel(e,t){return"verb"===e?this.i18n.t(`verb.${t}`):"STOTrayExecByTray"===t?this.i18n.t("stotrayexecbytray_description"):"TrayExecByTray"===t?this.i18n.t("trayexecbytray_description"):t}buildParameterInputs(e,t,i={}){Object.entries(t.parameters).forEach(([t,a])=>{const n=this.document.createElement("div");n.className="form-group";const s=this.document.createElement("label");let r;s.textContent=a.label||this.i18n.t(`command_parameters.${t}.label`)||this.i18n.t(t)||this.formatParameterName(t),s.setAttribute("for",`param_${t}`);const o=i[t]??a.default;"select"===a.type?(r=this.document.createElement("select"),r.id=`param_${t}`,r.name=t,a.options.forEach(e=>{const i=this.document.createElement("option");i.value=e,i.textContent=this.getOptionLabel(t,e),e===o&&(i.selected=!0),r.appendChild(i)})):(r=this.document.createElement("input"),r.type="number"===a.type?"number":"text",r.id=`param_${t}`,r.name=t,r.value=o??"",a.placeholder&&(a.placeholder.startsWith("command_definitions.")&&this.i18n?r.placeholder=this.i18n.t(a.placeholder)||a.placeholder:r.placeholder=a.placeholder),"number"===a.type&&(void 0!==a.min&&(r.min=a.min),void 0!==a.max&&(r.max=a.max),void 0!==a.step&&(r.step=a.step)));const c=this.document.createElement("small");c.textContent=this.getParameterHelp(t,a),n.appendChild(s),n.appendChild(r),n.appendChild(c),e.appendChild(n),r.addEventListener("input",()=>this.updateParameterPreview()),"SELECT"===r.tagName&&r.addEventListener("change",()=>this.updateParameterPreview())})}}class pt extends lt{constructor({service:e,eventBus:t,ui:i,modalManager:a,document:n,i18n:s}){super(t),this.componentName="CommandLibraryUI",this.service=e,this.ui=i,this.modalManager=a,this.document=n||("undefined"!=typeof window?window.document:null),this.i18n=s,this.eventListenersSetup=!1,this.ye=!1,this._e=!1}onInit(){this.setupEventListeners(),this.setupCommandLibrary()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.addEventListener("profile:updated",({profile:e})=>{this.updateCommandLibrary()}),this.addEventListener("profile:switched",({profile:e})=>{this.updateCommandLibrary()}),this.addEventListener("environment:changed",()=>{const e=this.document.getElementById("commandSearch"),t=e?e.value:"";this.applySearchFilter(t)}),this.addEventListener("key-selected",()=>{this.updateChainActions()}),this.addEventListener("alias-selected",()=>{this.updateChainActions()}),this.addEventListener("language:changed",()=>{this.setupCommandLibrary()}),this.addEventListener("aliases-changed",({aliases:e})=>{e&&this.updateCommandLibrary()}),this.addEventListener("command:filter",({filter:e=""})=>{this.applySearchFilter(e)}),this.addEventListener("preferences:saved",()=>{this.setupCommandLibrary()}))}async setupCommandLibrary(){if(this.ye)this._e=!0;else{this.ye=!0;try{const e=this.document.getElementById("commandCategoriesList")||this.document.getElementById("commandCategories");if(!e)return;const t=this.document.createDocumentFragment(),i=await this.request("command:get-categories");Object.entries(i).forEach(([e,i])=>{const a=this.createCategoryElement(e,i);t.appendChild(a)}),e.replaceChildren(t),this.filterCommandLibrary(),await this.updateCommandLibrary()}finally{this.ye=!1,this._e&&(this._e=!1,this.setupCommandLibrary())}}}createCategoryElement(e,t){const i=this.document.createElement("div")||{};i.dataset||(i.dataset={}),i.className="category",i.dataset.category=e;const a=`commandCategory_${e}_collapsed`,n="true"===localStorage.getItem(a);i.innerHTML=`\n      <h4 class="${n?"collapsed":""}" data-category="${e}">\n        <i class="fas fa-chevron-right category-chevron"></i>\n        <i class="${t.icon}"></i> \n        ${t.name}\n        <span class="command-count">(${Object.keys(t.commands).length})</span>\n      </h4>\n      <div class="category-commands ${n?"collapsed":""}">\n        ${Object.entries(t.commands).map(([e,t])=>{const i=`command_definitions.${e}.name`,a=this.i18n.t(i),n=`command_definitions.${e}.description`,s=this.i18n.t(n);return`\n            <div class="command-item ${t.customizable?"customizable":""}" data-command="${e}" title="${s}${t.customizable?" (Customizable)":""}">\n              ${t.icon} ${a}${t.customizable?' <span class="param-indicator">âš™ï¸</span>':""}\n            </div>\n          `}).join("")}\n      </div>\n    `;const s=i.querySelector?i.querySelector("h4"):null;return s&&this.onDom(s,"click","command-category-header",()=>{this.toggleCommandCategory(e,i)}),this.onDom(i,"click","command-item-click",e=>{if(e.target.classList.contains("command-item")){const t=e.target.dataset.command,i=e.target.closest(".category").dataset.category,a=STO_DATA?.commands?.[i]?.commands?.[t];if(!a)return;if(a.customizable)console.log("[CommandLibraryUI] emitting command-add [customizable]",{categoryId:i,commandId:t,commandDef:a}),this.emit("command-add",{categoryId:i,commandId:t,commandDef:a});else{const e={command:a.command,type:i,icon:a.icon,text:a.name,id:`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};console.log("[CommandLibraryUI] emitting command-add [static]",{commandDef:e}),this.emit("command-add",{commandDef:e})}}}),i}toggleCommandCategory(e,t){const i=t.querySelector("h4"),a=t.querySelector(".category-commands"),n=i.querySelector(".category-chevron"),s=`commandCategory_${e}_collapsed`;a.classList.contains("collapsed")?(a.classList.remove("collapsed"),i.classList.remove("collapsed"),n.style.transform="rotate(90deg)",localStorage.setItem(s,"false")):(a.classList.add("collapsed"),i.classList.add("collapsed"),n.style.transform="rotate(0deg)",localStorage.setItem(s,"true"))}createAliasCategoryElement(e,t="aliases",i="command_aliases",a="fas fa-mask"){const n=document.createElement("div");n.className="category",n.dataset.category=t;const s=`commandCategory_${t}_collapsed`,r="true"===localStorage.getItem(s);let o,c;"vertigo-aliases"===t?(o="ğŸ‘ï¸",c="command-item vertigo-alias-item"):"bindset-aliases"===t?(o="ğŸ”§",c="command-item bindset-alias-item"):(o="ğŸ­",c="command-item alias-item"),n.innerHTML=`\n            <h4 class="${r?"collapsed":""}" data-category="${t}">\n                <i class="fas fa-chevron-right category-chevron"></i>\n                <i class="${a}"></i>\n                ${this.i18n.t(i)}\n                <span class="command-count">(${e.length})</span>\n            </h4>\n            <div class="category-commands ${r?"collapsed":""}">\n                ${e.map(([e,t])=>`\n                    <div class="${c}" data-alias="${e}" title="${t.description||t.commands}">\n                        ${o} ${t.displayName||t.ge||e}\n                    </div>\n                `).join("")}\n            </div>\n        `;const l=n.querySelector("h4");return this.onDom(l,"click","alias-category-header",()=>{this.toggleAliasCategory(t,n)}),this.onDom(n,"click","alias-item-click",t=>{if(t.target.classList.contains("alias-item")||t.target.classList.contains("vertigo-alias-item")||t.target.classList.contains("bindset-alias-item")){const i=t.target.dataset.alias,a=e.find(([e])=>e===i);console.log("[CommandLibraryUI] aliasEntry",a);const n=a?a[1]:{},s="vfx-alias"===n.type,r={command:i,type:n.type,icon:s?"ğŸ‘ï¸":"ğŸ­",...s?{}:{text:`${i}`},description:n.description,isUserAlias:!0,isVfxAlias:s,id:`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};console.log("[CommandLibraryUI] emitting command:add [alias]",{commandDef:r}),this.emit("command-add",{commandDef:r})}}),n}toggleAliasCategory(e,t){const i=t.querySelector("h4"),a=t.querySelector(".category-commands"),n=i.querySelector(".category-chevron"),s=`commandCategory_${e}_collapsed`;a.classList.contains("collapsed")?(a.classList.remove("collapsed"),i.classList.remove("collapsed"),n.style.transform="rotate(90deg)",localStorage.setItem(s,"false")):(a.classList.add("collapsed"),i.classList.add("collapsed"),n.style.transform="rotate(0deg)",localStorage.setItem(s,"true"))}async updateCommandLibrary(){if(!this.cache.profile)return;const e=this.document.getElementById("aliasCategoriesList")||this.document.getElementById("commandCategories");if(!e)return;const t=await this.request("command:get-combined-aliases")||{},i=Object.entries(t),a=await Promise.all(i.map(async([e,t])=>("vfx-alias"!==t.type||t.ge||(t.ge=await this.be(e,t)),[e,t]))),n=a.filter(([,e])=>"vfx-alias"!==e.type),s=a.filter(([,e])=>"vfx-alias"===e.type);let r=[];try{const e=this.cache.preferences.bindsetsEnabled,t=this.cache.preferences.bindToAliasMode;if(e&&t){const e=(this.cache.profile||{}).bindsets||{},t=["space","ground"],i=(e="")=>{let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t=`bs_${t}`),t};for(const a of t)["Primary Bindset",...Object.keys(e)].forEach(e=>{const t=`sto_kb_bindset_enable_${a}_${i(e)}`,n=this.i18n.t(a),s="Primary Bindset"===e?this.i18n.t("primary_bindset"):e,o=this.i18n.t("bindset_enable"),c=`${this.i18n.t("bindsets")}: ${n} - ${o} ${s}`;r.push([t,{type:"bindset-alias",description:c,commands:t,displayName:c}])})}}catch{}const o=this.document.createDocumentFragment();n.length>0&&o.appendChild(this.createAliasCategoryElement(n,"aliases","command_aliases","fas fa-mask")),s.length>0&&o.appendChild(this.createAliasCategoryElement(s,"vertigo-aliases","vfx_aliases","fas fa-eye-slash")),r.length>0&&o.appendChild(this.createAliasCategoryElement(r,"bindset-aliases","bindsets","fas fa-tags")),e.replaceChildren(o)}filterCommandLibrary(){this.request("command:filter-library").catch(()=>{})}updateChainActions(){if(window.commandChainUI&&"function"==typeof window.commandChainUI.updateChainActions)return void window.commandChainUI.updateChainActions();if(!this.document||!this.document.getElementById)return;const e=!!("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey),t=this.document;if("alias"===this.cache.currentEnvironment){["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(i=>{const a=t.getElementById(i);a&&(a.disabled=!e)});const i=t.getElementById("importFromKeyOrAliasBtn");i&&(i.disabled=!e),["deleteKeyBtn","duplicateKeyBtn"].forEach(e=>{const i=t.getElementById(e);i&&(i.disabled=!0)})}else["importFromKeyOrAliasBtn","deleteKeyBtn","duplicateKeyBtn"].forEach(i=>{const a=t.getElementById(i);a&&(a.disabled=!e)}),["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(e=>{const i=t.getElementById(e);i&&(i.disabled=!0)})}getCurrentState(){return{aliases:this.cache.aliases,currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment||"space",selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias}}handleInitialState(e,t){"DataCoordinator"===t&&e.currentProfileData&&this.updateCommandLibrary()}async applySearchFilter(e){const t=(e||"").trim().toLowerCase(),i=this.document||("undefined"!=typeof window?window.document:void 0);if(!i)return;const a=i.getElementById("commandCategories")||i.querySelector(".command-categories");if(!a)return;a.querySelectorAll(".command-item, .alias-item, .vertigo-alias-item, .bindset-alias-item").forEach(e=>{const i="true"===e.dataset.envHidden;if(!t)return void(i||(e.style.display="flex"));const a=(e.textContent||"").toLowerCase().includes(t);e.style.display=a&&!i?"flex":"none"}),a.querySelectorAll(".category").forEach(e=>{const i=e.querySelectorAll('.command-item:not([style*="display: none"]), .alias-item:not([style*="display: none"]), .vertigo-alias-item:not([style*="display: none"]), .bindset-alias-item:not([style*="display: none"])'),a=!t||i.length>0;e.style.display=a?"block":"none"});const n=i.getElementById("commandSearchBtn");n&&(n.classList.toggle("active",!!t),n.setAttribute("aria-pressed",!!t))}async be(e,t){if("vfx-alias"===t.type)try{const t=await this.request("parser:parse-command-string",{commandString:e,options:{generateDisplayText:!0}}),i=t?.commands?.[0];if(i?.displayText)return i.displayText}catch{}return e}}class ft extends lt{constructor({eventBus:e,ui:t=null,modalManager:i=null,parameterCommandUI:a=null,confirmDialog:n=null,i18n:s,document:r=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="CommandUI",this.ui=t||("undefined"!=typeof stoUI?stoUI:null),this.modalManager=i,this.parameterCommandUI=a,this.confirmDialog=n||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=s,this.ve="Primary Bindset",this.we={warnings:[],errors:[]},this.ke=new Map,this.document=r,this.currentValidationModal=null}onInit(){this.setupEventListeners(),this.setupUIStateEventListeners()}setupUIStateEventListeners(){this.addEventListener("bindset-selector:active-changed",e=>{this.ve=e.bindset||"Primary Bindset"})}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("clearChainBtn","click","command-chain-clear",()=>{const e=this.getSelectedKey();e&&this.confirmClearChain(e)}),this.onDom("validateChainBtn","click","command-chain-validate",()=>{const e=this.getSelectedKey();e&&this.validateCurrentChain(e)}),this.onDomDebounced("commandSearch","input","command-search",e=>{this.filterCommands(e.target.value)},250),this.onDom("commandSearch","keydown","command-search-key",e=>{if("Escape"===e.key){const t=e.target;t.value="",t.classList.remove("expanded"),this.emit("command:filter",{filter:""})}else if("Enter"===e.key){const t=e.target;t.classList.remove("expanded"),t.blur()}}),this.onDom("showAllCommandsBtn","click","command-clear-filter",()=>{const e=this.document.getElementById("commandSearch");if(e){e.value="";const t=new Event("input",{bubbles:!0});e.dispatchEvent(t)}this.filterCommands("")}),this.onDom("commandSearchBtn","click","command-search-toggle",()=>{this.toggleCommandSearch()}),this.onDom("importFromKeyOrAliasBtn","click","import-from-key-or-alias",()=>{this.showImportFromKeyOrAliasModal()}),this.onDom("confirmImportBtn","click","confirm-import",()=>{this.performImport()}),this.addEventListener("command-add",async(e={})=>{const{categoryId:t,commandId:i,commandDef:a}=e;if(!a||t||i)t&&i&&a&&(this.parameterCommandUI?this.parameterCommandUI.showParameterModal(t,i,a):console.error("CommandUI: parameterCommandUI not available"));else try{const e=this.getSelectedKey();if(!e){const e="alias"===this.getCurrentEnvironment()?"please_select_an_alias_first":"please_select_a_key_first",t=this.i18n.t(e);return void await this.showToast(t,"warning")}const t="alias"===this.cache.currentEnvironment?null:this.ve;this.emit("command:add",{command:a,key:e,bindset:t})}catch(e){console.error("CommandUI: Failed to handle static command:",e)}}),this.addEventListener("command-chain:validation-result",async({key:e,severity:t,warnings:i=[],errors:a=[]})=>{const n=this.document.getElementById("statusIndicator");if(!n)return;const s=n.querySelector("i"),r=n.querySelector("span");if(!s||!r)return;const o={success:{icon:"fa-check-circle",textKey:"valid",textDefault:"Valid",color:"status-success"},warning:{icon:"fa-exclamation-triangle",textKey:"warning",textDefault:"Warning",color:"status-warning"},error:{icon:"fa-exclamation-circle",textKey:"error",textDefault:"Error",color:"status-error"}},c=o[t]||o.success;s.className=`fas ${c.icon}`,r.textContent=c.textDefault,r.setAttribute("data-i18n",c.textKey),n.classList.remove("status-success","status-warning","status-error"),n.classList.add(c.color),this.we={warnings:i,errors:a};const l=i&&i.length>0||a&&a.length>0,d=e||"__global__";let m=!1,h=!1;const u=this.ke.get(d);l&&"success"!==t?(m=u!==t,this.ke.set(d,t)):"success"===t?(u&&"success"===u||(h=!0),this.ke.set(d,"success")):this.ke.delete(d);const p=e=>{const t=this.i18n.t(e.key,e.params||{});return t&&"string"==typeof t&&t!==e.key&&!t.startsWith(`${e.key}:`)?t:e.defaultMessage||e.key};if(m){for(const e of a){const t=p(e);this.showToast(t,"error")}for(const e of i){const t=p(e);this.showToast(t,"warning")}}h&&(async()=>{const e=this.i18n.t("command_chain_is_valid");this.showToast(e,"success")})();const f=this.i18n.t(c.textKey);"string"==typeof f&&f&&f!==c.textKey&&(r.textContent=f),"success"!==t&&(i.length||a.length)?(n.classList.add("clickable"),n.onclick=()=>this.showValidationDetails()):(n.classList.remove("clickable"),n.onclick=null)}))}getSelectedKey(){return"alias"===(this.cache.currentEnvironment||"space")?this.cache.selectedAlias:this.cache.selectedKey}getCurrentEnvironment(){return this.cache.currentEnvironment||"space"}async confirmClearChain(e){if(!e)return;const t=this.getCurrentEnvironment(),i="alias"===t?"alias":"key";try{const a=this.i18n.t("confirm_clear_commands",{keyName:e}),n=this.i18n.t("confirm_clear");if(!this.confirmDialog)return console.error("CommandUI: confirmDialog not available, cannot show confirmation dialog"),void await this.showToast("Confirmation dialog not available","error");await this.confirmDialog.confirm(a,n,"warning","commandChainClear")&&(console.log(`[CommandUI] Requesting clear command chain for ${i}: "${e}" in env: "${t}"`),this.emit("command-chain:clear",{key:e}))}catch(e){console.error("CommandUI: Failed to confirm clear chain:",e),await this.showToast("Failed to show confirmation dialog","error")}}async validateCurrentChain(e){if(e){let t=!1;try{t=await this.request("command-chain:is-stabilized",{name:e})}catch(e){}const i="alias"===this.getCurrentEnvironment();this.emit("command-chain:validate",{key:e,stabilized:t,isAlias:i})}}filterCommands(e){this.emit("command:filter",{filter:e});const t=this.document.getElementById("commandSearchBtn");if(t){const i=!(!e||!e.trim());t.classList.toggle("active",i),t.setAttribute("aria-pressed",i)}}toggleCommandSearch(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("commandSearch");t&&(t.classList.toggle("expanded")?t.focus():t.blur())}async showImportFromKeyOrAliasModal(){if(!this.getSelectedKey()){const e="alias"===this.getCurrentEnvironment()?"please_select_an_alias_first":"please_select_a_key_first",t=this.i18n.t(e);return void await this.showToast(t,"warning")}await this.populateImportSources(),this.modalManager&&this.modalManager.show("importFromKeyOrAliasModal")}async populateImportSources(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("importSourceSelect");if(!t)return;t.innerHTML="";const i=this.getCurrentEnvironment(),a=this.getSelectedKey();try{const n=await this.request("command:get-import-sources",{environment:i,currentKey:a});if(n.forEach(i=>{const a=e.createElement("option");a.value=i.value,a.textContent=i.label,t.appendChild(a)}),0===n.length){const i=e.createElement("option");i.value="",i.textContent=this.i18n.t("no_sources_available"),i.disabled=!0,t.appendChild(i)}}catch(i){console.error("CommandUI: Failed to populate import sources:",i);const a=e.createElement("option");a.value="",a.textContent=this.i18n.t("error_loading_sources"),a.disabled=!0,t.appendChild(a)}}async performImport(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("importSourceSelect"),i=e.getElementById("clearDestinationBeforeImport");if(!t||!i)return;const a=t.value,n=i.checked,s=this.getSelectedKey(),r=this.getCurrentEnvironment();if(!a||!s){const e=this.i18n.t("please_select_a_source");return void await this.showToast(e,"warning")}try{const e=await this.request("command:import-from-source",{sourceValue:a,targetKey:s,clearDestination:n,currentEnvironment:r});if(e.success){if(e.droppedCount>0){const t=e.sourceType.charAt(0).toUpperCase()+e.sourceType.slice(1),i=r.charAt(0).toUpperCase()+r.slice(1),a=this.i18n.t("cross_environment_import_warning",{dropped:e.droppedCount,sourceEnv:t,targetEnv:i});await this.showToast(a,"warning")}const t=this.i18n.t("commands_imported_successfully",{count:e.importedCount,source:e.sourceName});await this.showToast(t,"success"),this.modalManager&&this.modalManager.hide("importFromKeyOrAliasModal")}}catch(e){let t;console.error("CommandUI: Failed to import commands:",e),t="Source has no commands to import"===e.message?this.i18n.t("source_has_no_commands"):"No compatible commands found for import"===e.message?this.i18n.t("no_compatible_commands_to_import"):this.i18n.t("import_failed",{error:e?.message||e}),await this.showToast(t,"error")}}async showValidationDetails(){const{warnings:e=[],errors:t=[]}=this.we||{};if(!e.length&&!t.length)return;const i=t.map(e=>"string"==typeof e?this.i18n.t(e):e&&e.key?this.i18n.t(e.key,e.params||{}):e&&e.defaultMessage?e.defaultMessage:""),a=e.map(e=>"string"==typeof e?this.i18n.t(e):e&&e.key?this.i18n.t(e.key,e.params||{}):e&&e.defaultMessage?e.defaultMessage:""),n=this.i18n.t("error"),s=this.i18n.t("warning");let r="";i.length&&(r+=`<h4>${n}</h4><ul>${i.map(e=>`<li class="error-item">${e}</li>`).join("")}</ul>`),a.length&&(r+=`<h4>${s}</h4><ul>${a.map(e=>`<li class="warning-item">${e}</li>`).join("")}</ul>`);const o=this.i18n.t("validation_details"),c=this.i18n.t("ok"),l="validationDetailsModal",d=this.document.getElementById(l);d&&d.remove();const m=this.document.createElement("div");m.id=l,m.className="modal",this.currentValidationModal={errors:t,warnings:e,modalElement:m},this.modalManager?.registerRegenerateCallback(l,()=>{this.regenerateValidationModal()}),m.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header"><h3>${o}</h3></div>\n        <div class="modal-body">${r}</div>\n        <div class="modal-footer"><button class="btn btn-primary" id="validationOkBtn">${c}</button></div>\n      </div>`,this.document.body.appendChild(m),this.onDom("#validationOkBtn","click","validation-dialog-ok",()=>{this.modalManager?.unregisterRegenerateCallback(l),this.currentValidationModal=null,this.modalManager&&this.modalManager.hide(l),m.remove()}),this.modalManager?this.modalManager.show(l):requestAnimationFrame(()=>m.classList.add("active"))}regenerateValidationModal(){if(!this.currentValidationModal)return;const{errors:e,warnings:t}=this.currentValidationModal;this.showValidationDetails()}}class yt extends lt{constructor({eventBus:e,ui:t=null,profileUI:i=null,document:a=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="InterfaceModeUI",this.ui=t||("undefined"!=typeof stoUI?stoUI:null),this.profileUI=i,this.document=a,this.ne="space",this.Se=!1,this.xe=!1,this.Te=null,this.Ce=null}onInit(){this.setupEventListeners(),this.setupModeButtons()}setupEventListeners(){this.Se||(this.Te=e=>{const t="string"==typeof e?e:e?.newMode;t&&(this.ne=t,this.updateModeUI(t))},this.Ce=(e={})=>{const t="string"==typeof e?e:e.environment||e.newMode||e.mode;t&&(this.ne=t,this.updateModeUI(t))},this.eventBus.on("mode-changed",this.Te),this.eventBus.on("environment:changed",this.Ce),this.Se=!0)}setupModeButtons(){this.xe||(["space","ground","alias"].forEach(e=>{this.onDom(`[data-mode="${e}"]`,"click",`mode-change-${e}`,()=>this.handleModeButtonClick(e))}),this.xe=!0)}async handleModeButtonClick(e){try{const t=await this.request("environment:switch",{mode:e});t.success||console.error("[InterfaceModeUI] Failed to switch environment:",t.error)}catch(e){console.error("[InterfaceModeUI] Error switching environment:",e)}}updateModeUI(e){["space","ground","alias"].forEach(t=>{const i=this.document.querySelector(`[data-mode="${t}"]`);i&&i.classList.toggle("active",t===e)}),this.updateKeyGridDisplay(e)}updateKeyGridDisplay(e){const t=this.document.querySelector(".key-selector-container"),i=this.document.getElementById("aliasSelectorContainer");"alias"===e?(t&&(t.style.display="none"),i&&(i.style.display="")):(t&&(t.style.display=""),i&&(i.style.display="none"),this.emit("key:list-changed"))}get currentMode(){return this.ne}set currentMode(e){this.ne=e,this.request("environment:switch",{mode:e}).catch(e=>{console.error("[InterfaceModeUI] Error switching environment via setter:",e)})}onDestroy(){this.Se&&(this.eventBus.off("mode-changed",this.Te),this.eventBus.off("environment:changed",this.Ce),this.Se=!1),this.xe=!1}handleInitialState(e,t){t&&("InterfaceModeService"===e||t.environment)&&t.environment&&this.updateModeUI(t.environment)}}class _t extends lt{constructor({eventBus:e,modalManager:t,i18n:i}={}){super(e),this.componentName="ConfirmDialogUI",this.modalManager=t,this.i18n=i,this.currentConfirmModal=null,this.currentInformModal=null}async confirm(e,t="Confirm",i="warning",a=""){return new Promise(n=>{const s=this.createConfirmModal(e,t,i),r=a?`${a}ConfirmModal`:"confirmModal";s.id=r,document.body.appendChild(s),this.currentConfirmModal={message:e,title:t,type:i,resolve:n,modalElement:s,confirmId:r},this.modalManager?.registerRegenerateCallback(r,()=>{this.regenerateConfirmModal()});const o=e=>{this.modalManager?.unregisterRegenerateCallback(r),this.currentConfirmModal=null,this.modalManager?.hide(r),s&&s.parentNode&&s.parentNode.removeChild(s),n(e)},c=s.querySelector(".confirm-yes"),l=s.querySelector(".confirm-no");c&&this.onDom(c,"click","confirm-dialog-yes",()=>{o(!0)}),l&&this.onDom(l,"click","confirm-dialog-no",()=>{o(!1)}),requestAnimationFrame(()=>{this.modalManager?.show(r)})})}async inform(e,t="Information",i="info",a=""){return new Promise(n=>{const s=this.createInformModal(e,t,i),r=a?`${a}InformModal`:"informModal";s.id=r,document.body.appendChild(s),this.currentInformModal={message:e,title:t,type:i,resolve:n,modalElement:s,informId:r},this.modalManager?.registerRegenerateCallback(r,()=>{this.regenerateInformModal()});const o=()=>{this.modalManager?.unregisterRegenerateCallback(r),this.currentInformModal=null,this.modalManager?.hide(r),s&&s.parentNode&&s.parentNode.removeChild(s),n(!0)},c=s.querySelector(".inform-ok");c&&this.onDom(c,"click","inform-dialog-ok",o);const l=e=>{"Escape"===e.key&&(document.removeEventListener("keydown",l),o())};document.addEventListener("keydown",l),requestAnimationFrame(()=>{this.modalManager?.show(r)})})}createInformModal(e,t,i){const a=document.createElement("div");a.className="modal inform-modal";const n={warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle",info:"fa-info-circle",success:"fa-check-circle"};return a.innerHTML=`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3>\n                        <i class="fas ${n[i]||n.info}"></i>\n                        ${t}\n                    </h3>\n                </div>\n                <div class="modal-body">\n                    <p>${e}</p>\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary inform-ok">${this.i18n?this.i18n.t("ok"):"OK"}</button>\n                </div>\n            </div>\n        `,a}createConfirmModal(e,t,i){const a=document.createElement("div");a.className="modal confirm-modal";const n={warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle",info:"fa-info-circle"};return a.innerHTML=`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3>\n                        <i class="fas ${n[i]||n.warning}"></i>\n                        ${t}\n                    </h3>\n                </div>\n                <div class="modal-body">\n                    <p>${e}</p>\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary confirm-yes">${this.i18n?this.i18n.t("yes"):"Yes"}</button>\n                    <button class="btn btn-secondary confirm-no">${this.i18n?this.i18n.t("no"):"No"}</button>\n                </div>\n            </div>\n        `,a}regenerateConfirmModal(){if(!this.currentConfirmModal)return;const{message:e,title:t,type:i,modalElement:a,confirmId:n}=this.currentConfirmModal,s=this.createConfirmModal(e,t,i);s.id=n,a.replaceWith(s),this.currentConfirmModal.modalElement=s;const r=s.querySelector(".confirm-yes"),o=s.querySelector(".confirm-no");r&&this.onDom(r,"click","confirm-dialog-regen-yes",()=>{this.handleConfirmAction(!0)}),o&&this.onDom(o,"click","confirm-dialog-regen-no",()=>{this.handleConfirmAction(!1)})}regenerateInformModal(){if(!this.currentInformModal)return;const{message:e,title:t,type:i,modalElement:a,informId:n}=this.currentInformModal,s=this.createInformModal(e,t,i);s.id=n,a.replaceWith(s),this.currentInformModal.modalElement=s;const r=()=>{const{resolve:e,informId:t}=this.currentInformModal;this.modalManager?.unregisterRegenerateCallback(t),this.currentInformModal=null,this.modalManager?.hide(t),s&&s.parentNode&&s.parentNode.removeChild(s),e(!0)},o=s.querySelector(".inform-ok");o&&this.onDom(o,"click","inform-dialog-regen-ok",r);const c=e=>{"Escape"===e.key&&(document.removeEventListener("keydown",c),r())};document.addEventListener("keydown",c)}handleConfirmAction(e){if(!this.currentConfirmModal)return;const{resolve:t,modalElement:i,confirmId:a}=this.currentConfirmModal;this.modalManager?.unregisterRegenerateCallback(a),this.currentConfirmModal=null,this.modalManager?.hide(a),i&&i.parentNode&&i.parentNode.removeChild(i),t(e)}}class gt extends lt{constructor({eventBus:e=null,modalManager:t=null,i18n:i}={}){super(e),this.componentName="InputDialogUI",this.modalManager=t,this.i18n=i,this.currentInputModal=null}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("language:changed",()=>{this.currentInputModal&&this.regenerateInputModal()})}async prompt(e,t={}){const{title:i="Input",defaultValue:a="",placeholder:n="",type:s="text",validate:r=null,maxLength:o=255}=t;return new Promise(t=>{const c=this.createInputModal(e,i,a,n,s,r,o),l="inputModal";c.id=l,document.body.appendChild(c),this.currentInputModal={message:e,title:i,defaultValue:a,placeholder:n,type:s,validate:r,maxLength:o,resolve:t,modalElement:c},this.modalManager?.registerRegenerateCallback(l,()=>{this.regenerateInputModal()});const d=c.querySelector(".input-field"),m=c.querySelector(".input-submit"),h=c.querySelector(".input-cancel"),u=c.querySelector(".input-error"),p=()=>{const e=d.value;if(r&&"function"==typeof r){const t=r(e);if(!0!==t)return u.textContent="string"==typeof t?t:"Invalid input",u.style.display="block",void d.focus()}this.closeModal(c,l),t(e)},f=()=>{this.closeModal(c,l),t(null)};this.onDom(m,"click","input-dialog-submit",p),this.onDom(h,"click","input-dialog-cancel",f),this.onDom(d,"input","input-dialog-input",()=>{u.style.display="none";const e=d.value.trim().length>0;m.disabled=!e}),this.onDom(d,"keydown","input-dialog-keydown",e=>{"Enter"!==e.key||m.disabled?"Escape"===e.key&&(e.preventDefault(),f()):(e.preventDefault(),p())});const y=a.trim().length>0;m.disabled=!y,requestAnimationFrame(()=>{this.modalManager?.show(l),d.focus(),d.select()})})}closeModal(e,t){this.modalManager?.unregisterRegenerateCallback(t),this.currentInputModal=null,this.modalManager?.hide(t),e&&e.parentNode&&e.parentNode.removeChild(e)}createInputModal(e,t,i,a,n,s,r){const o=document.createElement("div");o.className="modal input-modal";const c=this.i18n.t("ok"),l=this.i18n.t("cancel");return o.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-edit"></i>\n            ${t}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${e}</p>\n          <div class="input-group">\n            <input \n              type="${n}" \n              class="input-field" \n              value="${i}" \n              placeholder="${a}"\n              maxlength="${r}"\n              autocomplete="off"\n            />\n            <div class="input-error" style="display: none; color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;"></div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary input-submit">${c}</button>\n          <button class="btn btn-secondary input-cancel">${l}</button>\n        </div>\n      </div>\n    `,o}regenerateInputModal(){if(!this.currentInputModal)return;const{message:e,title:t,defaultValue:i,placeholder:a,type:n,validate:s,maxLength:r,modalElement:o}=this.currentInputModal,c=o.querySelector(".input-field")?.value||i,l=this.createInputModal(e,t,i,a,n,s,r);l.id="inputModal",o.replaceWith(l),this.currentInputModal.modalElement=l;const d=l.querySelector(".input-field"),m=l.querySelector(".input-submit"),h=l.querySelector(".input-cancel"),u=l.querySelector(".input-error");d.value=c;const p=()=>{const e=d.value;if(s&&"function"==typeof s){const t=s(e);if(!0!==t)return u.textContent="string"==typeof t?t:"Invalid input",u.style.display="block",void d.focus()}this.closeModal(l,"inputModal"),this.currentInputModal.resolve(e)},f=()=>{this.closeModal(l,"inputModal"),this.currentInputModal.resolve(null)};this.onDom(m,"click","input-dialog-submit-regen",p),this.onDom(h,"click","input-dialog-cancel-regen",f),this.onDom(d,"input","input-dialog-input-regen",()=>{u.style.display="none";const e=d.value.trim().length>0;m.disabled=!e}),this.onDom(d,"keydown","input-dialog-keydown-regen",e=>{"Enter"!==e.key||m.disabled?"Escape"===e.key&&(e.preventDefault(),f()):(e.preventDefault(),p())});const y=c.trim().length>0;m.disabled=!y,d.focus(),d.select()}}const bt={F1:{row:0,col:1,width:1},F2:{row:0,col:2,width:1},F3:{row:0,col:3,width:1},F4:{row:0,col:4,width:1},F5:{row:0,col:5,width:1},F6:{row:0,col:6,width:1},F7:{row:0,col:7,width:1},F8:{row:0,col:8,width:1},F9:{row:0,col:9,width:1},F10:{row:0,col:10,width:1},F11:{row:0,col:11,width:1},F12:{row:0,col:12,width:1},Backquote:{row:1,col:0,width:1},Escape:{row:0,col:0,width:1},Digit1:{row:1,col:1,width:1},Digit2:{row:1,col:2,width:1},Digit3:{row:1,col:3,width:1},Digit4:{row:1,col:4,width:1},Digit5:{row:1,col:5,width:1},Digit6:{row:1,col:6,width:1},Digit7:{row:1,col:7,width:1},Digit8:{row:1,col:8,width:1},Digit9:{row:1,col:9,width:1},Digit0:{row:1,col:10,width:1},Minus:{row:1,col:11,width:1},Equal:{row:1,col:12,width:1},Tab:{row:2,col:0,width:1.5},KeyQ:{row:2,col:1.5,width:1},KeyW:{row:2,col:2.5,width:1},KeyE:{row:2,col:3.5,width:1},KeyR:{row:2,col:4.5,width:1},KeyT:{row:2,col:5.5,width:1},KeyY:{row:2,col:6.5,width:1},KeyU:{row:2,col:7.5,width:1},KeyI:{row:2,col:8.5,width:1},KeyO:{row:2,col:9.5,width:1},KeyP:{row:2,col:10.5,width:1},BracketLeft:{row:2,col:11.5,width:1},BracketRight:{row:2,col:12.5,width:1},CapsLock:{row:3,col:0,width:1.75},KeyA:{row:3,col:1.75,width:1},KeyS:{row:3,col:2.75,width:1},KeyD:{row:3,col:3.75,width:1},KeyF:{row:3,col:4.75,width:1},KeyG:{row:3,col:5.75,width:1},KeyH:{row:3,col:6.75,width:1},KeyJ:{row:3,col:7.75,width:1},KeyK:{row:3,col:8.75,width:1},KeyL:{row:3,col:9.75,width:1},Quote:{row:3,col:10.75,width:1},ShiftLeft:{row:4,col:0,width:2.25},KeyZ:{row:4,col:2.25,width:1},KeyX:{row:4,col:3.25,width:1},KeyC:{row:4,col:4.25,width:1},KeyV:{row:4,col:5.25,width:1},KeyB:{row:4,col:6.25,width:1},KeyN:{row:4,col:7.25,width:1},KeyM:{row:4,col:8.25,width:1},Comma:{row:4,col:9.25,width:1},Period:{row:4,col:10.25,width:1},ShiftRight:{row:4,col:11.25,width:2.25},ControlLeft:{row:5,col:0,width:1.25},AltLeft:{row:5,col:2.75,width:1.25},Space:{row:5,col:4,width:5.5},AltRight:{row:5,col:9.5,width:1.25},ControlRight:{row:5,col:12.25,width:1.25},Insert:{row:1,col:14.5,width:1},Delete:{row:2,col:14.5,width:1},Home:{row:1,col:15.5,width:1},End:{row:2,col:15.5,width:1},PageUp:{row:1,col:16.5,width:1},PageDown:{row:2,col:16.5,width:1},ArrowUp:{row:4,col:15,width:1},ArrowLeft:{row:5,col:14,width:1},ArrowDown:{row:5,col:15,width:1},ArrowRight:{row:5,col:16,width:1},NumpadDivide:{row:1,col:18,width:1},NumpadMultiply:{row:1,col:19,width:1},NumpadSubtract:{row:1,col:20,width:1},Numpad7:{row:2,col:17,width:1},Numpad8:{row:2,col:18,width:1},Numpad9:{row:2,col:19,width:1},NumpadAdd:{row:2,col:20,width:1},Numpad4:{row:3,col:17,width:1},Numpad5:{row:3,col:18,width:1},Numpad6:{row:3,col:19,width:1},Numpad1:{row:4,col:17,width:1},Numpad2:{row:4,col:18,width:1},Numpad3:{row:4,col:19,width:1},NumpadEnter:{row:4,col:20,width:1},Numpad0:{row:5,col:17,width:2},NumpadDecimal:{row:5,col:19,width:1},lclick:{row:0,col:22,width:1},mclick:{row:0,col:23,width:1},rclick:{row:0,col:24,width:1},lpress:{row:1,col:22,width:1},rpress:{row:1,col:23,width:1},wheelup:{row:1,col:24,width:1},ldrag:{row:2,col:22,width:1},rdrag:{row:2,col:23,width:1},wheeldown:{row:2,col:24,width:1},Button4:{row:3,col:22,width:1},Button5:{row:3,col:23,width:1},Button6:{row:3,col:24,width:1},Button7:{row:4,col:22,width:1},Button8:{row:4,col:23,width:1},Button9:{row:4,col:24,width:1},Button10:{row:5,col:22,width:1}},vt={name:"QWERTY",languages:["en","es"],keys:{Digit1:{primary:"1",secondary:""},Digit2:{primary:"2",secondary:""},Digit3:{primary:"3",secondary:""},Digit4:{primary:"4",secondary:""},Digit5:{primary:"5",secondary:""},Digit6:{primary:"6",secondary:""},Digit7:{primary:"7",secondary:""},Digit8:{primary:"8",secondary:""},Digit9:{primary:"9",secondary:""},Digit0:{primary:"0",secondary:""},KeyQ:{primary:"Q",secondary:""},KeyW:{primary:"W",secondary:""},KeyE:{primary:"E",secondary:""},KeyR:{primary:"R",secondary:""},KeyT:{primary:"T",secondary:""},KeyY:{primary:"Y",secondary:""},KeyU:{primary:"U",secondary:""},KeyI:{primary:"I",secondary:""},KeyO:{primary:"O",secondary:""},KeyP:{primary:"P",secondary:""},KeyA:{primary:"A",secondary:""},KeyS:{primary:"S",secondary:""},KeyD:{primary:"D",secondary:""},KeyF:{primary:"F",secondary:""},KeyG:{primary:"G",secondary:""},KeyH:{primary:"H",secondary:""},KeyJ:{primary:"J",secondary:""},KeyK:{primary:"K",secondary:""},KeyL:{primary:"L",secondary:""},KeyZ:{primary:"Z",secondary:""},KeyX:{primary:"X",secondary:""},KeyC:{primary:"C",secondary:""},KeyV:{primary:"V",secondary:""},KeyB:{primary:"B",secondary:""},KeyN:{primary:"N",secondary:""},KeyM:{primary:"M",secondary:""},Minus:{primary:"-",secondary:""},Equal:{primary:"=",secondary:""},BracketLeft:{primary:"[",secondary:""},BracketRight:{primary:"]",secondary:""},Quote:{primary:"'",secondary:""},Comma:{primary:",",secondary:""},Period:{primary:".",secondary:""},Backquote:{primary:"`",secondary:"~"},Space:{primary:"Space",secondary:""},Tab:{primary:"Tab",secondary:""},Escape:{primary:"Esc",secondary:""},Delete:{primary:"Del",secondary:""},CapsLock:{primary:"Caps",secondary:""},ShiftLeft:{primary:"Shift",secondary:""},ShiftRight:{primary:"Shift",secondary:""},ControlLeft:{primary:"Ctrl",secondary:""},ControlRight:{primary:"Ctrl",secondary:""},AltLeft:{primary:"Alt",secondary:""},AltRight:{primary:"Alt",secondary:""},ArrowUp:{primary:"â†‘",secondary:""},ArrowDown:{primary:"â†“",secondary:""},ArrowLeft:{primary:"â†",secondary:""},ArrowRight:{primary:"â†’",secondary:""},Home:{primary:"Home",secondary:""},End:{primary:"End",secondary:""},PageUp:{primary:"PgUp",secondary:""},PageDown:{primary:"PgDn",secondary:""},Insert:{primary:"Ins",secondary:""},F1:{primary:"F1",secondary:""},F2:{primary:"F2",secondary:""},F3:{primary:"F3",secondary:""},F4:{primary:"F4",secondary:""},F5:{primary:"F5",secondary:""},F6:{primary:"F6",secondary:""},F7:{primary:"F7",secondary:""},F8:{primary:"F8",secondary:""},F9:{primary:"F9",secondary:""},F10:{primary:"F10",secondary:""},F11:{primary:"F11",secondary:""},F12:{primary:"F12",secondary:""},NumpadDivide:{primary:"/",secondary:""},NumpadMultiply:{primary:"*",secondary:""},NumpadSubtract:{primary:"-",secondary:""},NumpadAdd:{primary:"+",secondary:""},NumpadEnter:{primary:"Enter",secondary:""},NumpadDecimal:{primary:".",secondary:""},Numpad0:{primary:"0",secondary:""},Numpad1:{primary:"1",secondary:""},Numpad2:{primary:"2",secondary:""},Numpad3:{primary:"3",secondary:""},Numpad4:{primary:"4",secondary:""},Numpad5:{primary:"5",secondary:""},Numpad6:{primary:"6",secondary:""},Numpad7:{primary:"7",secondary:""},Numpad8:{primary:"8",secondary:""},Numpad9:{primary:"9",secondary:""}}},wt={name:"QWERTZ",languages:["de"],keys:{Digit1:{primary:"1",secondary:""},Digit2:{primary:"2",secondary:""},Digit3:{primary:"3",secondary:""},Digit4:{primary:"4",secondary:""},Digit5:{primary:"5",secondary:""},Digit6:{primary:"6",secondary:""},Digit7:{primary:"7",secondary:""},Digit8:{primary:"8",secondary:""},Digit9:{primary:"9",secondary:""},Digit0:{primary:"0",secondary:""},KeyQ:{primary:"Q",secondary:""},KeyW:{primary:"W",secondary:""},KeyE:{primary:"E",secondary:""},KeyR:{primary:"R",secondary:""},KeyT:{primary:"T",secondary:""},KeyZ:{primary:"Y",secondary:""},KeyU:{primary:"U",secondary:""},KeyI:{primary:"I",secondary:""},KeyO:{primary:"O",secondary:""},KeyP:{primary:"P",secondary:""},KeyA:{primary:"A",secondary:""},KeyS:{primary:"S",secondary:""},KeyD:{primary:"D",secondary:""},KeyF:{primary:"F",secondary:""},KeyG:{primary:"G",secondary:""},KeyH:{primary:"H",secondary:""},KeyJ:{primary:"J",secondary:""},KeyK:{primary:"K",secondary:""},KeyL:{primary:"L",secondary:""},KeyY:{primary:"Z",secondary:""},KeyX:{primary:"X",secondary:""},KeyC:{primary:"C",secondary:""},KeyV:{primary:"V",secondary:""},KeyB:{primary:"B",secondary:""},KeyN:{primary:"N",secondary:""},KeyM:{primary:"M",secondary:""},Minus:{primary:"-",secondary:""},Equal:{primary:"=",secondary:""},BracketLeft:{primary:"[",secondary:""},BracketRight:{primary:"]",secondary:""},Quote:{primary:"'",secondary:""},Comma:{primary:",",secondary:""},Period:{primary:".",secondary:""},Backquote:{primary:"`",secondary:"~"},Space:{primary:"Space",secondary:""},Tab:{primary:"Tab",secondary:""},Escape:{primary:"Esc",secondary:""},Delete:{primary:"Del",secondary:""},CapsLock:{primary:"Caps",secondary:""},ShiftLeft:{primary:"Shift",secondary:""},ShiftRight:{primary:"Shift",secondary:""},ControlLeft:{primary:"Ctrl",secondary:""},ControlRight:{primary:"Ctrl",secondary:""},AltLeft:{primary:"Alt",secondary:""},AltRight:{primary:"Alt",secondary:""},ArrowUp:{primary:"â†‘",secondary:""},ArrowDown:{primary:"â†“",secondary:""},ArrowLeft:{primary:"â†",secondary:""},ArrowRight:{primary:"â†’",secondary:""},Home:{primary:"Home",secondary:""},End:{primary:"End",secondary:""},PageUp:{primary:"PgUp",secondary:""},PageDown:{primary:"PgDn",secondary:""},Insert:{primary:"Ins",secondary:""},F1:{primary:"F1",secondary:""},F2:{primary:"F2",secondary:""},F3:{primary:"F3",secondary:""},F4:{primary:"F4",secondary:""},F5:{primary:"F5",secondary:""},F6:{primary:"F6",secondary:""},F7:{primary:"F7",secondary:""},F8:{primary:"F8",secondary:""},F9:{primary:"F9",secondary:""},F10:{primary:"F10",secondary:""},F11:{primary:"F11",secondary:""},F12:{primary:"F12",secondary:""},NumpadDivide:{primary:"/",secondary:""},NumpadMultiply:{primary:"*",secondary:""},NumpadSubtract:{primary:"-",secondary:""},NumpadAdd:{primary:"+",secondary:""},NumpadEnter:{primary:"Enter",secondary:""},NumpadDecimal:{primary:".",secondary:""},Numpad0:{primary:"0",secondary:""},Numpad1:{primary:"1",secondary:""},Numpad2:{primary:"2",secondary:""},Numpad3:{primary:"3",secondary:""},Numpad4:{primary:"4",secondary:""},Numpad5:{primary:"5",secondary:""},Numpad6:{primary:"6",secondary:""},Numpad7:{primary:"7",secondary:""},Numpad8:{primary:"8",secondary:""},Numpad9:{primary:"9",secondary:""}}},kt={name:"AZERTY",languages:["fr"],keys:{Digit1:{primary:"1",secondary:""},Digit2:{primary:"2",secondary:""},Digit3:{primary:"3",secondary:""},Digit4:{primary:"4",secondary:""},Digit5:{primary:"5",secondary:""},Digit6:{primary:"6",secondary:""},Digit7:{primary:"7",secondary:""},Digit8:{primary:"8",secondary:""},Digit9:{primary:"9",secondary:""},Digit0:{primary:"0",secondary:""},KeyA:{primary:"Q",secondary:""},KeyQ:{primary:"A",secondary:""},KeyZ:{primary:"W",secondary:""},KeyW:{primary:"Z",secondary:""},KeyE:{primary:"E",secondary:""},KeyR:{primary:"R",secondary:""},KeyT:{primary:"T",secondary:""},KeyY:{primary:"Y",secondary:""},KeyU:{primary:"U",secondary:""},KeyI:{primary:"I",secondary:""},KeyO:{primary:"O",secondary:""},KeyP:{primary:"P",secondary:""},KeyS:{primary:"S",secondary:""},KeyD:{primary:"D",secondary:""},KeyF:{primary:"F",secondary:""},KeyG:{primary:"G",secondary:""},KeyH:{primary:"H",secondary:""},KeyJ:{primary:"J",secondary:""},KeyK:{primary:"K",secondary:""},KeyL:{primary:"L",secondary:""},KeyX:{primary:"X",secondary:""},KeyC:{primary:"C",secondary:""},KeyV:{primary:"V",secondary:""},KeyB:{primary:"B",secondary:""},KeyN:{primary:"N",secondary:""},KeyM:{primary:"M",secondary:""},Minus:{primary:"-",secondary:""},Equal:{primary:"=",secondary:""},BracketLeft:{primary:"[",secondary:""},BracketRight:{primary:"]",secondary:""},Quote:{primary:"'",secondary:""},Comma:{primary:",",secondary:""},Period:{primary:".",secondary:""},Backquote:{primary:"`",secondary:"~"},Space:{primary:"Space",secondary:""},Tab:{primary:"Tab",secondary:""},Escape:{primary:"Esc",secondary:""},Delete:{primary:"Del",secondary:""},CapsLock:{primary:"Caps",secondary:""},ShiftLeft:{primary:"Shift",secondary:""},ShiftRight:{primary:"Shift",secondary:""},ControlLeft:{primary:"Ctrl",secondary:""},ControlRight:{primary:"Ctrl",secondary:""},AltLeft:{primary:"Alt",secondary:""},AltRight:{primary:"Alt",secondary:""},ArrowUp:{primary:"â†‘",secondary:""},ArrowDown:{primary:"â†“",secondary:""},ArrowLeft:{primary:"â†",secondary:""},ArrowRight:{primary:"â†’",secondary:""},Home:{primary:"Home",secondary:""},End:{primary:"End",secondary:""},PageUp:{primary:"PgUp",secondary:""},PageDown:{primary:"PgDn",secondary:""},Insert:{primary:"Ins",secondary:""},F1:{primary:"F1",secondary:""},F2:{primary:"F2",secondary:""},F3:{primary:"F3",secondary:""},F4:{primary:"F4",secondary:""},F5:{primary:"F5",secondary:""},F6:{primary:"F6",secondary:""},F7:{primary:"F7",secondary:""},F8:{primary:"F8",secondary:""},F9:{primary:"F9",secondary:""},F10:{primary:"F10",secondary:""},F11:{primary:"F11",secondary:""},F12:{primary:"F12",secondary:""},NumpadDivide:{primary:"/",secondary:""},NumpadMultiply:{primary:"*",secondary:""},NumpadSubtract:{primary:"-",secondary:""},NumpadAdd:{primary:"+",secondary:""},NumpadEnter:{primary:"Enter",secondary:""},NumpadDecimal:{primary:".",secondary:""},Numpad0:{primary:"0",secondary:""},Numpad1:{primary:"1",secondary:""},Numpad2:{primary:"2",secondary:""},Numpad3:{primary:"3",secondary:""},Numpad4:{primary:"4",secondary:""},Numpad5:{primary:"5",secondary:""},Numpad6:{primary:"6",secondary:""},Numpad7:{primary:"7",secondary:""},Numpad8:{primary:"8",secondary:""},Numpad9:{primary:"9",secondary:""}}},St={lclick:{name:"Left Click",description:"Single left mouse click"},rclick:{name:"Right Click",description:"Single right mouse click"},mclick:{name:"Middle Click",description:"Single middle mouse click"},lpress:{name:"Left Press",description:"Left mouse press and hold"},rpress:{name:"Right Press",description:"Right mouse press and hold"},ldrag:{name:"Left Drag",description:"Left click and drag"},rdrag:{name:"Right Drag",description:"Right click and drag"},wheelup:{name:"Scroll Up",description:"Mouse wheel scroll up"},wheeldown:{name:"Scroll Down",description:"Mouse wheel scroll down"},Button1:{name:"Button1",description:"Standard left button"},Button2:{name:"Button2",description:"Standard right button"},Button3:{name:"Button3",description:"Middle button"},Button4:{name:"Button4",description:"Extra mouse button 4"},Button5:{name:"Button5",description:"Extra mouse button 5"},Button6:{name:"Button6",description:"Extra mouse button 6"},Button7:{name:"Button7",description:"Extra mouse button 7"},Button8:{name:"Button8",description:"Extra mouse button 8"},Button9:{name:"Button9",description:"Extra mouse button 9"},Button10:{name:"Button10",description:"Extra mouse button 10"}};function xt(e){switch(e){case"de":return wt;case"fr":return kt;default:return vt}}class Tt extends lt{constructor({eventBus:e,modalManager:i=null,app:a=null,document:n=("undefined"!=typeof window?window.document:void 0),ui:s=null,i18n:r}={}){super(e),this.componentName="KeyCaptureUI",this.modalManager=i,this.app=a||("undefined"!=typeof window?window.app:null),this.document=n,this.ui=s||("undefined"!=typeof window?window.stoUI:null),this.i18n=r,this.currentKeyboard=null,this.highlightedKeys=new Set,this.isDuplicationMode=!1,this.sourceKeyForDuplication=null,this.isCapturing=!1,this.ignoreNextChord=!1,this.lastModifierSide={ctrl:"L",alt:"L",shift:"L"},this.selectedLayout="en",this.$e=new Set(t.map(e=>e.toUpperCase()))}onInit(){this.addEventListener("capture-start",e=>this.handleCaptureStart(e)),this.addEventListener("update",e=>this.updateCapturedKeysDisplay(e)),this.addEventListener("chord-captured",e=>this.handleChordCaptured(e)),this.addEventListener("capture-stop",e=>this.handleCaptureStop(e)),this.addEventListener("key:duplicate",({key:e}={})=>{this.handleKeyDuplication(e)}),this.eventBus&&this.eventBus.on("modal:shown",({modalId:e})=>{"keySelectionModal"===e&&this.initializeModal()}),this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("toggleCaptureMode","click","toggle-capture-mode",()=>{this.toggleCaptureMode()}),this.onDom("confirm-key-selection","click","confirm-key-selection",()=>{this.confirmSelection()}),this.onDom("cancel-key-selection","click","cancel-key-selection",()=>{this.cancelSelection()}),this.onDom(".vkey","click","virtual-key-click",e=>{if(this.isCapturing)return;const t=e.target.closest(".vkey");if(!t)return;const i=t.dataset.keyCode;i&&this.selectKeyFromVirtualKeyboard(i)}),this.onDom("keyboardLayoutSelector","change","layout-change",e=>{this.changeKeyboardLayout(e.target.value)}),this.onDom("distinguishModifierSide","change","location-specific-toggle",e=>{this.emit("keycapture:set-location-specific",{value:e.target.checked}),this.cache.selectedKey&&this.updateChordWithLocationSpecific(e.target.checked),this.updateModifierHighlighting()}))}initializeModal(){console.log("[KeyCaptureUI] initializeModal called"),this.buildModalContent();const e=this.document.getElementById("keyboardLayoutSelector");e&&(e.value=this.selectedLayout),this.updateKeyboardLayout();const t=this.document.getElementById("distinguishModifierSide"),i=!!t?.checked;this.emit("keycapture:set-location-specific",{value:i}),this.startCaptureMode()}handleKeyDuplication(e){this.isDuplicationMode=!0,this.sourceKeyForDuplication=e,this.showKeySelectionModal()}showKeySelectionModal(){this.modalManager&&this.modalManager.show("keySelectionModal")}startCaptureMode(){this.updateCaptureState(!0),this.emit("keycapture:start",{context:"keySelectionModal"})}stopCaptureMode(){this.updateCaptureState(!1),this.emit("keycapture:stop")}toggleCaptureMode(){const e=this.document.getElementById("captureIndicator"),t=e?.classList.contains("active");t?(this.ignoreNextChord=!0,this.stopCaptureMode(),this.cache.selectedKey=null,this.clearVirtualModifiers(),this.updatePreviewDisplay(""),this.disableConfirmButton()):this.startCaptureMode()}updateCaptureState(e){const t=this.document.getElementById("captureIndicator"),i=this.document.getElementById("toggleCaptureMode");this.isCapturing=e,t&&t.classList.toggle("active",e),i&&(i.textContent=e?this.i18n.t("switch_to_manual"):this.i18n.t("start_capture"));const a=this.document.getElementById("virtualKeyboard");a&&a.classList.toggle("disabled",e)}handleCaptureStart({context:e}){this.updateCaptureState(!0)}handleCaptureStop({context:e}){this.updateCaptureState(!1)}updateCapturedKeysDisplay({chord:e,codes:t,context:i}){this.highlightKeysOnVirtualKeyboard(t),this.updatePreviewDisplay(e)}handleChordCaptured({chord:e,context:t}){this.ignoreNextChord?this.ignoreNextChord=!1:(this.selectKey(e),setTimeout(()=>{this.stopCaptureMode()},100))}selectKey(e){this.isUnsafeChord(e)?this.handleUnsafeChord(e):(this.cache.selectedKey=e,this.updateLastModifierSideFromChord(e),this.updatePreviewDisplay(e),this.enableConfirmButton(),this.highlightSelectedKeyOnKeyboard(e))}selectKeyFromVirtualKeyboard(e){if(["ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"].includes(e))return void this.toggleVirtualModifier(e);const t=this.getActiveVirtualModifiers();let i=e;if(t.length>0){const a=this.keyCodeToDisplayName(e);i=`${t.join("+")}+${a}`}else i=this.keyCodeToDisplayName(e);this.selectKey(i),t.length>0&&this.clearVirtualModifiers(!0)}toggleVirtualModifier(e){const t=this.document.getElementById("distinguishModifierSide")?.checked||!1,i=this.getModifierType(e),a="ctrl"===i?"ControlLeft":"alt"===i?"AltLeft":"ShiftLeft",n="ctrl"===i?"ControlRight":"alt"===i?"AltRight":"ShiftRight",s=(e,t)=>{e&&e.classList.toggle("modifier-active",t)},r=this.document.querySelector(`[data-key-code="${a}"]`),o=this.document.querySelector(`[data-key-code="${n}"]`),c=this.document.querySelector(`[data-key-code="${e}"]`),l=c?.classList.contains("modifier-active");if(this.clearVirtualModifiers(!0),l)return void this.updatePreviewWithCurrentModifiers();t?s(c,!0):(s(r,!0),s(o,!0));const d=["Ctrl","Alt","Shift","LCTRL","RCTRL","LALT","RALT","LSHIFT","RSHIFT"];this.cache.selectedKey&&this.cache.selectedKey.split("+").some(e=>e&&!d.includes(e))||this.updatePreviewWithCurrentModifiers(),i&&(this.lastModifierSide[i]=e.endsWith("Right")?"R":"L")}getModifierType(e){return e.includes("Control")?"ctrl":e.includes("Alt")?"alt":e.includes("Shift")?"shift":null}getActiveVirtualModifiersOfType(e,t){const i="ctrl"===e?"ControlLeft":"alt"===e?"AltLeft":"ShiftLeft",a="ctrl"===e?"ControlRight":"alt"===e?"AltRight":"ShiftRight",n=this.document.querySelector(`[data-key-code="${i}"]`),s=this.document.querySelector(`[data-key-code="${a}"]`),r=[];return n?.classList.contains("modifier-active")&&r.push(t?i:e),s?.classList.contains("modifier-active")&&r.push(t?a:e),[...new Set(r)]}getActiveVirtualModifiers(){const e=this.document.getElementById("distinguishModifierSide")?.checked||!1,t=[];return["ctrl","alt","shift"].forEach(i=>{const a=this.getActiveVirtualModifiersOfType(i,e);e?a.forEach(e=>{"ControlLeft"===e?t.push("LCTRL"):"ControlRight"===e?t.push("RCTRL"):"AltLeft"===e?t.push("LALT"):"AltRight"===e?t.push("RALT"):"ShiftLeft"===e?t.push("LSHIFT"):"ShiftRight"===e&&t.push("RSHIFT")}):a.length>0&&("ctrl"===i?t.push(this.i18n.t("ctrl")):"alt"===i?t.push(this.i18n.t("alt")):"shift"===i&&t.push(this.i18n.t("shift")))}),t}clearVirtualModifiers(e=!1){["ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"].forEach(e=>{const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&t.classList.remove("modifier-active")}),e||this.updatePreviewWithCurrentModifiers()}updatePreviewWithCurrentModifiers(){const e=this.getActiveVirtualModifiers();if(e.length>0){let t=e.join("+");if(this.cache.selectedKey){const e=/^(Ctrl|Alt|Shift|LCTRL|RCTRL|LALT|RALT|LSHIFT|RSHIFT)(\+|$)/i;this.cache.selectedKey.split("+").every(t=>e.test(t))||(t+="+"+this.cache.selectedKey)}else t+="+";this.updatePreviewDisplay(t)}else this.cache.selectedKey?this.updatePreviewDisplay(this.cache.selectedKey):this.updatePreviewDisplay("")}async confirmSelection(){if(this.cache.selectedKey)try{let e;if(this.isDuplicationMode){const t=this.sourceKeyForDuplication,i=this.cache.selectedKey;if(e=await this.request("key:duplicate-with-name",{sourceKey:t,newKey:i}),!e?.success){const t=this.i18n.t(e?.error,e?.params);return void this.showToast(t,"error")}{const a=e.sourceKey||e?.data?.from||t,n=e.newKey||e?.data?.to||i,s=this.i18n.t("key_duplicated",{from:a,to:n});this.showToast(s,"success"),this.isDuplicationMode=!1,this.sourceKeyForDuplication=null}}else{if(e=await this.request("key:add",{key:this.cache.selectedKey}),!e?.success){const t=this.i18n.t(e?.error,e?.params);return void this.showToast(t,"error")}{const e=this.i18n.t("key_added",{keyName:this.cache.selectedKey});this.showToast(e,"success")}}this.modalManager?.hide("keySelectionModal"),this.resetState()}catch(e){console.error("Failed to confirm key selection:",e);const t=this.i18n.t("key_selection_failed");this.showToast(t,"error")}}cancelSelection(){this.modalManager?.hide("keySelectionModal"),this.resetState()}resetState(){this.cache.selectedKey=null,this.highlightedKeys.clear(),this.isDuplicationMode=!1,this.sourceKeyForDuplication=null,this.isCapturing=!1,this.ignoreNextChord=!1,this.lastModifierSide={ctrl:"L",alt:"L",shift:"L"},this.clearKeyboardHighlights(),this.clearVirtualModifiers(),this.updatePreviewDisplay(""),this.disableConfirmButton(),this.emit("keycapture:set-location-specific",{value:!1})}buildModalContent(){const e=this.document.getElementById("keySelectionModal");if(!e)return;const t=e.querySelector(".modal-body");t&&(t.innerHTML=this.generateModalHTML())}generateModalHTML(){return xt(this.i18n.language||"en").name,`\n      <div class="hybrid-key-capture">\n        \x3c!-- Header Section --\x3e\n        <div class="capture-header">\n          <div class="capture-zone" id="captureZone">\n            <div class="capture-indicator" id="captureIndicator">\n              <div class="pulse-ring"></div>\n              <i class="fas fa-keyboard"></i>\n            </div>\n            <div class="capture-instructions">\n              <h3 data-i18n="press_any_key_combination">${this.i18n.t("press_any_key_combination")}</h3>\n              <p data-i18n="capture_instructions">${this.i18n.t("capture_instructions")}</p>\n            </div>\n          </div>\n          <button class="btn btn-secondary toggle-mode" id="toggleCaptureMode" data-i18n="switch_to_manual">\n            ${this.i18n.t("switch_to_manual")}\n          </button>\n        </div>\n\n        \x3c!-- Preview Section --\x3e\n        <div class="selection-preview">\n          <div class="preview-display">\n            <label data-i18n="selected_key">${this.i18n.t("selected_key")}:</label>\n            <div class="key-preview-display" id="keyPreviewDisplay">\n              <span class="no-selection" data-i18n="no_key_selected">${this.i18n.t("no_key_selected")}</span>\n            </div>\n          </div>\n          <div class="preview-controls">\n            <label class="location-specific-toggle">\n              <input type="checkbox" id="distinguishModifierSide" />\n              <span data-i18n="distinguish_left_right_modifiers">${this.i18n.t("distinguish_left_right_modifiers")}</span>\n            </label>\n          </div>\n        </div>\n\n        \x3c!-- Main Content --\x3e\n        <div class="capture-content">\n          \x3c!-- Virtual Keyboard Section --\x3e\n          <div class="virtual-keyboard-section">\n            <div class="section-header">\n              <select id="keyboardLayoutSelector" class="form-select">\n                <option value="en">QWERTY (English)</option>\n                <option value="de">QWERTZ (German)</option>\n                <option value="fr">AZERTY (French)</option>\n                <option value="es">QWERTY (Spanish)</option>\n              </select>\n            </div>\n            <div class="virtual-keyboard" id="virtualKeyboard">\n              \x3c!-- Virtual keyboard will be rendered here --\x3e\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Footer Section --\x3e\n        <div class="capture-footer">\n          <div class="action-buttons">\n            <button class="btn btn-primary" id="confirm-key-selection" disabled data-i18n="confirm_selection">\n              ${this.i18n.t("confirm_selection")}\n            </button>\n            <button class="btn btn-secondary" id="cancel-key-selection" data-i18n="cancel">\n              ${this.i18n.t("cancel")}\n            </button>\n          </div>\n        </div>\n      </div>\n    `}updateKeyboardLayout(){this.currentKeyboard=JSON.parse(JSON.stringify(xt(this.selectedLayout))),this.renderVirtualKeyboard()}changeKeyboardLayout(e){this.selectedLayout=e||"en",this.currentKeyboard=JSON.parse(JSON.stringify(xt(this.selectedLayout))),this.renderVirtualKeyboard()}renderVirtualKeyboard(){const e=this.document.getElementById("virtualKeyboard");if(!e||!this.currentKeyboard)return;const t={},i={},a={},n={};Object.entries(bt).forEach(([e,s])=>{var r,o,c;r=s.col>=22?n:s.col>=17?a:s.col>=14?i:t,o=s.row,c={keyCode:e,...s},r[o]||(r[o]=[]),r[o].push(c)});const s=e=>{let t=this.currentKeyboard.keys[e.keyCode];return!t&&St[e.keyCode]&&(t={primary:St[e.keyCode].name,secondary:""}),t||(t={primary:e.keyCode,secondary:""}),`\n        <button class="vkey" data-key-code="${e.keyCode}" data-row="${e.row}" data-col="${e.col}">\n          <span class="key-primary">${t.primary}</span>\n          ${t.secondary?`<span class="key-secondary">${t.secondary}</span>`:""}\n        </button>\n      `},r=Math.max(...Object.values(bt).map(e=>e.row)),o=(e,t="main")=>{const i=[22,23,24];let a="";for(let n=0;n<=r;n++){const r=(e[n]||[]).sort((e,t)=>e.col-t.col);let o="";if("numpad"===t)if(1===n)o+='<div class="vkey placeholder" style="flex:0 0 2.5rem; height:2.5rem;"></div>',r.forEach(e=>{o+=s(e)});else{const e=20;for(let t=17;t<=e;t++){const e=r.find(e=>e.col===t);e?(o+=s(e),e.width&&e.width>1&&(t+=e.width-1)):o+='<div class="vkey placeholder"></div>'}}else if("mouse"===t)o=i.map(e=>{const t=r.find(t=>t.col===e);return t?s(t):'<div class="vkey placeholder"></div>'}).join("");else if("nav"===t)4===n&&(o+='<div class="vkey placeholder" style="flex:0 0 2.5rem; height:2.5rem;"></div>'),r.forEach(e=>{o+=s(e)});else if(r.length){let e=r[0].col;"nav"===t&&4===n&&r.some(e=>15===e.col)&&(o+='<div class="vkey placeholder" style="flex:0 0 2.5rem; height:2.5rem;"></div>',e=14.5);let i=e;r.forEach(e=>{if(e.col>i){const t=e.col-i;o+=`<div class="vkey placeholder" style="flex:0 0 ${2.5*t}rem; height:2.5rem;"></div>`}o+=s(e),i=e.col+(e.width||1)})}a+=`<div class="keyboard-row">${o}</div>`}return a},c=`\n      <div class="keyboard-columns">\n        <div class="keyboard-column main">${o(t)}</div>\n        <div class="keyboard-column nav">${o(i,"nav")}</div>\n        <div class="keyboard-column numpad">${o(a,"numpad")}</div>\n        <div class="keyboard-column mouse">${o(n,"mouse")}</div>\n      </div>`;e.innerHTML=c}updatePreviewDisplay(e){const t=this.document.getElementById("keyPreviewDisplay");if(t)if(e){const i=this.formatKeyForDisplay(e);t.innerHTML=`<span class="key-combination">${i}</span>`}else t.innerHTML=`<span class="no-selection" data-i18n="no_key_selected">${this.i18n.t("no_key_selected")}</span>`}formatKeyForDisplay(e){return e?e.split("+").filter(e=>e.length>0).map(e=>`<kbd>${e}</kbd>`).join('<span class="plus">+</span>'):""}keyCodeToDisplayName(e){if(e.startsWith("Numpad")){const t=e.match(/^Numpad(\d)$/);return t?`numpad${t[1]}`:{Add:"Add",Subtract:"Subtract",Multiply:"Multiply",Divide:"Divide",Decimal:"Decimal",Enter:"numpadenter"}[e.replace("Numpad","")]||e}const t=this.currentKeyboard?.keys[e];return t?t.primary:e.replace(/^Key|^Digit/,"")}highlightKeysOnVirtualKeyboard(e){this.clearKeyboardHighlights(),e&&0!==e.length&&e.forEach(e=>{const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&(t.classList.add("pressed"),this.highlightedKeys.add(e))})}updateModifierHighlighting(){const e=this.document.getElementById("distinguishModifierSide")?.checked||!1,t=[];if(["ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"].forEach(e=>{const i=this.document.querySelector(`[data-key-code="${e}"]`);i?.classList.contains("modifier-active")&&t.push(e)}),this.clearVirtualModifiers(!0),t.length>0)if(e){const e=new Set,i={L:"Left",R:"Right"};t.forEach(a=>{const n=this.getModifierType(a);if(!n||e.has(n))return;const s=this.lastModifierSide[n]||"L",r="ctrl"===n?`Control${i[s]}`:"alt"===n?`Alt${i[s]}`:`Shift${i[s]}`;let o=r;if(!t.includes(o)){const e="L"===s?r.replace("Left","Right"):r.replace("Right","Left");t.includes(e)&&(o=e)}const c="ctrl"===n?"ControlLeft":"alt"===n?"AltLeft":"ShiftLeft",l="ctrl"===n?"ControlRight":"alt"===n?"AltRight":"ShiftRight";if(o===c){const e=this.document.querySelector(`[data-key-code="${l}"]`);e?.classList.remove("selected")}else{const e=this.document.querySelector(`[data-key-code="${c}"]`);e?.classList.remove("selected")}this.highlightKey(o),e.add(n)})}else{const e=new Set;t.forEach(t=>{const i=this.getModifierType(t);i&&e.add(i)}),e.forEach(e=>{const t="ctrl"===e?"ControlLeft":"alt"===e?"AltLeft":"ShiftLeft",i="ctrl"===e?"ControlRight":"alt"===e?"AltRight":"ShiftRight",a=this.document.querySelector(`[data-key-code="${t}"]`),n=this.document.querySelector(`[data-key-code="${i}"]`);a?.classList.add("modifier-active"),n?.classList.add("modifier-active")})}const i=["Ctrl","Alt","Shift","LCTRL","RCTRL","LALT","RALT","LSHIFT","RSHIFT"];this.cache.selectedKey&&this.cache.selectedKey.split("+").some(e=>e&&!i.includes(e))||this.updatePreviewWithCurrentModifiers()}highlightSelectedKeyOnKeyboard(e){if(this.clearKeyboardHighlights(),!e)return;const t=e.split("+");this.updateLastModifierSideFromChord(e),t.forEach(e=>{let t=null;const i=this.document.getElementById("distinguishModifierSide")?.checked||!1;if("Ctrl"===e&&!i)return this.highlightKey("ControlLeft"),void this.highlightKey("ControlRight");if("Alt"===e&&!i)return this.highlightKey("AltLeft"),void this.highlightKey("AltRight");if("Shift"===e&&!i)return this.highlightKey("ShiftLeft"),void this.highlightKey("ShiftRight");if("LCTRL"===e)t="ControlLeft";else if("RCTRL"===e)t="ControlRight";else if("LALT"===e)t="AltLeft";else if("RALT"===e)t="AltRight";else if("LSHIFT"===e)t="ShiftLeft";else if("RSHIFT"===e)t="ShiftRight";else if("Ctrl"===e)t="ControlLeft";else if("Alt"===e)t="AltLeft";else if("Shift"===e)t="ShiftLeft";else if(this.currentKeyboard){const i={1:"Digit1",2:"Digit2",3:"Digit3",4:"Digit4",5:"Digit5",6:"Digit6",7:"Digit7",8:"Digit8",9:"Digit9",0:"Digit0",numpad0:"Numpad0",numpad1:"Numpad1",numpad2:"Numpad2",numpad3:"Numpad3",numpad4:"Numpad4",numpad5:"Numpad5",numpad6:"Numpad6",numpad7:"Numpad7",numpad8:"Numpad8",numpad9:"Numpad9",Add:"NumpadAdd",Subtract:"NumpadSubtract",Multiply:"NumpadMultiply",Divide:"NumpadDivide",Decimal:"NumpadDecimal",numpadenter:"NumpadEnter",A:"KeyA",B:"KeyB",C:"KeyC",D:"KeyD",E:"KeyE",F:"KeyF",G:"KeyG",H:"KeyH",I:"KeyI",J:"KeyJ",K:"KeyK",L:"KeyL",M:"KeyM",N:"KeyN",O:"KeyO",P:"KeyP",Q:"KeyQ",R:"KeyR",S:"KeyS",T:"KeyT",U:"KeyU",V:"KeyV",W:"KeyW",X:"KeyX",Y:"KeyY",Z:"KeyZ",Space:"Space",Tab:"Tab",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12"};for(const[i,a]of Object.entries(this.currentKeyboard.keys))if(a.primary===e||a.secondary===e){t=i;break}t||(t=i[e])}t&&this.highlightKey(t)})}highlightKey(e){const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&(t.classList.add("selected"),this.highlightedKeys.add(e))}clearKeyboardHighlights(){this.highlightedKeys.forEach(e=>{const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&t.classList.remove("pressed","selected")}),this.highlightedKeys.clear()}enableConfirmButton(){const e=this.document.getElementById("confirm-key-selection");e&&(e.disabled=!1)}disableConfirmButton(){const e=this.document.getElementById("confirm-key-selection");e&&(e.disabled=!0)}updateChordWithLocationSpecific(e){if(!this.cache.selectedKey)return;let t=this.cache.selectedKey;t=e?t.replace(/\bCtrl\b/g,"R"===this.lastModifierSide.ctrl?"RCTRL":"LCTRL").replace(/\bAlt\b/g,"R"===this.lastModifierSide.alt?"RALT":"LALT").replace(/\bShift\b/g,"R"===this.lastModifierSide.shift?"RSHIFT":"LSHIFT"):t.replace(/\bLCTRL\b/g,"Ctrl").replace(/\bRCTRL\b/g,"Ctrl").replace(/\bLALT\b/g,"Alt").replace(/\bRALT\b/g,"Alt").replace(/\bLSHIFT\b/g,"Shift").replace(/\bRSHIFT\b/g,"Shift"),t!==this.cache.selectedKey&&this.selectKey(t)}updateLastModifierSideFromChord(e){e&&e.split("+").forEach(e=>{"LCTRL"===e?this.lastModifierSide.ctrl="L":"RCTRL"===e?this.lastModifierSide.ctrl="R":"LALT"===e?this.lastModifierSide.alt="L":"RALT"===e?this.lastModifierSide.alt="R":"LSHIFT"===e?this.lastModifierSide.shift="L":"RSHIFT"===e&&(this.lastModifierSide.shift="R")})}isUnsafeChord(e){return!!e&&this.$e.has(e.toUpperCase())}async handleUnsafeChord(e){const t=this.i18n.t("unsafe_keybind",{key:e});this.emit("toast:show",{message:t,type:"error"}),this.cache.selectedKey=null,this.updatePreviewDisplay(""),this.disableConfirmButton()}}class Ct extends lt{constructor({eventBus:e,modalManager:t,i18n:i}={}){super(e),this.componentName="VFXManagerUI",this.modalManager=t,this.i18n=i,this.domListenersSetup=!1,this.vfxManager=null}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventBus.on("vfx:modal-populate",this.handleModalPopulate.bind(this)),this.setupDOMEventListeners()}handleModalPopulate({vfxManager:e}){this.vfxManager=e,this.populateModal(),this.modalManager.show("vertigoModal"),this.updatePreview()}populateModal(){if(!this.vfxManager)return;const e=document.getElementById("spaceEffectsList");e&&(e.innerHTML="",window.VFX_EFFECTS.space.forEach(t=>{const i=this.createEffectItem("space",t);e.appendChild(i)}));const t=document.getElementById("groundEffectsList");t&&(t.innerHTML="",window.VFX_EFFECTS.ground.forEach(e=>{const i=this.createEffectItem("ground",e);t.appendChild(i)})),this.updateCheckboxes("space"),this.updateCheckboxes("ground");const i=document.getElementById("vertigoShowPlayerSay");i&&(i.checked=this.vfxManager.showPlayerSay),this.updateEffectCounts(),this.updatePreview()}createEffectItem(e,t){const i=document.createElement("div");i.className="effect-item";const a=this.vfxManager.isEffectSelected(e,t.effect);return i.innerHTML=`\n      <label class="effect-label">\n        <input type="checkbox" \n               class="effect-checkbox" \n               data-environment="${e}" \n               data-effect="${t.effect}"\n               ${a?"checked":""}>\n        <span class="effect-name">${t.label}</span>\n      </label>\n    `,i}updateCheckboxes(e){document.querySelectorAll(`input[data-environment="${e}"]`).forEach(t=>{const i=t.dataset.effect;t.checked=this.vfxManager.isEffectSelected(e,i)})}updateEffectCounts(){const e=this.vfxManager.getEffectCount("space"),t=document.getElementById("spaceEffectCount");t&&(t.textContent=`${e} ${this.i18n.t("selected")}`);const i=this.vfxManager.getEffectCount("ground"),a=document.getElementById("groundEffectCount");a&&(a.textContent=`${i} ${this.i18n.t("selected")}`)}updatePreview(){const e=document.getElementById("spaceAliasCommand");if(e&&this.vfxManager){const t=this.vfxManager.generateAlias("space");e.textContent=t||this.i18n.t("no_space_effects_selected")}const t=document.getElementById("groundAliasCommand");if(t&&this.vfxManager){const e=this.vfxManager.generateAlias("ground");t.textContent=e||this.i18n.t("no_ground_effects_selected")}}setupDOMEventListeners(){this.domListenersSetup||(this.onDom(".effect-checkbox","change","vfx-effect-change",e=>{const t=e.target.dataset.environment,i=e.target.dataset.effect;this.vfxManager&&(this.vfxManager.toggleEffect(t,i),this.updateEffectCounts(),this.updatePreview())}),this.onDom("#vertigoShowPlayerSay","change","vfx-playersay-change",e=>{this.vfxManager&&(this.vfxManager.showPlayerSay=e.target.checked,this.updatePreview())}),this.onDom("spaceSelectAll","click","vfx-space-select-all",()=>{this.vfxManager&&(this.vfxManager.selectAllEffects("space"),this.updateCheckboxes("space"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("spaceClearAll","click","vfx-space-clear-all",()=>{this.vfxManager&&(this.vfxManager.selectedEffects.space.clear(),this.updateCheckboxes("space"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("groundSelectAll","click","vfx-ground-select-all",()=>{this.vfxManager&&(this.vfxManager.selectAllEffects("ground"),this.updateCheckboxes("ground"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("groundClearAll","click","vfx-ground-clear-all",()=>{this.vfxManager&&(this.vfxManager.selectedEffects.ground.clear(),this.updateCheckboxes("ground"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("saveVertigoBtn","click","vfx-save",()=>{this.emit("vfx:save-effects")}),this.domListenersSetup=!0)}onDestroy(){this.domListenersSetup=!1,this.vfxManager=null}}class $t extends lt{constructor({eventBus:e,app:t=null,modalManager:i=null,confirmDialog:a=null,i18n:n,document:s=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="KeyBrowserUI",this.app=t||(void 0!==window.app?window.app:null),this.modalManager=i,this.confirmDialog=a||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=n,this.document=s}onInit(){const e=localStorage.getItem("keyViewMode")||"grid";this.updateViewToggleButton(e),this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("addKeyBtn","click","key-add",()=>{this.showKeySelectionModal()}),this.onDom("deleteKeyBtn","click","key-delete",()=>{this.cache.selectedKey&&this.confirmDeleteKey(this.cache.selectedKey)}),this.onDom("duplicateKeyBtn","click","key-duplicate",()=>{this.cache.selectedKey&&this.duplicateKey(this.cache.selectedKey)}),this.onDomDebounced("keyFilter","input","key-filter",e=>{this.filterKeys(e.target.value)},250),this.onDom("keyFilter","keydown","key-filter-key",e=>{if("Escape"===e.key){e.preventDefault();const t=e.target;t.value="",t.classList.remove("expanded"),this.emit("key:filter",{filter:""})}else if("Enter"===e.key){const t=e.target;t.classList.remove("expanded"),t.blur()}}),this.onDom("showAllKeysBtn","click","show-all-keys",()=>{this.showAllKeys()}),this.onDom("toggleKeyViewBtn","click","toggle-key-view",()=>{this.toggleKeyView()}),this.onDom("keySearchBtn","click","key-search-toggle",()=>{this.toggleKeySearch()}),this.eventBus.on("key:list-changed",()=>this.render()),this.addEventListener("environment:changed",(e={})=>{const t="string"==typeof e?e:e.environment||e.newMode||e.mode;t&&(this.toggleVisibility(t),"alias"!==t&&this.render())}),this.addEventListener("key-selected",()=>{this.render()}),this.addEventListener("profile:switched",()=>{this.render()}),this.addEventListener("key-view:toggle",()=>this.toggleKeyView()),this.addEventListener("key-view:update-toggle",e=>this.updateViewToggleButton(e?.viewMode)),this.addEventListener("keys:filter",e=>{const t="string"==typeof e?e:e?.value||"";this.filterKeys(t)}),this.addEventListener("keys:show-all",()=>this.showAllKeys()),this.addEventListener("key-view:mode-changed",()=>this.render()),this.addEventListener("language:changed",()=>{this.render()}),this.addEventListener("preferences:changed",({key:e})=>{"theme"===e&&this.render()}))}async render(){const e=this.document.getElementById("keyGrid");if(!e)return;const t=this.cache.profile;if(!t)return void(e.innerHTML=`<div class="empty-state"><i class="fas fa-folder-open"></i><h4>${this.i18n.t("no_profile_selected")}</h4></div>`);const i=await this.request("key:get-all");this.Be=i;const a=Object.keys(i),n={};a.forEach(e=>{const t=i[e];t&&t.length>0&&(n[e]=t)});const s=[...new Set([...a,...Object.keys(n)])],r=this.document.createDocumentFragment(),o=localStorage.getItem("keyViewMode")||"grid";"key-types"===o?(await this.renderKeyTypeView(r,t,s),e.classList.add("categorized")):"grid"===o?(await this.renderSimpleGridView(r,s),e.classList.remove("categorized")):(await this.renderCommandCategoryView(r,n,s),e.classList.add("categorized")),e.innerHTML="",e.appendChild(r)}async renderSimpleGridView(e,t){(await this.request("key:sort",{keys:t})).forEach(t=>{const i=this.createKeyElement(t);e.appendChild(i)})}async renderCommandCategoryView(e,t,i){const a=await this.categorizeKeys(t,i),n=Object.entries(a).sort(([e,t],[i,a])=>t.priority!==a.priority?t.priority-a.priority:t.name.localeCompare(a.name));for(const[t,i]of n){const a=await this.createKeyCategoryElement(t,i);e.appendChild(a)}}async renderKeyTypeView(e,t,i){const a=await this.categorizeKeysByType(this.Be,i),n=Object.entries(a).sort(([,e],[,t])=>e.priority-t.priority);for(const[t,i]of n){const a=await this.createKeyCategoryElement(t,i,"key-type");e.appendChild(a)}}async categorizeKeys(e,t){return await this.request("key:categorize-by-command",{keysWithCommands:e,allKeys:t})}async categorizeKeysByType(e,t){return await this.request("key:categorize-by-type",{keysWithCommands:e,allKeys:t})}formatKeyName(e){return e.replace(/\+/g,"<br>+")}createKeyElement(e){const t=this.Be||{},i=t&&t[e]?t[e]:[],a=e===this.cache.selectedKey,n=i.filter(e=>"string"==typeof e?""!==e.trim():!(!e||"string"!=typeof e.command)&&""!==e.command.trim()),s=this.document.createElement("div");s.className="key-item "+(a?"active":""),s.dataset.key=e,s.title=`${e}: ${n.length} command${1!==n.length?"s":""}`;const r=this.formatKeyName(e),o=e.length,c=o<=3?"short":o<=5?"medium":o<=8?"long":"extra-long";return s.dataset.length=c,s.innerHTML=`<div class="key-label">${r}</div>${n.length>0?`<div class="activity-bar" style="width:${Math.min(15*n.length,100)}%"></div><div class="command-count-badge">${n.length}</div>`:""}`,this.onDom(s,"click","key-element-click",()=>{this.request("key:select",{keyName:e,environment:this.cache?.currentEnvironment||"space"})}),s}async createKeyCategoryElement(e,t,i="command"){const a=this.document.createElement("div");a.className="category",a.dataset.category=e;const n=await this.request("key:get-category-state",{categoryId:e,mode:i});a.innerHTML=`<h4 class="${n?"collapsed":""}" data-category="${e}" data-mode="${i}"><i class="fas fa-chevron-right category-chevron"></i><i class="${t.icon}"></i>${t.name}<span class="key-count">(${t.keys.length})</span></h4><div class="category-commands ${n?"collapsed":""}">${t.keys.map(e=>this.createKeyElement(e).outerHTML).join("")}</div>`;const s=a.querySelector("h4");this.onDom(s,"click","category-header-click",()=>{this.toggleKeyCategory(e,a,i)});const r=a.querySelector(".category-commands");return r.innerHTML="",t.keys.forEach(e=>r.appendChild(this.createKeyElement(e))),a}async toggleKeyCategory(e,t,i="command"){const a=await this.request("key:toggle-category",{categoryId:e,mode:i}),n=t.querySelector("h4"),s=t.querySelector(".category-commands");a?(n.classList.add("collapsed"),s.classList.add("collapsed")):(n.classList.remove("collapsed"),s.classList.remove("collapsed"))}updateViewToggleButton(e){const t=this.document.getElementById("toggleKeyViewBtn");if(!t)return;const i=t.querySelector("i")||t;"categorized"===e?(i.className="fas fa-sitemap",t.title=this.i18n.t("switch_to_key_type_view")):"key-types"===e?(i.className="fas fa-th",t.title=this.i18n.t("switch_to_grid_view")):(i.className="fas fa-list",t.title=this.i18n.t("switch_to_command_categories"))}toggleKeyView(){if(this.app&&"alias"===this.app.currentEnvironment)return;const e=localStorage.getItem("keyViewMode")||"grid";let t;t="key-types"===e?"grid":"grid"===e?"categorized":"key-types",localStorage.setItem("keyViewMode",t),this.render(),this.updateViewToggleButton(t),this.emit("key-view:mode-changed",{mode:t})}filterKeys(e=""){const t=(e||"").toString().toLowerCase(),i=this.document.getElementById("keyGrid");if(!i)return;const a=Array.from(i.querySelectorAll(".key-item")).map(e=>e.dataset.key),n=new Set;a.forEach(e=>{(!t||e.toLowerCase().includes(t))&&n.add(e)}),i.querySelectorAll(".key-item").forEach(e=>{const t=e.dataset.key,i=n.has(t);e.style.display=i?"flex":"none"}),i.querySelectorAll(".command-item[data-key]").forEach(e=>{const t=e.dataset.key,i=n.has(t);e.style.display=i?"flex":"none"}),i.querySelectorAll(".category").forEach(e=>{const i=e.querySelectorAll('.command-item[data-key]:not([style*="display: none"])'),a=!t||i.length>0;e.style.display=a?"block":"none"});const s=this.document.getElementById("keySearchBtn");if(s){const e=!!t;s.classList.toggle("active",e),s.setAttribute("aria-pressed",e)}}showAllKeys(){const e=this.document.getElementById("keyGrid");if(!e)return;e.querySelectorAll(".key-item").forEach(e=>{e.style.display="flex"}),e.querySelectorAll(".command-item[data-key]").forEach(e=>{e.style.display="flex"}),e.querySelectorAll(".category").forEach(e=>{e.style.display="block"});const t=this.document.getElementById("keyFilter");t&&(t.value="");const i=this.document.getElementById("keySearchBtn");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false"))}toggleVisibility(e){requestAnimationFrame(()=>{const t=this.document.querySelector(".key-selector-container");t?"alias"!==e?t.style.removeProperty("display"):t.style.setProperty("display","none","important"):console.warn("[KeyBrowserUI] Key selector container not found in DOM")})}handleInitialState(e,t){if(!t)return;if("SelectionService"===e)return void(t.selectedKey&&this.render());const i=t.environment||t.currentEnvironment;i&&(this.toggleVisibility(i),"alias"!==i&&this.render())}showKeySelectionModal(){this.modalManager&&this.modalManager.show("keySelectionModal")}async confirmDeleteKey(e){if(!e||!this.confirmDialog)return!1;const t=this.i18n.t("confirm_delete_key",{keyName:e}),i=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(t,i,"danger","keyDelete")){const t=await this.request("key:delete",{key:e});if(t?.success){const t=this.i18n.t("key_deleted",{keyName:e});return this.showToast(t,"success"),!0}{const e=this.i18n.t(t?.error,t?.params);return this.showToast(e,"error"),!1}}return!1}async duplicateKey(e){return!!e&&(this.emit("key:duplicate",{key:e}),!0)}toggleKeySearch(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("keyFilter");t&&(t.classList.toggle("expanded")?t.focus():t.blur())}hasRequiredData(){return this.cache&&this.cache.currentProfile&&this.cache.currentEnvironment&&void 0!==this.cache.keys}performInitialRender(){this.render().catch(e=>{console.error("[KeyBrowserUI] Initial render failed:",e)})}}class Bt{constructor(e=null,t={}){this.eventBus=e,this.options={enableCache:!0,maxCacheSize:1e3,enablePerformanceMetrics:!1,hotPathThreshold:10,...t},this.parseCache=new Map,this.hotPathCache=new Map,this.frequencyTracker=new Map,this.performanceMetrics=new Map,this.signatures=this.initializeCommandSignatures(),this.eventBus&&this.setupRequestHandlers()}setupRequestHandlers(){re(this.eventBus,"parser:parse-command-string",({commandString:e,options:t})=>this.parseCommandString(e,t)),re(this.eventBus,"parser:get-performance-metrics",()=>Array.from(this.performanceMetrics.entries())),re(this.eventBus,"parser:clear-cache",()=>(this.parseCache.clear(),this.hotPathCache.clear(),this.frequencyTracker.clear(),{success:!0}))}initializeCommandSignatures(){return{TrayExecution:{patterns:[{regex:/^(\+(?:STO)?TrayExecByTray)\s+(\d+)\s+(\d+)$/i,weight:100,signature:"TrayExecByTray(active: number, tray: number, slot: number)",extractParams:e=>({active:1,tray:parseInt(e[2]),slot:parseInt(e[3]),baseCommand:e[1],isShorthand:!0}),generateDisplayText:e=>({key:"command_definitions.custom_tray.name",params:{tray:e.tray,slot:e.slot},fallback:`Tray Execution (${e.tray} ${e.slot})`})},{regex:/^((?:STO)?TrayExecByTray)\s+(\d+)\s+(\d+)\s+(\d+)$/i,weight:99,signature:"TrayExecByTray(active: number, tray: number, slot: number)",extractParams:e=>({active:parseInt(e[2]),tray:parseInt(e[3]),slot:parseInt(e[4]),baseCommand:e[1],isShorthand:!1}),generateDisplayText:e=>({key:"command_definitions.custom_tray.name",params:{tray:e.tray,slot:e.slot},fallback:`Tray Execution (${e.tray} ${e.slot})`})}],category:"tray",baseCommand:"TrayExecByTray",icon:"âš¡"},TrayWithBackup:{patterns:[{regex:/^(\+TrayExecByTrayWithBackup)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)$/i,weight:90,signature:"TrayExecByTrayWithBackup(active: number, tray: number, slot: number, backup_tray: number, backup_slot: number)",extractParams:e=>({active:1,tray:parseInt(e[2]),slot:parseInt(e[3]),backup_tray:parseInt(e[4]),backup_slot:parseInt(e[5]),baseCommand:e[1],isShorthand:!0}),generateDisplayText:e=>({key:"command_definitions.tray_with_backup.name",params:{tray:e.tray,slot:e.slot,backup_tray:e.backup_tray,backup_slot:e.backup_slot},fallback:`Tray Execution with Backup (${e.tray} ${e.slot} -> ${e.backup_tray} ${e.backup_slot})`})},{regex:/^(TrayExecByTrayWithBackup)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)$/i,weight:89,signature:"TrayExecByTrayWithBackup(active: number, tray: number, slot: number, backup_tray: number, backup_slot: number)",extractParams:e=>({active:parseInt(e[2]),tray:parseInt(e[3]),slot:parseInt(e[4]),backup_tray:parseInt(e[5]),backup_slot:parseInt(e[6]),baseCommand:e[1],isShorthand:!1}),generateDisplayText:e=>({key:"command_definitions.tray_with_backup.name",params:{tray:e.tray,slot:e.slot,backup_tray:e.backup_tray,backup_slot:e.backup_slot},fallback:`Tray Execution with Backup (${e.tray} ${e.slot} -> ${e.backup_tray} ${e.backup_slot})`})}],category:"tray",baseCommand:"TrayExecByTrayWithBackup",icon:"âš¡"},Communication:{patterns:[{regex:/^(say|team|zone|tell)\s+"([^"]+)"$/i,weight:70,signature:"Communication(verb: string, message: string)",extractParams:e=>({verb:e[1],message:e[2]}),generateDisplayText:e=>`${e.verb}: "${e.message}"`},{regex:/^(say|team|zone|tell)\s+(.+)$/i,weight:65,signature:"Communication(verb: string, message: string)",extractParams:e=>({verb:e[1],message:e[2]}),generateDisplayText:e=>`${e.verb}: ${e.message}`}],category:"communication",baseCommand:"Communication",icon:"ğŸ’¬"},TargetWithName:{patterns:[{regex:/^Target\s+"([^"]+)"$/i,weight:60,signature:"Target(entityName: string)",extractParams:e=>({entityName:e[1]}),generateDisplayText:e=>`Target "${e.entityName}"`}],category:"targeting",baseCommand:"Target",icon:"ğŸ¯"},VFXCommands:{patterns:[{regex:/^dynFxSetFXExclusionList_Combined$/i,weight:48,signature:"VFXExclusionMaster()",extractParams:()=>({}),generateDisplayText:()=>"undefined"!=typeof i18next&&i18next.t?i18next.t("vfx_alias_combined"):"VFX Alias: Combined Space/Ground"},{regex:/^dynFxSetFXExclusionList\s+(.+)$/i,weight:51,signature:"VFXExclusion(effects: string)",extractParams:e=>({effects:e[1]}),generateDisplayText:e=>`VFX Exclude: ${e.effects}`},{regex:/^dynFxSetFXExclusionList_(.+)$/i,weight:49,signature:"VFXExclusionAlias(aliasName: string)",extractParams:e=>({aliasName:e[1]}),generateDisplayText:e=>{if("undefined"!=typeof i18next&&i18next.t){const t=e.aliasName.toLowerCase();if("space"===t)return i18next.t("vfx_alias_space");if("ground"===t)return i18next.t("vfx_alias_ground")}return`VFX Alias: ${e.aliasName}`}}],category:"vfx",baseCommand:"VFXControl",icon:"âœ¨"},PowerCommands:{patterns:[{regex:/^\+power_exec\s+(.+)$/i,weight:30,signature:"PowerExec(powerName: string)",extractParams:e=>({powerName:e[1]}),generateDisplayText:e=>`Power: ${e.powerName}`}],category:"power",baseCommand:"PowerExec",icon:"ğŸ”‹"},MovementCommands:{patterns:[{regex:/^\+(fullimpulse|reverse|turn_left|turn_right|up|down|left|right|forward|backward)$/i,weight:25,signature:"Movement(direction: string)",extractParams:e=>({direction:e[1]}),generateDisplayText:e=>`Movement: ${e.direction}`}],category:"movement",baseCommand:"Movement",icon:"ğŸš€"},SystemCommands:{patterns:[{regex:/^(screenshot|interactwindow|\+gentoggle.*)$/i,weight:20,signature:"System(command: string)",extractParams:e=>({command:e[1]}),generateDisplayText:e=>`System: ${e.command}`}],category:"system",baseCommand:"System",icon:"âš™ï¸"},CameraCommands:{patterns:[{regex:/^(.*cam.*|.*look.*|.*zoom.*)$/i,weight:15,signature:"Camera(command: string)",extractParams:e=>({command:e[1]}),generateDisplayText:e=>`Camera: ${e.command}`}],category:"camera",baseCommand:"Camera",icon:"ğŸ“¹"}}}parseCommandString(e,t={}){const i=performance.now();if(this.trackCommandFrequency(e),this.hotPathCache.has(e))return this.updateMetrics("hotpath_hit",i),this.hotPathCache.get(e);if(this.options.enableCache&&this.parseCache.has(e))return this.updateMetrics("cache_hit",i),this.parseCache.get(e);const a=e.split(/\s*\$\$\s*/).map(e=>e.trim()).filter(e=>e),n=a.map((e,i)=>this.parseIndividualCommand(e,i,t)),s={originalString:e,commands:n,isMirrored:this.detectMirroring(a),parseTime:performance.now()-i,metadata:{totalCommands:n.length,cacheStatus:"miss",parseMethod:"signature-based"}};return this.options.enableCache&&this.cacheResult(e,s),this.updateMetrics("parse_complete",i),s}parseIndividualCommand(e,t,i={}){const a=Object.entries(this.signatures).sort((e,t)=>{const i=Math.max(...e[1].patterns.map(e=>e.weight));return Math.max(...t[1].patterns.map(e=>e.weight))-i});for(const[n,s]of a)for(const a of s.patterns){const r=e.match(a.regex);if(r){const o=a.extractParams(r),c=!1!==i.generateDisplayText&&a.generateDisplayText?a.generateDisplayText(o):e;return{command:e,signature:a.signature,category:s.category,baseCommand:s.baseCommand,icon:s.icon,parameters:o,displayText:c,matchPattern:a,id:`parsed_${Date.now()}_${t}`,parseMetadata:{signatureName:n,patternWeight:a.weight,matchTime:performance.now()}}}}return{command:e,signature:"UnknownCommand(command: string)",category:"custom",baseCommand:"Custom",icon:"âš™ï¸",parameters:{command:e},displayText:e,id:`unknown_${Date.now()}_${t}`,parseMetadata:{signatureName:"fallback",patternWeight:0,matchTime:performance.now()}}}trackCommandFrequency(e){const t=this.frequencyTracker.get(e)||0;if(this.frequencyTracker.set(e,t+1),t>=this.options.hotPathThreshold&&!this.hotPathCache.has(e)){const t=this.options.hotPathThreshold;this.options.hotPathThreshold=1/0;const i=this.parseCommandString(e);this.hotPathCache.set(e,i),this.options.hotPathThreshold=t}}detectMirroring(e){if(e.length<=1)return!1;if(e.length<3||e.length%2==0)return!1;const t=Math.floor(e.length/2),i=e.slice(0,t+1),a=e.slice(t+1),n=i.slice(0,-1).reverse();return a.length===n.length&&a.every((e,t)=>e.trim()===n[t].trim())}cacheResult(e,t){if(this.parseCache.size>=this.options.maxCacheSize){const e=this.parseCache.keys().next().value;this.parseCache.delete(e)}this.parseCache.set(e,t)}updateMetrics(e,t){if(!this.options.enablePerformanceMetrics)return;const i=performance.now()-t,a=this.performanceMetrics.get(e)||{count:0,totalTime:0,avgTime:0};a.count++,a.totalTime+=i,a.avgTime=a.totalTime/a.count,this.performanceMetrics.set(e,a)}static createStandalone(e={}){return new Bt(null,e)}}const Et={"TrayExecByTray(active: number, tray: number, slot: number)":{commandId:"custom_tray",name:"Execute Tray Slot",category:"tray",icon:"âš¡",description:"Execute a specific tray slot",parameters:{active:{type:"number",min:0,max:1,default:1,label:"Active",help:"Set to 1 to enable, 0 to disable (temporarily disable without removing)"},tray:{type:"number",min:0,max:9,default:0,label:"Tray Number",help:"Tray number (0-9, displays as 1-10 in UI)"},slot:{type:"number",min:0,max:9,default:0,label:"Slot Number",help:"Slot number (0-9, displays as 1-10 in UI)"},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"STOTrayExecByTray",label:"Command Type",help:"STOTrayExecByTray shows binding in UI, TrayExecByTray does not"}}},"TrayExecByTrayWithBackup(active: number, tray: number, slot: number, backup_tray: number, backup_slot: number)":{commandId:"tray_with_backup",name:"Execute Tray with Backup",category:"tray",icon:"âš¡",description:"Execute tray slot with backup fallback",parameters:{active:{type:"number",min:0,max:1,default:1,label:"Active State",help:"Primary tray state (0 or 1)"},tray:{type:"number",min:0,max:9,default:0,label:"Primary Tray",help:"Primary tray number"},slot:{type:"number",min:0,max:9,default:0,label:"Primary Slot",help:"Primary slot number"},backup_tray:{type:"number",min:0,max:9,default:0,label:"Backup Tray",help:"Backup tray number"},backup_slot:{type:"number",min:0,max:9,default:0,label:"Backup Slot",help:"Backup slot number"}}},"Communication(verb: string, message: string)":{commandId:"communication",name:"Communication Command",category:"communication",icon:"ğŸ’¬",description:"Send message to chat channel",parameters:{verb:{type:"select",options:["say","team","zone","tell"],default:"say",label:"Channel",help:"Chat channel to send message to"},message:{type:"text",default:"",placeholder:"Enter your message...",label:"Message",help:"Message text to send"}}},"Target(entityName: string)":{commandId:"target_entity",name:"Target Entity",category:"targeting",icon:"ğŸ¯",description:"Target specific entity by name",parameters:{entityName:{type:"text",default:"",placeholder:"Entity name...",label:"Entity Name",help:"Name of entity to target"}}},"VFXExclusion(effects: string)":{commandId:"vfx_exclusion",name:"VFX Exclusion List",category:"vfx",icon:"âœ¨",description:"Set visual effects exclusion list",parameters:{effects:{type:"text",default:"",placeholder:"Fx_Explosion,Fx_Beam,Fx_Particle...",label:"Effects List",help:"Comma-separated list of effects to exclude"}}},"VFXExclusionAlias(aliasName: string)":{commandId:"vfx_exclusion_alias",name:"VFX Exclusion Alias",category:"vfx",icon:"âœ¨",description:"Use predefined VFX exclusion alias",parameters:{aliasName:{type:"text",default:"",placeholder:"LowVFX, NoParticles, etc...",label:"Alias Name",help:"Name of predefined VFX exclusion alias"}}},"VFXExclusionMaster()":{commandId:"vfx_exclusion_master",name:"VFX Exclusion Master Alias",category:"vfx",icon:"âœ¨",description:"Combined space and ground VFX suppression alias",parameters:{}},"PowerExec(powerName: string)":{commandId:"power_exec",name:"Execute Power",category:"power",icon:"ğŸ”‹",description:"Execute specific power by name",parameters:{powerName:{type:"text",default:"",placeholder:"Power name...",label:"Power Name",help:"Name of power to execute"}}},"StaticCombat()":{commandId:"static_combat",name:"Combat Command",category:"combat",icon:"ğŸ”¥",description:"Static combat command",parameters:{commandName:{type:"hidden",default:"",label:"Command Name"}}},"StaticTargeting()":{commandId:"static_targeting",name:"Targeting Command",category:"targeting",icon:"ğŸ¯",description:"Static targeting command",parameters:{commandName:{type:"hidden",default:"",label:"Command Name"}}}};function At(e){return Et[e]||null}const It=Bt.createStandalone(),Ft=(()=>{const e=function(){const e=new Set;return Object.values(It.signatures).forEach(t=>{"vfx"===(t.category||"").toLowerCase()||(t.baseCommand&&e.add(t.baseCommand.toLowerCase()),Array.isArray(t.patterns)&&t.patterns.forEach(t=>{const i=t.regex?.source?.match(/^\^\(([^)]+)\)/);i&&i[1].split("|").forEach(t=>e.add(t.toLowerCase()))}))}),e}();return Object.values(Et).forEach(t=>{(t.parameters?.command_type?.options||t.parameters?.verb?.options||[]).forEach(t=>e.add(t.toLowerCase()))}),e})(),Pt=/^[A-Za-z][A-Za-z0-9_]*$/;function Mt(e=""){return Pt.test(e)}function Nt(e=""){return!!Mt(e)&&!Ft.has(e.toLowerCase())}var Dt=Object.freeze({__proto__:null,generateBindToAliasName:function(e,t,i=null){const a=(e||"space").toLowerCase().replace(/[^a-z0-9]/g,"");let n=(t||"").toLowerCase();const s={"[":"leftbracket","]":"rightbracket","(":"leftparen",")":"rightparen","{":"leftbrace","}":"rightbrace","<":"less",">":"greater","=":"equals","-":"minus",Ee:"underscore","\\":"backslash","/":"slash","|":"pipe","`":"backtick","~":"tilde","!":"exclamation","@":"at","#":"hash",$:"dollar","%":"percent","^":"caret","&":"ampersand","*":"asterisk","?":"question",":":"colon",";":"semicolon",'"':"quote","'":"apostrophe",",":"comma",".":"period"};for(const[e,t]of Object.entries(s)){const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");n=n.replace(new RegExp(i,"g"),t)}if(n=n.replace(/[^a-z0-9_]/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"),!n)return null;/^[0-9]/.test(n)&&(n=`k${n}`);let r="";i&&"Primary Bindset"!==i&&(r=i.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"));const o=r?`sto_kb_${a}_${r}_${n}`:`sto_kb_${a}_${n}`;return Mt(o)?o:null},isAliasNameAllowed:Nt,isAliasNamePatternValid:Mt});class Lt extends lt{constructor({eventBus:e=c,modalManager:t=null,confirmDialog:i=null,document:a=("undefined"!=typeof window?window.document:void 0),i18n:n}={}){super(e),this.componentName="AliasBrowserUI",this.modalManager=t,this.confirmDialog=i||("undefined"!=typeof window?window.confirmDialog:null),this.document=a,this.i18n=n}async onInit(){this.Ae=null,this.setupEventListeners(),this.eventBus.on("aliases-changed",()=>{this.render()}),this.eventBus.on("alias-selected",e=>{this.Ae=e.name,this.render()}),this.addEventListener("profile:switched",({profileId:e,environment:t}={})=>{this.Ae=null,this.render()}),this.eventBus.on("environment:changed",(e={})=>{const t="string"==typeof e?e:e.environment||e.newMode||e.mode;this.toggleVisibility(t)}),await this.render()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("addAliasChainBtn","click","alias-chain-add",()=>{this.createAliasModal()}),this.onDom("deleteAliasChainBtn","click","alias-chain-delete",()=>{this.Ae&&this.confirmDeleteAlias(this.Ae)}),this.onDom("duplicateAliasChainBtn","click","alias-chain-duplicate",()=>{this.Ae&&this.duplicateAlias(this.Ae)}),this.onDomDebounced("aliasFilter","input","alias-filter",e=>{this.filterAliases(e.target.value)},250),this.onDom("aliasFilter","keydown","alias-filter-key",e=>{if("Escape"===e.key){const t=e.target;t.value="",t.classList.remove("expanded"),this.filterAliases("")}else if("Enter"===e.key){const t=e.target;t.classList.remove("expanded"),t.blur()}}),this.onDom("showAllAliasesBtn","click","alias-show-all",()=>{const e=this.document.getElementById("aliasFilter");e&&(e.value=""),this.filterAliases("")}),this.onDom("aliasSearchBtn","click","alias-search-toggle",()=>{this.toggleAliasSearch()}))}async confirmDeleteAlias(e){if(!e||!this.confirmDialog)return;const t=this.i18n.t("confirm_delete_alias",{aliasName:e}),i=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(t,i,"danger","aliasDelete")){const t=await this.request("alias:delete",{name:e});if(t?.success){const i=this.i18n.t(t?.message||"alias_deleted",{name:e});this.showToast(i,"success")}else{const i=(t?.params||{}).reason||"Unknown error",a=this.i18n.t(t?.error||"failed_to_delete_alias",{name:e,reason:i});this.showToast(a,"error")}}}async duplicateAlias(e){if(!e||!this.modalManager)return;let t=this.cache.aliases;if(!t||0===Object.keys(t).length){const e=await this.request("alias:get-all")||{};t=e.aliases||e||{},this.cache.aliases=t}const i=function(e,t={}){let i=`${e}_copy`,a=i,n=1;for(;t[a];)a=`${i}${n}`,n++;return a}(e,t),a=this.document.getElementById("aliasDuplicateModal");if(!a)return;const n=a.querySelector("#duplicateAliasNameInput"),s=a.querySelector("#confirmDuplicateAliasBtn"),r=a.querySelector("#duplicateAliasValidation"),o=()=>{const e=(n.value||"").trim(),i=t[e];let a=null;e&&Mt(e)?Nt(e)?i&&(a="alias_name_in_use"):a="reserved_command_name":a="invalid_alias_name",r.textContent=a?this.i18n.t(a):"";const o=!!a;r.style.display=o?"":"none",s.disabled=o};n.value=i,r.style.display="none";const c=()=>o();n.removeEventListener("input",c),n.addEventListener("input",c),s.onclick=async()=>{const i=n.value.trim();if(!i||t[i])return;this.modalManager?.hide?.("aliasDuplicateModal");const a=await this.request("alias:duplicate-with-name",{sourceName:e,newName:i});if(a?.success){const n=this.i18n.t(a?.message||"alias_duplicated",{from:e,to:i});this.showToast(n,"success"),this.cache.aliases={...t,[i]:JSON.parse(JSON.stringify(t[e]))},this.render().catch(()=>{})}else{const t=(a?.params||{}).reason||"Unknown error",i=this.i18n.t(a?.error||"failed_to_duplicate_alias",{sourceName:e,reason:t});this.showToast(i,"error")}},this.modalManager.show("aliasDuplicateModal"),o()}async render(){const e=this.document.getElementById("aliasGrid");if(!e)return;const t=await this.request("alias:get-all"),i=t&&t.aliases?t.aliases:t||{};this.cache.aliases=i;const a=Object.entries(i);0!==a.length?(e.classList.remove("categorized"),e.innerHTML=a.map(([e,t])=>this.createAliasElement(e,t)).join(""),"function"==typeof e.querySelectorAll&&e.querySelectorAll(".alias-item").forEach(e=>{this.onDom(e,"click","alias-item-click",async()=>{await this.request("alias:select",{aliasName:e.dataset.alias}),this.emit("alias-browser/alias-clicked",{name:e.dataset.alias})})})):e.innerHTML=`\n        <div class="empty-state">\n          <i class="fas fa-mask"></i>\n          <h4 data-i18n="no_aliases_defined">${this.i18n.t("no_aliases_defined")}</h4>\n          <p data-i18n="create_alias_to_get_started">${this.i18n.t("create_alias_to_get_started")}</p>\n        </div>`}createAliasElement(e,t){let i=0;Array.isArray(t.commands)?i=t.commands.filter(e=>e&&e.trim()).length:"string"==typeof t.commands&&t.commands.trim()&&(i=t.commands.trim().split(/\s*\$\$/).length);const a=(this.Ae||null)===e,n=t.description||"";return`\n      <div class="alias-item ${a?"active":""}" data-alias="${e}" data-length="${e.length<=8?"short":e.length<=12?"medium":e.length<=16?"long":"extra-long"}" title="${n}">\n        <div class="alias-name">${e}</div>\n        <div class="alias-command-count">${i} <span data-i18n="${1===i?"command_singular":"commands"}">${this.i18n.t(1===i?"command_singular":"commands")}</span></div>\n      </div>`}toggleVisibility(e){const t=this.document.getElementById("aliasSelectorContainer")||this.document.getElementById("aliasGrid")?.parentElement?.parentElement;if(!t)return;const i="alias"===e;t.style.display=i?"":"none"}handleInitialState(e,t){if(t&&(t.environment||t.currentEnvironment)){const i=t.environment||t.currentEnvironment;console.log("[AliasBrowserUI] handleInitialState from",e,"environment:",i),this.toggleVisibility(i)}}async createAliasModal(){if(!this.modalManager)return;const e=await this.request("alias:get-all"),t=this.document.getElementById("aliasCreationModal");if(!t)return;const i=t.querySelector("#newAliasNameInput"),a=t.querySelector("#confirmCreateAliasBtn"),n=t.querySelector("#createAliasValidation"),s=()=>{const t=(i.value||"").trim();let s=null;t&&Mt(t)?Nt(t)?e[t]&&(s="alias_name_in_use"):s="reserved_command_name":s="invalid_alias_name",n.textContent=s?this.i18n.t(s):"";const r=!!s;n.style.display=r?"":"none",a.disabled=r};i.value="",n.style.display="none",i.removeEventListener("input",s),i.addEventListener("input",s),a.onclick=null,a.onclick=async()=>{const e=i.value.trim();if(!e)return;if(this.modalManager.hide("aliasCreationModal"),!await this.request("alias:validate-name",{name:e}))return void this.showToast("Invalid alias name","error");const t=await this.request("alias-browser:create",{name:e,description:""});if(t?.success){const i=this.i18n.t(t?.message||"alias_created",{name:e});this.showToast(i,"success")}else if(t?.error){const e=this.i18n.t(t.error,t.params);this.showToast(e,"error")}else this.showToast("Failed to create alias","error")},this.modalManager.show("aliasCreationModal"),s()}filterAliases(e=""){const t=(e||"").toString().toLowerCase(),i=this.document.getElementById("aliasGrid");if(!i)return;i.querySelectorAll(".alias-item").forEach(e=>{const i=(e.dataset.alias||"").toLowerCase(),a=!t||i.includes(t);e.style.display=a?"flex":"none"});const a=this.document.getElementById("aliasSearchBtn");if(a){const e=!!t;a.classList.toggle("active",e),a.setAttribute("aria-pressed",e)}}toggleAliasSearch(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("aliasFilter");t&&(t.classList.toggle("expanded")?t.focus():t.blur())}}class Kt extends lt{constructor({eventBus:e,confirmDialog:t=null,document:i=("undefined"!=typeof window?window.document:void 0),i18n:a}={}){super(e),this.componentName="HeaderMenuUI",this.document=i,this.confirmDialog=t||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=a}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("settingsBtn","click","settings-toggle",()=>{this.toggleSettingsMenu()}),this.onDom("importMenuBtn","click","import-toggle",()=>{this.toggleImportMenu()}),this.onDom("backupMenuBtn","click","backup-toggle",()=>{this.toggleBackupMenu()}),this.onDom("languageMenuBtn","click","language-toggle",()=>{this.toggleLanguageMenu()}),this.onDom("vertigoBtn","click","vfx-open",()=>{this.emit("vfx:show-modal")}),this.onDom("fileExplorerBtn","click","file-explorer-open",()=>{this.emit("file-explorer:open")}),this.onDom("syncNowBtn","click","sync-now",()=>{this.emit("sync:sync-now")}),this.onDom("preferencesBtn","click","preferences-open",()=>{this.emit("preferences:show")}),this.onDom("aboutBtn","click","about-open",()=>{this.emit("about:show")}),this.onDom(this.document,"click","document-click-outside",e=>{e.target.closest(".dropdown")||this.document.querySelectorAll(".dropdown.active").forEach(e=>{e.classList.remove("active")})}),this.onDom("openProjectBtn","click","project-open",()=>{this.emit("project:open")}),this.onDom("saveProjectBtn","click","project-save",()=>{this.emit("project:save")}),this.onDom("exportKeybindsBtn","click","keybinds-export",()=>{this.emit("keybinds:export")}),this.onDom("importKeybindsBtn","click","keybinds-import",()=>{this.emit("keybinds:import")}),this.onDom("importAliasesBtn","click","aliases-import",()=>{this.emit("aliases:import")}),this.onDom("importKbfBtn","click","kbf-import",()=>{this.emit("keybinds:kbf-import")}),this.onDom("loadDefaultDataBtn","click","data-load-default",()=>{this.emit("data:load-default")}),this.onDom("resetAppBtn","click","app-reset",()=>{this.confirmResetApp()}),this.onDom("[data-lang]","click","language-change",e=>{const t=e.target.closest("[data-lang]"),i=t?t.getAttribute("data-lang"):null;i&&this.emit("language:change",{language:i})}),this.addEventListener("language:changed",({language:e})=>{this.showToast(this.i18n.t("language_updated"),"success")}),this.onDom("themeToggleBtn","click","theme-toggle",()=>{this.emit("theme:toggle")}))}toggleSettingsMenu(){this.toggleDropdown("settingsBtn")}toggleImportMenu(){this.toggleDropdown("importMenuBtn")}toggleBackupMenu(){this.toggleDropdown("backupMenuBtn")}toggleLanguageMenu(){this.toggleDropdown("languageMenuBtn")}toggleDropdown(e){const t=this.document.getElementById(e);if(!t)return;const i=t.closest(".dropdown");i&&(this.document.querySelectorAll(".dropdown.active").forEach(e=>{e!==i&&e.classList.remove("active")}),i.classList.toggle("active"))}async confirmResetApp(){if(!this.confirmDialog)return;const e=this.i18n.t("confirm_reset_application"),t=this.i18n.t("confirm_reset_app");await this.confirmDialog.confirm(e,t,"danger","resetApplication")&&this.emit("app:reset-confirmed")}onDestroy(){}}class jt extends lt{constructor({eventBus:e,document:t=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="AboutModalUI",this.document=t}onInit(){this.setupEventListeners(),this.populateAboutContent()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.eventBus.on("about:show",()=>{this.showAboutModal()}),this.eventBus.on("modal:regenerated",({modalId:e})=>{"aboutModal"===e&&this.populateAboutContent()}))}showAboutModal(){this.populateAboutContent(),this.emit("modal:show",{modalId:"aboutModal"})}populateAboutContent(){const t=this.document.getElementById("aboutVersion");t&&(t.textContent=` ${e}`)}}class zt extends lt{constructor({eventBus:e,document:t=("undefined"!=typeof window?window.document:void 0),i18n:i,modalManager:a=null}={}){super(e),this.componentName="ImportUI",this.document=t,this.i18n=i,this.modalManager=a,this.currentImportModal=null,this.currentBindsetSelectionModal=null,this.currentProgressModal=null}onInit(){this.addEventListener("keybinds:import",()=>this.openFileDialog("keybinds")),this.addEventListener("aliases:import",()=>this.openFileDialog("aliases")),this.addEventListener("keybinds:kbf-import",()=>this.openFileDialog("kbf"))}async openFileDialog(e){const t=this.document.createElement("input");t.type="file",t.accept="kbf"===e?".kbf,.txt":".txt",t.style.display="none",this.document.body.appendChild(t),t.addEventListener("change",async i=>{if(!i.target.files||0===i.target.files.length)return;const a=i.target.files[0],n=new FileReader;n.onload=async i=>{try{const a=i.target.result,n=await this.request("data:get-current-state"),s=n.currentProfile;let r;if("keybinds"===e){const e=await this.promptEnvironment(n.currentEnvironment||"space");if(!e)return;r=await this.request("import:keybind-file",{content:a,profileId:s,environment:e})}else if("kbf"===e){const e=await this.promptEnvironment(n.currentEnvironment||"space");if(!e)return;if(!(await this.request("import:validate-kbf-file",{content:a})).valid){const e=this.i18n.t("invalid_kbf_file_format");return this.showToast(e,"error"),void this.document.body.removeChild(t)}if(this.showProgressModal(),r=await this.request("import:kbf-file",{content:a,profileId:s,environment:e,onProgress:(e,t,i)=>{this.currentProgressModal&&this.currentProgressModal.updateProgress&&this.currentProgressModal.updateProgress(e,t,i)}}),this.hideProgressModal(!0),r?.success&&r?.singleBindsetFile?.requiresBindsetSelection){const i=await this.promptBindsetSelection(r.bindsetNames,r.masterBindset.hasMasterBindset,r.masterBindset.displayName);if(!i||0===i.length)return void this.document.body.removeChild(t);this.showProgressModal(),r=await this.request("import:kbf-file",{content:a,profileId:s,environment:e,selectedBindsets:i,onProgress:(e,t,i)=>{this.currentProgressModal&&this.currentProgressModal.updateProgress&&this.currentProgressModal.updateProgress(e,t,i)}}),this.hideProgressModal(!0)}}else r=await this.request("import:alias-file",{content:a,profileId:s});if(r?.success){let t;t="kbf"===e?this.i18n.t(r?.message,{bindsets:r.imported?.bindsets||0,keys:r.imported?.keys||0,aliases:r.imported?.aliases||0}):this.i18n.t(r?.message,{count:r.imported?.keys||r.imported?.aliases||0}),this.showToast(t,"success")}else{const e=this.i18n.t(r?.error,r?.params);this.showToast(e,"error")}}catch(e){console.error("[ImportUI] Failed to import file:",e)}this.document.body.removeChild(t)},n.readAsText(a)}),t.click()}showProgressModal(){return new Promise(e=>{const t=this.createProgressModal(),i="importProgressModal";t.id=i,this.document.body.appendChild(t),this.currentProgressModal={resolve:e,modalElement:t},this.modalManager?.registerRegenerateCallback(i,()=>{this.regenerateProgressModal()});const a=()=>{this.modalManager?.unregisterRegenerateCallback(i),this.currentProgressModal=null,this.modalManager?.hide(i),t&&t.parentNode&&t.parentNode.removeChild(t),e(!1)};this.onDom(".progress-cancel-btn","click","progress-cancel",()=>a()),requestAnimationFrame(()=>{this.modalManager?.show(i)}),this.currentProgressModal.updateProgress=(e,i,a=null)=>{const n=t.querySelector(".progress-stage"),s=t.querySelector(".progress-details"),r=t.querySelector(".progress-percentage"),o=t.querySelector(".progress-bar-fill");n&&(n.textContent=this.i18n.t("kbf_progress_layer",{layer:e.toString()})),s&&(s.textContent=i),null!==a&&r&&o?(r.textContent=`${Math.round(a)}%`,o.style.width=`${a}%`,o.classList.remove("indeterminate")):o&&(o.classList.add("indeterminate"),r&&(r.textContent=""))}})}hideProgressModal(e=!0){if(!this.currentProgressModal)return;const{resolve:t,modalElement:i}=this.currentProgressModal,a="importProgressModal";this.modalManager?.unregisterRegenerateCallback(a),this.currentProgressModal=null,this.modalManager?.hide(a),i&&i.parentNode&&i.parentNode.removeChild(i),t(e)}createProgressModal(){const e=this.document.createElement("div");e.className="modal progress-modal";const t=this.i18n.t("kbf_import_progress"),i=this.i18n.t("kbf_import_progress_message"),a=this.i18n.t("cancel");return e.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-spinner fa-spin"></i>\n            ${t}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${i}</p>\n          <div class="progress-container">\n            <div class="progress-label">\n              <span class="progress-stage">${this.i18n.t("kbf_progress_initializing")}</span>\n              <span class="progress-percentage"></span>\n            </div>\n            <div class="progress-bar">\n              <div class="progress-bar-fill indeterminate"></div>\n            </div>\n            <div class="progress-details">${this.i18n.t("kbf_progress_preparing")}</div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-secondary progress-cancel-btn">${a}</button>\n        </div>\n      </div>\n    `,e}regenerateProgressModal(){if(!this.currentProgressModal)return;const{modalElement:e,updateProgress:t}=this.currentProgressModal,i=this.createProgressModal();i.id="importProgressModal",e.replaceWith(i),this.currentProgressModal.modalElement=i;const a=()=>{const{resolve:e}=this.currentProgressModal;this.modalManager?.unregisterRegenerateCallback("importProgressModal"),this.currentProgressModal=null,this.modalManager?.hide("importProgressModal"),i&&i.parentNode&&i.parentNode.removeChild(i),e(!1)};this.onDom(".progress-cancel-btn","click","progress-regen-cancel",()=>a()),this.currentProgressModal.updateProgress=t}promptEnvironment(e="space"){return new Promise(t=>{const i=this.createImportModal(e),a="importModal";i.id=a,this.document.body.appendChild(i),this.currentImportModal={defaultEnv:e,resolve:t,modalElement:i},this.modalManager?.registerRegenerateCallback(a,()=>{this.regenerateImportModal()});const n=e=>{this.modalManager?.unregisterRegenerateCallback(a),this.currentImportModal=null,this.modalManager?.hide(a),i&&i.parentNode&&i.parentNode.removeChild(i),t(e)};this.onDom(".import-space","click","import-dialog-space",()=>n("space")),this.onDom(".import-ground","click","import-dialog-ground",()=>n("ground")),this.onDom(".import-cancel","click","import-dialog-cancel",()=>n(null)),requestAnimationFrame(()=>{this.modalManager?.show(a)})})}createImportModal(e){const t=this.document.createElement("div");t.className="modal import-modal";const i=this.i18n.t("import_environment"),a=this.i18n.t("import_environment_question"),n=this.i18n.t("space"),s=this.i18n.t("ground"),r=this.i18n.t("cancel");return t.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-file-import"></i>\n            ${i}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${a}</p>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary import-space ${"space"===e?"btn-primary":"btn-secondary"}">${n}</button>\n          <button class="btn btn-primary import-ground ${"ground"===e?"btn-primary":"btn-secondary"}">${s}</button>\n          <button class="btn btn-secondary import-cancel">${r}</button>\n        </div>\n      </div>\n    `,t}regenerateImportModal(){if(!this.currentImportModal)return;const{defaultEnv:e,modalElement:t}=this.currentImportModal,i=this.createImportModal(e);i.id="importModal",t.replaceWith(i),this.currentImportModal.modalElement=i;const a=e=>{const{resolve:t}=this.currentImportModal;this.modalManager?.unregisterRegenerateCallback("importModal"),this.currentImportModal=null,this.modalManager?.hide("importModal"),i&&i.parentNode&&i.parentNode.removeChild(i),t(e)};this.onDom(".import-space","click","import-dialog-regen-space",()=>a("space")),this.onDom(".import-ground","click","import-dialog-regen-ground",()=>a("ground")),this.onDom(".import-cancel","click","import-dialog-regen-cancel",()=>a(null))}promptBindsetSelection(e,t,i){return new Promise(a=>{const n=this.createBindsetSelectionModal(e,t,i),s="bindsetSelectionModal";n.id=s,this.document.body.appendChild(n),this.currentBindsetSelectionModal={bindsetNames:e,hasMasterBindset:t,masterDisplayName:i,resolve:a,modalElement:n},this.modalManager?.registerRegenerateCallback(s,()=>{this.regenerateBindsetSelectionModal()});const r=e=>{this.modalManager?.unregisterRegenerateCallback(s),this.currentBindsetSelectionModal=null,this.modalManager?.hide(s),n&&n.parentNode&&n.parentNode.removeChild(n),a(e)};this.onDom(".bindset-confirm","click","bindset-selection-confirm",()=>{const e=[];n.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{e.push(t.value)}),r(e)}),this.onDom(".bindset-cancel","click","bindset-selection-cancel",()=>r(null)),requestAnimationFrame(()=>{this.modalManager?.show(s)})})}createBindsetSelectionModal(e,t,i){const a=this.document.createElement("div");a.className="modal import-modal";const n=this.i18n.t("select_bindsets_to_import"),s=this.i18n.t("select_bindsets_to_import_question"),r=this.i18n.t("import_selected"),o=this.i18n.t("cancel");let c="";return e.forEach(e=>{const t="master"===e.toLowerCase()&&i||e,a="master"===e.toLowerCase()?"checked":"";c+=`\n        <div class="bindset-option">\n          <input type="checkbox" id="bindset_${e}" name="bindsets" value="${e}" ${a}>\n          <label for="bindset_${e}">${t}</label>\n        </div>\n      `}),a.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-layer-group"></i>\n            ${n}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${s}</p>\n          <div class="bindset-list">\n            ${c}\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary bindset-confirm">${r}</button>\n          <button class="btn btn-secondary bindset-cancel">${o}</button>\n        </div>\n      </div>\n    `,a}regenerateBindsetSelectionModal(){if(!this.currentBindsetSelectionModal)return;const{bindsetNames:e,hasMasterBindset:t,masterDisplayName:i,modalElement:a}=this.currentBindsetSelectionModal,n=this.createBindsetSelectionModal(e,t,i);n.id="bindsetSelectionModal",a.replaceWith(n),this.currentBindsetSelectionModal.modalElement=n;const s=e=>{const{resolve:t}=this.currentBindsetSelectionModal;this.modalManager?.unregisterRegenerateCallback("bindsetSelectionModal"),this.currentBindsetSelectionModal=null,this.modalManager?.hide("bindsetSelectionModal"),n&&n.parentNode&&n.parentNode.removeChild(n),t(e)};this.onDom(".bindset-confirm","click","bindset-selection-regen-confirm",()=>{const e=[];n.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{e.push(t.value)}),s(e)}),this.onDom(".bindset-cancel","click","bindset-selection-regen-cancel",()=>s(null))}}class Ot extends oe{constructor({ui:e,eventBus:t}={}){super(t),this.componentName="AliasBrowserService",this.ui=e,this.eventBus&&(this.respond("alias:get-all",()=>this.getAliases()),this.respond("alias-browser:create",({name:e,description:t=""}={})=>this.createAlias(e,t)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{"undefined"!=typeof window&&console.log(`[AliasBrowserService] profile:updated received. profileId: ${e}, cache.currentProfile: ${this.cache.currentProfile}, match: ${e===this.cache.currentProfile}`),e===this.cache.currentProfile&&(this.updateCacheFromProfile(t),this.emit("aliases-changed",{aliases:this.cache.aliases}))}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{this.cache.currentProfile=e,i&&(this.cache.currentEnvironment=i),this.updateCacheFromProfile(t),this.emit("aliases-changed",{aliases:this.cache.aliases})}),this.addEventListener("environment:changed",async e=>{const t="string"==typeof e?e:e?.environment;"undefined"!=typeof window&&console.log("[AliasBrowserService] environment:changed received. payload:",e,`parsed env: ${t}`),t&&(this.cache.currentEnvironment=t)})}updateCacheFromProfile(e){e&&(this.cache.profile=e,this.cache.aliases=e.aliases||{})}getAliases(){return Object.fromEntries(Object.entries(this.cache.aliases||{}).filter(([e,t])=>"vfx-alias"!==t.type))}async selectAlias(e){return await this.request("selection:select-alias",{aliasName:e})}async createAlias(e,t=""){const i=await this.request("alias:add",{name:e,description:t});return i&&await this.selectAlias(e),i}}class Rt extends oe{constructor({i18n:e,eventBus:t=null}={}){super(t),this.componentName="CommandChainService",this.i18n=e,this.commands=[],this.Ie=!1,this.Fe=!1,this.ae=[],this.eventBus&&this.ae.push(this.respond("command:set-stabilize",({name:e,stabilize:t,bindset:i})=>this.setStabilize(e,t,i)),this.respond("command:is-stabilized",({name:e,bindset:t})=>this.isStabilized(e,t)),this.respond("command-chain:clear",async({key:e,bindset:t})=>{try{return await this.clearCommandChain(e,t)}catch(e){throw e}}),this.respond("command-chain:is-stabilized",({name:e,bindset:t})=>this.isStabilized(e,t)),this.respond("command-chain:generate-alias-name",({environment:e,keyName:t,bindsetName:i})=>this.generateBindToAliasName(e,t,i)),this.respond("command-chain:generate-alias-preview",({aliasName:e,commands:t})=>this.generateAliasPreview(e,t)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("profile:updated",e=>{if(e?.profile&&e?.profileId){const t={...e.profile,id:e.profileId};this.updateCacheFromProfile(t)}}),this.addEventListener("profile:switched",e=>{e.profile&&this.updateCacheFromProfile(e.profile)}),this.addEventListener("environment:changed",e=>{("string"==typeof e?e:e?.environment)&&("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey)&&this.refreshCommands()}),console.log("[CommandChainService] Setting up bindset-selector:active-changed listener"),this.addEventListener("bindset-selector:active-changed",({bindset:e,name:t})=>{const i=e||t;console.log(`[CommandChainService] *** bindset-selector:active-changed received: ${this.cache.activeBindset} -> ${i} ***`),i&&(this.Ie=!0,console.log(`[CommandChainService] Calling refreshCommands() for bindset: ${i}`),this.refreshCommands(),setTimeout(()=>{this.Ie=!1,console.log(`[CommandChainService] Bindset switch completed for: ${i}`)},100))}),this.addEventListener("bindset-operation:started",({type:e,bindset:t,key:i})=>{console.log(`[CommandChainService] Bindset operation started: ${e} key=${i} bindset=${t}`),this.Fe=!0}),this.addEventListener("bindset-operation:completed",({type:e,bindset:t,key:i})=>{console.log(`[CommandChainService] Bindset operation completed: ${e} key=${i} bindset=${t}`),this.Fe=!1}),this.addEventListener("bindset-selector:key-added",async({key:e,bindset:t})=>{if(console.log(`[CommandChainService] bindset-selector:key-added received: key=${e}, bindset=${t}, selectedKey=${this.cache.selectedKey}`),e===this.cache.selectedKey){console.log(`[CommandChainService] Key added to bindset ${t} - refreshing command chain to show empty state`),console.log(`[CommandChainService] About to refresh commands - activeBindset: ${this.cache.activeBindset}, expected: ${t}`);const e=await this.getCommandsForSelectedKey();console.log(`[CommandChainService] Refreshed commands for new bindset ${t}: ${e.length} commands`),this.emit("chain-data-changed",{commands:e})}}),this.addEventListener("key-selected",async({key:e,name:t})=>{var i;if(i={key:e,name:t},"undefined"!=typeof window&&console.log("[CommandChainService] key-selected:",i),"alias"===this.cache.currentEnvironment)return;(e||t)&&"Primary Bindset"!==this.cache.activeBindset&&(console.log(`[CommandChainService] Resetting activeBindset from ${this.cache.activeBindset} to Primary Bindset for key selection`),this.emit("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"}));const a=await this.getCommandsForSelectedKey();console.log("[CommandChainService] [key-selected] emitting chain-data-changed with",a.length,"commands"),this.emit("chain-data-changed",{commands:a})}),this.addEventListener("alias-selected",async({name:e})=>{if(!e)return;const t=await this.getCommandsForSelectedKey();console.log("[CommandChainService] [alias-selected] emitting chain-data-changed with",t.length,"commands"),this.emit("chain-data-changed",{commands:t})}),this.addEventListener("command-added",async({command:e,key:t})=>{console.log("[CommandChainService] command-added received:",{command:e,key:t});const i=await this.getCommandsForSelectedKey();console.log("[CommandChainService] emitting chain-data-changed with",i.length,"commands"),this.emit("chain-data-changed",{commands:i})});const e=async(e,t)=>{console.log(`[CommandChainService] ${e} received:`,t);let i=Array.isArray(t?.commands)?t.commands:null;i||(i=await this.getCommandsForSelectedKey()),this.emit("chain-data-changed",{commands:i})};this.addEventListener("command-edited",async t=>{await e("command-edited",t)}),this.addEventListener("command-deleted",async t=>{await e("command-deleted",t)}),this.addEventListener("command-moved",async t=>{await e("command-moved",t)}),this.addEventListener("commandchain:edit",async({index:e})=>{if(void 0===e)return;const t=(await this.getCommandsForSelectedKey())[e];if(!t)return;let i;if(i="string"==typeof t?{command:t}:t.parameters?{...t,parameters:{...t.parameters}}:{...t},!i.parameters)try{const e=await this.request("parser:parse-command-string",{commandString:i.command,options:{generateDisplayText:!1}});e.commands&&e.commands[0]?.parameters&&(i.parameters=e.commands[0].parameters)}catch(e){console.warn("[CommandChainService] Failed to derive parameters from command:",e)}const a=await this.findCommandDefinition(i),n=!(!a||!a.customizable),s="custom"===i.type||"custom"===i.category||i.command&&await this.isCustomCommand(i.command);if(n)this.emit("parameter-command:edit",{index:e,command:i,commandDef:a,categoryId:a.categoryId||i.type,commandId:a.commandId});else{if(s){const t={name:"Edit Custom Command",customizable:!0,categoryId:"custom",commandId:"add_custom_command",parameters:{rawCommand:{type:"text",default:i.command||"",placeholder:"Enter any STO command",label:"Command:"}}};return void this.emit("parameter-command:edit",{index:e,command:i,commandDef:t,categoryId:"custom",commandId:"add_custom_command"})}"undefined"!=typeof stoUI&&stoUI.showToast&&stoUI.showToast(i.command||t,"info")}}),this.addEventListener("commandchain:delete",async({index:e})=>{const t="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(void 0===e||!t)return;const i="alias"===this.cache.currentEnvironment||"Primary Bindset"===this.cache.activeBindset?null:this.cache.activeBindset;try{await this.request("command:delete",{key:t,index:e,bindset:i}),this.emit("chain-data-changed",{commands:await this.getCommandsForSelectedKey()})}catch(e){console.error("Failed to delete command:",e)}}),this.addEventListener("commandchain:move",async({fromIndex:e,toIndex:t})=>{const i="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(!i)return;const a="alias"===this.cache.currentEnvironment||"Primary Bindset"===this.cache.activeBindset?null:this.cache.activeBindset;try{await this.request("command:move",{key:i,fromIndex:e,toIndex:t,bindset:a}),this.emit("chain-data-changed",{commands:await this.getCommandsForSelectedKey()})}catch(e){console.error("Failed to move command:",e)}}),this.addEventListener("command-chain:clear",async({key:e})=>{e&&(console.log(`[CommandChainService] Clearing command chain for key="${e}", activeBindset="${this.cache.activeBindset}", env="${this.cache.currentEnvironment}"`),await this.clearCommandChain(e,"Primary Bindset"!==this.cache.activeBindset?this.cache.activeBindset:null))}),this.addEventListener("preferences:changed",({key:e,value:t})=>{"bindToAliasMode"===e&&console.log(`[CommandChainService] Preference changed: bindToAliasMode = ${t}`)})}async getCommandsForSelectedKey(){try{const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(console.log(`[CommandChainService] getCommandsForSelectedKey called - activeBindset: ${this.cache.activeBindset}, selectedKey: ${this.cache.selectedKey}, selectedAlias: ${this.cache.selectedAlias}, resolvedKey: ${e}, environment: ${this.cache.currentEnvironment}`),"alias"===this.cache.currentEnvironment)return await this.request("command:get-for-selected-key");const t=this.cache.activeBindset||"Primary Bindset";if(console.log(`[CommandChainService] Using activeBindset: ${t}`),"Primary Bindset"!==t){console.log(`[CommandChainService] Requesting commands from bindset: ${t}`);const e=Date.now(),i=new Promise((e,t)=>{setTimeout(()=>t(new Error("Request timeout after 5 seconds")),5e3)});try{const a="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey,n=this.request("bindset:get-key-commands",{bindset:t,environment:this.cache.currentEnvironment,key:a}),s=await Promise.race([n,i]),r=Date.now()-e;return console.log(`[CommandChainService] Received ${s?.length||0} commands from bindset in ${r}ms:`,s),Array.isArray(s)?s:[]}catch(i){const a=Date.now()-e;return console.error(`[CommandChainService] bindset:get-key-commands failed after ${a}ms:`,i),console.error("[CommandChainService] This suggests BindsetService is not responding. Check if BindsetService is initialized."),console.warn(`[CommandChainService] Falling back to empty commands array for bindset: ${t}`),[]}}console.log("[CommandChainService] Requesting commands from Primary Bindset");const i=await this.request("command:get-for-selected-key",{key:e,environment:this.cache.currentEnvironment,bindset:"Primary Bindset"});return console.log(`[CommandChainService] Received ${i?.length||0} commands from Primary:`,i),i}catch(e){return console.error("Failed to get commands for selected key:",e),Array.isArray(this.commands)?this.commands:[]}}async getEmptyStateInfo(){try{return await this.request("command:get-empty-state-info")}catch(e){return console.error("Failed to get empty state info:",e),{title:"",preview:"",commandCount:0,icon:"",emptyTitle:"",emptyDesc:""}}}async findCommandDefinition(e){try{return console.log("[CommandChainService] findCommandDefinition command:find-definition",{command:e}),await this.request("command:find-definition",{command:e})}catch(e){return console.error("Failed to find command definition:",e),null}}async getCommandWarning(e){try{return await this.request("command:get-warning",{command:e})}catch(e){return console.error("Failed to get command warning:",e),null}}async isCustomCommand(e){try{const t=await this.request("parser:parse-command-string",{commandString:e,options:{generateDisplayText:!1}});return!t.commands||!t.commands[0]||"custom"===t.commands[0].category}catch(e){return!0}}async clearCommandChain(e,t=null){try{if(!e)return console.warn("CommandChainService: Cannot clear chain - no key specified"),!1;const i=this.getCurrentProfile();if(!i)return console.warn("CommandChainService: Cannot clear chain - no active profile"),!1;const a=this.cache.currentEnvironment||"space",n=t&&"Primary Bindset"!==t&&"alias"!==a;if("alias"===a)i.aliases&&i.aliases[e]&&(i.aliases[e].commands=[]);else if(n)i.bindsets?.[t]||(i.bindsets={...i.bindsets||{},[t]:{space:{keys:{}},ground:{keys:{}}}}),i.bindsets[t][a]||(i.bindsets[t][a]={keys:{}}),i.bindsets[t][a].keys[e]=[];else{const t=i.builds?.[a]?.keys?.[e];t&&(i.builds[a].keys[e]=[])}const s=this.cache.currentProfile||this.currentProfile;if(!s)return console.error("CommandChainService: Cannot clear command chain - no current profile ID available"),!1;let r;r="alias"===a?{modify:{aliases:{[e]:i.aliases[e]}}}:n?{modify:{bindsets:{[t]:{[a]:{keys:{[e]:[]}}}}}}:{modify:{builds:{[a]:{keys:{[e]:[]}}}}};const o=await this.request("data:update-profile",{profileId:s,...r});return o?.success?(this.emit("command-chain-cleared",{key:e}),this.emit("chain-data-changed",{commands:[]}),!0):(console.error("CommandChainService: Failed to save profile via DataCoordinator"),!1)}catch(e){return console.error("CommandChainService: Failed to clear command chain:",e),!1}}updateCacheFromProfile(e){e?(console.log("[CommandChainService] updateCacheFromProfile called with profile:",{profileId:e.id,environment:this.cache.currentEnvironment,stackTrace:(new Error).stack}),console.log("[CommandChainService] Cache updated:",{currentProfile:this.cache.currentProfile,keysCount:Object.keys(this.cache.keys||{}).length,aliasesCount:Object.keys(this.cache.aliases||{}).length})):console.log("[CommandChainService] updateCacheFromProfile called with null/undefined profile")}getCurrentProfile(){return this.cache.profile?this.getCurrentBuild(this.cache.profile):null}getCurrentBuild(e){return e?(e.builds||(e.builds={space:{keys:{}},ground:{keys:{}}}),e.builds[this.cache.currentEnvironment]||(e.builds[this.cache.currentEnvironment]={keys:{}}),e.builds[this.cache.currentEnvironment].keys||(e.builds[this.cache.currentEnvironment].keys={}),{...e,keys:e.builds[this.cache.currentEnvironment].keys,aliases:e.aliases||{}}):null}async refreshCommands(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(e){const t=await this.request("command:get-for-selected-key",{key:e});this.emit("chain-data-changed",{commands:t})}}getCurrentState(){return{commands:this.commands}}onDestroy(){this.ae&&(this.ae.forEach(e=>e()),this.ae=[])}isStabilized(e,t=null){if(!e)return!1;const i=this.cache.profile||null;return!!(i&&(i.aliasMetadata&&i.aliasMetadata[e]&&!0===i.aliasMetadata[e].stabilizeExecutionOrder||"alias"!==this.cache.currentEnvironment&&(t&&"Primary Bindset"!==t?i.bindsetMetadata&&i.bindsetMetadata[t]&&i.bindsetMetadata[t][this.cache.currentEnvironment]&&i.bindsetMetadata[t][this.cache.currentEnvironment][e]&&!0===i.bindsetMetadata[t][this.cache.currentEnvironment][e].stabilizeExecutionOrder:i.keybindMetadata&&i.keybindMetadata[this.cache.currentEnvironment]&&i.keybindMetadata[this.cache.currentEnvironment][e]&&!0===i.keybindMetadata[this.cache.currentEnvironment][e].stabilizeExecutionOrder)))}async setStabilize(e,t=!0,i=null){try{if(!e)return{success:!1};const a=this.cache.profile;if(!a)return{success:!1};const n="alias"===this.cache.currentEnvironment||!(!a.aliases||!a.aliases[e]);let s;if(n){const i={},n=a.aliasMetadata&&a.aliasMetadata[e]||{};i[e]={...n},i[e].stabilizeExecutionOrder=!!t,s={aliasMetadata:i}}else if(i&&"Primary Bindset"!==i){const n={};n[i]={},n[i][this.cache.currentEnvironment]={};const r={...a.bindsetMetadata&&a.bindsetMetadata[i]&&a.bindsetMetadata[i][this.cache.currentEnvironment]&&a.bindsetMetadata[i][this.cache.currentEnvironment][e]||{}};r.stabilizeExecutionOrder=!!t,n[i][this.cache.currentEnvironment][e]=r,s={bindsetMetadata:n}}else{const i={};i[this.cache.currentEnvironment]||(i[this.cache.currentEnvironment]={});const n=a.keybindMetadata&&a.keybindMetadata[this.cache.currentEnvironment]&&a.keybindMetadata[this.cache.currentEnvironment][e]||{};i[this.cache.currentEnvironment][e]={...n},i[this.cache.currentEnvironment][e].stabilizeExecutionOrder=!!t,s={keybindMetadata:i}}const r=this.cache.currentProfile||this.currentProfile;if(!r)return{success:!1};const o=await this.request("data:update-profile",{profileId:r,modify:s});return o?.success?(o.profile&&this.updateCacheFromProfile({...o.profile,id:r}),this.emit("stabilize-changed",{name:e,stabilize:t,isAlias:n,bindset:i}),this.emit("profile:updated",{profileId:r,profile:o.profile}),{success:!0}):{success:!1}}catch(e){return console.error("[CommandChainService] setStabilize failed",e),{success:!1,error:e.message}}}async generateBindToAliasName(e,t,i=null){try{const{generateBindToAliasName:a}=await Promise.resolve().then(function(){return Dt});return a(e,t,i)}catch(e){return console.error("[CommandChainService] Failed to generate alias name:",e),null}}generateAliasPreview(e,t){if(!e)return"";try{if(!Array.isArray(t))return`alias ${e} <&  &>`;const i=t.map(e=>null==e?"":"string"==typeof e?e:e.command||"").filter(Boolean);return 0===i.length?`alias ${e} <&  &>`:`alias ${e} <& ${i.join(" $$ ")} &>`}catch(t){return console.error("[CommandChainService] Failed to generate alias preview:",t),`alias ${e} <&  &>`}}handleInitialState(e,t){super.handleInitialState(e,t),"PreferencesService"===e&&this.cache.preferences&&console.log(`[CommandChainService] Preferences received via ComponentBase: bindToAliasMode = ${this.cache.preferences.bindToAliasMode}`)}}class Ut extends lt{constructor({eventBus:e,ui:t=null,document:i=("undefined"!=typeof window?window.document:void 0),i18n:a}){super(e),this.componentName="CommandChainUI",this.ui=t||("undefined"!=typeof stoUI?stoUI:null),this.document=i,this.i18n=a}async onInit(){this.setupEventListeners(),this.render()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.addEventListener("chain-data-changed",({commands:e})=>{console.log("[CommandChainUI] chain-data-changed received with",e.length,"commands"),this.render(e)}),this.addEventListener("environment:changed",e=>{("string"==typeof e?e:e?.environment)&&(this.updateChainActions(),this.updatePreviewLabel(),this.setupBindsetDropdown().catch(()=>{}),this.render().catch(()=>{}))}),this.addEventListener("key-selected",async e=>{const t=void 0!==e.key?e.key:e.name;this.updateChainActions(),this.emit("bindset-selector:set-selected-key",{key:t}),t&&"Primary Bindset"!==this.cache.activeBindset&&(this.cache.activeBindset="Primary Bindset",this.emit("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"}),this.updateBindsetBanner())}),this.addEventListener("profile:switched",e=>{console.log("[CommandChainUI] Profile switched, clearing cached state"),this.cache.activeBindset="Primary Bindset",this.emit("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"}),this.updateBindsetBanner(),this.updateChainActions(),this.render().catch(()=>{})}),this.addEventListener("language:changed",()=>{this.render()}),this.addEventListener("bindset-selector:active-changed",({bindset:e})=>{this.cache.activeBindset=e,this.updateBindsetBanner(),this.updateChainActions(),this.render()}),console.log("[CommandChainUI] Setting up bindset-selector:key-added event listener"),this.addEventListener("bindset-selector:key-added",({key:e,bindset:t})=>{console.log(`[CommandChainUI] *** bindset-selector:key-added received: key=${e}, bindset=${t}, selectedKey=${this.cache.selectedKey} ***`),e===this.cache.selectedKey?console.log(`[CommandChainUI] *** Key added to bindset: ${t} (bindset switching already handled) ***`):console.log(`[CommandChainUI] *** Event key ${e} does not match selectedKey ${this.cache.selectedKey}, ignoring ***`)}),console.log("[CommandChainUI] bindset-selector:key-added event listener registered"),this.addEventListener("bindset-selector:key-removed",({key:e,bindset:t})=>{e===this.cache.selectedKey&&this.cache.activeBindset===t&&(this.cache.activeBindset="Primary Bindset",this.emit("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"}),this.updateBindsetBanner(),this.updateChainActions(),this.render())}),this.addEventListener("preferences:loaded",async({settings:e})=>{e&&void 0!==e.bindsetsEnabled&&this.cache.preferences.bindsetsEnabled&&!this.Pe&&await this.setupBindsetDropdown()}),this.addEventListener("bindsets:changed",async e=>{console.log("[CommandChainUI] bindsets:changed received with",e.names.length,"bindsets"),this.Me=e.names,await this.setupBindsetDropdown()}),this.onDom("stabilizeExecutionOrderBtn","click","commandchain-stabilize",async()=>{await this.toggleStabilize()}),this.onDom("copyAliasBtn","click","commandchain-copy-alias",async()=>{await this.copyAliasToClipboard()}),this.onDom("copyPreviewBtn","click","commandchain-copy-preview",async()=>{await this.copyCommandPreviewToClipboard()}),this.onDom("#commandList","click","commandchain-action",e=>{const t=e.target.closest(".btn-edit:not(.btn-placeholder)"),i=e.target.closest(".btn-delete"),a=e.target.closest(".btn-up"),n=e.target.closest(".btn-down");if(t&&!t.disabled){const i=t.closest(".command-item-row"),a=parseInt(i?.dataset?.index);Number.isNaN(a)||(console.log("[CommandChainUI] EDIT BUTTON CLICKED:",{index:a,buttonId:t.id,buttonClass:t.className,buttonElement:t}),e.preventDefault(),e.stopPropagation(),this.emit("commandchain:edit",{index:a}))}else if(i&&!i.disabled){const t=i.closest(".command-item-row"),a=parseInt(t?.dataset?.index);Number.isNaN(a)||(console.log("[CommandChainUI] DELETE BUTTON CLICKED:",{index:a,buttonId:i.id,buttonClass:i.className,buttonElement:i}),e.preventDefault(),e.stopPropagation(),this.emit("commandchain:delete",{index:a}))}else if(a&&!a.disabled){const e=a.closest(".command-item-row"),t=parseInt(e?.dataset?.index);Number.isNaN(t)||this.emit("commandchain:move",{fromIndex:t,toIndex:t-1})}else if(n&&!n.disabled){const e=n.closest(".command-item-row"),t=parseInt(e?.dataset?.index);Number.isNaN(t)||this.emit("commandchain:move",{fromIndex:t,toIndex:t+1})}}),this.onDom("#commandList","dblclick","commandchain-edit-customizable",e=>{const t=e.target.closest(".command-item-row.customizable");if(t){const i=parseInt(t.dataset?.index);Number.isNaN(i)||(console.log("[CommandChainUI] DOUBLE-CLICK on command element:",{index:i,target:e.target,targetClass:e.target.className}),this.emit("commandchain:edit",{index:i}))}}),this.setupDragAndDrop(),this.updateChainActions(),this.addEventListener("preferences:changed",async e=>{const t=e.changes||{[e.key]:e.value};let i=!1,a=!1;for(const[e,n]of Object.entries(t))if("bindsetsEnabled"===e){if(i=!0,!n&&this.Pe){const e=this.document.getElementById("bindsetSelect");e&&(e.style.display="none")}}else"bindToAliasMode"===e&&(console.log(`[CommandChainUI] Preference changed: bindToAliasMode = ${n}`),i=!0,a=!0);i&&await this.setupBindsetDropdown(),a&&this.render().catch(()=>{})}),this.cache.activeBindset=this.cache.activeBindset||"Primary Bindset",this.emit("bindset:active-changed",{bindset:this.cache.activeBindset}))}async render(e=null){const t=this.document.getElementById("commandList"),i=this.document.getElementById("chainTitle"),a=this.document.getElementById("commandPreview"),n=this.document.getElementById("commandCount"),s=this.document.getElementById("emptyState");if(this.document.getElementById("generatedAlias"),this.document.getElementById("aliasPreview"),!t||!i||!a)return;const r=this.cache.preferences.bindToAliasMode;console.log(`[CommandChainUI] render: bindToAliasMode = ${r} (type: ${typeof r})`),console.log("[CommandChainUI] render: full preferences cache:",this.cache.preferences);let o=e;if(!o){if(!("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey)){const e=await this.request("command:get-empty-state-info");i.textContent=e.title,a.textContent=e.preview,n&&(n.textContent=e.commandCount);const s=this.document.createElement("div");return s.innerHTML=`\n            <div class="empty-state show" id="emptyState">\n              <i class="${e.icon}"></i>\n              <h4>${e.emptyTitle}</h4>\n              <p>${e.emptyDesc}</p>\n            </div>`,void t.replaceChildren(...s.children)}o=await this.getCommandsForCurrentSelection()}const c=await this.request("command:get-empty-state-info"),l="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(!l||0===o.length){i.textContent=c.title,n&&(n.textContent=c.commandCount),await this.updateBindToAliasMode(r,l,o);const e=this.document.createElement("div");e.innerHTML=`\n          <div class="empty-state ${0===o.length?"show":""}" id="emptyState">\n            <i class="${c.icon}"></i>\n            <h4>${c.emptyTitle}</h4>\n            <p>${c.emptyDesc}</p>\n          </div>`,t.replaceChildren(...e.children);try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,t=await this.request("command-chain:is-stabilized",{name:l,bindset:e}),i="alias"===this.cache.currentEnvironment;this.emit("command-chain:validate",{key:l,stabilized:t,isAlias:i})}catch(e){}return}i.textContent=c.title;const d=this.document.getElementById("aliasCommandCount"),m=this.document.getElementById("commandCountDisplay"),h=this.document.getElementById("aliasCommandCountDisplay"),u=m?.querySelector('[data-i18n="commands"], [data-i18n="command_singular"]'),p=h?.querySelector('[data-i18n="commands"], [data-i18n="command_singular"]'),f=o.length,y=1===f?"command_singular":"commands";if(r&&l&&"alias"!==this.cache.currentEnvironment?(d&&(d.textContent=f.toString()),p&&(p.setAttribute("data-i18n",y),p.textContent=this.i18n.t(y)),h&&(h.style.display=""),m&&(m.style.display="none")):(n&&(n.textContent=f.toString()),u&&(u.setAttribute("data-i18n",y),u.textContent=this.i18n.t(y)),m&&(m.style.display=""),h&&(h.style.display="none")),await this.updateBindToAliasMode(r,l,o),!r&&l&&"alias"!==this.cache.currentEnvironment)try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(await this.request("command-chain:is-stabilized",{name:l,bindset:e})&&o.length>1){const e=o.map(e=>"string"==typeof e?{command:e}:e),t=await this.request("command:generate-mirrored-commands",{commands:e});t&&(a.textContent=`${l} "${t}"`)}}catch(e){console.warn("[CommandChainUI] Failed to generate mirrored preview",e)}s&&s.classList.remove("show");const _=[];for(let e=0;e<o.length;e++){const t=await this.createCommandElement(o[e],e,o.length);_.push(t)}t.replaceChildren(..._);try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,t=await this.request("command-chain:is-stabilized",{name:l,bindset:e}),i="alias"===this.cache.currentEnvironment;this.emit("command-chain:validate",{key:l,stabilized:t,isAlias:i})}catch(e){}this.updateBindsetBanner()}async createCommandElement(e,t,i){const a=this.document.createElement("div")||{};a.dataset||(a.dataset={}),a.className="command-item-row",a.dataset.index=t,a.draggable=!0;const n="string"==typeof e?e:fe(e),s=this.i18n,r=await pe(n,s,{eventBus:this.eventBus});console.log("[CommandChainUI] enriched command:",r);const o=await this.request("command:find-definition",{command:n}),c="custom"===r.type||"custom"===r.category,l=o&&o.customizable||c;let d=(e=>{if("string"==typeof e)return e;if("object"==typeof e&&e){if(e.key&&e.fallback){if(this.i18n&&this.i18n.t){const t=this.i18n.t(e.key,e.params||{});if(t&&t!==e.key)return t}return e.fallback}if(e.fallback)return e.fallback;if(e.text)return e.text;const t=e.name||e.displayText;if(t)return t}return n})(r.displayText)||r.text||n,m=r.icon;l&&(a.dataset.parameters="true",a.classList.add("customizable"));const h=await this.request("command:get-warning",{command:n});let u=null;if(h){const e=this.i18n.t(h);u=e&&e!==h?e:h}const p=u?`<span class="command-warning-icon" title="${u}" data-i18n-title="${h}"><i class="fas fa-exclamation-triangle"></i></span>`:"",f=l?' <span class="param-indicator" title="Editable parameters">âš™ï¸</span>':"";console.log("[CommandChainUI] command",e),console.log("[CommandChainUI] commandDef",o);let y=r.type||r.category;return o&&o.categoryId&&!["vfx-alias","alias"].includes(r.type)&&!["vfx-alias","alias"].includes(r.category)&&(y=o.categoryId),a.innerHTML=`\n      <div class="command-number">${t+1}</div>\n      <div class="command-content">\n        <span class="command-icon">${m}</span>\n        <span class="command-text">${d}${f}</span>\n        ${p}\n      </div>\n      <span class="command-type ${y}">${y}</span>\n      <div class="command-actions">\n        ${l?'<button class="command-action-btn btn-edit" title="Edit Command"><i class="fas fa-edit"></i></button>':'<button class="command-action-btn btn-edit btn-placeholder" disabled aria-hidden="true" style="visibility:hidden"><i class="fas fa-edit"></i></button>'}\n        <button class="command-action-btn command-action-btn-danger btn-delete" title="Delete Command"><i class="fas fa-times"></i></button>\n        <button class="command-action-btn btn-up" title="Move Up" ${0===t?"disabled":""}><i class="fas fa-chevron-up"></i></button>\n        <button class="command-action-btn btn-down" title="Move Down" ${t===i-1?"disabled":""}><i class="fas fa-chevron-down"></i></button>\n      </div>`,a}setupDragAndDrop(){if(!this.ui||"function"!=typeof this.ui.initDragAndDrop)return;const e=this.document.getElementById("commandList");e&&this.ui.initDragAndDrop(e,{draggableSelector:".command-item-row",dropZoneSelector:".command-item-row",onDrop:(e,t,i)=>{if(!t?.dragElement||!i)return;const a=parseInt(t.dragElement.dataset.index),n=parseInt(i.dataset.index);a===n||Number.isNaN(a)||Number.isNaN(n)||this.emit("commandchain:move",{fromIndex:a,toIndex:n})}})}updatePreviewLabel(){const e=this.document.querySelector(".generated-command label[data-i18n]");if(e){const t="alias"===this.cache.currentEnvironment?"generated_alias":"generated_command";e.setAttribute("data-i18n",t),"undefined"!=typeof window&&window.applyTranslations?window.applyTranslations(e.parentElement):this.i18n&&this.i18n.t?e.textContent=this.i18n.t(t):e.textContent="generated_alias"===t?"Generated Alias:":"Generated Command:"}}async updateBindToAliasMode(e,t,i){const a=this.document.getElementById("generatedAlias"),n=this.document.getElementById("aliasPreview"),s=this.document.getElementById("commandPreview");if(console.log(`[CommandChainUI] updateBindToAliasMode: bindToAliasMode=${e}, selectedKeyName=${t}, environment=${this.cache.currentEnvironment}, activeBindset=${this.cache.activeBindset}`),a&&n&&s)if(e&&t&&"alias"!==this.cache.currentEnvironment){a.style.display="";try{const e=await this.request("command-chain:generate-alias-name",{environment:this.cache.currentEnvironment,keyName:t,bindsetName:this.cache.activeBindset});if(e){let a=await this.request("command-chain:generate-alias-preview",{aliasName:e,commands:i});try{const n="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(await this.request("command-chain:is-stabilized",{name:t,bindset:n})&&i.length>1){const t=i.map(e=>"string"==typeof e?e:e.command||e).filter(Boolean),n=await this.request("command:generate-mirrored-commands",{commands:t.map(e=>({command:e}))});n&&(a=`alias ${e} <& ${n} &>`)}}catch(e){console.warn("[CommandChainUI] Failed to apply mirroring:",e)}n.textContent=a,s.textContent=`${t} "${e}"`}else n.textContent="Invalid key name for alias generation",s.textContent=`${t} "..."`}catch(e){console.error("[CommandChainUI] Failed to generate alias preview:",e),n.textContent="Error generating alias preview",s.textContent=`${t} "..."`}}else{a.style.display="none",this.updatePreviewLabel();const e=i.map(e=>"string"==typeof e?e:e.command||e).filter(Boolean);let n=e.join(" $$ ");try{const i="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(await this.request("command-chain:is-stabilized",{name:t,bindset:i})&&e.length>1){const t=await this.request("command:generate-mirrored-commands",{commands:e.map(e=>({command:e}))});t&&(n=t)}}catch{}t?"alias"===this.cache.currentEnvironment?s.textContent=`alias ${t} <& ${n} &>`:s.textContent=`${t} "${n}"`:s.textContent=""}else console.log(`[CommandChainUI] Missing UI elements: generatedAlias=${!!a}, aliasPreviewEl=${!!n}, previewEl=${!!s}`)}async updateChainActions(){const e=!!("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey),t=this.document.getElementById("stabilizeExecutionOrderBtn");if(t)if(t.disabled=!e,e){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;try{const i="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,a=await this.request("command:is-stabilized",{name:e,bindset:i});t.classList.toggle("active",!!a)}catch{}}else t.classList.remove("active");if("alias"===this.cache.currentEnvironment){["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(t=>{const i=this.document.getElementById(t);i&&(i.disabled=!e)});const t=this.document.getElementById("importFromKeyOrAliasBtn");t&&(t.disabled=!e),["deleteKeyBtn","duplicateKeyBtn"].forEach(e=>{const t=this.document.getElementById(e);t&&(t.disabled=!0)})}else["importFromKeyOrAliasBtn","deleteKeyBtn","duplicateKeyBtn"].forEach(t=>{const i=this.document.getElementById(t);i&&(i.disabled=!e)}),["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(e=>{const t=this.document.getElementById(e);t&&(t.disabled=!0)})}async toggleStabilize(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(!e)return;const t=this.document.getElementById("stabilizeExecutionOrderBtn"),i=t?.classList.contains("active");try{const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,a=await this.request("command:set-stabilize",{name:e,stabilize:!i,bindset:t});a&&a.success&&(await this.updateChainActions(),this.render())}catch(e){console.error("[CommandChainUI] Failed to toggle stabilization",e)}}onDestroy(){}handleInitialState(e,t){if(!t)return;if("SelectionService"===e)return void this.render().catch(()=>{});const i="InterfaceModeService"===e||"DataCoordinator"===e;(t.environment||t.currentEnvironment)&&i&&(t.environment||t.currentEnvironment,this.updateChainActions(),this.render().catch(()=>{})),t.bindsets&&(this.Me=Array.isArray(t.bindsets)?t.bindsets:[...t.bindsets]),"PreferencesService"===e&&this.cache.preferences&&(console.log("[CommandChainUI] Late-join preferences received, checking bindset setup"),this.cache.preferences.bindsetsEnabled&&!this.Pe&&this.setupBindsetDropdown().catch(()=>{}))}async setupBindsetDropdown(){const e=this.cache.preferences.bindToAliasMode,t=this.document.getElementById("bindsetSelectorContainer");"alias"!==this.cache.currentEnvironment&&this.cache.preferences.bindsetsEnabled&&e?(t&&(t.style.display="block"),this.updateBindsetBanner(),this.cache.activeBindset||(this.cache.activeBindset="Primary Bindset",this.emit("bindset:active-changed",{bindset:this.cache.activeBindset})),this.Pe=!0):t&&(t.style.display="none")}async getCommandsForCurrentSelection(){if("alias"===this.cache.currentEnvironment)return await this.request("command:get-for-selected-key",{key:this.cache.selectedAlias,environment:this.cache.currentEnvironment});const e=this.cache.selectedKey;return e?this.cache.activeBindset&&"Primary Bindset"!==this.cache.activeBindset?await this.request("bindset:get-key-commands",{bindset:this.cache.activeBindset,environment:this.cache.currentEnvironment,key:e}):await this.request("data:get-key-commands",{environment:this.cache.currentEnvironment,key:e}):[]}updateBindsetBanner(){try{const e=this.document.querySelector(".chain-header");if(!e)return;let t=this.document.getElementById("bindsetBanner");if(!this.cache.preferences.bindsetsEnabled||!this.cache.activeBindset||"Primary Bindset"===this.cache.activeBindset)return void(t&&t.remove());e.style.flexWrap="wrap",t||(t=this.document.createElement("div"),t.id="bindsetBanner",t.className="bindset-banner",Object.assign(t.style,{marginTop:"4px",padding:"0.125rem 0.5rem",background:"#3a3d42",color:"#fff",borderRadius:"4px",fontSize:"0.85em",flex:"0 0 100%",textAlign:"center"}),e.appendChild(t)),t.textContent=this.cache.activeBindset}catch(e){console.error("[CommandChainUI] Failed to update bindset banner",e)}}async copyAliasToClipboard(){const e=this.document.getElementById("aliasPreview"),t=e?.textContent?.trim();if(t)try{const e=await this.request("utility:copy-to-clipboard",{text:t});if(e?.success){const t=this.i18n.t(e?.message||"content_copied_to_clipboard");this.showToast(t,"success")}else{const t=this.i18n.t(e?.message||"failed_to_copy_to_clipboard");this.showToast(t,"error")}}catch(e){console.error("Failed to copy alias to clipboard:",e),this.showToast(this.i18n.t("failed_to_copy_to_clipboard"),"error")}else this.showToast(this.i18n.t("nothing_to_copy"),"warning")}async copyCommandPreviewToClipboard(){const e=this.document.getElementById("commandPreview"),t=e?.textContent?.trim();if(t)try{const e=await this.request("utility:copy-to-clipboard",{text:t});if(e?.success){const t=this.i18n.t(e?.message||"content_copied_to_clipboard");this.showToast(t,"success")}else{const t=this.i18n.t(e?.message||"failed_to_copy_to_clipboard");this.showToast(t,"error")}}catch(e){console.error("Failed to copy command preview to clipboard:",e);const t=this.i18n.t("failed_to_copy_to_clipboard");this.showToast(t,"error")}else this.showToast(this.i18n.t("nothing_to_copy"),"warning")}hasRequiredData(){return this.cache&&this.cache.currentEnvironment}performInitialRender(){this.render().catch(e=>{console.error("[CommandChainUI] Initial render failed:",e)})}}class qt extends oe{constructor({eventBus:e,i18n:t}={}){super(e),this.componentName="KeyBrowserService",this.i18n=t,this.eventBus&&(this.respond("key:get-all",()=>this.getKeys()),this.respond("key:categorize-by-command",({keysWithCommands:e,allKeys:t})=>this.categorizeKeys(e,t)),this.respond("key:categorize-by-type",({keysWithCommands:e,allKeys:t})=>this.categorizeKeysByType(e,t)),this.respond("key:compare",({keyA:e,keyB:t})=>this.compareKeys(e,t)),this.respond("key:detect-types",({keyName:e})=>this.detectKeyTypes(e)),this.respond("key:sort",({keys:e})=>this.sortKeys(e)),this.respond("key:filter",({keys:e,filter:t})=>this.filterKeys(e,t)),this.respond("key:show-all",({keys:e})=>this.showAllKeys(e)),this.respond("key:toggle-category",({categoryId:e,mode:t})=>this.toggleKeyCategory(e,t)),this.respond("key:get-category-state",({categoryId:e,mode:t})=>this.getCategoryState(e,t)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&(this.updateCacheFromProfile(t),this.emit("key:list-changed",{keys:this.getKeys()}))}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{this.cache.currentProfile=e,i&&(this.cache.currentEnvironment=i),this.updateCacheFromProfile(t),this.emit("key:list-changed",{keys:this.getKeys()})}),this.addEventListener("environment:changed",async e=>{("string"==typeof e?e:e?.environment)&&this.emit("key:list-changed",{keys:this.getKeys()})}),this.addEventListener("profile-modified",()=>{this.emit("key:list-changed",{keys:this.getKeys()})})}updateCacheFromProfile(e){e&&console.log("[KeyBrowserService] Profile updated - ComponentBase handles caching automatically")}getKeys(){return this.cache.keys||{}}async categorizeKeys(e,t){const i={unknown:{name:"Unknown",icon:"fas fa-question-circle",keys:new Set,priority:0}};try{if(await this.request("data:has-commands")){const e=await this.request("data:get-commands");Object.entries(e).forEach(([e,t])=>{i[e]={name:t.name,icon:t.icon,keys:new Set,priority:1}})}}catch(e){console.warn("KeyBrowserService: Failed to get command categories:",e)}return await Promise.all(t.map(async t=>{const a=e[t]||[];if(!a||0===a.length)return void i.unknown.keys.add(t);const n=new Set;await Promise.all(a.map(async e=>{const t=e.category||e.type;if(t&&i[t])n.add(t);else try{const t=await this.request("parser:parse-command-string",{commandString:e.command,options:{generateDisplayText:!1}});if(t.commands&&t.commands.length>0){const e=t.commands[0].category;i[e]&&n.add(e)}}catch(e){i.custom||(i.custom={name:"Custom Commands",icon:"fas fa-cog",keys:new Set,priority:2})}})),n.size>0?n.forEach(e=>i[e].keys.add(t)):(i.custom||(i.custom={name:"Custom Commands",icon:"fas fa-cog",keys:new Set,priority:2}),i.custom.keys.add(t))})),Object.values(i).forEach(e=>{e.keys=Array.from(e.keys).sort((e,t)=>this.compareKeys(e,t))}),i}detectKeyTypes(e){const t=[];return/^F[0-9]+$/.test(e)&&t.push("function"),/^[A-Z0-9]$/.test(e)&&t.push("alphanumeric"),/^NUMPAD/.test(e)&&t.push("numberpad"),/(Ctrl|Alt|Shift)/.test(e)&&t.push("modifiers"),/(UP|DOWN|LEFT|RIGHT|HOME|END|PGUP|PGDN)/.test(e)&&t.push("navigation"),/(ESC|TAB|CAPS|PRINT|SCROLL|PAUSE|Space|Enter|Escape)/.test(e)&&t.push("system"),/MOUSE|WHEEL/.test(e)&&t.push("mouse"),0===t.length&&/[^A-Za-z0-9]/.test(e)&&t.push("symbols"),0===t.length&&t.push("other"),t}categorizeKeysByType(e,t){const i={function:{name:this.i18n.t("key_type.function_keys"),icon:"fas fa-keyboard",keys:new Set,priority:1},alphanumeric:{name:this.i18n.t("key_type.letters_numbers"),icon:"fas fa-font",keys:new Set,priority:2},numberpad:{name:this.i18n.t("key_type.numberpad"),icon:"fas fa-calculator",keys:new Set,priority:3},modifiers:{name:this.i18n.t("key_type.modifier_keys"),icon:"fas fa-hand-paper",keys:new Set,priority:4},navigation:{name:this.i18n.t("key_type.navigation"),icon:"fas fa-arrows-alt",keys:new Set,priority:5},system:{name:this.i18n.t("key_type.system_keys"),icon:"fas fa-cogs",keys:new Set,priority:6},mouse:{name:this.i18n.t("key_type.mouse_wheel"),icon:"fas fa-mouse",keys:new Set,priority:7},symbols:{name:this.i18n.t("key_type.symbols_punctuation"),icon:"fas fa-at",keys:new Set,priority:8},other:{name:this.i18n.t("key_type.other_keys"),icon:"fas fa-question-circle",keys:new Set,priority:9}};return t.forEach(e=>{this.detectKeyTypes(e).forEach(t=>(i[t]||i.other).keys.add(e))}),Object.values(i).forEach(e=>{e.keys=Array.from(e.keys).sort((e,t)=>this.compareKeys(e,t))}),i}compareKeys(e,t){const i=e.match(/^F(\d+)$/),a=t.match(/^F(\d+)$/);if(i&&a)return parseInt(i[1])-parseInt(a[1]);if(i&&!a)return-1;if(!i&&a)return 1;const n=/^\d+$/.test(e),s=/^\d+$/.test(t);if(n&&s)return parseInt(e)-parseInt(t);if(n&&!s)return-1;if(!n&&s)return 1;const r=/^[A-Z]$/.test(e),o=/^[A-Z]$/.test(t);if(r&&o)return e.localeCompare(t);if(r&&!o)return-1;if(!r&&o)return 1;const c=["Space","Tab","Enter","Escape"],l=c.indexOf(e),d=c.indexOf(t);return-1!==l&&-1!==d?l-d:-1!==l&&-1===d?-1:-1===l&&-1!==d?1:e.localeCompare(t)}sortKeys(e){return Array.isArray(e)?[...e].sort((e,t)=>this.compareKeys(e,t)):[]}filterKeys(e,t=""){if(!Array.isArray(e))return[];if(!t)return e;const i=t.toString().toLowerCase();return e.filter(e=>(e||"").toLowerCase().includes(i))}showAllKeys(e){return Array.isArray(e)?e:[]}toggleKeyCategory(e,t="command"){if(!e)return!1;const i="key-type"===t?`keyTypeCategory_${e}_collapsed`:`keyCategory_${e}_collapsed`,a=!("true"===localStorage.getItem(i));return localStorage.setItem(i,a),a}getCategoryState(e,t="command"){if(!e)return!1;const i="key-type"===t?`keyTypeCategory_${e}_collapsed`:`keyCategory_${e}_collapsed`;return"true"===localStorage.getItem(i)}}class Vt extends lt{constructor({eventBus:e,ui:t=null,document:i=null}={}){super(e),this.componentName="PreferencesUI",this.ui=t,this.document=i||("undefined"!=typeof window?window.document:null),this.eventsSetup=!1,this.settingDefinitions={language:{type:"select",element:"languageSelect"},translateGeneratedMessages:{type:"boolean",element:"translateGeneratedMessagesCheckbox"},autoSave:{type:"boolean",element:"autoSaveCheckbox"},autoSync:{type:"boolean",element:"autoSync"},autoSyncInterval:{type:"select",element:"autoSyncInterval"},bindToAliasMode:{type:"boolean",element:"bindToAliasModeCheckbox"},bindsetsEnabled:{type:"boolean",element:"bindsetsEnabledCheckbox"}},this.pendingSettings={}}onInit(){this.request("preferences:init").then(()=>{this.populatePreferencesModal()}),this.setupEventListeners()}setupEventListeners(){this.eventBus.on("preferences:show",()=>{this.showPreferences()}),this.eventBus.on("sync:folder-set",()=>{this.updateFolderDisplay()}),this.eventBus.on("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};void 0===t.autoSync&&void 0===t.autoSyncInterval||this.notifyAutoSyncSettingsChanged()}),document.querySelectorAll(".category-item").forEach(e=>{this.onDom(e,"click","pref-cat",e=>{const t=e.currentTarget.dataset.category;this.switchCategory(t)})}),this.onDom("savePreferencesBtn","click","pref-save",()=>{this.saveAllSettings(!0)}),this.setupSettingControls();const e=document.getElementById("setSyncFolderBtn");e&&e.addEventListener("click",async()=>{if(console.log("[PreferencesUI] setSyncFolderBtn clicked"),window.stoSync?.setSyncFolder)try{const e=await window.stoSync.setSyncFolder(!0);console.log("[PreferencesUI] setSyncFolder returned",{hasHandle:!!e,name:e?.name}),e&&(await this.request("preferences:load-settings"),this.updateFolderDisplay(),console.log("[PreferencesUI] settings reloaded after setSyncFolder"))}catch(e){console.error("[PreferencesUI] setSyncFolder failed",e)}})}setupSettingControls(){Object.entries(this.settingDefinitions).forEach(([e,t])=>{const i=document.getElementById(t.element);if(i)switch("bindsetsEnabled"===e&&(i.disabled=!(this.pendingSettings.bindToAliasMode||i.checked)),t.type){case"boolean":this.onDom(i,"change",`pref-${e}`,t=>{this.handleSettingChange(e,t.target.checked)});break;case"select":this.onDom(i,"change",`pref-${e}`,t=>{this.handleSettingChange(e,t.target.value)})}})}switchCategory(e){document.querySelectorAll(".category-item").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-category="${e}"]`);t&&t.classList.add("active"),document.querySelectorAll(".settings-panel").forEach(e=>e.classList.remove("active"));const i=document.getElementById(`${e}-settings`);i&&i.classList.add("active")}async updateSetting(e,t){await this.setSetting(e,t),"syncFolderName"!==e&&"syncFolderPath"!==e||this.updateFolderDisplay()}updateUI(e,t){const i=this.settingDefinitions[e];if(!i)return;const a=document.getElementById(i.element);a&&("boolean"===i.type?a.checked=!!t:"select"===i.type&&(a.value=t),"bindToAliasMode"===e&&this.updateBindsetsCheckboxState(t))}async saveAllSettings(e=!0){if(console.log("[PreferencesUI] saveAllSettings called",{manual:e,pending:{...this.pendingSettings}}),Object.keys(this.pendingSettings).length>0){const e={...await this.request("preferences:get-settings"),...this.pendingSettings};await this.request("preferences:set-settings",e),this.pendingSettings={},console.log("[PreferencesUI] pending settings applied")}const t=await this.saveSettings();console.log("[PreferencesUI] preferences:save-settings result",{ok:t}),t&&e&&this.ui?.showToast&&this.emit("toast:show",{message:Q.t("preferences_saved"),type:"success"}),this.notifyAutoSyncSettingsChanged(),await this.emit("modal:hide",{modalId:"preferencesModal"},{synchronous:!0})}async showPreferences(){console.log("[PreferencesUI] showPreferences"),await this.request("preferences:load-settings"),this.pendingSettings={};const e=await this.request("preferences:get-settings");Object.entries(e).forEach(([e,t])=>this.updateUI(e,t)),this.updateFolderDisplay(),this.emit("modal:show",{modalId:"preferencesModal"})}async populatePreferencesModal(){await this.request("preferences:load-settings")}async updateFolderDisplay(){const e=await this.request("preferences:get-settings"),{syncFolderName:t,syncFolderPath:i}=e;console.log("[PreferencesUI] updateFolderDisplay",{syncFolderName:t,syncFolderPath:i});const a=this.document.getElementById("currentSyncFolder");a&&(t?(a.textContent=t,a.removeAttribute("data-i18n")):(a.textContent=Q.t("no_folder_selected"),a.setAttribute("data-i18n","no_folder_selected")))}async notifyAutoSyncSettingsChanged(){this.emit("preferences:autosync-settings-changed")}async setSetting(e,t){await this.request("preferences:set-setting",{key:e,value:t}),this.updateUI(e,t)}async saveSettings(){return await this.request("preferences:save-settings")}handleSettingChange(e,t){"bindToAliasMode"===e||"bindsetsEnabled"===e?(this.pendingSettings[e]=t,this.updateUI(e,t),"bindToAliasMode"===e&&(this.updateBindsetsCheckboxState(t),t||(this.pendingSettings.bindsetsEnabled=!1))):this.updateSetting(e,t)}updateBindsetsCheckboxState(e=null){const t=document.getElementById("bindsetsEnabledCheckbox");if(!t)return;let i=e;if(null===i){const e=this.pendingSettings.bindToAliasMode;i=void 0!==e?e:t.checked}t.disabled=!i,i||(t.checked=!1,this.pendingSettings.bindsetsEnabled=!1)}}class Gt extends oe{constructor({eventBus:e,i18n:t,ui:i}={}){super(e),this.componentName="AliasService",this.i18n=t,this.ui=i,this.eventBus&&(this.respond("alias:add",({name:e,description:t}={})=>this.addAlias(e,t)),this.respond("alias:delete",({name:e}={})=>this.deleteAlias(e)),this.respond("alias:duplicate-with-name",({sourceName:e,newName:t}={})=>this.duplicateAliasWithName(e,t)),this.respond("alias:validate-name",({name:e}={})=>this.isValidAliasName(e)),this.respond("alias:import-file",({content:e}={})=>this.importAliasFile(e)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventBus&&(this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{this.cache.currentProfile=e,this.cache.currentEnvironment=i||"space",this.updateCacheFromProfile(t)}),this.addEventListener("environment:changed",({environment:e})=>{e&&(this.cache.currentEnvironment=e||"space")}))}updateCacheFromProfile(e){e&&(this.cache.aliases=e.aliases||{},this.cache.profile=e)}async addAlias(e,t=""){if(!await this.isValidAliasName(e))return{success:!1,error:"invalid_alias_name",params:{name:e}};if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(this.cache.aliases[e])return{success:!1,error:"alias_already_exists",params:{name:e}};try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{aliases:{[e]:{description:t,commands:[],type:"alias"}}}}),this.emit("alias-created",{name:e}),{success:!0,message:"alias_created",data:{name:e}}}catch(e){return console.error("[AliasService] Failed to add alias:",e),{success:!1,error:"failed_to_add_alias"}}}async deleteAlias(e){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!this.cache.aliases[e])return{success:!1,error:"alias_not_found",params:{name:e}};try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,delete:{aliases:[e]}}),this.emit("alias-deleted",{name:e}),{success:!0,message:"alias_deleted",data:{name:e}}}catch(e){return console.error("[AliasService] Failed to delete alias:",e),{success:!1,error:"failed_to_delete_alias"}}}async duplicateAliasWithName(e,t){if(!e||!t)return{success:!1,error:"invalid_alias_name"};if(!this.cache.aliases[e])return{success:!1,error:"alias_not_found",params:{name:e}};if(!await this.isValidAliasName(t))return{success:!1,error:"invalid_alias_name",params:{name:t}};if(this.cache.aliases[t])return{success:!1,error:"alias_already_exists",params:{name:t}};const i=this.cache.aliases[e];try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{aliases:{[t]:{description:i.description,commands:i.commands,type:i.type||"alias"}}}}),this.cache.aliases[t]={description:i.description,commands:i.commands,type:i.type||"alias"},this.emit("alias-created",{name:t}),this.emit("alias-duplicated",{from:e,to:t}),{success:!0,message:"alias_duplicated",data:{from:e,to:t}}}catch(e){return console.error("[AliasService] Failed to duplicate alias with name:",e),{success:!1,error:"failed_to_duplicate_alias"}}}async isValidAliasName(e){if(!e||"string"!=typeof e)return!1;try{const{isAliasNameAllowed:t}=await Promise.resolve().then(function(){return Dt});return t(e)}catch(t){return/^[A-Za-z][A-Za-z0-9_]*$/.test(e)&&e.length<=50}}importAliasFile(e){const t=this.cache.currentProfile;return request(this.eventBus,"import:alias-file",{content:e,profileId:t})}}class Wt extends oe{constructor({eventBus:e}={}){if(super(e),this.componentName="SelectionService",this.editingContext=null,this.cachedSelections={space:null,ground:null,alias:null},this.ae=[],this.Ne=null,this.De=null,"undefined"!=typeof vi&&"function"==typeof vi.fn&&!vi.isMockFunction?.(this.emit)){const e=this.emit.bind(this);this.emit=vi.fn((...t)=>e(...t))}}onInit(){this.setupEventListeners(),this.setupRequestHandlers(),this.cache&&!this.cache.cachedSelections&&(this.cache.cachedSelections={...this.cachedSelections})}setCachedSelection(e,t){e&&(this.cachedSelections[e]=t,this.cache&&(this.cache.cachedSelections?this.cache.cachedSelections[e]=t:this.cache.cachedSelections={...this.cachedSelections}))}getCachedSelection(e){if(e)return Object.prototype.hasOwnProperty.call(this.cachedSelections,e)?this.cachedSelections[e]:this.cache?.cachedSelections&&Object.prototype.hasOwnProperty.call(this.cache.cachedSelections,e)?this.cache.cachedSelections[e]:void 0}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{if(console.log(`[SelectionService] profile:switched: profileId="${e}", env="${i}"`),this.updateCacheFromProfile(t),!t)return void(this.cachedSelections={space:null,ground:null,alias:null});t.selections&&(t.selections.space&&(this.cachedSelections.space=t.selections.space,this.setCachedSelection("space",t.selections.space)),t.selections.ground&&(this.cachedSelections.ground=t.selections.ground,this.setCachedSelection("ground",t.selections.ground)),t.selections.alias&&(this.cachedSelections.alias=t.selections.alias,this.setCachedSelection("alias",t.selections.alias)),console.log("[SelectionService] Restored cached selections from profile:",this.cachedSelections));const a=this.cachedSelections[this.cache.currentEnvironment];console.log(`[SelectionService] Validating and restoring selection for "${this.cache.currentEnvironment}": "${a}"`),a?(console.log(`[SelectionService] Setting initial selection from profile: "${a}" for env "${this.cache.currentEnvironment}"`),"alias"===this.cache.currentEnvironment?(this.cache.selectedAlias=a,this.cache.selectedKey=null,this.emit("alias-selected",{name:a,source:"SelectionService"}),this.validateAliasExists(a)||(console.log(`[SelectionService] Cached alias "${a}" doesn't exist in current profile, clearing and auto-selecting`),setTimeout(async()=>{await this.validateAndRestoreSelection("alias",null)},0))):(this.cache.selectedKey=a,this.cache.selectedAlias=null,this.emit("key-selected",{key:a,environment:this.cache.currentEnvironment,source:"SelectionService"}),this.validateKeyExists(a,this.cache.currentEnvironment)||(console.log(`[SelectionService] Cached key "${a}" doesn't exist in current profile, clearing and auto-selecting`),setTimeout(async()=>{await this.validateAndRestoreSelection(this.cache.currentEnvironment,null)},0)))):(console.log(`[SelectionService] No cached selection, validating for env "${this.cache.currentEnvironment}"`),setTimeout(async()=>{await this.validateAndRestoreSelection(this.cache.currentEnvironment,a)},0))}),this.addEventListener("environment:changed",async e=>{const t="string"==typeof e?e:e?.environment,i="object"==typeof e&&e?.fromEnvironment?e.fromEnvironment:this.cache.currentEnvironment;t&&t!==i&&await this.switchEnvironment(t,i)}),this.addEventListener("alias-deleted",async({name:e})=>{this.De=e,this.cache.selectedAlias===e&&(this.cache.selectedAlias=null,this.setCachedSelection("alias",null),this.cache.aliases&&this.cache.aliases[e]&&delete this.cache.aliases[e],this.cache.profile?.aliases&&this.cache.profile.aliases[e]&&delete this.cache.profile.aliases[e],this.emit("alias-selected",{name:null,source:"SelectionService"}),"alias"===this.cache.currentEnvironment&&await this.autoSelectFirst("alias"))}),this.addEventListener("key-deleted",async({keyName:e})=>{if(this.Ne=e,this.cache.selectedKey===e){if(this.cache.selectedKey=null,this.cache.builds)for(const[t,i]of Object.entries(this.cache.builds))i.keys&&i.keys[e]&&(delete i.keys[e],this.setCachedSelection(t,null));this.cache.keys&&this.cache.keys[e]&&(delete this.cache.keys[e],this.setCachedSelection(this.cache.currentEnvironment,null)),this.emit("key-selected",{key:null,source:"SelectionService"}),"alias"!==this.cache.currentEnvironment&&await this.autoSelectFirst(this.cache.currentEnvironment)}})}setupRequestHandlers(){this.ae.push(this.respond("selection:select-key",({keyName:e,environment:t})=>this.selectKey(e,t)),this.respond("selection:select-alias",({aliasName:e})=>this.selectAlias(e)),this.respond("selection:clear",({type:e})=>this.clearSelection(e)),this.respond("selection:get-selected",({environment:e})=>this.getSelectedItem(e)),this.respond("selection:get-state",()=>this.getSelectionState()),this.respond("selection:get-cached",({environment:e})=>this.getCachedSelection(e)),this.respond("selection:auto-select-first",({environment:e})=>this.autoSelectFirst(e)),this.respond("selection:set-editing-context",({context:e})=>this.setEditingContext(e)),this.respond("selection:get-editing-context",()=>this.editingContext),this.respond("key:get-selected",()=>this.cache.selectedKey),this.respond("key:select",({keyName:e,environment:t})=>this.selectKey(e,t)),this.respond("alias:select",({aliasName:e})=>this.selectAlias(e)))}async selectKey(e,t=null,i={}){const a=t||this.cache.currentEnvironment,n=!0===i.isAuto,s=!0===i.skipPersistence,r=this.cache.selectedKey===e&&this.cache.currentEnvironment===a,o=!0===i.forceEmit||null==e||!n&&("auto"===this.Le||null==this.Le);return r&&!o||(this.cache.selectedKey=e,this.cache.selectedAlias=null,this.setCachedSelection(a,e),null==t&&(this.cache.currentEnvironment=a),s||await this.persistSelectionToProfile(a,e),this.emit("key-selected",{key:e,environment:a,source:"SelectionService"}),this.Le=n?"auto":"manual"),e}async selectAlias(e,t={}){const i=!0===t.isAuto,a=!0===t.skipPersistence,n=this.cache.selectedAlias===e,s=!0===t.forceEmit||null==e||!i&&("auto"===this.Ke||null==this.Ke);return n&&!s&&"alias"===this.cache.currentEnvironment||(this.cache.selectedAlias=e,this.cache.selectedKey=null,this.setCachedSelection("alias",e),a||await this.persistSelectionToProfile("alias",e),this.emit("alias-selected",{name:e,source:"SelectionService"}),this.Ke=i?"auto":"manual"),e}clearSelection(e="all"){switch(e){case"key":this.cache.selectedKey=null;break;case"alias":this.cache.selectedAlias=null;break;case"editing":this.editingContext=null;break;default:this.cache.selectedKey=null,this.cache.selectedAlias=null,this.editingContext=null}"all"!==e&&"key"!==e||this.emit("key-selected",{key:null,source:"SelectionService"}),"all"!==e&&"alias"!==e||this.emit("alias-selected",{name:null,source:"SelectionService"})}getSelectedItem(e=null){return"alias"===(e||this.cache.currentEnvironment)?this.cache.selectedAlias:this.cache.selectedKey}getSelectionState(){return{selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,editingContext:this.editingContext,cachedSelections:{...this.cachedSelections},currentEnvironment:this.cache.currentEnvironment}}setEditingContext(e){return this.editingContext=e,this.emit("editing-context-changed",{context:e}),e}async switchEnvironment(e,t=null){const i=t??this.cache.currentEnvironment??this.cache.profile?.currentEnvironment??"space";"alias"===i&&this.cache.selectedAlias?(this.setCachedSelection("alias",this.cache.selectedAlias),console.log(`[SelectionService] Cached alias selection "${this.cache.selectedAlias}" before switching from ${i} to ${e}`),await this.persistSelectionToProfile("alias",this.cache.selectedAlias)):"alias"!==i&&this.cache.selectedKey&&(this.setCachedSelection(i,this.cache.selectedKey),console.log(`[SelectionService] Cached key selection "${this.cache.selectedKey}" for env "${i}" before switching to ${e}`),await this.persistSelectionToProfile(i,this.cache.selectedKey)),this.cache.currentEnvironment=e,this.je(e);let a=this.getCachedSelection(e);void 0===a&&(a=this.cache.profile?.selections?.[e]??null,this.setCachedSelection(e,a)),console.log(`[SelectionService] Switching to ${e}, cached selection: "${a}"`),"alias"===e?(this.cache.selectedKey=null,this.cache.selectedAlias=a??null,this.emit("key-selected",{key:null,source:"SelectionService"}),await this.validateAndRestoreSelection("alias",a)):(this.cache.selectedAlias=null,this.cache.selectedKey=a??null,this.emit("alias-selected",{name:null,source:"SelectionService"}),await this.validateAndRestoreSelection(e,a)),this.emit("environment:switched",{from:i,to:e,source:"SelectionService"}),setTimeout(async()=>{try{const e={};this.cachedSelections.space&&(e.space=this.cachedSelections.space),this.cachedSelections.ground&&(e.ground=this.cachedSelections.ground),this.cachedSelections.alias&&(e.alias=this.cachedSelections.alias),this.cache.currentProfile&&Object.keys(e).length>0&&await this.request("data:update-profile",{profileId:this.cache.currentProfile,updates:{properties:{selections:e}},updateSource:"SelectionService"})}catch(e){}},10)}je(e){if(!e)return;const t=this.cache.builds||this.cache.profile?.builds;t&&t[e]?.keys?this.cache.keys=t[e].keys:this.cache.profile?.keys&&e===this.cache.currentEnvironment?this.cache.keys=this.cache.profile.keys:this.cache.keys={}}async autoSelectFirst(e=null){const t=e||this.cache.currentEnvironment;if("alias"!==t){let e=this.cache.keys||{};if(t===this.cache.currentEnvironment&&0!==Object.keys(e).length||!this.cache.builds||(e=this.cache.builds[t]?.keys||{}),0===Object.keys(e).length)try{e=await this.request("data:get-keys",{environment:t})||{}}catch(e){return null}let i=Object.keys(e);if(this.Ne&&(i=i.filter(e=>e!==this.Ne)),i.length>0){const e=i[0];return await this.selectKey(e,t,{isAuto:!0}),this.Ne=null,e}return"alias"===this.cache.currentEnvironment?await this.selectAlias(null,{isAuto:!0}):await this.selectKey(null,this.cache.currentEnvironment,{isAuto:!0}),null}{let e=this.cache.aliases||{};if(0===Object.keys(e).length)try{e=await this.request("data:get-aliases")||{}}catch(e){return console.warn("[SelectionService] Failed to get aliases for auto-selection:",e),null}let t=Object.entries(e).filter(([e,t])=>"vfx-alias"!==t.type);if(this.De&&(t=t.filter(([e])=>e!==this.De)),t.length>0){const e=t[0][0];return await this.selectAlias(e,{isAuto:!0}),this.De=null,e}}return null}validateKeyExists(e,t=null){if(!e)return!1;const i=t||this.cache.currentEnvironment,a=this.cache.profile;if(!a)return!1;const n=a.builds?.[i]?.keys?.[e];return void 0!==n&&Array.isArray(n)}validateAliasExists(e){if(!e)return!1;const t=this.cache.aliases||{};return Object.fromEntries(Object.entries(t).filter(([e,t])=>"vfx-alias"!==t.type)).hasOwnProperty(e)}async validateAndRestoreSelection(e,t,i={}){const{skipPersistence:a=!1}=i;if(console.log(`[SelectionService] validateAndRestoreSelection: env="${e}", cached="${t}", skipPersistence=${a}`),!t)return void await this.autoSelectFirst(e);let n=!1;"alias"===e?(n=this.validateAliasExists(t),n?(console.log(`[SelectionService] Restoring cached alias: "${t}"`),await this.selectAlias(t,{isAuto:!0,skipPersistence:a})):(console.log(`[SelectionService] Cached alias "${t}" no longer exists, auto-selecting`),this.setCachedSelection("alias",null),await this.autoSelectFirst("alias"))):(n=this.validateKeyExists(t,e),n?(console.log(`[SelectionService] Restoring cached key: "${t}" for env "${e}"`),await this.selectKey(t,e,{isAuto:!0,skipPersistence:a})):(console.log(`[SelectionService] Cached key "${t}" no longer exists in ${e}, auto-selecting`),this.setCachedSelection(e,null),await this.autoSelectFirst(e)))}updateCacheFromProfile(e){e&&(this.cache.profile=e,this.cache.builds=e.builds||{space:{keys:{}},ground:{keys:{}}},this.cache.keys=e.keys||{},this.cache.aliases=e.aliases||{})}async persistSelectionToProfile(e,t){if(this.cache.currentProfile&&t)try{const i={...this.cache.profile?.selections||{},[e]:t};await this.request("data:update-profile",{profileId:this.cache.currentProfile,updates:{properties:{selections:i}},updateSource:"SelectionService"})}catch(e){console.warn("[SelectionService] Failed to persist selection to profile:",e)}}getCurrentState(){return{selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,editingContext:this.editingContext,cachedSelections:{...this.cachedSelections},currentEnvironment:this.cache.currentEnvironment}}async handleInitialState(e,t){if(t&&"DataCoordinator"===e&&t.hasOwnProperty("currentProfileData")){const e=t.currentProfileData;if(!e)return this.cache.currentProfile=null,void(this.cachedSelections={space:null,ground:null,alias:null});this.cache.currentProfile=e.id,this.cache.currentEnvironment=e.environment||"space",this.updateCacheFromProfile(e),e.selections&&(e.selections.space&&(this.cachedSelections.space=e.selections.space,this.setCachedSelection("space",e.selections.space)),e.selections.ground&&(this.cachedSelections.ground=e.selections.ground,this.setCachedSelection("ground",e.selections.ground)),e.selections.alias&&(this.cachedSelections.alias=e.selections.alias,this.setCachedSelection("alias",e.selections.alias)));const i=this.getCachedSelection(this.cache.currentEnvironment);i&&("alias"===this.cache.currentEnvironment?(this.cache.selectedAlias=i,this.cache.selectedKey=null):(this.cache.selectedKey=i,this.cache.selectedAlias=null))}}onDestroy(){this.ae&&(this.ae.forEach(e=>{"function"==typeof e&&e()}),this.ae=[])}}class Xt extends lt{constructor({eventBus:e,document:t=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="HeaderToolbarUI",this.document=t}init(){super.init(),this.setupEventListeners(),this.updateBindsetButtonVisibility()}setupEventListeners(){this.addEventListener("preferences:changed",e=>{!e.changes||void 0===e.changes.bindsetsEnabled&&void 0===e.changes.bindToAliasMode||this.updateBindsetButtonVisibility()})}updateBindsetButtonVisibility(){try{const e=this.getPreference("bindToAliasMode",!1),t=this.getPreference("bindsetsEnabled",!1),i=this.document.getElementById("bindsetManagerBtn");if(console.log("[HeaderToolbarUI] updateBindsetButtonVisibility:",{aliasMode:e,bindsets:t,buttonFound:!!i,cacheExists:!!this.cache,preferencesCache:this.cache?.preferences,fullCache:this.cache}),i){const a=e&&t;i.style.display=a?"":"none";const n=i.closest(".toolbar-group");n&&(n.style.display=a?"":"none"),console.log("[HeaderToolbarUI] Button visibility updated:",{show:a})}else console.log("[HeaderToolbarUI] bindsetManagerBtn element not found in DOM")}catch(e){console.warn("[HeaderToolbarUI] Failed to update bindset button visibility:",e)}}handleInitialState(e,t){"PreferencesService"===e&&this.cache.preferences&&(console.log("[HeaderToolbarUI] Received preferences via ComponentBase, updating UI"),this.updateBindsetButtonVisibility())}getPreference(e,t=!1){return this.cache?.preferences?.[e]??t}}class Ht extends lt{constructor({eventBus:e,ui:t=null}={}){super(e),this.componentName="SyncUI",this.ui=t}init(){this.setupEventListeners()}setupEventListeners(){this.eventBus.on("sync:sync-now",()=>{this.performSync("manual")})}async performSync(e="manual"){this.ui?.showToast(Q.t("syncing"),"info"),await this.request("sync:sync-project",{source:e})}}class Zt{static newToOld(e){return e?{command:e.command,type:e.category,parameters:e.parameters||{},signature:e.signature,baseCommand:e.baseCommand,displayText:e.displayText,icon:e.icon,id:e.id}:null}static normalize(e){return e?e.signature&&e.category?this.newToOld(e):e.command&&e.type?{command:e.command,type:e.type,parameters:e.parameters||{},signature:e.signature,baseCommand:e.baseCommand,displayText:e.displayText||e.command,icon:e.icon||"âš™ï¸",id:e.id}:e:null}}class Jt extends oe{constructor({eventBus:e=c,dataService:t=null}={}){super(e),this.componentName="ParameterCommandService",this.editingContext=null,this.ae=[],this.eventBus&&this.ae.push(this.respond("parameter-command:build",async({categoryId:e,commandId:t,commandDef:i,params:a})=>this.buildParameterizedCommand(e,t,i,a)),this.respond("parameter-command:find-definition",({commandString:e})=>this.findCommandDefinition(e)),this.respond("parameter-command:generate-id",()=>this.generateCommandId()))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("environment:changed",e=>{const t="string"==typeof e?e:e.environment;t&&(this.cache.currentEnvironment=t)}),this.addEventListener("parameter-edit:start",e=>{this.editingContext={isEditing:!0,editIndex:e.index,existingCommand:e.command}}),this.addEventListener("parameter-edit:end",()=>{this.editingContext=null})}getCurrentState(){return{editingContext:this.editingContext}}onDestroy(){this.ae&&(this.ae.forEach(e=>{"function"==typeof e&&e()}),this.ae=[])}generateCommandId(){return`cmd_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}generateTrayRangeCommands(e,t,i,a,n,s=1){const r=[];if(t===a)for(let a=i;a<=n;a++)if(1!==s||e.startsWith("+"))if(1===s&&e.startsWith("+"))r.push(`${e} ${t} ${a}`);else{const i=e.replace(/^\+/,"");r.push(`${i} ${s} ${t} ${a}`)}else r.push(`+${e} ${t} ${a}`);else for(let o=t;o<=a;o++){let c,l;o===t?(c=i,l=9):o===a?(c=0,l=n):(c=0,l=9);for(let t=c;t<=l;t++)if(1!==s||e.startsWith("+"))if(1===s&&e.startsWith("+"))r.push(`${e} ${o} ${t}`);else{const i=e.replace(/^\+/,"");r.push(`${i} ${s} ${o} ${t}`)}else r.push(`+${e} ${o} ${t}`)}return r}generateWholeTrayCommands(e,t,i=1){const a=[];for(let n=0;n<=9;n++)if(1!==i||e.startsWith("+"))if(1===i&&e.startsWith("+"))a.push(`${e} ${t} ${n}`);else{const s=e.replace(/^\+/,"");a.push(`${s} ${i} ${t} ${n}`)}else a.push(`+${e} ${t} ${n}`);return a}generateTrayRangeWithBackupCommands(e,t,i,a,n,s,r,o,c){const l=[];if(t===a)for(let a=i;a<=n;a++){const n=r+(a-i);1===e?l.push(`+TrayExecByTrayWithBackup ${t} ${a} ${s} ${n}`):l.push(`TrayExecByTrayWithBackup ${e} ${t} ${a} ${s} ${n}`)}else{let d=0;for(let m=t;m<=a;m++){let h,u;m===t?(h=i,u=9):m===a?(h=0,u=n):(h=0,u=9);for(let t=h;t<=u;t++){const i=10*s+r+d,a=Math.floor(i/10),n=i%10;a<=o&&(a<o||n<=c)?1===e?l.push(`+TrayExecByTrayWithBackup ${m} ${t} ${a} ${n}`):l.push(`TrayExecByTrayWithBackup ${e} ${m} ${t} ${a} ${n}`):1===e?l.push(`+TrayExecByTrayWithBackup ${m} ${t} ${s} ${r}`):l.push(`TrayExecByTrayWithBackup ${e} ${m} ${t} ${s} ${r}`),d++}}}return l}generateWholeTrayWithBackupCommands(e,t,i){const a=[];for(let n=0;n<=9;n++)1===e?a.push(`+TrayExecByTrayWithBackup ${t} ${n} ${i} ${n}`):a.push(`TrayExecByTrayWithBackup ${e} ${t} ${n} ${i} ${n}`);return a}async parseCommandsToObjects(e){const t=e.map(async e=>{try{const t=await this.request("parser:parse-command-string",{commandString:e});if(t.commands&&t.commands.length>0)return t.commands[0]}catch(t){console.warn("Failed to parse command:",e,t)}return{command:e,category:"tray",displayText:e,id:this.generateCommandId(),parameters:{}}});return Promise.all(t)}async buildParameterizedCommand(e,t,i,a={}){const n={targeting:e=>"target"!==t&&"target_entity"!==t||!e.entityName?{command:"string"==typeof i.command?i.command:"Target",text:i.name}:{command:`Target "${e.entityName}"`,text:`Target: ${e.entityName}`},tray:async e=>{const a=e.tray||0,n=e.slot||0,s=void 0!==e.active?e.active:1;if("tray_with_backup"===t){const t=e.backup_tray||0,i=e.backup_slot||0;return 1===s?{command:`+TrayExecByTrayWithBackup ${a} ${n} ${t} ${i}`,text:`Execute Tray ${a+1} Slot ${n+1} (backup: Tray ${t+1} Slot ${i+1})`}:{command:`TrayExecByTrayWithBackup ${s} ${a} ${n} ${t} ${i}`,text:`Execute Tray ${a+1} Slot ${n+1} (backup: Tray ${t+1} Slot ${i+1})`}}if("tray_range"===t){const t=e.start_tray||0,a=e.start_slot||0,n=e.end_tray||0,r=e.end_slot||0;let o;if(i.baseCommand)o=i.baseCommand;else if(e.baseCommand)o=e.baseCommand;else{const t=e.command_type||"STOTrayExecByTray";o=1===s?`+${t}`:t}const c=this.generateTrayRangeCommands(o,t,a,n,r,s);return await this.parseCommandsToObjects(c)}if("tray_range_with_backup"===t){const t=e.start_tray||0,i=e.start_slot||0,a=e.end_tray||0,n=e.end_slot||0,r=e.backup_start_tray||0,o=e.backup_start_slot||0,c=e.backup_end_tray||0,l=e.backup_end_slot||0,d=this.generateTrayRangeWithBackupCommands(s,t,i,a,n,r,o,c,l);return await this.parseCommandsToObjects(d)}if("whole_tray"===t){let t;if(i.baseCommand)t=i.baseCommand;else if(e.baseCommand)t=e.baseCommand;else{const i=e.command_type||"STOTrayExecByTray";t=1===s?`+${i}`:i}const n=this.generateWholeTrayCommands(t,a,s);return await this.parseCommandsToObjects(n)}if("whole_tray_with_backup"===t){const t=e.backup_tray||0,i=this.generateWholeTrayWithBackupCommands(s,a,t);return await this.parseCommandsToObjects(i)}let r,o;return this.editingContext&&this.editingContext.isEditing,r=i.baseCommand?i.baseCommand.replace(/^\+/,""):e.baseCommand?e.baseCommand.replace(/^\+/,""):e.command_type?e.command_type:"STOTrayExecByTray",o=1===s?`+${r} ${a} ${n}`:`${r} ${s} ${a} ${n}`,{command:o,text:`Execute Tray ${a+1} Slot ${n+1}`,parameters:{active:s,tray:a,slot:n}}},movement:e=>{let a=i.command;return"throttle_adjust"===t&&void 0!==e.amount?a=`${a||"ThrottleAdjust"} ${e.amount}`:"throttle_set"===t&&void 0!==e.position&&(a=`${a||"ThrottleSet"} ${e.position}`),{command:a||i.name||"Movement Command",text:i.name}},camera:e=>{let a=i.command;return"cam_distance"===t&&void 0!==e.distance&&(a=`${a||"camdist"} ${e.distance}`),{command:a||i.name||"Camera Command",text:i.name}},custom:e=>{const t=e.rawCommand||"";if(!t.trim())throw new Error("please_enter_a_raw_command");return{command:t.trim(),text:`Custom: ${t.trim()}`,type:"custom",category:"custom"}},communication:e=>{const t=i&&i.command?i.command:"say",a=e.verb||t,n=e.message||"Message text here";return{command:`${a} "${n}"`,text:`${a}: "${n}"`}},vfx:e=>{if("vfx_exclusion"===t){const t=e.effects||"";return{command:`dynFxSetFXExlusionList ${t}`,text:`VFX Exclude: ${t}`}}if("vfx_exclusion_alias"===t){const t=e.aliasName||"";return{command:`dynFxSetFXExclusionList_${t}`,text:`VFX Alias: ${t}`}}return{command:i.command,text:i.name}},power:e=>{if("power_exec"===t){const t=e.powerName||"";return{command:`+power_exec ${t}`,text:`Power: ${t}`}}return{command:i.command,text:i.name}},combat:e=>({command:e.commandName||i.command,text:i.name}),system:e=>{let a=i.command;return"bind_save_file"!==t&&"bind_load_file"!==t||!e.filename?"combat_log"===t&&void 0!==e.state?a=`${a||"CombatLog"} ${e.state}`:"ui_remember_positions"===t&&void 0!==e.state?a=`${a||"UIRememberPositions"} ${e.state}`:"chat_log"===t&&void 0!==e.state?a=`${a||"ChatLog"} ${e.state}`:"autofire_set"===t&&void 0!==e.state?a=`${a||"defaultautoattack"} ${e.state}`:"ui_tooltip_delay"===t&&void 0!==e.seconds?a=`${a||"ui_TooltipDelay"} ${e.seconds}`:"remember_ui_lists"===t&&void 0!==e.state?a=`${a||"RememberUILists"} ${e.state}`:"safe_login"===t&&void 0!==e.state?a=`${a||"SafeLogin"} ${e.state}`:"net_timing_graph"===t&&void 0!==e.state?a=`${a||"netTimingGraph"} ${e.state}`:"net_timing_graph_alpha"===t&&void 0!==e.alpha?a=`${a||"netTimingGraphAlpha"} ${e.alpha}`:"net_timing_graph_paused"===t&&void 0!==e.state?a=`${a||"netTimingGraphPaused"} ${e.state}`:"netgraph"===t&&void 0!==e.state?a=`${a||"netgraph"} ${e.state}`:"ui_load_file"===t&&e.filename?a=`${a||"ui_load_file"} ${e.filename}`:"ui_save_file"===t&&e.filename&&(a=`${a||"ui_save_file"} ${e.filename}`):a=`${a||("bind_save_file"===t?"bind_save_file":"bind_load_file")} ${e.filename}`,{command:a||i.name||"System Command",text:i.name}},alias:e=>{const t=e.alias_name?.trim()||"";return t?{command:t,text:`Alias: ${t}`}:null},bridge_officer:e=>"assist"===t&&e.name?{command:`Assist "${e.name}"`,text:`Assist: ${e.name}`}:"assist"===t?{command:"Assist",text:"Assist Current Target"}:{command:i.command,text:i.name},cosmetic:e=>"setactivecostume"===t&&e.modifier1&&e.modifier2?{command:`${i.command} ${e.modifier1} ${e.modifier2}`,text:`Set Costume: ${e.modifier1} ${e.modifier2}`}:{command:i.command,text:i.name}}[e];if(!n)return null;const s=await n(a);return s?Array.isArray(s)?s:{command:s.command,type:e,icon:i.icon,displayText:s.text,id:this.generateCommandId(),parameters:s.parameters||a}:null}async findCommandDefinition(e){try{const t=Zt.normalize(e);if(!t)return null;const i=await this.request("parser:parse-command-string",{commandString:t.command});if(!i?.commands?.[0])return null;const a=i.commands[0],n=At(a.signature);return n&&function(e){const t=At(e);return!!t&&Object.values(t.parameters||{}).some(e=>"hidden"!==e.type)}(a.signature)?{commandId:n.commandId,categoryId:n.category,name:n.name,description:n.description,icon:n.icon,category:n.category,parameters:n.parameters,signature:a.signature,baseCommand:a.baseCommand,extractedParameters:a.parameters,...a.parameters}:null}catch(e){return console.warn("[ParameterCommandService] Error finding command definition:",e),null}}}class Yt{constructor({i18n:e}={}){this.i18n=e,this.store=mt,this.eventListeners=new Map,this.autoSyncManager=null,this.dataService=null,this.profileUI=null,this.aliasService=null,this.aliasUI=null,this.commandService=null,this.commandLibraryService=null,this.keyBrowserService=null,this.keyBrowserUI=null,this.commandUI=null,this.keyService=null,this.fileOperationsService=null,this.keyCaptureService=null,this.keyCaptureUI=null,this.importUI=null,this.confirmDialogUI=null,this.inputDialogUI=null,this.projectManagementService=null}get currentMode(){return this.interfaceModeService?this.interfaceModeService.currentMode:this.store?.currentMode}set currentMode(e){this.store&&(this.store.currentMode=e),this.interfaceModeService&&(this.interfaceModeService.currentMode=e)}get undoStack(){return(this&&this.store?this.store:mt).undoStack}set undoStack(e){(this&&this.store?this.store:mt).undoStack=e}get redoStack(){return(this&&this.store?this.store:mt).redoStack}set redoStack(e){(this&&this.store?this.store:mt).redoStack=e}get maxUndoSteps(){return(this&&this.store?this.store:mt).maxUndoSteps}set maxUndoSteps(e){(this&&this.store?this.store:mt).maxUndoSteps=e}get commandIdCounter(){return(this&&this.store?this.store:mt).commandIdCounter}set commandIdCounter(e){(this&&this.store?this.store:mt).commandIdCounter=e}async init(){try{if("undefined"==typeof storageService||"undefined"==typeof stoUI)throw new Error("Required dependencies not loaded");this.modalManagerService=new ze({eventBus:c,i18n:this.i18n}),this.modalManagerService.init();const e=this.modalManagerService;if(this.stoCommandParser=new Bt(c),window.stoCommandParser=this.stoCommandParser,this.dataService=window.dataService,!this.dataService)throw new Error("DataService not available - it should be initialized in main.js before app.init()");this.selectionService=new Wt({eventBus:c}),this.selectionService.init(),this.confirmDialogUI=new _t({eventBus:c,modalManager:e,i18n:this.i18n}),this.inputDialogUI=new gt({eventBus:c,modalManager:e,i18n:this.i18n}),window.confirmDialog=this.confirmDialogUI,window.inputDialog=this.inputDialogUI;try{this.profileUI=new ht({eventBus:c,ui:stoUI,modalManager:e,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n})}catch(e){throw e}this.aliasService=new Gt({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),await this.aliasService.init(),this.aliasBrowserService=new Ot({storage:storageService,ui:stoUI,eventBus:c}),this.aliasBrowserUI=new Lt({eventBus:c,modalManager:e,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n}),this.keyBrowserService=new qt({eventBus:c,i18n:this.i18n,storage:storageService,profileService:this.profileService,ui:stoUI}),this.keyBrowserUI=new $t({service:this.keyBrowserService,eventBus:c,document:document,modalManager:e,confirmDialog:this.confirmDialogUI,i18n:this.i18n}),this.keyService=new Fe({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.keyService.init(),this.importService=new Me({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.importService.init(),this.exportService=new De({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.exportService.init(),this.keyCaptureService=new je({eventBus:c,i18n:this.i18n}),this.keyCaptureService.init(),this.keyCaptureUI=new Tt({eventBus:c,modalManager:e,document:document,i18n:this.i18n}),this.keyCaptureUI.init(),this.commandService=new Ce({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.commandService.init(),this.commandLibraryService=new ue({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI,modalManager:e}),this.commandLibraryUI=new pt({service:this.commandLibraryService,eventBus:c,ui:stoUI,modalManager:e,document:document,i18n:this.i18n}),this.commandChainService=new Rt({eventBus:c,i18n:this.i18n}),this.commandChainUI=new Ut({eventBus:c,ui:stoUI,document:document,i18n:this.i18n}),this.parameterCommandService=new Jt({eventBus:c}),this.parameterCommandUI=new ut({eventBus:c,modalManager:e,i18n:this.i18n,ui:stoUI}),this.commandUI=new ft({eventBus:c,ui:stoUI,modalManager:e,parameterCommandUI:this.parameterCommandUI,confirmDialog:this.confirmDialogUI,i18n:this.i18n}),this.headerMenuUI=new Kt({eventBus:c,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n}),this.headerToolbarUI=new Xt({eventBus:c,document:document,i18n:this.i18n}),this.syncUI=new Ht({eventBus:c,ui:stoUI}),this.aboutModalUI=new jt({eventBus:c,document:document,i18n:this.i18n}),this.interfaceModeService=new $e({eventBus:c,storage:storageService,profileService:this.profileService,app:this}),this.interfaceModeUI=new yt({eventBus:c,ui:stoUI,profileUI:this.profileUI,document:document,i18n:this.i18n}),this.vfxManagerService=new Oe(c,this.i18n),this.vfxManagerUI=new Ct({eventBus:c,modalManager:e,i18n:this.i18n}),this.vfxManagerService.init(),this.vfxManagerUI.init(),this.preferencesService=new ce({storage:storageService,eventBus:c,ui:stoUI,i18n:this.i18n}),this.preferencesUI=new Vt({eventBus:c,service:this.preferencesService,ui:stoUI}),this.preferencesManager=this.preferencesUI,this.preferencesService.init(),this.preferencesUI.init(),window.stoAliases=this.aliasBrowserUI,this.aliasBrowserService.init(),this.aliasBrowserUI.init(),this.commandLibraryService.init(),this.commandLibraryUI.init(),this.commandChainService.init(),this.commandChainUI.init(),this.keyBrowserService.init(),this.keyBrowserUI.init(),this.parameterCommandService.init(),this.commandUI.init(),this.parameterCommandUI.init(),this.autoSyncManager=new me({eventBus:c,storage:storageService,syncManager:window.stoSync,ui:stoUI}),this.autoSyncManager.init(),this.profileUI.init();try{this.interfaceModeService.init()}catch(e){throw e}try{this.headerMenuUI.init()}catch(e){throw e}try{this.headerToolbarUI.init()}catch(e){throw e}try{this.syncUI.init()}catch(e){throw e}try{this.aboutModalUI.init()}catch(e){throw e}try{this.interfaceModeUI.init()}catch(e){throw e}this.profileUI.renderProfiles(),this.profileUI.updateProfileInfo(),this.checkAndShowWelcomeMessage(),stoUI.showToast(this.i18n.t("sto_tools_keybind_manager_loaded_successfully"),"success"),this.initialized=!0,c.emit("sto-app-ready",{app:this}),window.commandChainUI=this.commandChainUI,window.keyBrowserUI=this.keyBrowserUI,window.keyBrowserService=this.keyBrowserService,this.projectManagementService=new de({storage:storageService,ui:stoUI,app:this,eventBus:c,i18n:this.i18n}),this.projectManagementService.init(),this.importUI=new zt({eventBus:c,document:document,i18n:this.i18n,modalManager:this.modalManagerService}),this.importUI.init();const{default:t}=await Promise.resolve().then(function(){return ii}),{default:i}=await Promise.resolve().then(function(){return ai}),{default:a}=await Promise.resolve().then(function(){return ni}),{default:n}=await Promise.resolve().then(function(){return si});this.bindsetService=new t({eventBus:c}),this.bindsetManagerUI=new i({eventBus:c,i18n:this.i18n,confirmDialog:this.confirmDialogUI,inputDialog:this.inputDialogUI}),this.bindsetService.init(),this.bindsetManagerUI.init(),this.bindsetSelectorService=new a({eventBus:c}),this.bindsetSelectorUI=new n({eventBus:c,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n}),this.bindsetSelectorService.init(),this.bindsetSelectorUI.init()}catch(e){throw"undefined"!=typeof stoUI&&stoUI.showToast&&stoUI.showToast(this.i18n.t("failed_to_load_application"),"error"),c.emit("sto-app-error",{error:e}),e}}generateCommandId(){return`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}isFirstTime(){return!localStorage.getItem("sto_keybind_manager_visited")}checkAndShowWelcomeMessage(){this.isFirstTime()&&(localStorage.setItem("sto_keybind_manager_visited","true"),this.modalManagerService.show("aboutModal"))}}const Qt=new class{constructor(){this.isEnabled=!1,this.i18nTracking=!1,this.cssTracking=!1,this.i18nStats={usedKeys:new Set,missingKeys:new Set,keyUsageCount:new Map,lastUsed:new Map},this.cssStats={usedSelectors:new Set,unusedSelectors:new Set,selectorUsageCount:new Map,lastChecked:null},this.originalI18nT=null,this.originalI18nExists=null,this.cssCheckInterval=null,this.isDevelopment=this.checkDevelopmentMode()}checkDevelopmentMode(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||"file:"===window.location.protocol||window.location.search.includes("dev=true")||"true"===localStorage.getItem("dev-mode")}enableI18nTracking(){if(!this.isDevelopment)return console.warn("DevMonitor: I18n tracking only available in development mode"),!1;if(this.i18nTracking)return console.log("DevMonitor: I18n tracking already enabled"),!0;if(!window.i18next)return console.error("DevMonitor: i18next not found"),!1;if(console.log("DevMonitor: Enabling i18n tracking..."),this.originalI18nT=window.i18next.t.bind(window.i18next),this.originalI18nExists=window.i18next.exists.bind(window.i18next),window.i18next.t=(e,t)=>(this.trackI18nUsage(e,t),this.originalI18nT(e,t)),window.applyTranslations){const e=window.applyTranslations;window.applyTranslations=t=>((t||document).querySelectorAll("[data-i18n], [data-i18n-placeholder], [data-i18n-title], [data-i18n-alt]").forEach(e=>{const t=e.getAttribute("data-i18n")||e.getAttribute("data-i18n-placeholder")||e.getAttribute("data-i18n-title")||e.getAttribute("data-i18n-alt");t&&this.trackI18nUsage(t)}),e(t))}return this.i18nTracking=!0,this.isEnabled=!0,console.log("DevMonitor: I18n tracking enabled"),!0}trackI18nUsage(e,t={}){const i="string"==typeof e?e:String(e),a=Date.now();this.i18nStats.usedKeys.add(i),this.i18nStats.keyUsageCount.set(i,(this.i18nStats.keyUsageCount.get(i)||0)+1),this.i18nStats.lastUsed.set(i,a),this.originalI18nExists&&!this.originalI18nExists(i)&&this.i18nStats.missingKeys.add(i)}enableCSSTracking(){return this.isDevelopment?this.cssTracking?(console.log("DevMonitor: CSS tracking already enabled"),!0):(console.log("DevMonitor: Enabling CSS tracking..."),this.cssCheckInterval=setInterval(()=>{this.checkCSSUsage()},2e3),this.cssTracking=!0,this.isEnabled=!0,console.log("DevMonitor: CSS tracking enabled (checking every 2 seconds)"),!0):(console.warn("DevMonitor: CSS tracking only available in development mode"),!1)}checkCSSUsage(){const e=Date.now(),t=Array.from(document.styleSheets);console.log(`[DevMonitor] Checking ${t.length} stylesheets...`),t.forEach((e,t)=>{try{if(console.log(`[DevMonitor] Sheet ${t}:`,{href:e.href,origin:window.location.origin,canAccess:!!e.cssRules||!!e.rules}),e.href&&!e.href.includes(window.location.origin)&&!e.href.startsWith("file://"))return void console.log(`[DevMonitor] Skipping external stylesheet: ${e.href}`);const i=Array.from(e.cssRules||e.rules||[]);console.log(`[DevMonitor] Found ${i.length} rules in sheet ${t}`),i.forEach((e,t)=>{if(e.type===CSSRule.STYLE_RULE){const t=e.selectorText;if(!t)return;try{document.querySelectorAll(t).length>0?(this.cssStats.usedSelectors.add(t),this.cssStats.selectorUsageCount.set(t,(this.cssStats.selectorUsageCount.get(t)||0)+1),this.cssStats.unusedSelectors.delete(t)):this.cssStats.usedSelectors.has(t)||this.cssStats.unusedSelectors.add(t)}catch(e){console.warn(`[DevMonitor] Invalid selector "${t}":`,e.message)}}})}catch(e){console.warn(`[DevMonitor] Can't access stylesheet ${t}:`,e.message)}}),this.cssStats.lastChecked=e,console.log("[DevMonitor] CSS check complete:",{usedSelectors:this.cssStats.usedSelectors.size,unusedSelectors:this.cssStats.unusedSelectors.size})}getI18nStats(){if(!this.i18nTracking)return console.warn("DevMonitor: I18n tracking not enabled"),null;return{summary:{totalKeysUsed:this.i18nStats.usedKeys.size,totalKeysMissing:this.i18nStats.missingKeys.size,totalUsages:Array.from(this.i18nStats.keyUsageCount.values()).reduce((e,t)=>e+t,0)},usedKeys:Array.from(this.i18nStats.usedKeys).sort(),missingKeys:Array.from(this.i18nStats.missingKeys).sort(),keyUsageCount:Object.fromEntries(Array.from(this.i18nStats.keyUsageCount.entries()).sort((e,t)=>t[1]-e[1])),mostUsedKeys:Array.from(this.i18nStats.keyUsageCount.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e,t])=>({key:e,count:t})),recentlyUsed:Array.from(this.i18nStats.lastUsed.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e,t])=>({key:e,lastUsed:new Date(t).toISOString()}))}}getCSSStats(){return this.cssTracking?{summary:{totalSelectorsUsed:this.cssStats.usedSelectors.size,totalSelectorsUnused:this.cssStats.unusedSelectors.size,lastChecked:this.cssStats.lastChecked?new Date(this.cssStats.lastChecked).toISOString():null},usedSelectors:Array.from(this.cssStats.usedSelectors).sort(),unusedSelectors:Array.from(this.cssStats.unusedSelectors).sort(),selectorUsageCount:Object.fromEntries(Array.from(this.cssStats.selectorUsageCount.entries()).sort((e,t)=>t[1]-e[1])),mostUsedSelectors:Array.from(this.cssStats.selectorUsageCount.entries()).sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({selector:e,count:t}))}:(console.warn("DevMonitor: CSS tracking not enabled"),null)}exportI18nStats(){const e=this.getI18nStats();if(!e)return null;const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),a=document.createElement("a");return a.href=i,a.download=`i18n-stats-${(new Date).toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(i),console.log("DevMonitor: I18n stats exported"),e}exportCSSStats(){const e=this.getCSSStats();if(!e)return null;const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),a=document.createElement("a");return a.href=i,a.download=`css-stats-${(new Date).toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(i),console.log("DevMonitor: CSS stats exported"),e}generateCSSCleanupScript(){const e=this.getCSSStats();if(!e)return null;const t=`\n// Auto-generated CSS cleanup script\n// Remove unused selectors (review before applying!)\n\n/*\nUNUSED SELECTORS (${e.unusedSelectors.length} total):\n${e.unusedSelectors.map(e=>`- ${e}`).join("\n")}\n*/\n\n// Most used selectors to keep:\n${e.mostUsedSelectors.map(({selector:e,count:t})=>`/* ${e} (used ${t} times) */`).join("\n")}\n`,i=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(i),n=document.createElement("a");return n.href=a,n.download=`css-cleanup-${(new Date).toISOString().split("T")[0]}.txt`,n.click(),URL.revokeObjectURL(a),console.log("DevMonitor: CSS cleanup script generated"),t}clearStats(){this.i18nStats={usedKeys:new Set,missingKeys:new Set,keyUsageCount:new Map,lastUsed:new Map},this.cssStats={usedSelectors:new Set,unusedSelectors:new Set,selectorUsageCount:new Map,lastChecked:null},console.log("DevMonitor: All stats cleared")}disableI18nTracking(){this.i18nTracking&&(this.originalI18nT&&window.i18next&&(window.i18next.t=this.originalI18nT),this.i18nTracking=!1,console.log("DevMonitor: I18n tracking disabled"))}disableCSSTracking(){this.cssTracking&&(this.cssCheckInterval&&(clearInterval(this.cssCheckInterval),this.cssCheckInterval=null),this.cssTracking=!1,console.log("DevMonitor: CSS tracking disabled"))}disableAll(){this.disableI18nTracking(),this.disableCSSTracking(),this.isEnabled=!1,console.log("DevMonitor: All tracking disabled")}checkCSSNow(){return this.isDevelopment?(console.log("DevMonitor: Running manual CSS check..."),this.checkCSSUsage(),this.getCSSStats()):(console.warn("DevMonitor: CSS checking only available in development mode"),!1)}getStatus(){return{isEnabled:this.isEnabled,isDevelopment:this.isDevelopment,i18nTracking:this.i18nTracking,cssTracking:this.cssTracking,i18nStatsCount:this.i18nStats.usedKeys.size,cssStatsCount:this.cssStats.usedSelectors.size}}};Qt.isDevelopment&&(window.devMonitor=Qt,console.log("\nğŸ”§ DevMonitor loaded! Available commands:\n- devMonitor.enableI18nTracking()    // Start tracking i18n usage\n- devMonitor.enableCSSTracking()     // Start tracking CSS usage  \n- devMonitor.getI18nStats()          // Get i18n usage statistics\n- devMonitor.getCSSStats()           // Get CSS usage statistics\n- devMonitor.checkCSSNow()           // Run CSS check immediately (debug)\n- devMonitor.exportI18nStats()       // Download i18n stats as JSON\n- devMonitor.exportCSSStats()        // Download CSS stats as JSON\n- devMonitor.generateCSSCleanupScript() // Generate CSS cleanup script\n- devMonitor.clearStats()            // Clear all tracking data\n- devMonitor.disableAll()            // Disable all tracking\n- devMonitor.getStatus()             // Get current status\n  "));const ei=new class extends oe{constructor({eventBus:e,data:t=null}={}){super(e),this.componentName="DataService",this.data=t||{},this.responseHandlers=[]}onInit(){this.responseHandlers.push(this.respond("data:get-commands",()=>this.data.commands||{})),this.responseHandlers.push(this.respond("data:get-command-category",({categoryId:e})=>this.data.commands?.[e]||null)),this.responseHandlers.push(this.respond("data:get-command-definition",({categoryId:e,commandId:t})=>this.data.commands?.[e]?.commands?.[t]||null)),this.responseHandlers.push(this.respond("data:find-command-by-name",({command:e})=>{if(!this.data.commands||!e)return null;for(const[t,i]of Object.entries(this.data.commands))if(i.commands)for(const[a,n]of Object.entries(i.commands))if(n.command===e)return{...n,categoryId:t,commandId:a};return null})),this.responseHandlers.push(this.respond("data:get-validation-patterns",()=>this.data.validation||{})),this.responseHandlers.push(this.respond("data:get-key-name-pattern",()=>this.data.validation?.keyNamePattern||"USE_STO_KEY_NAMES")),this.responseHandlers.push(this.respond("data:get-alias-name-pattern",()=>this.data.validation?.aliasNamePattern||/^[A-Za-z0-9_]+$/)),this.responseHandlers.push(this.respond("data:has-commands",()=>!(!this.data||!this.data.commands))),this.responseHandlers.push(this.respond("data:get-tray-category",()=>this.data.commands?.tray||null)),this.responseHandlers.push(this.respond("data:get-communication-category",()=>this.data.commands?.communication||null)),this.responseHandlers.push(this.respond("data:get-combat-category",()=>this.data.commands?.combat||null)),this.responseHandlers.push(this.respond("data:get-default-profiles",()=>this.data.defaultProfiles||{})),this.responseHandlers.push(this.respond("data:get-default-profile",({profileId:e})=>this.data.defaultProfiles?.[e]||null))}onDestroy(){this.responseHandlers.forEach(e=>{"function"==typeof e&&e()}),this.responseHandlers=[]}getCurrentState(){return{defaultProfiles:this.data.defaultProfiles||{},hasCommands:!(!this.data||!this.data.commands),dataAvailable:Object.keys(this.data).length>0}}}({eventBus:c,data:"undefined"!=typeof globalThis?globalThis.STO_DATA:null});(async()=>{await Q.init({lng:"en",fallbackLng:"en",resources:{en:{translation:ee},de:{translation:te},fr:{translation:ie},es:{translation:ae}}}),window.i18next=Q;const t=new he({eventBus:c,i18n:Q});t.init(),ei.init();const i=new Qe({eventBus:c,storage:t,i18n:Q});i.init();const a=t.getSettings();function n(e=document){e.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n"),i=e.getAttribute("data-i18n-attr");if(!t)return;const a=Q.t(t);i?e.setAttribute(i,a):e.textContent=a}),e.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const t=e.getAttribute("data-i18n-placeholder");t&&e.setAttribute("placeholder",Q.t(t))}),e.querySelectorAll("[data-i18n-title]").forEach(e=>{const t=e.getAttribute("data-i18n-title");t&&e.setAttribute("title",Q.t(t))}),e.querySelectorAll("[data-i18n-alt]").forEach(e=>{const t=e.getAttribute("data-i18n-alt");t&&e.setAttribute("alt",Q.t(t))})}function s(){n();const t=document.getElementById("appVersion");t&&(t.textContent=e)}a.language&&"en"!==a.language&&await Q.changeLanguage(a.language),Qt.isDevelopment&&console.log("ğŸ”§ DevMonitor: Development mode detected, monitoring tools available"),window.localizeCommandData&&window.localizeCommandData(),window.applyTranslations=n,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s();const r=new Fe,o=new Ke(c);new Le({eventBus:c});const l={showToast:(e,t="info")=>c.emit("toast:show",{message:e,type:t}),confirm:(e,t)=>c.emit("confirm:show",{message:e,callback:t}),showModal:e=>c.emit("modal:show",{modalId:e}),hideModal:e=>c.emit("modal:hide",{modalId:e}),copyToClipboard:e=>c.emit("ui:copy-to-clipboard",{text:e}),initDragAndDrop:(e,t={})=>{o&&"function"==typeof o.initDragAndDrop?o.initDragAndDrop(e,t):c.emit("ui:init-drag-drop",{container:e,options:t})}};new ct({eventBus:c,i18n:Q,ui:l}).init();const d=new dt({eventBus:c,storage:t,ui:l,i18n:Q});d.init();const m=new Ie({eventBus:c,storage:t,ui:l,i18n:Q});Object.assign(window,{storageService:t,dataService:ei,dataCoordinator:i,stoKeybinds:r,stoUI:l,stoFileExplorer:d,stoSync:m,eventBus:c});const h=new Yt({i18n:Q});if("function"!=typeof h.init)console.error("app.init is not a function!");else try{const e=h.init();e&&"function"==typeof e.catch?await e:console.log("TEST: app.init() did not return a Promise")}catch(e){console.log("TEST: app.init() failed:",e)}c.on("sto-app-ready",()=>{r.init(),d.isInitialized()||d.init(),console.log("=== Settings Button Debug ===");const e=document.getElementById("settingsBtn"),t=document.getElementById("settingsMenu"),i=document.getElementById("preferencesBtn");console.log("1. Elements exist check:"),console.log("- settingsBtn:",!!e),console.log("- settingsMenu:",!!t),console.log("- preferencesBtn:",!!i),e&&(console.log("\n2. Settings Button properties:"),console.log("- tagName:",e.tagName),console.log("- className:",e.className),console.log("- parent dropdown:",e.closest(".dropdown")?.className),console.log("\n3. Event Listeners:"),console.log("- Has onclick:",!!e.onclick),console.log("- Has click listeners:",!!e.ze),console.log("\n4. Event-based architecture check:"),console.log("- eventBus exists:",!!window.eventBus),console.log("- Settings managed by HeaderMenuUI via events")),t&&(console.log("\n5. Settings Menu properties:"),console.log("- display:",t.style.display),console.log("- visibility:",t.style.visibility),console.log("- parent dropdown active:",e?.closest(".dropdown")?.classList.contains("active")))})})();var ti=Object.freeze({__proto__:null,STO_KEY_NAMES:["[","\\","]","Add","ALT","LALT","RALT","Down","Left","Right","Up",",","Control","LCTRL","RCTRL","delete","/","End","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","Home","insert","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","enter","Button1","Button2","Button3","Button4","Button5","Button6","Button7","Button8","Button9","Button10","Lbutton","Rbutton","Middleclick","Wheelminus","Wheelplus","Multiply","0","1","2","3","4","5","6","7","8","9","numpad0","numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9","Decimal","Divide","numpadenter","Subtract","Add","PageDown","PageUp",".","Shift","LSHIFT","RSHIFT","Space","Tab","`","Joy1","Joy2","Joy3","Joy4","Joy5","Joy6","Joy7","Joy8","Joy9","Joy10","Joy11","Joy12","Lstick_down","Lstick_left","Lstick_right","Lstick_up","Rstick_down","Rstick_left","Rstick_right","Rstick_up","Joypad_down","Joypad_left","Joypad_right","Joypad_up"]}),ii=Object.freeze({__proto__:null,default:class extends oe{constructor({eventBus:e}={}){super(e),this.componentName="BindsetService",this.eventBus&&(this.respond("bindset:create",({name:e})=>this.createBindset(e)),this.respond("bindset:rename",({oldName:e,newName:t})=>this.renameBindset(e,t)),this.respond("bindset:delete",({name:e})=>this.deleteBindset(e)),this.respond("bindset:get-key-commands",({bindset:e,environment:t,key:i})=>this.getKeyCommands(e,t,i))),this.setupEventListeners()}getCurrentState(){return{bindsets:[...this.cache.bindsetNames]}}onInit(){console.log("[BindsetService] Initializing..."),console.log("[BindsetService] Initialized successfully")}handleInitialState(e,t){console.log("[BindsetService] handleInitialState called:",e,!!t),"DataCoordinator"===e&&t?.currentProfileData&&(console.log("[BindsetService] Received initial profile data from DataCoordinator"),this.updateCacheFromProfile(t.currentProfileData))}setupEventListeners(){this.Oe||(this.Oe=!0,this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profile:e})=>{this.updateCacheFromProfile(e)}))}updateCacheFromProfile(e){console.log("[BindsetService] updateCacheFromProfile: profile =",e,"id =",e&&e.id),e&&(!e.id&&this.cache.currentProfile&&(e.id=this.cache.currentProfile),this.cache.bindsetNames=["Primary Bindset",...Object.keys(e.bindsets||{})],this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}))}async getProfile(){if(this.cache.profile)return this.cache.profile;const e=await this.request("data:get-current-state").catch(()=>null),t=e?.currentProfileData||null;return t&&this.updateCacheFromProfile(t),t}async createBindset(e){if(!e||"Primary Bindset"===e)return{success:!1,error:"invalid_name"};const t=await this.getProfile();if(console.log("[BindsetService] createBindset: profile =",t,"id =",t&&t.id),!t||!t.id)return console.error("[BindsetService] createBindset: no_profile error, profile:",t),{success:!1,error:"no_profile"};if(t.bindsets&&t.bindsets[e])return{success:!1,error:"name_exists"};const i={add:{bindsets:{[e]:{space:{keys:{}},ground:{keys:{}}}}}},a=await this.request("data:update-profile",{profileId:t.id,updates:i});return a?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),a}async renameBindset(e,t){if(!e||!t||"Primary Bindset"===e||"Primary Bindset"===t)return{success:!1,error:"invalid_name"};const i=await this.getProfile();if(!i.bindsets||!i.bindsets[e])return{success:!1,error:"not_found"};if(i.bindsets[t])return{success:!1,error:"name_exists"};const a=i.bindsets[e],n={add:{bindsets:{[t]:a}},delete:{bindsets:[e]}},s=await this.request("data:update-profile",{profileId:i.id,updates:n});return s?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),s}async deleteBindset(e){if(!e||"Primary Bindset"===e)return{success:!1,error:"invalid_name"};const t=await this.getProfile(),i=t.bindsets?.[e];if(!i)return{success:!1,error:"not_found"};const a=e=>i?.[e]?.keys&&Object.keys(i[e].keys).length>0;if(a("space")||a("ground"))return{success:!1,error:"not_empty"};const n={delete:{bindsets:[e]}},s=await this.request("data:update-profile",{profileId:t.id,updates:n});return s?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),s}async getKeyCommands(e,t="space",i){if(console.log(`[BindsetService] *** getKeyCommands called: bindset=${e}, environment=${t}, key=${i} ***`),!i)return console.log("[BindsetService] *** No key provided, returning empty array ***"),[];console.log("[BindsetService] *** Requesting data:get-current-state ***");const a=await this.request("data:get-current-state").catch(e=>(console.error("[BindsetService] *** Failed to get current state: ***",e),null)),n=a?.currentProfile,s=n&&a?.profiles?a.profiles[n]:null;if(console.log(`[BindsetService] *** Profile data retrieved: profileId=${n}, hasProfile=${!!s} ***`),!s)return console.log("[BindsetService] *** No profile data, returning empty array ***"),[];if(!e||"Primary Bindset"===e){const e=s.builds?.[t]?.keys?.[i]||[];return console.log(`[BindsetService] *** Primary bindset commands for key ${i}:`,e),Array.isArray(e)?[...e]:[]}const r=s.bindsets?.[e]?.[t]?.keys?.[i]||[];return console.log(`[BindsetService] *** Bindset "${e}" commands for key ${i}:`,r),Array.isArray(r)?[...r]:[]}}}),ai=Object.freeze({__proto__:null,default:class extends lt{constructor({eventBus:e,i18n:t,confirmDialog:i=null,inputDialog:a=null,document:n=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="BindsetManagerUI",this.i18n=t,this.document=n,this.confirmDialog=i||("undefined"!=typeof window?window.confirmDialog:null),this.inputDialog=a||("undefined"!=typeof window?window.inputDialog:null),this.selectedBindset=null}async onInit(){this.setupEventListeners(),this.render(),this.eventBus.on("bindsets:changed",()=>{this.render()})}setupEventListeners(){this.listenersSetup||(this.listenersSetup=!0,this.onDom("bindsetManagerBtn","click","bindset-manager-open",()=>{this.render(),this.emit("modal:show",{modalId:"bindsetManagerModal"})}),this.onDom("createBindsetBtn","click","bindset-create",async()=>{if(!this.inputDialog)return;const e=this.i18n.t("create_bindset"),t=this.i18n.t("enter_bindset_name"),i=await this.inputDialog.prompt(t,{title:e,placeholder:this.i18n.t("bindset_name"),validate:e=>{const t=e.trim();return t?!this.cache.bindsetNames.includes(t)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!i?.trim())return;const a=await this.request("bindset:create",{name:i.trim()});a?.success||this.showError(a.error)}),this.onDom("renameBindsetBtn","click","bindset-rename",async()=>{if(!this.selectedBindset||!this.inputDialog)return;const e=this.i18n.t("rename_bindset"),t=this.i18n.t("enter_new_name"),i=await this.inputDialog.prompt(t,{title:e,defaultValue:this.selectedBindset,placeholder:this.i18n.t("bindset_name"),validate:e=>{const t=e.trim();return t?t===this.selectedBindset?this.i18n.t("name_unchanged"):!this.cache.bindsetNames.includes(t)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!i?.trim()||i.trim()===this.selectedBindset)return;const a=await this.request("bindset:rename",{oldName:this.selectedBindset,newName:i.trim()});a?.success||this.showError(a.error)}),this.onDom("deleteBindsetBtn","click","bindset-delete",async()=>{if(!this.selectedBindset||!this.confirmDialog)return;const e=this.i18n.t("confirm_delete_bindset",{name:this.selectedBindset}),t=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(e,t,"danger","bindsetDelete")){const e=await this.request("bindset:delete",{name:this.selectedBindset});e?.success||this.showError(e.error)}}))}showError(e){const t={invalid_name:"invalid_name",name_exists:"bindset_name_in_use",not_found:"not_found",not_empty:"bindset_not_empty"}[e]||"error",i=this.document.getElementById("bindsetError");i&&(i.textContent=this.i18n.t(t),i.style.display="",setTimeout(()=>{i.style.display="none"},4e3))}async render(){const e=this.document.getElementById("bindsetList");if(!e)return;const t=this.cache.bindsetNames||[];e.innerHTML="",t.forEach(t=>{const i=this.document.createElement("li");i.textContent=t,i.className="bindset-item"+(t===this.selectedBindset?" selected":""),i.onclick=()=>{this.selectedBindset=t===this.selectedBindset?null:t,this.render()},e.appendChild(i)});const i=this.document.getElementById("renameBindsetBtn"),a=this.document.getElementById("deleteBindsetBtn"),n=this.selectedBindset&&"Primary Bindset"!==this.selectedBindset;i&&(i.disabled=!n),a&&(a.disabled=!n)}handleInitialState(e,t){t&&t.bindsets&&this.isInitialized()&&this.render()}}}),ni=Object.freeze({__proto__:null,default:class extends oe{constructor({eventBus:e}={}){super(e),this.componentName="BindsetSelectorService",this.keyBindsetMembership=new Map,this.eventBus&&(this.respond("bindset-selector:set-key",({key:e})=>this.setSelectedKey(e)),this.respond("bindset-selector:get-state",()=>this.getCurrentState()),this.respond("bindset-selector:add-key-to-bindset",({bindset:e})=>this.addKeyToBindset(e)),this.respond("bindset-selector:remove-key-from-bindset",({bindset:e})=>this.removeKeyFromBindset(e)),this.respond("bindset-selector:set-active-bindset",({bindset:e})=>this.setActiveBindset(e))),this.setupEventListeners()}async onInit(){console.log("[BindsetSelectorService] onInit called"),console.log("[BindsetSelectorService] Initial cache state:",this.cache),console.log("[BindsetSelectorService] Component name:",this.componentName),setTimeout(()=>{this.cache.profile||(console.warn("[BindsetSelectorService] No profile data received after 1 second - late-join sync may have failed"),console.log("[BindsetSelectorService] Current cache after timeout:",this.cache))},1e3)}setupEventListeners(){this.Oe||(this.Oe=!0,this.addEventListener("bindsets:changed",({names:e})=>{console.log("[BindsetSelectorService] bindsets:changed received:",e),this.updateKeyMembership()}),this.addEventListener("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};if(void 0!==t.bindsetsEnabled||void 0!==t.bindToAliasMode){console.log("[BindsetSelectorService] bindset preferences changed, updating visibility");const e=this.shouldDisplay();this.emit("bindset-selector:visibility-changed",{visible:e})}}),this.addEventListener("profile:switched",()=>{console.log("[BindsetSelectorService] profile:switched - updating key membership"),this.updateKeyMembership()}),this.addEventListener("profile:updated",({profileId:e})=>{console.log("[BindsetSelectorService] profile:updated - updating key membership"),e===this.cache.currentProfile&&this.updateKeyMembership()}),this.addEventListener("environment:changed",()=>{console.log("[BindsetSelectorService] environment:changed - updating key membership and visibility"),this.updateKeyMembership();const e=this.shouldDisplay();this.emit("bindset-selector:visibility-changed",{visible:e})}),this.addEventListener("key-selected",({key:e,name:t})=>{const i=e||t;console.log("[BindsetSelectorService] key-selected received:",i),i!==this.cache.selectedKey&&(this.updateKeyMembership(),"Primary Bindset"!==this.cache.activeBindset&&(console.log("[BindsetSelectorService] Resetting active bindset to Primary Bindset for new key selection"),this.setActiveBindset("Primary Bindset")))}))}setSelectedKey(e){this.updateKeyMembership()}setActiveBindset(e){console.log(`[BindsetSelectorService] setActiveBindset called: ${this.cache.activeBindset} -> ${e}`),console.log("[BindsetSelectorService] About to emit bindset-selector:active-changed with bindset:",e),this.emit("bindset-selector:active-changed",{bindset:e},{synchronous:!0}),console.log("[BindsetSelectorService] Successfully emitted bindset-selector:active-changed with bindset:",e)}async updateKeyMembership(){if(this.cache.selectedKey){this.keyBindsetMembership.clear();for(const e of this.cache.bindsetNames){const t=await this.keyExistsInBindset(e);this.keyBindsetMembership.set(e,t),console.log(`[BindsetSelectorService] updateKeyMembership: ${e} -> ${t} (key: ${this.cache.selectedKey})`)}this.emit("bindset-selector:membership-updated",{key:this.cache.selectedKey,membership:new Map(this.keyBindsetMembership)})}}async keyExistsInBindset(e){if(!this.cache.selectedKey)return console.log("[BindsetSelectorService] keyExistsInBindset early return: no selectedKey"),!1;if(!this.cache.profile)return console.log("[BindsetSelectorService] keyExistsInBindset early return: no profile data - cache:",this.cache),!1;try{if("Primary Bindset"===e){const e=this.cache.profile.builds?.[this.cache.currentEnvironment]?.keys?.[this.cache.selectedKey],t=void 0!==e&&Array.isArray(e);return console.log(`[BindsetSelectorService] Primary bindset check: ${this.cache.selectedKey} in ${this.cache.currentEnvironment} -> ${t}`,e),t}{const t=this.cache.profile.bindsets?.[e]?.[this.cache.currentEnvironment]?.keys?.[this.cache.selectedKey],i=void 0!==t&&Array.isArray(t);return console.log(`[BindsetSelectorService] ${e} bindset check: ${this.cache.selectedKey} in ${this.cache.currentEnvironment} -> ${i}`,t),i}}catch(e){return console.error("[BindsetSelectorService] Error checking key existence:",e),!1}}async addKeyToBindset(e){if(!this.cache.selectedKey||"Primary Bindset"===e)return{success:!1,error:"invalid_operation"};try{this.emit("bindset-operation:started",{type:"add-key",bindset:e,key:this.cache.selectedKey});const t=this.cache.profile;if(!t||!t.id)return{success:!1,error:"no_profile"};const i={modify:{bindsets:{[e]:{[this.cache.currentEnvironment]:{keys:{[this.cache.selectedKey]:[]}}}}}},a=await this.request("data:update-profile",{profileId:t.id,updates:i});return a?.success&&(this.keyBindsetMembership.set(e,!0),console.log(`[BindsetSelectorService] *** Switching to bindset ${e} immediately ***`),this.setActiveBindset(e),console.log(`[BindsetSelectorService] *** EMITTING bindset-selector:key-added: key=${this.cache.selectedKey}, bindset=${e} ***`),this.emit("bindset-selector:key-added",{key:this.cache.selectedKey,bindset:e,environment:this.cache.currentEnvironment}),console.log("[BindsetSelectorService] *** bindset-selector:key-added event emitted successfully ***"),this.emit("bindset-operation:completed",{type:"add-key",bindset:e,key:this.cache.selectedKey},{synchronous:!0})),a}catch(e){return console.error("[BindsetSelectorService] Error adding key to bindset:",e),{success:!1,error:"add_failed"}}}async removeKeyFromBindset(e){if(!this.cache.selectedKey||"Primary Bindset"===e)return{success:!1,error:"invalid_operation"};try{const t=this.cache.profile;if(!t||!t.id)return{success:!1,error:"no_profile"};const i={modify:{bindsets:{[e]:{[this.cache.currentEnvironment]:{keys:{[this.cache.selectedKey]:null}}}}}},a=await this.request("data:update-profile",{profileId:t.id,updates:i});return a?.success&&(this.keyBindsetMembership.set(e,!1),this.emit("bindset-selector:key-removed",{key:this.cache.selectedKey,bindset:e,environment:this.cache.currentEnvironment})),a}catch(e){return console.error("[BindsetSelectorService] Error removing key from bindset:",e),{success:!1,error:"remove_failed"}}}shouldDisplay(){return this.cache.preferences.bindsetsEnabled&&this.cache.preferences.bindToAliasMode&&"alias"!==this.cache.currentEnvironment}getCurrentState(){return{selectedKey:this.cache.selectedKey,activeBindset:this.cache.activeBindset,bindsetNames:[...this.cache.bindsetNames],keyBindsetMembership:new Map(this.keyBindsetMembership),shouldDisplay:this.shouldDisplay(),preferences:{...this.cache.preferences}}}handleInitialState(e,t){if(console.log("[BindsetSelectorService] handleInitialState called:",e,!!t),"BindsetService"===e&&t&&t.bindsets&&(this.cache.bindsetNames=t.bindsets,console.log("[BindsetSelectorService] Updated bindsetNames from BindsetService:",this.cache.bindsetNames),this.updateKeyMembership()),"PreferencesService"===e&&this.cache.preferences){console.log("[BindsetSelectorService] Preferences received via ComponentBase");const e=this.shouldDisplay();this.emit("bindset-selector:visibility-changed",{visible:e})}"SelectionService"!==e&&"DataCoordinator"!==e||(console.log("[BindsetSelectorService] Received state from",e,"- updating key membership"),this.updateKeyMembership())}}}),si=Object.freeze({__proto__:null,default:class extends lt{constructor({eventBus:e,confirmDialog:t=null,document:i=("undefined"!=typeof window?window.document:void 0),i18n:a}={}){super(e),this.componentName="BindsetSelectorUI",this.document=i,this.confirmDialog=t||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=a,this.containerId="bindsetSelectorContainer",this.isOpen=!1,this.service=null,this.keyBindsetMembership=new Map,this.isVisible=!1}async onInit(){this.setupEventListeners(),this.render()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.addEventListener("bindset-selector:active-changed",()=>{this.render()}),this.addEventListener("bindset-selector:membership-updated",({membership:e})=>{this.keyBindsetMembership=e,this.render()}),this.addEventListener("bindset-selector:visibility-changed",({visible:e})=>{this.isVisible=e,this.render()}),this.addEventListener("bindsets:changed",({names:e})=>{console.log("[BindsetSelectorUI] bindsets:changed received:",e),this.render()}),this.addEventListener("key:selected",({key:e})=>{console.log("[BindsetSelectorUI] key:selected received:",e),this.request("bindset-selector:set-key",{key:e})}),this.addEventListener("environment:changed",({environment:e})=>{console.log("[BindsetSelectorUI] environment:changed received:",e),this.render()}),this.addEventListener("bindset-manager:open",()=>{this.openBindsetManager()}),this.onDom("bindsetSelectorBtn","click","bindset-toggle",e=>{e.preventDefault(),e.stopPropagation(),this.toggleDropdown()}),this.onDom("#bindsetOptionsMenu","click","bindset-option-selected",e=>{const t=e.target.closest(".bindset-option");if(t&&!e.target.closest(".toolbar-group")){if(t.classList.contains("greyed-out"))return;const e=t.dataset.bindset;this.request("bindset-selector:set-active-bindset",{bindset:e}),this.close()}}),this.onDom("#bindsetOptionsMenu","click","bindset-add-key",e=>{const t=e.target.closest(".add-key-btn");if(t&&!t.disabled){e.preventDefault(),e.stopPropagation();const i=t.dataset.bindset;this.showAddKeyConfirmation(i)}}),this.onDom("#bindsetOptionsMenu","click","bindset-remove-key",e=>{const t=e.target.closest(".remove-key-btn");if(t&&!t.disabled){e.preventDefault(),e.stopPropagation();const i=t.dataset.bindset;this.showRemoveKeyConfirmation(i)}}),this.onDom("manageBindsetsLink","click","bindset-manage",e=>{e.preventDefault(),e.stopPropagation(),this.openBindsetManager(),this.close()}),this.onDom(this.document,"click","bindset-outside-click",e=>{e.target.closest(`#${this.containerId}`)||e.target.closest("#bindsetOptionsMenu")||this.close()}),this.onDom(this.document,"keydown","bindset-escape",e=>{"Escape"===e.key&&this.isOpen&&this.close()}))}render(){const e=this.document?.getElementById(this.containerId);e?(console.log("[BindsetSelectorUI] render() called - isVisible:",this.isVisible,"bindsetNames:",this.cache.bindsetNames),this.isVisible?(e.style.display="block",e.innerHTML=this.generateDropdownHTML(),this.createDropdownMenu()):e.style.display="none"):console.log("[BindsetSelectorUI] Container not found:",this.containerId)}generateDropdownHTML(){return this.cache.activeBindset,`\n      <button class="toolbar-btn" id="bindsetSelectorBtn" title="${this.i18n.t("select_bindset")}">\n        <i class="fas fa-tags"></i>\n      </button>\n    `}generateDropdownMenuHTML(){const e=this.cache.activeBindset;let t='\n      <div id="bindsetOptionsMenu" class="bindset-dropdown-menu" style="display: none;">\n    ';return t+=`\n      <div class="bindset-option ${"Primary Bindset"===e?"active":""}" data-bindset="Primary Bindset">\n        <span class="bindset-name">${this.i18n.t("primary_bindset")}</span>\n      </div>\n    `,this.cache.bindsetNames.forEach(i=>{if("Primary Bindset"===i)return;const a=e===i,n=this.keyBindsetMembership.get(i)||!1,s=n?"":"greyed-out";console.log(`[BindsetSelectorUI] Bindset: ${i}, hasKey: ${n}, selectedKey: ${this.cache.selectedKey}`),t+=`\n        <div class="bindset-option ${a?"active":""} ${s}" data-bindset="${i}">\n          <span class="bindset-name">${this.escapeHtml(i)}</span>\n          <div class="toolbar-group">\n            <button class="toolbar-btn-small add-key-btn" \n                    data-bindset="${this.escapeHtml(i)}" \n                    title="${this.i18n.t("add_key_to_bindset")}"\n                    ${n?"disabled":""}>\n              <i class="fas fa-plus"></i>\n            </button>\n            <button class="toolbar-btn-small remove-key-btn" \n                    data-bindset="${this.escapeHtml(i)}" \n                    title="${this.i18n.t("remove_key_from_bindset")}"\n                    ${n?"":"disabled"}>\n              <i class="fas fa-minus"></i>\n            </button>\n          </div>\n        </div>\n      `}),t+=`\n        <div class="bindset-dropdown-footer">\n          <a href="#" id="manageBindsetsLink" class="text-link">[${this.i18n.t("manage_bindsets")}]</a>\n        </div>\n      </div>\n    `,t}createDropdownMenu(){const e=this.document?.getElementById("bindsetOptionsMenu");e&&e.remove();const t=this.generateDropdownMenuHTML(),i=this.document?.createElement("div");if(i){i.innerHTML=t;const e=i.firstElementChild;e&&this.document.body.appendChild(e)}}async showAddKeyConfirmation(e){const t=this.i18n.t("add_key_to_bindset_confirm",{key:this.cache.selectedKey,bindset:e});let i=!1;if(this.confirmDialog){const e=this.i18n.t("confirm_add");i=await this.confirmDialog.confirm(t,e,"info","bindsetAddKey")}else i=window.confirm(t);i&&this.request("bindset-selector:add-key-to-bindset",{bindset:e}).then(e=>{e?.success||this.showError(e?.error||"add_failed")}).catch(e=>{console.error("[BindsetSelectorUI] Add key error:",e),this.showError("add_failed")}),this.close()}async showRemoveKeyConfirmation(e){const t=this.i18n.t("remove_key_from_bindset_confirm",{key:this.cache.selectedKey,bindset:e});let i=!1;if(this.confirmDialog){const e=this.i18n.t("confirm_remove");i=await this.confirmDialog.confirm(t,e,"warning","bindsetRemoveKey")}else i=window.confirm(t);i&&this.request("bindset-selector:remove-key-from-bindset",{bindset:e}).then(e=>{e?.success||this.showError(e?.error||"remove_failed")}).catch(e=>{console.error("[BindsetSelectorUI] Remove key error:",e),this.showError("remove_failed")}),this.close()}showError(e){const t=this.i18n.t(`error_${e}`);this.emit("toast:show",{type:"error",message:t,duration:3e3})}openBindsetManager(){this.emit("modal:show",{modalId:"bindsetManagerModal"})}toggleDropdown(){this.isOpen?this.close():this.open()}open(){const e=this.document?.getElementById("bindsetOptionsMenu"),t=this.document?.getElementById("bindsetSelectorBtn");if(e&&t){const i=t.getBoundingClientRect();e.style.left=`${i.left}px`,e.style.top=`${i.bottom+4}px`,e.style.display="block",this.isOpen=!0}}close(){const e=this.document?.getElementById("bindsetOptionsMenu");e&&(e.style.display="none",this.isOpen=!1)}escapeHtml(e){const t=this.document?.createElement("div");return t?(t.textContent=e,t.innerHTML):String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}handleInitialState(e,t){"BindsetSelectorService"===e&&t&&(console.log("[BindsetSelectorUI] handleInitialState from BindsetSelectorService:",t),this.keyBindsetMembership=t.keyBindsetMembership||new Map,this.isVisible=t.shouldDisplay||!1,this.render())}}});
//# sourceMappingURL=bundle.js.map
