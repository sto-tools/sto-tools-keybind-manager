const e="v2026.01.18",t=["Alt+F4","Alt+Tab","Alt+Space","LALT+F4","RALT+F4","LALT+Tab","RALT+Tab","LALT+Space","RALT+Space"],i=new Map,n=new Set;function a(e,t){return i.has(e)||i.set(e,new Set),i.get(e).add(t),()=>{s(e,t)}}function s(e,t){const n=i.get(e);n&&n.delete(t)}function o(e,t,n={}){const a=i.get(e);if(!a)return Promise.resolve();if(n.synchronous){const i=[];return a.forEach(n=>{try{const e=n(t);e&&"function"==typeof e.then&&i.push(e)}catch(t){console.error(`Error in event listener for ${e}:`,t),i.push(Promise.reject(t))}}),Promise.allSettled?Promise.allSettled(i):Promise.all(i.map(e=>e.catch(e=>e)))}return a.forEach(i=>{try{i(t)}catch(t){console.error(`Error in event listener for ${e}:`,t)}}),Promise.resolve()}function r(e,t,i,a){if("string"==typeof e){"function"==typeof i&&void 0===a&&(a=i,i=t);const s=/^[.\[#]/.test(e)?e:`#${e}`,r=e=>{if(e.target.closest(s)){if(a)try{a(e)}catch(e){console.error(e)}o(i||t,e)}};document.addEventListener(t,r,!0);const c=()=>{document.removeEventListener(t,r,!0),n.delete(c)};return n.add(c),c}if(!e||!e.addEventListener)return()=>{};if("function"==typeof i&&(a=i,i=t),i||(i=t),a){const s=e=>{try{a(e)}catch(e){console.error(e)}o(i,e)};e.addEventListener(t,s);const r=()=>{e.removeEventListener(t,s),n.delete(r)};return n.add(r),r}{const a=e=>o(i,e);e.addEventListener(t,a);const s=()=>{e.removeEventListener(t,a),n.delete(s)};return n.add(s),s}}var c={on:a,off:s,emit:o,onDom:r,onDomDebounced:function(e,t,i,n,a=250){"number"==typeof n&&(a=n,n=void 0);const s=function(e,t=250){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e.apply(this,n),t)}}(n||(()=>{}),a);return r(e,t,i,e=>{s(e)})},once:function(e,t){const i=n=>{s(e,i),t(n)};a(e,i)},clear:function(){i.clear(),n.forEach(e=>{try{e()}catch(e){console.error("Error cleaning up DOM event listener:",e)}}),n.clear()},get listeners(){return i}};const l={commands:{custom:{name:"Custom",icon:"fas fa-plus",description:"Create commands from raw STO command strings",commands:{add_custom_command:{name:"Add Custom Command",command:"",description:"Add any STO command as raw text",syntax:"<raw command>",icon:"‚ûï",customizable:!0,parameters:{rawCommand:{type:"text",default:"",placeholder:"command_definitions.parameter_placeholders.any_sto_command",label:"Command:"}}}}},targeting:{name:"Targeting",icon:"fas fa-crosshairs",description:"Target selection and management",commands:{target:{name:"Target by Name",command:"Target",description:"Target entity by name (requires quotes)",syntax:'Target "EntityName"',icon:"üéØ",customizable:!0,parameters:{entityName:{type:"text",default:"EntityName",placeholder:"command_definitions.parameter_placeholders.entity_name"}}},target_enemy_near:{name:"Target Nearest Enemy",command:"Target_Enemy_Near",description:"Target the nearest enemy in view",syntax:"Target_Enemy_Near",icon:"üéØ"},target_enemy_near_forarc:{name:"Target Nearest Enemy (Fore Arc)",command:"Target_Enemy_Near_ForArc",description:"Target nearest enemy within a forward-facing cone",syntax:"Target_Enemy_Near_ForArc <degrees>",icon:"üéØ",customizable:!0,parameters:{degrees:{type:"number",min:0,max:360,default:90,step:15}}},target_enemy_near_aftarc:{name:"Target Nearest Enemy (Aft Arc)",command:"Target_Enemy_Near_AftArc",description:"Target nearest enemy within a rear-facing cone",syntax:"Target_Enemy_Near_AftArc <degrees>",icon:"üéØ",customizable:!0,parameters:{degrees:{type:"number",min:0,max:360,default:90,step:15}}},target_enemy_near_sidearc:{name:"Target Nearest Enemy (Side Arc)",command:"Target_Enemy_Near_SideArc",description:"Target nearest enemy within side arcs (both port and starboard)",syntax:"Target_Enemy_Near_SideArc <degrees>",icon:"üéØ",customizable:!0,parameters:{degrees:{type:"number",min:0,max:360,default:90,step:15}}},target_friend_near:{name:"Target Nearest Friend",command:"Target_Friend_Near",description:"Target the nearest friendly entity",syntax:"Target_Friend_Near",icon:"ü§ù"},target_self:{name:"Target Self",command:"Target_Self",description:"Target your own ship/character",syntax:"Target_Self",icon:"üë§"},target_clear:{name:"Clear Target",command:"Target_Clear",description:"Remove current target lock",syntax:"Target_Clear",icon:"‚ùå"},target_teammate_1:{name:"Target Teammate 1",command:"Target_Teammate 1",description:"Target first team member",syntax:"Target_Teammate 1",icon:"üë•"},target_teammate_2:{name:"Target Teammate 2",command:"Target_Teammate 2",description:"Target second team member",syntax:"Target_Teammate 2",icon:"üë•"},target_teammate_3:{name:"Target Teammate 3",command:"Target_Teammate 3",description:"Target third team member",syntax:"Target_Teammate 3",icon:"üë•"},target_teammate_4:{name:"Target Teammate 4",command:"Target_Teammate 4",description:"Target fourth team member",syntax:"Target_Teammate 4",icon:"üë•"}}},combat:{name:"Combat",icon:"fas fa-fire",description:"Weapon firing and combat actions",commands:{fire_all:{name:"Fire All Weapons",command:"FireAll",description:"Fire all weapons",syntax:"FireAll",environment:"space",icon:"üî•",warning:"spam_bar_warning"},fire_phasers:{name:"Fire Energy Weapons",command:"FirePhasers",description:"Fire all Energy Weapons",syntax:"FirePhasers",environment:"space",icon:"‚ö°",warning:"spam_bar_warning"},fire_torps:{name:"Fire Torpedoes",command:"FireTorps",description:"Fire all Torpedos",syntax:"FireTorps",environment:"space",icon:"üöÄ",warning:"spam_bar_warning"},fire_mines:{name:"Fire Mines",command:"FireMines",description:"Fire all Mines",syntax:"FireMines",environment:"space",icon:"üí£",warning:"spam_bar_warning"},fire_phasers_torps:{name:"Fire Phasers & Torpedoes",command:"FirePhasersTorps",description:"Fire phasers & torpedos",syntax:"FirePhasersTorps",environment:"space",icon:"üí•",warning:"spam_bar_warning"},fire_projectiles:{name:"Fire Projectiles",command:"FireProjectiles",description:"Fire torpedos & mines",syntax:"FireProjectiles",environment:"space",icon:"üéØ",warning:"spam_bar_warning"},aim:{name:"Aim/Scope",command:"aim",description:"Toggle scope on/off. In scope mode the player does more damage. Can either be used as a toggle or a press and hold",syntax:"aim",environment:"ground",icon:"üéØ"},holster:{name:"Holster Weapon",command:"Holster",description:"Attempt to holster your active weapon",syntax:"Holster",environment:"ground",icon:"üî´"},holster_toggle:{name:"Holster Toggle",command:"HolsterToggle",description:"Attempt to holster or draw your weapons",syntax:"HolsterToggle",environment:"ground",icon:"üîÑ"},unholster:{name:"Unholster Weapon",command:"Unholster",description:"Attempt to draw your active weapon",syntax:"Unholster",environment:"ground",icon:"üî´"},toggle_shooter_mode:{name:"Toggle Shooter Mode",command:"ToggleShooterMode",description:"Toggle shooter mode on/off",syntax:"ToggleShooterMode",environment:"ground",icon:"üéÆ"},shooter_primary:{name:"Shooter Primary",command:"ShooterPrimary",description:"Primary shooter mode action",syntax:"ShooterPrimary",environment:"ground",icon:"üéØ"},shooter_secondary:{name:"Shooter Secondary",command:"Shootersecondary",description:"Secondary shooter mode action",syntax:"Shootersecondary",environment:"ground",icon:"üéØ"},shooter_tertiary:{name:"Shooter Tertiary",command:"Shootertertiary",description:"Tertiary shooter mode action",syntax:"Shootertertiary",environment:"ground",icon:"üéØ"},shooter_clear_offset_tray_binds:{name:"Shooter Clear Offset Tray Binds",command:"ShooterClearOffsetTrayBinds",description:"Clear the starting location and movement of the yellow action box that appears on the tray while in shooter mode",syntax:"ShooterClearOffsetTrayBinds",environment:"ground",icon:"üßπ"},shooter_clear_overlay_tray_binds:{name:"Shooter Clear Overlay Tray Binds",command:"ShooterClearOverlayTrayBinds",description:"Clear overlay tray bindings for shooter mode",syntax:"ShooterClearOverlayTrayBinds",environment:"ground",icon:"üßπ"},shooter_set_offset_tray_binds:{name:"Shooter Set Offset Tray Binds",command:"ShooterSetOffsetTrayBinds",description:"Set the starting location and movement of the yellow action box that appears on the tray while in shooter mode",syntax:"ShooterSetOffsetTrayBinds",environment:"ground",icon:"‚öôÔ∏è"},shooter_set_overlay_tray_binds:{name:"Shooter Set Overlay Tray Binds",command:"ShooterSetOverlayTrayBinds",description:"Set overlay tray bindings for shooter mode",syntax:"ShooterSetOverlayTrayBinds",environment:"ground",icon:"‚öôÔ∏è"}}},cosmetic:{name:"Cosmetic",icon:"fas fa-palette",description:"Character appearance and customization",commands:{setactivecostume:{name:"Set Active Costume",command:"setactivecostume",description:"Sets current active costume. Requires two modifiers.",syntax:"setactivecostume <modifier1> <modifier2>",environment:"ground",icon:"üëï",customizable:!0,parameters:{modifier1:{type:"text",default:"modifier1",placeholder:"command_definitions.parameter_placeholders.first_modifier"},modifier2:{type:"text",default:"modifier2",placeholder:"command_definitions.parameter_placeholders.second_modifier"}}}}},bridge_officer:{name:"Bridge Officer",icon:"fas fa-user-friends",description:"Ground bridge officer control commands",commands:{setrallypoint:{name:"Set Rally Point",command:"Setrallypoint",description:"Set a rally point for your current target",syntax:"Setrallypoint",environment:"ground",icon:"üìç"},setrallypointconsole:{name:"Set Rally Point (Console)",command:"Setrallypointconsole",description:"Set a rally point for your current target (console variant)",syntax:"Setrallypointconsole",environment:"ground",icon:"üñ•Ô∏è"},clearrallypoint:{name:"Clear Rally Point",command:"Clearrallypoint",description:"Clear the rally point for your current target",syntax:"Clearrallypoint",environment:"ground",icon:"‚ùå"},clearallrallypoints:{name:"Clear All Rally Points",command:"Clearallrallypoints",description:"Clear all the rally points",syntax:"Clearallrallypoints",environment:"ground",icon:"üßπ"},assist:{name:"Assist",command:"Assist",description:'Assist "<name>": Assists the Entity with the matching name. If no name is given, assists your current target.',syntax:"Assist <name>",environment:"ground",icon:"ü§ù",customizable:!0,parameters:{name:{type:"text",default:"",placeholder:"command_definitions.parameter_placeholders.entity_name_optional"}}}}},tray:{name:"Tray Execution",icon:"fas fa-th",description:"Execute abilities from action trays",commands:{custom_tray:{name:"Tray Execution",command:"+STOTrayExecByTray 0 0",description:"Execute specific tray slot",syntax:"+STOTrayExecByTray <tray> <slot>",icon:"‚ö°",customizable:!0,parameters:{active:{type:"boolean",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},slot:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"TrayExecByTray"}}},tray_with_backup:{name:"Tray Execution with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute specific tray slot with backup ability",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot>",icon:"‚ö°",customizable:!0,parameters:{active:{type:"boolean",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},slot:{type:"number",min:0,max:9,default:0},backup_tray:{type:"number",min:0,max:9,default:0},backup_slot:{type:"number",min:0,max:9,default:0}}},tray_range:{name:"Tray Range Execution",command:"+STOTrayExecByTray 0 0",description:"Execute a range of tray slots",syntax:"+STOTrayExecByTray <tray> <slot> $$ ... (range)",icon:"‚ö°",customizable:!0,parameters:{active:{type:"boolean",min:0,max:1,default:1},start_tray:{type:"number",min:0,max:9,default:0},start_slot:{type:"number",min:0,max:9,default:0},end_tray:{type:"number",min:0,max:9,default:0},end_slot:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"TrayExecByTray"}}},tray_range_with_backup:{name:"Tray Range with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute a range of tray slots with backup abilities",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot> $$ ... (range)",icon:"‚ö°",customizable:!0,parameters:{active:{type:"boolean",min:0,max:1,default:1},start_tray:{type:"number",min:0,max:9,default:0},start_slot:{type:"number",min:0,max:9,default:0},end_tray:{type:"number",min:0,max:9,default:0},end_slot:{type:"number",min:0,max:9,default:0},backup_start_tray:{type:"number",min:0,max:9,default:0},backup_start_slot:{type:"number",min:0,max:9,default:0},backup_end_tray:{type:"number",min:0,max:9,default:0},backup_end_slot:{type:"number",min:0,max:9,default:0}}},whole_tray:{name:"Whole Tray Execution",command:"+STOTrayExecByTray 0 0",description:"Execute all slots in a tray",syntax:"+STOTrayExecByTray <tray> <slot> $$ ... (all slots)",icon:"‚ö°",customizable:!0,parameters:{active:{type:"boolean",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"TrayExecByTray"}}},whole_tray_with_backup:{name:"Whole Tray with Backup",command:"TrayExecByTrayWithBackup 1 0 0 0 0",description:"Execute all slots in a tray with backup tray",syntax:"TrayExecByTrayWithBackup <active> <tray> <slot> <backup_tray> <backup_slot> $$ ... (all slots)",icon:"‚ö°",customizable:!0,parameters:{active:{type:"boolean",min:0,max:1,default:1},tray:{type:"number",min:0,max:9,default:0},backup_tray:{type:"number",min:0,max:9,default:0}}}}},power:{name:"Shield Management",icon:"fas fa-shield-alt",description:"Shield power and distribution management",commands:{distribute_shields:{name:"Distribute Shields",command:"+power_exec Distribute_Shields",description:"Evenly distributes shields as if clicking in the middle of the ship and shields icon",syntax:"+power_exec Distribute_Shields",environment:"space",icon:"üõ°Ô∏è",warning:"spam_bar_warning"},reroute_shields_rear:{name:"Reroute Shields Rear",command:"+power_exec reroute_shields_rear",description:"Route shield power to rear facing",syntax:"+power_exec reroute_shields_rear",environment:"space",icon:"üõ°Ô∏è",warning:"spam_bar_warning"},reroute_shields_left:{name:"Reroute Shields Left",command:"+power_exec reroute_shields_left",description:"Route shield power to left side",syntax:"+power_exec reroute_shields_left",environment:"space",icon:"üõ°Ô∏è",warning:"spam_bar_warning"},reroute_shields_right:{name:"Reroute Shields Right",command:"+power_exec reroute_shields_right",description:"Route shield power to right side",syntax:"+power_exec reroute_shields_right",environment:"space",icon:"üõ°Ô∏è",warning:"spam_bar_warning"},reroute_shields_forward:{name:"Reroute Shields Forward",command:"+power_exec reroute_shields_forward",description:"Route shield power to forward facing",syntax:"+power_exec reroute_shields_forward",environment:"space",icon:"üõ°Ô∏è",warning:"spam_bar_warning"}}},movement:{name:"Movement",icon:"fas fa-arrows-alt",description:"Ship movement and navigation",commands:{full_impulse:{name:"Full Impulse",command:"+fullimpulse",description:"Engage full impulse drive",syntax:"+fullimpulse",environment:"space",icon:"üöÄ"},reverse:{name:"Reverse",command:"+reverse",description:"Reverse engines",syntax:"+reverse",icon:"‚¨ÖÔ∏è"},throttle_adjust:{name:"Throttle Adjust",command:"ThrottleAdjust",description:"Increase or decrease the throttle by amount",syntax:"ThrottleAdjust <amount>",icon:"‚ö°",customizable:!0,parameters:{amount:{type:"number",min:-1,max:1,default:.25,step:.05}}},throttle_set:{name:"Throttle Set",command:"ThrottleSet",description:"Set the throttle to a specific position (negative = reverse, 0 = stop)",syntax:"ThrottleSet <position>",icon:"üéõÔ∏è",customizable:!0,parameters:{position:{type:"number",min:-1,max:1,default:1,step:.1}}},throttle_toggle:{name:"Throttle Toggle",command:"ThrottleToggle",description:"Alternates between full throttle and full stop",syntax:"ThrottleToggle",icon:"üîÑ"},turn_left:{name:"Turn Left",command:"+turnleft",description:"Turn ship left (continuous while held)",syntax:"+turnleft",icon:"‚Ü™Ô∏è"},turn_right:{name:"Turn Right",command:"+turnright",description:"Turn ship right (continuous while held)",syntax:"+turnright",icon:"‚Ü©Ô∏è"},pitch_up:{name:"Pitch Up",command:"+up",description:"Pitch ship nose up (space altitude change)",syntax:"+up",icon:"‚¨ÜÔ∏è"},pitch_down:{name:"Pitch Down",command:"+down",description:"Pitch ship nose down (space altitude change)",syntax:"+down",icon:"‚¨áÔ∏è"},strafe_left:{name:"Strafe Left",command:"+left",description:"Strafe ship left",syntax:"+left",icon:"‚¨ÖÔ∏è"},strafe_right:{name:"Strafe Right",command:"+right",description:"Strafe ship right",syntax:"+right",icon:"‚û°Ô∏è"},forward:{name:"Forward",command:"+forward",description:"Move forward",syntax:"+forward",icon:"‚¨ÜÔ∏è"},backward:{name:"Backward",command:"+backward",description:"Move backward",syntax:"+backward",icon:"‚¨áÔ∏è"},auto_forward:{name:"Auto Forward",command:"autoForward",description:"Character moves forward until given new movement commands",syntax:"autoForward",environment:"ground",icon:"üèÉ"},follow:{name:"Follow Target",command:"Follow",description:"Follow the targeted entity",syntax:"Follow",icon:"üë•"},follow_cancel:{name:"Cancel Follow",command:"Follow_Cancel",description:"Stop following and forget about the target",syntax:"Follow_Cancel",icon:"‚ùå"}}},camera:{name:"Camera",icon:"fas fa-video",description:"Camera control and view management",commands:{zoom_in:{name:"Zoom In",command:"Camzoomin",description:"Zoom the camera in",syntax:"Camzoomin",icon:"üîç"},zoom_out:{name:"Zoom Out",command:"Camzoomout",description:"Zoom the camera out",syntax:"Camzoomout",icon:"üîé"},zoom_in_small:{name:"Zoom In Small",command:"Camzoominsmall",description:"Zoom the camera in slightly",syntax:"Camzoominsmall",icon:"üîç"},zoom_out_small:{name:"Zoom Out Small",command:"Camzoomoutsmall",description:"Zoom the camera out slightly",syntax:"Camzoomoutsmall",icon:"üîé"},cam_distance:{name:"Set Camera Distance",command:"camdist",description:"Sets the camera distance from the player",syntax:"camdist <distance>",icon:"üìè",customizable:!0,parameters:{distance:{type:"number",min:1,max:500,default:50}}},cam_reset:{name:"Reset Camera",command:"CamReset",description:"Reset the camera position to default",syntax:"CamReset",icon:"üîÑ"},cam_target_lock:{name:"Lock Camera to Target",command:"Camsetlocktotarget",description:"Lock or unlock the camera to the target",syntax:"Camsetlocktotarget",icon:"üéØ"},cam_cycle_distance:{name:"Cycle Camera Distance",command:"camCycleDist",description:"Cycle the camera distance between several preset values",syntax:"camCycleDist",icon:"üîÑ"},cam_mouse_look:{name:"Mouse Look",command:"+camMouseLook",description:"Enable mouse look camera control",syntax:"+camMouseLook",icon:"üñ±Ô∏è"},cam_turn_to_face:{name:"Turn to Face Camera",command:"+camTurnToFace",description:"Turn ship to face camera direction",syntax:"+camTurnToFace",icon:"‚Ü™Ô∏è"},look_up:{name:"Look Up",command:"lookUp",description:"Change point of view to look straight up",syntax:"lookUp",icon:"‚¨ÜÔ∏è"},look_down:{name:"Look Down",command:"lookDown",description:"Change point of view to look straight down",syntax:"lookDown",icon:"‚¨áÔ∏è"}}},communication:{name:"Communication",icon:"fas fa-comments",description:"Chat and team communication",commands:{team_message:{name:"Team Message",command:"team",description:"Send message to team",syntax:"team message",icon:"üí¨",customizable:!0,parameters:{verb:{type:"select",default:"team",options:["say","team","zone"]},message:{type:"text",default:"Message text here"}}},local_message:{name:"Local Message",command:"say",description:"Send message to local area",syntax:"say message",icon:"üì¢",customizable:!0,parameters:{verb:{type:"select",default:"say",options:["say","team","zone"]},message:{type:"text",default:"Message text here"}}},zone_message:{name:"Zone Message",command:"zone",description:"Send message to zone",syntax:"zone message",icon:"üì°",customizable:!0,parameters:{verb:{type:"select",default:"zone",options:["say","team","zone"]},message:{type:"text",default:"Message text here"}}}}},system:{name:"System",icon:"fas fa-cogs",description:"UI and system commands",commands:{toggle_hud:{name:"Toggle HUD",command:"++ShowGameUI",description:"Toggle HUD visibility",syntax:"++ShowGameUI",icon:"üëÅÔ∏è"},screenshot:{name:"Screenshot",command:"screenshot",description:"Take a screenshot",syntax:"screenshot",icon:"üì∑"},screenshot_jpg:{name:"Screenshot JPG",command:"screenshot_jpg",description:"Save a screenshot as JPG",syntax:"screenshot_jpg",icon:"üì∑"},autofire_set:{name:"Set Autofire",command:"defaultautoattack",description:"Turn weapon autofire off and on. X = 1 turns it on and X = 0 turns it off.",syntax:"defaultautoattack <x>",icon:"üîÅ",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},bind_save_file:{name:"Save Binds to File",command:"bind_save_file",description:"Save all your binds to a text file",syntax:"bind_save_file <filename>",icon:"üíæ",customizable:!0,parameters:{filename:{type:"text",default:"my_binds.txt"}}},bind_load_file:{name:"Load Binds from File",command:"bind_load_file",description:"Load a bind file into the client",syntax:"bind_load_file <filename>",icon:"üìÅ",customizable:!0,parameters:{filename:{type:"text",default:"my_binds.txt"}}},combat_log:{name:"Toggle Combat Log",command:"CombatLog",description:"Turn combat log recording on/off (1=on, 0=off)",syntax:"CombatLog <1/0>",icon:"üìä",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},chat_log:{name:"Toggle Chat Log",command:"ChatLog",description:"Turn chat log recording on/off (1=on, 0=off)",syntax:"ChatLog <1/0>",icon:"üí¨",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},missions:{name:"Show/Hide Missions",command:"missions",description:"Show/hide the mission journal",syntax:"missions",icon:"üìã"},inventory:{name:"Show/Hide Inventory",command:"Inventory",description:"Show/hide your inventory",syntax:"Inventory",icon:"üéí"},map:{name:"Show/Hide Map",command:"Map",description:"Show/hide the map window",syntax:"Map",icon:"üó∫Ô∏è"},logout:{name:"Logout",command:"logout",description:"Log out the current character",syntax:"logout",icon:"üö™"},quit:{name:"Quit Game",command:"quit",description:"Close the window",syntax:"quit",icon:"‚ùå"},goto_character_select:{name:"Go to Character Select",command:"gotoCharacterSelect",description:"Go to the character select screen without logging out",syntax:"gotoCharacterSelect",icon:"üë§"},ui_load:{name:"Load UI Settings",command:"ui_load",description:"Loads default UI Windows save file, usually Live\\ui_settings.txt",syntax:"ui_load",icon:"üìÇ"},ui_load_file:{name:"Load UI Settings File",command:"ui_load_file",description:"Loads named UI Windows save file",syntax:"ui_load_file <filename>",icon:"üìÇ",customizable:!0,parameters:{filename:{type:"text",default:"ui_settings.txt"}}},ui_save:{name:"Save UI Settings",command:"ui_save",description:"Saves UI layout to default UI Window save file, usually Live\\ui_settings.txt",syntax:"ui_save",icon:"üíæ"},ui_save_file:{name:"Save UI Settings File",command:"ui_save_file",description:"Saves UI layout to named UI Window save file",syntax:"ui_save_file <filename>",icon:"üíæ",customizable:!0,parameters:{filename:{type:"text",default:"ui_settings.txt"}}},ui_cancel:{name:"UI Cancel",command:"uiCancel",description:'Respond "Cancel" to an open dialog box; may not work in all dialogs',syntax:"uiCancel",icon:"‚ùå"},ui_ok:{name:"UI OK",command:"uiOK",description:'Respond "OK" to an open dialog box; may not work in all dialogs',syntax:"uiOK",icon:"‚úÖ"},ui_gen_layers_reset:{name:"Reset UI Layout",command:"ui_GenLayersReset",description:"Resets the layout, used for when the server updates movable window positions",syntax:"ui_GenLayersReset",icon:"üîÑ"},ui_resolution:{name:"Print UI Resolution",command:"ui_resolution",description:"Print the current UI screen resolution",syntax:"ui_resolution",icon:"üìê"},ui_tooltip_delay:{name:"Set Tooltip Delay",command:"ui_TooltipDelay",description:"Sets the additional delay, in seconds, before tooltips appear",syntax:"ui_TooltipDelay <seconds>",icon:"‚è±Ô∏è",customizable:!0,parameters:{seconds:{type:"number",min:0,max:10,default:.5,step:.1}}},remember_ui_lists:{name:"Remember UI Lists",command:"RememberUILists",description:"Whether to remember UI List Column placement and width",syntax:"RememberUILists <1/0>",icon:"üìã",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},ui_remember_positions:{name:"Remember UI Positions",command:"UIRememberPositions",description:"Whether to remember UI sizes and positions. On by default",syntax:"UIRememberPositions <1/0>",icon:"üìç",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},safe_login:{name:"Safe Login",command:"SafeLogin",description:"If true, then log the player back into their most recent static map instead of anything else",syntax:"SafeLogin <1/0>",icon:"üõ°Ô∏è",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},show_game_ui:{name:"Show Game UI",command:"ShowGameUI",description:"Show the game UI",syntax:"ShowGameUI",icon:"üéÆ"},show_game_ui_no_extra_keybinds:{name:"Show Game UI (No Extra Keybinds)",command:"ShowGameUINoExtraKeyBinds",description:"This command does not add any keybinds for showing the UI when the user presses escape",syntax:"ShowGameUINoExtraKeyBinds",icon:"üéÆ"},change_instance:{name:"Change Instance",command:"ChangeInstance",description:"Change to an already created instance of the same map. Only works while not at red alert",syntax:"ChangeInstance",icon:"üîÑ"},net_timing_graph:{name:"Net Timing Graph",command:"netTimingGraph",description:"Enable or disable the network timing graph (0=disable, 1=enable)",syntax:"netTimingGraph <0/1>",icon:"üìä",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}},net_timing_graph_alpha:{name:"Net Timing Graph Alpha",command:"netTimingGraphAlpha",description:"Set transparency level for network timing graph (50=highest transparency, 255=no transparency)",syntax:"netTimingGraphAlpha <50-255>",icon:"üé®",customizable:!0,parameters:{alpha:{type:"number",min:50,max:255,default:255}}},net_timing_graph_paused:{name:"Net Timing Graph Paused",command:"netTimingGraphPaused",description:"Pause or resume the network timing graph (0=pause disabled, 1=pause enabled)",syntax:"netTimingGraphPaused <0/1>",icon:"‚è∏Ô∏è",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:0}}},netgraph:{name:"Net Graph",command:"netgraph",description:"Display SND and RCV network data as text (1=enabled, 0=disabled)",syntax:"netgraph <0/1>",icon:"üåê",customizable:!0,parameters:{state:{type:"number",min:0,max:1,default:1}}}}}},templates:{space_combat:{basic_attack:{name:"Basic Attack Sequence",description:"Target enemy and fire all weapons",commands:["Target_Enemy_Near","FireAll"]},defensive_sequence:{name:"Defensive Sequence",description:"Target self and activate defensive abilities",commands:["Target_Self","+power_exec Distribute_Shields"]},alpha_strike:{name:"Alpha Strike",description:"Full offensive sequence with buffs",commands:["Target_Enemy_Near","FireAll"]},healing_sequence:{name:"Emergency Healing",description:"Self-healing and damage control",commands:["Target_Self","+power_exec Distribute_Shields"]}},ground_combat:{basic_ground_attack:{name:"Basic Ground Attack",description:"Target and attack sequence for ground combat",commands:["Target_Enemy_Near","+STOTrayExecByTray 0 0"]}}},defaultProfiles:{default:{name:"Default",description:"Default keybind configuration",currentEnvironment:"space",builds:{space:{keys:{Space:["+TrayExecByTray 8 0","+TrayExecByTray 8 1","+TrayExecByTray 8 2","+TrayExecByTray 8 3","+TrayExecByTray 8 4","+TrayExecByTray 8 5","+TrayExecByTray 8 6","+TrayExecByTray 8 7","+TrayExecByTray 8 8","+TrayExecByTray 8 9"],F1:["+TrayExecByTray 9 0","+TrayExecByTray 9 1","+TrayExecByTray 9 2","+TrayExecByTray 9 3","+TrayExecByTray 9 4","+TrayExecByTray 9 5","+TrayExecByTray 9 6","+TrayExecByTray 9 7","+TrayExecByTray 9 8","+TrayExecByTray 9 9"],F2:["+TrayExecByTray 3 0","+TrayExecByTray 3 1","+TrayExecByTray 3 2","+TrayExecByTray 3 3","+TrayExecByTray 3 4"],F3:["+TrayExecByTray 3 5","+TrayExecByTray 3 6","+TrayExecByTray 3 7","+TrayExecByTray 3 8","+TrayExecByTray 3 9"],F4:["+TrayExecByTray 4 0","+TrayExecByTray 4 1","+TrayExecByTray 4 2","+TrayExecByTray 4 3","+TrayExecByTray 4 4"],F5:["+TrayExecByTray 4 5","+TrayExecByTray 4 6","+TrayExecByTray 4 7","+TrayExecByTray 4 8","+TrayExecByTray 4 9"],Z:["+TrayExecByTray 6 0","+TrayExecByTray 6 1","+TrayExecByTray 6 2","+TrayExecByTray 6 3","+TrayExecByTray 6 4"],C:["+TrayExecByTray 6 5","+TrayExecByTray 6 6","+TrayExecByTray 6 7","+TrayExecByTray 6 8","+TrayExecByTray 6 9"],"`":["Target_Enemy_Near_ForArc 90","PlayerSay Target Arc=90"],"Alt+`":["Target_Enemy_Near_ForArc 180","PlayerSay Target Arc=180"],LSHIFT:["FireAll"],F9:["dynFxSetFXExclusionList_Space"],F10:["toggle_combatlog"],F11:["bind_load_file Default_space.txt"],numpad0:["toggle_default_auto_attack_off"],numpad1:["toggle_default_auto_attack_on"]}},ground:{keys:{X:["+TrayExecByTray 7 0","+TrayExecByTray 7 1","+TrayExecByTray 7 2","+TrayExecByTray 7 3","+TrayExecByTray 7 4","+TrayExecByTray 7 5","+TrayExecByTray 7 6","+TrayExecByTray 7 7","+TrayExecByTray 7 8","+TrayExecByTray 7 9"],F1:["+TrayExecByTray 6 0","+TrayExecByTray 6 1","+TrayExecByTray 6 2"],F2:["+TrayExecByTray 6 3","+TrayExecByTray 6 4","+TrayExecByTray 6 5"],F3:["+TrayExecByTray 6 6","+TrayExecByTray 6 7","+TrayExecByTray 6 8","+TrayExecByTray 6 9"],T:["+TrayExecByTray 5 0","+TrayExecByTray 5 1","+TrayExecByTray 5 2","+TrayExecByTray 5 3","+TrayExecByTray 5 4"],Y:["+TrayExecByTray 5 5","+TrayExecByTray 5 6","+TrayExecByTray 5 7","+TrayExecByTray 5 8","+TrayExecByTray 5 9"],F9:["dynFxSetFXExclusionList_Ground"],F10:["toggle_combatlog"],F11:["bind_load_file Default_ground.txt"]}},alias:{keys:{}}},aliases:{toggle_combatlog:{commands:["toggle_combatlog_on"],description:""},toggle_combatlog_off:{commands:["combatlog 0","PlayerSay Toggle Combat Log: Off",'alias toggle_combatlog "toggle_combatlog_on"',"combatlog"],description:""},toggle_combatlog_on:{commands:["combatlog 1","PlayerSay Toggle Combat Log: On",'alias toggle_combatlog "toggle_combatlog_off"',"combatlog"],description:""},toggle_default_auto_attack:{commands:["toggle_default_auto_attack_on"],description:""},toggle_default_auto_attack_off:{commands:["defaultautoattack 0","PlayerSay Toggle Default Auto Attack: Off",'alias toggle_default_auto_attack "toggle_default_auto_attack_on"'],description:""},toggle_default_auto_attack_on:{commands:["defaultautoattack 1","PlayerSay Toggle Default Auto Attack: On",'alias toggle_default_auto_attack "toggle_default_auto_attack_off"'],description:""}},created:"2025-07-11T00:19:39.458Z",lastModified:"2025-07-11T02:01:08.466Z",migrationVersion:"2.0.0",id:"default_space",keybindMetadata:{space:{Space:{stabilizeExecutionOrder:!0},F1:{stabilizeExecutionOrder:!0},F2:{stabilizeExecutionOrder:!0},F3:{stabilizeExecutionOrder:!0},F4:{stabilizeExecutionOrder:!0},F5:{stabilizeExecutionOrder:!0},Z:{stabilizeExecutionOrder:!0},C:{stabilizeExecutionOrder:!0}},ground:{X:{stabilizeExecutionOrder:!0},F3:{stabilizeExecutionOrder:!0},F2:{stabilizeExecutionOrder:!0},F1:{stabilizeExecutionOrder:!0},T:{stabilizeExecutionOrder:!0},Y:{stabilizeExecutionOrder:!0}}},aliasMetadata:{},selections:{space:"F1",alias:"toggle_combatlog",ground:"F1"},vertigoSettings:{selectedEffects:{space:[],ground:[]},showPlayerSay:!0}}},keys:{common:{name:"Common Keys",description:"Most frequently used keys",keys:[{key:"Space",description:"Spacebar"},{key:"1",description:"Number 1"},{key:"2",description:"Number 2"},{key:"3",description:"Number 3"},{key:"4",description:"Number 4"},{key:"5",description:"Number 5"},{key:"F1",description:"Function Key 1"},{key:"F2",description:"Function Key 2"},{key:"F3",description:"Function Key 3"},{key:"F4",description:"Function Key 4"},{key:"Tab",description:"Tab"},{key:"enter",description:"Main Enter Key"},{key:"Shift",description:"Shift"},{key:"Control",description:"Control"},{key:"ALT",description:"Alt"}]},letters:{name:"Letter Keys",description:"A-Z keyboard letters",keys:[{key:"A",description:"Key A"},{key:"B",description:"Key B"},{key:"C",description:"Key C"},{key:"D",description:"Key D"},{key:"E",description:"Key E"},{key:"F",description:"Key F"},{key:"G",description:"Key G"},{key:"H",description:"Key H"},{key:"I",description:"Key I"},{key:"J",description:"Key J"},{key:"K",description:"Key K"},{key:"L",description:"Key L"},{key:"M",description:"Key M"},{key:"N",description:"Key N"},{key:"O",description:"Key O"},{key:"P",description:"Key P"},{key:"Q",description:"Key Q"},{key:"R",description:"Key R"},{key:"S",description:"Key S"},{key:"T",description:"Key T"},{key:"U",description:"Key U"},{key:"V",description:"Key V"},{key:"W",description:"Key W"},{key:"X",description:"Key X"},{key:"Y",description:"Key Y"},{key:"Z",description:"Key Z"}]},numbers:{name:"Number Keys",description:"Number row and numpad",keys:[{key:"0",description:"Number 0"},{key:"6",description:"Number 6"},{key:"7",description:"Number 7"},{key:"8",description:"Number 8"},{key:"9",description:"Number 9"},{key:"numpad0",description:"Numerical Keypad 0"},{key:"numpad1",description:"Numerical Keypad 1"},{key:"numpad2",description:"Numerical Keypad 2"},{key:"numpad3",description:"Numerical Keypad 3"},{key:"numpad4",description:"Numerical Keypad 4"},{key:"numpad5",description:"Numerical Keypad 5"},{key:"numpad6",description:"Numerical Keypad 6"},{key:"numpad7",description:"Numerical Keypad 7"},{key:"numpad8",description:"Numerical Keypad 8"},{key:"numpad9",description:"Numerical Keypad 9"},{key:"Decimal",description:"Numerical Keypad Decimal"},{key:"Divide",description:"Numerical Keypad Divide"},{key:"Multiply",description:"Multiply (*)"},{key:"Subtract",description:"Subtract (-)"},{key:"Add",description:"Add (+)"},{key:"numpadenter",description:"Numerical Keypad Enter"}]},function:{name:"Function Keys",description:"F1-F24 function keys",keys:[{key:"F5",description:"Function Key 5"},{key:"F6",description:"Function Key 6"},{key:"F7",description:"Function Key 7"},{key:"F8",description:"Function Key 8"},{key:"F9",description:"Function Key 9"},{key:"F10",description:"Function Key 10"},{key:"F11",description:"Function Key 11"},{key:"F12",description:"Function Key 12"},{key:"F13",description:"Function Key 13"},{key:"F14",description:"Function Key 14"},{key:"F15",description:"Function Key 15"},{key:"F16",description:"Function Key 16"},{key:"F17",description:"Function Key 17"},{key:"F18",description:"Function Key 18"},{key:"F19",description:"Function Key 19"},{key:"F20",description:"Function Key 20"},{key:"F21",description:"Function Key 21"},{key:"F22",description:"Function Key 22"},{key:"F23",description:"Function Key 23"},{key:"F24",description:"Function Key 24"}]},arrows:{name:"Arrow & Navigation",description:"Arrow keys and navigation",keys:[{key:"Up",description:"Arrow Key: Up"},{key:"Down",description:"Arrow Key: Down"},{key:"Left",description:"Arrow Key: Left"},{key:"Right",description:"Arrow Key: Right"},{key:"Home",description:"Home"},{key:"End",description:"End"},{key:"PageUp",description:"Page Up"},{key:"PageDown",description:"Page Down"},{key:"insert",description:"Insert"},{key:"delete",description:"Delete"}]},modifiers:{name:"Modifier Keys",description:"Shift, Ctrl, Alt variations",keys:[{key:"ALT",description:"Alt"},{key:"LALT",description:"Alt (Left)"},{key:"RALT",description:"Alt (Right)"},{key:"CTRL",description:"Control"},{key:"LCTRL",description:"Control (Left)"},{key:"RCTRL",description:"Control (Right)"}]},symbols:{name:"Symbol Keys",description:"Punctuation and symbols",keys:[{key:"[",description:"["},{key:"]",description:"]"},{key:"\\",description:"\\"},{key:",",description:"Comma (,)"},{key:".",description:"Period (.)"},{key:"/",description:"Divide (/)"},{key:"`",description:"Tilda Key (~)"}]},mouse:{name:"Mouse Controls",description:"Mouse buttons and scroll",keys:[{key:"Lbutton",description:"Mouse Left Press"},{key:"Rbutton",description:"Mouse Right Press"},{key:"Middleclick",description:"Mouse Middle Click"},{key:"Button1",description:"Mouse Button 1"},{key:"Button2",description:"Mouse Button 2"},{key:"Button3",description:"Mouse Button 3"},{key:"Button4",description:"Mouse Button 4"},{key:"Button5",description:"Mouse Button 5"},{key:"Button6",description:"Mouse Button 6"},{key:"Button7",description:"Mouse Button 7"},{key:"Button8",description:"Mouse Button 8"},{key:"Button9",description:"Mouse Button 9"},{key:"Button10",description:"Mouse Button 10"},{key:"Wheelplus",description:"Mouse Scroll Up"},{key:"Wheelminus",description:"Mouse Scroll Down"}]},gamepad:{name:"Xbox Controller",description:"Xbox/Gamepad controls",keys:[{key:"Joy1",description:"XBOX Contr [Start]"},{key:"Joy2",description:"XBOX Contr [Back]"},{key:"Joy3",description:"XBOX Contr [L Thumb depress]"},{key:"Joy4",description:"XBOX Contr [R Thumb depress]"},{key:"Joy5",description:"XBOX Contr [Left Bumper]"},{key:"Joy6",description:"XBOX Contr [Right Bumper]"},{key:"Joy7",description:"XBOX Contr [Left Trigger]"},{key:"Joy8",description:"XBOX Contr [Right Trigger]"},{key:"Joy9",description:"XBOX Contr [A Button]"},{key:"Joy10",description:"XBOX Contr [B Button]"},{key:"Joy11",description:"XBOX Contr [X Button]"},{key:"Joy12",description:"XBOX Contr [Y Button]"},{key:"Joypad_up",description:"XBOX Contr [Pad up]"},{key:"Joypad_down",description:"XBOX Contr [Pad down]"},{key:"Joypad_left",description:"XBOX Contr [Pad left]"},{key:"Joypad_right",description:"XBOX Contr [Pad right]"},{key:"Lstick_up",description:"XBOX Contr [Left Stick up]"},{key:"Lstick_down",description:"XBOX Contr [Left Stick down]"},{key:"Lstick_left",description:"XBOX Contr [Left Stick left]"},{key:"Lstick_right",description:"XBOX Contr [Left Stick right]"},{key:"Rstick_up",description:"XBOX Contr [Right Stick up]"},{key:"Rstick_down",description:"XBOX Contr [Right Stick down]"},{key:"Rstick_left",description:"XBOX Contr [Right Stick left]"},{key:"Rstick_right",description:"XBOX Contr [Right Stick right]"}]}},validation:{keyNamePattern:"USE_STO_KEY_NAMES",aliasNamePattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,maxCommandsPerKey:20,maxKeysPerProfile:100},settings:{version:"1.0.0",autoSave:!0,maxUndoSteps:50,defaultMode:"space",language:"en"},variables:{target:{variable:"$Target",description:"Replaced with the name of your current target",example:"team Target [$Target]",usableIn:["communication","custom","aliases"],notes:"If your target's name is 'froggyMonster', this will output 'Target [froggyMonster]'"}},vfxEffects:{space:[{label:"Advanced inhibiting turret shield bubble",effect:"Fx_Rep_Temporal_Ship_Chroniton_Stabilization_Proc"},{label:"Approaching Agony",effect:"Cfx_Lockboxfx_Cb29_Ship_Agony_Field"},{label:"Attack Pattern Alpha",effect:"Fx_Ship_Tac_Attackpatternalpha"},{label:"Attack Pattern Beta",effect:"Fx_Ship_Tac_Attackpatternbeta"},{label:"Attack Pattern Delta",effect:"Fx_Ship_Tac_Attackpatterndelta"},{label:"Attack Pattern Omega",effect:"Fx_Ship_Tac_Attackpatternomega"},{label:"Beacon of Kahless",effect:"Fx_Er_Bbs_Beacon_Of_Kahless_Flash"},{label:"Boost Morale",effect:"Fx_Ship_Spec_Powers_Command_Boost_Morale_Bufffx,Cfx_Ship_Spec_Powers_Command_Boost_Morale_Activate"},{label:"Brace for Impact",effect:"Fx_Bop_Braceforimpact,Cfx_Ship_Sci_Hazardemitter_Buff"},{label:"Breath of the Dragon",effect:"Fx_Ship_Cp_T6_Hysperian_Dragonbreath"},{label:"Call Emergency Artillery",effect:"Fx_Ships_Boffs_Cmd_Callartillery_Activate,Fx_Ships_Boffs_Cmd_Callartillery_Explosion"},{label:"Competitive Engine Buff Effect",effect:"Fx_Ship_Mod_Haste_Buff_Gen"},{label:"Co-opt Energy Weapons",effect:"Fx_Capt_Powers_Ship_Sci_Coopt_Energy_Wep_Aoe,Cfx_Capt_Powers_Ship_Sci_Coopt_Energy_Wep_Area"},{label:"Concentrate Fire Power",effect:"Fx_Ships_Boff_Cmd_Confire_Activatefx,Cfx_Ships_Boff_Cmd_Confire_Mark"},{label:"Cnidarian Jellyfish AoE",effect:"Cfx_Ship_Sp_T6_Jellyfish_Cnidarian_Defense_Aoe"},{label:"Dark Matter Anomaly",effect:"Cfx_Ship_Console_Dark_Matter_Anamoly_Costumefx"},{label:"Delphic Tear",effect:"Fx_Ships_Consoles_Cb21_Delphictear"},{label:"Destabilising Resonance Beam",effect:"P_Er_Ship_Destabilizing_Resonance_Beam_Aoe_Particles"},{label:"Elachi Walker Combat Pet (3 effects)",effect:"Soundfx_Elachiwalker_Footstep_Pet,Fx_Er_Tfo_Elachi_Walker_Combat_Pet_Deathfx,Soundfx_Elachiwalker_Petsummon"},{label:"Electrified Anomalies Trait",effect:"Fx_Tp_Ship_T6_Risian_Science_Electrified_Anomalies_Arc_Foe,Fx_Tp_Ship_T6_Risian_Science_Electrified_Anomalies_Arc_Friend"},{label:"Emergency Pwr to Shields",effect:"Fx_Ship_Eng_Emergencypowershields"},{label:"Emergency Pwr to Wep",effect:"Fx_Ship_Eng_Emergencypowerweapons"},{label:"Engineering Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Engineering_Teambuff"},{label:"Engineering Team",effect:"Cfx_Ship_Crewteam_Engineeringteam_Buff"},{label:"EPS Power Transfer",effect:"Cfx_Ship_Eng_Epspowertransfer_Target"},{label:"Focus Frenzy",effect:"Fx_Skilltree_Ship_Ffrenzy_Activatefx"},{label:"Go Down Fighting",effect:"Fx_Bop_Godownfighting"},{label:"Hangar Pet Rank Up",effect:"Fx_Ship_Levelup_Fighter_Rankup"},{label:"Hazard Emitters",effect:"Cfx_Ship_Sci_Hazardemitter_Buff"},{label:"Intel Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Intel_Teambuff"},{label:"Intel Team (uses 3 effects)",effect:"Cfx_Ship_Cruiser_Auras_Taunt,Cfx_Spc_Boffpowers_Intel_Intelteam_Buff,Fx_Ships_Intel_Lyinginwait"},{label:"Kemocite on ship animation",effect:"C1_E_Ship_Xindi_Lockboxcb15_Kemocite_Weaponry_Bufffx"},{label:"Kemocite HitFX ring",effect:"Fx_Ship_Xindi_Lockboxcb15_Kemocite_Weaponry_Aoe_Proc"},{label:"Kentari Ferocity Weapons Glow",effect:"P_Trait_Powers_Ship_Lukari_Colony_Kentari_Ferocity_Weapons_Glow"},{label:"Kobayashi Maru powerup silenced",effect:"Fx_Evr_Kmaru_Ship_Dev_Resupply_Drop_Powerup_Bufffx,Fx_Evr_Kmaru_Ship_Dev_Resupply_Drop_Powerup"},{label:"Less Obvious Loot Drop Common",effect:"Cfx_Space_Loot_Drop_Common_Costumefx"},{label:"Less Obvious Loot Drop Uncommon",effect:"Cfx_Space_Loot_Drop_Uncommon_Costumefx"},{label:"Less Obvious Loot Drop Rare",effect:"Cfx_Space_Loot_Drop_Rare_Costumefx"},{label:"Less Obvious Loot Drop Very Rare",effect:"Cfx_Space_Loot_Drop_Veryrare_Costumefx"},{label:"Less Obvious Loot Drop Lock Box",effect:"Cfx_Space_Loot_Drop_Chancebox_Costumefx"},{label:"Less Obvious Loot Drop Dilithium",effect:"Cfx_Space_Loot_Drop_Dilithium_Costumefx"},{label:"Miraculous Repairs",effect:"Fx_Bop_Miracleworker"},{label:"MW - Align Shield Frequencies",effect:"Fx_Spc_Boffpowers_Miracleworker_Alignshieldfrequencies_Hitfx"},{label:"MW - Destabilize Warp Core",effect:"Fx_Spc_Boffpowers_Miracleworker_Destabilizewarpcore"},{label:"MW - Exceed rated limits",effect:"Fx_Spc_Boffpowers_Miracleworker_Energyweaponsexceedratedlimits_Dot_Hitfx,Fx_Spc_Boffpowers_Miracleworker_Energyweaponsexceedratedlimits"},{label:"MW - Fix em up (and other green glows)",effect:"Fx_Ship_Mod_Damage_Buff"},{label:"MW - Mixed Armaments Synergy",effect:"Fx_Spc_Boffpowers_Miracleworker_Mixedarmamentssynergy"},{label:"MW - Narrow Sensor Bands",effect:"Fx_Spc_Boffpowers_Miracleworker_Narrowsensorbands"},{label:"MW - Null Pointer Flood",effect:"Fx_Spc_Boffpowers_Miracleworker_Nullpointerflood"},{label:"MW - Reroute shilds to Hull containment",effect:"Fx_Spc_Boffpowers_Miracleworker_Rerouteshieldstohullcontainment,Cfx_Spc_Boffpowers_Miracleworker_Rerouteshieldstohullcontainment"},{label:"Nadion Inversion",effect:"Fx_Bop_Nadioinversion"},{label:"Nanoprobe Shield Generator (Dyson Rep)",effect:"Cfx_Rp_Dyson_Ship_Reactive_Shielding"},{label:"Neutronic Eddies",effect:"Cfx_Ships_Cp_T6_Risian_Science_Neutronic_Edides_Costumefx"},{label:"Overwhelm Emitters",effect:"Fx_Ships_Boff_Cmd_Owemitters_Activatefx"},{label:"Photonic Officer",effect:"Fx_Bop_Photonicofficer_activate"},{label:"PILOT - Clean Getaway",effect:"Fx_Spc_Boff_Pilot_Cleangetaway_Activate"},{label:"PILOT - Coolant Ignition (mostly)",effect:"Fx_Spc_Boff_Pilot_Coolantinjection_Ignite,Fx_Spc_Boff_Pilot_Coolantinjection_Costumefx"},{label:"PILOT - Deploy Countermeasures",effect:"Fx_Spc_Boff_Pilot_Deploycm"},{label:"PILOT - Fly her apart",effect:"Cfx_Spc_Boff_Pilot_Flyapart_Dot"},{label:"PILOT - Form Up (mostly)",effect:"Fx_Spc_Boff_Pilot_Formup_Teleport,Fx_Spc_Boff_Pilot_Formup_Buff_Wepbuff"},{label:"PILOT - hold Together",effect:"Cfx_Spc_Boff_Pilot_Holdtogether"},{label:"PILOT - Lambda",effect:"Fx_Ship_Mod_Damage_Buff,Fx_Spc_Boff_Pilot_Aplambda_Bufffx,Fx_Spc_Boff_Pilot_Aplambda"},{label:"PILOT - Lock Trajectory",effect:"Fx_Spc_Boff_Pilot_Flares_Switch,Cfx_Spc_Boff_Pilot_Locktrajectory"},{label:"PILOT - Pilot Team",effect:"Cfx_Spc_Boff_Pilot_Pilotteam_Buff"},{label:"PILOT - Reroute Reserves to Weapons",effect:"Fx_Spc_Boff_Pilot_Reroute_Wepbuff,Fx_Spc_Boff_Pilot_Reroute_Activate"},{label:"PILOT - Subspace Boom",effect:"Cfx_Spc_Boff_Pilot_Ssboom_Costumefx_Neverdie,Fx_Spc_Boff_Pilot_Ssboom_Boom"},{label:"Plasma Storm",effect:"Cfx_Ship_Cp_Cb27_Generate_Plasma_Storm_Costumefx"},{label:"Rally Point Marker",effect:"Cfx_Ships_Boff_Cmd_Rallypoint_Marker"},{label:"Reverse Shield Polarity",effect:"Cfx_Ship_Eng_Reverseshieldpolarity_Buff"},{label:"Scattering Field",effect:"Cfx_Ship_Sci_Dampeningfield_Aoe,Cfx_Ship_Sci_Dampeningfield_Shield_Buff"},{label:"Science Team",effect:"Cfx_Ship_Crewteam_Scienceteam_Buff"},{label:"Science Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Science_Teambuff"},{label:"Soliton Wave Generator (uses 4 effects)",effect:"Cfx_Ship_Risa_Loot_Soliton_Wave_Suckfx_Target,Cfx_Ship_Risa_Loot_Soliton_Wave_Suckfx,Cfx_Ship_Risa_Loot_Soliton_Wave_Out,Cfx_Ship_Risa_Loot_Soliton_Wave_In"},{label:"Spore Infused Anomalies",effect:"Fx_Trait_Powers_Ship_T6_Somerville_Sia_Blast"},{label:"Subspace Vortex Teleport Effect",effect:"Fx_Ship_Xindi_Lockboxcb15_Subspace_Vortex_Teleport"},{label:"Suppression Barrage",effect:"Cfx_Ships_Boff_Cmd_Sbarrage_Buff"},{label:"Surgical Strikes",effect:"Fx_Spc_Boffpowers_Int_Sstrikes_Buff"},{label:"Tactical Fleet III",effect:"Fx_Ship_Boff_Fleet_Capt_Tactical_Teambuff"},{label:"Tactical Initiative",effect:"Fx_Bop_Tacticalinitiative"},{label:"Tactical Team",effect:"Cfx_Ship_Crewteam_Tacticalteam_Buff"},{label:"Target Rich Environment",effect:"Fx_Ship_Trait_Cb20_Targetrichenvironment"},{label:"Temporal Anchor",effect:"Cfx_Ship_Trait_Temporal_Anchor_Costumefx"},{label:"Temporal Vortex Probe",effect:"C1_Eventreward_Fcd_Temporal_Vortex_Costumefx,Fx_Eventreward_Fcd_Temporal_Vortex_Blast"},{label:"Timeline Collapse (5 effects!)",effect:"Cfx_Ship_Temp_Tcollapse_Costume,Fx_Ship_Temp_Tcollapse_Hitfx,Fx_Ship_Temp_Tcollapse_Explode,Fx_Ship_Temp_Tcollapse_Beamhitfx,Fx_Ship_Temp_Tcollapse"},{label:"V'Ger Torpedo (Volatile Digital Transformation)",effect:"Fx_Ship_Torpedo_Plasma_Vger_Anniv_Explode,Cfx_Ship_Torpedo_Vger_Disintegrate_In_Tintable"},{label:"Viral Impulse Burst",effect:"Fx_Spc_Boffpowers_int_Viralimpulse"},{label:"Vulcan Jelly Fish Eject Red Matter",effect:"Cfx_ship_jellyfish_eject_red_matter_costumefx"},{label:"Vulnerability Assessment Sweep",effect:"Fx_Capt_Powers_Ship_Tac_Vulnerability_Assessment_Sweep"}],ground:[{label:"Agony Field Generator",effect:"Fx_Ground_Lockboxfx_Cb29_Agony_Field_Generator"},{label:"Anti-time ground",effect:"Cfx_Rep_Temp_Char_Kit_Sci_Antitime_Entanglement_Field_Costumefx"},{label:"Ball Lightning",effect:"Cfx_Char_Kit_Univ_Sum_Ball_Lightning_Costumefx"},{label:"Chaos Blaze",effect:"Cfx_Char_Chaos_Blaze_Aoe"},{label:"Conussive Tachyon Emission",effect:"fx_Char_Delta_Rep_Cte_Aoe"},{label:"Disco Ball (Party Bomb)",effect:"Cfx_Char_Device_Partybomb"},{label:"Dot-7 Drone Support Field",effect:"Cfx_Er_Bbs_char_Dot7_Drone_support_Field"},{label:"Eng Proficiency (Character Glow)",effect:"Cfx_Ground_Kit_Eng_Engineeringproficiency"},{label:"Ever Watchful",effect:"Cfx_Ground_Kit_Tac_Overwatch_Bufffx,Fx_Ground_Kit_Tac_Overwatch_Activatefx"},{label:"Herald AP Beam Projector ground weapon",effect:"Fx_Char_Icoenergy_Rifle_Energyblast,Fx_Char_Icoenergy_Assault_Beam_Lockbox"},{label:"Lava Floor",effect:"Cfx_Char_Kit_Univ_Sum_The_Floor_Is_Lava_Costumefx,Cfx_Char_Kit_Univ_Sum_The_Floor_Is_Lava_Geyser"},{label:"Less Obvious Loot Drop Common",effect:"Cfx_Gnd_Loot_Drop_Common_Costumefx"},{label:"Less Obvious Loot Drop Uncommon",effect:"Cfx_Gnd_Loot_Drop_Uncommon_Costumefx"},{label:"Less Obvious Loot Drop Rare",effect:"Cfx_Gnd_Loot_Drop_Rare_Costumefx"},{label:"Less Obvious Loot Drop Very Rare",effect:"Cfx_Gnd_Loot_Drop_Veryrare_Costumefx"},{label:"Less Obvious Loot Drop Lock Box",effect:"Cfx_Gnd_Loot_Drop_Chancebox_Costumefx"},{label:"Less Obvious Loot Drop Dilithium",effect:"Cfx_Gnd_Loot_Drop_Dilithium_Costumefx"},{label:"Motivation (Tac Kit Module)",effect:"Cfx_Ground_Kit_Tac_Motivation_Buff,Fx_Ground_Kit_Tac_Motivation"},{label:"Orbital Devastation",effect:"Fx_Char_Voth_Orbitalstrike_Chasebeam"},{label:"Pahvan Crystal Prism noisy tether",effect:"Cfx_Er_Tfo_Pahvan_Crystal_Prism_Tether_Beam"},{label:"Rally Cry",effect:"Fx_Ground_Kit_Tac_Rallycry"},{label:"Red Riker Gun Sound effect",effect:"Cfx_Ep_Winterevent_Redriker_Sniper_Chargefx"},{label:"Scientific Aptitude (character glow)",effect:"Cfx_Ground_Kit_Sci_Scientificaptitude"},{label:"Solar Gateway",effect:"Fx_Char_Ico_Capt_Portal,Fx_Char_Ico_Capt_Portal_Sunbeam"},{label:"Smoke Grenade",effect:"Fx_Char_Grenade_smoke_costume,Fx_Char_Grenade_Smoke_Explode"},{label:"Sompek Energy Rebounder",effect:"Fx_Env_Gnd_Qadhos_Arena_Phaserhazard_Cylinder_Turret"},{label:"Strike Team III (character red glow)",effect:"Cfx_Ground_Kit_Tac_Striketeam"},{label:"Symphony of Lightning Char Glow",effect:"Fx_Er_Featured_Char_Kuumaarke_Wristgun_Tir_bufffx"},{label:"Symphony of Lightning Drone AoE",effect:"Cfx_Er_Featured_Char_Kuumaarke_Set_Symphony_Of_Lightning_Drone_Aoe"},{label:"Symphony of Lightning STRIKE",effect:"Fx_Er_Featured_Char_Kuumaarke_Set_Symphony_Of_Lightning_Strike"},{label:"Trajectory Bending",effect:"Cfx_Char_Xindi_Cb15_Tac_Kit_Trajectory_Bending"},{label:"Visual Dampening Field",effect:"Cfx_Char_Trait_Mirror_Vdfield"}]}};window.STO_DATA=l,window.VFX_EFFECTS=l.vfxEffects,window.COMMAND_CATEGORIES=l.commands,window.COMMANDS={},Object.entries(l.commands).forEach(([e,t])=>{Object.entries(t.commands).forEach(([t,i])=>{window.COMMANDS[t]={...i,category:e,key:t}})}),window.KEY_LAYOUTS=l.keyLayouts||{qwerty:{name:"QWERTY",rows:[[{key:"Escape",display:"Esc"},{key:"F1",display:"F1"},{key:"F2",display:"F2"},{key:"F3",display:"F3"},{key:"F4",display:"F4"},{key:"F5",display:"F5"},{key:"F6",display:"F6"},{key:"F7",display:"F7"},{key:"F8",display:"F8"},{key:"F9",display:"F9"},{key:"F10",display:"F10"},{key:"F11",display:"F11"},{key:"F12",display:"F12"}],[{key:"`",display:"`"},{key:"1",display:"1"},{key:"2",display:"2"},{key:"3",display:"3"},{key:"4",display:"4"},{key:"5",display:"5"},{key:"6",display:"6"},{key:"7",display:"7"},{key:"8",display:"8"},{key:"9",display:"9"},{key:"0",display:"0"},{key:"-",display:"-"},{key:"=",display:"="},{key:"Backspace",display:"Backspace"}],[{key:"Tab",display:"Tab"},{key:"Q",display:"Q"},{key:"W",display:"W"},{key:"E",display:"E"},{key:"R",display:"R"},{key:"T",display:"T"},{key:"Y",display:"Y"},{key:"U",display:"U"},{key:"I",display:"I"},{key:"O",display:"O"},{key:"P",display:"P"},{key:"[",display:"["},{key:"]",display:"]"},{key:"\\",display:"\\"}],[{key:"CapsLock",display:"Caps"},{key:"A",display:"A"},{key:"S",display:"S"},{key:"D",display:"D"},{key:"F",display:"F"},{key:"G",display:"G"},{key:"H",display:"H"},{key:"J",display:"J"},{key:"K",display:"K"},{key:"L",display:"L"},{key:";",display:";"},{key:"'",display:"'"},{key:"Enter",display:"Enter"}],[{key:"Shift",display:"Shift"},{key:"Z",display:"Z"},{key:"X",display:"X"},{key:"C",display:"C"},{key:"V",display:"V"},{key:"B",display:"B"},{key:"N",display:"N"},{key:"M",display:"M"},{key:",",display:","},{key:".",display:"."},{key:"/",display:"/"},{key:"Shift",display:"Shift"}],[{key:"Ctrl",display:"Ctrl"},{key:"Alt",display:"Alt"},{key:"Space",display:"Space"},{key:"Alt",display:"Alt"},{key:"Ctrl",display:"Ctrl"}]]}},window.DEFAULT_SETTINGS={keyLayout:"qwerty",autoSave:l.settings?.autoSave||!0,showTooltips:!0,exportFormat:"txt",maxUndoSteps:l.settings?.maxUndoSteps||50,defaultMode:l.settings?.defaultMode||"space",language:l.settings?.language||"en"},window.SAMPLE_PROFILES=Object.values(l.defaultProfiles).map(e=>({id:e.name.toLowerCase().replace(/\s+/g,"_"),name:e.name,description:e.description,currentEnvironment:e.currentEnvironment||"space",builds:e.builds||{space:{keys:{}},ground:{keys:{}}},created:(new Date).toISOString(),modified:(new Date).toISOString()})),window.SAMPLE_ALIASES={attack_sequence:{name:"Attack Sequence",commands:["Target_Enemy_Near","FireAll"],description:"Target and attack nearest enemy"},defensive_sequence:{name:"Defensive Sequence",commands:["Target_Self","+power_exec Distribute_Shields"],description:"Self-target and activate defensive abilities"},heal_sequence:{name:"Healing Sequence",commands:["Target_Self","+STOTrayExecByTray 3 0 $$ +STOTrayExecByTray 3 1"],description:"Emergency healing and repair sequence"}},window.TRAY_CONFIG={maxTrays:10,slotsPerTray:10,defaultTray:0,maxCommandsPerSlot:1},window.localizeCommandData=function(){const e=window.i18next;e&&Object.entries(l.commands).forEach(([t,i])=>{i.name&&(i.name=e.t(`command_categories.${t}`)),i.description&&(i.description=e.t(`category_descriptions.${t}`)),Object.entries(i.commands).forEach(([t,i])=>{i.name&&(i.name=e.t(`command_definitions.${t}.name`)),i.description&&(i.description=e.t(`command_definitions.${t}.description`))})})};class d extends Error{constructor(e,t="STO_ERROR"){super(e),this.name="STOError",this.code=t}}class m extends d{constructor(e,t="VFX_ERROR"){super(e,t),this.name="VertigoError"}}"undefined"!=typeof window&&(window.STOError=d,window.VertigoError=m,window.InvalidEnvironmentError=class extends m{constructor(e){super(`Invalid environment '${e}'. Valid environments are: space, ground`,"INVALID_ENVIRONMENT"),this.environment=e}},window.InvalidEffectError=class extends m{constructor(e,t){super(`Invalid effect '${e}' for environment '${t}'`,"INVALID_EFFECT"),this.effectName=e,this.environment=t}});const h=e=>"string"==typeof e,u=()=>{let e,t;const i=new Promise((i,n)=>{e=i,t=n});return i.resolve=e,i.reject=t,i},p=e=>null==e?"":""+e,f=/###/g,y=e=>e&&e.indexOf("###")>-1?e.replace(f,"."):e,_=e=>!e||h(e),g=(e,t,i)=>{const n=h(t)?t.split("."):t;let a=0;for(;a<n.length-1;){if(_(e))return{};const t=y(n[a]);!e[t]&&i&&(e[t]=new i),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++a}return _(e)?{}:{obj:e,k:y(n[a])}},b=(e,t,i)=>{const{obj:n,k:a}=g(e,t,Object);if(void 0!==n||1===t.length)return void(n[a]=i);let s=t[t.length-1],o=t.slice(0,t.length-1),r=g(e,o,Object);for(;void 0===r.obj&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),r=g(e,o,Object),r?.obj&&void 0!==r.obj[`${r.k}.${s}`]&&(r.obj=void 0);r.obj[`${r.k}.${s}`]=i},v=(e,t)=>{const{obj:i,k:n}=g(e,t);if(i&&Object.prototype.hasOwnProperty.call(i,n))return i[n]},w=(e,t,i)=>{for(const n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?h(e[n])||e[n]instanceof String||h(t[n])||t[n]instanceof String?i&&(e[n]=t[n]):w(e[n],t[n],i):e[n]=t[n]);return e},k=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const x=e=>h(e)?e.replace(/[&<>"'\/]/g,e=>S[e]):e,C=[" ",",","?","!",";"],T=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}(20),B=(e,t,i=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const n=t.split(i);let a=e;for(let e=0;e<n.length;){if(!a||"object"!=typeof a)return;let t,s="";for(let o=e;o<n.length;++o)if(o!==e&&(s+=i),s+=n[o],t=a[s],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&o<n.length-1)continue;e+=o-e+1;break}a=t}return a},$=e=>e?.replace("_","-"),E={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class I{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||E,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,n){return n&&!this.debug?null:(h(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new I(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new I(this.logger,e)}}var A=new I;class F{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const i=this.observers[e].get(t)||0;this.observers[e].set(t,i+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([e,i])=>{for(let n=0;n<i;n++)e(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,n])=>{for(let a=0;a<n;a++)i.apply(i,[e,...t])})}}class P extends F{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i,n={}){const a=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,s=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,t],i&&(Array.isArray(i)?o.push(...i):h(i)&&a?o.push(...i.split(a)):o.push(i)));const r=v(this.data,o);return!r&&!t&&!i&&e.indexOf(".")>-1&&(e=o[0],t=o[1],i=o.slice(2).join(".")),!r&&s&&h(i)?B(this.data?.[e]?.[t],i,a):r}addResource(e,t,i,n,a={silent:!1}){const s=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator;let o=[e,t];i&&(o=o.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(o=e.split("."),n=t,t=o[1]),this.addNamespaces(t),b(this.data,o,n),a.silent||this.emit("added",e,t,i,n)}addResources(e,t,i,n={silent:!1}){for(const n in i)(h(i[n])||Array.isArray(i[n]))&&this.addResource(e,t,n,i[n],{silent:!0});n.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,n,a,s={silent:!1,skipCopy:!1}){let o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),n=i,i=t,t=o[1]),this.addNamespaces(t);let r=v(this.data,o)||{};s.skipCopy||(i=JSON.parse(JSON.stringify(i))),n?w(r,i,a):r={...r,...i},b(this.data,o,r),s.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var D={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,i,n,a){return e.forEach(e=>{t=this.processors[e]?.process(t,i,n,a)??t}),t}};const M={},N=e=>!h(e)&&"boolean"!=typeof e&&"number"!=typeof e;class L extends F{constructor(e,t={}){var i,n;super(),i=e,n=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{i[e]&&(n[e]=i[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=A.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const i={...t};if(null==e)return!1;const n=this.resolve(e,i);return void 0!==n?.res}extractFromKey(e,t){let i=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===i&&(i=":");const n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let a=t.ns||this.options.defaultNS||[];const s=i&&e.indexOf(i)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,i)=>{t=t||"",i=i||"";const n=C.filter(e=>t.indexOf(e)<0&&i.indexOf(e)<0);if(0===n.length)return!0;const a=T.getRegExp(`(${n.map(e=>"?"===e?"\\?":e).join("|")})`);let s=!a.test(e);if(!s){const t=e.indexOf(i);t>0&&!a.test(e.substring(0,t))&&(s=!0)}return s})(e,i,n));if(s&&!o){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:h(a)?[a]:a};const s=e.split(i);(i!==n||i===n&&this.options.ns.indexOf(s[0])>-1)&&(a=s.shift()),e=s.join(n)}return{key:e,namespaces:h(a)?[a]:a}}translate(e,t,i){let n="object"==typeof t?{...t}:t;if("object"!=typeof n&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(n={...n}),n||(n={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const a=void 0!==n.returnDetails?n.returnDetails:this.options.returnDetails,s=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,{key:o,namespaces:r}=this.extractFromKey(e[e.length-1],n),c=r[r.length-1];let l=void 0!==n.nsSeparator?n.nsSeparator:this.options.nsSeparator;void 0===l&&(l=":");const d=n.lng||this.language,m=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===d?.toLowerCase())return m?a?{res:`${c}${l}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:`${c}${l}${o}`:a?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:o;const u=this.resolve(e,n);let p=u?.res;const f=u?.usedKey||o,y=u?.exactUsedKey||o,_=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,g=!this.i18nFormat||this.i18nFormat.handleAsObject,b=void 0!==n.count&&!h(n.count),v=L.hasDefaultValue(n),w=b?this.pluralResolver.getSuffix(d,n.count,n):"",k=n.ordinal&&b?this.pluralResolver.getSuffix(d,n.count,{ordinal:!1}):"",S=b&&!n.ordinal&&0===n.count,x=S&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${w}`]||n[`defaultValue${k}`]||n.defaultValue;let C=p;g&&!p&&v&&(C=x);const T=N(C),B=Object.prototype.toString.apply(C);if(!(g&&C&&T&&["[object Number]","[object Function]","[object RegExp]"].indexOf(B)<0)||h(_)&&Array.isArray(C))if(g&&h(_)&&Array.isArray(p))p=p.join(_),p&&(p=this.extendTranslation(p,e,n,i));else{let t=!1,a=!1;!this.isValidLookup(p)&&v&&(t=!0,p=x),this.isValidLookup(p)||(a=!0,p=o);const r=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&a?void 0:p,m=v&&x!==p&&this.options.updateMissing;if(a||t||m){if(this.logger.log(m?"updateKey":"missingKey",d,c,o,m?x:p),s){const e=this.resolve(o,{...n,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let i=0;i<t.length;i++)e.push(t[i]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(n.lng||this.language):e.push(n.lng||this.language);const i=(e,t,i)=>{const a=v&&i!==p?i:r;this.options.missingKeyHandler?this.options.missingKeyHandler(e,c,t,a,m,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,c,t,a,m,n),this.emit("missingKey",e,c,t,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&b?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,n);S&&n[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{i([e],o+t,n[`defaultValue${t}`]||x)})}):i(e,o,x))}p=this.extendTranslation(p,e,n,u,i),a&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${c}${l}${o}`),(a||t)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}${l}${o}`:o,t?p:void 0,n))}else{if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,C,{...n,ns:r}):`key '${o} (${this.language})' returned an object instead of string.`;return a?(u.res=e,u.usedParams=this.getUsedParamsDetails(n),u):e}if(s){const e=Array.isArray(C),t=e?[]:{},i=e?y:f;for(const e in C)if(Object.prototype.hasOwnProperty.call(C,e)){const a=`${i}${s}${e}`;t[e]=v&&!p?this.translate(a,{...n,defaultValue:N(x)?x[e]:void 0,joinArrays:!1,ns:r}):this.translate(a,{...n,joinArrays:!1,ns:r}),t[e]===a&&(t[e]=C[e])}p=t}}return a?(u.res=p,u.usedParams=this.getUsedParamsDetails(n),u):p}extendTranslation(e,t,i,n,a){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const s=h(e)&&(void 0!==i?.interpolation?.skipOnVariables?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let o;if(s){const t=e.match(this.interpolator.nestingRegexp);o=t&&t.length}let r=i.replace&&!h(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),e=this.interpolator.interpolate(e,r,i.lng||this.language||n.usedLng,i),s){const t=e.match(this.interpolator.nestingRegexp);o<(t&&t.length)&&(i.nest=!1)}!i.lng&&n&&n.res&&(i.lng=this.language||n.usedLng),!1!==i.nest&&(e=this.interpolator.nest(e,(...e)=>a?.[0]!==e[0]||i.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),i)),i.interpolation&&this.interpolator.reset()}const s=i.postProcess||this.options.postProcess,o=h(s)?[s]:s;return null!=e&&o?.length&&!1!==i.applyPostProcessor&&(e=D.handle(o,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e,t={}){let i,n,a,s,o;return h(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(i))return;const r=this.extractFromKey(e,t),c=r.key;n=c;let l=r.namespaces;this.options.fallbackNS&&(l=l.concat(this.options.fallbackNS));const d=void 0!==t.count&&!h(t.count),m=d&&!t.ordinal&&0===t.count,u=void 0!==t.context&&(h(t.context)||"number"==typeof t.context)&&""!==t.context,p=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);l.forEach(e=>{this.isValidLookup(i)||(o=e,M[`${p[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(o)||(M[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(n=>{if(this.isValidLookup(i))return;s=n;const o=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(o,c,n,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(n,t.count,t));const i=`${this.options.pluralSeparator}zero`,a=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(o.push(c+e),t.ordinal&&0===e.indexOf(a)&&o.push(c+e.replace(a,this.options.pluralSeparator)),m&&o.push(c+i)),u){const n=`${c}${this.options.contextSeparator}${t.context}`;o.push(n),d&&(o.push(n+e),t.ordinal&&0===e.indexOf(a)&&o.push(n+e.replace(a,this.options.pluralSeparator)),m&&o.push(n+i))}}let r;for(;r=o.pop();)this.isValidLookup(i)||(a=r,i=this.getResource(n,e,r,t))}))})}),{res:i,usedKey:n,exactUsedKey:a,usedLng:s,usedNS:o}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,i,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,n):this.resourceStore.getResource(e,t,i,n)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!h(e.replace);let n=i?e.replace:e;if(i&&void 0!==e.count&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!i){n={...n};for(const e of t)delete n[e]}return n}static hasDefaultValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}class z{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=A.create("languageUtils")}getScriptPartFromCode(e){if(!(e=$(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=$(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(h(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const i=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(i)||(t=i)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const i=this.getScriptPartFromCode(e);if(this.isSupportedCode(i))return t=i;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0?void 0:e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),h(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),n=[],a=e=>{e&&(this.isSupportedCode(e)?n.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return h(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&a(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&a(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&a(this.getLanguagePartFromCode(e))):h(e)&&a(this.formatLanguageCode(e)),i.forEach(e=>{n.indexOf(e)<0&&a(this.formatLanguageCode(e))}),n}}const K={zero:0,one:1,two:2,few:3,many:4,other:5},R={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class j{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=A.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const i=$("dev"===e?"en":e),n=t.ordinal?"ordinal":"cardinal",a=JSON.stringify({cleanedCode:i,type:n});if(a in this.pluralRulesCache)return this.pluralRulesCache[a];let s;try{s=new Intl.PluralRules(i,{type:n})}catch(i){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),R;if(!e.match(/-|_/))return R;const n=this.languageUtils.getLanguagePartFromCode(e);s=this.getRule(n,t)}return this.pluralRulesCache[a]=s,s}needsPlural(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,i={}){return this.getSuffixes(e,i).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((e,t)=>K[e]-K[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,i={}){const n=this.getRule(e,i);return n?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const O=(e,t,i,n=".",a=!0)=>{let s=((e,t,i)=>{const n=v(e,i);return void 0!==n?n:v(t,i)})(e,t,i);return!s&&a&&h(i)&&(s=B(e,i,n),void 0===s&&(s=B(t,i,n))),s},U=e=>e.replace(/\$/g,"$$$$");class q{constructor(e={}){this.logger=A.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:n,prefix:a,prefixEscaped:s,suffix:o,suffixEscaped:r,formatSeparator:c,unescapeSuffix:l,unescapePrefix:d,nestingPrefix:m,nestingPrefixEscaped:h,nestingSuffix:u,nestingSuffixEscaped:p,nestingOptionsSeparator:f,maxReplaces:y,alwaysFormat:_}=e.interpolation;this.escape=void 0!==t?t:x,this.escapeValue=void 0===i||i,this.useRawValueToEscape=void 0!==n&&n,this.prefix=a?k(a):s||"{{",this.suffix=o?k(o):r||"}}",this.formatSeparator=c||",",this.unescapePrefix=l?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=m?k(m):h||k("$t("),this.nestingSuffix=u?k(u):p||k(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=y||1e3,this.alwaysFormat=void 0!==_&&_,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,n){let a,s,o;const r=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const a=O(t,r,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(a,void 0,i,{...n,...t,interpolationkey:e}):a}const a=e.split(this.formatSeparator),s=a.shift().trim(),o=a.join(this.formatSeparator).trim();return this.format(O(t,r,s,this.options.keySeparator,this.options.ignoreJSONStructure),o,i,{...n,...t,interpolationkey:s})};this.resetRegExp();const l=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=void 0!==n?.interpolation?.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>U(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?U(this.escape(e)):U(e)}].forEach(t=>{for(o=0;a=t.regex.exec(e);){const i=a[1].trim();if(s=c(i),void 0===s)if("function"==typeof l){const t=l(e,a,n);s=h(t)?t:""}else if(n&&Object.prototype.hasOwnProperty.call(n,i))s="";else{if(d){s=a[0];continue}this.logger.warn(`missed to pass in variable ${i} for interpolating ${e}`),s=""}else h(s)||this.useRawValueToEscape||(s=p(s));const r=t.safeValue(s);if(e=e.replace(a[0],r),d?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=a[0].length):t.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t,i={}){let n,a,s;const o=(e,t)=>{const i=this.nestingOptionsSeparator;if(e.indexOf(i)<0)return e;const n=e.split(new RegExp(`${i}[ ]*{`));let a=`{${n[1]}`;e=n[0],a=this.interpolate(a,s);const o=a.match(/'/g),r=a.match(/"/g);((o?.length??0)%2==0&&!r||r.length%2!=0)&&(a=a.replace(/'/g,'"'));try{s=JSON.parse(a),t&&(s={...t,...s})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${i}${a}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let r=[];s={...i},s=s.replace&&!h(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let c=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),r=e,c=!0}if(a=t(o.call(this,n[1].trim(),s),s),a&&n[0]===e&&!h(a))return a;h(a)||(a=p(a)),a||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),a=""),c&&(a=r.reduce((e,t)=>this.format(e,t,i.lng,{...i,interpolationkey:n[1].trim()}),a.trim())),e=e.replace(n[0],a),this.regexp.lastIndex=0}return e}}const G=e=>{const t={};return(i,n,a)=>{let s=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(s={...s,[a.interpolationkey]:void 0});const o=n+JSON.stringify(s);let r=t[o];return r||(r=e($(n),a),t[o]=r),r(i)}},V=e=>(t,i,n)=>e($(i),n)(t);class J{constructor(e={}){this.logger=A.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const i=t.cacheInBuiltFormats?G:V;this.formats={number:i((e,t)=>{const i=new Intl.NumberFormat(e,{...t});return e=>i.format(e)}),currency:i((e,t)=>{const i=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>i.format(e)}),datetime:i((e,t)=>{const i=new Intl.DateTimeFormat(e,{...t});return e=>i.format(e)}),relativetime:i((e,t)=>{const i=new Intl.RelativeTimeFormat(e,{...t});return e=>i.format(e,t.range||"day")}),list:i((e,t)=>{const i=new Intl.ListFormat(e,{...t});return e=>i.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=G(t)}format(e,t,i,n={}){const a=t.split(this.formatSeparator);if(a.length>1&&a[0].indexOf("(")>1&&a[0].indexOf(")")<0&&a.find(e=>e.indexOf(")")>-1)){const e=a.findIndex(e=>e.indexOf(")")>-1);a[0]=[a[0],...a.splice(1,e)].join(this.formatSeparator)}return a.reduce((e,t)=>{const{formatName:a,formatOptions:s}=(e=>{let t=e.toLowerCase().trim();const i={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const a=n[1].substring(0,n[1].length-1);"currency"===t&&a.indexOf(":")<0?i.currency||(i.currency=a.trim()):"relativetime"===t&&a.indexOf(":")<0?i.range||(i.range=a.trim()):a.split(";").forEach(e=>{if(e){const[t,...n]=e.split(":"),a=n.join(":").trim().replace(/^'+|'+$/g,""),s=t.trim();i[s]||(i[s]=a),"false"===a&&(i[s]=!1),"true"===a&&(i[s]=!0),isNaN(a)||(i[s]=parseInt(a,10))}})}return{formatName:t,formatOptions:i}})(t);if(this.formats[a]){let t=e;try{const o=n?.formatParams?.[n.interpolationkey]||{},r=o.locale||o.lng||n.locale||n.lng||i;t=this.formats[a](e,r,{...s,...n,...o})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${a}`),e},e)}}class W extends F{constructor(e,t,i,n={}){super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=n,this.logger=A.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,n.backend,n)}queueLoad(e,t,i,n){const a={},s={},o={},r={};return e.forEach(e=>{let n=!0;t.forEach(t=>{const o=`${e}|${t}`;!i.reload&&this.store.hasResourceBundle(e,t)?this.state[o]=2:this.state[o]<0||(1===this.state[o]?void 0===s[o]&&(s[o]=!0):(this.state[o]=1,n=!1,void 0===s[o]&&(s[o]=!0),void 0===a[o]&&(a[o]=!0),void 0===r[t]&&(r[t]=!0)))}),n||(o[e]=!0)}),(Object.keys(a).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(a),pending:Object.keys(s),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(r)}}loaded(e,t,i){const n=e.split("|"),a=n[0],s=n[1];t&&this.emit("failedLoading",a,s,t),!t&&i&&this.store.addResourceBundle(a,s,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const o={};this.queue.forEach(i=>{((e,t,i)=>{const{obj:n,k:a}=g(e,t,Object);n[a]=n[a]||[],n[a].push(i)})(i.loaded,[a],s),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(i,e),t&&i.errors.push(t),0!==i.pendingCount||i.done||(Object.keys(i.loaded).forEach(e=>{o[e]||(o[e]={});const t=i.loaded[e];t.length&&t.forEach(t=>{void 0===o[e][t]&&(o[e][t]=!0)})}),i.done=!0,i.errors.length?i.callback(i.errors):i.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(e=>!e.done)}read(e,t,i,n=0,a=this.retryTimeout,s){if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:i,tried:n,wait:a,callback:s});this.readingCalls++;const o=(o,r)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}o&&r&&n<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,i,n+1,2*a,s)},a):s(o,r)},r=this.backend[i].bind(this.backend);if(2!==r.length)return r(e,t,o);try{const i=r(e,t);i&&"function"==typeof i.then?i.then(e=>o(null,e)).catch(o):o(null,i)}catch(e){o(e)}}prepareLoading(e,t,i={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();h(e)&&(e=this.languageUtils.toResolveHierarchy(e)),h(t)&&(t=[t]);const a=this.queueLoad(e,t,i,n);if(!a.toLoad.length)return a.pending.length||n(),null;a.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e,t=""){const i=e.split("|"),n=i[0],a=i[1];this.read(n,a,"read",void 0,void 0,(i,s)=>{i&&this.logger.warn(`${t}loading namespace ${a} for language ${n} failed`,i),!i&&s&&this.logger.log(`${t}loaded namespace ${a} for language ${n}`,s),this.loaded(e,i,s)})}saveMissing(e,t,i,n,a,s={},o=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=i&&""!==i){if(this.backend?.create){const r={...s,isUpdate:a},c=this.backend.create.bind(this.backend);if(c.length<6)try{let a;a=5===c.length?c(e,t,i,n,r):c(e,t,i,n),a&&"function"==typeof a.then?a.then(e=>o(null,e)).catch(o):o(null,a)}catch(e){o(e)}else c(e,t,i,n,o,r)}e&&e[0]&&this.store.addResource(e[0],t,i,n)}}else this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const X=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),h(e[1])&&(t.defaultValue=e[1]),h(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const i=e[3]||e[2];Object.keys(i).forEach(e=>{t[e]=i[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),H=e=>(h(e.ns)&&(e.ns=[e.ns]),h(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),h(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),Z=()=>{};class Y extends F{constructor(e={},t){var i;if(super(),this.options=H(e),this.services={},this.logger=A,this.modules={external:[]},i=this,Object.getOwnPropertyNames(Object.getPrototypeOf(i)).forEach(e=>{"function"==typeof i[e]&&(i[e]=i[e].bind(i))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(h(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const i=X();this.options={...i,...this.options,...H(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator);const n=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?A.init(n(this.modules.logger),this.options):A.init(null,this.options),e=this.modules.formatter?this.modules.formatter:J;const t=new z(this.options);this.store=new P(this.options.resources,this.options);const a=this.services;a.logger=A,a.resourceStore=this.store,a.languageUtils=t,a.pluralResolver=new j(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!e||this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format||(a.formatter=n(e),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new q(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new W(n(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(a.languageDetector=n(this.modules.languageDetector),a.languageDetector.init&&a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=n(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new L(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=Z),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const a=u(),s=()=>{const e=(e,i)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(i),t(e,i)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?s():setTimeout(s,0),a}loadResources(e,t=Z){let i=t;const n=h(e)?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===n?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return i();const e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};n?t(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),i(e)})}else i(null)}reloadResources(e,t,i){const n=u();return"function"==typeof e&&(i=e,e=void 0),"function"==typeof t&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=Z),this.services.backendConnector.reload(e,t,e=>{n.resolve(),i(e)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&D.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const i=u();this.emit("languageChanging",e);const n=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},a=(a,s)=>{s?this.isLanguageChangingTo===e&&(n(s),this.translator.changeLanguage(s),this.isLanguageChangingTo=void 0,this.emit("languageChanged",s),this.logger.log("languageChanged",s)):this.isLanguageChangingTo=void 0,i.resolve((...e)=>this.t(...e)),t&&t(a,(...e)=>this.t(...e))},s=t=>{e||t||!this.services.languageDetector||(t=[]);const i=h(t)?t:t&&t[0],s=this.store.hasLanguageSomeTranslations(i)?i:this.services.languageUtils.getBestMatchFromCodes(h(t)?[t]:t);s&&(this.language||n(s),this.translator.language||this.translator.changeLanguage(s),this.services.languageDetector?.cacheUserLanguage?.(s)),this.loadResources(s,e=>{a(e,s)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),i}getFixedT(e,t,i){const n=(e,t,...a)=>{let s;s="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(a)):{...t},s.lng=s.lng||n.lng,s.lngs=s.lngs||n.lngs,s.ns=s.ns||n.ns,""!==s.keyPrefix&&(s.keyPrefix=s.keyPrefix||i||n.keyPrefix);const o=this.options.keySeparator||".";let r;return r=s.keyPrefix&&Array.isArray(e)?e.map(e=>`${s.keyPrefix}${o}${e}`):s.keyPrefix?`${s.keyPrefix}${o}${e}`:e,this.t(r,s)};return h(e)?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=i,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,a=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;const s=(e,t)=>{const i=this.services.backendConnector.state[`${e}|${t}`];return-1===i||0===i||2===i};if(t.precheck){const e=t.precheck(this,s);if(void 0!==e)return e}return!(!this.hasResourceBundle(i,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!s(i,e)||n&&!s(a,e)))}loadNamespaces(e,t){const i=u();return this.options.ns?(h(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=u();h(e)&&(e=[e]);const n=this.options.preload||[],a=e.filter(e=>n.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return a.length?(this.options.preload=n.concat(a),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services?.languageUtils||new z(X());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){return new Y(e,t)}cloneInstance(e={},t=Z){const i=e.forkResourceStore;i&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},a=new Y(n);if(void 0===e.debug&&void 0===e.prefix||(a.logger=a.logger.clone(e)),["store","services","language"].forEach(e=>{a[e]=this[e]}),a.services={...this.services},a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},i){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((i,n)=>(i[n]={...e[t][n]},i),e[t]),e),{});a.store=new P(e,n),a.services.resourceStore=a.store}return a.translator=new L(a.services,n),a.translator.on("*",(e,...t)=>{a.emit(e,...t)}),a.init(n,t),a.translator.options=n,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Q=Y.createInstance();Q.createInstance=Y.createInstance,Q.createInstance,Q.dir,Q.init,Q.loadResources,Q.reloadResources,Q.use,Q.changeLanguage,Q.getFixedT,Q.t,Q.exists,Q.setDefaultNamespace,Q.hasLoadedNamespace,Q.loadNamespaces,Q.loadLanguages;var ee={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Save",explorer:"Explorer",import_keybinds:"Import Keybinds",import_environment:"Import Keybinds",import_environment_question:"Choose an environment to import this keybind file to",aliases:"Aliases",import_aliases:"Import Aliases",import_kbf_file:"Import KBF File",select_bindsets_to_import:"Select Bindsets to Import",select_bindsets_to_import_question:"This KBF file contains multiple bindsets. Choose which bindsets you want to import:",import_selected:"Import Selected",kbf_import_progress:"Importing KBF File",kbf_import_progress_message:"Please wait while the KBF file is being processed...",kbf_progress_layer:"Layer {{layer}}",kbf_progress_initializing:"Initializing...",kbf_progress_preparing:"Preparing to import...",kbf_progress_decode_layer1:"Decoding file format",kbf_progress_parse_layer2:"Parsing bindset records",kbf_progress_parse_layer3:"Processing key data",kbf_progress_parse_layer4:"Analyzing key assignments",kbf_progress_parse_layer5:"Translating commands",kbf_progress_decode_layer6:"Decoding text data",kbf_progress_complete:"Finalizing import",kbf_progress_processing:"Processing...",kbf_progress_starting:"Starting {{stage}}...",kbf_progress_finished_stage:"Finished {{stage}}",import:"Import",backup:"Backup",backup_menu:"Backup",backup_application_state:"Backup Application State",restore_application_state:"Restore Application State",preferences:"Preferences",language:"Language",sync_folder_label:"Synchronization Folder:",no_folder_selected:"No folder selected",download:"Download",vfx:"VFX",dark_mode:"Dark Mode",light_mode:"Light Mode",load_default_data:"Load Default Data",reset_application:"Reset Application",set_sync_folder:"Set Sync Folder",sync_now:"Sync Now",about:"About",create:"Create",rename:"Rename",delete:"Delete",space:"Space",ground:"Ground",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"aliases",modified:"Modified",valid:"Valid",keys:"keys",keys_firstupper:"Keys",copy:"Copy",select_a_key_to_edit:"Select a key to edit",select_an_alias_to_edit:"Select an alias to edit",commands:"commands",command_singular:"command",no_key_selected:"No Key Selected",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"Select a key from the left panel to view and edit its command chain.",generated_command:"Generated Command:",generated_alias:"Generated Alias:",select_a_key_to_see_the_generated_command:"Select a key to see the generated command",select_an_alias_to_see_the_generated_command:"Select an alias to see the generated command",add_command:"Add Command",import_from_key_or_alias:"Import from Key or Alias",select_source_to_import_from:"Select source to import from:",clear_destination_chain_prior_to_import:"Clear destination chain prior to import",no_sources_available:"No sources available",error_loading_sources:"Error loading sources",please_select_a_source:"Please select a source",source_has_no_commands:"Source has no commands to import",commands_imported_successfully:"Imported {{count}} commands from {{source}}",cross_environment_import_warning:"Warning: {{dropped}} {{sourceEnv}}-specific commands were dropped when importing to {{targetEnv}}",no_compatible_commands_to_import:"No compatible commands to import after filtering",command_library:"Command Library",add_new_key:"Add New Key",ctrl:"Ctrl",alt:"Alt",shift:"Shift",cancel:"Cancel",custom:"Custom",profile:"Profile",profile_name:"Profile Name:",description_optional:"Description (optional):",alias_name:"Alias Name:",select_key_dialog_title:"Select Key",space_effects:"Space Effects",selected:"selected",ground_effects:"Ground Effects",generated_aliases:"Generated Aliases:",space_alias:"Space Alias",ground_alias:"Ground Alias",about_sto_tools_keybind_manager:"About STO Tools Keybind Manager",features:"Features:",visual_keybind_editor:"Visual keybind editor",sto_command_library_with_search_and_categorization:"STO command library with search and categorization",multiple_profile_management_create_clone_rename_delete:"Multiple profile management (create, clone, rename, delete)",custom_alias_system_for_complex_command_sequences:"Custom alias system for complex command sequences",vertigo_inspired_vfx_manager_for_visual_effects_control:"VERTIGO-inspired VFX Manager for visual effects control",import_export_keybind_and_alias_files_and_project_backups:"Import/export keybind and alias files, and project backups",real_time_validation_and_command_preview:"Real-time validation and command preview",quick_start:"Quick Start:",create_a_new_profile_or_use_the_default_profile:"Create a new profile or use the default profile",default_profile_exists_title:"Default Profile Exists",default_profile_exists_message:'A profile named "Default" already exists. Loading default data would overwrite it. Do you want to continue?',select_keys_from_the_grid_and_add_commands_from_the_library:"Select keys from the grid and add commands from the library",use_the_command_chain_editor_to_build_complex_sequences:"Use the command chain editor to build complex sequences",export_your_keybinds_as_txt_files_for_use_in_sto:"Export your keybinds as .txt files for use in STO",resources:"Resources:",copyright:"¬© 2025 STO Tools. All rights reserved.",got_it:"Got it!",file_explorer:"File Explorer",select_an_item_on_the_left_to_preview_export:"Select an item on the left to preview export",close:"Close",filter_keys:"Filter keys...",filter_aliases:"Filter aliases...",search_commands:"Search commands...",enter_profile_name:"Enter profile name",describe_this_keybind_profile:"Describe this keybind profile",search_keys:"Search keys...",settings:"Settings",select_profile:"Select Profile",new_profile:"New Profile",clone_profile:"Clone Profile",rename_profile:"Rename Profile",delete_profile:"Delete Profile",space_mode:"Space Mode",ground_mode:"Ground Mode",alias_mode:"Alias Mode",unsaved_changes:"Unsaved Changes",unknown_command:"Unknown Command",validation_status:"Validation Status",bound_keys:"Bound Keys",toggle_between_grid_and_categorized_view:"Toggle between grid and categorized view",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Ensures consistent execution order by mirroring commands (Phase 1: left-to-right, Phase 2: right-to-left)",validate_command_chain:"Validate Command Chain",command_chain:"Command Chain",alias_chain:"Alias Chain",chain_for_key:"{{chainType}} for {{key}}",clear_all_commands:"Clear All Commands",copy_to_clipboard:"Copy to Clipboard",environment:"Environment",generated:"Generated",created_by:"Created by",statistics:"Statistics",total_commands:"Total Commands:",command_aliases:"Command Aliases",vfx_aliases:"VFX Aliases",bindset_enable:"Enable",vfx_alias_space:"VFX Alias: Space",vfx_alias_ground:"VFX Alias: Ground",vfx_alias_combined:"VFX Alias: Combined Space/Ground",vfx_suppression_loaded:"VFX Suppression Loaded",vfx_suppression_for_environment:"VFX suppression for {{environment}} environment",vfx_suppression_for_all_environments:"VFX suppression for all environments",command_categories:{targeting:"Targeting",combat:"Combat",cosmetic:"Cosmetic",bridge_officer:"Bridge Officer",tray:"Tray Execution",power:"Shield Management",movement:"Movement",camera:"Camera",communication:"Communication",system:"System",custom:"Custom"},key_type:{function_keys:"Function Keys",letters_numbers:"Letters & Numbers",numberpad:"Numberpad",modifier_keys:"Modifier Keys",navigation:"Navigation",system_keys:"System Keys",mouse_wheel:"Mouse & Wheel",symbols_punctuation:"Symbols & Punctuation",other_keys:"Other Keys"},command_definitions:{add_custom_command:{name:"Add Custom Command",description:"Add any STO command as raw text"},target:{name:"Target by Name",description:"Target entity by name (requires quotes)"},target_enemy_near:{name:"Target Nearest Enemy",description:"Target the nearest enemy in view"},target_enemy_near_forarc:{name:"Target Nearest Enemy (Fore Arc)",description:"Target nearest enemy within a forward-facing cone"},target_enemy_near_aftarc:{name:"Target Nearest Enemy (Aft Arc)",description:"Target nearest enemy within a rear-facing cone"},target_enemy_near_sidearc:{name:"Target Nearest Enemy (Side Arc)",description:"Target nearest enemy within side arcs (both port and starboard)"},target_friend_near:{name:"Target Nearest Friend",description:"Target the nearest friendly entity"},target_self:{name:"Target Self",description:"Target your own ship/character"},target_clear:{name:"Clear Target",description:"Remove current target lock"},target_teammate_1:{name:"Target Teammate 1",description:"Target first team member"},target_teammate_2:{name:"Target Teammate 2",description:"Target second team member"},target_teammate_3:{name:"Target Teammate 3",description:"Target third team member"},target_teammate_4:{name:"Target Teammate 4",description:"Target fourth team member"},fire_all:{name:"Fire All Weapons",description:"Fire all weapons"},fire_phasers:{name:"Fire Energy Weapons",description:"Fire all Energy Weapons"},fire_torps:{name:"Fire Torpedoes",description:"Fire all Torpedos"},fire_mines:{name:"Fire Mines",description:"Fire all Mines"},fire_phasers_torps:{name:"Fire Phasers & Torpedoes",description:"Fire phasers & torpedos"},fire_projectiles:{name:"Fire Projectiles",description:"Fire torpedos & mines"},setactivecostume:{name:"Set Active Costume",description:"Sets current active costume. Requires two modifiers."},custom_tray:{name:"Tray Execution",description:"Execute specific tray slot"},tray_with_backup:{name:"Tray Execution with Backup",description:"Execute specific tray slot with backup ability"},tray_range:{name:"Tray Range Execution",description:"Execute a range of tray slots"},tray_range_with_backup:{name:"Tray Range with Backup",description:"Execute a range of tray slots with backup abilities"},whole_tray:{name:"Whole Tray Execution",description:"Execute all slots in a tray"},whole_tray_with_backup:{name:"Whole Tray with Backup",description:"Execute all slots in a tray with backup tray"},distribute_shields:{name:"Distribute Shields",description:"Evenly distributes shields as if clicking in the middle of the ship and shields icon"},reroute_shields_rear:{name:"Reroute Shields Rear",description:"Route shield power to rear facing"},reroute_shields_left:{name:"Reroute Shields Left",description:"Route shield power to left side"},reroute_shields_right:{name:"Reroute Shields Right",description:"Route shield power to right side"},reroute_shields_forward:{name:"Reroute Shields Forward",description:"Route shield power to forward facing"},full_impulse:{name:"Full Impulse",description:"Engage full impulse drive"},reverse:{name:"Reverse",description:"Reverse engines"},throttle_adjust:{name:"Throttle Adjust",description:"Increase or decrease the throttle by amount"},throttle_set:{name:"Throttle Set",description:"Set the throttle to a specific position (negative = reverse, 0 = stop)"},throttle_toggle:{name:"Throttle Toggle",description:"Alternates between full throttle and full stop"},turn_left:{name:"Turn Left",description:"Turn ship left (continuous while held)"},turn_right:{name:"Turn Right",description:"Turn ship right (continuous while held)"},pitch_up:{name:"Pitch Up",description:"Pitch ship nose up (space altitude change)"},pitch_down:{name:"Pitch Down",description:"Pitch ship nose down (space altitude change)"},strafe_left:{name:"Strafe Left",description:"Strafe ship left"},strafe_right:{name:"Strafe Right",description:"Strafe ship right"},forward:{name:"Forward",description:"Move forward"},backward:{name:"Backward",description:"Move backward"},auto_forward:{name:"Auto Forward",description:"Character moves forward until given new movement commands"},follow:{name:"Follow Target",description:"Follow the targeted entity"},follow_cancel:{name:"Cancel Follow",description:"Stop following and forget about the target"},zoom_in:{name:"Zoom In",description:"Zoom the camera in"},zoom_out:{name:"Zoom Out",description:"Zoom the camera out"},zoom_in_small:{name:"Zoom In Small",description:"Zoom the camera in slightly"},zoom_out_small:{name:"Zoom Out Small",description:"Zoom the camera out slightly"},cam_distance:{name:"Set Camera Distance",description:"Sets the camera distance from the player"},cam_reset:{name:"Reset Camera",description:"Reset the camera position to default"},cam_target_lock:{name:"Lock Camera to Target",description:"Lock or unlock the camera to the target"},cam_cycle_distance:{name:"Cycle Camera Distance",description:"Cycle the camera distance between several preset values"},cam_mouse_look:{name:"Mouse Look",description:"Enable mouse look camera control"},cam_turn_to_face:{name:"Turn to Face Camera",description:"Turn ship to face camera direction"},look_up:{name:"Look Up",description:"Change point of view to look straight up"},look_down:{name:"Look Down",description:"Change point of view to look straight down"},team_message:{name:"Team Message",description:"Send message to team"},local_message:{name:"Local Message",description:"Send message to local area"},zone_message:{name:"Zone Message",description:"Send message to zone"},toggle_hud:{name:"Toggle HUD",description:"Toggle HUD visibility"},screenshot:{name:"Screenshot",description:"Take a screenshot"},screenshot_jpg:{name:"Screenshot JPG",description:"Save a screenshot as JPG"},autofire_set:{name:"Set Autofire",description:"Turn weapon autofire off and on. X = 1 turns it on and X = 0 turns it off."},bind_save_file:{name:"Save Binds to File",description:"Save all your binds to a text file"},bind_load_file:{name:"Load Binds from File",description:"Load a bind file into the client"},combat_log:{name:"Toggle Combat Log",description:"Turn on combat log. 1=on, 0=off, no param=print status. Prepending the command with ++ turns it into a toggle"},missions:{name:"Show/Hide Missions",description:"Show/hide the mission journal"},inventory:{name:"Show/Hide Inventory",description:"Show/hide your inventory"},map:{name:"Show/Hide Map",description:"Show/hide the map window"},logout:{name:"Logout",description:"Log out the current character."},quit:{name:"Quit Game",description:"Close the window."},ui_load:{name:"Load UI Settings",description:"Loads default UI Windows save file, usually Live\\ui_settings.txt"},ui_save:{name:"Save UI Settings",description:"Saves UI layout to default UI Window save file, usually Live\\ui_settings.txt"},ui_load_file:{name:"Load UI Settings File",description:"Loads named UI Windows save file"},ui_save_file:{name:"Save UI Settings File",description:"Saves UI layout to named UI Window save file"},ui_cancel:{name:"UI Cancel",description:'Respond "Cancel" to an open dialog box; may not work in all dialogs.'},ui_ok:{name:"UI OK",description:'Respond "OK" to an open dialog box; may not work in all dialogs.'},chat_log:{name:"Toggle Chat Log",description:"Turn on chat log. 1=on, 0=off, no param=print status. Prepending the command with ++ turns it into a toggle"},remember_ui_lists:{name:"Remember UI Lists",description:"Whether to remember UI List Column placement and width."},ui_remember_positions:{name:"Remember UI Positions",description:"Whether to remember UI sizes and positions. On by default."},safe_login:{name:"Safe Login",description:"If true, then log the player back into their most recent static map instead of anything else."},goto_character_select:{name:"Go to Character Select",description:"Go to the character select screen without logging out."},ui_gen_layers_reset:{name:"Reset UI Layout",description:"Resets the layout, used for when the server updates movable window positions"},ui_resolution:{name:"Print UI Resolution",description:"Print the current UI screen resolution."},ui_tooltip_delay:{name:"Set Tooltip Delay",description:"Sets the additional delay, in seconds, before tooltips appear"},show_game_ui:{name:"Show Game UI",description:"Show the game UI"},show_game_ui_no_extra_keybinds:{name:"Show Game UI (No Extra Keybinds)",description:"This command does not add any keybinds for showing the UI when the user presses escape"},change_instance:{name:"Change Instance",description:"Change to an already created instance of the same map. Only works while not at red alert."},aim:{name:"Aim/Scope",description:"Toggle scope on/off. In scope mode the player does more damage. Can either be used as a toggle or a press and hold"},holster:{name:"Holster Weapon",description:"Attempt to holster your active weapon"},holster_toggle:{name:"Holster Toggle",description:"Attempt to holster or draw your weapons"},unholster:{name:"Unholster Weapon",description:"Attempt to draw your active weapon"},toggle_shooter_mode:{name:"Toggle Shooter Mode",description:"Toggle shooter mode on/off"},shooter_primary:{name:"Shooter Primary",description:"Primary shooter mode action"},shooter_secondary:{name:"Shooter Secondary",description:"Secondary shooter mode action"},shooter_tertiary:{name:"Shooter Tertiary",description:"Tertiary shooter mode action"},shooter_clear_offset_tray_binds:{name:"Shooter Clear Offset Tray Binds",description:"Clear the starting location and movement of the yellow action box that appears on the tray while in shooter mode"},shooter_clear_overlay_tray_binds:{name:"Shooter Clear Overlay Tray Binds",description:"Clear overlay tray bindings for shooter mode"},shooter_set_offset_tray_binds:{name:"Shooter Set Offset Tray Binds",description:"Set the starting location and movement of the yellow action box that appears on the tray while in shooter mode"},shooter_set_overlay_tray_binds:{name:"Shooter Set Overlay Tray Binds",description:"Set overlay tray bindings for shooter mode"},setrallypoint:{name:"Set Rally Point",description:"Set a rally point for your current target"},setrallypointconsole:{name:"Set Rally Point (Console)",description:"Set a rally point for your current target (console variant)"},clearrallypoint:{name:"Clear Rally Point",description:"Clear the rally point for your current target"},clearallrallypoints:{name:"Clear All Rally Points",description:"Clear all the rally points"},assist:{name:"Assist",description:"Assist '<name>': Assists the Entity with the matching name. If no name is given, assists your current target."},net_timing_graph:{name:"Net Timing Graph",description:"Enable or disable the network timing graph (0=disable, 1=enable)"},net_timing_graph_alpha:{name:"Net Timing Graph Alpha",description:"Set transparency level for network timing graph (50=highest transparency, 255=no transparency)"},net_timing_graph_paused:{name:"Net Timing Graph Paused",description:"Pause or resume the network timing graph (0=pause disabled, 1=pause enabled)"},netgraph:{name:"Net Graph",description:"Display SND and RCV network data as text (1=enabled, 0=disabled)"},parameter_placeholders:{any_sto_command:"Enter any STO command (e.g., Target_Enemy_Near)",entity_name:"Enter entity name",first_modifier:"First modifier",second_modifier:"Second modifier",entity_name_optional:"Entity name (optional)"}},category_descriptions:{targeting:"Target selection and management",combat:"Weapon firing and combat actions",tray:"Execute abilities from action trays",power:"Shield power and distribution management",movement:"Ship movement and navigation",camera:"Camera control and view management",communication:"Chat and team communication",system:"UI and system commands",custom:"Custom commands"},no_aliases_defined:"No aliases defined",create_alias_to_get_started:"Create an alias to get started",please_select_a_key_first:"Please select a key first",please_select_an_alias_first:"Please select an alias first",no_active_profile:"No active profile",import_failed:"Import failed: {{error}}",storage_not_available:"Storage not available",no_aliases_found_in_file:"No aliases found in file",import_completed_keybinds:"Import completed: {{count}} keybinds",import_completed_aliases:"Import completed: {{count}} aliases",kbf_import_completed:"KBF import completed: {{bindsets}} bindset(s), {{keys}} key(s), {{aliases}} alias(es)",kbf_import_skipped_activities:"{{count}} skipped activities",kbf_import_errors_encountered:"{{count}} errors encountered",kbf_import_warnings_generated:"{{count}} warnings generated",kbf_import_processing_time:"Processed in {{seconds}}s",kbf_import_error_summary:"Summary",kbf_import_bindsets_processed:"{{count}} bindsets processed",kbf_import_bindsets_failed:"{{count}} bindsets failed",kbf_import_total_errors:"{{count}} total errors",kbf_import_total_warnings:"{{count}} total warnings",project_imported_successfully:"Project imported successfully: {{profileCount}} profiles",sync_folder_set:"Sync folder selected",failed_to_set_sync_folder:"Failed to select sync folder: {{error}}",sync_not_supported_firefox:"Sync folder functionality requires a Chromium-based browser (Chrome, Edge, etc.). Firefox does not support the required File System Access API.",sync_not_supported_title:"Sync Not Supported",sync_not_supported_detailed:"Sync functionality is not available in Firefox due to browser limitations. The File System Access API required for folder synchronization is only supported in Chromium-based browsers. You can still manually backup and restore your application state or use the File Explorer to copy your keybind and alias files.",sync_not_supported_secure_context:"Sync service is unavailable when served over HTTP. Please use HTTPS or access via file:// protocol to enable sync functionality.",sync_not_supported_secure_context_title:"Secure Context Required",sync_not_supported_secure_context_detailed:"Sync functionality requires a secure connection (HTTPS) or local file access (file://) to work. The File System Access API needed for folder synchronization is only available in secure contexts to protect your data. Please access this application via HTTPS or open it as a local file.",sync_not_supported_browser:"Your browser does not support the File System Access API required for sync functionality.",sync_not_supported_browser_title:"Browser Not Supported",sync_not_supported_browser_detailed:"Your browser does not support the File System Access API required for folder synchronization. Please try using a Chromium-based browser (Chrome, Edge, etc.) with a secure connection (HTTPS) or local file access.",no_sync_folder_selected:"No sync folder selected",project_synced_successfully:"Project synchronized successfully",sync_folder_contains_project_title:"Existing Sync Data Found",sync_folder_contains_project_prompt:"This folder already contains a project.json from a previous sync. Import it now instead of overwriting?",project_imported_from_sync_folder:"Application state imported from sync folder",sync_overwrite_existing_title:"Overwrite Sync Data?",sync_overwrite_existing_prompt:"Import declined. Overwrite the sync folder with current application state?",sync_operation_cancelled:"Sync cancelled",failed_to_import_project:"Failed to import project: {{error}}",permission_denied_to_folder:"Permission denied to write to folder",failed_to_sync_project:"Failed to sync project: {{error}}",synchronization:"Synchronization",advanced:"Advanced",synchronization_settings:"Synchronization Settings",advanced_settings:"Advanced Settings",sync_folder_description:"Choose a folder to automatically sync your projects",auto_sync:"Auto Sync",auto_sync_description:"Automatically sync changes to the selected folder",auto_sync_interval:"Auto Sync Interval",auto_sync_interval_description:"How often to automatically sync your changes",after_every_change:"After every change",every_1_minute:"Every 1 minute",every_2_minutes:"Every 2 minutes",every_5_minutes:"Every 5 minutes",bind_to_alias_mode:"Create keybind chains as aliases",bind_to_alias_mode_description:"When enabled, keybind chains are generated as aliases named by environment and key (e.g., 'space_q'), with keys bound to call the aliases.",preferences_saved:"Preferences saved successfully",vfx_manager_description:"Select visual effects to disable using dynFxSetFXExlusionList aliases. Effects are organized by environment.",app_description:"A comprehensive web-based tool for creating, editing, and managing Star Trek Online keybind configurations with visual editing and advanced features.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"Select a Space/Ground build or Aliases to preview export.",no_alias_selected:"No Alias Selected",select_alias_from_left_panel:"Select an alias from the left panel to view and edit its command chain.",select_key_from_left_panel:"Select a key from the left panel to view and edit its command chain.",failed_to_load_application:"Failed to load application",profile_created:'Profile "{{name}}" created',failed_to_create_profile:"Failed to create profile",failed_to_clone_profile:"Failed to clone profile",cannot_delete_the_last_profile:"Cannot delete the last profile",profile_deleted:'Profile "{{profileName}}" deleted',failed_to_delete_profile:"Failed to delete profile",invalid_key_name:"Invalid key name",key_added:'Key "{{keyName}}" added',key_already_exists:'Key "{{keyName}}" already exists',key_deleted:'Key "{{keyName}}" deleted',key_duplicated:'Key "{{from}}" duplicated as "{{to}}"',failed_to_delete_key:"Failed to delete key",key_not_found:'Key "{{keyName}}" not found',failed_to_duplicate_key:"Failed to duplicate key",alias_created:"Alias created successfully",alias_deleted:'Alias "{{aliasName}}" deleted',alias_duplicated:'Alias "{{from}}" duplicated as "{{to}}"',failed_to_add_alias:"Failed to create alias",failed_to_delete_alias:"Failed to delete alias",failed_to_duplicate_alias:"Failed to duplicate alias",alias_not_found:'Alias "{{name}}" not found',alias_already_exists:'Alias "{{name}}" already exists',invalid_alias_name:"Invalid alias name",invalid_project_file:"Invalid project file",invalid_kbf_file_format:"Invalid KBF file format",no_commands_to_duplicate:"No commands to duplicate",command_chain_is_valid:"Command chain is valid",no_profile_selected:"No profile selected",language_updated:"Language updated",nothing_to_copy:"Nothing to copy",content_copied_to_clipboard:"Content copied to clipboard",failed_to_generate_export:"Failed to generate export",no_profile_selected_to_clone:"No profile selected to clone",no_profile_selected_to_rename:"No profile selected to rename",profile_name_is_required:"Profile name is required",failed_to_save_profile:"Failed to save profile: {{error}}",no_profile_selected_to_delete:"No profile selected to delete",no_keybinds_to_export:"No keybinds to export",no_aliases_to_export:"No aliases to export",export_generated_aliases_note:"Keybind lines that call generated aliases",export_alias_definitions_note:"(Alias definitions are in the alias file)",export_user_and_generated_aliases:"This file contains both user-created aliases and generated aliases",export_generated_aliases_count:"from bind-to-alias mode ({{count}} generated aliases)",sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager loaded successfully",switched_to_profile:"Switched to profile: {{name}} ({{environment}})",profile_created_from:'Profile "{{newName}}" created from "{{sourceProfile}}"',no_effects_selected:"No effects selected. Please select at least one effect to generate aliases.",profile_renamed:'Profile renamed from "{{oldName}}" to "{{name}}"',application_reset_successfully:"Application reset successfully. All data cleared.",failed_to_copy_to_clipboard:"Failed to copy to clipboard",confirm_delete_alias:'Are you sure you want to delete the alias "{{aliasName}}"?',confirm_delete_key:'Are you sure you want to delete the key "{{keyName}}" and all its commands?',confirm_clear:"Confirm Clear",confirm_clear_commands:'Are you sure you want to clear all commands for "{{keyName}}"?',confirm_delete_profile:'Are you sure you want to delete the profile "{{profileName}}"?\n\nThis action cannot be undone.',confirm_reset_application:"Are you sure you want to reset the application?\n\nThis will delete all profiles, keybinds, and settings. This action cannot be undone.",yes:"Yes",no:"No",ok:"OK",no_commands:"No commands",profile_not_found:"Profile not found",click_add_command_to_start_building_your_command_chain:"Select items in the Command Library to start building your key command chain for",click_add_command_to_start_building_your_alias_chain:"Select items in the Command Library to start building your alias command chain for",create_alias:"Create Alias",key:"key",key_count:"Key Count",select_bindset_to_import:"Select Bindset to Import",select_bindset_import_question:"Choose which bindset to import into the primary bindset:",single_bindset_import_note:"Since bindsets are disabled, this bindset will be imported into the primary bindset.",no_profile:"No profile",stotrayexecbytray_description:"STOTrayExecByTray (shows key binding on UI)",trayexecbytray_description:"TrayExecByTray (no UI indication)",parameter_configuration:"Parameter Configuration",configure_colon:"Configure:",edit_colon:"Edit:",vfx_manager:"VFX Manager",select_all:"Select All",clear_all:"Clear All",no_space_effects_selected:"No space effects selected",no_ground_effects_selected:"No ground effects selected",show_player_say:"Show Player Say",generate_aliases:"Generate Aliases",delete_selected_key:"Delete Selected Key",duplicate_selected_key:"Duplicate Selected Key",show_all_keys:"Show All Keys",failed_to_load_profile_data:"Failed to load profile data",already_on_profile:"Already on this profile",source_profile_not_found:"Source profile not found",source_profile_and_new_name_required:"Source profile ID and new name are required",profile_name_required:"Profile name is required",confirm_reset_app:"Confirm Reset Application",switch_to_key_type_view:"Switch to key type view",switch_to_grid_view:"Switch to grid view",switch_to_command_categories:"Switch to command categories",no_profiles_available:"No profiles available",verb:{say:"Say (Local)",team:"Team",zone:"Zone",tell:"Tell"},duplicate_alias:"Duplicate Alias",enter_new_alias_name:"Enter new alias name",alias_name_in_use:"Alias name already exists",duplicate:"Duplicate",reserved_command_name:"Name conflicts with a STO command",backup_created_successfully:"Application backup created successfully",failed_to_create_backup:"Failed to create backup: {{error}}",backup_restored_successfully:"Application state restored successfully",backup_restore_failed:"Failed to restore backup: {{error}}",distinguish_left_right_modifiers:"Distinguish left/right modifiers",clear_filter:"Clear filter",warning:"Warning",error:"Error",validation_details:"Validation Details",command_chain_near_limit:"Command chain is getting long ({{length}} characters). Exceeding 999 may break.",command_chain_too_long:"Command chain is too long ({{length}} characters) and may fail in game.",sto_tray_exec_optimization_suggestion:"Command chain is {{currentLength}} characters. Replacing {{count}} instance(s) of STOTrayExecByTray with TrayExecByTray would save {{potentialSavings}} characters (new length: {{newLength}}).",stabilized_non_tray_warning:"Stabilized execution should be used with tray execution abilities only.",too_many_commands_on_key:"Binding {{count}} commands to one key may fail in game (max recommended 20).",alias_mixed_environment_warning:"Alias contains both space-only and ground-only commands; this is not recommended.",spam_bar_warning:"Not recommended on spam bars as it interferes with firing cycles",press_any_key_combination:"Press any key combination...",capture_instructions:"Use your keyboard or mouse, or switch to manual to click keys below",switch_to_manual:"Switch to Manual",start_capture:"Start Capture",selected_key:"Selected Key",confirm_selection:"Confirm Selection",key_selection_failed:"Failed to select key",error_generating_command:"Error generating command",please_enter_a_raw_command:"Please enter a raw command",unsafe_keybind:"Unsafe keybind combination: {{key}} is not allowed",bindsets_enabled:"Enable Bindsets",bindsets_enabled_description:"When enabled, allows creation and loading of bindsets (requires 'Create keybind chains as aliases').",translate_generated_messages:"Translate generated messages",translate_generated_messages_description:"When enabled, automatically generated messages (like VFX suppression notifications) will be translated to the selected language. When disabled, they remain in English.",bindsets:"Bindsets",bindset_manager:"Bindset Manager",create_bindset:"Create Bindset",clone_bindset:"Clone Bindset",delete_bindset:"Delete Bindset",enter_bindset_name:"Enter bindset name:",bindset_name:"Bindset name",bindset_name_in_use:"Bindset name already in use",bindset_not_empty:"Bindset has keybinds and cannot be deleted",invalid_name:"Invalid name",rename_bindset:"Rename Bindset",bindset_actions:"Bindset Actions",name_required:"Name is required",name_exists:"Name already exists",name_unchanged:"Name is unchanged",confirm_delete_bindset:'Delete bindset "{{name}}"?',confirm_delete_bindset_with_keys:"Delete Bindset with Keys",bindset_delete_warning:'This bindset "{{name}}" contains {{count}} keys and will be permanently deleted.',bindset_delete_consequences:"All keybinds in this bindset will be permanently lost and cannot be recovered.",bindset_delete_confirmation_text:"I understand this will permanently delete all keys in this bindset",bindset_delete_type_confirm:"Type DELETE to confirm",bindset_deleted:'Bindset "{{name}}" deleted successfully',not_found:"Not found",add_new_alias:"Add New Alias",add_key_to_bindset:"Add key to bindset",duplicate_selected_alias:"Duplicate selected alias",delete_selected_alias:"Delete selected alias",search_aliases:"Search aliases...",add_key_to_bindset_confirm:'Add key "{{key}}" to bindset "{{bindset}}"?',manage_bindsets:"Manage Bindsets",primary_bindset:"Primary Bindset",remove_key_from_bindset:"Remove key from bindset",remove_key_from_bindset_confirm:'Remove key "{{key}}" from bindset "{{bindset}}"?',select_bindset:"Select Bindset",confirm_add:"Confirm Add",confirm_remove:"Confirm Remove",confirm_delete:"Are you sure you want to delete?",enter_new_name:"Enter new name:",failed_to_rename_profile:"Failed to rename profile: {{error}}",ground_build:"Ground Build",import_failed_invalid_json:"Import failed: Invalid JSON format",import_failed_unsupported_format:"Import failed: Unsupported file format",no_content_available:"No content available",no_valid_profile:"No valid profile available",profile_already_exists:"Profile already exists",profile_id_required:"Profile ID is required",space_build:"Space Build",syncing:"Syncing...",command_parameters:{active:{label:"Active",help:"0: Disabled, 1: Enabled"},tray:{label:"Tray",help:"Tray number (0-9). 0=Game Tray 1"},slot:{label:"Slot",help:"Slot number (0-9). 0=Game Slot 1"},start_tray:{label:"Start Tray",help:"Starting tray number (0-9). 0=Game Tray 1"},end_tray:{label:"End Tray",help:"Ending tray number (0-9). 0=Game Tray 1"},start_slot:{label:"Start Slot",help:"Starting slot number (0-9). 0=Game Slot 1"},end_slot:{label:"End Slot",help:"Ending slot number (0-9). 0=Game Slot 1"},backup_tray:{label:"Backup Tray",help:"Backup tray number (0-9). 0=Game Tray 1"},backup_slot:{label:"Backup Slot",help:"Backup slot number (0-9). 0=Game Slot 1"},backup_start_tray:{label:"Backup Start Tray",help:"Backup start tray number (0-9). 0=Game Tray 1"},backup_end_tray:{label:"Backup End Tray",help:"Backup end tray number (0-9). 0=Game Tray 1"},backup_start_slot:{label:"Backup Start Slot",help:"Backup start slot number (0-9). 0=Game Slot 1"},backup_end_slot:{label:"Backup End Slot",help:"Backup end slot number (0-9). 0=Game Slot 1"},command_type:{label:"Command Type",help:"Command execution type (STOTrayExecByTray shows UI, TrayExecByTray does not)"},entityName:{label:"Entity Name",help:"Name of the entity to target"},message:{label:"Message",help:"Message text to send"},distance:{label:"Distance",help:"Camera distance value"},amount:{label:"Amount",help:"Throttle adjustment amount"},position:{label:"Position",help:"Throttle position (0-100)"},filename:{label:"Filename",help:"File name (without extension)"},state:{label:"State",help:"1 to enable, 0 to disable"},verb:{label:"Channel",help:"Communication channel (say, team, zone)"},alias_name:{label:"Alias Name",help:"Name of the alias to execute"},rawCommand:{label:"Command",help:"Raw STO command text"},seconds:{label:"Seconds",help:"Delay in seconds"},alpha:{label:"Alpha",help:"Transparency value (0-255)"},modifier1:{label:"Modifier 1",help:"First modifier key combination"},modifier2:{label:"Modifier 2",help:"Second modifier key combination"},name:{label:"Name",help:"Name of the target or object"},degrees:{label:"Degrees",help:"Size of the arc cone in degrees"}},error_add_failed:"Failed to add key to bindset",error_remove_failed:"Failed to remove key from bindset",command_group_non_trayexec:"Before Palindrome",command_group_palindromic:"Palindromic TrayExec",command_group_pivot:"Pivot Group",command_group_hint_fixed_order:"Always executed first",command_group_hint_palindromic:"Affects palindrome structure",command_group_hint_pivot:"Forms palindrome center",palindromic_included_tooltip:"Included in palindrome (click to exclude)",palindromic_excluded_tooltip:"Excluded from palindrome (click to include)",placement_in_pivot_group_tooltip:"In pivot group (click to move before palindromes)",placement_before_palindromes_tooltip:"Before palindromes (click to move to pivot group)",toggle_collapse:"Toggle collapse",primary_bindset_copy_default:"Primary Bindset Copy",copy_suffix:"Copy",no_keys_in_bindset:"No keys in this bindset",switch_to_categorized_view:"Switch to categorized view",configure_kbf_import:"Configure KBF Import",configure_kbf_import_question:"Configure how to import the selected bindsets:",import_configured:"Import Configured",custom_name:"Custom name",primary_mapping_options:"Primary Mapping Options",map_master_to_primary:"Map master bindset to primary",create_new_primary:"Create new primary bindset",primary_name_placeholder:"Enter primary bindset name",skip_primary_mapping:"Skip primary mapping (keep as named bindsets)",import_preview:"Import Preview",select_bindsets_for_preview:"Select bindsets above to preview their contents",mapped_to_primary:"Mapped to Primary",mapped_to_new_primary:"Mapped to new primary: {{name}}",mapped_to_named:"Mapped to named bindset",maps_to_primary_bindset:"Maps to Primary Bindset",not_mapped:"Not Imported",maps_to:"Maps to",bindset_name_conflict:"Name conflict detected",auto_resolve_conflict:"Auto-resolved as {{name}}",original_bindset_name:"Original Bindset",mapping_type:"Mapping Type",mapping_destination:"Mapping Destination",custom_name_placeholder:"Enter custom name...",reduced_bindset_functionality:"Single Bindset Import Mode",reduced_bindset_functionality_description:"With bindsets disabled, you can import a single bindset that will be mapped to your primary bindset. This provides a streamlined import experience.",enable_full_bindset_functionality:"For advanced multi-bindset import options, enable bindsets in settings.",import_strategy:"Import strategy",merge_keep_existing:"Merge (keep existing)",merge_overwrite_existing:"Merge (overwrite existing)",overwrite_all:"Overwrite all",overwrite_all_description_keybinds:"Removes all existing keybinds in this environment and replaces them with imported ones.",overwrite_all_description_kbf:"Removes existing keybinds from the selected bindsets and replaces them with imported KBF data.",overwrite_all_description_kbf_primary:"Removes all existing keybinds in the primary environment and replaces them with imported KBF data.",overwrite_all_description_kbf_bindsets:"Removes existing keybinds from the selected bindsets and replaces them with imported KBF data.",overwrite_all_description_aliases:"Removes all existing aliases and replaces them with imported ones.",overwrite_confirm_title:"Confirm overwrite",overwrite_confirm_body_keys:"This will remove all existing keybinds in {{environment}} and replace them with the import file.",overwrite_confirm_body_aliases:"This will remove all existing aliases and replace them with the import file.",overwrite_counts:"Current: {{current}} ¬∑ Incoming: {{incoming}}",overwrite_all_action:"Overwrite all",import_result_skipped:"Imported {{imported}}, skipped {{skipped}} conflicts.",import_result_overwrote:"Imported {{imported}}, overwrote {{overwritten}} items.",import_result_overwrite_all:"Imported {{imported}} after clearing {{cleared}} existing items.",gamepad_unavailable_secure_context:"Gamepad support requires a secure connection (HTTPS). Please use a secure connection to enable gamepad functionality.",gamepad_unsupported:"Gamepad API is not supported in this browser. Please use a modern browser that supports the Gamepad API.",gamepad_unavailable:"Gamepad support is not available in this environment.",gamepad_not_found:"The specified gamepad was not found or is not connected.",gamepad_not_calibrating:"No calibration session is currently active.",gamepad_calibration_standard_not_needed:"Standard gamepads do not require calibration. This feature is for non-standard controllers only.",gamepad_calibration_invalid_step:"Invalid calibration step.",gamepad_calibration_invalid_input:"Invalid input type for this calibration step.",gamepad_calibrate_prompt:"Press {{buttonName}} (Step {{stepNumber}} of {{totalSteps}})"},te={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Speichern",explorer:"Explorer",import_keybinds:"Tastaturbelegung importieren",import_environment:"Tastaturbelegung importieren",import_environment_question:"W√§hlen Sie eine Umgebung f√ºr den Import dieser Tastaturbelegungsdatei",aliases:"Aliase",import_aliases:"Aliase importieren",import_kbf_file:"KBF-Datei importieren",import_selected:"Auswahl importieren",invalid_kbf_file_format:"Ung√ºltiges KBF-Dateiformat",import:"Importieren",backup:"Sicherung",backup_menu:"Sicherung",backup_application_state:"Anwendungsstatus sichern",restore_application_state:"Anwendungsstatus wiederherstellen",preferences:"Einstellungen",language:"Sprache",sync_folder_label:"Synchronisationsordner:",no_folder_selected:"Kein Ordner ausgew√§hlt",download:"Herunterladen",vfx:"VFX",dark_mode:"Dunkler Modus",light_mode:"Heller Modus",load_default_data:"Standarddaten laden",reset_application:"Anwendung zur√ºcksetzen",set_sync_folder:"Sync-Ordner festlegen",sync_now:"Jetzt synchronisieren",about:"√úber",rename:"Umbenennen",delete:"L√∂schen",space:"Weltraum",ground:"Boden",modified:"Ge√§ndert",valid:"G√ºltig",keys:"Tasten",keys_firstupper:"Tasten",copy:"Kopieren",select_a_key_to_edit:"W√§hlen Sie eine Taste zum Bearbeiten",commands:"Befehle",command_singular:"Befehl",no_key_selected:"Keine Taste ausgew√§hlt",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"W√§hlen Sie eine Taste aus dem linken Panel, um ihre Befehlskette anzuzeigen und zu bearbeiten.",generated_command:"Generierter Befehl:",select_a_key_to_see_the_generated_command:"W√§hlen Sie eine Taste, um den generierten Befehl zu sehen",add_command:"Befehl hinzuf√ºgen",command_library:"Befehlsbibliothek",add_new_key:"Neue Taste hinzuf√ºgen",ctrl:"Strg",alt:"Alt",shift:"Umschalt",cancel:"Abbrechen",custom:"Benutzerdefiniert",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"aliase",profile:"Profil",profile_name:"Profilname:",description_optional:"Beschreibung (optional):",alias_name:"Alias-Name:",select_key_dialog_title:"Taste ausw√§hlen",vfx_manager:"VFX-Manager",space_effects:"Weltraum-Effekte",select_all:"Alle ausw√§hlen",clear_all:"Alle l√∂schen",select_bindsets_to_import:"Zu importierende Bindsets ausw√§hlen",select_bindsets_to_import_question:"Diese KBF-Datei enth√§lt mehrere Bindsets. W√§hlen Sie, welche Bindsets Sie importieren m√∂chten:",kbf_import_progress:"KBF-Datei wird importiert",kbf_import_progress_message:"Bitte warten Sie, w√§hrend die KBF-Datei verarbeitet wird...",kbf_progress_layer:"Schicht {{layer}}",kbf_progress_initializing:"Initialisierung...",kbf_progress_preparing:"Import wird vorbereitet...",kbf_progress_decode_layer1:"Dateiformat dekodieren",kbf_progress_parse_layer2:"Bindset-Datens√§tze parsen",kbf_progress_parse_layer3:"Schl√ºsseldaten verarbeiten",kbf_progress_parse_layer4:"Tastenzuordnungen analysieren",kbf_progress_parse_layer5:"Befehle √ºbersetzen",kbf_progress_decode_layer6:"Textdaten dekodieren",kbf_progress_complete:"Import wird abgeschlossen",kbf_progress_processing:"Verarbeitung...",kbf_progress_starting:"{{stage}} wird gestartet...",kbf_progress_finished_stage:"{{stage}} abgeschlossen",selected:"ausgew√§hlt",ground_effects:"Boden-Effekte",generated_aliases:"Generierte Aliase:",no_space_effects_selected:"Keine Weltraum-Effekte ausgew√§hlt",no_ground_effects_selected:"Keine Boden-Effekte ausgew√§hlt",show_player_say:"Spieler-Say anzeigen",generate_aliases:"Aliase generieren",about_sto_tools_keybind_manager:"√úber STO Tools Keybind Manager",features:"Funktionen:",visual_keybind_editor:"Visueller Keybind-Editor",sto_command_library_with_search_and_categorization:"STO-Befehlsbibliothek mit Suche und Kategorisierung",multiple_profile_management_create_clone_rename_delete:"Mehrfache Profilverwaltung (erstellen, klonen, umbenennen, l√∂schen)",custom_alias_system_for_complex_command_sequences:"Benutzerdefiniertes Alias-System f√ºr komplexe Befehlssequenzen",vertigo_inspired_vfx_manager_for_visual_effects_control:"VERTIGO-inspirierter VFX-Manager zur Kontrolle visueller Effekte",import_export_keybind_and_alias_files_and_project_backups:"Import/Export von Keybind- und Alias-Dateien sowie Projekt-Backups",real_time_validation_and_command_preview:"Echtzeit-Validierung und Befehlsvorschau",quick_start:"Schnellstart:",create_a_new_profile_or_use_the_default_profile:"Erstellen Sie ein neues Profil oder verwenden Sie das Standardprofil",select_keys_from_the_grid_and_add_commands_from_the_library:"W√§hlen Sie Tasten aus dem Raster und f√ºgen Sie Befehle aus der Bibliothek hinzu",use_the_command_chain_editor_to_build_complex_sequences:"Verwenden Sie den Befehlsketten-Editor, um komplexe Sequenzen zu erstellen",export_your_keybinds_as_txt_files_for_use_in_sto:"Exportieren Sie Ihre Keybinds als .txt-Dateien f√ºr die Verwendung in STO",resources:"Ressourcen:",copyright:"¬© 2025 STO Tools. Alle Rechte vorbehalten.",got_it:"Verstanden!",file_explorer:"Datei-Explorer",select_an_item_on_the_left_to_preview_export:"W√§hlen Sie ein Element links aus, um den Export in der Vorschau anzuzeigen",close:"Schlie√üen",filter_keys:"Tasten filtern...",search_commands:"Befehle suchen...",enter_profile_name:"Profilnamen eingeben",describe_this_keybind_profile:"Dieses Keybind-Profil beschreiben",search_keys:"Tasten suchen...",settings:"Einstellungen",select_profile:"Profil ausw√§hlen",new_profile:"Neues Profil",clone_profile:"Profil klonen",rename_profile:"Profil umbenennen",delete_profile:"Profil l√∂schen",space_mode:"Weltraum-Modus",ground_mode:"Boden-Modus",unsaved_changes:"Ungespeicherte √Ñnderungen",validation_status:"Validierungsstatus",bound_keys:"Gebundene Tasten",toggle_between_grid_and_categorized_view:"Zwischen Raster- und kategorisierter Ansicht wechseln",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Gew√§hrleistet konsistente Ausf√ºhrungsreihenfolge durch Spiegelung der Befehle (Phase 1: links nach rechts, Phase 2: rechts nach links)",validate_command_chain:"Befehlskette validieren",command_chain:"Befehlskette",alias_chain:"Alias-Kette",chain_for_key:"{{chainType}} f√ºr {{key}}",clear_all_commands:"Alle Befehle l√∂schen",copy_to_clipboard:"In Zwischenablage kopieren",generated:"Generiert:",created_by:"Erstellt von:",statistics:"Statistiken",total_commands:"Gesamtbefehle:",command_aliases:"Befehlsaliase",key_type:{function_keys:"Funktionstasten",letters_numbers:"Buchstaben & Zahlen",numberpad:"Nummernblock",modifier_keys:"Modifikatortasten",navigation:"Navigation",system_keys:"Systemtasten",mouse_wheel:"Maus & Rad",symbols_punctuation:"Symbole & Zeichensetzung",other_keys:"Andere Tasten"},command_categories:{targeting:"Zielauswahl",combat:"Kampf",cosmetic:"Kosmetik",bridge_officer:"Br√ºckenoffizier",tray:"Fachausf√ºhrung",power:"Schildverwaltung",movement:"Bewegung",camera:"Kamera",communication:"Kommunikation",system:"System",custom:"Benutzerdefiniert"},command_definitions:{add_custom_command:{name:"Benutzerdefinierten Befehl hinzuf√ºgen",description:"Beliebigen STO-Befehl als Rohtext hinzuf√ºgen"},target:{name:"Ziel nach Name",description:"Ziel nach Namen anvisieren (ben√∂tigt Anf√ºhrungszeichen)"},target_enemy_near:{name:"N√§chsten Feind anvisieren",description:"Den n√§chsten sichtbaren Feind anvisieren"},target_enemy_near_forarc:{name:"N√§chsten Feind anvisieren (Bugbogen)",description:"N√§chsten Feind innerhalb eines vorw√§rts gerichteten Kegels anvisieren"},target_enemy_near_aftarc:{name:"N√§chsten Feind anvisieren (Heckbogen)",description:"N√§chsten Feind innerhalb eines r√ºckw√§rts gerichteten Kegels anvisieren"},target_enemy_near_sidearc:{name:"N√§chsten Feind anvisieren (Seitenbogen)",description:"N√§chsten Feind innerhalb von Seitenb√∂gen anvisieren (sowohl Backbord als auch Steuerbord)"},target_friend_near:{name:"N√§chsten Verb√ºndeten anvisieren",description:"Die n√§chste befreundete Einheit anvisieren"},target_self:{name:"Sich selbst anvisieren",description:"Das eigene Schiff/den eigenen Charakter anvisieren"},target_clear:{name:"Ziel aufheben",description:"Aktuelle Zielerfassung aufheben"},target_teammate_1:{name:"Teammitglied 1 anvisieren",description:"Erstes Teammitglied anvisieren"},target_teammate_2:{name:"Teammitglied 2 anvisieren",description:"Zweites Teammitglied anvisieren"},target_teammate_3:{name:"Teammitglied 3 anvisieren",description:"Drittes Teammitglied anvisieren"},target_teammate_4:{name:"Teammitglied 4 anvisieren",description:"Viertes Teammitglied anvisieren"},fire_all:{name:"Alle Waffen feuern",description:"Alle Waffen feuern"},fire_phasers:{name:"Energiewaffen feuern",description:"Alle Energiewaffen feuern"},fire_torps:{name:"Torpedos feuern",description:"Alle Torpedos feuern"},fire_mines:{name:"Minen feuern",description:"Alle Minen feuern"},fire_phasers_torps:{name:"Phaser & Torpedos feuern",description:"Phaser & Torpedos feuern"},fire_projectiles:{name:"Projektile feuern",description:"Torpedos & Minen feuern"},custom_tray:{name:"Tray-Ausf√ºhrung",description:"Bestimmten Tray-Slot ausf√ºhren"},tray_with_backup:{name:"Tray-Ausf√ºhrung mit Backup",description:"Bestimmten Tray-Slot mit Backup-F√§higkeit ausf√ºhren"},tray_range:{name:"Tray-Bereich-Ausf√ºhrung",description:"Einen Bereich von Tray-Slots ausf√ºhren"},tray_range_with_backup:{name:"Tray-Bereich mit Backup",description:"Einen Bereich von Tray-Slots mit Backup-F√§higkeiten ausf√ºhren"},whole_tray:{name:"Gesamtes Tray ausf√ºhren",description:"Alle Slots in einem Tray ausf√ºhren"},whole_tray_with_backup:{name:"Gesamtes Tray mit Backup",description:"Alle Slots in einem Tray mit Backup-Tray ausf√ºhren"},distribute_shields:{name:"Schilde verteilen",description:"Schilde gleichm√§√üig verteilen, als w√ºrde man in die Mitte des Schiff- und Schildsymbols klicken"},reroute_shields_rear:{name:"Schilde nach hinten umleiten",description:"Schildenergie zur Heckseite umleiten"},reroute_shields_left:{name:"Schilde nach links umleiten",description:"Schildenergie zur linken Seite umleiten"},reroute_shields_right:{name:"Schilde nach rechts umleiten",description:"Schildenergie zur rechten Seite umleiten"},reroute_shields_forward:{name:"Schilde nach vorne umleiten",description:"Schildenergie zur Bugseite umleiten"},full_impulse:{name:"Vollimpuls",description:"Vollimpulsantrieb einschalten"},reverse:{name:"R√ºckw√§rts",description:"Triebwerke r√ºckw√§rts"},throttle_adjust:{name:"Schub anpassen",description:"Schub um Betrag erh√∂hen oder verringern"},throttle_set:{name:"Schub setzen",description:"Schub auf bestimmte Position setzen (negativ = r√ºckw√§rts, 0 = stopp)"},throttle_toggle:{name:"Schub umschalten",description:"Zwischen Vollschub und Vollstopp wechseln"},turn_left:{name:"Links drehen",description:"Schiff nach links drehen (kontinuierlich w√§hrend gehalten)"},turn_right:{name:"Rechts drehen",description:"Schiff nach rechts drehen (kontinuierlich w√§hrend gehalten)"},pitch_up:{name:"Aufw√§rts neigen",description:"Schiffsnase nach oben neigen (H√∂hen√§nderung im Weltraum)"},pitch_down:{name:"Abw√§rts neigen",description:"Schiffsnase nach unten neigen (H√∂hen√§nderung im Weltraum)"},strafe_left:{name:"Links seitlich bewegen",description:"Schiff nach links seitlich bewegen"},strafe_right:{name:"Rechts seitlich bewegen",description:"Schiff nach rechts seitlich bewegen"},forward:{name:"Vorw√§rts",description:"Vorw√§rts bewegen"},backward:{name:"R√ºckw√§rts",description:"R√ºckw√§rts bewegen"},auto_forward:{name:"Auto-Vorw√§rts",description:"Charakter bewegt sich vorw√§rts bis neue Bewegungsbefehle gegeben werden"},follow:{name:"Ziel folgen",description:"Der anvisierten Einheit folgen"},follow_cancel:{name:"Folgen abbrechen",description:"Aufh√∂ren zu folgen und Ziel vergessen"},zoom_in:{name:"Hineinzoomen",description:"Kamera hineinzoomen"},zoom_out:{name:"Herauszoomen",description:"Kamera herauszoomen"},zoom_in_small:{name:"Leicht hineinzoomen",description:"Kamera leicht hineinzoomen"},zoom_out_small:{name:"Leicht herauszoomen",description:"Kamera leicht herauszoomen"},cam_distance:{name:"Kameraentfernung setzen",description:"Kameraentfernung vom Spieler setzen"},cam_reset:{name:"Kamera zur√ºcksetzen",description:"Kameraposition auf Standard zur√ºcksetzen"},cam_target_lock:{name:"Kamera an Ziel fixieren",description:"Kamera am Ziel fixieren oder l√∂sen"},cam_cycle_distance:{name:"Kameraentfernung wechseln",description:"Kameraentfernung zwischen mehreren voreingestellten Werten wechseln"},cam_mouse_look:{name:"Maus-Blick",description:"Maus-Blick-Kamerasteuerung aktivieren"},cam_turn_to_face:{name:"Zur Kamera drehen",description:"Schiff in Kamerarichtung drehen"},look_up:{name:"Nach oben blicken",description:"Blickwinkel √§ndern um geradeaus nach oben zu blicken"},look_down:{name:"Nach unten blicken",description:"Blickwinkel √§ndern um geradeaus nach unten zu blicken"},team_message:{name:"Team-Nachricht",description:"Nachricht an Team senden"},local_message:{name:"Lokale Nachricht",description:"Nachricht an lokalen Bereich senden"},zone_message:{name:"Zonen-Nachricht",description:"Nachricht an Zone senden"},toggle_hud:{name:"HUD umschalten",description:"HUD-Sichtbarkeit umschalten"},screenshot:{name:"Screenshot",description:"Einen Screenshot machen"},screenshot_jpg:{name:"Screenshot JPG",description:"Einen Screenshot als JPG speichern"},autofire_set:{name:"Autofeuer einstellen",description:"Waffen-Autofeuer ein- und ausschalten. X = 1 schaltet es ein und X = 0 schaltet es aus."},bind_save_file:{name:"Binds in Datei speichern",description:"Alle Binds in eine Textdatei speichern"},bind_load_file:{name:"Binds aus Datei laden",description:"Eine Bind-Datei in den Client laden"},combat_log:{name:"Kampflog umschalten",description:"Kampflog-Aufzeichnung ein-/ausschalten (1=ein, 0=aus)"},missions:{name:"Missionen anzeigen/verbergen",description:"Missionstagebuch anzeigen/verbergen"},inventory:{name:"Inventar anzeigen/verbergen",description:"Inventar anzeigen/verbergen"},map:{name:"Karte",description:"Karte anzeigen/verbergen"},assist:{name:"Unterst√ºtzen",description:"Unterst√ºtzen '<name>': Unterst√ºtzt die Entit√§t mit dem √ºbereinstimmenden Namen. Wenn kein Name angegeben wird, unterst√ºtzt Ihr aktuelles Ziel."},net_timing_graph:{name:"Netzwerk-Timing-Graph",description:"Netzwerk-Timing-Graph aktivieren oder deaktivieren (0=deaktivieren, 1=aktivieren)"},net_timing_graph_alpha:{name:"Netzwerk-Timing-Graph Alpha",description:"Transparenzstufe f√ºr Netzwerk-Timing-Graph setzen (50=h√∂chste Transparenz, 255=keine Transparenz)"},net_timing_graph_paused:{name:"Netzwerk-Timing-Graph Pausiert",description:"Netzwerk-Timing-Graph pausieren oder fortsetzen (0=Pause deaktiviert, 1=Pause aktiviert)"},netgraph:{name:"Netzwerk-Graph",description:"SND und RCV Netzwerkdaten als Text anzeigen (1=aktiviert, 0=deaktiviert)"},setrallypoint:{name:"Sammelpunkt setzen",description:"Einen Sammelpunkt f√ºr Ihr aktuelles Ziel setzen"},setrallypointconsole:{name:"Sammelpunkt setzen (Konsole)",description:"Einen Sammelpunkt f√ºr Ihr aktuelles Ziel setzen (Konsolenvariante)"},clearrallypoint:{name:"Sammelpunkt l√∂schen",description:"Den Sammelpunkt f√ºr Ihr aktuelles Ziel l√∂schen"},clearallrallypoints:{name:"Alle Sammelpunkte l√∂schen",description:"Alle Sammelpunkte l√∂schen"},aim:{name:"Zielen",description:"Zielt auf das Ziel"},change_instance:{name:"Instanz wechseln",description:"Wechselt zu einer bereits erstellten Instanz derselben Karte. Funktioniert nur au√üerhalb des Roten Alarms."},chat_log:{name:"Chat-Log umschalten",description:"Chat-Log-Aufzeichnung ein-/ausschalten (1=an, 0=aus)"},goto_character_select:{name:"Zum Charakterauswahlbildschirm",description:"Zum Charakterauswahlbildschirm wechseln, ohne sich abzumelden."},holster:{name:"Waffe ablegen",description:"Waffe ablegen"},holster_toggle:{name:"Waffe umschalten",description:"Waffe ein-/ausblenden"},logout:{name:"Abmelden",description:"Aktuellen Charakter abmelden"},quit:{name:"Spiel beenden",description:"Fenster schlie√üen"},remember_ui_lists:{name:"UI-Listen merken",description:"Ob die Platzierung und Breite der UI-Listen gemerkt werden soll"},safe_login:{name:"Sicherer Login",description:"Bei Aktivierung wird der Spieler auf die zuletzt besuchte statische Karte eingeloggt"},setactivecostume:{name:"Aktives Kost√ºm setzen",description:"Setzt das aktuelle aktive Kost√ºm. Erfordert zwei Modifikatoren."},shooter_clear_offset_tray_binds:{name:"Shooter Offset-Tray-Bindings l√∂schen",description:"L√∂scht Offset-Tray-Bindings im Shooter-Modus"},shooter_clear_overlay_tray_binds:{name:"Shooter Overlay-Tray-Bindings l√∂schen",description:"L√∂scht Overlay-Tray-Bindings im Shooter-Modus"},shooter_primary:{name:"Shooter Prim√§r",description:"Prim√§rangriff im Shooter-Modus"},shooter_secondary:{name:"Shooter Sekund√§r",description:"Sekund√§rangriff im Shooter-Modus"},shooter_set_offset_tray_binds:{name:"Shooter Offset-Tray-Bindings setzen",description:"Setzt Offset-Tray-Bindings im Shooter-Modus"},shooter_set_overlay_tray_binds:{name:"Shooter Overlay-Tray-Bindings setzen",description:"Setzt Overlay-Tray-Bindings im Shooter-Modus"},shooter_tertiary:{name:"Shooter Terti√§r",description:"Terti√§rangriff im Shooter-Modus"},show_game_ui:{name:"Spiel-UI anzeigen",description:"Zeigt die Spiel-Benutzeroberfl√§che an"},show_game_ui_no_extra_keybinds:{name:"Spiel-UI anzeigen (ohne zus√§tzliche Keybinds)",description:"Zeigt die Spiel-UI ohne zus√§tzliche Escape-Keybinds an"},toggle_shooter_mode:{name:"Shooter-Modus umschalten",description:"Zwischen Shooter- und RPG-Modus umschalten"},ui_cancel:{name:"UI Abbrechen",description:"Antwortet mit 'Abbrechen' auf ein offenes Dialogfeld; funktioniert nicht in allen Dialogen"},ui_gen_layers_reset:{name:"UI-Layout zur√ºcksetzen",description:"Setzt das Layout zur√ºck, wenn der Server die Position beweglicher Fenster aktualisiert"},ui_load:{name:"UI-Einstellungen laden",description:"L√§dt die Standard-UI-Einstellungsdatei, normalerweise Live\\ui_settings.txt"},ui_load_file:{name:"UI-Einstellungsdatei laden",description:"L√§dt eine benannte UI-Einstellungsdatei"},ui_ok:{name:"UI OK",description:"Antwortet mit 'OK' auf ein offenes Dialogfeld; funktioniert nicht in allen Dialogen"},ui_remember_positions:{name:"UI-Positionen merken",description:"Ob UI-Gr√∂√üen und -Positionen gemerkt werden sollen. Standardm√§√üig aktiviert."},ui_resolution:{name:"UI-Aufl√∂sung anzeigen",description:"Zeigt die aktuelle UI-Bildschirmaufl√∂sung an"},ui_save:{name:"UI-Einstellungen speichern",description:"Speichert das UI-Layout in der Standard-UI-Einstellungsdatei, normalerweise Live\\ui_settings.txt"},ui_save_file:{name:"UI-Einstellungsdatei speichern",description:"Speichert das UI-Layout in einer benannten UI-Einstellungsdatei"},ui_tooltip_delay:{name:"Tooltip-Verz√∂gerung setzen",description:"Setzt die zus√§tzliche Verz√∂gerung in Sekunden, bevor Tooltips angezeigt werden"},unholster:{name:"Waffe ziehen",description:"Waffe ziehen"},parameter_placeholders:{any_sto_command:"Beliebigen STO-Befehl eingeben (z.B. Target_Enemy_Near)",entity_name:"Entit√§tsnamen eingeben",first_modifier:"Erster Modifikator",second_modifier:"Zweiter Modifikator",entity_name_optional:"Entit√§tsname (optional)"}},category_descriptions:{targeting:"Zielauswahl und -verwaltung",combat:"Waffenfeuer und Kampfaktionen",tray:"F√§higkeiten aus Aktions-Trays ausf√ºhren",power:"Schildenergie und Verteilungsverwaltung",movement:"Schiffsbewegung und Navigation",camera:"Kamerasteuerung und Ansichtsverwaltung",communication:"Chat und Teamkommunikation",system:"UI- und Systembefehle",custom:"Benutzerdefinierte Befehle"},no_aliases_defined:"Keine Aliase definiert",create_alias_to_get_started:"Erstellen Sie einen Alias um zu beginnen",alias_deleted:'Alias "{{aliasName}}" gel√∂scht',please_select_a_key_first:"Bitte w√§hlen Sie zuerst eine Taste",no_active_profile:"Kein aktives Profil",alias_not_found:'Alias "{{name}}" nicht gefunden',alias_created:"Alias erfolgreich erstellt",import_failed:"Import fehlgeschlagen: {{error}}",storage_not_available:"Speicher nicht verf√ºgbar",no_aliases_found_in_file:"Keine Aliase in Datei gefunden",import_completed_keybinds:"Import abgeschlossen: {{count}} Keybinds",import_completed_aliases:"Import abgeschlossen: {{count}} Aliase",kbf_import_completed:"KBF-Import abgeschlossen: {{bindsets}} Bindset(s), {{keys}} Taste(n), {{aliases}} Alias(e)",kbf_import_skipped_activities:"{{count}} √ºbersprungene Aktivit√§ten",kbf_import_errors_encountered:"{{count}} Fehler aufgetreten",kbf_import_warnings_generated:"{{count}} Warnungen generiert",kbf_import_processing_time:"Verarbeitet in {{seconds}}s",kbf_import_error_summary:"Zusammenfassung",kbf_import_bindsets_processed:"{{count}} Bindsets verarbeitet",kbf_import_bindsets_failed:"{{count}} Bindsets fehlgeschlagen",kbf_import_total_errors:"{{count}} Gesamtfehler",kbf_import_total_warnings:"{{count}} Gesamtwarnungen",project_imported_successfully:"Projekt erfolgreich importiert: {{profileCount}} Profile",sync_folder_set:"Sync-Ordner ausgew√§hlt",failed_to_set_sync_folder:"Sync-Ordner ausw√§hlen fehlgeschlagen: {{error}}",sync_not_supported_firefox:"Die Sync-Ordner-Funktionalit√§t erfordert einen Chromium-basierten Browser (Chrome, Edge, etc.). Firefox unterst√ºtzt die erforderliche File System Access API nicht.",sync_not_supported_title:"Sync nicht unterst√ºtzt",sync_not_supported_detailed:"Die Sync-Funktionalit√§t ist in Firefox aufgrund von Browser-Beschr√§nkungen nicht verf√ºgbar. Die f√ºr die Ordner-Synchronisation erforderliche File System Access API wird nur in Chromium-basierten Browsern unterst√ºtzt. Sie k√∂nnen Ihren Anwendungsstatus manuell sichern und wiederherstellen oder den Datei-Explorer verwenden, um Ihre Keybind- und Alias-Dateien zu kopieren.",sync_not_supported_secure_context:"Sync-Service ist nicht verf√ºgbar, wenn √ºber HTTP bereitgestellt. Bitte verwenden Sie HTTPS oder greifen Sie √ºber das file://-Protokoll zu, um die Sync-Funktionalit√§t zu aktivieren.",sync_not_supported_secure_context_title:"Sicherer Kontext erforderlich",sync_not_supported_secure_context_detailed:"Die Sync-Funktionalit√§t erfordert eine sichere Verbindung (HTTPS) oder lokalen Dateizugriff (file://), um zu funktionieren. Die f√ºr die Ordner-Synchronisation erforderliche File System Access API ist nur in sicheren Kontexten verf√ºgbar, um Ihre Daten zu sch√ºtzen. Bitte greifen Sie auf diese Anwendung √ºber HTTPS zu oder √∂ffnen Sie sie als lokale Datei.",sync_not_supported_browser:"Ihr Browser unterst√ºtzt die f√ºr die Sync-Funktionalit√§t erforderliche File System Access API nicht.",sync_not_supported_browser_title:"Browser nicht unterst√ºtzt",sync_not_supported_browser_detailed:"Ihr Browser unterst√ºtzt die f√ºr die Ordner-Synchronisation erforderliche File System Access API nicht. Bitte versuchen Sie, einen Chromium-basierten Browser (Chrome, Edge, etc.) mit einer sicheren Verbindung (HTTPS) oder lokalem Dateizugriff zu verwenden.",no_sync_folder_selected:"Kein Sync-Ordner ausgew√§hlt",project_synced_successfully:"Projekt erfolgreich synchronisiert",sync_folder_contains_project_title:"Vorhandene Sync-Daten gefunden",sync_folder_contains_project_prompt:"Dieser Ordner enth√§lt bereits eine project.json von einer vorherigen Synchronisation. Jetzt importieren anstatt zu √ºberschreiben?",project_imported_from_sync_folder:"Anwendungsstatus aus Sync-Ordner importiert",sync_overwrite_existing_title:"Sync-Daten √ºberschreiben?",sync_overwrite_existing_prompt:"Import abgelehnt. Sync-Ordner mit aktuellem Anwendungsstatus √ºberschreiben?",sync_operation_cancelled:"Synchronisation abgebrochen",failed_to_import_project:"Projektimport fehlgeschlagen: {{error}}",permission_denied_to_folder:"Berechtigung zum Schreiben in Ordner verweigert",failed_to_sync_project:"Projekt-Synchronisation fehlgeschlagen: {{error}}",synchronization:"Synchronisation",advanced:"Erweitert",synchronization_settings:"Synchronisationseinstellungen",advanced_settings:"Erweiterte Einstellungen",sync_folder_description:"W√§hlen Sie einen Ordner zum automatischen Synchronisieren Ihrer Projekte",auto_sync:"Automatische Synchronisation",auto_sync_description:"√Ñnderungen automatisch mit dem ausgew√§hlten Ordner synchronisieren",auto_sync_interval:"Auto-Sync-Intervall",auto_sync_interval_description:"Wie oft Ihre √Ñnderungen automatisch synchronisiert werden sollen",after_every_change:"Nach jeder √Ñnderung",every_1_minute:"Jede Minute",every_2_minutes:"Alle 2 Minuten",every_5_minutes:"Alle 5 Minuten",bind_to_alias_mode:"Keybind-Ketten als Aliase erstellen",bind_to_alias_mode_description:"Wenn aktiviert, werden Keybind-Ketten als Aliase generiert, benannt nach Umgebung und Taste (z.B. 'space_q'), und die Tasten werden so gebunden, dass sie diese Aliase aufrufen.",preferences_saved:"Einstellungen erfolgreich gespeichert",vfx_manager_description:"W√§hlen Sie visuelle Effekte aus, die mit dynFxSetFXExlusionList-Aliasen deaktiviert werden sollen. Effekte sind nach Umgebung organisiert.",app_description:"Ein umfassendes webbasiertes Tool zum Erstellen, Bearbeiten und Verwalten von Star Trek Online Keybind-Konfigurationen mit visueller Bearbeitung und erweiterten Funktionen.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"W√§hlen Sie einen Raum-/Boden-Build oder Aliase aus, um die Exportvorschau anzuzeigen.",alias_mode:"Alias-Modus",create:"Erstellen",filter_aliases:"Aliase filtern",select_an_alias_to_edit:"W√§hlen Sie einen Alias zum Bearbeiten",select_an_alias_to_see_the_generated_command:"W√§hlen Sie einen Alias um den generierten Befehl zu sehen",no_alias_selected:"Kein Alias ausgew√§hlt",select_alias_from_left_panel:"W√§hlen Sie einen Alias aus dem linken Bereich aus, um seine Befehlssequenz anzuzeigen und zu bearbeiten.",select_key_from_left_panel:"W√§hlen Sie eine Taste aus dem linken Bereich aus, um ihre Befehlssequenz anzuzeigen und zu bearbeiten.",failed_to_load_application:"Anwendung konnte nicht geladen werden",profile_created:'Profil "{{name}}" erstellt',failed_to_create_profile:"Profil konnte nicht erstellt werden",failed_to_clone_profile:"Profil konnte nicht geklont werden",cannot_delete_the_last_profile:"Das letzte Profil kann nicht gel√∂scht werden",profile_deleted:'Profil "{{profileName}}" gel√∂scht',failed_to_delete_profile:"Profil konnte nicht gel√∂scht werden",invalid_key_name:"Ung√ºltiger Tastenname",key_added:'Taste "{{keyName}}" hinzugef√ºgt',key_already_exists:'Taste "{{keyName}}" existiert bereits',key_deleted:'Taste "{{keyName}}" gel√∂scht',key_duplicated:'Taste "{{from}}" dupliziert als "{{to}}"',failed_to_delete_key:"Taste konnte nicht gel√∂scht werden",key_not_found:'Taste "{{keyName}}" nicht gefunden',failed_to_duplicate_key:"Taste konnte nicht dupliziert werden",alias_duplicated:'Alias "{{from}}" dupliziert als "{{to}}"',failed_to_add_alias:"Alias konnte nicht erstellt werden",failed_to_delete_alias:"Alias konnte nicht gel√∂scht werden",failed_to_duplicate_alias:"Alias konnte nicht dupliziert werden",alias_already_exists:'Alias "{{name}}" existiert bereits',invalid_alias_name:"Ung√ºltiger Alias-Name",invalid_project_file:"Ung√ºltige Projektdatei",no_commands_to_duplicate:"Keine Befehle zum Duplizieren",command_chain_is_valid:"Befehlskette ist g√ºltig",no_profile_selected:"Kein Profil ausgew√§hlt",language_updated:"Sprache aktualisiert",nothing_to_copy:"Nichts zu kopieren",content_copied_to_clipboard:"Inhalt in Zwischenablage kopiert",failed_to_generate_export:"Export konnte nicht generiert werden",no_profile_selected_to_clone:"Kein Profil zum Klonen ausgew√§hlt",no_profile_selected_to_rename:"Kein Profil zum Umbenennen ausgew√§hlt",profile_name_is_required:"Profilname ist erforderlich",failed_to_save_profile:"Profil konnte nicht gespeichert werden: {{error}}",no_profile_selected_to_delete:"Kein Profil zum L√∂schen ausgew√§hlt",no_keybinds_to_export:"Keine Keybinds zum Exportieren",no_aliases_to_export:"Keine Aliase zum Exportieren",application_reset_successfully:"Anwendung erfolgreich zur√ºckgesetzt",confirm_clear:"L√∂schen best√§tigen",confirm_clear_commands:'Sind Sie sicher, dass Sie alle Befehle f√ºr "{{keyName}}" l√∂schen m√∂chten?',confirm_delete_alias:'Sind Sie sicher, dass Sie den Alias "{{aliasName}}" l√∂schen m√∂chten?',confirm_delete_key:'Sind Sie sicher, dass Sie die Taste "{{keyName}}" und alle ihre Befehle l√∂schen m√∂chten?',confirm_delete_profile:'Sind Sie sicher, dass Sie das Profil "{{profileName}}" l√∂schen m√∂chten?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden.',failed_to_copy_to_clipboard:"In Zwischenablage kopieren fehlgeschlagen",no_effects_selected:"Keine Effekte ausgew√§hlt. Bitte w√§hlen Sie mindestens einen Effekt aus, um Aliase zu generieren.",profile_created_from:'Profil "{{newName}}" aus "{{sourceProfile}}" erstellt',profile_renamed:'Profil von "{{oldName}}" zu "{{name}}" umbenannt',sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager erfolgreich geladen",switched_to_profile:"Zu Profil gewechselt: {{name}} ({{environment}})",yes:"Ja",no:"Nein",ok:"OK",no_commands:"Keine Befehle",profile_not_found:"Profil nicht gefunden",click_add_command_to_start_building_your_command_chain:"W√§hlen Sie Elemente in der Befehlsbibliothek aus, um mit dem Erstellen Ihrer Tasten-Befehlsfolge f√ºr zu beginnen",click_add_command_to_start_building_your_alias_chain:"W√§hlen Sie Elemente in der Befehlsbibliothek aus, um mit dem Erstellen Ihrer Alias-Befehlsfolge f√ºr zu beginnen",create_alias:"Alias erstellen",key:"Taste",no_profile:"Kein Profil",parameter_configuration:"Parameter-Konfiguration",stotrayexecbytray_description:"STOTrayExecByTray (zeigt Tastenbelegung in der UI an)",trayexecbytray_description:"TrayExecByTray (keine UI-Anzeige)",vfx_aliases:"VFX-Aliase",bindset_enable:"Aktivieren",vfx_alias_space:"VFX-Alias: Raum",vfx_alias_ground:"VFX-Alias: Boden",vfx_alias_combined:"VFX-Alias: Kombiniert Raum/Boden",vfx_suppression_loaded:"VFX-Unterdr√ºckung geladen",vfx_suppression_for_environment:"VFX-Unterdr√ºckung f√ºr {{environment}}-Umgebung",vfx_suppression_for_all_environments:"VFX-Unterdr√ºckung f√ºr alle Umgebungen",delete_selected_key:"Ausgew√§hlte Taste l√∂schen",duplicate_selected_key:"Ausgew√§hlte Taste duplizieren",show_all_keys:"Alle Tasten anzeigen",duplicate:"Duplizieren",reserved_command_name:"Name steht im Konflikt mit einem STO-Befehl",backup_created_successfully:"Anwendungsbackup erfolgreich erstellt",failed_to_create_backup:"Backup erstellen fehlgeschlagen: {{error}}",backup_restored_successfully:"Anwendungsstatus erfolgreich wiederhergestellt",import_from_key_or_alias:"Von Taste oder Alias importieren",select_source_to_import_from:"Quelle zum Importieren ausw√§hlen:",clear_destination_chain_prior_to_import:"Zielkette vor Import l√∂schen",no_sources_available:"Keine Quellen verf√ºgbar",error_loading_sources:"Fehler beim Laden der Quellen",please_select_a_source:"Bitte w√§hlen Sie eine Quelle",source_has_no_commands:"Quelle hat keine Befehle zum Importieren",commands_imported_successfully:"{{count}} Befehle von {{source}} importiert",cross_environment_import_warning:"Warnung: {{dropped}} {{sourceEnv}}-spezifische Befehle wurden beim Import nach {{targetEnv}} entfernt",no_compatible_commands_to_import:"Keine kompatiblen Befehle zum Importieren nach Filterung",failed_to_load_profile_data:"Fehler beim Laden der Profildaten",already_on_profile:"Bereits bei diesem Profil",source_profile_not_found:"Quellprofil nicht gefunden",profile_name_required:"Profilname ist erforderlich",switch_to_key_type_view:"Zur Tastentypansicht wechseln",switch_to_grid_view:"Zur Rasteransicht wechseln",switch_to_command_categories:"Zu Befehlskategorien wechseln",no_profiles_available:"Keine Profile verf√ºgbar",verb:{say:"Sagen (Lokal)",team:"Team",zone:"Zone",tell:"Fl√ºstern"},duplicate_alias:"Alias duplizieren",enter_new_alias_name:"Neuen Alias-Namen eingeben",alias_name_in_use:"Alias-Name bereits vergeben",failed_to_rename_profile:"Fehler beim Umbenennen des Profils: {{error}}",ground_build:"Boden-Build",import_failed_invalid_json:"Import fehlgeschlagen: Ung√ºltiges JSON-Format",import_failed_unsupported_format:"Import fehlgeschlagen: Nicht unterst√ºtztes Dateiformat",no_content_available:"Kein Inhalt verf√ºgbar",no_valid_profile:"Kein g√ºltiges Profil verf√ºgbar",profile_already_exists:"Profil existiert bereits",profile_id_required:"Profil-ID ist erforderlich",space_build:"Weltraum-Build",syncing:"Synchronisiere...",command_parameters:{active:{label:"Aktiv",help:"0: Deaktiviert, 1: Aktiviert"},tray:{label:"Fach",help:"Fachnummer (0-9). 0=Spiel-Fach 1"},slot:{label:"Slot",help:"Platznummer (0-9). 0=Spiel-Platz 1"},start_tray:{label:"Startfach",help:"Startfachnummer (0-9). 0=Spiel-Fach 1"},end_tray:{label:"Endfach",help:"Endfachnummer (0-9). 0=Spiel-Fach 1"},start_slot:{label:"Startslot",help:"Startplatznummer (0-9). 0=Spiel-Platz 1"},end_slot:{label:"Endslot",help:"Endplatznummer (0-9). 0=Spiel-Platz 1"},backup_tray:{label:"Backup-Fach",help:"Backup-Fachnummer (0-9). 0=Spiel-Fach 1"},backup_slot:{label:"Backup-Slot",help:"Backup-Platznummer (0-9). 0=Spiel-Platz 1"},backup_start_tray:{label:"Backup-Startfach",help:"Backup-Startfachnummer (0-9). 0=Spiel-Fach 1"},backup_end_tray:{label:"Backup-Endfach",help:"Backup-Endfachnummer (0-9). 0=Spiel-Fach 1"},backup_start_slot:{label:"Backup-Startslot",help:"Backup-Startplatznummer (0-9). 0=Spiel-Platz 1"},backup_end_slot:{label:"Backup-Endslot",help:"Backup-Endplatznummer (0-9). 0=Spiel-Platz 1"},command_type:{label:"Befehlstyp",help:"Befehlsausf√ºhrungstyp (STOTrayExecByTray zeigt UI, TrayExecByTray nicht)"},entityName:{label:"Entit√§tsname",help:"Name der zu zielenden Entit√§t"},message:{label:"Nachricht",help:"Nachrichtentext zum Senden"},distance:{label:"Entfernung",help:"Kameraentfernungswert"},amount:{label:"Betrag",help:"Drosselstellungsbetrag"},position:{label:"Position",help:"Drosselstellung (0-100)"},filename:{label:"Dateiname",help:"Dateiname (ohne Erweiterung)"},state:{label:"Status",help:"1 zum Aktivieren, 0 zum Deaktivieren"},verb:{label:"Kanal",help:"Kommunikationskanal (sagen, Team, Zone)"},alias_name:{label:"Alias-Name",help:"Name des auszuf√ºhrenden Alias"},rawCommand:{label:"Befehl",help:"Roher STO-Befehlstext"},seconds:{label:"Sekunden",help:"Verz√∂gerung in Sekunden"},alpha:{label:"Alpha",help:"Transparenzwert (0-255)"},modifier1:{label:"Modifikator 1",help:"Erste Modifikator-Tastenkombination"},modifier2:{label:"Modifikator 2",help:"Zweite Modifikator-Tastenkombination"},name:{label:"Name",help:"Name des Ziels oder Objekts"},degrees:{label:"Grad",help:"Gr√∂√üe des Kegels in Grad"}},add_new_alias:"Neuen Alias hinzuf√ºgen",delete_selected_alias:"Ausgew√§hlten Alias l√∂schen",duplicate_selected_alias:"Ausgew√§hlten Alias duplizieren",search_aliases:"Aliase suchen...",clear_filter:"Filter l√∂schen",warning:"Warnung",error:"Fehler",validation_details:"Validierungsdetails",command_chain_near_limit:"Befehlsfolge ist fast zu lang ({{length}} Zeichen). √úberschreiten von 999 kann zu Fehlern f√ºhren.",command_chain_too_long:"Befehlsfolge ist zu lang ({{length}} Zeichen) und kann im Spiel fehlschlagen.",sto_tray_exec_optimization_suggestion:"Befehlsfolge ist {{currentLength}} Zeichen lang. Das Ersetzen von {{count}} Vorkommen von STOTrayExecByTray durch TrayExecByTray w√ºrde {{potentialSavings}} Zeichen sparen (neue L√§nge: {{newLength}}).",stabilized_non_tray_warning:"Stabilisierte Ausf√ºhrung sollte nur mit Tray-Ausf√ºhrungsf√§higkeiten verwendet werden.",too_many_commands_on_key:"Die Zuordnung von {{count}} Befehlen zu einer Taste kann im Spiel fehlschlagen (empfohlene Obergrenze 20).",alias_mixed_environment_warning:"Alias enth√§lt sowohl weltraum- als auch bodenspezifische Befehle; dies ist nicht empfohlen.",spam_bar_warning:"Nicht f√ºr Spam-Leisten empfohlen, da es die Feuerzyklen st√∂rt",press_any_key_combination:"Dr√ºcken Sie eine beliebige Tastenkombination...",capture_instructions:"Verwende deine Tastatur oder Maus, oder wechsle in den manuellen Modus, um unten Tasten anzuklicken",switch_to_manual:"Manuelle Auswahl",start_capture:"Aufnahme starten",selected_key:"Ausgew√§hlte Taste",confirm_selection:"Auswahl best√§tigen",key_selection_failed:"Tastenauswahl fehlgeschlagen",error_generating_command:"Fehler beim Generieren des Befehls",please_enter_a_raw_command:"Bitte geben Sie einen Befehl ein",unsafe_keybind:"Unsichere Tastenkombination: {{key}} ist nicht zul√§ssig",generated_alias:"Generierter Alias:",bindsets_enabled:"Bindsets aktivieren",bindsets_enabled_description:"Erm√∂glicht die Erstellung und das Laden von Bindsets (erfordert 'Keybind-Ketten als Aliase erstellen').",bindsets:"Bindsets",bindset_manager:"Bindset-Manager",create_bindset:"Bindset erstellen",enter_bindset_name:"Bindset-Name eingeben:",bindset_name:"Bindset-Name",bindset_name_in_use:"Bindset-Name bereits vergeben",bindset_not_empty:"Bindset enth√§lt Keybinds und kann nicht gel√∂scht werden",invalid_name:"Ung√ºltiger Name",add_key_to_bindset:"Taste zu Bindset hinzuf√ºgen",add_key_to_bindset_confirm:'Taste "{{key}}" zu Bindset "{{bindset}}" hinzuf√ºgen?',manage_bindsets:"Bindsets verwalten",primary_bindset:"Prim√§res Bindset",remove_key_from_bindset:"Taste aus Bindset entfernen",remove_key_from_bindset_confirm:'Taste "{{key}}" aus Bindset "{{bindset}}" entfernen?',select_bindset:"Bindset ausw√§hlen",confirm_delete:"Sind Sie sicher, dass Sie l√∂schen m√∂chten?",enter_new_name:"Neuen Namen eingeben:",translate_generated_messages:"Generierte Nachrichten √ºbersetzen",translate_generated_messages_description:"Wenn aktiviert, werden automatisch generierte Nachrichten (wie VFX-Unterdr√ºckungsbenachrichtigungen) in die ausgew√§hlte Sprache √ºbersetzt. Wenn deaktiviert, bleiben sie auf Englisch.",distinguish_left_right_modifiers:"Linke/rechte Modifikatoren unterscheiden",confirm_reset_application:"Sind Sie sicher, dass Sie die Anwendung zur√ºcksetzen m√∂chten?\n\nDies l√∂scht alle Profile, Keybinds und Einstellungen. Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",environment:"Umgebung",export_alias_definitions_note:"(Alias-Definitionen sind in der Alias-Datei)",export_generated_aliases_count:"aus Alias-an-Tasten-Modus ({{count}} generierte Aliase)",export_generated_aliases_note:"Keybind-Zeilen, die generierte Aliase aufrufen",export_user_and_generated_aliases:"Diese Datei enth√§lt sowohl benutzererstellte Aliase als auch generierte Aliase",please_select_an_alias_first:"Bitte w√§hlen Sie zuerst einen Alias",confirm_reset_app:"Anwendung zur√ºcksetzen best√§tigen",configure_colon:"Konfigurieren:",edit_colon:"Bearbeiten:",default_profile_exists_message:'Ein Profil namens "Default" existiert bereits. Das Laden der Standarddaten w√ºrde es √ºberschreiben. M√∂chten Sie fortfahren?',default_profile_exists_title:"Standard-Profil existiert",ground_alias:"Boden-Alias",space_alias:"Raum-Alias",backup_restore_failed:"Wiederherstellung der Sicherung fehlgeschlagen: {{error}}",confirm_add:"Hinzuf√ºgen best√§tigen",confirm_delete_bindset:'Bindset "{{name}}" l√∂schen?',confirm_remove:"Entfernen best√§tigen",error_add_failed:"Fehler beim Hinzuf√ºgen der Taste zum Bindset",error_remove_failed:"Fehler beim Entfernen der Taste aus dem Bindset",name_exists:"Name existiert bereits",name_required:"Name ist erforderlich",name_unchanged:"Name ist unver√§ndert",not_found:"Nicht gefunden",rename_bindset:"Bindset umbenennen",bindset_actions:"Bindset-Aktionen",source_profile_and_new_name_required:"Quellprofil-ID und neuer Name sind erforderlich",unknown_command:"Unbekannter Befehl",command_group_hint_fixed_order:"Wird immer zuerst ausgef√ºhrt",command_group_hint_palindromic:"Beeinflusst Palindromstruktur",command_group_hint_pivot:"Bildet Palindrommitte",command_group_non_trayexec:"Vor dem Palindrom",command_group_palindromic:"Palindromische TrayExec",command_group_pivot:"Pivot-Gruppe",palindromic_excluded_tooltip:"Von Palindrom ausgeschlossen (klicken zum einschlie√üen)",palindromic_included_tooltip:"In Palindrom eingeschlossen (klicken zum ausschlie√üen)",placement_before_palindromes_tooltip:"Vor Palindromen (klicken um zur Pivot-Gruppe zu verschieben)",placement_in_pivot_group_tooltip:"In Pivot-Gruppe (klicken um vor Palindrome zu verschieben)",toggle_collapse:"Zusammenklappen umschalten",primary_bindset_copy_default:"Prim√§res Bindset Kopie",copy_suffix:"Kopie",no_keys_in_bindset:"Keine Tasten in diesem Bindset",switch_to_categorized_view:"Zur kategorisierten Ansicht wechseln",clone_bindset:"Bindset klonen",delete_bindset:"Bindset l√∂schen",bindset_delete_warning:'Dieses Bindset "{{name}}" enth√§lt {{count}} Tasten und wird permanent gel√∂scht.',bindset_delete_consequences:"Alle Tastenbindungen in diesem Bindset gehen permanent verloren und k√∂nnen nicht wiederhergestellt werden.",bindset_delete_confirmation_text:"Ich verstehe, dass dies alle Tasten in diesem Bindset permanent l√∂schen wird",bindset_delete_type_confirm:"DELETE zum Best√§tigen eingeben",confirm_delete_bindset_with_keys:"Bindset mit Tasten l√∂schen",bindset_deleted:'Bindset "{{name}}" erfolgreich gel√∂scht',configure_kbf_import:"KBF-Import konfigurieren",configure_kbf_import_question:"Konfigurieren, wie die ausgew√§hlten Bindsets importiert werden sollen:",import_configured:"Import konfiguriert",custom_name:"Benutzerdefinierter Name",primary_mapping_options:"Primary-Zuordnungsoptionen",map_master_to_primary:"Master-Bindset auf Primary zuordnen",create_new_primary:"Neues Primary-Bindset erstellen",primary_name_placeholder:"Primary-Bindset-Namen eingeben",skip_primary_mapping:"Primary-Zuordnung √ºberspringen (als benannte Bindsets behalten)",import_preview:"Import-Vorschau",select_bindsets_for_preview:"W√§hlen Sie oben Bindsets aus, um deren Inhalte anzuzeigen",mapped_to_primary:"Zugeordnet zu Primary",mapped_to_new_primary:"Zugeordnet zu neuem Primary: {{name}}",mapped_to_named:"Zugeordnet zu benanntem Bindset",maps_to_primary_bindset:"Weist zu Primary Bindset zu",not_mapped:"Nicht importiert",maps_to:"Weist zu",original_bindset_name:"Originaler Bindset",mapping_type:"Zuordnungstyp",mapping_destination:"Zuordnungsziel",auto_resolve_conflict:"Automatisch als {{name}} aufgel√∂st",bindset_name_conflict:"Namenskonflikt erkannt",custom_name_placeholder:"Benutzerdefinierten Namen eingeben...",key_count:"Schl√ºsselanzahl",select_bindset_import_question:"W√§hlen Sie, welches Bindset in das prim√§re Bindset importiert werden soll:",select_bindset_to_import:"Bindset zum Import ausw√§hlen",single_bindset_import_note:"Da Bindsets deaktiviert sind, wird dieses Bindset in das prim√§re Bindset importiert.",reduced_bindset_functionality:"Einzel-Bindset-Import-Modus",reduced_bindset_functionality_description:"Mit deaktivierten Bindsets k√∂nnen Sie ein einzelnes Bindset importieren, das Ihrem prim√§ren Bindset zugeordnet wird. Dies bietet einen optimierten Importerfahrung.",enable_full_bindset_functionality:"F√ºr erweiterte Multi-Bindset-Import-Optionen aktivieren Sie Bindsets in den Einstellungen.",import_strategy:"Import-Strategie",merge_keep_existing:"Zusammenf√ºhren (bestehende behalten)",merge_overwrite_existing:"Zusammenf√ºhren (bestehende √ºberschreiben)",overwrite_all:"Alle √ºberschreiben",overwrite_all_description_keybinds:"Entfernt alle vorhandenen Tastaturbelegungen in dieser Umgebung und ersetzt sie durch importierte.",overwrite_all_description_kbf:"Entfernt vorhandene Tastaturbelegungen aus den ausgew√§hlten Bindsets und ersetzt sie durch importierte KBF-Daten.",overwrite_all_description_kbf_primary:"Entfernt alle vorhandenen Tastaturbelegungen in der prim√§ren Umgebung und ersetzt sie durch importierte KBF-Daten.",overwrite_all_description_kbf_bindsets:"Entfernt vorhandene Tastaturbelegungen aus den ausgew√§hlten Bindsets und ersetzt sie durch importierte KBF-Daten.",overwrite_all_description_aliases:"Entfernt alle vorhandenen Aliase und ersetzt sie durch importierte.",overwrite_confirm_title:"√úberschreiben best√§tigen",overwrite_confirm_body_keys:"Dadurch werden alle vorhandenen Tastaturbelegungen in {{environment}} entfernt und durch die Importdatei ersetzt.",overwrite_confirm_body_aliases:"Dadurch werden alle vorhandenen Aliase entfernt und durch die Importdatei ersetzt.",overwrite_counts:"Aktuell: {{current}} ¬∑ Eingehend: {{incoming}}",overwrite_all_action:"Alle √ºberschreiben",import_result_skipped:"{{imported}} importiert, {{skipped}} Konflikte √ºbersprungen.",import_result_overwrote:"{{imported}} importiert, {{overwritten}} Elemente √ºberschrieben.",import_result_overwrite_all:"{{imported}} nach dem L√∂schen von {{cleared}} vorhandenen Elementen importiert."},ie={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Enregistrer",explorer:"Explorateur",import_keybinds:"Importer les raccourcis",import_environment:"Importer les raccourcis",import_environment_question:"Choisissez un environnement pour importer ce fichier de raccourcis",aliases:"Alias",import_aliases:"Importer les alias",import_kbf_file:"Importer fichier KBF",import_selected:"Importer s√©lection",invalid_kbf_file_format:"Format de fichier KBF invalide",import:"Importer",backup:"Sauvegarde",backup_menu:"Sauvegarde",backup_application_state:"Sauvegarder l'√©tat de l'application",restore_application_state:"Restaurer l'√©tat de l'application",preferences:"Pr√©f√©rences",language:"Langue",sync_folder_label:"Dossier de synchronisation :",no_folder_selected:"Aucun dossier s√©lectionn√©",download:"T√©l√©charger",vfx:"VFX",dark_mode:"Mode sombre",light_mode:"Mode clair",load_default_data:"Charger les donn√©es par d√©faut",reset_application:"R√©initialiser l'application",set_sync_folder:"D√©finir dossier de synchronisation",sync_now:"Synchroniser maintenant",about:"√Ä propos",rename:"Renommer",delete:"Supprimer",space:"Espace",ground:"Sol",modified:"Modifi√©",valid:"Valide",keys:"touches",keys_firstupper:"Touches",copy:"Copier",select_a_key_to_edit:"S√©lectionnez une touche √† modifier",commands:"commandes",command_singular:"commande",no_key_selected:"Aucune touche s√©lectionn√©e",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"S√©lectionnez une touche dans le panneau de gauche pour voir et modifier sa cha√Æne de commandes.",generated_command:"Commande g√©n√©r√©e :",select_a_key_to_see_the_generated_command:"S√©lectionnez une touche pour voir la commande g√©n√©r√©e",add_command:"Ajouter une commande",command_library:"Biblioth√®que de commandes",add_new_key:"Ajouter une nouvelle touche",ctrl:"Ctrl",alt:"Alt",shift:"Maj",cancel:"Annuler",custom:"Personnalis√©",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"alias",profile:"Profil",profile_name:"Nom du profil :",description_optional:"Description (optionnelle) :",alias_name:"Nom de l'alias :",select_key_dialog_title:"S√©lectionner la Touche",vfx_manager:"Gestionnaire VFX",space_effects:"Effets d'espace",select_all:"Tout s√©lectionner",clear_all:"Tout effacer",select_bindsets_to_import:"S√©lectionner les bindsets √† importer",select_bindsets_to_import_question:"Ce fichier KBF contient plusieurs bindsets. Choisissez les bindsets que vous souhaitez importer :",kbf_import_progress:"Importation du fichier KBF",kbf_import_progress_message:"Veuillez patienter pendant que le fichier KBF est trait√©...",kbf_progress_layer:"Couche {{layer}}",kbf_progress_initializing:"Initialisation...",kbf_progress_preparing:"Pr√©paration de l'importation...",kbf_progress_decode_layer1:"D√©codage du format de fichier",kbf_progress_parse_layer2:"Analyse des enregistrements de bindset",kbf_progress_parse_layer3:"Traitement des donn√©es de touches",kbf_progress_parse_layer4:"Analyse des affectations de touches",kbf_progress_parse_layer5:"Traduction des commandes",kbf_progress_decode_layer6:"D√©codage des donn√©es texte",kbf_progress_complete:"Finalisation de l'importation",kbf_progress_processing:"Traitement...",kbf_progress_starting:"D√©marrage de {{stage}}...",kbf_progress_finished_stage:"{{stage}} termin√©e",selected:"s√©lectionn√©",ground_effects:"Effets de sol",generated_aliases:"Alias g√©n√©r√©s :",no_space_effects_selected:"Aucun effet d'espace s√©lectionn√©",no_ground_effects_selected:"Aucun effet de sol s√©lectionn√©",show_player_say:"Afficher le Say du joueur",generate_aliases:"G√©n√©rer des Alias",about_sto_tools_keybind_manager:"√Ä propos de STO Tools Keybind Manager",features:"Fonctionnalit√©s :",visual_keybind_editor:"√âditeur visuel de raccourcis",sto_command_library_with_search_and_categorization:"Biblioth√®que de commandes STO avec recherche et cat√©gorisation",multiple_profile_management_create_clone_rename_delete:"Gestion de profils multiples (cr√©er, cloner, renommer, supprimer)",custom_alias_system_for_complex_command_sequences:"Syst√®me d'alias personnalis√© pour les s√©quences de commandes complexes",vertigo_inspired_vfx_manager_for_visual_effects_control:"Gestionnaire VFX inspir√© de VERTIGO pour le contr√¥le des effets visuels",import_export_keybind_and_alias_files_and_project_backups:"Import/export de fichiers de raccourcis et d'alias, et sauvegardes de projet",real_time_validation_and_command_preview:"Validation en temps r√©el et aper√ßu des commandes",quick_start:"D√©marrage rapide :",create_a_new_profile_or_use_the_default_profile:"Cr√©ez un nouveau profil ou utilisez le profil par d√©faut",select_keys_from_the_grid_and_add_commands_from_the_library:"S√©lectionnez des touches dans la grille et ajoutez des commandes depuis la biblioth√®que",use_the_command_chain_editor_to_build_complex_sequences:"Utilisez l'√©diteur de cha√Ænes de commandes pour construire des s√©quences complexes",export_your_keybinds_as_txt_files_for_use_in_sto:"Exportez vos raccourcis en fichiers .txt pour utilisation dans STO",resources:"Ressources :",copyright:"¬© 2025 STO Tools. Tous droits r√©serv√©s.",got_it:"Compris !",file_explorer:"Explorateur de fichiers",select_an_item_on_the_left_to_preview_export:"S√©lectionnez un √©l√©ment √† gauche pour pr√©visualiser l'export",close:"Fermer",filter_keys:"Filtrer les touches...",search_commands:"Rechercher des commandes...",enter_profile_name:"Entrez le nom du profil",describe_this_keybind_profile:"D√©crivez ce profil de raccourcis",search_keys:"Rechercher des touches...",settings:"Param√®tres",select_profile:"S√©lectionner un profil",new_profile:"Nouveau profil",clone_profile:"Cloner le profil",rename_profile:"Renommer le profil",delete_profile:"Supprimer le profil",space_mode:"Mode espace",ground_mode:"Mode sol",unsaved_changes:"Modifications non enregistr√©es",validation_status:"Statut de validation",bound_keys:"Touches li√©es",toggle_between_grid_and_categorized_view:"Basculer entre la vue grille et cat√©goris√©e",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Assure un ordre d'ex√©cution coh√©rent en miroir des commandes (Phase 1 : gauche √† droite, Phase 2 : droite √† gauche)",validate_command_chain:"Valider la cha√Æne de commandes",command_chain:"Cha√Æne de commandes",alias_chain:"Cha√Æne d'alias",chain_for_key:"{{chainType}} pour {{key}}",clear_all_commands:"Effacer toutes les commandes",copy_to_clipboard:"Copier dans le presse-papiers",generated:"G√©n√©r√© :",created_by:"Cr√©√© par :",statistics:"Statistiques",total_commands:"Total des commandes :",command_aliases:"Alias de commandes",key_type:{function_keys:"Touches de fonction",letters_numbers:"Lettres et nombres",numberpad:"Pav√© num√©rique",modifier_keys:"Touches modificatrices",navigation:"Navigation",system_keys:"Touches syst√®me",mouse_wheel:"Souris et molette",symbols_punctuation:"Symboles et ponctuation",other_keys:"Autres touches"},command_categories:{targeting:"Ciblage",combat:"Combat",cosmetic:"Cosm√©tique",bridge_officer:"Officier de passerelle",tray:"Ex√©cution de Plateau",power:"Gestion des Boucliers",movement:"Mouvement",camera:"Cam√©ra",communication:"Communication",system:"Syst√®me",custom:"Personnalis√©"},command_definitions:{add_custom_command:{name:"Ajouter une commande personnalis√©e",description:"Ajouter n'importe quelle commande STO comme texte brut"},target:{name:"Cibler par nom",description:"Cibler une entit√© par son nom (n√©cessite des guillemets)"},target_enemy_near:{name:"Cibler l'ennemi le plus proche",description:"Cibler l'ennemi le plus proche en vue"},target_enemy_near_forarc:{name:"Cibler l'ennemi le plus proche (Arc Avant)",description:"Cibler l'ennemi le plus proche dans un c√¥ne avant"},target_enemy_near_aftarc:{name:"Cibler l'ennemi le plus proche (Arc Arri√®re)",description:"Cibler l'ennemi le plus proche dans un c√¥ne arri√®re"},target_enemy_near_sidearc:{name:"Cibler l'ennemi le plus proche (Arc Lat√©ral)",description:"Cibler l'ennemi le plus proche dans les arcs lat√©raux (b√¢bord et tribord)"},target_friend_near:{name:"Cibler l'alli√© le plus proche",description:"Cibler l'entit√© amie la plus proche"},target_self:{name:"Se cibler soi-m√™me",description:"Cibler votre propre vaisseau/personnage"},target_clear:{name:"Effacer la cible",description:"Supprimer le verrouillage de cible actuel"},target_teammate_1:{name:"Cibler co√©quipier 1",description:"Cibler le premier membre de l'√©quipe"},target_teammate_2:{name:"Cibler co√©quipier 2",description:"Cibler le deuxi√®me membre de l'√©quipe"},target_teammate_3:{name:"Cibler co√©quipier 3",description:"Cibler le troisi√®me membre de l'√©quipe"},target_teammate_4:{name:"Cibler co√©quipier 4",description:"Cibler le quatri√®me membre de l'√©quipe"},fire_all:{name:"Tirer toutes les armes",description:"Tirer toutes les armes"},fire_phasers:{name:"Tirer armes √† √©nergie",description:"Tirer toutes les armes √† √©nergie"},fire_torps:{name:"Tirer torpilles",description:"Tirer toutes les torpilles"},fire_mines:{name:"Tirer mines",description:"Tirer toutes les mines"},fire_phasers_torps:{name:"Tirer phasers et torpilles",description:"Tirer phasers et torpilles"},fire_projectiles:{name:"Tirer les Projectiles",description:"Tirer les torpilles et mines"},setactivecostume:{name:"D√©finir le Costume Actif",description:"D√©finit le costume actif actuel. N√©cessite deux modificateurs."},custom_tray:{name:"Ex√©cution de plateau",description:"Ex√©cuter un emplacement de plateau sp√©cifique"},tray_with_backup:{name:"Ex√©cution de plateau avec sauvegarde",description:"Ex√©cuter un emplacement de plateau sp√©cifique avec capacit√© de sauvegarde"},tray_range:{name:"Ex√©cution de plage de plateau",description:"Ex√©cuter une plage d'emplacements de plateau"},tray_range_with_backup:{name:"Plage de plateau avec sauvegarde",description:"Ex√©cuter une plage d'emplacements de plateau avec capacit√©s de sauvegarde"},whole_tray:{name:"Ex√©cution de plateau entier",description:"Ex√©cuter tous les emplacements d'un plateau"},whole_tray_with_backup:{name:"Plateau entier avec sauvegarde",description:"Ex√©cuter tous les emplacements d'un plateau avec plateau de sauvegarde"},distribute_shields:{name:"Distribuer les boucliers",description:"Distribue uniform√©ment les boucliers comme si on cliquait au milieu de l'ic√¥ne vaisseau et boucliers"},reroute_shields_rear:{name:"Rediriger boucliers arri√®re",description:"Rediriger l'√©nergie des boucliers vers l'arri√®re"},reroute_shields_left:{name:"Rediriger boucliers gauche",description:"Rediriger l'√©nergie des boucliers vers la gauche"},reroute_shields_right:{name:"Rediriger boucliers droite",description:"Rediriger l'√©nergie des boucliers vers la droite"},reroute_shields_forward:{name:"Rediriger boucliers avant",description:"Rediriger l'√©nergie des boucliers vers l'avant"},full_impulse:{name:"Impulsion maximale",description:"Engager le moteur √† impulsion maximale"},reverse:{name:"Marche arri√®re",description:"Moteurs en marche arri√®re"},throttle_adjust:{name:"Ajuster les gaz",description:"Augmenter ou diminuer les gaz d'une certaine quantit√©"},throttle_set:{name:"R√©gler les gaz",description:"R√©gler les gaz √† une position sp√©cifique (n√©gatif = marche arri√®re, 0 = arr√™t)"},throttle_toggle:{name:"Basculer les gaz",description:"Alterner entre gaz maximum et arr√™t complet"},turn_left:{name:"Tourner √† gauche",description:"Tourner le vaisseau √† gauche (continu tant que maintenu)"},turn_right:{name:"Tourner √† droite",description:"Tourner le vaisseau √† droite (continu tant que maintenu)"},pitch_up:{name:"Cabrer",description:"Cabrer le nez du vaisseau vers le haut (changement d'altitude dans l'espace)"},pitch_down:{name:"Piquer",description:"Piquer le nez du vaisseau vers le bas (changement d'altitude dans l'espace)"},strafe_left:{name:"D√©placement lat√©ral gauche",description:"D√©placer le vaisseau lat√©ralement √† gauche"},strafe_right:{name:"D√©placement lat√©ral droite",description:"D√©placer le vaisseau lat√©ralement √† droite"},forward:{name:"Avancer",description:"Avancer"},backward:{name:"Reculer",description:"Reculer"},auto_forward:{name:"Avance automatique",description:"Le personnage avance jusqu'√† ce que de nouvelles commandes de mouvement soient donn√©es"},follow:{name:"Suivre la cible",description:"Suivre l'entit√© cibl√©e"},follow_cancel:{name:"Annuler le suivi",description:"Arr√™ter de suivre et oublier la cible"},zoom_in:{name:"Zoomer",description:"Zoomer la cam√©ra"},zoom_out:{name:"D√©zoomer",description:"D√©zoomer la cam√©ra"},zoom_in_small:{name:"Zoomer l√©g√®rement",description:"Zoomer l√©g√®rement la cam√©ra"},zoom_out_small:{name:"D√©zoomer l√©g√®rement",description:"D√©zoomer l√©g√®rement la cam√©ra"},cam_distance:{name:"D√©finir distance cam√©ra",description:"D√©finir la distance de la cam√©ra par rapport au joueur"},cam_reset:{name:"R√©initialiser cam√©ra",description:"R√©initialiser la position de la cam√©ra par d√©faut"},cam_target_lock:{name:"Verrouiller cam√©ra sur cible",description:"Verrouiller ou d√©verrouiller la cam√©ra sur la cible"},cam_cycle_distance:{name:"Alterner distance cam√©ra",description:"Alterner la distance de la cam√©ra entre plusieurs valeurs pr√©d√©finies"},cam_mouse_look:{name:"Vue souris",description:"Activer le contr√¥le de cam√©ra par vue souris"},cam_turn_to_face:{name:"Tourner vers la cam√©ra",description:"Tourner le vaisseau pour faire face √† la direction de la cam√©ra"},look_up:{name:"Regarder vers le haut",description:"Changer le point de vue pour regarder droit vers le haut"},look_down:{name:"Regarder vers le bas",description:"Changer le point de vue pour regarder droit vers le bas"},team_message:{name:"Message d'√©quipe",description:"Envoyer un message √† l'√©quipe"},local_message:{name:"Message local",description:"Envoyer un message √† la zone locale"},zone_message:{name:"Message de zone",description:"Envoyer un message √† la zone"},toggle_hud:{name:"Basculer HUD",description:"Basculer la visibilit√© du HUD"},screenshot:{name:"Capture d'√©cran",description:"Prendre une capture d'√©cran"},screenshot_jpg:{name:"Capture d'√©cran JPG",description:"Sauvegarder une capture d'√©cran en JPG"},autofire_set:{name:"D√©finir tir automatique",description:"Activer et d√©sactiver le tir automatique des armes. X = 1 l'active et X = 0 le d√©sactive."},bind_save_file:{name:"Sauvegarder raccourcis vers fichier",description:"Sauvegarder tous vos raccourcis dans un fichier texte"},bind_load_file:{name:"Charger raccourcis depuis fichier",description:"Charger un fichier de raccourcis dans le client"},combat_log:{name:"Basculer journal de combat",description:"Activer/d√©sactiver l'enregistrement du journal de combat (1=activ√©, 0=d√©sactiv√©)"},missions:{name:"Afficher/Masquer missions",description:"Afficher/masquer le journal des missions"},inventory:{name:"Afficher/Masquer inventaire",description:"Afficher/masquer votre inventaire"},map:{name:"Afficher/Masquer carte",description:"Afficher/masquer la fen√™tre de carte"},logout:{name:"Se d√©connecter",description:"Se d√©connecter du personnage actuel."},quit:{name:"Quitter le jeu",description:"Fermer la fen√™tre."},ui_load:{name:"Charger les param√®tres UI",description:"Charge le fichier de sauvegarde par d√©faut des fen√™tres UI, g√©n√©ralement Live\\ui_settings.txt"},ui_save:{name:"Sauvegarder les param√®tres UI",description:"Sauvegarde la mise en page UI dans le fichier de sauvegarde par d√©faut des fen√™tres UI, g√©n√©ralement Live\\ui_settings.txt"},ui_load_file:{name:"Charger le fichier de param√®tres UI",description:"Charge le fichier de sauvegarde des fen√™tres UI nomm√©"},ui_save_file:{name:"Sauvegarder le fichier de param√®tres UI",description:"Sauvegarde la mise en page UI dans le fichier de sauvegarde des fen√™tres UI nomm√©"},ui_cancel:{name:"UI Annuler",description:'R√©pond "Annuler" √† une bo√Æte de dialogue ouverte; peut ne pas fonctionner dans tous les dialogues.'},ui_ok:{name:"UI OK",description:'R√©pond "OK" √† une bo√Æte de dialogue ouverte; peut ne pas fonctionner dans tous les dialogues.'},chat_log:{name:"Basculer le journal de chat",description:"Activer/d√©sactiver le journal de chat. 1=activ√©, 0=d√©sactiv√©, pas de param√®tre=afficher le statut. Pr√©fixer ++ le transforme en bascule"},remember_ui_lists:{name:"M√©moriser les listes UI",description:"S'il faut m√©moriser le placement et la largeur des colonnes des listes UI."},ui_remember_positions:{name:"M√©moriser les positions UI",description:"S'il faut m√©moriser les tailles et positions UI. Activ√© par d√©faut."},safe_login:{name:"Connexion s√©curis√©e",description:"Si vrai, alors connecte le joueur √† sa carte statique la plus r√©cente au lieu de n'importe quoi d'autre."},goto_character_select:{name:"Aller √† la s√©lection de personnage",description:"Aller √† l'√©cran de s√©lection de personnage sans se d√©connecter."},ui_gen_layers_reset:{name:"R√©initialiser la mise en page UI",description:"R√©initialise la mise en page, utilis√© quand le serveur met √† jour les positions des fen√™tres mobiles"},ui_resolution:{name:"Afficher la r√©solution UI",description:"Affiche la r√©solution d'√©cran UI actuelle."},ui_tooltip_delay:{name:"D√©finir le d√©lai d'infobulle",description:"D√©finit le d√©lai suppl√©mentaire, en secondes, avant que les infobulles apparaissent"},show_game_ui:{name:"Afficher l'UI du jeu",description:"Afficher l'UI du jeu"},show_game_ui_no_extra_keybinds:{name:"Afficher l'UI du jeu (sans raccourcis suppl√©mentaires)",description:"Cette commande n'ajoute aucun raccourci pour afficher l'UI quand l'utilisateur appuie sur √©chap"},change_instance:{name:"Changer d'instance",description:"Changer vers une instance d√©j√† cr√©√©e de la m√™me carte. Ne fonctionne que quand pas en alerte rouge."},aim:{name:"Viser/Lunette",description:"Activer/d√©sactiver la lunette. En mode lunette le joueur fait plus de d√©g√¢ts. Peut √™tre utilis√© comme bascule ou appuyer et maintenir"},holster:{name:"Ranger l'arme",description:"Tenter de ranger votre arme active"},holster_toggle:{name:"Basculer ranger l'arme",description:"Tenter de ranger ou d√©gainer vos armes"},unholster:{name:"D√©gainer l'arme",description:"Tenter de d√©gainer votre arme active"},toggle_shooter_mode:{name:"Basculer le mode tireur",description:"Activer/d√©sactiver le mode tireur"},shooter_primary:{name:"Tireur primaire",description:"Action primaire du mode tireur"},shooter_secondary:{name:"Tireur secondaire",description:"Action secondaire du mode tireur"},shooter_tertiary:{name:"Tireur tertiaire",description:"Action tertiaire du mode tireur"},shooter_clear_offset_tray_binds:{name:"Effacer les liaisons de plateau de d√©calage du tireur",description:"Effacer l'emplacement de d√©part et le mouvement de la bo√Æte d'action jaune qui appara√Æt sur le plateau en mode tireur"},shooter_clear_overlay_tray_binds:{name:"Effacer les liaisons de plateau superpos√© du tireur",description:"Effacer les liaisons de plateau superpos√© pour le mode tireur"},shooter_set_offset_tray_binds:{name:"D√©finir les liaisons de plateau de d√©calage du tireur",description:"D√©finir l'emplacement de d√©part et le mouvement de la bo√Æte d'action jaune qui appara√Æt sur le plateau en mode tireur"},shooter_set_overlay_tray_binds:{name:"D√©finir les liaisons de plateau superpos√© du tireur",description:"D√©finir les liaisons de plateau superpos√© pour le mode tireur"},setrallypoint:{name:"D√©finir Point de Ralliement",description:"D√©finit un point de ralliement pour votre cible actuelle"},setrallypointconsole:{name:"D√©finir Point de Ralliement (Console)",description:"D√©finit un point de ralliement pour votre cible actuelle (variante console)"},clearrallypoint:{name:"Effacer Point de Ralliement",description:"Efface le point de ralliement pour votre cible actuelle"},clearallrallypoints:{name:"Effacer Tous les Points de Ralliement",description:"Efface tous les points de ralliement"},assist:{name:"Assister",description:"Assister '<name>': Assiste l'entit√© portant le nom correspondant. Si aucun nom n'est donn√©, assiste votre cible actuelle."},net_timing_graph:{name:"Graphique de Timing R√©seau",description:"Activer ou d√©sactiver le graphique de timing r√©seau (0=d√©sactiver, 1=activer)"},net_timing_graph_alpha:{name:"Alpha du Graphique de Timing R√©seau",description:"D√©finir le niveau de transparence pour le graphique de timing r√©seau (50=transparence maximale, 255=aucune transparence)"},net_timing_graph_paused:{name:"Graphique de Timing R√©seau en Pause",description:"Mettre en pause ou reprendre le graphique de timing r√©seau (0=pause d√©sactiv√©e, 1=pause activ√©e)"},netgraph:{name:"Graphique R√©seau",description:"Afficher les donn√©es r√©seau SND et RCV sous forme de texte (1=activ√©, 0=d√©sactiv√©)"},parameter_placeholders:{any_sto_command:"Entrez n'importe quelle commande STO (ex: Target_Enemy_Near)",entity_name:"Entrez le nom de l'entit√©",first_modifier:"Premier modificateur",second_modifier:"Deuxi√®me modificateur",entity_name_optional:"Nom de l'entit√© (optionnel)"}},category_descriptions:{targeting:"S√©lection et gestion des cibles",combat:"Tir d'armes et actions de combat",tray:"Ex√©cuter des capacit√©s depuis les plateaux d'action",power:"Gestion de l'√©nergie et distribution des boucliers",movement:"Mouvement et navigation du vaisseau",camera:"Contr√¥le de cam√©ra et gestion de vue",communication:"Chat et communication d'√©quipe",system:"Commandes UI et syst√®me",custom:"Commandes personnalis√©es"},no_aliases_defined:"Aucun alias d√©fini",create_alias_to_get_started:"Cr√©ez un alias pour commencer",alias_deleted:'Alias "{{aliasName}}" supprim√©',please_select_a_key_first:"Veuillez d'abord s√©lectionner une touche",no_active_profile:"Aucun profil actif",alias_not_found:'Alias "{{name}}" introuvable',alias_created:"Alias cr√©√© avec succ√®s",import_failed:"√âchec de l'importation : {{error}}",storage_not_available:"Stockage non disponible",no_aliases_found_in_file:"Aucun alias trouv√© dans le fichier",import_completed_keybinds:"Importation termin√©e : {{count}} raccourcis",import_completed_aliases:"Importation termin√©e : {{count}} alias",kbf_import_completed:"Importation KBF termin√©e : {{bindsets}} bindset(s), {{keys}} touche(s), {{aliases}} alias(es)",kbf_import_skipped_activities:"{{count}} activit√©s ignor√©es",kbf_import_errors_encountered:"{{count}} erreurs rencontr√©es",kbf_import_warnings_generated:"{{count}} avertissements g√©n√©r√©s",kbf_import_processing_time:"Trait√© en {{seconds}}s",kbf_import_error_summary:"R√©sum√©",kbf_import_bindsets_processed:"{{count}} bindsets trait√©s",kbf_import_bindsets_failed:"{{count}} bindsets √©chou√©s",kbf_import_total_errors:"{{count}} erreurs totales",kbf_import_total_warnings:"{{count}} avertissements totaux",project_imported_successfully:"Projet import√© avec succ√®s : {{profileCount}} profils",sync_folder_set:"Dossier de synchronisation s√©lectionn√©",failed_to_set_sync_folder:"√âchec de la s√©lection du dossier de synchronisation : {{error}}",sync_not_supported_firefox:"La fonctionnalit√© de dossier de synchronisation n√©cessite un navigateur bas√© sur Chromium (Chrome, Edge, etc.). Firefox ne prend pas en charge l'API File System Access requise.",sync_not_supported_title:"Synchronisation non prise en charge",sync_not_supported_detailed:"La fonctionnalit√© de synchronisation n'est pas disponible dans Firefox en raison des limitations du navigateur. L'API File System Access requise pour la synchronisation des dossiers n'est prise en charge que dans les navigateurs bas√©s sur Chromium. Vous pouvez toujours sauvegarder et restaurer manuellement l'√©tat de votre application ou utiliser l'Explorateur de Fichiers pour copier vos fichiers de keybind et d'alias.",sync_not_supported_secure_context:"Le service de synchronisation n'est pas disponible lorsqu'il est servi sur HTTP. Veuillez utiliser HTTPS ou acc√©der via le protocole file:// pour activer la fonctionnalit√© de synchronisation.",sync_not_supported_secure_context_title:"Contexte s√©curis√© requis",sync_not_supported_secure_context_detailed:"La fonctionnalit√© de synchronisation n√©cessite une connexion s√©curis√©e (HTTPS) ou un acc√®s aux fichiers locaux (file://) pour fonctionner. L'API File System Access n√©cessaire pour la synchronisation des dossiers n'est disponible que dans des contextes s√©curis√©s pour prot√©ger vos donn√©es. Veuillez acc√©der √† cette application via HTTPS ou ouvrez-la en tant que fichier local.",sync_not_supported_browser:"Votre navigateur ne prend pas en charge l'API File System Access requise pour la fonctionnalit√© de synchronisation.",sync_not_supported_browser_title:"Navigateur non pris en charge",sync_not_supported_browser_detailed:"Votre navigateur ne prend pas en charge l'API File System Access requise pour la synchronisation des dossiers. Veuillez essayer d'utiliser un navigateur bas√© sur Chromium (Chrome, Edge, etc.) avec une connexion s√©curis√©e (HTTPS) ou un acc√®s aux fichiers locaux.",no_sync_folder_selected:"Aucun dossier de synchronisation s√©lectionn√©",project_synced_successfully:"Projet synchronis√© avec succ√®s",sync_folder_contains_project_title:"Donn√©es de Synchronisation Existantes Trouv√©es",sync_folder_contains_project_prompt:"Ce dossier contient d√©j√† un project.json d'une synchronisation pr√©c√©dente. L'importer maintenant au lieu d'√©craser ?",project_imported_from_sync_folder:"√âtat de l'application import√© depuis le dossier de synchronisation",sync_overwrite_existing_title:"√âcraser les Donn√©es de Synchronisation ?",sync_overwrite_existing_prompt:"Importation refus√©e. √âcraser le dossier de synchronisation avec l'√©tat actuel de l'application ?",sync_operation_cancelled:"Synchronisation annul√©e",failed_to_import_project:"√âchec de l'importation du projet : {{error}}",permission_denied_to_folder:"Permission refus√©e pour √©crire dans le dossier",failed_to_sync_project:"√âchec de la synchronisation du projet : {{error}}",synchronization:"Synchronisation",advanced:"Avanc√©",synchronization_settings:"Param√®tres de synchronisation",advanced_settings:"Param√®tres avanc√©s",sync_folder_description:"Choisissez un dossier pour synchroniser automatiquement vos projets",auto_sync:"Synchronisation automatique",auto_sync_description:"Synchroniser automatiquement les modifications avec le dossier s√©lectionn√©",auto_sync_interval:"Intervalle de synchronisation automatique",auto_sync_interval_description:"√Ä quelle fr√©quence synchroniser automatiquement vos modifications",after_every_change:"Apr√®s chaque modification",every_1_minute:"Chaque minute",every_2_minutes:"Toutes les 2 minutes",every_5_minutes:"Toutes les 5 minutes",preferences_saved:"Pr√©f√©rences sauvegard√©es avec succ√®s",vfx_manager_description:"S√©lectionnez les effets visuels √† d√©sactiver en utilisant les alias dynFxSetFXExlusionList. Les effets sont organis√©s par environnement.",app_description:"Un outil web complet pour cr√©er, √©diter et g√©rer les configurations de raccourcis de Star Trek Online avec √©dition visuelle et fonctionnalit√©s avanc√©es.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"S√©lectionnez une construction Espace/Sol ou des Alias pour pr√©visualiser l'exportation.",alias_mode:"Mode alias",create:"Cr√©er",filter_aliases:"Filtrer les alias",select_an_alias_to_edit:"S√©lectionnez un alias √† modifier",select_an_alias_to_see_the_generated_command:"S√©lectionnez un alias pour voir la commande g√©n√©r√©e",no_alias_selected:"Aucun alias s√©lectionn√©",select_alias_from_left_panel:"S√©lectionnez un alias dans le panneau de gauche pour afficher et modifier sa cha√Æne de commandes.",select_key_from_left_panel:"S√©lectionnez une touche dans le panneau de gauche pour afficher et modifier sa cha√Æne de commandes.",failed_to_load_application:"Impossible de charger l'application",profile_created:'Profil "{{name}}" cr√©√©',failed_to_create_profile:"Impossible de cr√©er le profil",failed_to_clone_profile:"Impossible de cloner le profil",cannot_delete_the_last_profile:"Impossible de supprimer le dernier profil",profile_deleted:'Profil "{{profileName}}" supprim√©',failed_to_delete_profile:"Impossible de supprimer le profil",invalid_key_name:"Nom de touche invalide",key_added:'Touche "{{keyName}}" ajout√©e',key_already_exists:'La touche "{{keyName}}" existe d√©j√†',key_deleted:'Touche "{{keyName}}" supprim√©e',key_duplicated:'Touche "{{from}}" dupliqu√©e en "{{to}}"',failed_to_delete_key:"√âchec de la suppression de la touche",key_not_found:'Touche "{{keyName}}" introuvable',failed_to_duplicate_key:"√âchec de la duplication de la touche",alias_duplicated:'Alias "{{from}}" dupliqu√© en "{{to}}"',failed_to_add_alias:"√âchec de la cr√©ation de l'alias",failed_to_delete_alias:"√âchec de la suppression de l'alias",failed_to_duplicate_alias:"√âchec de la duplication de l'alias",alias_already_exists:'L\'alias "{{name}}" existe d√©j√†',invalid_alias_name:"Nom d'alias invalide",invalid_project_file:"Fichier de projet invalide",no_commands_to_duplicate:"Aucune commande √† dupliquer",command_chain_is_valid:"Cha√Æne de commandes valide",no_profile_selected:"Aucun profil s√©lectionn√©",language_updated:"Langue mise √† jour",nothing_to_copy:"Rien √† copier",content_copied_to_clipboard:"Contenu copi√© dans le presse-papiers",failed_to_generate_export:"Impossible de g√©n√©rer l'export",no_profile_selected_to_clone:"Aucun profil s√©lectionn√© pour cloner",no_profile_selected_to_rename:"Aucun profil s√©lectionn√© pour renommer",profile_name_is_required:"Le nom du profil est requis",failed_to_save_profile:"Impossible de sauvegarder le profil : {{error}}",no_profile_selected_to_delete:"Aucun profil s√©lectionn√© pour supprimer",no_keybinds_to_export:"Aucun raccourci √† exporter",no_aliases_to_export:"Aucun alias √† exporter",application_reset_successfully:"Application r√©initialis√©e avec succ√®s",confirm_clear:"Confirmer l'effacement",confirm_clear_commands:'√ätes-vous s√ªr de vouloir effacer toutes les commandes pour "{{keyName}}" ?',confirm_delete_alias:'√ätes-vous s√ªr de vouloir supprimer l\'alias "{{aliasName}}" ?',confirm_delete_key:'√ätes-vous s√ªr de vouloir supprimer la touche "{{keyName}}" et toutes ses commandes ?',confirm_delete_profile:'√ätes-vous s√ªr de vouloir supprimer le profil "{{profileName}}" ?\n\nCette action ne peut pas √™tre annul√©e.',failed_to_copy_to_clipboard:"√âchec de la copie dans le presse-papiers",no_effects_selected:"Aucun effet s√©lectionn√©. Veuillez s√©lectionner au moins un effet pour g√©n√©rer des alias.",profile_created_from:'Profil "{{newName}}" cr√©√© √† partir de "{{sourceProfile}}"',profile_renamed:'Profil renomm√© de "{{oldName}}" √† "{{name}}"',sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager charg√© avec succ√®s",switched_to_profile:"Pass√© au profil : {{name}} ({{environment}})",yes:"Oui",no:"Non",ok:"OK",no_commands:"Aucune commande",profile_not_found:"Profil introuvable",click_add_command_to_start_building_your_command_chain:"S√©lectionnez des √©l√©ments dans la Biblioth√®que de commandes pour commencer √† construire votre cha√Æne de commandes de touches pour",click_add_command_to_start_building_your_alias_chain:"S√©lectionnez des √©l√©ments dans la Biblioth√®que de commandes pour commencer √† construire votre cha√Æne de commandes d'alias pour",create_alias:"Cr√©er un Alias",key:"touche",no_profile:"Aucun profil",stotrayexecbytray_description:"STOTrayExecByTray (affiche la liaison de touche dans l'UI)",trayexecbytray_description:"TrayExecByTray (aucune indication d'UI)",parameter_configuration:"Configuration des param√®tres",vfx_aliases:"Alias VFX",bindset_enable:"Activer",vfx_alias_space:"Alias VFX: Espace",vfx_alias_ground:"Alias VFX: Sol",vfx_alias_combined:"Alias VFX: Espace/Sol combin√©",vfx_suppression_loaded:"Suppression VFX Charg√©e",vfx_suppression_for_environment:"Suppression VFX pour l'environnement {{environment}}",vfx_suppression_for_all_environments:"Suppression VFX pour tous les environnements",delete_selected_key:"Supprimer la touche s√©lectionn√©e",duplicate_selected_key:"Dupliquer la touche s√©lectionn√©e",show_all_keys:"Afficher toutes les touches",duplicate:"Dupliquer",reserved_command_name:"Le nom entre en conflit avec une commande STO",backup_created_successfully:"Sauvegarde de l'application cr√©√©e avec succ√®s",failed_to_create_backup:"√âchec de la cr√©ation de la sauvegarde : {{error}}",backup_restored_successfully:"√âtat de l'application restaur√© avec succ√®s",import_from_key_or_alias:"Importer depuis Touche ou Alias",select_source_to_import_from:"S√©lectionner la source √† importer :",clear_destination_chain_prior_to_import:"Effacer la cha√Æne de destination avant l'import",no_sources_available:"Aucune source disponible",error_loading_sources:"Erreur lors du chargement des sources",please_select_a_source:"Veuillez s√©lectionner une source",source_has_no_commands:"La source n'a aucune commande √† importer",commands_imported_successfully:"{{count}} commandes import√©es depuis {{source}}",cross_environment_import_warning:"Attention : {{dropped}} commandes sp√©cifiques √† {{sourceEnv}} ont √©t√© supprim√©es lors de l'importation vers {{targetEnv}}",no_compatible_commands_to_import:"Aucune commande compatible √† importer apr√®s filtrage",failed_to_load_profile_data:"√âchec du chargement des donn√©es de profil",already_on_profile:"D√©j√† sur ce profil",source_profile_not_found:"Profil source non trouv√©",profile_name_required:"Nom de profil requis",switch_to_key_type_view:"Basculer vers la vue par type de touche",switch_to_grid_view:"Basculer vers la vue grille",switch_to_command_categories:"Basculer vers les cat√©gories de commandes",no_profiles_available:"Aucun profil disponible",verb:{say:"Dire (Local)",team:"√âquipe",zone:"Zone",tell:"Chuchoter"},duplicate_alias:"Dupliquer l'Alias",enter_new_alias_name:"Entrer un nouveau nom d'alias",alias_name_in_use:"Le nom d'alias existe d√©j√†",failed_to_rename_profile:"√âchec du renommage du profil : {{error}}",ground_build:"Construction Sol",import_failed_invalid_json:"Importation √©chou√©e : Format JSON invalide",import_failed_unsupported_format:"Importation √©chou√©e : Format de fichier non pris en charge",no_content_available:"Aucun contenu disponible",no_valid_profile:"Aucun profil valide disponible",profile_already_exists:"Le profil existe d√©j√†",profile_id_required:"ID de profil requis",space_build:"Construction Espace",syncing:"Synchronisation en cours...",command_parameters:{active:{label:"Actif",help:"0: D√©sactiv√©, 1: Activ√©"},tray:{label:"Plateau",help:"Num√©ro de plateau (0-9). 0=Plateau de jeu 1"},slot:{label:"Emplacement",help:"Num√©ro d'emplacement (0-9). 0=Emplacement de jeu 1"},start_tray:{label:"Plateau de D√©but",help:"Num√©ro de plateau de d√©but (0-9). 0=Plateau de jeu 1"},end_tray:{label:"Plateau de Fin",help:"Num√©ro de plateau de fin (0-9). 0=Plateau de jeu 1"},start_slot:{label:"Emplacement de D√©but",help:"Num√©ro d'emplacement de d√©but (0-9). 0=Emplacement de jeu 1"},end_slot:{label:"Emplacement de Fin",help:"Num√©ro d'emplacement de fin (0-9). 0=Emplacement de jeu 1"},backup_tray:{label:"Plateau de Sauvegarde",help:"Num√©ro de plateau de sauvegarde (0-9). 0=Plateau de jeu 1"},backup_slot:{label:"Emplacement de Sauvegarde",help:"Num√©ro d'emplacement de sauvegarde (0-9). 0=Emplacement de jeu 1"},backup_start_tray:{label:"Plateau de D√©but de Sauvegarde",help:"Num√©ro de plateau de d√©but de sauvegarde (0-9). 0=Plateau de jeu 1"},backup_end_tray:{label:"Plateau de Fin de Sauvegarde",help:"Num√©ro de plateau de fin de sauvegarde (0-9). 0=Plateau de jeu 1"},backup_start_slot:{label:"Emplacement de D√©but de Sauvegarde",help:"Num√©ro d'emplacement de d√©but de sauvegarde (0-9). 0=Emplacement de jeu 1"},backup_end_slot:{label:"Emplacement de Fin de Sauvegarde",help:"Num√©ro d'emplacement de fin de sauvegarde (0-9). 0=Emplacement de jeu 1"},command_type:{label:"Type de Commande",help:"Type d'ex√©cution de commande (STOTrayExecByTray affiche l'UI, TrayExecByTray non)"},entityName:{label:"Nom d'Entit√©",help:"Nom de l'entit√© √† cibler"},message:{label:"Message",help:"Texte du message √† envoyer"},distance:{label:"Distance",help:"Valeur de distance de cam√©ra"},amount:{label:"Quantit√©",help:"Quantit√© d'ajustement des gaz"},position:{label:"Position",help:"Position des gaz (0-100)"},filename:{label:"Nom de Fichier",help:"Nom de fichier (sans extension)"},state:{label:"√âtat",help:"1 pour activer, 0 pour d√©sactiver"},verb:{label:"Canal",help:"Canal de communication (dire, √©quipe, zone)"},alias_name:{label:"Nom d'Alias",help:"Nom de l'alias √† ex√©cuter"},rawCommand:{label:"Commande",help:"Texte de commande STO brut"},seconds:{label:"Secondes",help:"D√©lai en secondes"},alpha:{label:"Alpha",help:"Valeur de transparence (0-255)"},modifier1:{label:"Modificateur 1",help:"Premi√®re combinaison de touches modificatrices"},modifier2:{label:"Modificateur 2",help:"Seconde combinaison de touches modificatrices"},name:{label:"Nom",help:"Nom de la cible ou de l'objet"},degrees:{label:"Degr√©s",help:"Taille du c√¥ne de l'arc en degr√©s"}},add_new_alias:"Ajouter un Nouvel Alias",delete_selected_alias:"Supprimer l'Alias S√©lectionn√©",duplicate_selected_alias:"Dupliquer l'Alias S√©lectionn√©",search_aliases:"Rechercher des alias...",clear_filter:"Effacer le filtre",warning:"Avertissement",error:"Erreur",validation_details:"D√©tails de la validation",command_chain_near_limit:"La cha√Æne de commandes devient longue ({{length}} caract√®res). D√©passer 999 peut √©chouer.",command_chain_too_long:"La cha√Æne de commandes est trop longue ({{length}} caract√®res) et peut √©chouer dans le jeu.",sto_tray_exec_optimization_suggestion:"La cha√Æne de commandes fait {{currentLength}} caract√®res. Remplacer {{count}} occurrence(s) de STOTrayExecByTray par TrayExecByTray permettrait d'√©conomiser {{potentialSavings}} caract√®res (nouvelle longueur : {{newLength}}).",stabilized_non_tray_warning:"L'ex√©cution stabilis√©e ne doit √™tre utilis√©e qu'avec des capacit√©s d'ex√©cution de barre.",too_many_commands_on_key:"Associer {{count}} commandes √† une seule touche peut √©chouer en jeu (maximum recommand√© 20).",alias_mixed_environment_warning:"L'alias contient des commandes exclusives espace et sol ; ceci n'est pas recommand√©.",spam_bar_warning:"Non recommand√© sur les barres de spam car cela perturbe les cycles de tir",press_any_key_combination:"Appuyez sur n'importe quelle combinaison de touches...",capture_instructions:"Utilisez votre clavier ou votre souris, ou passez en mode manuel pour cliquer sur les touches ci-dessous",switch_to_manual:"Basculer en manuel",start_capture:"D√©marrer la capture",selected_key:"Touche s√©lectionn√©e",confirm_selection:"Confirmer la s√©lection",key_selection_failed:"√âchec de la s√©lection de la touche",error_generating_command:"Erreur lors de la g√©n√©ration de la commande",please_enter_a_raw_command:"Veuillez saisir une commande",unsafe_keybind:"Combinaison de touches dangereuse : {{key}} n'est pas autoris√©e",generated_alias:"Alias g√©n√©r√© :",bind_to_alias_mode:"Cr√©er des cha√Ænes de commandes comme alias",bind_to_alias_mode_description:"Lorsqu'elle est activ√©e, les cha√Ænes de commandes sont g√©n√©r√©es sous forme d'alias nomm√©s selon l'environnement et la touche (par ex. \"space_q\"), et les touches sont li√©es pour appeler ces alias.",bindsets_enabled:"Activer les ensembles de liens",bindsets_enabled_description:"Permet la cr√©ation et le chargement d'ensembles de liens (n√©cessite 'Cr√©er des cha√Ænes de keybinds en tant qu'alias').",bindsets:"Ensembles de liens",bindset_manager:"Gestionnaire d'ensembles de liens",create_bindset:"Cr√©er un ensemble de liens",enter_bindset_name:"Entrez le nom de l'ensemble de liens :",bindset_name:"Nom de l'ensemble de liens",bindset_name_in_use:"Le nom de l'ensemble de liens est d√©j√† utilis√©",bindset_not_empty:"L'ensemble de liens contient des keybinds et ne peut pas √™tre supprim√©",invalid_name:"Nom invalide",add_key_to_bindset:"Ajouter la touche √† l'ensemble de liens",add_key_to_bindset_confirm:'Ajouter la touche "{{key}}" √† l\'ensemble de liens "{{bindset}}" ?',manage_bindsets:"G√©rer les Ensembles de Liens",primary_bindset:"Ensemble de Liens Principal",remove_key_from_bindset:"Retirer la touche de l'ensemble de liens",remove_key_from_bindset_confirm:'Retirer la touche "{{key}}" de l\'ensemble de liens "{{bindset}}" ?',select_bindset:"S√©lectionner un Ensemble de Liens",confirm_delete:"√ätes-vous s√ªr de vouloir supprimer ?",enter_new_name:"Entrer le nouveau nom :",translate_generated_messages:"Traduire les messages g√©n√©r√©s",translate_generated_messages_description:"Lorsqu'elle est activ√©e, les messages g√©n√©r√©s automatiquement (comme les notifications de suppression VFX) seront traduits dans la langue s√©lectionn√©e. Lorsqu'elle est d√©sactiv√©e, ils restent en anglais.",distinguish_left_right_modifiers:"Distinguer les modificateurs gauche/droite",confirm_reset_application:"√ätes-vous s√ªr de vouloir r√©initialiser l'application ?\n\nCela supprimera tous les profils, raccourcis et param√®tres. Cette action ne peut pas √™tre annul√©e.",environment:"Environnement",export_alias_definitions_note:"(Les d√©finitions d'alias sont dans le fichier d'alias)",export_generated_aliases_count:"du mode alias vers touches ({{count}} alias g√©n√©r√©s)",export_generated_aliases_note:"Lignes de raccourcis qui appellent des alias g√©n√©r√©s",export_user_and_generated_aliases:"Ce fichier contient √† la fois des alias cr√©√©s par l'utilisateur et des alias g√©n√©r√©s",please_select_an_alias_first:"Veuillez d'abord s√©lectionner un alias",confirm_reset_app:"Confirmer la R√©initialisation de l'Application",configure_colon:"Configurer :",edit_colon:"√âditer :",default_profile_exists_message:'Un profil nomm√© "Default" existe d√©j√†. Le chargement des donn√©es par d√©faut l\'√©craserait. Voulez-vous continuer ?',default_profile_exists_title:"Profil par D√©faut Existe",ground_alias:"Alias Sol",space_alias:"Alias Espace",backup_restore_failed:"√âchec de la restauration de la sauvegarde : {{error}}",confirm_add:"Confirmer l'ajout",confirm_delete_bindset:'Supprimer l\'ensemble de liens "{{name}}" ?',confirm_remove:"Confirmer la suppression",error_add_failed:"√âchec de l'ajout de la touche √† l'ensemble de liens",error_remove_failed:"√âchec de la suppression de la touche de l'ensemble de liens",name_exists:"Le nom existe d√©j√†",name_required:"Nom requis",name_unchanged:"Le nom n'a pas chang√©",not_found:"Non trouv√©",rename_bindset:"Renommer l'ensemble de liens",bindset_actions:"Actions de l'ensemble de liens",source_profile_and_new_name_required:"Le profil source et le nouveau nom sont requis",unknown_command:"Commande inconnue",command_group_hint_fixed_order:"Toujours ex√©cut√© en premier",command_group_hint_palindromic:"Affecte la structure du palindrome",command_group_hint_pivot:"Forme le centre du palindrome",command_group_non_trayexec:"Avant le Palindrome",command_group_palindromic:"TrayExec Palindromique",command_group_pivot:"Groupe Pivot",palindromic_excluded_tooltip:"Exclu du palindrome (cliquer pour inclure)",palindromic_included_tooltip:"Inclus dans le palindrome (cliquer pour exclure)",placement_before_palindromes_tooltip:"Avant les palindromes (cliquer pour d√©placer vers le groupe pivot)",placement_in_pivot_group_tooltip:"Dans le groupe pivot (cliquer pour d√©placer avant les palindromes)",toggle_collapse:"Basculer le repliement",primary_bindset_copy_default:"Copie du Bindset Primaire",copy_suffix:"Copie",no_keys_in_bindset:"Aucune touche dans ce bindset",switch_to_categorized_view:"Basculer vers la vue cat√©goris√©e",clone_bindset:"Cloner le Bindset",delete_bindset:"Supprimer le Bindset",bindset_delete_warning:'Ce bindset "{{name}}" contient {{count}} touches et sera supprim√© d√©finitivement.',bindset_delete_consequences:"Toutes les affectations de touches dans ce bindset seront perdues d√©finitivement et ne pourront pas √™tre r√©cup√©r√©es.",bindset_delete_confirmation_text:"Je comprends que cela supprimera d√©finitivement toutes les touches dans ce bindset",bindset_delete_type_confirm:"Tapez DELETE pour confirmer",confirm_delete_bindset_with_keys:"Supprimer le Bindset avec Touches",bindset_deleted:'Bindset "{{name}}" supprim√© avec succ√®s',configure_kbf_import:"Configurer l'Importation KBF",configure_kbf_import_question:"Configurer comment les bindsets s√©lectionn√©s seront import√©s :",import_configured:"Importation Configur√©e",custom_name:"Nom personnalis√©",primary_mapping_options:"Options de Mappage Primaire",map_master_to_primary:"Mapper le bindset ma√Ætre vers primaire",create_new_primary:"Cr√©er un nouveau bindset primaire",primary_name_placeholder:"Entrez le nom du bindset primaire",skip_primary_mapping:"Ignorer le mappage primaire (garder comme bindsets nomm√©s)",import_preview:"Aper√ßu de l'Importation",select_bindsets_for_preview:"S√©lectionnez les bindsets ci-dessus pour pr√©visualiser leur contenu",mapped_to_primary:"Mapp√© vers Primaire",mapped_to_new_primary:"Mapp√© vers nouveau primaire : {{name}}",mapped_to_named:"Mapp√© vers bindset nomm√©",maps_to_primary_bindset:"Mappe au Bindset Primaire",not_mapped:"Non Import√©",maps_to:"Mappe √†",original_bindset_name:"Bindset d'origine",mapping_type:"Type de mappage",mapping_destination:"Destination de mappage",auto_resolve_conflict:"R√©solu automatiquement comme {{name}}",bindset_name_conflict:"Conflit de nom d√©tect√©",custom_name_placeholder:"Entrez un nom personnalis√©...",key_count:"Nombre de touches",select_bindset_import_question:"Choisissez quel bindset importer dans le bindset primaire:",select_bindset_to_import:"S√©lectionner un Bindset √† Importer",single_bindset_import_note:"Puisque les bindsets sont d√©sactiv√©s, ce bindset sera import√© dans le bindset primaire.",reduced_bindset_functionality:"Mode d'Importation de Bindset Unique",reduced_bindset_functionality_description:"Avec les bindsets d√©sactiv√©s, vous pouvez importer un seul bindset qui sera mapp√© √† votre bindset primaire. Cela offre une exp√©rience d'importation optimis√©e.",enable_full_bindset_functionality:"Pour des options avanc√©es d'importation de multiples bindsets, activez les bindsets dans les param√®tres.",import_strategy:"Strat√©gie d'importation",merge_keep_existing:"Fusionner (conserver existants)",merge_overwrite_existing:"Fusionner (√©craser existants)",overwrite_all:"Tout √©craser",overwrite_all_description_keybinds:"Supprime toutes les touches existantes dans cet environnement et les remplace par celles import√©es.",overwrite_all_description_kbf:"Supprime les touches existantes des bindsets s√©lectionn√©s et les remplace par les donn√©es KBF import√©es.",overwrite_all_description_kbf_primary:"Supprime toutes les touches existantes dans l'environnement primaire et les remplace par les donn√©es KBF import√©es.",overwrite_all_description_kbf_bindsets:"Supprime les touches existantes des bindsets s√©lectionn√©s et les remplace par les donn√©es KBF import√©es.",overwrite_all_description_aliases:"Supprime tous les alias existants et les remplace par ceux import√©s.",overwrite_confirm_title:"Confirmer l'√©crasement",overwrite_confirm_body_keys:"Cela supprimera toutes les touches existantes dans {{environment}} et les remplacera par le fichier d'importation.",overwrite_confirm_body_aliases:"Cela supprimera tous les alias existants et les remplacera par le fichier d'importation.",overwrite_counts:"Actuel : {{current}} ¬∑ Entrant : {{incoming}}",overwrite_all_action:"Tout √©craser",import_result_skipped:"{{imported}} import√©s, {{skipped}} conflits ignor√©s.",import_result_overwrote:"{{imported}} import√©s, {{overwritten}} √©l√©ments √©cras√©s.",import_result_overwrite_all:"{{imported}} import√©s apr√®s avoir effac√© {{cleared}} √©l√©ments existants."},ne={sto_tools_keybind_manager:"STO Tools Keybind Manager",save:"Guardar",explorer:"Explorador",import_keybinds:"Importar atajos de teclado",import_environment:"Importar atajos de teclado",import_environment_question:"Elige un entorno para importar este archivo de atajos de teclado",aliases:"Alias",import_aliases:"Importar alias",import_kbf_file:"Importar archivo KBF",import_selected:"Importar selecci√≥n",invalid_kbf_file_format:"Formato de archivo KBF inv√°lido",import:"Importar",backup:"Respaldo",backup_menu:"Respaldo",backup_application_state:"Respaldar estado de la aplicaci√≥n",restore_application_state:"Restaurar estado de la aplicaci√≥n",preferences:"Preferencias",language:"Idioma",sync_folder_label:"Carpeta de sincronizaci√≥n:",no_folder_selected:"Ninguna carpeta seleccionada",download:"Descargar",vfx:"VFX",dark_mode:"Modo oscuro",light_mode:"Modo claro",load_default_data:"Cargar datos predeterminados",reset_application:"Restablecer aplicaci√≥n",set_sync_folder:"Establecer carpeta de sincronizaci√≥n",sync_now:"Sincronizar ahora",about:"Acerca de",rename:"Renombrar",delete:"Eliminar",space:"Espacio",ground:"Suelo",modified:"Modificado",valid:"V√°lido",keys:"teclas",keys_firstupper:"Teclas",copy:"Copiar",select_a_key_to_edit:"Selecciona una tecla para editar",commands:"comandos",command_singular:"comando",no_key_selected:"Ninguna tecla seleccionada",select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain:"Selecciona una tecla del panel izquierdo para ver y editar su cadena de comandos.",generated_command:"Comando generado:",generated_alias:"Alias generado:",select_a_key_to_see_the_generated_command:"Selecciona una tecla para ver el comando generado",add_command:"Agregar comando",command_library:"Biblioteca de comandos",add_new_key:"Agregar nueva tecla",ctrl:"Ctrl",alt:"Alt",shift:"May√∫s",cancel:"Cancelar",custom:"Personalizado",alias:"Alias",alias_lowercase:"alias",aliases_lowercase:"alias",profile:"Perfil",profile_name:"Nombre del perfil:",description_optional:"Descripci√≥n (opcional):",alias_name:"Nombre del alias:",select_key_dialog_title:"Seleccionar Tecla",vfx_manager:"Gestor VFX",space_effects:"Efectos de espacio",select_all:"Seleccionar Todo",clear_all:"Limpiar Todo",select_bindsets_to_import:"Seleccionar bindsets para importar",select_bindsets_to_import_question:"Este archivo KBF contiene m√∫ltiples bindsets. Elige qu√© bindsets quieres importar:",kbf_import_progress:"Importando archivo KBF",kbf_import_progress_message:"Por favor espera mientras se procesa el archivo KBF...",kbf_progress_layer:"Capa {{layer}}",kbf_progress_initializing:"Inicializando...",kbf_progress_preparing:"Preparando importaci√≥n...",kbf_progress_decode_layer1:"Decodificando formato de archivo",kbf_progress_parse_layer2:"Analizando registros de bindset",kbf_progress_parse_layer3:"Procesando datos de teclas",kbf_progress_parse_layer4:"Analizando asignaciones de teclas",kbf_progress_parse_layer5:"Traduciendo comandos",kbf_progress_decode_layer6:"Decodificando datos de texto",kbf_progress_complete:"Finalizando importaci√≥n",kbf_progress_processing:"Procesando...",kbf_progress_starting:"Iniciando {{stage}}...",kbf_progress_finished_stage:"{{stage}} finalizada",selected:"seleccionado",ground_effects:"Efectos de suelo",generated_aliases:"Alias generados:",no_space_effects_selected:"No hay efectos espaciales seleccionados",no_ground_effects_selected:"No hay efectos terrestres seleccionados",show_player_say:"Mostrar Decir del Jugador",generate_aliases:"Generar Alias",about_sto_tools_keybind_manager:"Acerca de STO Tools Keybind Manager",features:"Caracter√≠sticas:",visual_keybind_editor:"Editor visual de atajos de teclado",sto_command_library_with_search_and_categorization:"Biblioteca de comandos STO con b√∫squeda y categorizaci√≥n",multiple_profile_management_create_clone_rename_delete:"Gesti√≥n de m√∫ltiples perfiles (crear, clonar, renombrar, eliminar)",custom_alias_system_for_complex_command_sequences:"Sistema de alias personalizado para secuencias de comandos complejas",vertigo_inspired_vfx_manager_for_visual_effects_control:"Gestor VFX inspirado en VERTIGO para control de efectos visuales",import_export_keybind_and_alias_files_and_project_backups:"Importar/exportar archivos de atajos y alias, y respaldos de proyecto",real_time_validation_and_command_preview:"Validaci√≥n en tiempo real y vista previa de comandos",quick_start:"Inicio r√°pido:",create_a_new_profile_or_use_the_default_profile:"Crea un nuevo perfil o usa el perfil predeterminado",select_keys_from_the_grid_and_add_commands_from_the_library:"Selecciona teclas de la cuadr√≠cula y agrega comandos desde la biblioteca",use_the_command_chain_editor_to_build_complex_sequences:"Usa el editor de cadenas de comandos para construir secuencias complejas",export_your_keybinds_as_txt_files_for_use_in_sto:"Exporta tus atajos como archivos .txt para usar en STO",resources:"Recursos:",copyright:"¬© 2025 STO Tools. Todos los derechos reservados.",got_it:"¬°Entendido!",file_explorer:"Explorador de archivos",select_an_item_on_the_left_to_preview_export:"Selecciona un elemento a la izquierda para previsualizar exportaci√≥n",close:"Cerrar",filter_keys:"Filtrar teclas...",search_commands:"Buscar comandos...",enter_profile_name:"Ingresa nombre del perfil",describe_this_keybind_profile:"Describe este perfil de atajos de teclado",search_keys:"Buscar teclas...",settings:"Configuraci√≥n",select_profile:"Seleccionar perfil",new_profile:"Nuevo perfil",clone_profile:"Clonar perfil",rename_profile:"Renombrar perfil",delete_profile:"Eliminar perfil",space_mode:"Modo espacio",ground_mode:"Modo suelo",unsaved_changes:"Cambios no guardados",validation_status:"Estado de validaci√≥n",bound_keys:"Teclas vinculadas",toggle_between_grid_and_categorized_view:"Alternar entre vista de cuadr√≠cula y categorizada",ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left:"Asegura orden de ejecuci√≥n consistente reflejando comandos (Fase 1: izquierda a derecha, Fase 2: derecha a izquierda)",validate_command_chain:"Validar cadena de comandos",command_chain:"Cadena de comandos",alias_chain:"Cadena de alias",chain_for_key:"{{chainType}} para {{key}}",clear_all_commands:"Limpiar todos los comandos",copy_to_clipboard:"Copiar al portapapeles",generated:"Generado:",created_by:"Creado por:",statistics:"Estad√≠sticas",total_commands:"Total de comandos:",command_aliases:"Alias de comandos",vfx_aliases:"Alias VFX",bindset_enable:"Habilitar",vfx_alias_space:"Alias VFX: Espacio",vfx_alias_ground:"Alias VFX: Tierra",vfx_alias_combined:"Alias VFX: Espacio/Tierra combinado",vfx_suppression_loaded:"Supresi√≥n VFX Cargada",vfx_suppression_for_environment:"Supresi√≥n VFX para entorno {{environment}}",vfx_suppression_for_all_environments:"Supresi√≥n VFX para todos los entornos",key_type:{function_keys:"Teclas de funci√≥n",letters_numbers:"Letras y n√∫meros",numberpad:"Teclado num√©rico",modifier_keys:"Teclas modificadoras",navigation:"Navegaci√≥n",system_keys:"Teclas del sistema",mouse_wheel:"Rat√≥n y rueda",symbols_punctuation:"S√≠mbolos y puntuaci√≥n",other_keys:"Otras teclas"},command_categories:{targeting:"Apuntado",combat:"Combate",cosmetic:"Cosm√©tico",bridge_officer:"Oficial de Puente",tray:"Ejecuci√≥n de Bandeja",power:"Gesti√≥n de Escudos",movement:"Movimiento",camera:"C√°mara",communication:"Comunicaci√≥n",system:"Sistema",custom:"Personalizado"},command_definitions:{add_custom_command:{name:"Agregar Comando Personalizado",description:"Agregar cualquier comando STO como texto sin formato"},target:{name:"Apuntar por nombre",description:"Apuntar entidad por nombre (requiere comillas)"},target_enemy_near:{name:"Apuntar enemigo m√°s cercano",description:"Apuntar al enemigo m√°s cercano visible"},target_enemy_near_forarc:{name:"Apuntar enemigo m√°s cercano (Arco Proa)",description:"Apuntar al enemigo m√°s cercano dentro de un cono frontal"},target_enemy_near_aftarc:{name:"Apuntar enemigo m√°s cercano (Arco Popa)",description:"Apuntar al enemigo m√°s cercano dentro de un cono trasero"},target_enemy_near_sidearc:{name:"Apuntar enemigo m√°s cercano (Arco Lateral)",description:"Apuntar al enemigo m√°s cercano dentro de arcos laterales (babor y estribor)"},target_friend_near:{name:"Apuntar aliado m√°s cercano",description:"Apuntar a la entidad aliada m√°s cercana"},target_self:{name:"Apuntarse a s√≠ mismo",description:"Apuntar a tu propia nave/personaje"},target_clear:{name:"Limpiar objetivo",description:"Eliminar el bloqueo de objetivo actual"},target_teammate_1:{name:"Apuntar compa√±ero 1",description:"Apuntar al primer miembro del equipo"},target_teammate_2:{name:"Apuntar compa√±ero 2",description:"Apuntar al segundo miembro del equipo"},target_teammate_3:{name:"Apuntar compa√±ero 3",description:"Apuntar al tercer miembro del equipo"},target_teammate_4:{name:"Apuntar compa√±ero 4",description:"Apuntar al cuarto miembro del equipo"},fire_all:{name:"Disparar todas las armas",description:"Disparar todas las armas"},fire_phasers:{name:"Disparar armas de energ√≠a",description:"Disparar todas las armas de energ√≠a"},fire_torps:{name:"Disparar torpedos",description:"Disparar todos los torpedos"},fire_mines:{name:"Disparar minas",description:"Disparar todas las minas"},fire_phasers_torps:{name:"Disparar phasers y torpedos",description:"Disparar phasers y torpedos"},fire_projectiles:{name:"Disparar Proyectiles",description:"Disparar torpedos y minas"},setactivecostume:{name:"Establecer Disfraz Activo",description:"Establece el disfraz activo actual. Requiere dos modificadores."},custom_tray:{name:"Ejecuci√≥n de bandeja",description:"Ejecutar ranura espec√≠fica de bandeja"},tray_with_backup:{name:"Ejecuci√≥n de bandeja con respaldo",description:"Ejecutar ranura espec√≠fica de bandeja con habilidad de respaldo"},tray_range:{name:"Ejecuci√≥n de rango de bandeja",description:"Ejecutar un rango de ranuras de bandeja"},tray_range_with_backup:{name:"Rango de bandeja con respaldo",description:"Ejecutar un rango de ranuras de bandeja con habilidades de respaldo"},whole_tray:{name:"Ejecuci√≥n de bandeja completa",description:"Ejecutar todas las ranuras de una bandeja"},whole_tray_with_backup:{name:"Bandeja completa con respaldo",description:"Ejecutar todas las ranuras de una bandeja con bandeja de respaldo"},distribute_shields:{name:"Distribuir escudos",description:"Distribuye uniformemente los escudos como si hicieras clic en el medio del √≠cono de nave y escudos"},reroute_shields_rear:{name:"Redirigir escudos traseros",description:"Redirigir energ√≠a de escudos hacia atr√°s"},reroute_shields_left:{name:"Redirigir escudos izquierdos",description:"Redirigir energ√≠a de escudos hacia la izquierda"},reroute_shields_right:{name:"Redirigir escudos derechos",description:"Redirigir energ√≠a de escudos hacia la derecha"},reroute_shields_forward:{name:"Redirigir escudos delanteros",description:"Redirigir energ√≠a de escudos hacia adelante"},full_impulse:{name:"Impulso completo",description:"Activar motor de impulso completo"},reverse:{name:"Reversa",description:"Motores en reversa"},throttle_adjust:{name:"Ajustar acelerador",description:"Aumentar o disminuir el acelerador por cantidad"},throttle_set:{name:"Establecer acelerador",description:"Establecer el acelerador a una posici√≥n espec√≠fica (negativo = reversa, 0 = parar)"},throttle_toggle:{name:"Alternar acelerador",description:"Alternar entre acelerador completo y parada completa"},turn_left:{name:"Girar izquierda",description:"Girar nave a la izquierda (continuo mientras se mantiene)"},turn_right:{name:"Girar derecha",description:"Girar nave a la derecha (continuo mientras se mantiene)"},pitch_up:{name:"Cabecear arriba",description:"Cabecear nariz de nave hacia arriba (cambio de altitud espacial)"},pitch_down:{name:"Cabecear abajo",description:"Cabecear nariz de nave hacia abajo (cambio de altitud espacial)"},strafe_left:{name:"Desplazamiento lateral izquierdo",description:"Desplazar nave lateralmente a la izquierda"},strafe_right:{name:"Desplazamiento lateral derecho",description:"Desplazar nave lateralmente a la derecha"},forward:{name:"Adelante",description:"Moverse adelante"},backward:{name:"Atr√°s",description:"Moverse atr√°s"},auto_forward:{name:"Avance autom√°tico",description:"El personaje se mueve adelante hasta que se den nuevos comandos de movimiento"},follow:{name:"Seguir objetivo",description:"Seguir a la entidad objetivo"},follow_cancel:{name:"Cancelar seguimiento",description:"Dejar de seguir y olvidar el objetivo"},zoom_in:{name:"Acercar zoom",description:"Acercar la c√°mara"},zoom_out:{name:"Alejar zoom",description:"Alejar la c√°mara"},zoom_in_small:{name:"Acercar zoom ligeramente",description:"Acercar la c√°mara ligeramente"},zoom_out_small:{name:"Alejar zoom ligeramente",description:"Alejar la c√°mara ligeramente"},cam_distance:{name:"Establecer distancia de c√°mara",description:"Establecer la distancia de la c√°mara del jugador"},cam_reset:{name:"Reiniciar c√°mara",description:"Reiniciar la posici√≥n de la c√°mara por defecto"},cam_target_lock:{name:"Bloquear c√°mara al objetivo",description:"Bloquear o desbloquear la c√°mara al objetivo"},cam_cycle_distance:{name:"Alternar distancia de c√°mara",description:"Alternar la distancia de la c√°mara entre varios valores preestablecidos"},cam_mouse_look:{name:"Vista de rat√≥n",description:"Activar control de c√°mara con vista de rat√≥n"},cam_turn_to_face:{name:"Girar hacia la c√°mara",description:"Girar nave para mirar hacia la direcci√≥n de la c√°mara"},look_up:{name:"Mirar arriba",description:"Cambiar punto de vista para mirar directamente arriba"},look_down:{name:"Mirar abajo",description:"Cambiar punto de vista para mirar directamente abajo"},team_message:{name:"Mensaje de equipo",description:"Enviar mensaje al equipo"},local_message:{name:"Mensaje local",description:"Enviar mensaje al √°rea local"},zone_message:{name:"Mensaje de zona",description:"Enviar mensaje a la zona"},toggle_hud:{name:"Alternar HUD",description:"Alternar visibilidad del HUD"},screenshot:{name:"Captura de pantalla",description:"Tomar una captura de pantalla"},screenshot_jpg:{name:"Captura de pantalla JPG",description:"Guardar una captura de pantalla como JPG"},autofire_set:{name:"Establecer disparo autom√°tico",description:"Activar y desactivar el disparo autom√°tico de armas. X = 1 lo activa y X = 0 lo desactiva."},bind_save_file:{name:"Guardar atajos a archivo",description:"Guardar todos tus atajos en un archivo de texto"},bind_load_file:{name:"Cargar atajos desde archivo",description:"Cargar un archivo de atajos en el cliente"},combat_log:{name:"Alternar registro de combate",description:"Activar/desactivar grabaci√≥n del registro de combate (1=activado, 0=desactivado)"},missions:{name:"Mostrar/Ocultar misiones",description:"Mostrar/ocultar el diario de misiones"},inventory:{name:"Mostrar/Ocultar inventario",description:"Mostrar/ocultar tu inventario"},map:{name:"Mostrar/Ocultar mapa",description:"Mostrar/ocultar la ventana del mapa"},logout:{name:"Cerrar sesi√≥n",description:"Cerrar sesi√≥n del personaje actual."},quit:{name:"Salir del juego",description:"Cerrar la ventana."},ui_load:{name:"Cargar configuraci√≥n de UI",description:"Carga el archivo de guardado predeterminado de ventanas de UI, generalmente Live\\ui_settings.txt"},ui_save:{name:"Guardar configuraci√≥n de UI",description:"Guarda el dise√±o de UI en el archivo de guardado predeterminado de ventanas de UI, generalmente Live\\ui_settings.txt"},ui_load_file:{name:"Cargar archivo de configuraci√≥n de UI",description:"Carga archivo de guardado de ventanas de UI con nombre"},ui_save_file:{name:"Guardar archivo de configuraci√≥n de UI",description:"Guarda el dise√±o de UI en archivo de guardado de ventanas de UI con nombre"},ui_cancel:{name:"UI Cancelar",description:'Responde "Cancelar" a un cuadro de di√°logo abierto; puede no funcionar en todos los di√°logos.'},ui_ok:{name:"UI OK",description:'Responde "OK" a un cuadro de di√°logo abierto; puede no funcionar en todos los di√°logos.'},chat_log:{name:"Alternar registro de chat",description:"Activar/desactivar registro de chat. 1=activado, 0=desactivado, sin par√°metro=imprimir estado. Anteponer ++ lo convierte en alternador"},remember_ui_lists:{name:"Recordar listas de UI",description:"Si se deben recordar la colocaci√≥n y ancho de columnas de listas de UI."},ui_remember_positions:{name:"Recordar posiciones de UI",description:"Si se deben recordar tama√±os y posiciones de UI. Activado por defecto."},safe_login:{name:"Inicio de sesi√≥n seguro",description:"Si es verdadero, entonces inicia sesi√≥n al jugador en su mapa est√°tico m√°s reciente en lugar de cualquier otra cosa."},goto_character_select:{name:"Ir a selecci√≥n de personaje",description:"Ir a la pantalla de selecci√≥n de personaje sin cerrar sesi√≥n."},ui_gen_layers_reset:{name:"Restablecer dise√±o de UI",description:"Restablece el dise√±o, usado cuando el servidor actualiza posiciones de ventanas movibles"},ui_resolution:{name:"Imprimir resoluci√≥n de UI",description:"Imprime la resoluci√≥n de pantalla de UI actual."},ui_tooltip_delay:{name:"Establecer retraso de tooltip",description:"Establece el retraso adicional, en segundos, antes de que aparezcan los tooltips"},show_game_ui:{name:"Mostrar UI del juego",description:"Mostrar la UI del juego"},show_game_ui_no_extra_keybinds:{name:"Mostrar UI del juego (sin keybinds extra)",description:"Este comando no agrega ning√∫n keybind para mostrar la UI cuando el usuario presiona escape"},change_instance:{name:"Cambiar instancia",description:"Cambiar a una instancia ya creada del mismo mapa. Solo funciona cuando no est√° en alerta roja."},aim:{name:"Apuntar/Mira",description:"Activar/desactivar mira. En modo mira el jugador hace m√°s da√±o. Puede usarse como alternador o presionar y mantener"},holster:{name:"Enfundar arma",description:"Intentar enfundar tu arma activa"},holster_toggle:{name:"Alternar enfundar arma",description:"Intentar enfundar o desenfundar tus armas"},unholster:{name:"Desenfundar arma",description:"Intentar desenfundar tu arma activa"},toggle_shooter_mode:{name:"Alternar modo tirador",description:"Activar/desactivar modo tirador"},shooter_primary:{name:"Tirador primario",description:"Acci√≥n primaria del modo tirador"},shooter_secondary:{name:"Tirador secundario",description:"Acci√≥n secundaria del modo tirador"},shooter_tertiary:{name:"Tirador terciario",description:"Acci√≥n terciaria del modo tirador"},shooter_clear_offset_tray_binds:{name:"Limpiar enlaces de bandeja de compensaci√≥n del tirador",description:"Limpiar la ubicaci√≥n inicial y movimiento de la caja de acci√≥n amarilla que aparece en la bandeja en modo tirador"},shooter_clear_overlay_tray_binds:{name:"Limpiar enlaces de bandeja superpuesta del tirador",description:"Limpiar enlaces de bandeja superpuesta para modo tirador"},shooter_set_offset_tray_binds:{name:"Establecer enlaces de bandeja de compensaci√≥n del tirador",description:"Establecer la ubicaci√≥n inicial y movimiento de la caja de acci√≥n amarilla que aparece en la bandeja en modo tirador"},shooter_set_overlay_tray_binds:{name:"Establecer enlaces de bandeja superpuesta del tirador",description:"Establecer enlaces de bandeja superpuesta para modo tirador"},setrallypoint:{name:"Establecer Punto de Encuentro",description:"Establece un punto de encuentro para tu objetivo actual"},setrallypointconsole:{name:"Establecer Punto de Encuentro (Consola)",description:"Establece un punto de encuentro para tu objetivo actual (variante consola)"},clearrallypoint:{name:"Borrar Punto de Encuentro",description:"Borra el punto de encuentro para tu objetivo actual"},clearallrallypoints:{name:"Borrar Todos los Puntos de Encuentro",description:"Borra todos los puntos de encuentro"},assist:{name:"Asistir",description:"Asistir '<name>': Asiste a la entidad con el nombre coincidente. Si no se da un nombre, asiste a tu objetivo actual."},net_timing_graph:{name:"Gr√°fico de Tiempo de Red",description:"Activar o desactivar el gr√°fico de tiempo de red (0=desactivar, 1=activar)"},net_timing_graph_alpha:{name:"Gr√°fico de Tiempo de Red Alpha",description:"Establecer nivel de transparencia para el gr√°fico de tiempo de red (50=mayor transparencia, 255=sin transparencia)"},net_timing_graph_paused:{name:"Gr√°fico de Tiempo de Red Pausado",description:"Pausar o reanudar el gr√°fico de tiempo de red (0=pausa desactivada, 1=pausa activada)"},netgraph:{name:"Gr√°fico de Red",description:"Mostrar datos de red SND y RCV como texto (1=activado, 0=desactivado)"},parameter_placeholders:{any_sto_command:"Ingresa cualquier comando STO (ej., Target_Enemy_Near)",entity_name:"Ingresa nombre de entidad",first_modifier:"Primer modificador",second_modifier:"Segundo modificador",entity_name_optional:"Nombre de entidad (opcional)"}},category_descriptions:{targeting:"Selecci√≥n y gesti√≥n de objetivos",combat:"Disparo de armas y acciones de combate",tray:"Ejecutar habilidades desde bandejas de acci√≥n",power:"Gesti√≥n de energ√≠a y distribuci√≥n de escudos",movement:"Movimiento y navegaci√≥n de nave",camera:"Control de c√°mara y gesti√≥n de vista",communication:"Chat y comunicaci√≥n de equipo",system:"Comandos de UI y sistema",custom:"Comandos personalizados"},no_aliases_defined:"Sin alias definidos",create_alias_to_get_started:"Crea un alias para comenzar",alias_deleted:'Alias "{{aliasName}}" eliminado',please_select_a_key_first:"Por favor selecciona una tecla primero",no_active_profile:"Sin perfil activo",alias_not_found:'Alias "{{name}}" no encontrado',alias_created:"Alias creado exitosamente",import_failed:"Importaci√≥n fall√≥: {{error}}",storage_not_available:"Almacenamiento no disponible",no_aliases_found_in_file:"No se encontraron alias en el archivo",import_completed_keybinds:"Importaci√≥n completada: {{count}} atajos",import_completed_aliases:"Importaci√≥n completada: {{count}} alias",kbf_import_completed:"Importaci√≥n KBF completada: {{bindsets}} bindset(s), {{keys}} tecla(s), {{aliases}} alias(es)",kbf_import_skipped_activities:"{{count}} actividades omitidas",kbf_import_errors_encountered:"{{count}} errores encontrados",kbf_import_warnings_generated:"{{count}} advertencias generadas",kbf_import_processing_time:"Procesado en {{seconds}}s",kbf_import_error_summary:"Resumen",kbf_import_bindsets_processed:"{{count}} bindsets procesados",kbf_import_bindsets_failed:"{{count}} bindsets fallaron",kbf_import_total_errors:"{{count}} errores totales",kbf_import_total_warnings:"{{count}} advertencias totales",project_imported_successfully:"Proyecto importado exitosamente: {{profileCount}} perfiles",sync_folder_set:"Carpeta de sincronizaci√≥n seleccionada",failed_to_set_sync_folder:"Fall√≥ al seleccionar carpeta de sincronizaci√≥n: {{error}}",sync_not_supported_firefox:"La funcionalidad de carpeta de sincronizaci√≥n requiere un navegador basado en Chromium (Chrome, Edge, etc.). Firefox no soporta la File System Access API requerida.",sync_not_supported_title:"Sincronizaci√≥n no soportada",sync_not_supported_detailed:"La funcionalidad de sincronizaci√≥n no est√° disponible en Firefox debido a limitaciones del navegador. La File System Access API requerida para la sincronizaci√≥n de carpetas solo es soportada en navegadores basados en Chromium. A√∫n puedes respaldar y restaurar manualmente el estado de tu aplicaci√≥n o usar el Explorador de Archivos para copiar tus archivos de keybind y alias.",sync_not_supported_secure_context:"El servicio de sincronizaci√≥n no est√° disponible cuando se sirve a trav√©s de HTTP. Por favor use HTTPS o acceda a trav√©s del protocolo file:// para habilitar la funcionalidad de sincronizaci√≥n.",sync_not_supported_secure_context_title:"Se requiere contexto seguro",sync_not_supported_secure_context_detailed:"La funcionalidad de sincronizaci√≥n requiere una conexi√≥n segura (HTTPS) o acceso a archivos locales (file://) para funcionar. La File System Access API necesaria para la sincronizaci√≥n de carpetas solo est√° disponible en contextos seguros para proteger sus datos. Por favor acceda a esta aplicaci√≥n a trav√©s de HTTPS o √°brala como un archivo local.",sync_not_supported_browser:"Su navegador no soporta la File System Access API requerida para la funcionalidad de sincronizaci√≥n.",sync_not_supported_browser_title:"Navegador no soportado",sync_not_supported_browser_detailed:"Su navegador no soporta la File System Access API requerida para la sincronizaci√≥n de carpetas. Por favor intente usar un navegador basado en Chromium (Chrome, Edge, etc.) con una conexi√≥n segura (HTTPS) o acceso a archivos locales.",no_sync_folder_selected:"Ninguna carpeta de sincronizaci√≥n seleccionada",project_synced_successfully:"Proyecto sincronizado exitosamente",sync_folder_contains_project_title:"Datos de Sincronizaci√≥n Existentes Encontrados",sync_folder_contains_project_prompt:"Esta carpeta ya contiene un project.json de una sincronizaci√≥n anterior. ¬øImportarlo ahora en lugar de sobrescribir?",project_imported_from_sync_folder:"Estado de la aplicaci√≥n importado desde la carpeta de sincronizaci√≥n",sync_overwrite_existing_title:"¬øSobrescribir Datos de Sincronizaci√≥n?",sync_overwrite_existing_prompt:"Importaci√≥n rechazada. ¬øSobrescribir la carpeta de sincronizaci√≥n con el estado actual de la aplicaci√≥n?",sync_operation_cancelled:"Sincronizaci√≥n cancelada",failed_to_import_project:"Fall√≥ al importar proyecto: {{error}}",permission_denied_to_folder:"Permiso denegado para escribir en la carpeta",failed_to_sync_project:"Fall√≥ al sincronizar proyecto: {{error}}",synchronization:"Sincronizaci√≥n",advanced:"Avanzado",synchronization_settings:"Configuraci√≥n de sincronizaci√≥n",advanced_settings:"Configuraci√≥n avanzada",sync_folder_description:"Elige una carpeta para sincronizar autom√°ticamente tus proyectos",auto_sync:"Sincronizaci√≥n autom√°tica",auto_sync_description:"Sincronizar autom√°ticamente los cambios con la carpeta seleccionada",auto_sync_interval:"Intervalo de sincronizaci√≥n autom√°tica",auto_sync_interval_description:"Con qu√© frecuencia sincronizar autom√°ticamente sus cambios",after_every_change:"Despu√©s de cada cambio",every_1_minute:"Cada minuto",every_2_minutes:"Cada 2 minutos",every_5_minutes:"Cada 5 minutos",bind_to_alias_mode:"Crear cadenas de keybind como alias",bind_to_alias_mode_description:"Cuando est√° activado, las cadenas de keybind se generan como alias nombrados por entorno y tecla (por ejemplo, 'space_q'), y las teclas se vinculan para llamar a dichos alias.",preferences_saved:"Preferencias guardadas exitosamente",vfx_manager_description:"Selecciona efectos visuales para desactivar usando alias de dynFxSetFXExlusionList. Los efectos est√°n organizados por entorno.",app_description:"Una herramienta integral basada en web para crear, editar y gestionar configuraciones de atajos de Star Trek Online con edici√≥n visual y caracter√≠sticas avanzadas.",default_export_filename:"export.txt",select_a_space_ground_build_or_aliases_to_preview_export:"Selecciona una construcci√≥n de Espacio/Tierra o Alias para previsualizar la exportaci√≥n.",alias_mode:"Modo de alias",create:"Crear",filter_aliases:"Filtrar alias",select_an_alias_to_edit:"Selecciona un alias para editar",select_an_alias_to_see_the_generated_command:"Selecciona un alias para ver el comando generado",no_alias_selected:"Ning√∫n alias seleccionado",select_alias_from_left_panel:"Selecciona un alias del panel izquierdo para ver y editar su cadena de comandos.",select_key_from_left_panel:"Selecciona una tecla del panel izquierdo para ver y editar su cadena de comandos.",failed_to_load_application:"No se pudo cargar la aplicaci√≥n",profile_created:'Perfil "{{name}}" creado',failed_to_create_profile:"No se pudo crear el perfil",failed_to_clone_profile:"No se pudo clonar el perfil",cannot_delete_the_last_profile:"No se puede eliminar el √∫ltimo perfil",profile_deleted:'Perfil "{{profileName}}" eliminado',failed_to_delete_profile:"No se pudo eliminar el perfil",invalid_key_name:"Nombre de tecla inv√°lido",key_added:'Tecla "{{keyName}}" agregada',key_already_exists:'La tecla "{{keyName}}" ya existe',key_deleted:'Tecla "{{keyName}}" eliminada',key_duplicated:'Tecla "{{from}}" duplicada como "{{to}}"',failed_to_delete_key:"No se pudo eliminar la tecla",key_not_found:'Tecla "{{keyName}}" no encontrada',failed_to_duplicate_key:"No se pudo duplicar la tecla",alias_duplicated:'Alias "{{from}}" duplicado como "{{to}}"',failed_to_add_alias:"No se pudo crear el alias",failed_to_delete_alias:"No se pudo eliminar el alias",failed_to_duplicate_alias:"No se pudo duplicar el alias",alias_already_exists:'El alias "{{name}}" ya existe',invalid_alias_name:"Nombre de alias inv√°lido",invalid_project_file:"Archivo de proyecto inv√°lido",no_commands_to_duplicate:"No hay comandos para duplicar",command_chain_is_valid:"Cadena de comandos es v√°lida",no_profile_selected:"Ning√∫n perfil seleccionado",language_updated:"Idioma actualizado",nothing_to_copy:"Nada que copiar",content_copied_to_clipboard:"Contenido copiado al portapapeles",failed_to_generate_export:"No se pudo generar la exportaci√≥n",no_profile_selected_to_clone:"Ning√∫n perfil seleccionado para clonar",no_profile_selected_to_rename:"Ning√∫n perfil seleccionado para renombrar",profile_name_is_required:"El nombre del perfil es requerido",failed_to_save_profile:"No se pudo guardar el perfil: {{error}}",no_profile_selected_to_delete:"Ning√∫n perfil seleccionado para eliminar",no_keybinds_to_export:"No hay atajos para exportar",no_aliases_to_export:"No hay alias para exportar",application_reset_successfully:"Aplicaci√≥n restablecida exitosamente",confirm_clear:"Confirmar limpieza",confirm_clear_commands:'¬øEst√°s seguro de que quieres limpiar todos los comandos para "{{keyName}}"?',confirm_delete_alias:'¬øEst√°s seguro de que quieres eliminar el alias "{{aliasName}}"?',confirm_delete_key:'¬øEst√°s seguro de que quieres eliminar la tecla "{{keyName}}" y todos sus comandos?',confirm_delete_profile:'¬øEst√°s seguro de que quieres eliminar el perfil "{{profileName}}"?\n\nEsta acci√≥n no se puede deshacer.',failed_to_copy_to_clipboard:"Fall√≥ al copiar al portapapeles",no_effects_selected:"No hay efectos seleccionados. Por favor selecciona al menos un efecto para generar alias.",profile_created_from:'Perfil "{{newName}}" creado desde "{{sourceProfile}}"',profile_renamed:'Perfil renombrado de "{{oldName}}" a "{{name}}"',sto_tools_keybind_manager_loaded_successfully:"STO Tools Keybind Manager cargado exitosamente",switched_to_profile:"Cambiado al perfil: {{name}} ({{environment}})",yes:"S√≠",no:"No",ok:"OK",no_commands:"No hay comandos",profile_not_found:"Perfil no encontrado",click_add_command_to_start_building_your_command_chain:"Seleccione elementos en la Biblioteca de Comandos para comenzar a construir su cadena de comandos de teclas para",click_add_command_to_start_building_your_alias_chain:"Seleccione elementos en la Biblioteca de Comandos para comenzar a construir su cadena de comandos de alias para",create_alias:"Crear Alias",key:"tecla",no_profile:"Sin perfil",stotrayexecbytray_description:"STOTrayExecByTray (muestra el enlace de tecla en la UI)",trayexecbytray_description:"TrayExecByTray (sin indicaci√≥n de UI)",parameter_configuration:"Configuraci√≥n de par√°metros",delete_selected_key:"Eliminar tecla seleccionada",duplicate_selected_key:"Duplicar tecla seleccionada",show_all_keys:"Mostrar todas las teclas",duplicate:"Duplicar",reserved_command_name:"El nombre entra en conflicto con un comando STO",backup_created_successfully:"Copia de seguridad de la aplicaci√≥n creada exitosamente",failed_to_create_backup:"Fall√≥ al crear copia de seguridad: {{error}}",backup_restored_successfully:"Estado de la aplicaci√≥n restaurado exitosamente",import_from_key_or_alias:"Importar desde Tecla o Alias",select_source_to_import_from:"Seleccionar fuente para importar:",clear_destination_chain_prior_to_import:"Limpiar cadena de destino antes de importar",no_sources_available:"No hay fuentes disponibles",error_loading_sources:"Error cargando fuentes",please_select_a_source:"Por favor selecciona una fuente",source_has_no_commands:"La fuente no tiene comandos para importar",commands_imported_successfully:"{{count}} comandos importados desde {{source}}",cross_environment_import_warning:"Advertencia: {{dropped}} comandos espec√≠ficos de {{sourceEnv}} fueron descartados al importar a {{targetEnv}}",no_compatible_commands_to_import:"No hay comandos compatibles para importar despu√©s del filtrado",failed_to_load_profile_data:"Error al cargar datos del perfil",already_on_profile:"Ya est√° en este perfil",source_profile_not_found:"Perfil fuente no encontrado",profile_name_required:"Se requiere nombre de perfil",switch_to_key_type_view:"Cambiar a vista de tipo de tecla",switch_to_grid_view:"Cambiar a vista de cuadr√≠cula",switch_to_command_categories:"Cambiar a categor√≠as de comandos",no_profiles_available:"No hay perfiles disponibles",verb:{say:"Decir (Local)",team:"Equipo",zone:"Zona",tell:"Susurrar"},duplicate_alias:"Duplicar Alias",enter_new_alias_name:"Ingresar nuevo nombre de alias",alias_name_in_use:"El nombre del alias ya existe",failed_to_rename_profile:"Error al renombrar perfil: {{error}}",ground_build:"Construcci√≥n Terrestre",import_failed_invalid_json:"Importaci√≥n fall√≥: Formato JSON inv√°lido",import_failed_unsupported_format:"Importaci√≥n fall√≥: Formato de archivo no soportado",no_content_available:"No hay contenido disponible",no_valid_profile:"No hay perfil v√°lido disponible",profile_already_exists:"El perfil ya existe",profile_id_required:"Se requiere ID de perfil",space_build:"Construcci√≥n Espacial",syncing:"Sincronizando...",command_parameters:{active:{label:"Activo",help:"0: Desactivado, 1: Activado"},tray:{label:"Bandeja",help:"N√∫mero de bandeja (0-9). 0=Bandeja del juego 1"},slot:{label:"Ranura",help:"N√∫mero de ranura (0-9). 0=Ranura del juego 1"},start_tray:{label:"Bandeja de Inicio",help:"N√∫mero de bandeja de inicio (0-9). 0=Bandeja del juego 1"},end_tray:{label:"Bandeja de Fin",help:"N√∫mero de bandeja de fin (0-9). 0=Bandeja del juego 1"},start_slot:{label:"Ranura de Inicio",help:"N√∫mero de ranura de inicio (0-9). 0=Ranura del juego 1"},end_slot:{label:"Ranura de Fin",help:"N√∫mero de ranura de fin (0-9). 0=Ranura del juego 1"},backup_tray:{label:"Bandeja de Respaldo",help:"N√∫mero de bandeja de respaldo (0-9). 0=Bandeja del juego 1"},backup_slot:{label:"Ranura de Respaldo",help:"N√∫mero de ranura de respaldo (0-9). 0=Ranura del juego 1"},backup_start_tray:{label:"Bandeja de Inicio de Respaldo",help:"N√∫mero de bandeja de inicio de respaldo (0-9). 0=Bandeja del juego 1"},backup_end_tray:{label:"Bandeja de Fin de Respaldo",help:"N√∫mero de bandeja de fin de respaldo (0-9). 0=Bandeja del juego 1"},backup_start_slot:{label:"Ranura de Inicio de Respaldo",help:"N√∫mero de ranura de inicio de respaldo (0-9). 0=Ranura del juego 1"},backup_end_slot:{label:"Ranura de Fin de Respaldo",help:"N√∫mero de ranura de fin de respaldo (0-9). 0=Ranura del juego 1"},command_type:{label:"Tipo de Comando",help:"Tipo de ejecuci√≥n de comando (STOTrayExecByTray muestra UI, TrayExecByTray no)"},entityName:{label:"Nombre de Entidad",help:"Nombre de la entidad a objetivo"},message:{label:"Mensaje",help:"Texto del mensaje a enviar"},distance:{label:"Distancia",help:"Valor de distancia de c√°mara"},amount:{label:"Cantidad",help:"Cantidad de ajuste del acelerador"},position:{label:"Posici√≥n",help:"Posici√≥n del acelerador (0-100)"},filename:{label:"Nombre de Archivo",help:"Nombre de archivo (sin extensi√≥n)"},state:{label:"Estado",help:"1 para activar, 0 para desactivar"},verb:{label:"Canal",help:"Canal de comunicaci√≥n (decir, equipo, zona)"},alias_name:{label:"Nombre de Alias",help:"Nombre del alias a ejecutar"},rawCommand:{label:"Comando",help:"Texto de comando STO sin formato"},seconds:{label:"Segundos",help:"Retraso en segundos"},alpha:{label:"Alfa",help:"Valor de transparencia (0-255)"},modifier1:{label:"Modificador 1",help:"Primera combinaci√≥n de teclas modificadoras"},modifier2:{label:"Modificador 2",help:"Segunda combinaci√≥n de teclas modificadoras"},name:{label:"Nombre",help:"Nombre del objetivo u objeto"},degrees:{label:"Grados",help:"Tama√±o del cono del arco en grados"}},add_new_alias:"Agregar Nuevo Alias",delete_selected_alias:"Eliminar Alias Seleccionado",duplicate_selected_alias:"Duplicar Alias Seleccionado",search_aliases:"Buscar alias...",clear_filter:"Limpiar filtro",warning:"Advertencia",error:"Error",validation_details:"Detalles de validaci√≥n",command_chain_near_limit:"La cadena de comandos es demasiado larga ({{length}} caracteres). Superar 999 puede fallar.",command_chain_too_long:"La cadena de comandos es demasiado larga ({{length}} caracteres) y puede fallar en el juego.",sto_tray_exec_optimization_suggestion:"La cadena de comandos tiene {{currentLength}} caracteres. Reemplazar {{count}} instancia(s) de STOTrayExecByTray por TrayExecByTray ahorrar√≠a {{potentialSavings}} caracteres (nueva longitud: {{newLength}}).",stabilized_non_tray_warning:"La ejecuci√≥n estabilizada solo debe usarse con habilidades de ejecuci√≥n de barra.",too_many_commands_on_key:"Asignar {{count}} comandos a una tecla puede fallar en el juego (m√°ximo recomendado 20).",alias_mixed_environment_warning:"El alias contiene comandos exclusivos de espacio y de tierra; esto no se recomienda.",spam_bar_warning:"No se recomienda en barras de spam ya que interfiere con los ciclos de disparo",press_any_key_combination:"Presione cualquier combinaci√≥n de teclas...",capture_instructions:"Utiliza tu teclado o rat√≥n, o cambia a modo manual para hacer clic en las teclas de abajo",switch_to_manual:"Cambiar a Manual",start_capture:"Iniciar captura",selected_key:"Tecla seleccionada",confirm_selection:"Confirmar selecci√≥n",key_selection_failed:"Error al seleccionar la tecla",error_generating_command:"Error al generar el comando",please_enter_a_raw_command:"Por favor, introduzca un comando",unsafe_keybind:"Combinaci√≥n de teclas insegura: {{key}} no est√° permitida",bindsets_enabled:"Habilitar conjuntos de enlaces",bindsets_enabled_description:"Permite la creaci√≥n y carga de conjuntos de enlaces (requiere 'Crear cadenas de keybind como alias').",bindsets:"Conjuntos de enlaces",bindset_manager:"Administrador de conjuntos de enlaces",create_bindset:"Crear conjunto de enlaces",enter_bindset_name:"Ingrese el nombre del conjunto de enlaces:",bindset_name:"Nombre del conjunto de enlaces",bindset_name_in_use:"El nombre del conjunto de enlaces ya est√° en uso",bindset_not_empty:"El conjunto de enlaces tiene keybinds y no se puede eliminar",invalid_name:"Nombre inv√°lido",add_key_to_bindset:"Agregar tecla al conjunto de enlaces",add_key_to_bindset_confirm:'¬øAgregar la tecla "{{key}}" al conjunto de enlaces "{{bindset}}"?',manage_bindsets:"Administrar Conjuntos de Enlaces",primary_bindset:"Conjunto de Enlaces Principal",remove_key_from_bindset:"Quitar tecla del conjunto de enlaces",remove_key_from_bindset_confirm:'¬øQuitar la tecla "{{key}}" del conjunto de enlaces "{{bindset}}"?',select_bindset:"Seleccionar Conjunto de Enlaces",confirm_delete:"¬øEst√°s seguro de que quieres eliminar?",enter_new_name:"Ingresar nuevo nombre:",translate_generated_messages:"Traducir mensajes generados",translate_generated_messages_description:"Cuando est√° habilitado, los mensajes generados autom√°ticamente (como notificaciones de supresi√≥n VFX) se traducir√°n al idioma seleccionado. Cuando est√° deshabilitado, permanecen en ingl√©s.",distinguish_left_right_modifiers:"Distinguir modificadores izquierdo/derecho",confirm_reset_application:"¬øEst√°s seguro de que quieres restablecer la aplicaci√≥n?\n\nEsto eliminar√° todos los perfiles, atajos de teclado y configuraciones. Esta acci√≥n no se puede deshacer.",environment:"Entorno",export_alias_definitions_note:"(Las definiciones de alias est√°n en el archivo de alias)",export_generated_aliases_count:"del modo de alias a teclas ({{count}} alias generados)",export_generated_aliases_note:"L√≠neas de atajos que llaman a alias generados",export_user_and_generated_aliases:"Este archivo contiene tanto alias creados por el usuario como alias generados",please_select_an_alias_first:"Por favor selecciona un alias primero",confirm_reset_app:"Confirmar Restablecimiento de Aplicaci√≥n",configure_colon:"Configurar:",edit_colon:"Editar:",default_profile_exists_message:'Ya existe un perfil llamado "Default". Cargar los datos predeterminados lo sobrescribir√≠a. ¬øDesea continuar?',default_profile_exists_title:"Perfil Predeterminado Existe",ground_alias:"Alias de Tierra",space_alias:"Alias de Espacio",backup_restore_failed:"Fall√≥ la restauraci√≥n de la copia de seguridad: {{error}}",confirm_add:"Confirmar Agregar",confirm_delete_bindset:'¬øEliminar conjunto de enlaces "{{name}}"?',confirm_remove:"Confirmar Eliminar",error_add_failed:"Fall√≥ al agregar la tecla al conjunto de enlaces",error_remove_failed:"Fall√≥ al eliminar la tecla del conjunto de enlaces",name_exists:"El nombre ya existe",name_required:"Se requiere nombre",name_unchanged:"El nombre no ha cambiado",not_found:"No encontrado",rename_bindset:"Renombrar Conjunto de Enlaces",bindset_actions:"Acciones del Conjunto de Enlaces",source_profile_and_new_name_required:"Se requieren el perfil de origen y el nuevo nombre",unknown_command:"Comando desconocido",command_group_hint_fixed_order:"Siempre se ejecuta primero",command_group_hint_palindromic:"Afecta la estructura del pal√≠ndromo",command_group_hint_pivot:"Forma el centro del pal√≠ndromo",command_group_non_trayexec:"Antes del Pal√≠ndromo",command_group_palindromic:"TrayExec Palindr√≥mico",command_group_pivot:"Grupo Pivot",palindromic_excluded_tooltip:"Excluido del pal√≠ndromo (clic para incluir)",palindromic_included_tooltip:"Incluido en el pal√≠ndromo (clic para excluir)",placement_before_palindromes_tooltip:"Antes de pal√≠ndromos (clic para mover al grupo pivot)",placement_in_pivot_group_tooltip:"En grupo pivot (clic para mover antes de pal√≠ndromos)",toggle_collapse:"Alternar contracci√≥n",primary_bindset_copy_default:"Copia de Bindset Primario",copy_suffix:"Copia",no_keys_in_bindset:"Sin teclas en este bindset",switch_to_categorized_view:"Cambiar a vista categorizada",clone_bindset:"Clonar Bindset",delete_bindset:"Eliminar Bindset",bindset_delete_warning:'Este bindset "{{name}}" contiene {{count}} teclas y ser√° eliminado permanentemente.',bindset_delete_consequences:"Todas las asignaciones de teclas en este bindset se perder√°n permanentemente y no se podr√°n recuperar.",bindset_delete_confirmation_text:"Entiendo que esto eliminar√° permanentemente todas las teclas en este bindset",bindset_delete_type_confirm:"Escriba DELETE para confirmar",confirm_delete_bindset_with_keys:"Eliminar Bindset con Teclas",bindset_deleted:'Bindset "{{name}}" eliminado exitosamente',configure_kbf_import:"Configurar Importaci√≥n KBF",configure_kbf_import_question:"Configurar c√≥mo se importar√°n los bindsets seleccionados:",import_configured:"Importaci√≥n Configurada",custom_name:"Nombre personalizado",primary_mapping_options:"Opciones de Mapeo Primario",map_master_to_primary:"Mapear bindset maestro a primario",create_new_primary:"Crear nuevo bindset primario",primary_name_placeholder:"Ingrese nombre del bindset primario",skip_primary_mapping:"Omitir mapeo primario (mantener como bindsets con nombre)",import_preview:"Vista Previa de Importaci√≥n",select_bindsets_for_preview:"Seleccione bindsets arriba para previsualizar su contenido",mapped_to_primary:"Mapeado a Primario",mapped_to_new_primary:"Mapeado a nuevo primario: {{name}}",mapped_to_named:"Mapeado a bindset con nombre",maps_to_primary_bindset:"Asigna a Bindset Primario",not_mapped:"No Importado",maps_to:"Asigna a",original_bindset_name:"Bindset Original",mapping_type:"Tipo de asignaci√≥n",mapping_destination:"Destino de asignaci√≥n",auto_resolve_conflict:"Resuelto autom√°ticamente como {{name}}",bindset_name_conflict:"Conflicto de nombre detectado",custom_name_placeholder:"Ingrese nombre personalizado...",key_count:"Cantidad de teclas",select_bindset_import_question:"Elija qu√© bindset importar al bindset primario:",select_bindset_to_import:"Seleccionar Bindset para Importar",single_bindset_import_note:"Dado que los bindsets est√°n deshabilitados, este bindset se importar√° al bindset primario.",reduced_bindset_functionality:"Modo de Importaci√≥n de Bindset √önico",reduced_bindset_functionality_description:"Con bindsets deshabilitados, puede importar un solo bindset que se mapear√° a su bindset primario. Esto proporciona una experiencia de importaci√≥n optimizada.",enable_full_bindset_functionality:"Para opciones avanzadas de importaci√≥n de m√∫ltiples bindsets, habilite bindsets en la configuraci√≥n.",import_strategy:"Estrategia de importaci√≥n",merge_keep_existing:"Fusionar (conservar existentes)",merge_overwrite_existing:"Fusionar (sobrescribir existentes)",overwrite_all:"Sobrescribir todo",overwrite_all_description_keybinds:"Elimina todos los atajos de teclado existentes en este entorno y los reemplaza con los importados.",overwrite_all_description_kbf:"Elimina los atajos de teclado existentes de los bindsets seleccionados y los reemplaza con datos KBF importados.",overwrite_all_description_kbf_primary:"Elimina todos los atajos de teclado existentes en el entorno primario y los reemplaza con datos KBF importados.",overwrite_all_description_kbf_bindsets:"Elimina los atajos de teclado existentes de los bindsets seleccionados y los reemplaza con datos KBF importados.",overwrite_all_description_aliases:"Elimina todos los alias existentes y los reemplaza con los importados.",overwrite_confirm_title:"Confirmar sobrescritura",overwrite_confirm_body_keys:"Esto eliminar√° todos los atajos de teclado existentes en {{environment}} y los reemplazar√° con el archivo de importaci√≥n.",overwrite_confirm_body_aliases:"Esto eliminar√° todos los alias existentes y los reemplazar√° con el archivo de importaci√≥n.",overwrite_counts:"Actual: {{current}} ¬∑ Entrante: {{incoming}}",overwrite_all_action:"Sobrescribir todo",import_result_skipped:"Importados {{imported}}, omitidos {{skipped}} conflictos.",import_result_overwrote:"Importados {{imported}}, sobrescritos {{overwritten}} elementos.",import_result_overwrite_all:"Importados {{imported}} despu√©s de limpiar {{cleared}} elementos existentes."};function ae(e){return null==e?"[UNDEFINED_TOPIC]":"string"==typeof e?e:String(e)}function se(e=c,t,i,n=5e3){if(!e)throw new Error(`Request failed: eventBus is null/undefined for topic "${ae(t)}". Component may not be properly initialized.`);const a=`rpc:${t}`,s=e.listeners.get(a);if(!s||0===s.size)throw new Error(`Request failed: No handler registered for topic "${ae(t)}". Component may not be properly initialized.`);const o=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,r=`${t}::reply::${o}`;return new Promise((a,s)=>{const c=setTimeout(()=>{d(),s(new Error("Request timed out"))},n);function l(e){d(),e&&Object.prototype.hasOwnProperty.call(e,"error")?s(new Error(e.error)):a(e?e.data:void 0)}function d(){clearTimeout(c),e.off(r,l)}e.on(r,l),e.emit(`rpc:${t}`,{requestId:o,replyTopic:r,payload:i})})}function oe(e=c,t,i){async function n(n){if(!n)return;const{requestId:a,replyTopic:s,payload:o}=n;if(s)try{const n=await i(o);"undefined"!=typeof window&&console.log(`[requestResponse] respond ‚Üê ${t}`,n),e.emit(s,{requestId:a,data:n})}catch(t){const i=t&&t.message?t.message:String(t);e.emit(s,{requestId:a,error:i})}}return e.on(`rpc:${t}`,n),()=>e.off(`rpc:${t}`,n)}class re{static cleanupRegistry=new FinalizationRegistry(e=>{e&&e.component&&e.component.destroy&&(console.log(`[ComponentBase] Finalizing ${e.constructorName||"Component"}`),e.component.destroy())});constructor(e=null){this.eventBus=e,this.initialized=!1,this.destroyed=!1,this.eventListeners=new Map,this.domEventListeners=[],re.cleanupRegistry.register(this,{component:this,constructorName:this.constructor.name})}init(){this.initialized||(this.initialized=!0,this.destroyed=!1,this.initializeCache(),this.addEventListener("component:register",this.i.bind(this)),this.o=`component:registered:reply:${this.getComponentName()}:${Date.now()}`,this.addEventListener(this.o,this.l.bind(this)),this.emit("component:register",{name:this.getComponentName(),replyTopic:this.o}),this.m(),this.uiInit&&this.uiInit(),this.onInit())}initializeCache(e={}){this.cache||(this.cache={selectedKey:null,selectedAlias:null,currentEnvironment:"space",currentProfile:null,profile:null,keys:{},aliases:{},builds:{},preferences:{},activeBindset:"Primary Bindset",bindsetNames:["Primary Bindset"],...e})}extendCache(e={}){this.cache?Object.assign(this.cache,e):this.initializeCache(e)}m(){this.initializeCache(),this.addEventListener("key-selected",e=>{this.cache.selectedKey=e.key,this.cache.selectedAlias=null}),this.addEventListener("alias-selected",e=>{this.cache.selectedAlias=e.name,this.cache.selectedKey=null}),this.addEventListener("environment:changed",e=>{const t="string"==typeof e?e:e?.environment;t&&(this.cache.currentEnvironment=t,this.cache.builds&&this.cache.builds[t]&&(this.cache.keys=this.cache.builds[t].keys||{}))}),this.addEventListener("profile:updated",({profileId:e,profile:t})=>{if(this.cache&&e===this.cache.currentProfile){if(this.cache.profile=t,!t)return this.cache.builds=null,this.cache.keys={},void(this.cache.aliases={});if(t.builds){this.cache.builds=t.builds;const e=t.builds[this.cache.currentEnvironment];this.cache.keys=e?.keys||{}}else t.keys&&(this.cache.keys=t.keys);this.cache.aliases=t.aliases||{}}}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{if(this.cache.currentProfile=e,this.cache.profile=t,this.cache.currentEnvironment=i||"space",this.h=this.cache.currentEnvironment,this.u=e,!t)return this.cache.builds=null,this.cache.keys={},void(this.cache.aliases={});if(t.keys)this.cache.keys=t.keys;else if(t.builds){const e=t.builds[this.cache.currentEnvironment];this.cache.keys=e?.keys||{},this.cache.builds=t.builds}else this.cache.keys={},this.cache.builds=null;this.cache.aliases=t.aliases||{}}),this.addEventListener("preferences:changed",e=>{e.changes?Object.assign(this.cache.preferences,e.changes):e.key&&void 0!==e.value&&(this.cache.preferences[e.key]=e.value)}),this.addEventListener("preferences:loaded",e=>{console.log(`[${this.componentName}] preferences:loaded received:`,e),e.settings&&(Object.assign(this.cache.preferences,e.settings),console.log(`[${this.componentName}] Updated preferences cache from preferences:loaded`))}),this.addEventListener("bindset-selector:active-changed",e=>{this.cache.activeBindset=e.bindset}),this.addEventListener("bindsets:changed",e=>{e.names&&Array.isArray(e.names)&&(this.cache.bindsetNames=e.names)}),this.addEventListener("preferences:saved",e=>{console.log(`[${this.componentName}] preferences:saved received:`,e),e.settings&&(Object.assign(this.cache.preferences,e.settings),console.log(`[${this.componentName}] Updated preferences cache from preferences:saved`))})}destroy(){this.destroyed?console.warn(`${this.constructor.name} is already destroyed`):(this.destroyed=!0,this.initialized=!1,this.cleanupEventListeners(),this.onDestroy())}onInit(){}onDestroy(){}addEventListener(e,t,i=null){this.eventBus&&(this.eventBus.on(e,t,i),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push({handler:t,context:i}))}addDomEventListener(e){"function"==typeof e&&this.domEventListeners.push(e)}onDom(e,t,i,n){if(!this.eventBus)return()=>{};const a=this.eventBus.onDom(e,t,i,n);return this.addDomEventListener(a),a}onDomDebounced(e,t,i,n,a){if(!this.eventBus)return()=>{};const s=this.eventBus.onDomDebounced(e,t,i,n,a);return this.addDomEventListener(s),s}removeEventListener(e,t){if(!this.eventBus)return;this.eventBus.off(e,t);const i=this.eventListeners.get(e);if(i){const e=i.findIndex(e=>e.handler===t);-1!==e&&i.splice(e,1)}}emit(e,t=null,i={}){return"undefined"!=typeof window&&console.log(`[${this.getComponentName()}] emit ‚Üí ${e} (options: ${JSON.stringify(i)})`,t),this.eventBus&&"function"==typeof this.eventBus.emit?this.eventBus.emit(e,t,i):(this.eventBus,Promise.resolve())}cleanupEventListeners(){if(this.eventBus){for(const[e,t]of this.eventListeners)t.forEach(({handler:t})=>{this.eventBus.off(e,t)});this.eventListeners.clear(),this.domEventListeners.forEach(e=>{try{e()}catch(e){console.error("Error cleaning up DOM event listener:",e)}}),this.domEventListeners=[]}}isInitialized(){return this.initialized&&!this.destroyed}getComponentName(){return this.componentName||this.constructor.name}i({name:e,replyTopic:t}={}){e!==this.getComponentName()&&this.initialized&&!this.destroyed&&this.emit(t,{sender:this.getComponentName(),state:this.getCurrentState()})}p(e,t){if(t){if(this.cache||(this.cache={}),"DataCoordinator"===e){const e=t.currentProfile||t.currentProfileData&&t.currentProfileData.id,i=t.currentProfileData;if(e&&(this.cache.currentProfile=e),i?(this.cache.profile=i,this.cache.currentEnvironment=i.environment||"space"):t.currentEnvironment&&(this.cache.currentEnvironment=t.currentEnvironment),i){if(i.builds){this.cache.builds=i.builds;const e=i.builds[this.cache.currentEnvironment];this.cache.keys=e?.keys||{}}else i.keys&&(this.cache.keys=i.keys);this.cache.aliases=i.aliases||{}}console.log(`[ComponentBase] ${this.getComponentName()} cached DataCoordinator state:`,{currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment})}"SelectionService"===e&&t&&(void 0!==t.selectedKey&&(this.cache.selectedKey=t.selectedKey),void 0!==t.selectedAlias&&(this.cache.selectedAlias=t.selectedAlias),void 0!==t.currentEnvironment&&(this.cache.currentEnvironment=t.currentEnvironment),void 0!==t.editingContext&&(this.cache.editingContext=t.editingContext),void 0!==t.cachedSelections&&(this.cache.cachedSelections=t.cachedSelections),console.log(`[ComponentBase] ${this.getComponentName()} cached SelectionService state:`,{selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,currentEnvironment:this.cache.currentEnvironment})),"PreferencesService"===e&&t&&t.settings&&"object"==typeof t.settings&&(Object.assign(this.cache.preferences,t.settings),console.log(`[ComponentBase] ${this.getComponentName()} cached PreferencesService state:`,{bindToAliasMode:this.cache.preferences.bindToAliasMode,bindsetsEnabled:this.cache.preferences.bindsetsEnabled,settingsCount:Object.keys(t.settings).length})),"BindsetService"===e&&t&&t.bindsets&&Array.isArray(t.bindsets)&&(this.cache.bindsetNames=t.bindsets,console.log(`[ComponentBase] ${this.getComponentName()} cached BindsetService state:`,{bindsetNames:this.cache.bindsetNames}))}}l({sender:e,state:t}={}){"undefined"!=typeof window&&console.log(`[ComponentBase] ${this.getComponentName()} received initial state from ${e}`,t),this.p(e,t),"function"==typeof this.handleInitialState&&this.handleInitialState(e,t)}getCurrentState(){return null}handleInitialState(e,t){}async request(e,t={}){return"undefined"!=typeof window&&console.log(`[${this.getComponentName()}] request ‚Üí ${e}`,t),await se(this.eventBus,e,t)}respond(e,t){return oe(this.eventBus,e,async i=>("undefined"!=typeof window&&console.log(`[${this.getComponentName()}] respond handler ‚Üí ${e}`,i),await t(i)))}}class ce extends re{constructor({storage:e,eventBus:t,i18n:i}={}){super(t),this.componentName="PreferencesService",this.storage=e,this.i18n=i,this.defaultSettings={theme:"default",autoSave:!0,showTooltips:!0,confirmDeletes:!0,maxUndoSteps:50,defaultMode:"space",compactView:!1,language:"en",syncFolderName:null,syncFolderPath:null,autoSync:!1,autoSyncInterval:"change",bindToAliasMode:!1,bindsetsEnabled:!1,translateGeneratedMessages:!1},this.settings={...this.defaultSettings},this.eventBus&&(this.respond("preferences:init",()=>{this.loadSettings(),this.applySettings()}),this.respond("preferences:load-settings",()=>this.loadSettings()),this.respond("preferences:save-settings",()=>this.saveSettings()),this.respond("preferences:get-settings",()=>this.getSettings()),this.respond("preferences:set-setting",({key:e,value:t})=>this.setSetting(e,t)),this.respond("preferences:set-settings",e=>this.setSettings(e)),this.respond("preferences:get-setting",({key:e})=>this.getSetting(e)),this.setupEventListeners())}setupEventListeners(){this.eventBus&&(this.eventBus.on("theme:toggle",()=>{this.toggleTheme()}),this.eventBus.on("language:change",({language:e})=>{e&&this.changeLanguage(e)}))}onInit(){this.loadSettings(),this.applySettings()}loadSettings(){try{if(!this.storage)return;const e=this.storage.getSettings();this.settings={...this.defaultSettings,...e},console.log("[PreferencesService] loadSettings",{settings:{...this.settings}}),this.emit("preferences:loaded",{settings:this.getSettings()})}catch(e){console.error("[PreferencesService] loadSettings failed",e),this.settings={...this.defaultSettings}}}async saveSettings(){if(!this.storage)return!1;const e=this.storage.saveSettings(this.settings);return console.log("[PreferencesService] saveSettings",{ok:e,settings:{...this.settings}}),e&&await this.emit("preferences:saved",{settings:this.getSettings()},{synchronous:!0}),e}getSettings(){return{...this.settings}}getSetting(e){return this.settings[e]}setSetting(e,t){this.settings[e]=t,console.log("[PreferencesService] setSetting",{key:e,value:t}),this.saveSettings(),this.applySettings(),this.emit("preferences:changed",{key:e,value:t})}setSettings(e={}){const t={...this.settings};this.settings={...this.defaultSettings,...e},console.log("[PreferencesService] setSettings",{changed:Object.keys(e)}),this.saveSettings(),this.applySettings();const i={};for(const[n,a]of Object.entries(e))t[n]!==a&&(i[n]=a);Object.keys(i).length>0&&this.emit("preferences:changed",{changes:i})}getCurrentState(){return{settings:{...this.settings}}}applySettings(){this.applyTheme(),this.applyLanguage(),this.applyOtherSettings()}applyTheme(){if("undefined"==typeof document)return;const e=this.settings.theme||"default";"dark"===e?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme"),this.updateThemeToggleButton(e)}async applyLanguage(){const e=this.settings.language||"en";this.i18n&&this.i18n.language!==e&&await this.i18n.changeLanguage(e),"undefined"!=typeof window&&"function"==typeof window.applyTranslations&&window.applyTranslations(),this.updateLanguageFlag(e)}applyOtherSettings(){if("undefined"!=typeof document&&(this.settings.compactView?document.body.classList.add("compact-view"):document.body.classList.remove("compact-view")),"undefined"!=typeof window&&window.app){const e=window.app;"autoSave"in e&&(e.autoSave=this.settings.autoSave),"maxUndoSteps"in e&&(e.maxUndoSteps=this.settings.maxUndoSteps)}}toggleTheme(){const e="dark"===(this.settings.theme||"default")?"default":"dark";this.setSetting("theme",e)}updateThemeToggleButton(e){if("undefined"==typeof document)return;const t=document.getElementById("themeToggleBtn"),i=document.getElementById("themeToggleText"),n=t?.querySelector("i");t&&i&&n&&("dark"===e?(n.className="fas fa-sun",i.setAttribute("data-i18n","light_mode"),i.textContent=this.i18n.t("light_mode")):(n.className="fas fa-moon",i.setAttribute("data-i18n","dark_mode"),i.textContent=this.i18n.t("dark_mode")))}async changeLanguage(e){this.setSetting("language",e),"undefined"!=typeof window&&window.localizeCommandData&&window.localizeCommandData(),this.emit("language:changed",{language:e})}updateLanguageFlag(e){if("undefined"==typeof document)return;const t=document.getElementById("languageFlag");t&&(t.className={en:"fi fi-gb",de:"fi fi-de",es:"fi fi-es",fr:"fi fi-fr"}[e]||"fi fi-gb")}}const le=globalThis.STO_DATA||{};class de extends re{constructor({storage:e=null,ui:t=null,app:i=null,eventBus:n=null,i18n:a=null}={}){super(n),this.componentName="ProjectManagementService",this.storage=e,this.ui=t,this.i18n=a,this.app=i,this.eventBus&&(this.setupEventHandlers(),this.setupRequestHandlers())}onInit(){console.log("[ProjectManagementService] Initialized and ready")}setupEventHandlers(){this.eventBus.on("project:save",()=>{this.backupApplicationState()}),this.eventBus.on("project:open",()=>{this.restoreApplicationState()})}setupRequestHandlers(){this.respond("project:restore-from-content",async({content:e,fileName:t}={})=>(console.log("[ProjectManagementService] request project:restore-from-content",{fileName:t,size:e?.length}),await this.restoreFromProjectContent(e,t)))}async backupApplicationState(){try{const e=this.storage.getAllData(),t={version:le?.settings?.version||"1.0.0",exported:(new Date).toISOString(),type:"project",data:{profiles:e.profiles||{},settings:e.settings||{},currentProfile:e.currentProfile}},i=JSON.stringify(t,null,2),n=new Blob([i],{type:"application/json"}),a=URL.createObjectURL(n),s=`STO_Tools_Backup_${(new Date).toISOString().split("T")[0]}.json`,o=document.createElement("a");return o.href=a,o.download=s,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),this.ui?.showToast(this.i18n.t("backup_created_successfully"),"success"),this.emit("project-backup-created",{filename:s,data:t}),{success:!0,filename:s}}catch(e){return console.error("[ProjectManagementService] backupApplicationState failed",e),this.ui?.showToast(this.i18n.t("failed_to_create_backup",{error:e.message}),"error"),this.emit("project-backup-failed",{error:e}),{success:!1,error:e.message}}}async restoreApplicationState(){try{const e=document.createElement("input");return e.type="file",e.accept=".json,application/json",new Promise((t,i)=>{e.onchange=async e=>{try{const i=e.target.files[0];if(!i)return void t({success:!1,cancelled:!0});const n=await i.text();console.log("[ProjectManagementService] restoreApplicationState: file selected",{name:i.name,size:n.length});const a=await this.restoreFromProjectContent(n,i.name);t(a)}catch(e){console.error("[ProjectManagementService] restoreApplicationState failed:",e),this.ui?.showToast(this.i18n.t("backup_restore_failed",{error:e.message}),"error"),t({success:!1,error:e.message})}},e.oncancel=()=>{t({success:!1,cancelled:!0})},e.click()})}catch(e){return console.error("[ProjectManagementService] restoreApplicationState failed:",e),{success:!1,error:e.message}}}async restoreFromProjectContent(e,t="project.json"){try{console.log("[ProjectManagementService] restoreFromProjectContent: begin",{fileName:t,size:e?.length}),console.log("[ProjectManagementService] About to call ImportService with content length:",e?.length);const i=await this.request("import:project-file",{content:e});if(console.log("[ProjectManagementService] import:project-file result",{success:i?.success,error:i?.error,params:i?.params}),!i?.success){const e=i?.error||"import_failed",t=i?.params?.reason||"",n=t?`${e}: ${t}`:e;throw new Error(n)}try{const e=await this.request("data:reload-state");console.log("[ProjectManagementService] data:reload-state done",e)}catch(e){}if(i.currentProfile)try{const e=await this.request("data:switch-profile",{profileId:i.currentProfile});console.log("[ProjectManagementService] data:switch-profile done",e)}catch(e){console.warn("Could not switch to imported current profile:",e?.message)}return this.ui?.showToast(this.i18n.t("backup_restored_successfully"),"success"),await this.emit("project-backup-restored",{filename:t,currentProfile:i.currentProfile,imported:i.imported},{synchronous:!0}),console.log("[ProjectManagementService] restoreFromProjectContent: success"),{success:!0,currentProfile:i.currentProfile,imported:i.imported}}catch(e){return console.error("[ProjectManagementService] restoreFromProjectContent: failed",e),{success:!1,error:e.message}}}}class me extends re{constructor({eventBus:e,storage:t,syncManager:i,ui:n}={}){super(e),this.componentName="AutoSync",this.storage=t,this.syncManager=i,this.ui=n,this.isEnabled=!1,this.interval="change",this._=null,this.lastSync=null,this.v=null,this.j=500,this.q=()=>this.debouncedSync(),this.setupPreferencesListeners()}onInit(){this.setupFromSettings()}setupPreferencesListeners(){this.eventBus.on("preferences:autosync-settings-changed",()=>{this.setupFromSettings()}),this.eventBus.on("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};void 0===t.autoSync&&void 0===t.autoSyncInterval||this.setupFromSettings(),this.isEnabled&&(console.log("[AutoSync] Preference setting changed, triggering immediate sync"),this.sync())})}setupFromSettings(){if(!this.storage)return;const e=this.storage.getSettings();e.autoSync?this.enable(e.autoSyncInterval||"change"):this.disable()}enable(e="change"){if(this.disable(),this.isEnabled=!0,this.interval=e,"change"===e)this.eventBus.on("storage:data-changed",this.q);else{const t=parseInt(e,10);if(isNaN(t)||t<=0)console.warn(`[AutoSync] Invalid interval '${e}', falling back to 'change' mode`),this.interval="change",this.eventBus.on("storage:data-changed",this.q);else{const e=1e3*t;this._=setInterval(()=>this.sync(),e)}}console.log(`[AutoSync] Enabled with interval: ${this.interval}`)}disable(){this.isEnabled=!1,this.eventBus.off("storage:data-changed",this.q),this._&&(clearInterval(this._),this._=null),this.v&&(clearTimeout(this.v),this.v=null),console.log("[AutoSync] Disabled")}debouncedSync(){this.v&&clearTimeout(this.v),this.v=setTimeout(()=>{this.v=null,this.sync()},this.j)}async sync(){if(this.isEnabled&&this.syncManager)try{await this.syncManager.syncProject("auto"),this.lastSync=new Date,this.ee("synced")}catch(e){console.error("[AutoSync] sync failed",e),this.ee("error")}}ee(e){if(!this.ui||"undefined"==typeof document)return;const t=document.getElementById("modifiedIndicator");if(t)switch(t.classList.remove("syncing","synced","error"),e){case"synced":t.style.display="inline",t.classList.add("synced"),t.innerHTML='<i class="fas fa-check"></i> Synced',setTimeout(()=>{t.style.display="none",t.classList.remove("synced")},2e3);break;case"error":t.style.display="inline",t.classList.add("error"),t.innerHTML='<i class="fas fa-exclamation-triangle"></i> Sync Error',setTimeout(()=>{t.style.display="none",t.classList.remove("error")},5e3)}}}class he extends re{constructor({eventBus:e=c,storageKey:t="sto_keybind_manager",backupKey:i="sto_keybind_manager_backup",settingsKey:n="sto_keybind_settings",version:a="1.0.0",dataService:s=null,data:o={},i18n:r=null}={}){super(e),this.componentName="StorageService",this.storageKey=t,this.backupKey=i,this.settingsKey=n,this.version=a,this.dataService=s,this.data=o||{},this.i18n=r}onInit(){this.migrateData(),this.ensureStorageStructure(),this.setupEventListeners(),this.emit("storage:ready",{service:this})}setupEventListeners(){this.addEventListener("app:reset-confirmed",()=>{this.handleAppReset()})}async handleAppReset(){console.log("[StorageService] Handling application reset");try{if(this.clearAllData()){if(console.log("[StorageService] Application reset successful - data cleared"),this.data=this.getEmptyData(),this.emit("storage:data-reset",{data:this.data},{synchronous:!0}),this.emit("app:reset-complete",{},{synchronous:!0}),"undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast){const e=this.i18n.t("application_reset_successfully");window.stoUI.showToast(e,"success")}}else console.error("[StorageService] Application reset failed"),this.emit("app:reset-failed")}catch(e){console.error("[StorageService] Error during application reset:",e),this.emit("app:reset-failed",{error:e})}}getAllData(e=!1){if(!e&&this.te)return this.te;try{const e=localStorage.getItem(this.storageKey),t=localStorage.getItem("sto_app_reset");if(!e)return t?(localStorage.removeItem("sto_app_reset"),this.getEmptyData()):this.getDefaultData();const i=JSON.parse(e);return this.isValidDataStructure(i,!0)?(this.te=i,i):this.getDefaultData()}catch(e){console.error("Error loading data from storage:",e);const t=this.getDefaultData();return this.te=t,t}}saveAllData(e){try{this.createBackup();const t={...e,version:this.version,lastModified:(new Date).toISOString(),lastBackup:(new Date).toISOString()};return localStorage.setItem(this.storageKey,JSON.stringify(t)),this.te=t,this.emit("storage:data-changed",{data:t}),!0}catch(e){return console.error("Error saving data to storage:",e),!1}}getProfile(e){return this.getAllData().profiles[e]||null}saveProfile(e,t){const i=this.getAllData(!0);return i.profiles[e]={...t,lastModified:(new Date).toISOString()},this.saveAllData(i)}deleteProfile(e){const t=this.getAllData();if(t.profiles[e]){if(delete t.profiles[e],t.currentProfile===e){const e=Object.keys(t.profiles);t.currentProfile=e.length>0?e[0]:null}return this.saveAllData(t)}return!1}getSettings(){try{const e=localStorage.getItem(this.settingsKey);if(!e)return this.getDefaultSettings();const t=JSON.parse(e);return{...this.getDefaultSettings(),...t}}catch(e){return console.error("Error loading settings:",e),this.getDefaultSettings()}}saveSettings(e){try{const t={...this.getSettings(),...e};return localStorage.setItem(this.settingsKey,JSON.stringify(t)),this.emit("storage:settings-changed",{settings:t}),!0}catch(e){return console.error("Error saving settings:",e),!1}}createBackup(){try{const e=localStorage.getItem(this.storageKey);if(e){const t={data:e,timestamp:(new Date).toISOString(),version:this.version};localStorage.setItem(this.backupKey,JSON.stringify(t)),this.emit("storage:backup-created",{backup:t})}}catch(e){console.error("Error creating backup:",e)}}clearAllData(){try{return localStorage.removeItem(this.storageKey),localStorage.removeItem(this.backupKey),localStorage.removeItem(this.settingsKey),localStorage.setItem("sto_app_reset","true"),this.emit("storage:data-cleared"),!0}catch(e){return console.error("Error clearing data:",e),!1}}getDefaultData(){return{version:this.version,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),currentProfile:null,profiles:{},globalAliases:{},settings:this.getDefaultSettings()}}getEmptyData(){return{version:this.version,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),currentProfile:null,profiles:{},globalAliases:{},settings:this.getDefaultSettings()}}getDefaultSettings(){return{theme:"default",autoSave:!0,showTooltips:!0,confirmDeletes:!0,maxUndoSteps:50,defaultMode:"space",compactView:!1,language:this.detectBrowserLanguage(),syncFolderName:null,syncFolderPath:null,autoSync:!1,autoSyncInterval:"change"}}detectBrowserLanguage(){try{if("undefined"==typeof navigator)return"en";const e=navigator.languages&&navigator.languages[0]||navigator.language;if(!e)return"en";const t=e.toLowerCase().split(/[-_]/)[0];return["en","de","es","fr"].includes(t)?t:"en"}catch(e){return console.error("Error detecting browser language:",e),"en"}}isValidDataStructure(e,t=!1){if(!e||"object"!=typeof e)return!1;const i=["profiles","currentProfile"];for(const t of i)if(!(t in e))return!1;if("object"!=typeof e.profiles)return!1;for(const[i,n]of Object.entries(e.profiles)){const e=this.isValidProfile(n),i=t&&this.needsProfileMigration(n);if(!e&&!i)return!1}return!0}isValidProfile(e){if(!e||"object"!=typeof e)return!1;if(!e.name)return!1;if(e.builds&&"object"==typeof e.builds){const t=e.builds;if(!t.space&&!t.ground)return!1;for(const[e,i]of Object.entries(t))if("space"===e||"ground"===e){if(!i||"object"!=typeof i)return!1;if(!i.keys||"object"!=typeof i.keys)return!1}return!0}return!(!e.mode||!e.keys||"object"!=typeof e.keys)}ensureStorageStructure(){const e=this.getAllData();e.globalAliases||(e.globalAliases={}),e.settings||(e.settings=this.getDefaultSettings()),Object.keys(e.profiles).length>0&&!e.profiles[e.currentProfile]&&(e.currentProfile=Object.keys(e.profiles)[0]),this.saveAllData(e)}migrateData(){const e=this.getAllData();let t=!1;e.version!==this.version&&(console.log(`Migrating data from ${e.version} to ${this.version}`),t=!0);for(const[i,n]of Object.entries(e.profiles))this.needsProfileMigration(n)&&(console.log(`Migrating profile "${n.name}" from old format to new format`),e.profiles[i]=this.migrateProfile(n),t=!0);t&&(e.version=this.version,this.saveAllData(e),console.log("Data migration completed"))}needsProfileMigration(e){return!(!(e&&e.mode&&e.keys)||e.builds)}migrateProfile(e){console.log(`Migrating profile: ${e.name}`);const t={name:e.name,description:e.description||"",currentEnvironment:this.mapOldModeToEnvironment(e.mode),builds:{space:{keys:{}},ground:{keys:{}}},aliases:e.aliases||{},keybindMetadata:e.keybindMetadata||{},created:e.created||(new Date).toISOString(),lastModified:(new Date).toISOString()},i=this.mapOldModeToEnvironment(e.mode);if(t.builds[i].keys=e.keys||{},e.keybindMetadata&&"object"==typeof e.keybindMetadata){const n=e.keybindMetadata.space||e.keybindMetadata.ground;t.keybindMetadata=n?e.keybindMetadata:{[i]:e.keybindMetadata}}return t}mapOldModeToEnvironment(e){if(!e)return"space";const t=("string"==typeof e?e:String(e)).toLowerCase();return"ground"===t||"ground mode"===t?"ground":"space"}getCurrentState(){return{service:this,isReady:this.isInitialized()}}}class ue extends re{constructor({eventBus:e,i18n:t,ui:i,modalManager:n}){super(e),this.componentName="CommandLibraryService",this.ie=`${Date.now()}_${Math.random().toString(36).substring(2,11)}`,this.i18n=t,this.ui=i,this.modalManager=n,this.ne=[],this.eventBus&&this.ne.push(this.respond("command:find-definition",({command:e})=>this.findCommandDefinition(e)),this.respond("command:get-warning",({command:e})=>this.getCommandWarning(e)),this.respond("command:get-categories",()=>this.getCommandCategories()),this.respond("command:generate-id",()=>this.generateCommandId()),this.respond("command:get-combined-aliases",async()=>await this.getCombinedAliases()),this.respond("command:filter-library",()=>(this.filterCommandLibrary(),!0)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("environment:changed",e=>{const t="string"==typeof e?e:e?.environment;"undefined"!=typeof window&&console.log("[CommandLibraryService] environment:changed event received. data:",e,`parsed env: ${t}`),t&&(this.filterCommandLibrary(),"undefined"!=typeof window&&console.log(`[CommandLibraryService] after environment change to ${t}`))}),this.addEventListener("language:changed",async()=>{try{await this.request("parser:clear-cache")}catch(e){console.warn("[CommandLibraryService] Could not clear parser cache:",e)}await this.updateCombinedAliases(),this.emit("aliases-changed",{aliases:this.cache.combinedAliases})}),this.addEventListener("vfx:settings-changed",async()=>{await this.updateCombinedAliases(),this.emit("aliases-changed",{aliases:this.cache.combinedAliases})})}async getCombinedAliases(){const e={...this.cache.aliases};try{const t=await this.request("vfx:get-virtual-aliases")||{};return{...e,...t}}catch(t){return e}}async updateCombinedAliases(){this.cache.combinedAliases=await this.getCombinedAliases()}async findCommandDefinition(e){try{if(!await this.request("data:has-commands"))return null;const t=await this.request("data:get-commands"),i="string"==typeof e?e.trim():(e?.command||"").trim(),n="string"==typeof e?e.trim():(e?.text||"").trim();for(const[e,a]of Object.entries(t))for(const[t,s]of Object.entries(a.commands))if(s.command===i||s.name===n)return{...this.translateCommandDefinition(s,t),commandId:t,categoryId:e};for(const[e,n]of Object.entries(t))for(const[t,a]of Object.entries(n.commands))if(i){const n=a.command.split(/\s+/)[0],s=n.replace(/^\+/,""),o=n.replace(/^\+?STO/,""),r=n.replace(/^\+?STO/,"+"),c=new Set([n,s,o,r]),l=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=Array.from(c).filter(Boolean).map(e=>new RegExp(`^${l(e)}(\\s|$)`,"i")),m=i.replace(/^\+/,""),h=d.some(e=>e.test(i)||e.test(m));if(/TrayExec/i.test(i)&&h||h)return{...this.translateCommandDefinition(a,t),commandId:t,categoryId:e}}return null}catch(e){return null}}translateCommandDefinition(e,t){if(!this.i18n)return e;const i={...e},n=`command_definitions.${t}.name`;i.name=this.i18n.t(n,{defaultValue:e.name});const a=`command_definitions.${t}.description`;return i.description=this.i18n.t(a,{defaultValue:e.description}),i}async getCommandWarning(e){try{if(!await this.request("data:has-commands"))return null;const t=await this.request("data:get-commands"),i="string"==typeof e?e.trim():(e?.command||"").trim();for(const[n,a]of Object.entries(t))for(const[t,n]of Object.entries(a.commands))if(i&&n.command===i||"object"==typeof e&&(n.command===e.command||n.name===e.text))return n.warning||null;for(const[n,a]of Object.entries(t))for(const[t,n]of Object.entries(a.commands)){const t=i||e.command;if(t&&t.includes(n.command)){const e=t.includes("TrayExec"),i=t.startsWith(n.command);if(e||i)return n.warning||null}}return null}catch(e){return null}}generateCommandId(){return`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}async getCommandCategories(){try{if(!await this.request("data:has-commands"))return{};const e=await this.request("data:get-commands");return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}catch(e){return{}}}async filterCommandLibrary(){try{if(!await this.request("data:has-commands"))return;const e=document.querySelectorAll(".command-item"),t=await this.request("data:get-commands");e.forEach(e=>{const i=e.dataset.command;if(!i)return;let n=null;for(const[e,a]of Object.entries(t))if(a.commands[i]){n=a.commands[i];break}if(n){let t;t="alias"===this.cache.currentEnvironment||!n.environment||n.environment===this.cache.currentEnvironment,e.dataset.envHidden=(!t).toString(),t?""!==e.style.display&&"none"!==e.style.display||(e.style.display="flex"):e.style.display="none"}}),document.querySelectorAll(".category").forEach(e=>{const t=e.querySelectorAll('.command-item:not([style*="display: none"])').length>0;e.style.display=t?"block":"none"})}catch(e){console.warn("CommandLibraryService: filterCommandLibrary failed:",e)}}handleInitialState(e,t){"VFXManagerService"===e&&t&&(console.log("[CommandLibraryService] Received VFX state via late-join:",t),this.updateCombinedAliases().then(()=>{console.log("[CommandLibraryService] Updated combined aliases after VFX late-join"),this.emit("aliases-changed",{aliases:this.cache.combinedAliases})}).catch(e=>{console.error("[CommandLibraryService] Failed to update combined aliases after VFX late-join:",e)}))}onDestroy(){this.ne&&(this.ne.forEach(e=>{"function"==typeof e&&e()}),this.ne=[])}}async function pe(e,t,i={}){if("string"!=typeof e)return console.warn("enrichForDisplay: commandString must be a string, got:",typeof e),ge(e,t);const n=i.eventBus||globalThis.eventBus||c;try{const i=await se(n,"parser:parse-command-string",{commandString:e,options:{generateDisplayText:!0}});if(!i||!i.commands||0===i.commands.length)return ge(e,t);const a=i.commands[0];let s=null;try{s=await se(n,"command:find-definition",{command:e})}catch(e){}const o={command:e,text:a.displayText||e,displayText:a.displayText||e,icon:a.icon||"‚öôÔ∏è",type:a.category||"custom",category:a.category||"custom",parameters:a.parameters||{},signature:a.signature,baseCommand:a.baseCommand,id:a.id||`display_${Date.now()}_${Math.random()}`};if(s&&(o.icon=s.icon||o.icon,o.type=s.categoryId||o.type,o.category=s.categoryId||o.category,s.customizable&&o.parameters?(o.text=function(e,t){if(!e||!t)return e?.name||"Parameterized Command";const{commandId:i,categoryId:n}=e;if("communication"===n||"communication"===i){if(t.verb&&t.message)return`${t.verb}: "${t.message}"`}else if("tray_with_backup"===i){if(void 0!==t.tray&&void 0!==t.slot)return`${e.name} (${t.tray} ${t.slot} ${t.backup_tray??""} ${t.backup_slot??""})`}else if("custom_tray"===i){if(void 0!==t.tray&&void 0!==t.slot)return`${e.name} (${t.tray} ${t.slot})`}else if("target"===i&&t.entityName)return`${e.name}: ${t.entityName}`;return e.name||"Parameterized Command"}(s,o.parameters),o.displayText=o.text):s.name&&(new Set(["custom_tray","tray_with_backup"]).has(s.commandId)||(o.text=s.name,o.displayText=s.name))),t&&"function"==typeof t.t){const e=function(e,t){return t?.translationKey?t.translationKey:e?.baseCommand?`command.${e.baseCommand.toLowerCase()}`:e?.signature?`command.${e.signature.split("(")[0].toLowerCase()}`:null}(a,s);if(e){const i=t.t(e,o.parameters);if(i&&i!==e)if("object"==typeof a.displayText&&a.displayText?.params){const{tray:e,slot:t,backup_tray:n,backup_slot:s}=a.displayText.params;let r="";void 0!==n&&void 0!==s?r=` (${e} ${t} -> ${n} ${s})`:void 0!==e&&void 0!==t&&(r=` (${e} ${t})`),o.text=`${i}${r}`,o.displayText=o.text}else o.text=i,o.displayText=i}}if("object"==typeof o.displayText&&o.displayText&&!("key"in o.displayText)){const t=o.displayText.fallback||o.displayText.text||e;o.displayText=t,o.text=t}return o}catch(i){return console.warn("enrichForDisplay: Failed to parse command:",e,i),ge(e,t)}}function fe(e){return"string"==typeof e?e.trim():e&&"object"==typeof e?(e.command||e.text||"").trim():""}async function ye(e,t={}){const i=fe(e);if(!i)return"";const n=t.eventBus||globalThis.eventBus||c;try{const e=await se(n,"parser:parse-command-string",{commandString:i,options:{generateDisplayText:!1}});if(e?.commands?.[0]){const t=e.commands[0];if(t.signature&&(t.signature.includes("TrayExecByTray")||t.signature.includes("TrayExecByTrayWithBackup"))&&t.parameters){const e=t.parameters,i=void 0!==e.active?e.active:1;if(t.signature.includes("TrayExecByTrayWithBackup")){if(1===i){return`+${(e.baseCommand||"TrayExecByTrayWithBackup").replace(/^\+/,"")} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`}return`${(e.baseCommand||"TrayExecByTrayWithBackup").replace(/^\+/,"")} ${i} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`}if(1===i){return`+${(e.baseCommand||"TrayExecByTray").replace(/^\+/,"")} ${e.tray} ${e.slot}`}return`${(e.baseCommand||"TrayExecByTray").replace(/^\+/,"")} ${i} ${e.tray} ${e.slot}`}}}catch(e){console.warn("normalizeToOptimizedString: Failed to parse command for optimization:",i,e)}return i}function _e(e){if(!Array.isArray(e)){const t=fe(e);return t?[t]:[]}return e.map(fe).filter(e=>e.length>0)}function ge(e,t){const i=String(e||"").trim();return{command:i,text:i||t.t("unknown_command"),displayText:i||t.t("unknown_command"),icon:"‚öôÔ∏è",type:"custom",category:"custom",parameters:{},signature:"UnknownCommand()",baseCommand:"Unknown",id:`fallback_${Date.now()}_${Math.random()}`}}const be={"`":"0x29"},ve={"0x2":"1","0x3":"2","0x4":"3","0x5":"4","0x6":"5","0x7":"6","0x8":"7","0x9":"8","0xa":"9","0xb":"0","0xd":"Equals","0xe":"Backspace","0xf":"Tab","0x10":"Q","0x11":"W","0x12":"E","0x13":"R","0x14":"T","0x15":"Y","0x16":"U","0x17":"I","0x18":"O","0x19":"P","0x1a":"[","0x1b":"]","0x1c":"enter","0x1d":"LCTRL","0x1e":"A","0x1f":"S","0x20":"D","0x21":"F","0x22":"G","0x23":"H","0x24":"J","0x25":"K","0x26":"L","0x29":"`","0x2a":"LSHIFT","0x2b":"\\","0x2c":"Z","0x2d":"X","0x2e":"C","0x2f":"V","0x30":"B","0x31":"N","0x32":"M","0x33":",","0x34":".","0x35":"/","0x36":"RSHIFT","0x37":"Multiply","0x38":"LALT","0x39":"Space","0x3b":"F1","0x3c":"F2","0x3d":"F3","0x3e":"F4","0x3f":"F5","0x40":"F6","0x41":"F7","0x42":"F8","0x43":"F9","0x44":"F10","0x47":"numpad7","0x48":"numpad8","0x49":"numpad9","0x4a":"Subtract","0x4b":"numpad4","0x4c":"numpad5","0x4d":"numpad6","0x4e":"Add","0x4f":"numpad1","0x50":"numpad2","0x51":"numpad3","0x52":"numpad0","0x53":"Decimal","0x57":"F11","0x58":"F12","0x5a":"Joy1","0x5b":"Joy2","0x5c":"Joy3","0x5d":"Joy4","0x5e":"Joy5","0x5f":"Joy6","0x60":"Joy7","0x61":"Joy8","0x62":"Joy9","0x63":"Joy10","0x64":"F13","0x65":"F14","0x66":"F15","0x7f":"Joy11","0x80":"Joy12","0x9c":"numpadenter","0x9d":"RCTRL","0xa5":"Rstick_up","0xa6":"Rstick_down","0xa7":"Rstick_left","0xa8":"Rstick_right","0xb5":"Divide","0xb8":"RALT","0xb9":"Joypad_up","0xba":"Joypad_down","0xbb":"Joypad_left","0xbc":"Joypad_right","0xbd":"Lstick_up","0xbe":"Lstick_down","0xbf":"Lstick_left","0xc0":"Lstick_right","0xc7":"Home","0xc8":"Up","0xc9":"PageUp","0xcb":"Left","0xcd":"Right","0xcf":"End","0xd0":"Down","0xd1":"PageDown","0xd2":"insert","0xd3":"Delete","0xee":"Button1","0xef":"Button2","0xf0":"Button3","0xf1":"Button4","0xf2":"Button5","0xf3":"Button6","0xf4":"Button7","0xf5":"Button8","0xf6":"Wheelminus","0xf7":"Wheelplus","0xf8":"Lclick","0xf9":"Mclick","0xfa":"Rclick","0xfb":"Ldrag","0xfc":"Mdrag","0xfd":"Rdrag","0xfe":"Wheelplus","0xff":"Wheelminus","0x100":"Ldblclick","0x101":"Mdblclick","0x102":"Rdblclick","0x801":"Control","0x802":"Shift","0x803":"ALT"};function we(e){return"string"!=typeof e?e:e.includes("+")?e.split("+").map(e=>{const t=e.trim();return be[t]||t}).join("+"):be[e]||e}function ke(e){return"string"!=typeof e?e:e.includes("+")?e.split("+").map(e=>{const t=e.trim().toLowerCase();return ve[t]||t}).join("+"):ve[e]||e}var Se=Object.freeze({__proto__:null,decodeKeyFromImport:ke,encodeKeyForExport:we});function xe(e,t={},i=!0){let n="";i&&t.description&&(n+=`; ${t.description}\n`);let a=t.commands||"";if(Array.isArray(a)){const e=a.map(e=>"string"==typeof e?e.trim():e&&"string"==typeof e.command?e.command.trim():"").filter(e=>e.length>0);a=e.join(" $$ ")}return n+=`alias ${e} <& ${a} &>\n`,n}function Ce(e,t=[]){const i=we(e);if(Array.isArray(t)&&0===t.length)return`${i} ""\n`;const n=t.map(e=>"string"==typeof e?e.trim():e&&"string"==typeof e.command?e.command.trim():"").filter(e=>e.length>0);return 0===n.length?`${i} ""\n`:`${i} "${n.join(" $$ ")}"\n`}class Te extends re{constructor({storage:e,eventBus:t,i18n:i,profileService:n=null,modalManager:a=null}){super(t),this.componentName="CommandService",this.i18n=i,this.ne=[],this.eventBus&&this.ne.push(this.respond("command:add",async({command:e,key:t,position:i,bindset:n})=>this.addCommand(t,e,n||i)),this.respond("command:edit",async({key:e,index:t,updatedCommand:i,bindset:n})=>this.editCommand(e,t,i,n)),this.respond("command:validate",({command:e})=>this.validateCommand(e)),this.respond("command:delete",async({key:e,index:t,bindset:i})=>this.deleteCommand(e,t,i)),this.respond("command:move",async({key:e,fromIndex:t,toIndex:i,bindset:n})=>this.moveCommand(e,t,i,n)),this.respond("command:get-for-selected-key",this.getCommandsForSelectedKey.bind(this)),this.respond("command:get-empty-state-info",async()=>await this.getEmptyStateInfo()),this.respond("command:check-environment-compatibility",({command:e,environment:t})=>this.isCommandCompatible(e,t)),this.respond("command:get-import-sources",({environment:e,currentKey:t})=>this.getImportSources(e,t)),this.respond("command:import-from-source",({sourceValue:e,targetKey:t,clearDestination:i,currentEnvironment:n})=>this.importFromSource(e,t,i,n)),this.respond("command:generate-command-preview",({key:e,commands:t,stabilize:i=!1})=>this.generateCommandPreview(e,t,i)),this.respond("command:generate-mirrored-commands",async({commands:e=[]})=>this.generateMirroredCommands(e)))}onInit(){this.setupEventListeners()}getCurrentProfile(){return this.cache.currentProfile?this.getCurrentBuild(this.cache.profile):null}getCurrentBuild(e){if(!e)return null;const t=this.cache.builds||{space:{keys:{}},ground:{keys:{}}};return t[this.cache.currentEnvironment]||(t[this.cache.currentEnvironment]={keys:{}}),t[this.cache.currentEnvironment].keys||(t[this.cache.currentEnvironment].keys={}),{...e,keys:t[this.cache.currentEnvironment].keys,aliases:this.cache.aliases||{}}}async addCommand(e,t,i=null){const n=this.getCurrentProfile();if(!n)return this.ui?.showToast?.(this.i18n.t("no_valid_profile"),"error"),!1;const a=i&&"Primary Bindset"!==i&&"alias"!==this.cache.currentEnvironment,s=this.cache.aliases&&this.cache.aliases[e];let o=[];s&&Array.isArray(s.commands)&&(o=[...s.commands]);const r=(Array.isArray(t)?_e(t):[fe(t)]).filter(e=>e.length>0);if(0===r.length)return console.warn("CommandService: No valid commands to add"),!1;o.push(...r);let c=[];c=a?n.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];const l=[...c,...r];try{const s={};if("alias"===this.cache.currentEnvironment)console.log("[CommandService] addCommand: alias"),n.aliases?.[e]?s.modify={aliases:{[e]:{...n.aliases[e]||{},commands:o}}}:s.add={aliases:{[e]:{commands:o,description:"",type:"alias"}}};else if(a){const t=!!n.bindsets?.[i],a=!!n.bindsets?.[i]?.[this.cache.currentEnvironment],o=n.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys||{};t&&a?s.modify={bindsets:{[i]:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}}}:s.add={bindsets:{[i]:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}}},console.log("[CommandService] addCommand: bindset update",{bindset:i,environment:this.cache.currentEnvironment,key:e,bindsetExists:t,envExists:a,ops:s,currentKeys:o,profileBindsets:n.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys})}else n.builds?.[this.cache.currentEnvironment]?.keys?.[e]?s.modify={builds:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}}:s.add={builds:{[this.cache.currentEnvironment]:{keys:{[e]:l}}}};return await this.request("data:update-profile",{profileId:this.cache.currentProfile,...s}),this.emit("command-added",{key:e,command:t}),!0}catch(e){return console.error("Failed to add command:",e),this.ui?.showToast?.("Failed to add command","error"),!1}}async deleteCommand(e,t,i=null){const n=i&&"Primary Bindset"!==i&&"alias"!==this.cache.currentEnvironment,a=this.getCurrentProfile();if(!a)return!1;if(!e||void 0===t)return!1;let s=null,o=null;if("alias"===this.cache.currentEnvironment||this.cache.aliases&&Object.prototype.hasOwnProperty.call(this.cache.aliases,e)){const i=this.cache.aliases[e];if(!i||!Array.isArray(i.commands))return!1;const n=[...i.commands];if(t<0||t>=n.length)return!1;n.splice(t,1),o=[...n],s={modify:{aliases:{[e]:{...i,commands:n}}}}}else{const r=n?a.bindsets?.[i]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];if(!r[t])return!1;const c=[...r];c.splice(t,1),o=[...c],s=n?{modify:{bindsets:{[i]:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}:{modify:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}if(!s)return!1;try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,...s}),this.emit("command-deleted",{key:e,index:t,commands:o}),!0}catch(e){return console.error("Failed to delete command:",e),this.ui?.showToast?.("Failed to delete command","error"),!1}}async moveCommand(e,t,i,n=null){const a=n&&"Primary Bindset"!==n&&"alias"!==this.cache.currentEnvironment,s=this.getCurrentProfile();if(!s)return!1;let o=null;if("alias"===this.cache.currentEnvironment){const n=this.cache.aliases&&this.cache.aliases[e];if(!n||!Array.isArray(n.commands))return!1;const a=[...n.commands];if(t<0||t>=a.length||i<0||i>=a.length)return!1;const[s]=a.splice(t,1);a.splice(i,0,s),o={modify:{aliases:{[e]:{...n,commands:a}}}}}else{const r=a?s.bindsets?.[n]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];if(t<0||t>=r.length||i<0||i>=r.length)return!1;const c=[...r],[l]=c.splice(t,1);c.splice(i,0,l),o=a?{modify:{bindsets:{[n]:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}:{modify:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}try{await this.request("data:update-profile",{profileId:this.cache.currentProfile,...o});const a=await this.fetchCommandsForKey(e,n);return this.emit("command-moved",{key:e,fromIndex:t,toIndex:i,commands:a}),!0}catch(e){return console.error("Failed to move command:",e),!1}}async editCommand(e,t,i,n=null){if(console.log("[CommandService] editCommand called with:",{key:e,index:t,updatedCommand:i}),!e||void 0===t||!i)return console.warn("CommandService: Cannot edit command - missing key, index, or updated command"),!1;const a=n&&"Primary Bindset"!==n&&"alias"!==this.cache.currentEnvironment,s=this.getCurrentProfile();if(!s)return this.ui?.showToast?.("No valid profile","error"),!1;let o=null;if("alias"===this.cache.currentEnvironment){const n=this.cache.aliases[e];if(!n||!Array.isArray(n.commands))return!1;const a=[...n.commands];if(t<0||t>=a.length)return!1;const s=fe(i);a[t]=s,o={modify:{aliases:{[e]:{...n,commands:a}}}}}else{const r=a?s.bindsets?.[n]?.[this.cache.currentEnvironment]?.keys?.[e]||[]:this.cache.keys[e]||[];if(t<0||t>=r.length)return!1;const c=[...r];c[t]=fe(i),o=a?{modify:{bindsets:{[n]:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}:{modify:{builds:{[this.cache.currentEnvironment]:{keys:{[e]:c}}}}}}console.log("[CommandService] editCommand updates:",o);try{await this.request("data:update-profile",{profileId:this.cache.currentProfile,...o}),console.log("[CommandService] editCommand completed successfully");const a=await this.fetchCommandsForKey(e,n);return this.emit("command-edited",{key:e,index:t,updatedCommand:i,commands:a}),!0}catch(e){return console.error("Failed to edit command:",e),this.ui?.showToast?.("Failed to update command","error"),!1}}setupEventListeners(){this.addEventListener("command:add",async e=>{console.log("[CommandService] command:add received:",e);const{command:t,key:i,bindset:n}=e;console.log("[CommandService] extracted:",{command:t,key:i,bindset:n});const a=await this.addCommand(i,t,n);console.log("[CommandService] addCommand result:",a)}),this.addEventListener("command:edit",async e=>{console.log("[CommandService] command:edit received:",e);const{key:t,index:i,updatedCommand:n,bindset:a=null}=e;console.log("[CommandService] extracted:",{key:t,index:i,updatedCommand:n,bindset:a});const s=await this.editCommand(t,i,n,a);console.log("[CommandService] editCommand result:",s)}),this.addEventListener("bindset-selector:active-changed",({bindset:e})=>{console.log("[CommandService] bindset-selector:active-changed received:",e)}),this.addEventListener("key-selected",({key:e,name:t})=>{const i=e||t;console.log("[CommandService] key-selected received:",i)})}validateCommand(e){return e?{valid:!0}:{valid:!1,reason:"empty"}}onDestroy(){this.ne&&(this.ne.forEach(e=>{"function"==typeof e&&e()}),this.ne=[])}async fetchCommandsForKey(e,t=null){try{if("alias"===this.cache.currentEnvironment)return this.getCommandsForSelectedKey({key:e});if(t&&"Primary Bindset"!==t){const i=await this.request("bindset:get-key-commands",{bindset:t,environment:this.cache.currentEnvironment,key:e});return Array.isArray(i)?i:[]}return await this.request("data:get-key-commands",{environment:this.cache.currentEnvironment,key:e})}catch{return[]}}async getEmptyStateInfo(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(console.log("[CommandService] getEmptyStateInfo DEBUG:",{currentEnvironment:this.cache.currentEnvironment,selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,resolvedSelectedKey:e}),!e)return{title:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_edit"):this.i18n.t("select_a_key_to_edit"),preview:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_see_the_generated_command"):this.i18n.t("select_a_key_to_see_the_generated_command"),icon:"alias"===this.cache.currentEnvironment?"fas fa-mask":"fas fa-keyboard",emptyTitle:"alias"===this.cache.currentEnvironment?this.i18n.t("no_alias_selected"):this.i18n.t("no_key_selected"),emptyDesc:"alias"===this.cache.currentEnvironment?this.i18n.t("select_alias_from_left_panel"):this.i18n.t("select_key_from_left_panel"),commandCount:"0"};const t=await this.getCommandsForSelectedKey(),i=e=>{if("string"!=typeof e)return e;const t=document.createElement("textarea");return t.innerHTML=e,t.value},n="alias"===this.cache.currentEnvironment?i(this.i18n.t("alias_chain")):i(this.i18n.t("command_chain"));let a=!1;if(e&&(a="alias"===this.cache.currentEnvironment?!(this.cache.aliases&&this.cache.aliases[e]):!this.validateKeyExistsInCurrentContext(e)),a)return console.log(`[CommandService] Detected stale selection "${e}" in environment ${this.cache.currentEnvironment} - treating as no selection`),{title:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_edit"):this.i18n.t("select_a_key_to_edit"),preview:"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_see_the_generated_command"):this.i18n.t("select_a_key_to_see_the_generated_command"),icon:"alias"===this.cache.currentEnvironment?"fas fa-mask":"fas fa-keyboard",emptyTitle:"alias"===this.cache.currentEnvironment?this.i18n.t("no_alias_selected"):this.i18n.t("no_key_selected"),emptyDesc:"alias"===this.cache.currentEnvironment?this.i18n.t("select_alias_from_left_panel"):this.i18n.t("select_key_from_left_panel"),commandCount:"0"};if(0===t.length){const t="alias"===this.cache.currentEnvironment?`${this.i18n.t("click_add_command_to_start_building_your_alias_chain")} ${e}.`:`${this.i18n.t("click_add_command_to_start_building_your_command_chain")} ${e}.`;return{title:i(this.i18n.t("chain_for_key",{chainType:n,key:e})),preview:await this.getCommandChainPreview(),icon:"fas fa-plus-circle",emptyTitle:this.i18n.t("no_commands"),emptyDesc:t,commandCount:"0"}}return{title:i(this.i18n.t("chain_for_key",{chainType:n,key:e})),preview:await this.getCommandChainPreview(),commandCount:t.length.toString()}}validateKeyExistsInCurrentContext(e){if(!e)return!1;if(this.cache.keys&&void 0!==this.cache.keys[e])return!0;if(this.cache.activeBindset&&"Primary Bindset"!==this.cache.activeBindset&&this.cache.profile){const t=void 0!==this.cache.profile.bindsets?.[this.cache.activeBindset]?.[this.cache.currentEnvironment]?.keys?.[e];return console.log(`[CommandService] validateKeyExistsInCurrentContext: key "${e}" in bindset "${this.cache.activeBindset}" -> ${t}`),t}return!1}async getCommandsForSelectedKey(e={}){console.log("[CommandService] getCommandsForSelectedKey called with params:",e),console.log("[CommandService] Current state:",{currentEnvironment:this.cache.currentEnvironment,selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,cache:this.cache}),this.cache||(console.warn("[CommandService] Cache not initialized, initializing empty cache"),this.cache={});const t=e.environment||this.cache.currentEnvironment||"space";let i=e.key;if(!i&&(i="alias"===t?this.cache.selectedAlias:this.cache.selectedKey,!i))return console.warn("[CommandService] No key/alias selected for environment:",t),[];if(!i)return[];const n=this.cache.profile;if(!n)return console.warn("[CommandService] No profile in cache"),[];if("alias"===t){const e=n.aliases&&n.aliases[i];return e&&Array.isArray(e.commands)?[...e.commands]:[]}if(!0===this.cache.preferences?.bindsetsEnabled&&this.cache.activeBindset&&"Primary Bindset"!==this.cache.activeBindset){const e=await this.request("bindset:get-key-commands",{bindset:this.cache.activeBindset,environment:t,key:i});if(console.log("[CommandService] Using active bindset via service lookup:",this.cache.activeBindset,"commands:",e),Array.isArray(e))return[...e];console.warn("[CommandService] Active bindset missing commands for key; falling back to Primary Bindset")}const a=this.cache.keys&&this.cache.keys[i]?this.cache.keys[i]:[];return Array.isArray(a)?[...a]:[]}async getCommandChainPreview(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(console.log("[CommandService] getCommandChainPreview DEBUG:",{currentEnvironment:this.cache.currentEnvironment,selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,resolvedSelectedKey:e}),!e)return"alias"===this.cache.currentEnvironment?this.i18n.t("select_an_alias_to_see_the_generated_command"):this.i18n.t("select_a_key_to_see_the_generated_command");const t=await this.getCommandsForSelectedKey();if(0===t.length)return"alias"===this.cache.currentEnvironment?xe(e,{commands:""}).trim():`${e} ""`;if("alias"===this.cache.currentEnvironment){const i=this.getCurrentProfile();console.log("[CommandLibraryService] alias : getCommandChainPreview: profile",i);let n,a=!1;return i&&i.aliasMetadata&&i.aliasMetadata[e]&&i.aliasMetadata[e].stabilizeExecutionOrder&&(a=!0),n=a&&t.length>1?await this.generateMirroredCommandString(t):(await this.normalizeCommandsForDisplay(t)).join(" $$ "),xe(e,{commands:n}).trim()}{const i=this.getCurrentProfile();console.log("[CommandLibraryService] keybind : getCommandChainPreview: profile",i);let n,a=!1;return i&&i.keybindMetadata&&i.keybindMetadata[this.cache.currentEnvironment]&&i.keybindMetadata[this.cache.currentEnvironment][e]&&i.keybindMetadata[this.cache.currentEnvironment][e].stabilizeExecutionOrder&&(a=!0),n=a&&t.length>1?await this.generateMirroredCommandString(t):(await this.normalizeCommandsForDisplay(t)).join(" $$ "),`${e} "${n}"`}}async normalizeCommandsForDisplay(e){const t=[];for(const i of e){const e="string"==typeof i?i:i&&i.command||"";if(e)try{const i=await this.request("parser:parse-command-string",{commandString:e,options:{generateDisplayText:!1}});if(i.commands&&i.commands[0]){const n=i.commands[0];if(n.signature&&(n.signature.includes("TrayExecByTray")||n.signature.includes("TrayExecByTrayWithBackup"))&&n.parameters){const e=n.parameters,i=void 0!==e.active?e.active:1;if(n.signature.includes("TrayExecByTrayWithBackup")){const n=(e.baseCommand||"TrayExecByTrayWithBackup").replace(/^\+/,"");1===i?t.push(`+${n} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`):t.push(`${n} ${i} ${e.tray} ${e.slot} ${e.backup_tray} ${e.backup_slot}`)}else{const n=(e.baseCommand||"TrayExecByTray").replace(/^\+/,"");1===i?t.push(`+${n} ${e.tray} ${e.slot}`):t.push(`${n} ${i} ${e.tray} ${e.slot}`)}}else t.push(e)}else t.push(e)}catch(i){console.warn("[CommandLibraryService] Failed to normalize command for display:",e,i),t.push(e)}}return t}async generateMirroredCommandString(e){return await this.generateMirroredCommands(e)}async generateMirroredCommands(e=[]){if(!Array.isArray(e)||0===e.length)return"";const t=e.map(e=>"string"==typeof e?{command:e}:e&&"string"==typeof e.command?e:null).filter(Boolean);if(t.length<=1)return(await this.normalizeCommandsForDisplay(t)).join(" $$ ");const i=[],n=[],a=[];t.forEach(e=>{const t=e.command,s=t.match(/^(?:\+)?TrayExecByTray/),o=!1===e.palindromicGeneration;s?o?"in-pivot-group"===e.placement?a.push(t):i.push(t):n.push(t):i.push(t)});let s=[],o=n;a.length>0?s=a:n.length>0&&(s=[n[n.length-1]],o=n.slice(0,-1));const r=[...o].reverse(),c=[...i,...o,...s,...r];return(await this.normalizeCommandsForDisplay(c.map(e=>({command:e})))).join(" $$ ")}generateCommandPreview(e,t,i=!1){if(!Array.isArray(t)||0===t.length)return`${e} ""`;let n;if(i&&t.length>1){const e=t.map(e=>"string"==typeof e?e:e.command);n=[...e,...e.slice(0,-1).reverse()].join(" $$ ")}else n=t.map(e=>e.command||e).join(" $$ ");return`${e} "${n}"`}async isCommandCompatible(e,t){if(!e)return console.warn("isCommandCompatible called with undefined commandName"),!0;try{const i=await this.request("data:find-command-by-name",{command:e});return!i||!i.environment||i.environment===t}catch(t){return console.warn(`CommandService: Could not check compatibility for command "${e}":`,t),!0}}async getImportSources(e,t){const i=[];try{if("alias"===e){const e=await this.request("data:get-keys",{environment:"space"})||{};Object.keys(e).forEach(t=>{Object.keys(e[t]||{}).length>0&&i.push({value:`space:${t}`,label:`Space: ${t}`,type:"key"})});const n=await this.request("data:get-keys",{environment:"ground"})||{};Object.keys(n).forEach(e=>{Object.keys(n[e]||{}).length>0&&i.push({value:`ground:${e}`,label:`Ground: ${e}`,type:"key"})});const a=await this.request("alias:get-all")||{};Object.keys(a).forEach(e=>{e!==t&&a[e]?.commands&&i.push({value:`alias:${e}`,label:`Alias: ${e}`,type:"alias"})})}else{const n=await this.request("data:get-keys",{environment:"space"})||{};Object.keys(n).forEach(a=>{("space"!==e||a!==t)&&Object.keys(n[a]||{}).length>0&&i.push({value:`space:${a}`,label:`Space: ${a}`,type:"key"})});const a=await this.request("data:get-keys",{environment:"ground"})||{};Object.keys(a).forEach(n=>{("ground"!==e||n!==t)&&Object.keys(a[n]||{}).length>0&&i.push({value:`ground:${n}`,label:`Ground: ${n}`,type:"key"})});const s=await this.request("alias:get-all")||{};Object.keys(s).forEach(e=>{s[e]?.commands&&i.push({value:`alias:${e}`,label:`Alias: ${e}`,type:"alias"})})}return i}catch(e){return console.error("CommandService: Failed to get import sources:",e),[]}}async importFromSource(e,t,i,n){if(!e||!t)throw new Error("Source and target are required for import");try{const[a,s]=e.split(":");let o=[];if("alias"===a){const e=(await this.request("alias:get-all")||{})[s];if(e&&e.commands){let t;t=Array.isArray(e.commands)?e.commands.join(" $$ "):e.commands,t&&t.trim()&&(o=(await this.request("parser:parse-command-string",{commandString:t})).commands||[])}}else o=await this.request("data:get-key-commands",{environment:a,key:s})||[];if(0===o.length)throw new Error("Source has no commands to import");let r=o,c=0;if("alias"!==n&&"alias"!==a&&a!==n){const e=o.length,t=o.map(async e=>({command:e,isCompatible:await this.isCommandCompatible(e,n)}));r=(await Promise.all(t)).filter(e=>e.isCompatible).map(e=>e.command),c=e-r.length}if(0===r.length)throw new Error("No compatible commands found for import");i&&await this.request("data:clear-key-commands",{environment:n,key:t});for(const e of r)await this.addCommand(t,e);return{success:!0,importedCount:r.length,droppedCount:c,sourceType:a,sourceName:s}}catch(e){throw console.error("CommandService: Failed to import from source:",e),e}}}class Be extends re{constructor({eventBus:e,storage:t,app:i}){super(e),this.componentName="InterfaceModeService",this.storage=t,this.app=i,this.ae="space",this.se=!1,this.oe=null,this.re=null,this.eventBus&&(this.re=this.respond("environment:switch",async({mode:e}={})=>e?(await this.switchMode(e),{success:!0,mode:this.ae}):{success:!1,error:"No mode provided"}))}onInit(){this.setupEventListeners()}get currentMode(){return this.ae}set currentMode(e){this.switchMode(e).catch(e=>{console.error("[InterfaceModeService] Error in currentMode setter:",e)})}get currentEnvironment(){return this.ae}set currentEnvironment(e){this.switchMode(e).catch(e=>{console.error("[InterfaceModeService] Error in currentEnvironment setter:",e)})}setupEventListeners(){this.se||(this.oe=e=>{e.profileId&&"undefined"!=typeof window&&console.log(`[InterfaceModeService] Profile switched to: ${e.profileId}`),e.environment&&this.switchMode(e.environment).catch(e=>{console.error("[InterfaceModeService] Error in profile switched handler:",e)})},this.eventBus.on("profile:switched",this.oe),this.se=!0)}async switchMode(e){if(e===this.ae)return;"undefined"!=typeof window&&console.log(`[InterfaceModeService] switchMode from ${this.ae} to ${e}`);const t=this.ae;this.ae=e;try{await this.updateProfileMode(e)}catch(e){console.error("[InterfaceModeService] Failed to persist environment change:",e)}this.emit("environment:changed",{environment:e,toEnvironment:e,fromEnvironment:t},{synchronous:!0})}async updateProfileMode(e){if(this.cache.currentProfile){console.log(`[InterfaceModeService] updateProfileMode called with mode: ${e}`),console.log(`[InterfaceModeService] Current profile ID: ${this.cache.currentProfile}`);try{const t=await this.request("data:update-profile",{profileId:this.cache.currentProfile,properties:{currentEnvironment:e}});t?.success?console.log(`[InterfaceModeService] Environment persisted to storage: ${e} for profile: ${this.cache.currentProfile}`):console.error("[InterfaceModeService] Failed to persist environment:",t)}catch(e){console.error("[InterfaceModeService] Error updating profile mode:",e)}}else console.warn("[InterfaceModeService] Cannot update profile mode: no current profile ID")}onDestroy(){this.se&&(this.eventBus.off("profile:switched",this.oe),this.se=!1),this.re&&(this.re(),this.re=null)}getCurrentState(){return{currentMode:this.ae,environment:this.ae,currentEnvironment:this.ae}}handleInitialState(e,t){if(t&&"DataCoordinator"===e){const e=t.currentEnvironment||t.currentProfileData&&t.currentProfileData.currentEnvironment;if(e){const t=this.ae;this.ae=e,t!==this.ae&&this.emit("environment:changed",{environment:this.ae,isInitialization:!0},{synchronous:!0})}}}}const $e="sync-folder";class Ee extends re{constructor({dbName:e="sto-sync-handles",storeName:t="directories",eventBus:i}={}){super(i),this.componentName="FileSystemService",this.dbName=e,this.storeName=t}openDB(){return new Promise((e,t)=>{const i=indexedDB.open(this.dbName,1);i.onupgradeneeded=()=>{i.result.createObjectStore(this.storeName)},i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)})}async saveDirectoryHandle(e,t){const i=await this.openDB(),n=i.transaction(this.storeName,"readwrite");n.objectStore(this.storeName).put(t,e),await new Promise((e,t)=>{n.oncomplete=()=>e(),n.onerror=()=>t(n.error),n.onabort=()=>t(n.error)}),i.close()}async getDirectoryHandle(e){const t=await this.openDB(),i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e),n=await new Promise((e,t)=>{i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)});return t.close(),n||null}async writeFile(e,t,i){const n=t.split("/"),a=n.pop();let s=e;for(const e of n)s=await s.getDirectoryHandle(e,{create:!0});const o=await s.getFileHandle(a,{create:!0}),r=await o.createWritable();await r.write(i),await r.close()}static#e=null;static ce(){return this.#e||(this.#e=new Ee),this.#e}static saveDirectoryHandle(e,t){return this.ce().saveDirectoryHandle(e,t)}static getDirectoryHandle(e){return this.ce().getDirectoryHandle(e)}static writeFile(e,t,i){return this.ce().writeFile(e,t,i)}}const Ie=(...e)=>Ee.writeFile(...e);class Ae extends re{constructor({eventBus:e,storage:t,ui:i,fs:n,i18n:a}={}){super(e),this.componentName="SyncService",this.storage=t,this.ui=i,this.i18n=a,this.fs=n||new Ee({eventBus:e}),this.awaitingSyncDecisionApply=!1,this.pendingSyncAction=null,this.deferredImportContent=null,console.log("[SyncService] constructed"),this.invokeRequest=this.request.bind(this),this.fs||(this.fs=new Ee({eventBus:e})),this.eventBus&&(this.respond("sync:sync-project",({source:e}={})=>this.syncProject(e)),this.addEventListener("preferences:saved",async()=>{if(console.log("[SyncService] preferences:saved received",{awaiting:this.awaitingSyncDecisionApply,pending:this.pendingSyncAction}),this.awaitingSyncDecisionApply)try{const e=await this.getSyncFolderHandle();if(!e)return;const t=this.pendingSyncAction;if(console.log("[SyncService] applying pending action",{action:t}),"import"===t)try{let t,i;if(this.deferredImportContent&&this.deferredImportContent.content)t=this.deferredImportContent.content,i=this.deferredImportContent.fileName||"project.json";else{const n=await e.getFileHandle("project.json",{create:!1}),a=await n.getFile();t=await a.text(),i="project.json"}try{console.log("[SyncService] invoking project:restore-from-content",{size:t?.length});const e=await this.invokeRequest("project:restore-from-content",{content:t,fileName:i});if(console.log("[SyncService] project:restore-from-content result",e),e?.success)this.deferredImportContent=null,this.ui?.showToast(this.i18n.t("project_imported_from_sync_folder"),"success");else{const t=e?.error||"Unknown error";this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:t}),"error")}}catch(e){this.deferredImportContent={content:t,fileName:i},console.log("[SyncService] deferring import until sto-app-ready")}}catch(e){this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:e.message}),"error")}else if("overwrite"===t)try{await this.invokeRequest("export:sync-to-folder",{dirHandle:e}),console.log("[SyncService] overwrite: export:sync-to-folder completed"),this.ui?.showToast(this.i18n.t("project_synced_successfully"),"success")}catch(e){this.ui?.showToast(this.i18n.t("failed_to_sync_project",{error:e.message}),"error")}}finally{this.pendingSyncAction=null,this.awaitingSyncDecisionApply=!1,console.log("[SyncService] cleared pending action and awaiting flag")}}),this.addEventListener("modal:hidden",({modalId:e})=>{console.log("[SyncService] modal:hidden received",{modalId:e,awaiting:this.awaitingSyncDecisionApply,pending:this.pendingSyncAction}),"preferencesModal"===e&&setTimeout(()=>{this.awaitingSyncDecisionApply&&(this.pendingSyncAction=null,this.awaitingSyncDecisionApply=!1,console.log("[SyncService] preferences modal closed without save; pending cleared (deferred)"))},0)}),this.addEventListener("sto-app-ready",async()=>{if(console.log("[SyncService] sto-app-ready received; checking deferred import",{hasDeferred:!!this.deferredImportContent}),!this.deferredImportContent)return;const{content:e,fileName:t}=this.deferredImportContent;this.deferredImportContent=null;try{const i=await this.invokeRequest("project:restore-from-content",{content:e,fileName:t});if(console.log("[SyncService] deferred project:restore-from-content result",i),!i?.success){const e=i?.error||"Unknown error";this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:e}),"error")}}catch(e){this.ui?.showToast(this.i18n.t("failed_to_import_project",{error:e.message}),"error")}}))}isFirefox(){return"undefined"!=typeof navigator&&/firefox/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent)}isSecureContext(){if("undefined"==typeof window)return!1;if(void 0!==window.isSecureContext)return window.isSecureContext;const e=window.location?.protocol,t=window.location?.hostname;return"https:"===e||"file:"===e||"chrome-extension:"===e||"localhost"===t||"127.0.0.1"===t||t&&t.endsWith(".localhost")}async setSyncFolder(e=!1){try{let t,i;if(console.log("[SyncService] setSyncFolder called",{autoSync:e}),this.isFirefox())return this.ui?.showToast(this.i18n.t("sync_not_supported_firefox"),"error"),"undefined"!=typeof window&&window.confirmDialog&&window.confirmDialog.inform&&await window.confirmDialog.inform(this.i18n.t("sync_not_supported_detailed"),this.i18n.t("sync_not_supported_title"),"info","syncNotSupported"),null;if(!this.isSecureContext())return this.ui?.showToast(this.i18n.t("sync_not_supported_secure_context"),"error"),"undefined"!=typeof window&&window.confirmDialog&&window.confirmDialog.inform&&await window.confirmDialog.inform(this.i18n.t("sync_not_supported_secure_context_detailed"),this.i18n.t("sync_not_supported_secure_context_title"),"info","syncSecureContext"),null;if(!("showDirectoryPicker"in window))return this.ui?.showToast(this.i18n.t("sync_not_supported_browser"),"error"),"undefined"!=typeof window&&window.confirmDialog&&window.confirmDialog.inform&&await window.confirmDialog.inform(this.i18n.t("sync_not_supported_browser_detailed"),this.i18n.t("sync_not_supported_browser_title"),"info","syncNotSupportedBrowser"),null;if(t=await window.showDirectoryPicker(),await this.fs.saveDirectoryHandle($e,t),i=t.name,console.log("[SyncService] setSyncFolder: directory selected",{folderName:i}),this.storage){const n=this.storage.getSettings();n.syncFolderName=i,n.syncFolderPath=`Selected folder: ${i}`,n.syncFolderFallback=!1,n.autoSync=e;try{const e=await t.getFileHandle("project.json",{create:!1});if(e&&"undefined"!=typeof window&&window.confirmDialog?.confirm){const t=await e.getFile(),i=await t.text(),n=this.i18n.t("sync_folder_contains_project_title"),a=this.i18n.t("sync_folder_contains_project_prompt"),s=await window.confirmDialog.confirm(a,n,"warning","syncImportProject");let o=null;if(s)o="import",console.log("[SyncService] setSyncFolder: user chose IMPORT"),this.deferredImportContent={content:i,fileName:"project.json"};else{const e=this.i18n.t("sync_overwrite_existing_title"),t=this.i18n.t("sync_overwrite_existing_prompt");await window.confirmDialog.confirm(t,e,"warning","syncOverwriteProject")?(o="overwrite",console.log("[SyncService] setSyncFolder: user chose OVERWRITE")):(this.ui?.showToast(this.i18n.t("sync_operation_cancelled"),"info"),console.log("[SyncService] setSyncFolder: user CANCELLED"))}o&&(this.pendingSyncAction=o,this.awaitingSyncDecisionApply=!0,console.log("[SyncService] setSyncFolder: pending action recorded",{pending:o}))}}catch(e){console.log("[SyncService] setSyncFolder: no existing project.json found")}this.storage.saveSettings(n),console.log("[SyncService] setSyncFolder: settings saved")}return this.pendingSyncAction||this.ui?.showToast(this.i18n.t("sync_folder_set"),"success"),await this.emit("sync:folder-set",{handle:t},{synchronous:!0}),t}catch(e){return"AbortError"!==e?.name&&this.ui?.showToast(this.i18n.t("failed_to_set_sync_folder",{error:e.message}),"error"),null}}async getSyncFolderHandle(){try{return await this.fs.getDirectoryHandle($e)}catch(e){return console.error("[SyncService] getSyncFolderHandle failed",e),null}}async ensurePermission(e){if(!e)return!1;try{const t={mode:"readwrite"};return"granted"===await e.queryPermission(t)||"granted"===await e.requestPermission(t)}catch(e){return console.error("[SyncService] ensurePermission failed",e),!1}}async syncProject(e="auto"){if(console.log("[SyncService] syncProject called",{source:e}),this.isFirefox())return void this.ui?.showToast(this.i18n.t("sync_not_supported_firefox"),"warning");if(!this.isSecureContext())return void this.ui?.showToast(this.i18n.t("sync_not_supported_secure_context"),"warning");const t=await this.getSyncFolderHandle();if(t)if(await this.ensurePermission(t))try{await this.invokeRequest("export:sync-to-folder",{dirHandle:t}),console.log("[SyncService] export:sync-to-folder completed");const i=this.storage?.getSettings()||{},n=i.autoSync,a=i.autoSyncInterval||"change";("manual"===e||"auto"===e&&!(n&&"change"===a))&&this.ui?.showToast(this.i18n.t("project_synced_successfully"),"success"),await this.emit("project-synced",null,{synchronous:!0})}catch(e){this.ui?.showToast(this.i18n.t("failed_to_sync_project",{error:e.message}),"error")}else this.ui?.showToast(this.i18n.t("permission_denied_to_folder"),"error");else this.ui?.showToast(this.i18n.t("no_sync_folder_selected"),"warning")}}class Fe extends re{constructor({eventBus:e,i18n:t,ui:i}={}){super(e),this.componentName="KeyService",this.i18n=t,this.ui=i,this.initializeCache(),this.validKeys=this.generateValidKeys(),this.eventBus&&(this.respond("key:add",({key:e,bindset:t}={})=>this.addKey(e,t)),this.respond("key:delete",({key:e}={})=>this.deleteKey(e)),this.respond("key:duplicate",({key:e}={})=>this.duplicateKey(e)),this.respond("key:duplicate-with-name",({sourceKey:e,newKey:t}={})=>this.duplicateKeyWithName(e,t)))}setupEventListeners(){this.eventBus&&(this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profile:e})=>{this.updateCacheFromProfile(e)}),this.addEventListener("environment:changed",()=>{}))}updateCacheFromProfile(e){e&&console.log("[KeyService] Profile updated - ComponentBase handles caching automatically")}async addKey(e,t=null){if(!await this.isValidKeyName(e))return{success:!1,error:"invalid_key_name",params:{keyName:e}};if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};const i=this.cache.currentEnvironment,n=t&&"Primary Bindset"!==t?t:null,a=this.cache.profile;if(n){if((a?.bindsets?.[n]?.[i]?.keys||{})[e])return{success:!1,error:"key_already_exists",params:{keyName:e}}}else if(this.cache.keys[e])return{success:!1,error:"key_already_exists",params:{keyName:e}};try{return await this.request("selection:select-key",{keyName:e,environment:i,bindset:n,skipPersistence:!0}),n?(await this.request("data:update-profile",{profileId:this.cache.currentProfile,updates:{modify:{bindsets:{[n]:{[i]:{keys:{[e]:[]}}}}}}}),this.cache.profile=this.cache.profile||{},this.cache.profile.bindsets=this.cache.profile.bindsets||{},this.cache.profile.bindsets[n]||(this.cache.profile.bindsets[n]={space:{keys:{}},ground:{keys:{}}}),this.cache.profile.bindsets[n][i]||(this.cache.profile.bindsets[n][i]={keys:{}}),this.cache.profile.bindsets[n][i].keys[e]=[]):(await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{builds:{[i]:{keys:{[e]:[]}}}}}),this.cache.keys[e]=[],this.cache.profile?.builds?.[i]?.keys&&(this.cache.profile.builds[i].keys[e]=[])),this.emit("key-added",{key:e}),{success:!0,key:e,environment:i,bindset:n||"Primary Bindset"}}catch(e){return console.error("[KeyService] Failed to add key:",e),{success:!1,error:"failed_to_add_key"}}}async deleteKey(e){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!this.cache.keys[e])return{success:!1,error:"key_not_found",params:{keyName:e}};try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,delete:{builds:{[this.cache.currentEnvironment]:{keys:[e]}}}}),this.emit("key-deleted",{keyName:e}),{success:!0,key:e,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to delete key:",e),{success:!1,error:"failed_to_delete_key"}}}async duplicateKey(e){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!this.cache.keys[e])return{success:!1,error:"key_not_found",params:{keyName:e}};const t=this.cache.keys[e];if(!t||0===t.length)return{success:!1,error:"failed_to_duplicate_key"};try{let i=`${e}_copy`,n=1;for(;this.cache.keys[i];)i=`${e}_copy_${n}`,n++;const a=t.map(e=>({...e,id:this.generateKeyId()}));return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{builds:{[this.cache.currentEnvironment]:{keys:{[i]:a}}}}}),this.emit("key-duplicated",{from:e,to:i}),{success:!0,sourceKey:e,newKey:i,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to duplicate key:",e),{success:!1,error:"failed_to_duplicate_key"}}}async duplicateKeyWithName(e,t){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!e||"string"!=typeof e)return{success:!1,error:"failed_to_duplicate_key"};if(!t||"string"!=typeof t)return{success:!1,error:"invalid_key_name",params:{keyName:t||""}};if(!this.cache.keys[e])return{success:!1,error:"key_not_found",params:{keyName:e}};if(!await this.isValidKeyName(t))return{success:!1,error:"invalid_key_name",params:{keyName:t}};if(this.cache.keys[t])return{success:!1,error:"key_already_exists",params:{keyName:t}};const i=this.cache.keys[e];if(!Array.isArray(i)||0===i.length)return{success:!1,error:"no_commands_to_duplicate"};try{const n=JSON.parse(JSON.stringify(i));return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{builds:{[this.cache.currentEnvironment]:{keys:{[t]:n}}}}}),this.cache.keys[t]=JSON.parse(JSON.stringify(n)),this.emit("key-duplicated",{from:e,to:t}),{success:!0,sourceKey:e,newKey:t,environment:this.cache.currentEnvironment}}catch(e){return console.error("[KeyService] Failed to duplicate key with name:",e),{success:!1,error:"failed_to_duplicate_key"}}}async isValidKeyName(e){if(!e||"string"!=typeof e)return!1;try{const t=await this.request("data:get-key-name-pattern")||/^[A-Za-z0-9_+]+$/,i=t?.pattern??t;if("USE_STO_KEY_NAMES"===i){const{STO_KEY_NAMES:t}=await Promise.resolve().then(function(){return De});return e.includes("+")?this.isValidChordCombination(e,t):t.includes(e)&&e.length<=20}return i instanceof RegExp?i.test(e)&&e.length<=20:/^[A-Za-z0-9_+]+$/.test(e)&&e.length<=20}catch(t){return/^[A-Za-z0-9_+]+$/.test(e)&&e.length<=20}}isValidChordCombination(e,t){const i=e.split("+");return!(i.length<2)&&(i.map(e=>{const i=e.trim(),n=this.normalizeKeyName(i,t);return t.includes(n)}).every(e=>e)&&e.length<=20)}normalizeKeyName(e,t){const i=new Map;if(t.forEach(e=>{i.set(e.toLowerCase(),e)}),t.includes(e))return e;const n=e.toLowerCase();return i.has(n)?i.get(n):e}generateValidKeys(){const e=[];for(let t=1;t<=12;t++)e.push(`F${t}`),e.push(`Alt+F${t}`);e.push("Space","Tab","Enter","Shift+Space");for(let t=65;t<=90;t++){const i=String.fromCharCode(t);e.push(i),e.push(`Ctrl+${i}`),e.push(`Control+${i}`),e.push(`Alt+${i}`),e.push(`Shift+${i}`)}for(let t=0;t<=9;t++)e.push(String(t)),e.push(`Ctrl+${t}`),e.push(`Alt+${t}`),e.push(`Shift+${t}`);return e.push("Lbutton","Rbutton","Button4","Wheelplus"),e}generateKeyId(){return`key_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}onInit(){this.setupEventListeners()}}const Pe=["[","\\","]","Add","ALT","LALT","RALT","Down","Left","Right","Up",",",";","Control","LCTRL","RCTRL","Backspace","=","Delete","/","End","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","Home","insert","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","enter","Button1","Button2","Button3","Button4","Button5","Button6","Button7","Button8","Button9","Button10","Lbutton","Rbutton","Wheelminus","Wheelplus","Lclick","Rclick","Mclick","Ldblclick","Rdblclick","Mdblclick","Ldrag","Rdrag","Mdrag","Multiply","0","1","2","3","4","5","6","7","8","9","numpad0","numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9","Decimal","Divide","numpadenter","Subtract","Add","PageDown","PageUp",".","Shift","LSHIFT","RSHIFT","Space","Tab","`","Joy1","Joy2","Joy3","Joy4","Joy5","Joy6","Joy7","Joy8","Joy9","Joy10","Joy11","Joy12","Joy13","Joy14","Joy15","Joy16","Joy17","Joy18","Joy19","Joy20","Joy21","Joy22","Joy23","Joy24","Lstick_down","Lstick_left","Lstick_right","Lstick_up","Rstick_down","Rstick_left","Rstick_right","Rstick_up","Joypad_down","Joypad_left","Joypad_right","Joypad_up"];var De=Object.freeze({__proto__:null,STO_KEY_NAMES:Pe});class Me{constructor(e={}){this.options={validateUtf8:!0,strictMode:!1,maxFileSize:1048576,...e},this.decoder=e.decoder||null,this.activityTranslations=new Map,this.keyTokenMap=new Map,this.parseState={currentLayer:0,processedBytes:0,totalBytes:0,errors:[],warnings:[]}}addError(e,t={}){this.decoder&&"function"==typeof this.decoder.addError&&this.decoder.addError(e,t)}addWarning(e,t={}){this.decoder&&"function"==typeof this.decoder.addWarning&&this.decoder.addWarning(e,t)}isValidBase64(e){if(this.decoder&&"function"==typeof this.decoder.isValidBase64)return this.decoder.isValidBase64(e);try{return btoa(atob(e))===e}catch(e){return!1}}parseSemicolonRecords(e){const t=[],i=e.split(";");for(let e=0;e<i.length;e++){const n=i[e].trim();if(0===n.length)continue;const a=n.indexOf(":");if(-1===a){this.addWarning(`Record without colon separator: "${n}"`,{recordIndex:e,segment:n}),t.push({fieldName:n,value:"",hasColon:!1});continue}const s=n.slice(0,a).trim(),o=n.slice(a+1).trim();0!==s.length?t.push({fieldName:s,value:o,hasColon:!0}):this.addWarning(`Record with empty field name: "${n}"`,{recordIndex:e,segment:n})}return t}parseGroupsetRecord(e){if(!e.hasColon||!e.value)return this.addWarning("Invalid GROUPSET record: missing colon or value",{fieldName:e.fieldName,value:e.value}),null;const t=e.value.trim();return/^\d+$/.test(t)||this.addWarning(`Unexpected GROUPSET version format: "${t}"`,{version:t,expectedFormat:"numeric string"}),t}parseKeysetRecord(e,t){if(!e.hasColon||!e.value)return this.addError("Invalid KEYSET record: missing colon or value",{fieldName:e.fieldName,value:e.value,recordIndex:t}),null;const i=e.value.trim();return 0===i.length?(this.addError("Empty KEYSET payload",{recordIndex:t}),null):(this.isValidBase64(i)||this.addWarning("KEYSET payload may not be valid Base64 data",{recordIndex:t,payloadLength:i.length,payloadPreview:i.slice(0,50)}),{type:"KEYSET",payload:i,recordIndex:t,payloadSize:i.length})}parseNameField(e,t){if(!e.hasColon||!e.value)return this.addError("Invalid NAME record: missing colon or value",{fieldName:e.fieldName,value:e.value,recordIndex:t}),null;const i=e.value.trim();return 0===i.length?(this.addError("Empty NAME field",{recordIndex:t}),null):{display:i,sanitized:this.sanitizeBindsetName(i)}}parseKeyField(e,t,i){if(!e.hasColon||!e.value)return this.addError("Invalid KEY record: missing colon or value",{keysetRecordIndex:i,recordIndex:t,fieldName:e.fieldName,value:e.value}),null;const n=e.value.trim();return 0===n.length?(this.addError("Empty KEY payload",{keysetRecordIndex:i,recordIndex:t}),null):(/^[A-Za-z0-9+/=_-]*$/.test(n)||this.addWarning("KEY payload may not be valid Base64 data",{keysetRecordIndex:i,recordIndex:t,payloadLength:n.length,payloadPreview:n.slice(0,50)}),{type:"KEY",payload:n,recordIndex:t,keysetRecordIndex:i,payloadSize:n.length})}sanitizeBindsetName(e){if(null==e)return"unknown_bindset";if("string"!=typeof e)return"unknown_bindset";if(0===e.length)return"unnamed_bindset";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t="bs_"+t),0===t.length&&(t="unnamed_bindset"),t}normalizeKeyToken(e){const t=new Map;if(Pe.forEach(e=>{t.set(e.toLowerCase(),e)}),Pe.includes(e))return e;const i=e.toLowerCase();if(t.has(i))return t.get(i);const n=new Map([["space","Space"],["ctrl","Control"],["control","Control"],["alt","ALT"],["shift","Shift"],["tab","Tab"],["enter","enter"],["escape","delete"],["esc","delete"],["capslock","CapsLock"],["backspace","delete"],["pageup","PageUp"],["pagedown","PageDown"],["home","Home"],["end","End"],["insert","insert"],["del","delete"]]);return n.has(i)?n.get(i):e}parseKeyTokenField(e,t){if(!e.hasColon)return this.addError("Invalid Key field: missing colon",{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;if(null===e.value||void 0===e.value)return this.addError("Empty Key field: null or undefined value",{fieldName:e.fieldName,fieldIndex:t}),null;let i=e.value.trim();return 0===i.length?(this.addError("Empty Key field",{fieldIndex:t}),null):(i="SemiColon"===i?";":"Space"===i?" ":this.normalizeKeyToken(i),i)}parseNumericField(e,t,i,n=null,a=null){if(!e.hasColon||!e.value)return this.addError(`Invalid ${i} field: missing colon or value`,{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;const s=e.value.trim();if(0===s.length)return this.addError(`Empty ${i} field`,{fieldIndex:t}),null;if(!/^-?\d+$/.test(s))return this.addError(`Invalid ${i} field: must be numeric`,{fieldIndex:t,value:s}),null;const o=parseInt(s,10);return null!==n&&o<n?(this.addWarning(`${i} value below minimum, using minimum`,{fieldIndex:t,value:o,minValue:n}),n):null!==a&&o>a?(this.addWarning(`${i} value above maximum, using maximum`,{fieldIndex:t,value:o,maxValue:a}),a):o}parseBooleanField(e,t,i){if(!e.hasColon||!e.value)return this.addError(`Invalid ${i} field: missing colon or value`,{fieldName:e.fieldName,value:e.value,fieldIndex:t}),!1;const n=e.value.trim();return 0===n.length?(this.addError(`Empty ${i} field`,{fieldIndex:t}),!1):"1"===n||("0"===n||this.addWarning(`Invalid ${i} field: expected 0 or 1, using false`,{fieldIndex:t,value:n}),!1)}parseComboField(e,t){if(!e.hasColon)return this.addError("Invalid Combo field: missing colon",{fieldName:e.fieldName,value:e.value,fieldIndex:t}),[];const i=e.value.trim();if(0===i.length)return[];const n=i.split("*").filter(e=>e.length>0);if(0===n.length)return[];const a=[];for(let e=0;e<n.length;e++){const i=n[e].trim();if(0!==i.length)if(/^[A-Za-z0-9+/]*={0,2}$/.test(i))try{const e=atob(i);e.length>0&&a.push(e)}catch(n){this.addWarning(`Failed to decode combo token: ${n.message}`,{fieldIndex:t,tokenIndex:e,token:i,errorType:n.name})}else this.addWarning("Combo token may not be valid Base64 data",{fieldIndex:t,tokenIndex:e,token:i})}return a}parseActivityField(e,t){if(!e.hasColon||!e.value)return this.addError("Invalid ACT field: missing colon or value",{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;const i=e.value.trim();return 0===i.length?(this.addError("Empty ACT payload",{fieldIndex:t}),null):(/^[A-Za-z0-9+/]*={0,2}$/.test(i)||this.addWarning("ACT payload may not be valid Base64 data",{fieldIndex:t,payloadLength:i.length,payloadPreview:i.slice(0,50)}),{type:"ACT",payload:i,fieldIndex:t,payloadSize:i.length})}parseBase64TextField(e,t){if(!e.hasColon)return this.addError(`Invalid ${e.fieldName} field: missing colon`,{fieldName:e.fieldName,value:e.value,fieldIndex:t}),null;if(null===e.value||void 0===e.value)return"";const i=e.value.trim();if(0===i.length)return"";/^[A-Za-z0-9+/]*={0,2}$/.test(i)||this.addWarning(`${e.fieldName} field may not be valid Base64 data`,{fieldIndex:t,textLength:i.length,textPreview:i.slice(0,50)});try{const n=atob(i),a=new Uint8Array(n.length);for(let e=0;e<n.length;e++)a[e]=n.charCodeAt(e);try{return new TextDecoder("utf-8",{fatal:!0}).decode(a)}catch(i){this.addWarning(`${e.fieldName} field contains invalid UTF-8 data, using fallback decoding`,{fieldIndex:t,errorType:i.name,errorMessage:i.message});try{return new TextDecoder("utf-8",{fatal:!1}).decode(a)}catch(i){return this.addError(`Complete ${e.fieldName} field UTF-8 decoding failure`,{fieldIndex:t,errorType:i.name,errorMessage:i.message}),""}}}catch(n){return this.addError(`Failed to Base64 decode ${e.fieldName} field`,{fieldIndex:t,errorType:n.name,errorMessage:n.message,textLength:i.length}),""}}}class Ne{constructor(e={}){this.options={validateUtf8:!0,strictMode:!1,maxFileSize:1048576,...e},this.decoder=e.decoder||null,this.activityTranslations=new Map,this.keyTokenMap=new Map,this.parseState={currentLayer:0,processedBytes:0,totalBytes:0,errors:[],warnings:[]}}addError(e,t={}){this.decoder&&"function"==typeof this.decoder.addError&&this.decoder.addError(e,t)}addWarning(e,t={}){this.decoder&&"function"==typeof this.decoder.addWarning&&this.decoder.addWarning(e,t)}getSupportedActivities(){throw new Error("getSupportedActivities method not implemented yet")}translateActivity(e,t){if("number"!=typeof e||!Number.isInteger(e))return this.addValidationError("activity","must be a valid integer",e,{fieldType:"number",expectedValue:"integer between 0-123",suggestion:"Activity ID must be an integer value"}),this.createUnknownActivityResult(e,t);if(e<0||e>123)return this.addValidationError("activity",`value ${e} is outside valid range (0-123)`,e,{fieldType:"number",actualValue:e,expectedValue:"0-123",suggestion:"Activity IDs must be between 0 and 123 inclusive"}),this.createUnknownActivityResult(e,t);const i={environment:t?.environment||"space",bindsetName:t?.bindsetName||"unknown_bindset",keyToken:t?.keyToken||"unknown_key",modifiers:{control:t?.modifiers?.control||!1,alt:t?.modifiers?.alt||!1,shift:t?.modifiers?.shift||!1},combo:t?.combo||[],sanitize:t?.sanitize||(e=>this.sanitizeBindsetName(e)),...t};["space","ground"].includes(i.environment)||(this.addWarning(`Invalid environment "${i.environment}", defaulting to "space"`,{category:"validation",fieldName:"environment",actualValue:i.environment,expectedValue:"space|ground",suggestion:'Environment must be either "space" or "ground"'}),i.environment="space");try{const n=this.generateActivityCommand(e,t,i);return n&&"object"==typeof n?{...n,success:!0,metadata:{type:n.type||"unknown",environment:i.environment,bindsetName:i.bindsetName,keyToken:i.keyToken},warnings:[...this.parseState.warnings]}:(this.addError(`Activity command generation returned invalid result for activity ${e}`,{category:"generation_error",severity:"error",activity:e,actualValue:n,expectedValue:"object with commands/aliases/metadata",recoverable:!0,suggestion:"Command generation implementation may be broken"}),this.createUnknownActivityResult(e,i))}catch(t){return this.addError(`Activity command generation failed for ${e}: ${t.message}`,{category:"generation_error",severity:"error",activity:e,error:t.name,errorStack:t.stack,context:i.keyToken,environment:i.environment,bindsetName:i.bindsetName,recoverable:!0,suggestion:`Command generation for activity ${e} encountered an error. This may indicate a bug in the translation logic.`}),this.createUnknownActivityResult(e,i)}}generateActivityCommand(e,t,i){const{text:n,text2:a,n1:s,n2:o,n3:r}=t||{};switch(e){case 0:return{type:"text_command",commands:n?["team "+n]:["team "],aliases:{}};case 1:return{type:"fixed_command",commands:["target_clear"],aliases:{}};case 2:return{type:"fixed_command",commands:["Target_Enemy_Near"],aliases:{}};case 3:return{type:"fixed_command",commands:["Target_Enemy_Next"],aliases:{}};case 4:return{type:"parameterized_command",commands:null!=s?["Target_Teammate "+s]:[],aliases:{}};case 5:return{type:"text_command",commands:n?["Target "+n.trim()]:["Target "],aliases:{}};case 6:return{type:"fixed_command",commands:["Target_Friend_Next"],aliases:{}};case 7:return{type:"fixed_command",commands:["Target_Enemy_Next_Exposed"],aliases:{}};case 8:return{type:"fixed_command",commands:["StatsPreset_Load Preset_1"],aliases:{}};case 9:return{type:"fixed_command",commands:["StatsPreset_Load Preset_2"],aliases:{}};case 10:return{type:"fixed_command",commands:["StatsPreset_Load Preset_3"],aliases:{}};case 11:return{type:"fixed_command",commands:["StatsPreset_Load Preset_4"],aliases:{}};case 12:return{type:"text_command",commands:n?["Assist "+n.trim()]:["Assist "],aliases:{}};case 13:return{type:"parameterized_command",commands:"number"!=typeof s||"number"!=typeof o||isNaN(s)||isNaN(o)?[]:["+TrayExecByTray "+s+" "+o],aliases:{}};case 14:return{type:"fixed_command",commands:["GenSendMessage HUD_Root FireAll"],aliases:{}};case 15:return{type:"fixed_command",commands:["FirePhasers"],aliases:{}};case 16:return{type:"fixed_command",commands:["FireTorps"],aliases:{}};case 17:return{type:"fixed_command",commands:["FireMines"],aliases:{}};case 18:return{type:"fixed_command",commands:["FirePhasersTorps"],aliases:{}};case 19:return{type:"fixed_command",commands:["FireProjectiles"],aliases:{}};case 20:return{type:"fixed_command",commands:["CamReset"],aliases:{}};case 22:return{type:"fixed_command",commands:["camUseChaseCam 1"],aliases:{}};case 23:return{type:"fixed_command",commands:["camUseChaseCam 0"],aliases:{}};case 24:return{type:"parameterized_command",commands:"number"==typeof s&&0!==s?[`camdist ${s}`]:["camdist"],aliases:{}};case 26:{const e="number"!=typeof s||isNaN(s)?0:s,t=[];for(let i=0;i<=9;i++)t.push(`+TrayExecByTray ${e} ${i}`);return{type:"parameterized_command",commands:t,aliases:{}}}case 27:return{type:"fixed_command",commands:["camUseAutoTargetLock 1"],aliases:{}};case 28:return{type:"fixed_command",commands:["camUseAutoTargetLock 0"],aliases:{}};case 29:return{type:"fixed_command",commands:["+Power_Exec Distribute_Shields"],aliases:{}};case 30:return{type:"fixed_command",commands:["+up"],aliases:{}};case 31:return{type:"fixed_command",commands:["+down"],aliases:{}};case 32:return{type:"fixed_command",commands:["+left"],aliases:{}};case 33:return{type:"fixed_command",commands:["+right"],aliases:{}};case 34:return{type:"parameterized_command",commands:"number"!=typeof s||isNaN(s)?[]:[`throttleadjust ${(s/100).toFixed(2)}`],aliases:{}};case 35:return{type:"fixed_command",commands:["GenSendMessage Throttle_FullImpulse_Button FullThrottle"],aliases:{}};case 36:return{type:"fixed_command",commands:["+Forward"],aliases:{}};case 37:return{type:"fixed_command",commands:["+backward"],aliases:{}};case 38:return{type:"fixed_command",commands:["+Left"],aliases:{}};case 39:return{type:"fixed_command",commands:["+Right"],aliases:{}};case 40:return{type:"fixed_command",commands:["+TurnLeft"],aliases:{}};case 41:return{type:"fixed_command",commands:["+TurnRight"],aliases:{}};case 42:return{type:"fixed_command",commands:["++AutoForward"],aliases:{}};case 43:return{type:"fixed_command",commands:["+Up"],aliases:{}};case 44:return{type:"fixed_command",commands:["+Walk"],aliases:{}};case 45:return{type:"fixed_command",commands:["+Run"],aliases:{}};case 46:return{type:"fixed_command",commands:["+Roll"],aliases:{}};case 47:return{type:"fixed_command",commands:["+Aim"],aliases:{}};case 48:return{type:"fixed_command",commands:["Follow"],aliases:{}};case 49:return{type:"fixed_command",commands:["GenSendMessage Inventory_Root SwitchActiveWeapon"],aliases:{}};case 50:return{type:"fixed_command",commands:["HolsterToggle"],aliases:{}};case 51:return{type:"fixed_command",commands:["+Crouch"],aliases:{}};case 52:return{type:"fixed_command",commands:["Clear"],aliases:{}};case 53:return{type:"fixed_command",commands:["None"],aliases:{}};case 54:return{type:"fixed_command",commands:["ShowFPS 1"],aliases:{}};case 55:return{type:"fixed_command",commands:["ShowFPS 0"],aliases:{}};case 56:return{type:"fixed_command",commands:["netgraph 1"],aliases:{}};case 57:return{type:"fixed_command",commands:["netgraph 0"],aliases:{}};case 58:return{type:"fixed_command",commands:["netTimingGraph 1"],aliases:{}};case 59:return{type:"fixed_command",commands:["netTimingGraph 0"],aliases:{}};case 60:return{type:"fixed_command",commands:["showmem 1"],aliases:{}};case 61:return{type:"fixed_command",commands:["showmem 0"],aliases:{}};case 62:return{type:"fixed_command",commands:["frameRateStabilizer 1"],aliases:{}};case 63:return{type:"fixed_command",commands:["frameRateStabilizer 0"],aliases:{}};case 64:return{type:"parameterized_command",commands:"number"!=typeof s||isNaN(s)?["maxfps 0"]:[`maxfps ${s}`],aliases:{}};case 65:return{type:"parameterized_command",commands:"number"!=typeof s||isNaN(s)?["perFrameSleep 0"]:[`perFrameSleep ${s}`],aliases:{}};case 66:return{type:"parameterized_command",commands:"number"!=typeof s||isNaN(s)?["rdrMaxGPUFramesAhead 1"]:[`rdrMaxGPUFramesAhead ${s}`],aliases:{}};case 67:return{type:"parameterized_command",commands:[`rdrMaxFramesAhead ${"number"!=typeof s||isNaN(s)?"1":s.toString().replace(/ /g,"").replace(/,/g,".")}`],aliases:{}};case 68:return{type:"fixed_command",commands:["Target Alpha Freighter","Target Bravo Freighter","Target Charlie Freighter","Target Delta Freighter","Target Foxtrot Freighter","Target Golf Freighter","Target India Freighter","Target Juliet Freighter"],aliases:{}};case 69:return{type:"fixed_command",commands:["Target Juliet Freighter $$ Target India Freighter $$ Target Golf Freighter $$ Target Foxtrot Freighter $$ Target Delta Freighter $$ Target Charlie Freighter $$ Target Bravo Freighter $$ Target Alpha Freighter"],aliases:{}};case 70:return{type:"fixed_command",commands:["Target Starbase"],aliases:{}};case 71:return{type:"fixed_command",commands:["Target Civilian Transport"],aliases:{}};case 72:return{type:"fixed_command",commands:["Target Bio-Neural Warhead"],aliases:{}};case 73:return{type:"fixed_command",commands:["focustargetset"],aliases:{}};case 74:return{type:"fixed_command",commands:["focustargetselect"],aliases:{}};case 76:return{type:"parameterized_command",commands:[`gamma ${((s||0)/100).toFixed(2).replace(",",".")}`],aliases:{}};case 77:return{type:"text_command",commands:n?["zone "+n]:["zone "],aliases:{}};case 78:return{type:"text_command",commands:n?["local "+n]:["local "],aliases:{}};case 79:return{type:"fixed_command",commands:["ControlSchemeCycle"],aliases:{}};case 80:return{type:"fixed_command",commands:["Inventory"],aliases:{}};case 81:return{type:"fixed_command",commands:["Map"],aliases:{}};case 82:return{type:"fixed_command",commands:["Target Aceton Assimilator"],aliases:{}};case 83:return{type:"fixed_command",commands:["camturntoface 1"],aliases:{}};case 84:return{type:"fixed_command",commands:["PvPQueues"],aliases:{}};case 85:return{type:"fixed_command",commands:["PvEQueues"],aliases:{}};case 86:const c="number"==typeof s&&s>0?(s/100).toFixed(2):"1.00";return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Statustargetoftarget_Space_Bufflist scale ${c}$$GenSetEarlyOverrideFloat Hud_Statustargetoftarget_Ground_Bufflist scale ${c}`],aliases:{}};case 87:const l="number"==typeof s&&s>0?(s/100).toFixed(2):"1.00";return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Statustarget_Space_Bufflist scale ${l}$$GenSetEarlyOverrideFloat Hud_Statustarget_Ground_Bufflist scale ${l}`],aliases:{}};case 88:const d="number"==typeof s&&s>0?(s/100).toFixed(2):"1.00";return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Statustargetfocused_Space_Bufflist scale ${d}$$GenSetEarlyOverrideFloat Hud_Statustargetfocused_Ground_Bufflist scale ${d}`],aliases:{}};case 89:return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Statusself_Bufflist scale ${"number"==typeof s&&s>0?(s/100).toFixed(2):"1.00"}`],aliases:{}};case 90:return{type:"fixed_command",commands:["Target_Self"],aliases:{}};case 91:const m="number"==typeof s&&s>0?(s/100).toFixed(2):"1.00";return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Statustargetoftarget_Space_Bufflist scale ${m}$$GenSetEarlyOverrideFloat Hud_Statustargetoftarget_Ground_Bufflist scale ${m}$$GenSetEarlyOverrideFloat Hud_Statustarget_Space_Bufflist scale ${m}$$GenSetEarlyOverrideFloat Hud_Statustarget_Ground_Bufflist scale ${m}$$GenSetEarlyOverrideFloat Hud_Statustargetfocused_Space_Bufflist scale ${m}$$GenSetEarlyOverrideFloat Hud_Statustargetfocused_Ground_Bufflist scale ${m}$$GenSetEarlyOverrideFloat Hud_Statusself_Bufflist scale ${m}`],aliases:{}};case 92:return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Spacetraywindow_Large scale ${"number"==typeof s&&s>0?(s/100).toFixed(2):"1.00"}`],aliases:{}};case 93:return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Buffs scale ${"number"==typeof s&&s>0?(s/100).toFixed(2):"1.00"}`],aliases:{}};case 94:return{type:"parameterized_command",commands:[`GenSetEarlyOverrideFloat Hud_Spacetraywindow_Secondary ${"number"==typeof s&&s>0?(s/100).toFixed(2):"1.00"}`],aliases:{}};case 95:const h="number"==typeof s?s.toString():"0",u="number"==typeof r?r:0,p=[];for(let e="number"==typeof o?o:0;e<=u;e++)p.push(`+TrayExecByTray ${h} ${e.toString()}`);return{type:"parameterized_command",commands:p,aliases:{}};case 96:return{type:"text_command",commands:[`emote_notext ${n||""}`],aliases:{}};case 97:const f=n||"",y=`sto_kb_emotecycle_${t.baseKeyName||"key"}_${t.index||0}`;return{type:"cycle_command",commands:[y],aliases:{[y]:{steps:[`${y}_step0`],currentIndex:0},[`${y}_step0`]:{commands:[`emote_notext ${f}`],next:`${y}_step0`}}};case 98:return{type:"text_command",commands:[`tell ${n||""}, ${(a||"").trim()}`],aliases:{}};case 99:{const e=n||"";return{type:"text_command",commands:e?[`bind_load_file ${e}`]:["bind_load_file"],aliases:{}}}case 101:const _=n||"",g=`sto_kb_emotecyclevisible_${t.baseKeyName||"key"}_${t.index||0}`;return{type:"cycle_command",commands:[g],aliases:{[g]:{steps:[`${g}_step0`],currentIndex:0},[`${g}_step0`]:{commands:[`emote ${_}`],next:`${g}_step0`}}};case 102:return{type:"fixed_command",commands:["target Armored Bio-Neural Warhead"],aliases:{}};case 103:return{type:"fixed_command",commands:["InteractWindow"],aliases:{}};case 104:{if(!n||!n.trim())return{type:"text_command",commands:[]};let e=n.trim();"master"===e.toLowerCase()&&(e="Primary Bindset");const i=e.replace(/[^a-zA-Z0-9_]/g,"_");return{type:"bindset_loader",commands:[`sto_kb_bindset_enable_${t?.environment||"space"}_${i}`],aliases:{}}}case 105:return n&&n.length>4&&".txt"===n.toLowerCase().substring(n.length-4)?{type:"text_command",commands:["bind_save_file "+n.replace(/ /g,"_")],aliases:{}}:{type:"text_command",commands:[],aliases:{}};case 106:return{type:"fixed_command",commands:["CombatLog 1"],aliases:{}};case 107:return{type:"fixed_command",commands:["CombatLog 0"],aliases:{}};case 108:return{type:"fixed_command",commands:["CombatLog"],aliases:{}};case 109:return{type:"fixed_command",commands:["defaultautoattack 1"],aliases:{}};case 110:return{type:"fixed_command",commands:["defaultautoattack 0"],aliases:{}};case 111:return{type:"fixed_command",commands:["unbind_all"],aliases:{}};case 112:return{type:"text_command",commands:n?["unbind_local "+n.trim()]:["unbind_local "],aliases:{}};case 113:return{type:"text_command",commands:n?a?["chan "+n+" "+a.trim()]:["chan "+n+" "]:["chan "],aliases:{}};case 114:return{type:"text_command",commands:n?["unbind "+n]:["unbind "],aliases:{}};case 115:return{type:"fixed_command",commands:["GenSendMessage Doff_Recipe_Start_Action Clicked"],aliases:{}};case 116:return{type:"parameterized_command",commands:[`GenSliderSetNotch Doff_Recipe_Quantity_Slider ${"number"!=typeof s||isNaN(s)?"100":s.toString().replace(/ /g,"").replace(/,/g,".")}`],aliases:{}};case 117:return{type:"fixed_command",commands:["GenSendMessage Doff_Recipe_Actions_Starttask Clicked"],aliases:{}};case 118:return{type:"fixed_command",commands:["LootRollNeed"],aliases:{}};case 119:return{type:"fixed_command",commands:["LootRollGreed"],aliases:{}};case 120:return{type:"fixed_command",commands:["LootRollPass"],aliases:{}};case 121:return{type:"parameterized_command",commands:[`trayelemdestroy ${"number"!=typeof s||isNaN(s)?"0":s.toString().replace(/ /g,"").replace(/,/g,".")} ${"number"!=typeof o||isNaN(o)?"0":o.toString().replace(/ /g,"").replace(/,/g,".")}`],aliases:{}};case 122:{const e=s||0,t=[];for(let i=0;i<=9;i++)t.push(`trayelemdestroy ${e} ${i}`);return{type:"parameterized_command",commands:t,aliases:{}}}case 123:return{type:"fixed_command",commands:["ScanForClickies"],aliases:{}};default:return this.generateUnknownActivityCommand(e,t,i)}}generateUnknownActivityCommand(e,t,i){this.addUnknownElementWarning("activity",e,{recordType:"ACT",fieldName:"Activity",activity:e,context:t?.keyToken,environment:t?.environment,bindsetName:t?.bindsetName,suggestion:"This activity may be from a newer KBF version or custom extension. The activity will be skipped but parsing will continue."});const n=[`Activity ${e} translation not implemented or failed`,"This activity will be skipped but parsing will continue with other activities"];return e>123&&n.push(`High activity ID ${e} may indicate custom or future KBF format extension`),"number"==typeof e&&(e<0||e>123)&&n.push(`Activity ${e} outside valid range (0-123)`),"number"!=typeof e&&n.push(`Invalid activity type: ${typeof e}, expected number`),{type:"unknown",commands:[],aliases:{},success:!1,error:`Activity ${e} translation not implemented or failed`,warnings:n,errorCategory:this.determineActivityErrorCategory(e)}}createUnknownActivityResult(e,t){const i={commands:[],aliases:[],metadata:{type:"unknown",originalActivity:e,environment:t?.environment||"space",bindsetName:t?.bindsetName||"unknown",keyToken:t?.keyToken||"unknown",recoveryAction:"skipped",parseTimestamp:Date.now()},success:!1,error:`Activity translation failed: ${e}`,errorCategory:this.determineActivityErrorCategory(e),suggestion:this.getActivitySuggestion(e),warnings:[...this.parseState.warnings,...this.parseState.errors.map(e=>e.message),`Activity ${e} translation not implemented or failed`,"This activity will be skipped but parsing will continue with other activities"]};return e>123&&i.warnings.push(`High activity ID ${e} may indicate custom or future KBF format extension`),"number"==typeof e&&(e<0||e>123)&&i.warnings.push(`Activity ${e} outside valid range (0-123)`),"number"!=typeof e&&i.warnings.push(`Invalid activity type: ${typeof e}, expected number`),i}determineActivityErrorCategory(e){return"number"!=typeof e?"invalid_type":e<0||e>123?"out_of_range":e>=30&&e<=123?"unimplemented_standard":"unknown_basic"}getActivitySuggestion(e){return"number"!=typeof e?"Activity IDs should be numeric values":e<0||e>123?"Valid activity IDs range from 0 to 123":e>96?"This may be from a newer KBF version or contain custom extensions":"This activity may not be implemented yet in the current parser version"}mapKeyToken(e,t={},i=null){if("string"!=typeof e)return this.addWarning("Invalid key token type: "+typeof e,{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"string",suggestion:"Key tokens should be string identifiers from the KBF specification"}),e;if(0===e.length)return this.addWarning("Empty key token provided",{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"non-empty string",suggestion:"Key tokens must have at least one character"}),"";/^[A-Za-z0-9_]+$/.test(e)||["SemiColon","Space"," "].includes(e)||this.addWarning(`Key token "${e}" contains unexpected characters`,{category:"validation",fieldName:"keyToken",actualValue:e,expectedValue:"alphanumeric or special tokens (SemiColon, Space)",suggestion:"Key tokens should be alphanumeric according to KBF specification"}),0===this.keyTokenMap.size&&this.initializeKeyTokenMap();const n=new Map;Pe.forEach(e=>{n.set(e.toLowerCase(),e)});let a=e;a="SemiColon"===e?";":"Space"===e||" "===e?"Space":(e=>{if(Pe.includes(e))return e;const t=e.toLowerCase();if(n.has(t))return n.get(t);const i=new Map([["space","Space"],["ctrl","Control"],["control","Control"],["alt","ALT"],["shift","Shift"],["tab","Tab"],["enter","enter"],["escape","delete"],["esc","delete"],["capslock","CapsLock"],["backspace","delete"],["pageup","PageUp"],["pagedown","PageDown"],["home","Home"],["end","End"],["insert","insert"],["del","delete"]]);return i.has(t)?i.get(t):e})(e);const s=this.validateAndSanitizeModifiers(t),o=[];s.control&&o.push("Ctrl"),s.alt&&o.push("Alt"),s.shift&&o.push("Shift"),a&&a.length>0?o.push(a):(o.push("UnknownKey"),this.addWarning('Mapped key token is empty, using fallback "UnknownKey"',{category:"validation",fieldName:"mappedToken",originalToken:e,mappedToken:a,suggestion:"Key token mapping resulted in empty value"}));const r=o.join("+");if(0===r.length)return this.addError("Canonical key generation failed - empty result",{category:"handler_error",severity:"error",originalToken:e,modifiers:s,mappedToken:a,recoverable:!0,suggestion:"Key generation failed but will continue with fallback"}),"UnknownKey";if(i&&"string"==typeof i&&i.trim().length>0)try{return this.processComboChord(r,i)}catch(e){return this.addError(`Combo chord processing failed: ${e.message}`,{category:"handler_error",severity:"warning",canonicalKey:r,combo:i,error:e.name,recoverable:!0,suggestion:"Combo chord processing failed, using base key without chord"}),r}return r}validateAndSanitizeModifiers(e){const t={control:!1,alt:!1,shift:!1};return e&&"object"==typeof e?(Object.keys(t).forEach(i=>{void 0!==e[i]&&("boolean"==typeof e[i]?t[i]=e[i]:1===e[i]||"1"===e[i]?t[i]=!0:0!==e[i]&&"0"!==e[i]&&e[i]?(this.addWarning(`Invalid ${i} modifier value: ${e[i]}, using false`,{category:"validation",fieldName:`modifiers.${i}`,actualValue:e[i],expectedValue:"boolean or 0/1",suggestion:`Modifier ${i} should be true/false or 0/1`}),t[i]=!1):t[i]=!1)}),t):(null!=e&&this.addWarning("Invalid modifiers object, using defaults",{category:"validation",fieldName:"modifiers",actualValue:e,expectedValue:"object with control/alt/shift boolean properties",suggestion:"Modifiers should be an object with boolean properties"}),t)}provideTokenFallback(e){const t=e.toLowerCase();return t.startsWith("f")&&/^\d+$/.test(t.slice(1))?e.toUpperCase():t.startsWith("numpad")?e.charAt(0).toUpperCase()+e.slice(1):t.includes("mouse")||t.includes("button")?"MouseButton":e.length<=3?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}initializeKeyTokenMap(){const e=new Map([["[","["],["\\\\","\\"],["]","]"],[",",","],["/","/"],[".","."],["`","`"],["ALT","Alt"],["LALT","Alt"],["RALT","Alt"],["Control","Ctrl"],["LCTRL","Ctrl"],["RCTRL","Ctrl"],["Shift","Shift"],["Down","ArrowDown"],["Left","ArrowLeft"],["Right","ArrowRight"],["Up","ArrowUp"],["F1","F1"],["F2","F2"],["F3","F3"],["F4","F4"],["F5","F5"],["F6","F6"],["F7","F7"],["F8","F8"],["F9","F9"],["F10","F10"],["F11","F11"],["F12","F12"],["F13","F13"],["F14","F14"],["F15","F15"],["F16","F16"],["F17","F17"],["F18","F18"],["F19","F19"],["F20","F20"],["F21","F21"],["F22","F22"],["F23","F23"],["F24","F24"],["Delete","Delete"],["End","End"],["Home","Home"],["Insert","Insert"],["PageDown","PageDown"],["PageUp","PageUp"],["Tab","Tab"],["enter","Enter"],["numpad0","Numpad0"],["numpad1","Numpad1"],["numpad2","Numpad2"],["numpad3","Numpad3"],["numpad4","Numpad4"],["numpad5","Numpad5"],["numpad6","Numpad6"],["numpad7","Numpad7"],["numpad8","Numpad8"],["numpad9","Numpad9"],["Decimal","NumpadDecimal"],["Divide","NumpadDivide"],["numpadenter","NumpadEnter"],["Add","+"],["Multiply","*"],["Subtract","-"],["A","A"],["B","B"],["C","C"],["D","D"],["E","E"],["F","F"],["G","G"],["H","H"],["I","I"],["J","J"],["K","K"],["L","L"],["M","M"],["N","N"],["O","O"],["P","P"],["Q","Q"],["R","R"],["S","S"],["T","T"],["U","U"],["V","V"],["W","W"],["X","X"],["Y","Y"],["Z","Z"],["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["Button1","Mouse1"],["Button2","Mouse2"],["Button3","Mouse3"],["Button4","Mouse4"],["Button5","Mouse5"],["Button6","Mouse6"],["Button7","Mouse7"],["Button8","Mouse8"],["Button9","Mouse9"],["Button10","Mouse10"],["Lbutton","MouseLeft"],["Middleclick","MouseMiddle"],["Rbutton","MouseRight"],["Wheelminus","MouseWheelDown"],["Wheelplus","MouseWheelUp"],["Joy1","XboxStart"],["Joy2","XboxBack"],["Joy3","XboxLThumb"],["Joy4","XboxRThumb"],["Joy5","XboxLB"],["Joy6","XboxRB"],["Joy7","XboxLT"],["Joy8","XboxRT"],["Joy9","XboxA"],["Joy10","XboxB"],["Joy11","XboxX"],["Joy12","XboxY"],["Lstick_up","XboxLStickUp"],["Lstick_down","XboxLStickDown"],["Lstick_left","XboxLStickLeft"],["Lstick_right","XboxLStickRight"],["Rstick_up","XboxRStickUp"],["Rstick_down","XboxRStickDown"],["Rstick_left","XboxRStickLeft"],["Rstick_right","XboxRStickRight"],["Joypad_up","XboxDPadUp"],["Joypad_down","XboxDPadDown"],["Joypad_left","XboxDPadLeft"],["Joypad_right","XboxDPadRight"]]);this.keyTokenMap=e}processCombo(e){if(!e)return this.addValidationError("comboData","combo data is required for combo processing",e,{fieldType:null===e?"null":"undefined",expectedValue:"string with Base64 encoded combo tokens",suggestion:"Combo data should be a string containing Base64 encoded tokens separated by *"}),[];if("string"!=typeof e)return this.addValidationError("comboData","must be a string value",e,{fieldType:typeof e,expectedValue:"string",suggestion:"Combo data should be a string containing Base64 encoded tokens"}),[];const t=e.trim();if(0===t.length)return this.addWarning("Combo data is empty after trimming",{category:"validation",fieldName:"comboData",actualValue:e,suggestion:"Combo data should contain at least one Base64 encoded token"}),[];!t.includes("*")&&t.length>50&&this.addWarning(`Combo data may be malformed: very long single token (${t.length} chars)`,{category:"format",fieldName:"comboData",dataLength:t.length,suggestion:"Combo data should contain Base64 tokens separated by * delimiters"});const i=t.split("*").filter(e=>e.length>0);if(0===i.length)return this.addWarning("No valid tokens found in combo data after splitting",{category:"format",fieldName:"comboData",originalData:e,suggestion:"Combo data should contain Base64 encoded tokens separated by * delimiters"}),[];i.length>10&&this.addWarning(`Large number of combo tokens (${i.length}) may indicate data corruption`,{category:"format",fieldName:"comboData",tokenCount:i.length,suggestion:"Typical combo chords have 2-5 tokens. Large numbers may indicate parsing errors."});const n=[];let a=0,s=0;for(let e=0;e<i.length;e++){const t=i[e].trim();if(0===t.length)continue;if(t.length<1){this.addWarning(`Combo token ${e} is empty`,{category:"validation",fieldName:"comboToken",tokenIndex:e,suggestion:"Empty tokens should be removed from combo data"});continue}if(t.length>100&&this.addWarning(`Combo token ${e} is unusually long (${t.length} chars)`,{category:"format",fieldName:"comboToken",tokenIndex:e,tokenLength:t.length,suggestion:"Combo tokens should typically be under 100 characters"}),!/^[A-Za-z0-9+/]*={0,2}$/.test(t)){s++,this.addDecodingError("combo token","Invalid Base64 format: contains invalid characters",{tokenIndex:e,token:t,tokenLength:t.length,recoverable:!0,suggestion:"Combo tokens should contain only valid Base64 characters (A-Z, a-z, 0-9, +, /, =)"});continue}const o=(t.match(/=/g)||[]).length;o>2&&this.addWarning(`Combo token ${e} has excessive Base64 padding (${o} equals signs)`,{category:"format",fieldName:"comboToken",tokenIndex:e,paddingCount:o,suggestion:"Base64 tokens should have at most 2 padding characters"});try{const i=atob(t);if(0===i.length){this.addWarning(`Combo token ${e} decoded to empty string`,{category:"decoding",fieldName:"comboToken",tokenIndex:e,originalToken:t,suggestion:"Token may contain only padding characters or be invalid"});continue}/^[\x20-\x7E]*$/.test(i)||this.addWarning(`Combo token ${e} decoded to non-printable characters`,{category:"validation",fieldName:"decodedComboToken",tokenIndex:e,decodedToken:i.slice(0,20),suggestion:"Decoded combo tokens should contain printable ASCII characters for key bindings"}),n.push(i),a++}catch(i){s++,this.addDecodingError("combo token",`${i.message} (token: ${t.slice(0,20)}${t.length>20?"...":""})`,{tokenIndex:e,token:t,tokenLength:t.length,errorType:i.name,critical:!1,recoverable:!0,suggestion:"Token may be corrupted or not properly Base64 encoded"})}}return s>0&&this.addWarning(`Combo processing completed with ${s} invalid tokens out of ${i.length} total`,{category:"processing_summary",fieldName:"comboData",totalTokens:i.length,validTokens:a,invalidTokens:s,successRate:`${Math.round(a/i.length*100)}%`,suggestion:"Some combo tokens were invalid but processing continued with valid tokens"}),0===a&&i.length>0&&this.addError("All combo tokens failed to decode",{category:"processing_summary",severity:"warning",totalTokens:i.length,suggestion:"Combo data may be corrupted or encoded incorrectly"}),n}processComboChord(e,t){if(!t||"string"!=typeof t)return e;if(0===t.trim().length)return e;const i=this.processCombo(t);return 0===i.length?e:`${e}+${i.join("+")}`}addValidationError(e,t,i,n={}){this.addError(`Validation failed for ${e}: ${t}`,{category:"validation",fieldName:e,actualValue:i,fieldType:typeof i,recoverable:!0,suggestion:n.suggestion,...n})}addDecodingError(e,t,i={}){this.addError(`${e} decoding error: ${t}`,{category:"decoding",fieldName:e,recoverable:!1!==i.recoverable,suggestion:i.suggestion,...i})}addUnknownElementWarning(e,t,i={}){this.addWarning(`Unknown ${e}: ${t}`,{category:"unknown_element",severity:"warning",suggestion:`This ${e} may be from a newer KBF version or custom extension. It will be skipped.`,...i})}}class Le{constructor(e=null){this.eventBus=e||c,this.reset()}reset(){this.errors=[],this.warnings=[]}addError(e,t={}){const i={message:e,...t};return this.errors.push(i),i}addWarning(e,t={}){const i={message:e,...t};return this.warnings.push(i),i}}const ze=/^[A-Za-z0-9+/]*={0,2}$/;function Ke(e,{addError:t,layerName:i="Unknown",context:n={}}={}){if(e instanceof ArrayBuffer)try{return{content:new TextDecoder("utf-8").decode(e),success:!0}}catch(i){return t?.(`Failed to decode ArrayBuffer to string: ${i.message}`,{contentType:"ArrayBuffer",contentSize:e.byteLength,...n}),{content:"",success:!1}}return"string"==typeof e?{content:e,success:!0}:(t?.(`Invalid content type for ${i} decoding`,{contentType:typeof e,expectedType:"string|ArrayBuffer",...n}),{content:"",success:!1})}function Re(e,t={}){const{addError:i,addWarning:n,layerName:a="Unknown",allowEmpty:s=!1,cleanWhitespace:o=!1,minSize:r=0,context:c={}}=t;if("string"!=typeof e)return i?.(`${a}: payload is missing or invalid`,{...c,payloadType:typeof e}),null;let l=e.trim();if(0===l.length)return i?.(`${a}: payload is empty`,c),null;if(o&&(l=l.replace(/\s+/g,"").replace(/[\r\n\t]/g,"")),!ze.test(l))return i?.(`${a} payload contains invalid Base64 data`,{...c,payloadLength:l.length,payloadPreview:l.slice(0,50)}),null;if(l.length%4!=0)return i?.(`${a} payload length ${l.length} is not a multiple of 4`,{...c,remainder:l.length%4}),null;if(r&&l.length<r)return i?.(`${a} content too small to contain valid KBF data`,{...c,payloadLength:l.length,minimumExpected:r}),null;try{const e=atob(l);if(!e&&!s)return i?.(`${a} decoding produced empty result`,c),null;if(t.validateContent){const a=t.validateContent(e,c)||{};if(!a.valid){if(!a.warning)return i?.(a.message,a.context),null;n?.(a.message,a.context)}}return e}catch(e){return i?.(`${a} Base64 decoding failed`,{...c,errorType:e.name,errorMessage:e.message,payloadLength:l.length}),null}}function je(e,t,i,n={}){const a={},s={};if(!e||0===e.length)return{values:a,collections:s};const{addError:o,addWarning:r}=i;return e.forEach((e,o)=>{if(!e||!e.fieldName)return void r?.("Skipping empty or invalid record",{...n,recordIndex:o,record:e});const c=e.fieldName.toUpperCase(),l={index:o,record:e,context:n};t.fields&&t.fields[c]?function(e,t,i,n){const{values:a,helpers:s}=n,{addError:o}=s,r=t.key||e.fieldName.toLowerCase();let c;try{c=t.parser(e,i,s)}catch(n){return void o?.(t.errorMessage||`Failed to process ${e.fieldName} at position ${i.index}: ${n.message}`,{...i.context,fieldName:e.fieldName,recordIndex:i.index})}if(void 0!==c)t.allowMultiple?(a[r]||(a[r]=[]),a[r].push(c)):Object.prototype.hasOwnProperty.call(a,r)?(t.onDuplicate&&t.onDuplicate(i,s),"overwrite"===t.duplicateStrategy&&(a[r]=c)):"function"==typeof t.set?t.set(a,c,i,s):a[r]=c}(e,t.fields[c],l,{values:a,helpers:i}):t.collections&&t.collections[c]?function(e,t,i,n){const{collections:a,helpers:s}=n,o=t.key||e.fieldName.toLowerCase();let r;try{r=t.parser(e,i,s)}catch(n){return void s.addError?.(t.errorMessage||`Failed to process ${e.fieldName} at position ${i.index}: ${n.message}`,{...i.context,fieldName:e.fieldName,recordIndex:i.index})}null!=r&&(a[o]||(a[o]=[]),a[o].push(r))}(e,t.collections[c],l,{collections:s,helpers:i}):"function"==typeof t.onUnknown&&t.onUnknown(e,l,i)}),"function"==typeof t.postProcess&&t.postProcess({values:a,collections:s},i,n),{values:a,collections:s}}class Oe{constructor({decoder:e,fieldParser:t,activityTranslator:i,parseState:n}){this.decoder=e,this.fieldParser=t,this.activityTranslator=i,this.parseState=n,this.addError=this.decoder.addError.bind(this.decoder),this.addWarning=this.decoder.addWarning.bind(this.decoder)}run(e,t={}){const{targetEnvironment:i="space",includeMetadata:n=!0}=t,a=this.createEmptyResult(),s=this.decodeLayer1(e);if(!s)return this.finalizeResult(a);const o=this.parseLayer2(s);if(!o.success||0===o.keysets.length)return this.finalizeResult(a);for(const e of o.keysets){const t=this.parseLayer3(e);if(!t.success)continue;const s=t.name;a.bindsets[s]={keys:{},aliases:{},metadata:{}},console.log(`DEBUG: Processing bindset "${s}" with ${t.keys.length} keys`);for(const e of t.keys){const t=this.parseLayer4(e);if(console.log("DEBUG: Layer4 for key:",{success:t.success,hasKey:!!t.key,key:t.key,hasActivities:t.activities?.length||0,errors:t.errors?.length||0}),!t.success){console.log("DEBUG: Skipping key due to layer4 failure");continue}const o=this.activityTranslator.mapKeyToken(t.key,t.modifiers,t.combo);if(!o){this.addWarning(`Failed to create canonical key for token: ${t.key}`,{keyToken:t.key,modifiers:t.modifiers,combo:t.combo});continue}a.bindsets[s].keys[o]={commands:[],metadata:{}};let r=!1;const c=[];for(const e of t.activities){const n=this.parseLayer5(e);if(!n.success)continue;13!==n.activity&&26!==n.activity&&95!==n.activity||(r=!0);const l=[];let d=n.text||"",m=n.text2||"";l.includes(n.activity)&&(d=n.text?this.decodeLayer6(n.text):"",m=n.text2?this.decodeLayer6(n.text2):"");const h={environment:i,bindsetName:s,keyToken:o,modifiers:t.modifiers||{},combo:t.combo||[],sanitize:e=>this.fieldParser.sanitizeBindsetName(e)},u=this.activityTranslator.translateActivity(n.activity,{...h,activity:n.activity,text:d,text2:m,n1:n.n1,n2:n.n2,n3:n.n3,order:n.order}),{commands:p,aliases:f}=this.normalizeTranslationResult(u);p.length>0?(c.push({activity:n.activity,commands:p,order:n.order||0}),f.forEach(e=>{a.aliases[e.name]=e})):a.stats.skippedActivities++}c.sort((e,t)=>e.order-t.order);for(const e of c)a.bindsets[s].keys[o].commands.push(...e.commands);r&&n&&(a.bindsets[s].keys[o].metadata.stabilizeExecutionOrder=!0),a.stats.totalKeys++}a.stats.totalBindsets++}return this.finalizeResult(a)}createEmptyResult(){return{bindsets:{},aliases:{},errors:[],warnings:[],stats:{totalBindsets:0,totalKeys:0,totalAliases:0,processedLayers:[],skippedActivities:0}}}finalizeResult(e){return e.errors=[...this.parseState.errors],e.warnings=[...this.parseState.warnings],e.stats.totalAliases=Object.keys(e.aliases).length,e.stats.processedLayers=[1,2,3,4,5,6],e}decodeLayer1(e){const t=Ke(e,{addError:this.addError,layerName:"Layer 1"});return t.success?Re(t.content,{addError:this.addError,addWarning:this.addWarning,layerName:"Layer 1",minSize:8,cleanWhitespace:!0}):""}parseLayer2(e){const t={keysets:[]};if("string"!=typeof e)return this.addError("Invalid Layer 2 content: expected string",{contentType:typeof e}),{...t,success:!1};const i=e.trim();if(0===i.length)return this.addError("Layer 2 content is empty after trimming"),{...t,success:!1};const n=this.fieldParser.parseSemicolonRecords(i);if(0===n.length)return this.addError("No records found in Layer 2 content",{decodedLength:i.length}),{...t,success:!1};const a=[];let s=null;if(n.forEach((e,t)=>{if(e&&e.fieldName)switch(e.fieldName.toUpperCase()){case"GROUPSET":{const t=this.fieldParser.parseGroupsetRecord(e);t&&(s=t);break}case"KEYSET":{const i=this.fieldParser.parseKeysetRecord(e,t);i&&(i.recordIndex=t,a.push(i));break}default:this.addWarning(`Ignoring unknown Layer 2 record type: ${e.fieldName}`,{recordIndex:t,fieldName:e.fieldName})}else this.addWarning("Skipping empty or invalid record in Layer 2",{recordIndex:t,record:e})}),0===a.length)return this.addError("No KEYSET records found in Layer 2 content - KEYSET wrapper is required",{foundRecords:n.length,hasGroupset:!!s}),{...t,success:!1};const o=a.filter(e=>e&&e.payload);return 0===o.length&&this.addError("All KEYSET records were invalid or empty",{originalCount:a.length}),o.forEach(e=>{e.groupsetVersion=s}),{...t,keysets:o,success:!0}}parseLayer3(e){if(!e||"object"!=typeof e)return this.addError("Invalid keysetRecord parameter for Layer 3 parsing",{keysetRecord:e,expectedType:"object"}),{success:!1};const t=Re(e.payload,{addError:this.addError,addWarning:this.addWarning,layerName:"Layer 3",context:{recordIndex:e.recordIndex}});if(!t)return{success:!1};const i=this.fieldParser.parseSemicolonRecords(t);0===i.length&&this.addError("No records found in KEYSET payload",{recordIndex:e.recordIndex,decodedLength:t.length});const n={keysetRecordIndex:e.recordIndex},a={fields:{NAME:{key:"name",parser:(e,t)=>this.fieldParser.parseNameField(e,t.index),set:(e,t)=>{t&&(e.name=t.sanitized,e.displayName=t.display)},onDuplicate:t=>this.addWarning("Multiple NAME fields found in KEYSET, using first one",{keysetRecordIndex:e.recordIndex,recordIndex:t.index})}},collections:{KEY:{key:"keys",parser:(t,i)=>this.fieldParser.parseKeyField(t,i.index,e.recordIndex)}},onUnknown:(t,i)=>{this.addWarning(`Ignoring unknown KEYSET record type: ${t.fieldName}`,{keysetRecordIndex:e.recordIndex,recordIndex:i.index,fieldName:t.fieldName,hasValue:!!t.value}),t.fieldName.toUpperCase().includes("UNKNOWN")&&this.addWarning(`Ignoring UNKNOWN record type: ${t.fieldName}`,{keysetRecordIndex:e.recordIndex,recordIndex:i.index,fieldName:t.fieldName,hasValue:!!t.value})},postProcess:({values:t,collections:i})=>{if(!t.name){const i=`Imported_Keyset_${e.recordIndex}`;t.name=this.fieldParser.sanitizeBindsetName(i),t.displayName=i,this.addWarning("No NAME field found in KEYSET, using generated name",{keysetRecordIndex:e.recordIndex,generatedName:i})}i.keys&&0!==i.keys.length||this.addError("No KEY entries found in KEYSET",{keysetRecordIndex:e.recordIndex,keysetName:t.displayName})}},{values:s,collections:o}=je(i,a,this.helpers(),n);return{recordIndex:e?.recordIndex||0,name:s.name,displayName:s.displayName,keys:o.keys||[],groupsetVersion:e.groupsetVersion||null,success:!0}}parseLayer4(e){const t={recordIndex:e?.recordIndex||0,keysetRecordIndex:e?.keysetRecordIndex||0};let i;const n=()=>({recordIndex:t.recordIndex,keysetRecordIndex:t.keysetRecordIndex,key:null,priorityOrder:0,modifiers:{control:!1,alt:!1,shift:!1},combo:[],activities:[],success:!1});if("string"==typeof e)i=e;else{if(!e||"object"!=typeof e||!e.payload)return this.addError("Invalid keyData parameter for Layer 4 parsing",{keyData:e,expectedType:"string|object"}),n();i=e.payload,t.recordIndex=e.recordIndex||0,t.keysetRecordIndex=e.keysetRecordIndex||0}if(null==i)return this.addError("KEY payload is missing, invalid, or empty",{...t,payloadType:typeof i}),n();if("string"!=typeof i)return this.addError("KEY payload is missing, invalid, or empty",{...t,payloadType:typeof i}),n();const a=i.trim();if(0===a.length)return this.addError("KEY payload is empty",{...t}),n();const s=Re(a,{addError:this.addError,addWarning:this.addWarning,layerName:"Layer 4",context:t,errorMessages:{invalidBase64:"KEY payload contains invalid Base64 data",decodeFailed:"Layer 4 Base64 decoding failed",emptyResult:"Layer 4 decoding produced empty result"}});if(!s)return n();const o=this.fieldParser.parseSemicolonRecords(s);if(0===o.length)return this.addError("No records found in KEY payload",{recordIndex:t.recordIndex,decodedLength:s.length}),n();const r={fields:{KEY:{key:"key",parser:(e,t)=>this.fieldParser.parseKeyTokenField(e,t.index),onDuplicate:e=>this.addWarning("Multiple Key fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e.index})},PRIORITYORDER:{key:"priorityOrder",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"PriorityOrder",0,1),onDuplicate:e=>this.addWarning("Multiple PriorityOrder fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e.index})},CONTROL:{key:"control",parser:(e,t)=>this.fieldParser.parseBooleanField(e,t.index,"Control"),onDuplicate:e=>this.addWarning("Multiple Control fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e.index})},ALT:{key:"alt",parser:(e,t)=>this.fieldParser.parseBooleanField(e,t.index,"Alt"),onDuplicate:e=>this.addWarning("Multiple Alt fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e.index})},SHIFT:{key:"shift",parser:(e,t)=>this.fieldParser.parseBooleanField(e,t.index,"Shift"),onDuplicate:e=>this.addWarning("Multiple Shift fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e.index})},COMBO:{key:"combo",parser:(e,t)=>this.fieldParser.parseComboField(e,t.index),onDuplicate:e=>this.addWarning("Multiple Combo fields found in KEY, using first one",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:e.index})}},collections:{ACT:{key:"activities",parser:(e,t)=>this.fieldParser.parseActivityField(e,t.index)}},onUnknown:(e,i)=>{this.addWarning(`Ignoring unknown KEY record type: ${e.fieldName}`,{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex,fieldIndex:i.index,fieldName:e.fieldName,hasValue:!!e.value})}},{values:c,collections:l}=je(o,r,this.helpers(),{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex});return c.key?{recordIndex:t.recordIndex,keysetRecordIndex:t.keysetRecordIndex,key:c.key,priorityOrder:c.priorityOrder||0,modifiers:{control:!!c.control,alt:!!c.alt,shift:!!c.shift},combo:c.combo||[],activities:l.activities||[],success:!0}:(this.addError("Missing required Key field in KEY payload",{keysetRecordIndex:t.keysetRecordIndex,recordIndex:t.recordIndex}),n())}parseLayer5(e){const{payload:t,context:i}=this.extractPayload(e),n=()=>({activity:null,text:null,text2:null,n1:null,n2:null,n3:null,order:0,fieldIndex:i.fieldIndex,recordIndex:i.recordIndex,keysetRecordIndex:i.keysetRecordIndex,success:!1});let a=t;if("object"==typeof e&&e?.payload&&(a=e.payload),!a||"string"!=typeof a)return this.addError("ACT payload is missing, invalid, or empty",{...i,payloadType:typeof a}),n();const s=a.trim();if(0===s.length)return this.addError("ACT payload is empty",i),n();const o=Re(s,{addError:this.addError,addWarning:this.addWarning,layerName:"Layer 5",context:{fieldIndex:i.fieldIndex,recordIndex:i.recordIndex,keysetRecordIndex:i.keysetRecordIndex},errorMessages:{invalidBase64:"ACT payload contains invalid Base64 data",decodeFailed:"Layer 5 Base64 decoding failed",emptyResult:"Layer 5 decoding produced empty result"}});if(!o)return n();const r=this.fieldParser.parseSemicolonRecords(o);if(0===r.length)return this.addError("No records found in ACT payload",{fieldIndex:i.fieldIndex,decodedLength:o.length}),n();const c={fields:{ACTIVITY:{key:"activity",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"Activity"),onDuplicate:e=>this.addWarning("Multiple Activity fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},TEXT:{key:"text",parser:(e,t)=>this.fieldParser.parseBase64TextField(e,t.index),onDuplicate:e=>this.addWarning("Multiple Text fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},TEXT2:{key:"text2",parser:(e,t)=>this.fieldParser.parseBase64TextField(e,t.index),onDuplicate:e=>this.addWarning("Multiple Text2 fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},N1:{key:"n1",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"N1"),onDuplicate:e=>this.addWarning("Multiple N1 fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},N2:{key:"n2",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"N2"),onDuplicate:e=>this.addWarning("Multiple N2 fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},N3:{key:"n3",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"N3"),onDuplicate:e=>this.addWarning("Multiple N3 fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},ORDER:{key:"order",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"Order"),onDuplicate:e=>this.addWarning("Multiple Order fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})},O:{key:"order",parser:(e,t)=>this.fieldParser.parseNumericField(e,t.index,"O",0),onDuplicate:e=>this.addWarning("Multiple O fields found in ACT, using first one",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:e.index})}},onUnknown:(e,t)=>this.addWarning(`Ignoring unknown ACT record type: ${e.fieldName}`,{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activityFieldIndex:t.index,fieldName:e.fieldName,hasValue:!!e.value})},{values:l}=je(r,c,this.helpers(),{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex});return void 0===l.activity||null===l.activity?(this.addError("Missing required Activity field in ACT payload",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex}),n()):((l.activity<0||l.activity>123)&&this.addWarning("Activity ID outside valid range (0-123)",{keysetRecordIndex:i.keysetRecordIndex,recordIndex:i.recordIndex,fieldIndex:i.fieldIndex,activity:l.activity}),{activity:l.activity,text:void 0!==l.text?l.text:null,text2:void 0!==l.text2?l.text2:null,n1:void 0!==l.n1&&null!==l.n1?l.n1:null,n2:void 0!==l.n2&&null!==l.n2?l.n2:null,n3:void 0!==l.n3&&null!==l.n3?l.n3:null,order:void 0!==l.order&&null!==l.order?l.order:0,fieldIndex:i.fieldIndex,recordIndex:i.recordIndex,keysetRecordIndex:i.keysetRecordIndex,success:!0})}decodeLayer6(e){if(null==e)return"";if("string"!=typeof e)return this.addError("Invalid input for Layer 6 decoding: expected string",{inputType:typeof e,isEmpty:!e}),"";const t=e.trim();if(0===t.length)return"";const i=Re(t,{addError:this.addError,addWarning:this.addWarning,layerName:"Layer 6",context:{fieldName:"text"}});if(!i)return"";const n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);return function(e,t={}){const{addError:i,addWarning:n,validateUtf8:a=!0,context:s={}}=t;if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))return i?.("UTF-8 bytes must be a Uint8Array or ArrayBuffer",{constructorName:e?.constructor?.name,...s}),"";const o=e instanceof ArrayBuffer?new Uint8Array(e):e;if(0===o.length)return n?.("UTF-8 byte array is empty",s),"";try{return new TextDecoder("utf-8",{fatal:a}).decode(o)}catch(e){i?.(`UTF-8 decoding failed: ${e.name}: ${e.message}`,{...s,errorType:e.name,errorMessage:e.message,inputLength:o.length});try{return new TextDecoder("utf-8",{fatal:!1}).decode(o)}catch(t){return i?.(`UTF-8 fallback decoding failed: ${t.message}`,{...s,originalError:e.message,fallbackError:t.message}),""}}}(n,{addError:this.addError,addWarning:this.addWarning,validateUtf8:this.decoder.options.validateUtf8,context:{fieldName:"text"}})}extractPayload(e,t={}){const i={recordIndex:e?.recordIndex||t.recordIndex||0,keysetRecordIndex:e?.keysetRecordIndex||t.keysetRecordIndex||0,fieldIndex:e?.fieldIndex||t.fieldIndex||0};return"string"==typeof e?{payload:e,context:i}:e&&"object"==typeof e&&e.payload?{payload:e.payload,context:{...i,...e}}:{payload:null,context:i}}normalizeTranslationResult(e){if(!e)return{commands:[],aliases:[]};let t=[];const i=[];return Array.isArray(e?.aliases)&&i.push(...e.aliases),e.commands&&Array.isArray(e.commands)?t=e.commands:Array.isArray(e)&&e.forEach(e=>{Array.isArray(e?.forward)&&t.push(...e.forward),(e=>{e&&Array.isArray(e.aliases)&&i.push(...e.aliases)})(e)}),{commands:t,aliases:i}}helpers(){return{addError:this.addError,addWarning:this.addWarning}}}class Ue{constructor(e={}){this.options={validateUtf8:!0,strictMode:!1,maxFileSize:1048576,...e},this.eventBus=e.eventBus||c,this.parseState=new Le(this.eventBus),this.fieldParser=new Me({...e,decoder:this}),this.activityTranslator=new Ne({...e,decoder:this}),this.pipeline=new Oe({decoder:this,fieldParser:this.fieldParser,activityTranslator:this.activityTranslator,parseState:this.parseState})}parseFile(e,t={}){this.resetParseState();try{return this.pipeline.run(e,{targetEnvironment:t.targetEnvironment||"space",includeMetadata:void 0===t.includeMetadata||t.includeMetadata})}catch(e){return this.addError(`Critical parsing error: ${e.message}`,{error:e.name,stack:e.stack}),this.buildParseResult()}}buildParseResult(){return{bindsets:{},aliases:{},errors:[...this.parseState.errors],warnings:[...this.parseState.warnings],stats:{totalBindsets:0,totalKeys:0,totalAliases:0,processedLayers:[],skippedActivities:0}}}validateFormat(e){const t=Date.now(),i={isValid:!1,isKBF:!1,estimatedSize:0,estimatedKeysets:0,format:"unknown",errors:[],warnings:[],processingTime:0},n="string"==typeof e?e.length:e&&"object"==typeof e&&void 0!==e.byteLength?e.byteLength:0,a=e=>i.errors.push(e),s=e=>i.warnings.push(e);try{if(!e)return a("No content provided for validation"),i;const t=Ke(e,{addError:e=>a(e),layerName:"Validation"});if(!t.success)return i;let o=t.content;if(i.estimatedSize=n,"string"==typeof o&&(i.estimatedSize=Math.max(i.estimatedSize,o.length)),o.length<8)return a("Content too small to be a valid KBF file"),i;const r=o.trim().replace(/\s+/g,"").replace(/[\r\n\t]/g,"");if(!/^[A-Za-z0-9+/]*={0,2}$/.test(r))return a("Invalid Base64 format"),i;if(r.length<8)return a("Base64 content too small to contain valid KBF data"),i;const c=Re(r,{addError:e=>a(e),addWarning:e=>s(e),layerName:"Validation"});if(!c||0===c.length)return a("Base64 decoding produced empty result"),i;const l=c.includes(";"),d=c.includes("KEYSET:"),m=c.includes("GROUPSET:");if(!d&&!m)return a("Content does not appear to be a valid KBF format - KEYSET or GROUPSET markers required"),i;if(!l)return a("Invalid KBF format - missing semicolon record delimiters"),i;i.isKBF=!0,i.format=m?"kbf-groupset":"kbf-keyset";const h=(c.match(/KEYSET:/g)||[]).length;i.estimatedKeysets=Math.max(1,h);const u=/^[A-Z_]+:[^;]*;/gm,p=(c.match(u)||[]).length,f=(c.match(/;/g)||[]).length;f>0&&p/f<.8&&s("Many records appear to have invalid format"),i.isValid=i.isKBF}catch(e){a(`Validation error: ${e.message}`),i.isValid=!1}finally{i.processingTime=Date.now()-t}return i}addError(e,t={}){const i={message:e,layer:this.parseState.currentLayer,...void 0!==t.recordIndex&&{recordIndex:t.recordIndex},...void 0!==t.timestamp&&{timestamp:t.timestamp},...void 0!==t.recoverable&&{recoverable:t.recoverable},...Object.fromEntries(Object.entries(t).filter(([e])=>!["recordIndex","timestamp","recoverable","category","severity","fieldName","recordType","suggestion"].includes(e)))};if(this.parseState.errors.push(i),this.options.strictMode&&"critical"===t.severity)throw new Error(`KBF Decoder Critical Error [Layer ${this.parseState.currentLayer}]: ${e}`)}addWarning(e,t={}){const i={message:e,layer:this.parseState.currentLayer,...void 0!==t.recordIndex&&{recordIndex:t.recordIndex},...Object.fromEntries(Object.entries(t).filter(([e])=>!["category","severity","fieldName","recordType","suggestion"].includes(e)))};this.parseState.warnings.push(i)}isValidBase64(e){return function(e){try{return btoa(atob(e))===e}catch{return!1}}(e)}decodeLayer1(e){return this.pipeline.decodeLayer1(e)}parseLayer2(e){return this.pipeline.parseLayer2(e)}parseLayer3(e){return this.pipeline.parseLayer3(e)}parseLayer4(e){return this.pipeline.parseLayer4(e)}parseLayer5(e){return this.pipeline.parseLayer5(e)}decodeLayer6(e){return this.pipeline.decodeLayer6(e)}resetParseState(){this.parseState.reset()}}class qe{constructor(e={}){this.eventBus=e.eventBus||c,this.decoder=new Ue({...e,eventBus:this.eventBus})}parseFile(e,t={}){return this.decoder.parseFile(e,t)}}class Ge extends re{constructor({eventBus:e,storage:t,i18n:i,ui:n}={}){super(e),this.componentName="ImportService",this.storage=t,this.i18n=i,this.ui=n,this.kbfParser=new qe({eventBus:e})}setupRequestHandlers(){this.eventBus&&(this.respond("import:keybind-file",({content:e,profileId:t,environment:i,options:n={},strategy:a})=>{const s=["merge_keep","merge_overwrite","overwrite_all"].includes(a)?a:"merge_keep";return this.importKeybindFile(e,t,i,{...n,strategy:s})}),this.respond("import:alias-file",({content:e,profileId:t,options:i={},strategy:n})=>{const a=["merge_keep","merge_overwrite","overwrite_all"].includes(n)?n:"merge_keep";return this.importAliasFile(e,t,{...i,strategy:a})}),this.respond("import:kbf-file",({content:e,profileId:t,environment:i,options:n={},strategy:a,configuration:s})=>{const o=["merge_keep","merge_overwrite","overwrite_all"].includes(a)?a:n.strategy||"merge_keep";return this.importKBFFile(e,t,i,{...n,strategy:o},s)}),this.respond("import:project-file",({content:e,options:t={}})=>this.importProjectFile(e,t)),this.respond("import:from-file",({file:e})=>this.importFromFile(e)),this.respond("import:validate-keybind-file",({content:e})=>this.validateKeybindFile(e)),this.respond("import:validate-kbf-file",({content:e})=>this.validateKBFFile(e)),this.respond("parse-kbf-file",({content:e,environment:t})=>this.parseKBFFile(e,t)))}async parseKeybindFile(e){const t={},i=[];if(!e||"string"!=typeof e)return{keybinds:t,errors:["Invalid file content"]};const n=e.split("\n");for(let e=0;e<n.length;e++){const a=n[e].trim();if(a&&!a.startsWith(";")&&!a.startsWith("#"))try{const n=a.match(/^(\S+)\s+"([^"]+)"/);if(n){const[,e,i]=n,a=ke(e),s=await this.request("parser:parse-command-string",{commandString:i});t[a]={raw:i,commands:s.commands};continue}if(a.startsWith("alias "))continue;a.length>0&&i.push(`Line ${e+1}: Unrecognized format: ${a}`)}catch(t){i.push(`Line ${e+1}: Parse error: ${t.message}`)}}return{keybinds:t,errors:i}}async parseAliasFile(e){const t={},i=[];if(!e||"string"!=typeof e)return{aliases:t,errors:["Invalid file content"]};const n=e.split("\n");for(let e=0;e<n.length;e++){const a=n[e].trim();if(a&&!a.startsWith(";")&&!a.startsWith("#"))try{const n=a.match(/^alias\s+(\w+)\s+"([^"]+)"/);if(n){const[,e,i]=n;t[e]={commands:i};continue}const s=a.match(/^alias\s+(\w+)\s+<&\s*(.+?)\s*&>/);if(s){const[,e,i]=s;t[e]={commands:i};continue}if(a.match(/^[A-Z]\d+\s+"[^"]+"/))continue;a.length>0&&i.push(`Line ${e+1}: Unrecognized alias format: ${a}`)}catch(t){i.push(`Line ${e+1}: Parse error: ${t.message}`)}}return{aliases:t,errors:i}}async importKeybindFile(e,t,i,{strategy:n="merge_keep"}={}){try{const a=await this.parseKeybindFile(e);if(0===Object.keys(a.keybinds).length)return{success:!1,error:"no_keybinds_found_in_file"};if(!this.storage)return{success:!1,error:"storage_not_available"};if(!t)return{success:!1,error:"no_active_profile"};const s=["space","ground"];if(i){if(!s.includes(i))return{success:!1,error:"invalid_environment",params:{environment:i,validEnvironments:s}}}else console.warn("[ImportService] No environment specified for keybind import, defaulting to space"),i="space";const o=this.storage.getProfile(t)||{builds:{space:{keys:{}},ground:{keys:{}}}};o.builds||(o.builds={space:{keys:{}},ground:{keys:{}}});const r=i;o.builds[r]||(o.builds[r]={keys:{}});const c=o.builds[r].keys;let l=0,d=0,m=0,h=0;if("overwrite_all"===n){const e=Object.keys(c);h=e.length,Object.keys(c).forEach(e=>delete c[e]),o.keybindMetadata&&o.keybindMetadata[i]&&e.forEach(e=>{delete o.keybindMetadata[i][e]})}for(const[e,t]of Object.entries(a.keybinds)){const a=t.raw;if("merge_keep"===n&&c.hasOwnProperty(e)){d++;continue}"merge_overwrite"===n&&c.hasOwnProperty(e)&&m++;const s=await this.request("parser:parse-command-string",{commandString:a});let r=[];if(s.isMirrored){const t=this.extractOriginalFromMirrored(a),n=_e((await this.request("parser:parse-command-string",{commandString:t.join(" $$ ")})).commands),s=[];for(const e of n){const t=await ye(e,{eventBus:this.eventBus});s.push(t)}r=s,o.keybindMetadata||(o.keybindMetadata={}),o.keybindMetadata[i]||(o.keybindMetadata[i]={}),o.keybindMetadata[i][e]||(o.keybindMetadata[i][e]={}),o.keybindMetadata[i][e].stabilizeExecutionOrder=!0}else{const e=_e(t.commands),i=[];for(const t of e){const e=await ye(t,{eventBus:this.eventBus});i.push(e)}r=i}c[e]=r,l++}return this.storage.saveProfile(t,o),this.emit("profile:updated",{profileId:t,profile:o,environment:r}),"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,imported:{keys:l},skipped:d,overwritten:m,cleared:h,errors:a.errors,message:"import_completed_keybinds"}}catch(e){return{success:!1,error:"import_failed",params:{reason:e.message}}}}async importAliasFile(e,t,{strategy:i="merge_keep"}={}){try{const n=await this.parseAliasFile(e);if(0===Object.keys(n.aliases).filter(e=>!e.startsWith("sto_kb_")).length)return{success:!1,error:"no_aliases_found_in_file"};if(!this.storage||!t)return{success:!1,error:"no_active_profile"};const a=this.storage.getProfile(t)||{aliases:{}};a.aliases||(a.aliases={});let s=0,o=0,r=0,c=0;if("overwrite_all"===i){const e=Object.keys(a.aliases);c=e.length,Object.keys(a.aliases).forEach(e=>delete a.aliases[e]),a.aliasMetadata&&e.forEach(e=>{delete a.aliasMetadata[e]})}for(const[e,t]of Object.entries(n.aliases)){if(e.startsWith("sto_kb_"))continue;if("merge_keep"===i&&a.aliases.hasOwnProperty(e)){o++;continue}"merge_overwrite"===i&&a.aliases.hasOwnProperty(e)&&r++;const n=t.commands||"",c=n.trim()?n.trim().split(/\s*\$\$\s*/).filter(e=>e.trim()):[],l=[];for(const e of c){const t=await ye(e,{eventBus:this.eventBus});l.push(t)}a.aliases[e]={commands:l,description:t.description||""},s++}return this.storage.saveProfile(t,a),this.emit("profile:updated",{profileId:t,profile:a}),"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,imported:{aliases:s},skipped:o,overwritten:r,cleared:c,errors:n.errors,message:"import_completed_aliases"}}catch(e){return{success:!1,error:"import_failed",params:{reason:e.message}}}}async importKBFFile(e,t,i,{strategy:n="merge_keep"}={},a=null){const s=[],o=[];if(!e||"string"!=typeof e)return{success:!1,error:"invalid_kbf_file_content",message:"Invalid KBF file content: expected string data",errors:["File content validation failed"]};if(!this.storage)return{success:!1,error:"storage_not_available",message:"Storage service not available for KBF import"};if(!t)return{success:!1,error:"no_active_profile",message:"No active profile specified for KBF import"};const r=["space","ground"];if(i){if(!r.includes(i))return{success:!1,error:"invalid_environment",message:`Invalid environment "${i}" specified for KBF import`,params:{environment:i,validEnvironments:r}}}else i="space",o.push("No environment specified, defaulting to space");try{const r=this.kbfParser.decoder.validateFormat(e);if(!r.isValid||!r.isKBF)return{success:!1,error:"invalid_kbf_file_format",message:"Invalid KBF file format",errors:r.errors||[],warnings:r.warnings||[]};r.warnings&&o.push(...r.warnings);const c=await this.kbfParser.parseFile(e,{targetEnvironment:i,includeMetadata:!0});if(c.errors&&s.push(...c.errors.map(e=>e.message||e)),c.warnings&&o.push(...c.warnings.map(e=>e.message||e)),Object.values(c.bindsets||{}).forEach(e=>{e.space?.aliases&&delete e.space.aliases,e.ground?.aliases&&delete e.ground.aliases}),0===c.stats.totalBindsets)return{success:!1,error:"no_valid_bindsets_found",message:"KBF file contains no valid bindsets that could be imported",errors:s,warnings:o};let l=this.storage.getProfile(t);if(!l)return{success:!1,error:"profile_not_found",message:`Profile with ID "${t}" not found`,errors:s,warnings:o};l.builds||(l.builds={}),l.builds[i]?(l.builds[i].keys||(l.builds[i].keys={}),l.builds[i].aliases||(l.builds[i].aliases={})):l.builds[i]={keys:{},aliases:{}},l.bindsets||(l.bindsets={}),l.aliases||(l.aliases={}),l.keybindMetadata||(l.keybindMetadata={}),l.aliasMetadata||(l.aliasMetadata={}),l.bindsetMetadata||(l.bindsetMetadata={});let d=0,m=0,h=0,u=0,p=0,f=!1,y=null;const _=Object.keys(c.bindsets),g=1===_.length,b=g&&"master"===_[0].toLowerCase();let v=!0;try{const e=await this.request("preferences:get-settings");v=e?.bindsetsEnabled??!0}catch(e){o.push("Could not retrieve bindsets preference, defaulting to enabled")}let w=_,k={},S={};if(a){if(w=a.selectedBindsets||_,k=a.bindsetRenames||{},S=a.bindsetMappings||{},!v&&w.length>1)return{success:!1,error:"multiple_bindsets_not_allowed",message:"Multiple bindset import is not allowed when bindsets are disabled",errors:[`Configuration specifies ${w.length} bindsets but bindsetsEnabled = false`],warnings:o}}else b&&(S[_[0]]="primary");if(!v&&w.length>0)for(const e of w){const t=S[e]||"primary";if("primary"!==t)return{success:!1,error:"non_primary_mapping_not_allowed",message:"Bindsets can only be mapped to primary bindset when bindsets are disabled",errors:[`Bindset "${e}" is mapped to "${t}" but only "primary" is allowed when bindsetsEnabled = false`],warnings:o}}if("overwrite_all"===n)for(const[e,t]of Object.entries(c.bindsets)){if(!w.includes(e))continue;const t=S[e]||"custom",n=k[e]||e;if("primary"===t){const e=Object.keys(l.builds[i].keys||{});p+=e.length,Object.keys(l.builds[i].keys||{}).forEach(e=>delete l.builds[i].keys[e]),l.keybindMetadata&&l.keybindMetadata[i]&&e.forEach(e=>{delete l.keybindMetadata[i][e]})}else{const e=n;l.bindsets||(l.bindsets={}),l.bindsets[e]||(l.bindsets[e]={space:{keys:{}},ground:{keys:{}}});const t=Object.keys(l.bindsets[e][i].keys||{});p+=t.length,Object.keys(l.bindsets[e][i].keys||{}).forEach(t=>delete l.bindsets[e][i].keys[t]),l.bindsetMetadata&&l.bindsetMetadata[e]&&l.bindsetMetadata[e][i]&&t.forEach(t=>{delete l.bindsetMetadata[e][i][t]})}}for(const[e,t]of Object.entries(c.bindsets))if(w.includes(e))try{const a=S[e]||"custom",s=k[e]||e;if("primary"===a){f=!0,y=e;for(const[a,s]of Object.entries(t.keys||{}))try{let e=s,t={};if(s&&"object"==typeof s&&s.commands&&(e=s.commands,t=s.metadata||{}),"merge_keep"===n&&l.builds[i].keys.hasOwnProperty(a)){h++;continue}"merge_overwrite"===n&&l.builds[i].keys.hasOwnProperty(a)&&u++;const o=_e(e);l.builds[i].keys[a]=o,d++,t.stabilizeExecutionOrder&&(l.keybindMetadata||(l.keybindMetadata={}),l.keybindMetadata[i]||(l.keybindMetadata[i]={}),l.keybindMetadata[i][a]||(l.keybindMetadata[i][a]={}),l.keybindMetadata[i][a].stabilizeExecutionOrder=!0)}catch(t){console.warn(`Failed to process key "${a}" in primary bindset "${e}": ${t.message}`)}}else{const e=s;l.bindsets||(l.bindsets={}),l.bindsets[e]||(l.bindsets[e]={space:{keys:{}},ground:{keys:{}}});for(const[a,s]of Object.entries(t.keys||{}))try{let t=s,o={};s&&"object"==typeof s&&s.commands&&(t=s.commands,o=s.metadata||{});const r=l.bindsets[e][i].keys||{};if("merge_keep"===n&&r.hasOwnProperty(a)){h++;continue}"merge_overwrite"===n&&r.hasOwnProperty(a)&&u++;const c=_e(t);l.bindsets[e][i].keys[a]=c,d++,o.stabilizeExecutionOrder&&(l.bindsetMetadata||(l.bindsetMetadata={}),l.bindsetMetadata[e]||(l.bindsetMetadata[e]={}),l.bindsetMetadata[e][i]||(l.bindsetMetadata[e][i]={}),l.bindsetMetadata[e][i][a]||(l.bindsetMetadata[e][i][a]={}),l.bindsetMetadata[e][i][a].stabilizeExecutionOrder=!0)}catch(t){console.warn(`Failed to process key "${a}" in bindset "${e}": ${t.message}`)}}}catch(t){s.push(`Critical error processing bindset "${e}": ${t.message}`)}if(c.aliases&&Object.keys(c.aliases).length>0)for(const[e,t]of Object.entries(c.aliases))try{const i=_e(t.commands||[]);l.aliases[e]={commands:i,description:t.description||"",metadata:t.metadata||{}},m++}catch(t){console.warn(`Failed to process global alias "${e}": ${t.message}`)}return this.storage.saveProfile(t,l),this.emit("profile:updated",{profileId:t,profile:l,environment:i}),"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,message:"kbf_import_completed",imported:{bindsets:w.length,keys:d,aliases:m},skipped:h,overwritten:u,cleared:p,stats:{processedLayers:c.stats.processedLayers,skippedActivities:c.stats.skippedActivities,totalActivities:c.stats.totalActivities||0,totalErrors:s.length,totalWarnings:o.length},errors:s,warnings:o,bindsetNames:Object.keys(c.bindsets),masterBindset:{hasMasterBindset:Object.keys(c.bindsets).some(e=>"master"===e.toLowerCase()),masterBindsetName:Object.keys(c.bindsets).find(e=>"master"===e.toLowerCase()),mappedToPrimary:f,displayName:f?"Primary Bindset":null},singleBindsetFile:{isSingleBindset:g,onlyBindsetIsMaster:b,requiresBindsetSelection:!g&&c.stats.totalBindsets>1,totalBindsetsAvailable:c.stats.totalBindsets,selectedBindsetsCount:w.length}}}catch(e){return{success:!1,error:"kbf_import_critical_error",message:`Critical error during KBF import: ${e.message}`,errors:[...s,e.message],warnings:o}}}async importProjectFile(e,t={}){try{const i=JSON.parse(e);if(!i.data||"project"!==i.type)return{success:!1,error:"invalid_project_file"};const n=i.data;let a=0,s=!1;if(n.profiles)for(const[e,t]of Object.entries(n.profiles)){const i=this.sanitizeProfileData(t);this.storage.saveProfile(e,i),a++}if(n.settings&&!1!==t.importSettings){const e=this.storage.getSettings()||{},t={...e,...n.settings,version:e.version||n.settings.version,firstRun:e.firstRun};this.storage.saveSettings(t),s=!0}return"undefined"!=typeof globalThis&&globalThis.app?.setModified&&globalThis.app.setModified(!0),{success:!0,message:"project_imported_successfully",imported:{profiles:a,settings:s},currentProfile:n.settings?.currentProfile||null}}catch(e){return{success:!1,error:"import_failed_invalid_json",params:{reason:e.message}}}}async importFromFile(e){const t=await e.text(),i=e.name.toLowerCase();if(!i.endsWith(".json")){if(i.endsWith(".txt")){const e=this.getCurrentProfileId();if(!e)throw new Error(this.i18n.t("no_profile_selected_for_import"));return this.importKeybindFile(t,e)}throw new Error(this.i18n.t("import_failed_unsupported_format"))}try{const e=JSON.parse(t);if("project"===e.type)return this.importProjectFile(t);if(e.name)return this.importProfileFile(t);throw new Error("Unknown JSON file format")}catch(e){throw new Error(this.i18n.t("import_failed_invalid_json"))}}async validateKeybindFile(e){try{const t=await this.parseKeybindFile(e);return{valid:!0,stats:{keybinds:Object.keys(t.keybinds).length,aliases:Object.keys(t.aliases).length,errors:t.errors.length},errors:t.errors}}catch(e){return{valid:!1,error:e.message}}}validateKBFFile(e){try{if(!e||"string"!=typeof e)return{valid:!1,error:"Invalid file content: expected string",errors:["No content provided for validation"]};const t=this.kbfParser.decoder.validateFormat(e);return{valid:t.isValid,format:t.format,isKBF:t.isKBF,stats:{estimatedSize:t.estimatedSize,estimatedKeysets:t.estimatedKeysets,processingTime:t.processingTime,errors:t.errors.length,warnings:t.warnings.length},errors:t.errors,warnings:t.warnings,supportedFormat:t.isKBF,rejectionReason:t.isKBF?null:"Invalid KBF file format"}}catch(e){return{valid:!1,error:`KBF validation error: ${e.message}`,errors:[e.message]}}}async parseKBFFile(e,t){const i=[],n=[];if(!e||"string"!=typeof e)return{valid:!1,error:"invalid_kbf_file_content",message:"Invalid KBF file content: expected string data",errors:["File content validation failed"]};const a=["space","ground"];if(t){if(!a.includes(t))return{valid:!1,error:"invalid_environment",message:`Invalid environment "${t}" specified for KBF parsing`,params:{environment:t,validEnvironments:a}}}else t="space",n.push("No environment specified, defaulting to space");try{const a=this.kbfParser.decoder.validateFormat(e);if(!a.isValid||!a.isKBF)return{valid:!1,error:"invalid_kbf_file_format",message:"Invalid KBF file format",errors:a.errors||[],warnings:a.warnings||[]};a.warnings&&n.push(...a.warnings);const s=await this.kbfParser.parseFile(e,{targetEnvironment:t,includeMetadata:!0});if(s.errors&&i.push(...s.errors.map(e=>e.message||e)),s.warnings&&n.push(...s.warnings.map(e=>e.message||e)),Object.values(s.bindsets||{}).forEach(e=>{e.space?.aliases&&delete e.space.aliases,e.ground?.aliases&&delete e.ground.aliases}),0===s.stats.totalBindsets)return{valid:!1,error:"no_valid_bindsets_found",message:"KBF file contains no valid bindsets that could be imported",errors:i,warnings:n};const o=Object.keys(s.bindsets),r=o.some(e=>"master"===e.toLowerCase()),c=1===o.length,l=c&&"master"===o[0].toLowerCase(),d={};o.forEach(e=>{const t=s.bindsets[e];let i=0;t.keys&&"object"==typeof t.keys&&(i=Object.keys(t.keys).length),d[e]=i});let m="Primary Bindset";if(r){const e=s.bindsets[o.find(e=>"master"===e.toLowerCase())];e?.metadata?.displayName&&(m=e.metadata.displayName)}return{valid:!0,bindsets:s.bindsets,bindsetNames:o,bindsetKeyCounts:d,hasMasterBindset:r,masterDisplayName:m,metadata:{totalBindsets:s.stats.totalBindsets,estimatedSize:a.estimatedSize,hasAliases:s.aliases&&Object.keys(s.aliases).length>0},validation:{valid:!0,errors:i,warnings:n},singleBindsetFile:{isSingleBindset:c,onlyBindsetIsMaster:l,requiresBindsetSelection:s.stats.totalBindsets>1},requiresBindsetSelection:s.stats.totalBindsets>1}}catch(e){return{valid:!1,error:"kbf_parse_critical_error",message:`Critical error during KBF parsing: ${e.message}`,errors:[...i,e.message],warnings:n}}}getCurrentProfileId(){if("undefined"!=typeof globalThis&&globalThis.app?.getCurrentProfileId)return globalThis.app.getCurrentProfileId();const e=this.storage?.getSettings?.();return e?.currentProfile}extractOriginalFromMirrored(e){const t=e.split(/\s*\$\$\s*/);if(t.length<3||t.length%2==0)return t;const i=Math.floor(t.length/2);return t.slice(0,i+1)}sanitizeProfileData(e){const t={name:e.name,currentEnvironment:e.currentEnvironment||e.mode||"space",builds:{space:{keys:{},aliases:{}},ground:{keys:{},aliases:{}}},aliases:{},keybindMetadata:{},aliasMetadata:{},bindsetMetadata:{}};if(e.builds)e.builds.space&&(t.builds.space={keys:e.builds.space.keys||{},aliases:e.builds.space.aliases||{}}),e.builds.ground&&(t.builds.ground={keys:e.builds.ground.keys||{},aliases:e.builds.ground.aliases||{}});else if(e.keys||e.keybinds){const i=e.keys||e.keybinds||{};t.builds.space.keys=i}return e.aliases&&(t.aliases=e.aliases),e.keybindMetadata&&(t.keybindMetadata=e.keybindMetadata),e.aliasMetadata&&(t.aliasMetadata=e.aliasMetadata),e.bindsetMetadata&&(t.bindsetMetadata=e.bindsetMetadata),t}onInit(){this.setupRequestHandlers(),this.emit("import-service-ready")}}const Ve=globalThis.STO_DATA||{};class Je extends re{constructor({eventBus:e,storage:t,i18n:i}={}){super(e),this.componentName="ExportService",this.storage=t,this.i18n=i}onInit(){this.extendCache({profiles:{}}),this.setupRequestHandlers(),this.setupEventListeners()}setupRequestHandlers(){this.respond("export:generate-filename",async({profile:e,extension:t,environment:i})=>await this.generateFileName(e,t,i)),this.respond("export:generate-alias-filename",({profile:e,extension:t})=>this.generateAliasFileName(e,t)),this.respond("export:import-from-file",async({file:e})=>await this.importFromFile(e)),this.respond("export:extract-keys",({profile:e,environment:t})=>this.extractKeys(e,t)),this.respond("export:generate-keybind-file",async({profileId:e,environment:t="space",syncMode:i=!1})=>{const n=this.getProfileFromCache(e);if(!n)throw new Error(`Profile ${e} not found in ExportService cache`);return await this.generateSTOKeybindFile(n,{environment:t,syncMode:i})}),this.respond("export:generate-alias-file",async({profileId:e})=>{const t=this.getProfileFromCache(e);if(!t)throw new Error(`Profile ${e} not found`);return await this.generateAliasFile(t)}),this.respond("export:sync-to-folder",async({dirHandle:e})=>await this.syncToFolder(e))}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e&&t&&(this.cache.profiles[e]=t)}),this.addEventListener("profile:switched",({profileId:e,environment:t,profile:i})=>{i&&(this.cache.profiles[e]=i)})}le(){return console.log("[ExportService] _getBindToAliasMode called"),console.log("[ExportService] cache:",this.cache),console.log("[ExportService] preferences:",this.cache?.preferences),console.log("[ExportService] bindToAliasMode:",this.cache?.preferences?.bindToAliasMode),this.cache?.preferences?.bindToAliasMode||!1}me(){return console.log("[ExportService] _getBindsetsEnabled called"),console.log("[ExportService] cache:",this.cache),console.log("[ExportService] preferences:",this.cache?.preferences),console.log("[ExportService] bindsetsEnabled:",this.cache?.preferences?.bindsetsEnabled),this.cache?.preferences?.bindsetsEnabled||!1}sanitizeBindsetName(e=""){if(!e)return"";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t=`bs_${t}`),t}async generateBindsetAliasName(e,t,i){const{generateBindToAliasName:n}=await Promise.resolve().then(function(){return ei});return t&&"Primary Bindset"!==t?n(e,i,t):n(e,i)}async generateSTOKeybindFile(e,t={}){const{environment:i="space",syncMode:n=!1}=t,a=this.extractKeys(e,i);if(!(a&&Object.keys(a).length>0))return"; "+this.i18n.t("no_keybinds_to_export")+"\n";const s=`${e.name.replace(/[^a-zA-Z0-9_-]/g,"_")}_${i}.txt`;let o=await this.generateFileHeader(e,s,i);return o+=await this.generateKeybindSection(a,{environment:i,profile:e,syncMode:n}),o}async generateFileHeader(e,t=null,i=null){const n=(new Date).toLocaleString(),a=i||e.currentEnvironment||"space",s=Object.keys(this.extractKeys(e,a)).length;return Object.keys(e.aliases||{}).length,`; ================================================================\n; ${e.name} - STO Keybind Configuration\n; ================================================================\n; ${this.i18n.t("environment")} ${a.toUpperCase()}\n; ${this.i18n.t("generated")} ${n}\n; ${this.i18n.t("created_by")} STO Tools Keybind Manager v${Ve?.settings?.version??"unknown"}\n;\n; ${this.i18n.t("statistics")}:\n; - ${this.i18n.t("total_commands")}: ${s}\n;\n; To use this keybind file in Star Trek Online:\n; 1. Save this file in your STO Live folder as a .txt file\n; 2. In-game, type: /bind_load_file ${t}\n; 3. Your keybinds will be applied immediately\n; ================================================================\n\n`}async generateKeybindSection(e,t={}){const{environment:i="space",syncMode:n=!1,profile:a}=t;if(!e||0===Object.keys(e).length)return"; "+this.i18n.t("no_keybinds_to_export")+"\n";const s=this.le();console.log("[ExportService] this: ",this);let o="; ==============================================================================\n";if(o+=`; ${i.toUpperCase()} KEYBINDS\n`,o+="; ==============================================================================\n\n",s){const{generateBindToAliasName:t}=await Promise.resolve().then(function(){return ei});o+=`; ${this.i18n.t("export_generated_aliases_note")}\n`,o+=`; ${this.i18n.t("export_alias_definitions_note")}\n`,o+="; ------------------------------------------------------------------------------\n";for(const[n,a]of Object.entries(e)){const e=t(i,n);if(!e)continue;const{encodeKeyForExport:a}=await Promise.resolve().then(function(){return Se});o+=`${a(n)} "${e}"\n`}}else for(const[t,n]of Object.entries(e)){let e=n||[];const s=a.keybindMetadata&&a.keybindMetadata[i]&&a.keybindMetadata[i][t]&&a.keybindMetadata[i][t].stabilizeExecutionOrder;s&&Array.isArray(e)&&e.length>1&&(e=this.mirrorCommands(e,s));const r=[];for(const t of e){const e=await ye(t,{eventBus:this.eventBus});r.push(e)}o+=Ce(t,r)}return o+="\n",o}async generateAliasFile(e){const t=e.aliases||{};let i={};try{i=await this.request("vfx:get-virtual-aliases")||{}}catch(e){console.log("[ExportService] VFXManagerService not available, skipping VFX aliases")}const n={};if(this.le()){const{generateBindToAliasName:t}=await Promise.resolve().then(function(){return ei}),i=["space","ground"];for(const a of i){const i=this.extractKeys(e,a);if(i&&0!==Object.keys(i).length)for(const[s,o]of Object.entries(i)){const i=t(a,s);if(!i)continue;let r=o||[];const c=e.keybindMetadata&&e.keybindMetadata[a]&&e.keybindMetadata[a][s]&&e.keybindMetadata[a][s].stabilizeExecutionOrder;c&&Array.isArray(o)&&o.length>1&&(r=this.mirrorCommands(o,c)),n[i]={name:i,commands:r,description:`Generated alias for ${a} key: ${s}`,isGenerated:!0}}}}const a={},s={};if(this.me()){const t=e.bindsets||{},i=Object.keys(t),n=["space","ground"];for(const o of n){const n=Object.keys(e.builds?.[o]?.keys||{}),r=new Set(n);for(const e of i)Object.keys(t[e]?.[o]?.keys||{}).forEach(e=>r.add(e));for(const n of i){const i=t[n]?.[o]?.keys||{};for(const[t,s]of Object.entries(i)){let i=s||[];Array.isArray(i)||(i=[i]);const r=e.bindsetMetadata&&e.bindsetMetadata[n]&&e.bindsetMetadata[n][o]&&e.bindsetMetadata[n][o][t]&&e.bindsetMetadata[n][o][t].stabilizeExecutionOrder;r&&i.length>1&&(i=this.mirrorCommands(i,r));const c=await this.generateBindsetAliasName(o,n,t);c&&(a[c]={name:c,commands:i,description:`Bindset ${n} ‚Äì ${o} key ${t}`,isGenerated:!0})}}const c=["Primary Bindset",...i];for(const n of c){const a=`sto_kb_bindset_enable_${o}_${this.sanitizeBindsetName(n)}`,c=[];for(const a of r){let s;const r="Primary Bindset"!==n&&t[n]?.[o]?.keys?.[a],l=e.builds?.[o]?.keys?.[a];if("Primary Bindset"===n){if(i.some(e=>t[e]?.[o]?.keys?.[a])){if(!l){c.push(`unbind ${a}`);continue}s=await this.generateBindsetAliasName(o,"Primary Bindset",a)}}else r&&(s=await this.generateBindsetAliasName(o,n,a));if(s){const{encodeKeyForExport:e}=await Promise.resolve().then(function(){return Se}),t=e(a);c.push(`bind ${t} "${s}"`)}}if(c.length>0){const e=c.join(" $$ ");s[a]={name:a,commands:[e],description:`Enable ${n} for ${o}`,isLoader:!0,category:"Bindsets"}}}}}const o={...t,...i,...n,...a,...s};if(0===Object.keys(o).length)return"; "+this.i18n.t("no_aliases_to_export")+"\n";let r=await this.generateAliasFileHeader(e);Object.keys(n).length>0&&(r+=`; ${this.i18n.t("export_user_and_generated_aliases")}\n`,r+=`; ${this.i18n.t("export_generated_aliases_count",{count:Object.keys(n).length})}\n`,r+="; ================================================================\n\n");const c=Object.entries(o).sort(([e],[t])=>e.localeCompare(t));for(const[t,i]of c){let n=Array.isArray(i.commands)?i.commands:[];if(!i.isGenerated&&!i.isLoader&&e.aliasMetadata&&e.aliasMetadata[t]&&e.aliasMetadata[t].stabilizeExecutionOrder&&n.length>1){const e=n.map(e=>"string"==typeof e?{command:e}:e&&"string"==typeof e.command?e:null).filter(Boolean);n=(await this.request("command:generate-mirrored-commands",{commands:e})).split(/\s*\$\$\s*/).filter(Boolean)}else n=n.map(e=>"string"==typeof e?e:e&&"string"==typeof e.command?e.command:null).filter(Boolean);const a=[];for(const e of n){const t=await ye(e,{eventBus:this.eventBus});a.push(t)}r+=xe(t,{...i,commands:a}),r+="\n"}return r}async generateAliasFileHeader(e){const t=(new Date).toLocaleString(),i=Object.keys(e.aliases||{}).length;return`; ================================================================\n; ${e.name} - STO Alias Configuration\n; ================================================================\n; ${this.i18n.t("environment")} Alias\n; ${this.i18n.t("generated")} ${t}\n; ${this.i18n.t("created_by")} STO Tools Keybind Manager v${Ve?.settings?.version??"unknown"}\n;\n; Alias Statistics:\n; - Total aliases: ${i}\n;\n; To use these aliases in Star Trek Online:\n; 1. Save this file as "CommandAliases.txt" (exactly, without quotes)\n; 2. Place it in your STO directory:\n;    [STO Install]\\Star Trek Online\\Live\\localdata\\CommandAliases.txt\n; 3. The aliases will be available when you start the game\n;\n; Alternative: You can append these aliases to an existing CommandAliases.txt\n; file if you already have one with other aliases.\n;\n; Common STO installation paths:\n; - Steam: C:\\Program Files (x86)\\Steam\\steamapps\\common\\Star Trek Online\n; - Epic: C:\\Program Files\\Epic Games\\Star Trek Online\n; - Arc: C:\\Program Files (x86)\\Perfect World Entertainment\\Arc Games\\Star Trek Online\n; ================================================================\n\n`}async syncToFolder(e){const t=this.storage.getAllData(),i=t.profiles||{};try{for(const[t,n]of Object.entries(i)){if(!n||!n.name)continue;const t=n.name.replace(/[^a-zA-Z0-9_-]/g,"_"),i=`${t}`;for(const a of["space","ground"])if(n.builds?.[a]?.keys&&Object.keys(n.builds[a].keys).length>0){const s=await this.generateSTOKeybindFile(n,{environment:a,profile:n,syncMode:!0}),o=`${i}/${t}_${a}.txt`;await Ie(e,o,s)}const a=await this.generateAliasFile(n),s=`${i}/${t}_aliases.txt`;await Ie(e,s,a)}const n={version:Ve?.settings?.version||"1.0.0",exported:(new Date).toISOString(),type:"project",data:{profiles:i,settings:t.settings||{},currentProfile:t.currentProfile}};await Ie(e,"project.json",JSON.stringify(n,null,2))}catch(e){throw e}}generateFileName(e,t,i=e.currentEnvironment||"space"){return`${e.name.replace(/[^a-zA-Z0-9_-]/g,"_")}_${i}_${(new Date).toISOString().split("T")[0]}.${t}`}generateAliasFileName(e,t){return`${e.name.replace(/[^a-zA-Z0-9_-]/g,"_")}_aliases.${t}`}extractKeys(e={},t="space"){return e.keys&&!e.builds?e.keys:e.builds&&e.builds[t]&&e.builds[t].keys?e.builds[t].keys:e.keybinds&&e.keybinds[t]?e.keybinds[t]:{}}mirrorCommands(e,t=!1,i=!0){if(!Array.isArray(e)||e.length<=1)return e.map(e=>"string"==typeof e?e:e.command);if(!t)return e.map(e=>"string"==typeof e?e:e.command);const n=[],a=[],s=[];e.forEach(e=>{const t="string"==typeof e?e:e.command,i=t.match(/^(?:\+)?TrayExecByTray/),o="object"==typeof e&&!1===e.palindromicGeneration;i?o?"in-pivot-group"===e.placement?s.push(t):n.push(t):a.push(t):n.push(t)});let o=[],r=a;s.length>0?o=s:a.length>0&&(o=[a[a.length-1]],r=a.slice(0,-1));let c=[...n,...r,...o];if(i){const e=[...r].reverse();c=[...c,...e]}return c}getCurrentState(){return{currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment,profiles:this.cache.profiles}}handleInitialState(e,t){}getProfileFromCache(e){return e&&this.cache.profiles[e]?this.cache.profiles[e]:this.storage&&"function"==typeof this.storage.getProfile?this.storage.getProfile(e):null}}class We extends re{constructor({eventBus:e,i18n:t,containerId:i="toastContainer"}={}){super(e),this.componentName="ToastService",this.i18n=t,this.containerId=i,this.eventBus&&(this.respond("ui:show-toast",({message:e,type:t="info",duration:i=3e3})=>(this.showToast(e,t,i),!0)),this.addEventListener("toast:show",({message:e,type:t="info",duration:i=3e3})=>{this.showToast(e,t,i)}))}showToast(e,t="info",i=3e3){const n=this.createToast(e,t,i),a=document.getElementById(this.containerId);a?(a.appendChild(n),requestAnimationFrame(()=>{n.classList.add("show")}),setTimeout(()=>{this.removeToast(n)},i)):console.warn(`ToastService: Toast container '${this.containerId}' not found in DOM`)}createToast(e,t,i){const n=document.createElement("div");n.className=`toast toast-${t}`;const a={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"},s=document.createElement("div");s.className="toast-content";const o=document.createElement("i");o.className=`fas ${a[t]||a.info}`,s.appendChild(o);const r=document.createElement("span");r.className="toast-message",r.textContent=e,s.appendChild(r);const c=document.createElement("button");c.className="toast-close",c.setAttribute("aria-label","close toast");const l=document.createElement("i");return l.className="fas fa-times",c.appendChild(l),s.appendChild(c),n.appendChild(s),c.addEventListener("click",()=>{this.removeToast(n)}),n}removeToast(e){e&&(e.classList.add("removing"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}}class Xe extends re{constructor(e){super(e),this.componentName="UIUtilityService",this.dragState={isDragging:!1,dragElement:null,dragData:null},this.setupEventListeners()}onDestroy(){this.requestDetachers&&(this.requestDetachers.forEach(e=>e()),this.requestDetachers=[]),super.onDestroy()}setupEventListeners(){this.eventBus.on("ui:copy-to-clipboard",this.handleCopyToClipboard.bind(this)),this.eventBus.on("ui:init-drag-drop",this.handleInitDragDrop.bind(this)),this.setupRequestHandlers()}setupRequestHandlers(){this.requestDetachers=[];const e=async({text:e}={})=>this.copyToClipboard(e);this.requestDetachers.push(this.respond("ui:copy-to-clipboard",e)),this.requestDetachers.push(this.respond("utility:copy-to-clipboard",e))}async handleCopyToClipboard({text:e}){const t=await this.copyToClipboard(e);this.emit("ui:clipboard-result",{success:t,text:e})}async handleInitDragDrop({container:e,containerId:t,options:i={}}){const n=e||document.getElementById(t);this.initDragAndDrop(n,i),this.emit("ui:drag-drop-initialized",{containerId:t,options:i})}async copyToClipboard(e){try{return await navigator.clipboard.writeText(e),{success:!0,message:"content_copied_to_clipboard"}}catch(t){const i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.select();try{return document.execCommand("copy"),{success:!0,message:"content_copied_to_clipboard"}}catch(e){return{success:!1,message:"failed_to_copy_to_clipboard"}}finally{document.body.removeChild(i)}}}initDragAndDrop(e,t={}){if(!e)return;const{draggableSelector:i=".draggable",dropZoneSelector:n=i,onDragStart:a=null,onDragEnd:s=null,onDrop:o=null}=t;e.addEventListener("dragstart",e=>{const t=e.target.closest(i);t&&(this.dragState.isDragging=!0,this.dragState.dragElement=t,this.dragState.dragData=t.dataset,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML),a&&a(e,this.dragState))}),e.addEventListener("dragend",e=>{e.target.closest(i)&&(this.dragState.isDragging=!1,this.dragState.dragElement=null,this.dragState.dragData=null,s&&s(e,this.dragState))});let r=null;e.addEventListener("dragover",e=>{if(e.preventDefault(),!n)return;const t=e.target.closest?e.target.closest(n):null;t&&t!==r&&(r=t)}),e.addEventListener("drop",e=>{e.preventDefault();let t=null;if(n){if("function"==typeof e.target.closest&&(t=e.target.closest(n)),!t&&"undefined"!=typeof document&&document.elementFromPoint){const i=document.elementFromPoint(e.clientX,e.clientY);t=i?.closest?i.closest(n):null}t||(t=r)}t&&t&&o&&o(e,this.dragState,t)})}}class He extends re{constructor({eventBus:e=null,document:t=("undefined"!=typeof window?window.document:void 0),i18n:i}={}){super(e),this.componentName="KeyCaptureService",this.document=t,this.i18n=i,this.isCapturing=!1,this.pressedCodes=new Set,this.currentContext="keySelectionModal",this.hasCapturedValidKey=!1,this.locationSpecific=!1,this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleKeyUp=this.handleKeyUp.bind(this),this.boundHandleMouseDown=this.handleMouseDown.bind(this),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleMouseMove=this.handleMouseMove.bind(this),this.boundHandleWheel=this.handleWheel.bind(this),this.boundHandleDblClick=this.handleDblClick.bind(this),this.mouseState={isDown:!1,button:null,startX:0,startY:0,dragThreshold:5,pendingClickTimer:null,pendingClickButton:null,pendingClickGesture:null}}onInit(){this.setupEventListeners(),this.setupGamepadEventHandling(),this.respond("keycapture:get-modifiers",this.getModifiers.bind(this)),this.respond("keycapture:get-pressed-codes",this.getPressedCodes.bind(this))}setupEventListeners(){this.addEventListener("keycapture:start",({context:e}={})=>this.startCapture(e)),this.addEventListener("keycapture:stop",()=>this.stopCapture()),this.addEventListener("keycapture:set-location-specific",({value:e}={})=>{this.setLocationSpecific(e)})}startCapture(e="keySelectionModal"){this.isCapturing||(this.resetState(),this.currentContext=e,this.isCapturing=!0,this.document.addEventListener("keydown",this.boundHandleKeyDown),this.document.addEventListener("keyup",this.boundHandleKeyUp),this.document.addEventListener("mousedown",this.boundHandleMouseDown),this.document.addEventListener("mouseup",this.boundHandleMouseUp),this.document.addEventListener("mousemove",this.boundHandleMouseMove),this.document.addEventListener("wheel",this.boundHandleWheel,{passive:!1}),this.document.addEventListener("dblclick",this.boundHandleDblClick),this.startGamepadCapture(),this.emit("capture-start",{context:e}))}stopCapture(){this.isCapturing&&(this.isCapturing=!1,this.document.removeEventListener("keydown",this.boundHandleKeyDown),this.document.removeEventListener("keyup",this.boundHandleKeyUp),this.document.removeEventListener("mousedown",this.boundHandleMouseDown),this.document.removeEventListener("mouseup",this.boundHandleMouseUp),this.document.removeEventListener("mousemove",this.boundHandleMouseMove),this.document.removeEventListener("wheel",this.boundHandleWheel,{passive:!1}),this.document.removeEventListener("dblclick",this.boundHandleDblClick),this.stopGamepadCapture(),this.pressedCodes.clear(),this.hasCapturedValidKey=!1,this.resetMouseState(),this.emit("capture-stop",{context:this.currentContext}),this.currentContext="keySelectionModal")}setLocationSpecific(e){this.locationSpecific=!!e}resetState(){this.pressedCodes.clear(),this.hasCapturedValidKey=!1,this.resetMouseState()}resetMouseState(){this.mouseState.isDown=!1,this.mouseState.button=null,this.mouseState.startX=0,this.mouseState.startY=0,this.mouseState.pendingClickTimer&&(clearTimeout(this.mouseState.pendingClickTimer),this.mouseState.pendingClickTimer=null),this.mouseState.pendingClickButton=null,this.mouseState.pendingClickGesture=null}async handleKeyDown(e){if(!this.isCapturing)return;if(this.isModifier(e.code))return this.pressedCodes.add(e.code),void this.emit("update",{chord:this.chordToString(this.pressedCodes),codes:[...this.pressedCodes],context:this.currentContext});this.pressedCodes.add(e.code);const t=this.chordToString(this.pressedCodes);if(this.isRejectedChord(t))return this.i18n.t("unsafe_keybind",{key:t}),this.resetState(),void e.preventDefault();this.emit("chord-captured",{chord:t,context:this.currentContext}),this.hasCapturedValidKey=!0,e.preventDefault()}handleKeyUp(e){if(this.isCapturing&&!this.hasCapturedValidKey){if(this.isModifier(e.code)&&this.pressedCodes.has(e.code)&&1===this.pressedCodes.size){const t=this.chordToString(this.pressedCodes);return this.emit("chord-captured",{chord:t,context:this.currentContext}),this.hasCapturedValidKey=!0,void e.preventDefault()}this.pressedCodes.delete(e.code),this.emit("update",{chord:this.chordToString(this.pressedCodes),codes:[...this.pressedCodes],context:this.currentContext})}}handleMouseDown(e){this.isCapturing&&(e.preventDefault(),this.mouseState.pendingClickTimer&&this.mouseState.pendingClickButton===e.button&&(clearTimeout(this.mouseState.pendingClickTimer),this.mouseState.pendingClickTimer=null,this.mouseState.pendingClickButton=null,this.mouseState.pendingClickGesture=null),this.mouseState.isDown=!0,this.mouseState.button=e.button,this.mouseState.startX=e.clientX,this.mouseState.startY=e.clientY)}handleMouseUp(e){if(this.isCapturing){if(e.preventDefault(),this.mouseState.isDown&&this.mouseState.button===e.button){const t=Math.abs(e.clientX-this.mouseState.startX),i=Math.abs(e.clientY-this.mouseState.startY);if(t>this.mouseState.dragThreshold||i>this.mouseState.dragThreshold){const t=this.getButtonGesture(e.button,"drag");this.captureMouseGesture(t)}else{const t=this.getButtonGesture(e.button,"click");this.mouseState.pendingClickTimer&&clearTimeout(this.mouseState.pendingClickTimer),this.mouseState.pendingClickButton=e.button,this.mouseState.pendingClickGesture=t,this.mouseState.pendingClickTimer=setTimeout(()=>{this.capturePendingClick()},500)}}this.mouseState.isDown=!1,this.mouseState.button=null,this.mouseState.startX=0,this.mouseState.startY=0}}handleMouseMove(e){this.isCapturing&&this.mouseState.isDown}handleWheel(e){if(!this.isCapturing)return;e.preventDefault();const t=e.deltaY>0?"Wheelminus":"Wheelplus";this.captureMouseGesture(t)}handleDblClick(e){if(!this.isCapturing)return;e.preventDefault(),this.mouseState.pendingClickTimer&&(clearTimeout(this.mouseState.pendingClickTimer),this.mouseState.pendingClickTimer=null),this.mouseState.pendingClickButton=null,this.mouseState.pendingClickGesture=null;const t=this.getButtonGesture(e.button,"doubleclick");this.captureMouseGesture(t)}capturePendingClick(){this.mouseState.pendingClickGesture&&(this.captureMouseGesture(this.mouseState.pendingClickGesture),this.mouseState.pendingClickTimer=null,this.mouseState.pendingClickButton=null,this.mouseState.pendingClickGesture=null)}getButtonGesture(e,t){if(e<=2){const i={0:"L",1:"M",2:"R"}[e]||"L";return"click"===t?`${i}click`:"doubleclick"===t?`${i}dblclick`:"drag"===t?`${i}drag`:`${i}click`}const i=`Button${e+1}`;return"click"===t?i:"doubleclick"===t?`${i}dblclick`:i}captureMouseGesture(e){const t=[...[...this.pressedCodes].filter(e=>this.isModifier(e)),e],i=this.chordToString(new Set(t));this.emit("chord-captured",{chord:i,context:this.currentContext}),this.hasCapturedValidKey=!0}isModifier(e){return["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"].includes(e)}chordToString(e){const t=this.locationSpecific;return[...e].sort().map(e=>{if(/^Button\d+/.test(e))return e;if("string"==typeof e&&(e.startsWith("l")||e.startsWith("r")||e.startsWith("m")||"Wheelplus"===e||"Wheelminus"===e))return e;if(e.startsWith("Control"))return t?e.endsWith("Left")?"LCTRL":"RCTRL":"Control";if(e.startsWith("Alt"))return t?e.endsWith("Left")?"LALT":"RALT":"Alt";if(e.startsWith("Shift"))return t?e.endsWith("Left")?"LSHIFT":"RSHIFT":"Shift";if(e.startsWith("Meta"))return"Meta";const i=e.match(/^Digit(\d)$/);if(i)return i[1];const n=e.match(/^Key([A-Z])$/);if(n)return n[1];if(e.startsWith("F")&&/^F\d+$/.test(e))return e;const a=e.match(/^Numpad(\d)$/);if(a)return`numpad${a[1]}`;const s={NumpadAdd:"Add",NumpadSubtract:"Subtract",NumpadMultiply:"Multiply",NumpadDivide:"Divide",NumpadDecimal:"Decimal",NumpadEnter:"numpadenter"};if(s[e])return s[e];const o={Space:"Space",Enter:"Enter",Tab:"Tab",Escape:"Escape",Backspace:"Backspace",Delete:"Delete",Home:"Home",End:"End",PageUp:"PageUp",PageDown:"PageDown",ArrowUp:"Up",ArrowDown:"Down",ArrowLeft:"Left",ArrowRight:"Right",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/",Backslash:"\\",Minus:"-",Equal:"=",Backquote:"`",IntlBackslash:"\\"};return o[e]?o[e]:e.replace(/^Key/,"")}).join("+")}getModifiers(){return this.isCapturing?[...this.pressedCodes].filter(e=>this.isModifier(e)).map(e=>e.startsWith("Control")?"Ctrl":e.startsWith("Alt")?"Alt":e.startsWith("Shift")?"Shift":e.startsWith("Meta")?"Meta":e):[]}getPressedCodes(){return this.isCapturing?[...this.pressedCodes]:[]}isRejectedChord(e){return!!e&&t.some(t=>t.toUpperCase()===e.toUpperCase())}async startGamepadCapture(){try{const e=await this.request("gamepad:start-capture");console.log("KeyCaptureService: Gamepad capture coordination started",e)}catch(e){console.warn("KeyCaptureService: Failed to start gamepad capture coordination:",e)}}async stopGamepadCapture(){try{const e=await this.request("gamepad:stop-capture");console.log("KeyCaptureService: Gamepad capture coordination stopped",e)}catch(e){console.warn("KeyCaptureService: Failed to stop gamepad capture coordination:",e)}}setupGamepadEventHandling(){this.addEventListener("chord-captured",e=>{if(!e.detail)return;const{chord:t,context:i,source:n,gamepadIndex:a,gamepadInputs:s}=e.detail;"gamepad"===n&&this.isCapturing&&(console.log("KeyCaptureService: Received gamepad chord:",{chord:t,context:i,gamepadIndex:a,gamepadInputs:s,currentContext:this.currentContext}),this.emit("chord-captured",{chord:t,context:this.currentContext,source:"gamepad",gamepadIndex:a,gamepadInputs:s}),this.hasCapturedValidKey=!0)})}}class Ze extends re{constructor({eventBus:e,i18n:t}={}){super(e),this.componentName="ModalManagerService",this.i18n=t,this.overlayId="modalOverlay",this.regenerateCallbacks={},this.isInitialized=!1,this.registerAllModalCallbacks(),this.setupEventListeners(),this.i18n&&this.i18n.on("languageChanged",()=>{const e=document.querySelector(".modal.active");if(!e)return;const t=e.id;this.regenerateCallbacks[t]?(this.regenerateCallbacks[t](),this.emit("modal:regenerated",{modalId:t})):"function"==typeof window.applyTranslations&&window.applyTranslations(e)})}onInit(){this.isInitialized?console.log(`[${this.componentName}] Already initialized`):(this.isInitialized=!0,console.log(`[${this.componentName}] Initialized`))}setupEventListeners(){this.eventBus.on("modal:show",this.handleShowModal.bind(this)),this.eventBus.on("modal:hide",this.handleHideModal.bind(this)),this.setupGlobalModalEventListeners()}setupGlobalModalEventListeners(){document.addEventListener("click",e=>{const t=e.target.closest("[data-modal]");if(t){const i=t.getAttribute("data-modal");i&&(this.hide(i),e.preventDefault(),e.stopPropagation())}}),document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.querySelector(".modal.active");e&&this.hide(e.id)}}),document.addEventListener("click",e=>{if(e.target.id===this.overlayId||e.target.classList.contains("modal-overlay")){const e=document.querySelector(".modal.active");e&&this.hide(e.id)}})}async handleShowModal({modalId:e}){const t=this.show(e);return this.emit("modal:shown",{modalId:e,success:t}),t}async handleHideModal({modalId:e}){const t=this.hide(e);return this.emit("modal:hidden",{modalId:e,success:t}),t}getOverlay(){return document.getElementById(this.overlayId)}show(e){const t="string"==typeof e?document.getElementById(e):e,i=this.getOverlay();if(!i||!t)return!1;i.classList.add("active"),t.classList.add("active"),document.body.classList.add("modal-open"),"function"==typeof window.applyTranslations&&window.applyTranslations(t);const n=t.querySelector("input, textarea, select");n&&setTimeout(()=>n.focus(),100);const a="string"==typeof e?e:t.id;return this.emit("modal:shown",{modalId:a,success:!0}),!0}hide(e){const t="string"==typeof e?document.getElementById(e):e,i=this.getOverlay();return!(!i||!t||(t.classList.remove("active"),document.querySelector(".modal.active")||(i.classList.remove("active"),document.body.classList.remove("modal-open")),0))}registerRegenerateCallback(e,t){this.regenerateCallbacks[e]=t}unregisterRegenerateCallback(e){delete this.regenerateCallbacks[e]}registerAllModalCallbacks(){this.registerRegenerateCallback("parameterModal",()=>{if(window.app?.populateParameterModal){const e=document.getElementById("parameterModal"),t=e?.getAttribute("data-command-def");if(t)try{window.app.populateParameterModal(JSON.parse(t))}catch(e){}}}),this.registerRegenerateCallback("keySelectionModal",()=>{const e=document.getElementById("keySelectionModal"),t=e?.querySelector(".tab-content .tab-pane.active");if(t){const e=t.id.replace("Tab","");window.app?.populateKeyTab?.(e)}}),this.registerRegenerateCallback("vertigoModal",()=>{this.eventBus?this.emit("vfx:modal-regenerate-requested"):window.app?.populateVertigoModal?.()}),this.registerRegenerateCallback("profileModal",()=>{const e=document.getElementById("profileModal");window.applyTranslations?.(e)}),this.registerRegenerateCallback("fileExplorerModal",()=>{window.stoFileExplorer?.refreshFileList?.()}),this.registerRegenerateCallback("aboutModal",()=>{const e=document.getElementById("aboutModal");window.applyTranslations?.(e)})}}class Ye extends re{constructor(e,t){super(e),this.componentName="VFXManagerService",this.i18n=t,this.selectedEffects={space:new Set,ground:new Set},this.showPlayerSay=!1,this.isInitialized=!1,this.eventBus&&this.respond("vfx:get-virtual-aliases",()=>this.getVirtualVFXAliases())}onInit(){this.isInitialized?console.log(`[${this.componentName}] Already initialized`):(this.setupEventListeners(),this.isInitialized=!0,console.log(`[${this.componentName}] Initialized`))}handleInitialState(e,t){t&&"DataCoordinator"===e&&t.currentProfileData&&(this.cache.currentProfile=t.currentProfileData.id,this.loadState(t.currentProfileData),console.log(`[${this.componentName}] Loaded initial VFX state from DataCoordinator via late-join`))}setupEventListeners(){this.eventBus.on("vfx:show-modal",this.showModal.bind(this)),this.eventBus.on("vfx:save-effects",this.saveEffects.bind(this)),this.addEventListener("profile:switched",({profileId:e,profile:t,updateSource:i})=>{"VFXManagerService"!==i?(this.cache.currentProfile=e,t&&(this.loadState(t),console.log(`[${this.componentName}] Loaded VFX state for switched profile: ${e}`))):console.log(`[${this.componentName}] Ignoring profile:switched event from our own update`)}),this.addEventListener("profile:updated",({profileId:e,profile:t,updateSource:i})=>{"VFXManagerService"!==i?e===this.cache.currentProfile&&t&&(this.loadState(t),console.log(`[${this.componentName}] Refreshed VFX state for updated profile: ${e}`)):console.log(`[${this.componentName}] Ignoring profile:updated event from our own update`)})}generateAlias(e){return 0===Array.from(this.selectedEffects[e]).length?this.i18n.t("no_effects_selected"):xe(`dynFxSetFXExclusionList_${e.charAt(0).toUpperCase()+e.slice(1)}`,{commands:this.generateAliasCommand(e).join(" $$ ")}).trim()}generateAliasCommand(e){if(!this.selectedEffects||!this.selectedEffects[e])return console.warn(`[${this.componentName}] generateAliasCommand: selectedEffects not properly initialized for ${e}`),console.warn(`[${this.componentName}] selectedEffects state:`,this.selectedEffects),[];const t=Array.from(this.selectedEffects[e]);if(console.log(`[${this.componentName}] generateAliasCommand(${e}): found ${t.length} effects:`,t),0===t.length)return console.log(`[${this.componentName}] generateAliasCommand(${e}): No effects selected, returning empty command`),[];const i=[`dynFxSetFXExlusionList ${t.join(",")}`];if(this.showPlayerSay){const e=this.cache.preferences.translateGeneratedMessages?this.i18n.t("vfx_suppression_loaded"):"VFX Suppression Loaded";i.push(`PlayerSay ${e}`)}return console.log(`[${this.componentName}] generateAliasCommand(${e}): generated commands:`,i),i}generateCombinedAliasCommand(e){const t=Array.isArray(e)?e:[e];if(!this.selectedEffects)return console.warn(`[${this.componentName}] generateCombinedAliasCommand: selectedEffects not properly initialized, returning empty command`),[];const i=[];for(const e of t){if(!this.selectedEffects[e]){console.warn(`[${this.componentName}] generateCombinedAliasCommand: selectedEffects not properly initialized for ${e}, skipping`);continue}const t=Array.from(this.selectedEffects[e]);0!==t.length&&i.push(...t)}if(0===i.length)return[];const n=[`dynFxSetFXExlusionList ${i.join(",")}`];if(this.showPlayerSay){const e=this.cache.preferences.translateGeneratedMessages?this.i18n.t("vfx_suppression_loaded"):"VFX Suppression Loaded";n.push(`PlayerSay ${e}`)}return n}toggleEffect(e,t){if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);if(!t)throw new Error(`Invalid effect: ${t} for environment: ${e}`);this.selectedEffects[e].has(t)?this.selectedEffects[e].delete(t):this.selectedEffects[e].add(t)}selectAllEffects(e){if(!window.VFX_EFFECTS[e])throw new Error(`Invalid environment: ${e}`);if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);window.VFX_EFFECTS[e].forEach(t=>{this.selectedEffects[e].add(t.effect)})}getEffectCount(e){if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);return this.selectedEffects[e].size}isEffectSelected(e,t){if(!this.selectedEffects[e])throw new Error(`Invalid environment: ${e}`);return this.selectedEffects[e].has(t)}loadState(e){if(this.selectedEffects||(this.selectedEffects={space:new Set,ground:new Set},console.log(`[${this.componentName}] loadState: Initialized selectedEffects object`)),e&&e.vertigoSettings){const t=e.vertigoSettings;console.log(`[${this.componentName}] loadState: Found vertigoSettings in profile:`,t),this.selectedEffects.space=new Set(t.selectedEffects?.space||[]),this.selectedEffects.ground=new Set(t.selectedEffects?.ground||[]),console.log(`[${this.componentName}] loadState: Loaded space effects:`,Array.from(this.selectedEffects.space)),console.log(`[${this.componentName}] loadState: Loaded ground effects:`,Array.from(this.selectedEffects.ground)),this.showPlayerSay=t.showPlayerSay||!1}else console.log(`[${this.componentName}] loadState: No vertigoSettings found in profile, resetting to defaults`),console.log(`[${this.componentName}] loadState: Profile structure:`,e),this.selectedEffects.space.clear(),this.selectedEffects.ground.clear(),this.showPlayerSay=!1;this.emit("vfx:settings-changed",{selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay})}getVirtualVFXAliases(){const e={},t=["space","ground"];t.forEach(t=>{const i=this.generateAliasCommand(t),n=`dynFxSetFXExclusionList_${t.charAt(0).toUpperCase()+t.slice(1)}`;e[n]={commands:i,description:this.i18n.t("vfx_suppression_for_environment",{environment:t}),type:"vfx-alias",virtual:!0}});const i=this.generateCombinedAliasCommand(t);return e.dynFxSetFXExclusionList_Combined={commands:i,description:this.i18n.t("vfx_suppression_for_all_environments"),type:"vfx-alias",virtual:!0},e}async showModal(){if(console.log(`[${this.componentName}] Showing VFX modal`),this.cache.currentProfile)try{const e=(await this.request("data:get-all-profiles"))[this.cache.currentProfile];e&&(this.loadState(e),console.log(`[${this.componentName}] Loaded VFX state from profile via DataCoordinator`))}catch(e){console.error(`[${this.componentName}] Failed to load profile state:`,e)}this.emit("vfx:modal-populate",{vfxManager:this})}async saveEffects(){if(console.log(`[${this.componentName}] Saving VFX effects`),this.selectedEffects&&this.selectedEffects.space&&this.selectedEffects.ground){if(console.log(`[${this.componentName}] Current selected effects:`,this.selectedEffects),console.log(`[${this.componentName}] Show player say:`,this.showPlayerSay),console.log(`[${this.componentName}] Current profile:`,this.cache.currentProfile),this.cache.currentProfile)try{if((await this.request("data:get-all-profiles"))[this.cache.currentProfile]){console.log(`[${this.componentName}] Retrieved profile via DataCoordinator`);const e={selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay};try{await this.request("data:update-profile",{profileId:this.cache.currentProfile,properties:{vertigoSettings:e},updateSource:"VFXManagerService"}),console.log(`[${this.componentName}] VFX settings saved to profile: ${this.cache.currentProfile}`),this.emit("vfx:settings-changed",{selectedEffects:e.selectedEffects,showPlayerSay:this.showPlayerSay})}catch(e){console.error(`[${this.componentName}] ERROR: Failed to update profile:`,e)}}else console.error(`[${this.componentName}] ERROR: Could not retrieve profile: ${this.cache.currentProfile}`)}catch(e){console.error(`[${this.componentName}] ERROR: Failed to save VFX effects:`,e)}else console.error(`[${this.componentName}] ERROR: No current profile set`);this.emit("modal:hide",{modalId:"vertigoModal"})}else console.error(`[${this.componentName}] ERROR: selectedEffects not properly initialized:`,this.selectedEffects)}getCurrentState(){return{selectedEffects:{space:Array.from(this.selectedEffects.space),ground:Array.from(this.selectedEffects.ground)},showPlayerSay:this.showPlayerSay}}}const Qe="2.1.1",et={"2.0.0":{targetVersion:"2.1.0",migrations:["removeVFXAliases"]},"2.1.0":{targetVersion:"2.1.1",migrations:["fixVFXCommandSpelling"]}};function tt(e){if("string"!=typeof e)return e;let t=e.match(/^(?:STO)?TrayExecByTray\s+1\s+(\d+)\s+(\d+)$/i);return t?`+TrayExecByTray ${t[1]} ${t[2]}`:(t=e.match(/^TrayExecByTrayWithBackup\s+1\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)$/i),t?`+TrayExecByTrayWithBackup ${t[1]} ${t[2]} ${t[3]} ${t[4]}`:e)}function it(e){return _e(e).map(tt)}function nt(e){if(!e||"object"!=typeof e)return e;let t=!1;const i=e.migrationVersion||"2.0.0",n=function(e,t){const i=[];let n=e||"2.0.0";for(;n!==t&&et[n];){const e=et[n];i.push({fromVersion:n,toVersion:e.targetVersion,migrations:e.migrations}),n=e.targetVersion}return i}(i,Qe);for(const i of n){console.log(`[ProfileNormalizer] Migrating from ${i.fromVersion} to ${i.toVersion}`);for(const n of i.migrations)"removeVFXAliases"===n?t=at(e)||t:"fixVFXCommandSpelling"===n&&(t=st(e)||t)}return t=function(e){let t=!1;if(e.builds&&"object"==typeof e.builds)for(const[i,n]of Object.entries(e.builds))if(n&&n.keys&&"object"==typeof n.keys)for(const[a,s]of Object.entries(n.keys)){const n=rt(s);JSON.stringify(n)!==JSON.stringify(s)&&(e.builds[i].keys[a]=n,t=!0)}if(e.aliases&&"object"==typeof e.aliases)for(const[i,n]of Object.entries(e.aliases))if(n&&"object"==typeof n){const a=ct(n.commands);JSON.stringify(a)!==JSON.stringify(n.commands)&&(e.aliases[i].commands=a,t=!0)}return t}(e)||t,(t||i!==Qe)&&(e.lastModified=(new Date).toISOString(),e.migrationVersion=Qe),e}function at(e){let t=!1;if(e.aliases&&"object"==typeof e.aliases)for(const[i,n]of Object.entries(e.aliases))n&&"object"==typeof n&&("vfx-alias"===n.type||i.startsWith("dynFxSetFXExclusionList"))&&(console.log(`[ProfileNormalizer] Removing old VFX alias: ${i}`),delete e.aliases[i],t=!0);return t}function st(e){let t=!1;const i=["dynFxSetFXExclusionList_Combined","dynFxSetFXExclusionList_Space","dynFxSetFXExclusionList_Ground"];if(e.aliases&&"object"==typeof e.aliases)for(const n of i)if(e.aliases[n]&&"object"==typeof e.aliases[n]){const i=e.aliases[n];if(i.commands){const a=ot(i.commands);JSON.stringify(a)!==JSON.stringify(i.commands)&&(console.log(`[ProfileNormalizer] Fixing VFX command spelling in alias: ${n}`),e.aliases[n].commands=a,t=!0)}}return t}function ot(e){return e?"string"==typeof e?e.replace(/\bdynFxSetFXExclusionList\b/g,"dynFxSetFXExlusionList"):Array.isArray(e)?e.map(e=>"string"==typeof e?e.replace(/\bdynFxSetFXExclusionList\b/g,"dynFxSetFXExlusionList"):e):e:e}function rt(e){if(!e)return[];if("string"==typeof e)return e.includes("$$")?e.split(/\s*\$\$\s*/).map(e=>e.trim()).filter(e=>e.length>0):e.trim()?[e.trim()]:[];if(Array.isArray(e))return it(e);if("object"==typeof e){const t=fe(e);return t?[t]:[]}return console.warn("normalizeKeyCommands: Unknown format for key commands:",e),[]}function ct(e){if(!e)return[];if("string"==typeof e)return e.includes("$$")?e.split(/\s*\$\$\s*/).map(e=>e.trim()).filter(e=>e.length>0):e.trim()?[e.trim()]:[];if(Array.isArray(e))return it(e);if("object"==typeof e){const t=fe(e);return t?[t]:[]}return console.warn("normalizeAliasCommands: Unknown format for alias commands:",e),[]}function lt(e){return!(!e||"object"!=typeof e)&&e.migrationVersion!==Qe&&e.migrationVersion!==Qe}class dt extends re{constructor({eventBus:e,storage:t,i18n:i}){super(e),this.componentName="DataCoordinator",this.storage=t,this.i18n=i,this.state={currentProfile:null,currentEnvironment:"space",profiles:{},settings:{},metadata:{lastModified:null,version:"1.0.0"}},this.setupRequestHandlers()}async onInit(){console.log(`[${this.componentName}] Initializing...`),this.setupEventListeners(),await this.loadInitialState(),console.log(`[${this.componentName}] Initialization complete`)}setupEventListeners(){this.addEventListener("storage:data-reset",({data:e})=>{console.log("[DataCoordinator] Handling storage reset, reloading state"),this.state.currentProfile=null,this.state.profiles={},this.state.settings=e?.settings||{},this.state.currentEnvironment="space",this.emit("profile:updated",{profileId:null,profile:null,updateSource:"DataCoordinator-Reset"},{synchronous:!0}),this.emit("profile:switched",{profileId:null,profile:null,environment:"space",updateSource:"DataCoordinator-Reset"},{synchronous:!0})}),this.addEventListener("data:load-default",()=>{this.handleLoadDefaultData()})}async handleLoadDefaultData(){console.log("[DataCoordinator] Handling load default data request");try{const e=Object.entries(this.state.profiles).find(([e,t])=>t.name&&"default"===t.name.toLowerCase());if(e){const[t,i]=e;if(console.log(`[DataCoordinator] Default profile already exists: ${t} - "${i.name}"`),"undefined"==typeof window||!window.confirmDialog)return void("undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Default profile already exists. Will not overwrite.","warning"));{const e=this.i18n.t("default_profile_exists_message"),t=this.i18n.t("default_profile_exists_title");if(!await window.confirmDialog.confirm(e,t,"warning","loadDefaultData"))return void console.log("[DataCoordinator] User cancelled default data load")}}console.log("[DataCoordinator] Loading default data...");const t=await this.loadDefaultData();t.success?("undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Default data loaded successfully.","success"),console.log("[DataCoordinator] Default data loaded successfully")):("undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Failed to load default data.","error"),console.error("[DataCoordinator] Failed to load default data:",t.error))}catch(e){console.error("[DataCoordinator] Error handling load default data:",e),"undefined"!=typeof window&&window.stoUI&&window.stoUI.showToast&&window.stoUI.showToast("Error loading default data.","error")}}setupRequestHandlers(){this.respond("data:get-current-state",()=>this.getCurrentState()),this.respond("data:get-all-profiles",()=>this.getAllProfiles()),this.respond("data:switch-profile",({profileId:e})=>this.switchProfile(e)),this.respond("data:create-profile",({name:e,description:t,mode:i})=>this.createProfile(e,t,i)),this.respond("data:clone-profile",({sourceId:e,newName:t})=>this.cloneProfile(e,t)),this.respond("data:rename-profile",({profileId:e,newName:t,description:i})=>this.renameProfile(e,t,i)),this.respond("data:delete-profile",({profileId:e})=>this.deleteProfile(e)),this.respond("data:update-profile",(e={})=>{const{profileId:t,updates:i}=e||{};let n=i;if(!n){const{add:t,delete:i,modify:a,properties:s}=e;(t||i||a||s)&&(n={add:t,delete:i,modify:a,properties:s})}return!e.updateSource||n&&n.updateSource||(n||(n={}),n.updateSource=e.updateSource),this.updateProfile(t,n)}),this.respond("data:set-environment",({environment:e})=>this.setEnvironment(e)),this.respond("data:get-settings",()=>this.getSettings()),this.respond("data:update-settings",({settings:e})=>this.updateSettings(e)),this.respond("data:load-default-data",()=>this.loadDefaultData()),this.respond("data:reload-state",()=>this.reloadState()),this.respond("data:get-keys",({environment:e}={})=>this.getKeys(e)),this.respond("data:get-key-commands",({environment:e,key:t}={})=>this.getKeyCommands(e,t))}async loadInitialState(){try{const e=this.storage.getAllData();if(this.state.currentProfile=e.currentProfile,this.state.profiles=e.profiles||{},this.state.settings=e.settings||{},await this.normalizeAllProfiles(),0===Object.keys(this.state.profiles).length&&(localStorage.getItem("sto_keybind_manager_visited")?console.log(`[${this.componentName}] No profiles found, but not first run - leaving empty (user may have reset)`):(this.needsDefaultProfiles=!0,console.log(`[${this.componentName}] First time run - no profiles found, will create defaults when DataService is available`),this.tryCreateDefaultProfiles())),!this.state.currentProfile&&Object.keys(this.state.profiles).length>0){this.state.currentProfile=Object.keys(this.state.profiles)[0];const e=this.storage.getAllData();e.currentProfile=this.state.currentProfile,await this.storage.saveAllData(e)}this.state.currentProfile&&this.state.profiles[this.state.currentProfile]&&(this.state.currentEnvironment=this.state.profiles[this.state.currentProfile].currentEnvironment||"space"),this.state.metadata={lastModified:e.lastModified,version:e.version||"1.0.0"},console.log(`[${this.componentName}] Loaded initial state:`,{currentProfile:this.state.currentProfile,environment:this.state.currentEnvironment,profileCount:Object.keys(this.state.profiles).length})}catch(e){console.error(`[${this.componentName}] Failed to load initial state:`,e);const t=this.i18n.t("failed_to_load_profile_data",{error:e.message});throw new Error(t)}}getCurrentState(){let e=null;if(this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const t=this.state.profiles[this.state.currentProfile];e=this.buildVirtualProfile(t,this.state.currentEnvironment),e.id=this.state.currentProfile}return{currentProfile:this.state.currentProfile,currentEnvironment:this.state.currentEnvironment,profiles:{...this.state.profiles},settings:{...this.state.settings},metadata:{...this.state.metadata},currentProfileData:e}}async getAllProfiles(){return{...this.state.profiles}}buildVirtualProfile(e,t){if(!e)return null;e.builds||(e.builds={space:{keys:{}},ground:{keys:{}}}),e.builds[t]||(e.builds[t]={keys:{}});let i={...e.builds[t].keys||{}};return{...e,keys:i,aliases:e.aliases||{},keybindMetadata:e.keybindMetadata||{},aliasMetadata:e.aliasMetadata||{},environment:t}}async switchProfile(e){if(e===this.state.currentProfile){let e=null;if(this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const t=this.state.profiles[this.state.currentProfile];e=this.buildVirtualProfile(t,this.state.currentEnvironment)}return{success:!0,switched:!1,message:this.i18n.t("already_on_profile"),profile:e}}const t=this.state.profiles[e];if(!t)throw new Error(`Profile ${e} not found`);const i=this.state.currentProfile;this.state.currentProfile=e,this.state.currentEnvironment=t.currentEnvironment||"space";const n=this.storage.getAllData();n.currentProfile=e,await this.storage.saveAllData(n),this.state.metadata.lastModified=(new Date).toISOString();const a=this.buildVirtualProfile(t,this.state.currentEnvironment);return this.emit("profile:switched",{fromProfile:i,toProfile:e,profileId:e,profile:a,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0}),{success:!0,switched:!0,profile:a,message:this.i18n.t("switched_to_profile",{name:t.name,environment:this.state.currentEnvironment})}}async createProfile(e,t="",i="space"){if(!e||!e.trim()){const e=this.i18n.t("profile_name_is_required");throw new Error(e)}const n=this.generateProfileId(e);if(this.state.profiles[n]){const e=this.i18n.t("profile_already_exists");throw new Error(e)}const a={name:e.trim(),description:t.trim(),currentEnvironment:i,builds:{space:{keys:{}},ground:{keys:{}}},keybindMetadata:{space:{},ground:{}},aliasMetadata:{},bindsetMetadata:{},bindsets:{},aliases:{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()};try{return await this.storage.saveProfile(n,a),this.state.profiles[n]=a,this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:created",{profileId:n,profile:a,timestamp:Date.now()}),{success:!0,profileId:n,profile:a,message:this.i18n.t("profile_created",{name:e})}}catch(e){const t=this.i18n.t("failed_to_create_profile",{error:e.message});throw new Error(t)}}async cloneProfile(e,t){if(!e||!t||!t.trim()){const e=this.i18n.t("source_profile_and_new_name_required");throw new Error(e)}const i=this.state.profiles[e];if(!i){const e=this.i18n.t("source_profile_not_found");throw new Error(e)}const n=this.generateProfileId(t);if(this.state.profiles[n]){const e=this.i18n.t("profile_already_exists");throw new Error(e)}const a={...JSON.parse(JSON.stringify(i)),name:t.trim(),description:`Copy of ${i.name}`,created:(new Date).toISOString(),lastModified:(new Date).toISOString()};try{return await this.storage.saveProfile(n,a),this.state.profiles[n]=a,this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:created",{profileId:n,profile:a,clonedFrom:e,timestamp:Date.now()}),{success:!0,profileId:n,profile:a,message:this.i18n.t("profile_created_from",{newName:t,sourceProfile:i.name})}}catch(e){const t=this.i18n.t("failed_to_clone_profile",{error:e.message});throw new Error(t)}}async renameProfile(e,t,i=""){if(!e||!t||!t.trim()){const e=this.i18n.t("profile_name_is_required");throw new Error(e)}const n=this.state.profiles[e];if(!n){const e=this.i18n.t("profile_not_found");throw new Error(e)}const a={...n,name:t.trim(),description:i.trim(),lastModified:(new Date).toISOString()};try{return await this.storage.saveProfile(e,a),this.state.profiles[e]=a,this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:updated",{profileId:e,profile:a,changes:{name:t,description:i},timestamp:Date.now()}),{success:!0,profile:a,message:`Profile renamed to "${t}"`}}catch(e){const t=this.i18n.t("failed_to_rename_profile",{error:e.message});throw new Error(t)}}async deleteProfile(e){if(!e){const e=this.i18n.t("profile_id_required");throw new Error(e)}const t=this.state.profiles[e];if(!t){const e=this.i18n.t("profile_not_found");throw new Error(e)}if(Object.keys(this.state.profiles).length<=1){const e=this.i18n.t("cannot_delete_the_last_profile");throw new Error(e)}try{await this.storage.deleteProfile(e),delete this.state.profiles[e];let i=null;if(this.state.currentProfile===e){const t=Object.keys(this.state.profiles);this.state.currentProfile=t[0];const n=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=n.currentEnvironment||"space";const a=this.storage.getAllData();a.currentProfile=this.state.currentProfile,await this.storage.saveAllData(a),i=this.buildVirtualProfile(n,this.state.currentEnvironment),this.emit("profile:switched",{fromProfile:e,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:i,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}return this.state.metadata.lastModified=(new Date).toISOString(),this.emit("profile:deleted",{profileId:e,profile:t,switchedProfile:i,timestamp:Date.now()}),{success:!0,deletedProfile:t,switchedProfile:i,message:this.i18n.t("profile_deleted",{profileName:t.name})}}catch(e){const t=this.i18n.t("failed_to_delete_profile",{error:e.message});throw new Error(t)}}processUpdateOperations(e,t){const i=JSON.parse(JSON.stringify(e));if(t.delete){if(t.delete.aliases&&t.delete.aliases.forEach(e=>{i.aliases&&delete i.aliases[e]}),t.delete.builds)for(const[e,n]of Object.entries(t.delete.builds))i.builds?.[e]?.keys&&n.keys&&n.keys.forEach(t=>{delete i.builds[e].keys[t]});t.delete.bindsets&&Array.isArray(t.delete.bindsets)&&t.delete.bindsets.forEach(e=>{i.bindsets&&delete i.bindsets[e]}),t.delete.bindsetMetadata&&Array.isArray(t.delete.bindsetMetadata)&&t.delete.bindsetMetadata.forEach(e=>{i.bindsetMetadata&&delete i.bindsetMetadata[e]})}if(t.add){if(t.add.aliases&&(i.aliases={...i.aliases||{},...t.add.aliases}),t.add.builds){i.builds=i.builds||{space:{keys:{}},ground:{keys:{}}};for(const[e,n]of Object.entries(t.add.builds))i.builds[e]=i.builds[e]||{keys:{}},n.keys&&(i.builds[e].keys={...i.builds[e].keys||{},...n.keys})}t.add.bindsets&&(i.bindsets={...i.bindsets||{},...t.add.bindsets}),t.add.bindsetMetadata&&(i.bindsetMetadata={...i.bindsetMetadata||{},...t.add.bindsetMetadata})}if(t.modify){if(t.modify.aliases){i.aliases=i.aliases||{};for(const[e,n]of Object.entries(t.modify.aliases))i.aliases[e]&&(i.aliases[e]={...i.aliases[e],...n})}if(t.modify.keybindMetadata){i.keybindMetadata=i.keybindMetadata||{};for(const[e,n]of Object.entries(t.modify.keybindMetadata)){i.keybindMetadata[e]=i.keybindMetadata[e]||{};for(const[t,a]of Object.entries(n))0===Object.keys(a).length?delete i.keybindMetadata[e][t]:i.keybindMetadata[e][t]=a}}if(t.modify.aliasMetadata){i.aliasMetadata=i.aliasMetadata||{};for(const[e,n]of Object.entries(t.modify.aliasMetadata))0===Object.keys(n).length?delete i.aliasMetadata[e]:i.aliasMetadata[e]=n}if(t.modify.builds){i.builds=i.builds||{space:{keys:{}},ground:{keys:{}}};for(const[e,n]of Object.entries(t.modify.builds))if(i.builds[e]=i.builds[e]||{keys:{}},n.keys){i.builds[e].keys=i.builds[e].keys||{};for(const[t,a]of Object.entries(n.keys))i.builds[e].keys[t]&&(i.builds[e].keys[t]=a)}}if(t.modify.bindsets){i.bindsets=i.bindsets||{};for(const[e,n]of Object.entries(t.modify.bindsets)){i.bindsets[e]=i.bindsets[e]||{space:{keys:{}},ground:{keys:{}}};for(const[t,a]of Object.entries(n))if(i.bindsets[e][t]=i.bindsets[e][t]||{keys:{}},a.keys){i.bindsets[e][t].keys=i.bindsets[e][t].keys||{},console.log("[DataCoordinator] Incoming envData.keys for bindset",e,t,JSON.stringify(a.keys));for(const[n,s]of Object.entries(a.keys))null===s?delete i.bindsets[e][t].keys[n]:i.bindsets[e][t].keys[n]=s;console.log("[DataCoordinator] Resulting keys for bindset",e,t,JSON.stringify(i.bindsets[e][t].keys))}}}if(t.modify.bindsetMetadata){i.bindsetMetadata=i.bindsetMetadata||{};for(const[e,n]of Object.entries(t.modify.bindsetMetadata)){i.bindsetMetadata[e]=i.bindsetMetadata[e]||{};for(const[t,a]of Object.entries(n)){i.bindsetMetadata[e][t]=i.bindsetMetadata[e][t]||{};for(const[n,s]of Object.entries(a))0===Object.keys(s).length?delete i.bindsetMetadata[e][t][n]:i.bindsetMetadata[e][t][n]={...i.bindsetMetadata[e][t][n]||{},...s}}}}}return t.properties&&Object.assign(i,t.properties),i}async updateProfile(e,t){if(!e)throw new Error("Profile ID is required");if(!t||null===t)throw new Error("Updates are required");const i=this.state.profiles[e];if(!i)throw new Error(`Profile ${e} not found`);const{updateSource:n,...a}=t;if(!(a.add||a.delete||a.modify||a.properties))throw new Error("Explicit operations (add/delete/modify/properties) required");const s=this.processUpdateOperations(i,{...a,properties:{...a.properties||{},lastModified:(new Date).toISOString()}});try{return console.log(`[${this.componentName}] Saving profile ${e} to storage:`,s),await this.storage.saveProfile(e,s),this.state.profiles[e]=s,this.state.metadata.lastModified=(new Date).toISOString(),!!(a.add||a.delete||a.modify)&&this.emit("profile:updated",{profileId:e,profile:s,updates:a,updateSource:n,timestamp:Date.now()}),{success:!0,profile:s}}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}}async setEnvironment(e){if(!e||!["space","ground","alias"].includes(e))throw new Error("Invalid environment");const t=this.state.currentEnvironment;if(this.state.currentEnvironment=e,this.state.currentProfile){const t={properties:{currentEnvironment:e}};await this.updateProfile(this.state.currentProfile,t)}return this.emit("environment:changed",{fromEnvironment:t,toEnvironment:e,environment:e,timestamp:Date.now()},{synchronous:!0}),{success:!0,environment:e}}getKeys(e){if(!this.state.currentProfile)return{};const t=this.state.profiles[this.state.currentProfile];if(!t||!t.builds||!t.builds[e])return{};const i=t.builds[e].keys||{},n=this.state.currentBindset||"Primary Bindset";if("Primary Bindset"===n)return i;const a=t.bindsets?.[n]?.[e]?.keys||{};return{...i,...a}}getKeyCommands(e,t){const i=this.getKeys(e)[t]||[];return Array.isArray(i)?[...i]:i}async getSettings(){return{...this.state.settings}}async updateSettings(e){if(!e)throw new Error("Settings are required");return this.state.settings={...this.state.settings,...e},await this.storage.saveSettings(this.state.settings),this.state.metadata.lastModified=(new Date).toISOString(),this.emit("settings:changed",{settings:this.state.settings,updates:e,timestamp:Date.now()}),{success:!0,settings:this.state.settings}}async loadDefaultData(){console.log(`[${this.componentName}] Explicitly loading default data...`);try{const e=await this.request("data:get-default-profiles");return e&&0!==Object.keys(e).length?(await this.createDefaultProfilesFromData(e),console.log(`[${this.componentName}] Successfully loaded default data`),{success:!0,profilesCreated:Object.keys(e).length,currentProfile:this.state.currentProfile}):(console.warn(`[${this.componentName}] No default profiles available from DataService`),{success:!1,error:"No default profiles available"})}catch(e){return console.error(`[${this.componentName}] Failed to load default data:`,e),{success:!1,error:e.message}}}async tryCreateDefaultProfiles(){if(this.needsDefaultProfiles)try{console.log(`[${this.componentName}] Attempting to get default profiles from DataService...`);const e=await this.request("data:get-default-profiles");e&&Object.keys(e).length>0?(console.log(`[${this.componentName}] Got default profiles from DataService, creating...`),await this.createDefaultProfilesFromData(e),this.needsDefaultProfiles=!1):console.log(`[${this.componentName}] No default profiles from DataService, will try again later`)}catch(e){console.error(`[${this.componentName}] Failed to create default profiles:`,e.message),this.emit("profiles:creation-failed",{error:e.message})}}async handleInitialState(e,t){console.log(`[${this.componentName}] handleInitialState called - sender: "${e}", needsDefaultProfiles: ${this.needsDefaultProfiles}`),console.log(`[${this.componentName}] Received state from ${e}:`,t),"DataService"===e&&this.needsDefaultProfiles&&(console.log(`[${this.componentName}] DataService is now available, trying to create default profiles...`),await this.tryCreateDefaultProfiles())}async createDefaultProfilesFromData(e){if(!e||0===Object.keys(e).length)return console.warn(`[${this.componentName}] No default profiles data available, creating minimal fallback`),void await this.createFallbackProfiles();const t={};for(const[i,n]of Object.entries(e)){const e={name:n.name,description:n.description||"",currentEnvironment:n.currentEnvironment||"space",builds:n.builds||{space:{keys:{}},ground:{keys:{}}},bindsets:n.bindsets||{},aliases:n.aliases||{},selections:n.selections||{},keybindMetadata:n.keybindMetadata||{},aliasMetadata:n.aliasMetadata||{},bindsetMetadata:n.bindsetMetadata||{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()};nt(e),t[i]=e}for(const[e,i]of Object.entries(t))try{await this.storage.saveProfile(e,i),this.state.profiles[e]=i}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}let i=!1;if(!this.state.currentProfile&&Object.keys(t).length>0){this.state.currentProfile=Object.keys(t)[0],i=!0;const e=this.storage.getAllData();e.currentProfile=this.state.currentProfile,await this.storage.saveAllData(e);const n=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=n.currentEnvironment||"space"}if(this.state.metadata.lastModified=(new Date).toISOString(),console.log(`[${this.componentName}] Created ${Object.keys(t).length} default profiles from DataService`),this.emit("profiles:initialized",{profiles:this.state.profiles,currentProfile:this.state.currentProfile,timestamp:Date.now()}),i&&this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const e=this.state.profiles[this.state.currentProfile],t=this.buildVirtualProfile(e,this.state.currentEnvironment);console.log(`[${this.componentName}] Emitting profile:switched for initial profile activation: ${this.state.currentProfile}`),this.emit("profile:switched",{fromProfile:null,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:t,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}else i&&console.log(`[${this.componentName}] Profile activation attempted but profile data not ready, delaying profile:switched broadcast`)}async createFallbackProfiles(){const e={default:{name:"Default",description:"Basic space build profile",currentEnvironment:"space",builds:{space:{keys:{}},ground:{keys:{}}},bindsets:{},aliases:{},created:(new Date).toISOString(),lastModified:(new Date).toISOString()}};for(const[t,i]of Object.entries(e)){nt(i);try{await this.storage.saveProfile(t,i),this.state.profiles[t]=i}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}}let t=!1;if(!this.state.currentProfile){this.state.currentProfile="default",t=!0;const e=this.storage.getAllData();e.currentProfile=this.state.currentProfile,await this.storage.saveAllData(e);const i=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=i.currentEnvironment||"space"}if(this.state.metadata.lastModified=(new Date).toISOString(),console.log(`[${this.componentName}] Created ${Object.keys(e).length} fallback profiles`),this.emit("profiles:initialized",{profiles:this.state.profiles,currentProfile:this.state.currentProfile,timestamp:Date.now()}),t&&this.state.currentProfile){const e=this.state.profiles[this.state.currentProfile],t=this.buildVirtualProfile(e,this.state.currentEnvironment);console.log(`[${this.componentName}] Emitting profile:switched for initial fallback profile activation: ${this.state.currentProfile}`),this.emit("profile:switched",{fromProfile:null,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:t,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}}generateProfileId(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,50)}async normalizeAllProfiles(){let e=0;for(const[t,i]of Object.entries(this.state.profiles))if(lt(i)){console.log(`[${this.componentName}] Migrating profile: ${t}`);const n=i.migrationVersion||"2.0.0";nt(i);const a=i.migrationVersion;try{await this.storage.saveProfile(t,i),e++,console.log(`[${this.componentName}] Profile ${t} migrated from ${n} to ${a}`)}catch(e){const t=this.i18n.t("failed_to_save_profile",{error:e.message});throw new Error(t)}}e>0&&console.log(`[${this.componentName}] Migrated ${e} profiles`)}async reloadState(){console.log(`[${this.componentName}] Reloading state from storage...`);try{const e=this.storage.getAllData();if(this.state.profiles=e.profiles||{},this.state.currentProfile=e.currentProfile||null,this.state.settings=e.settings||{},await this.normalizeAllProfiles(),this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const e=this.state.profiles[this.state.currentProfile];this.state.currentEnvironment=e.currentEnvironment||"space"}else this.state.currentEnvironment="space";if(this.state.metadata.lastModified=(new Date).toISOString(),console.log(`[${this.componentName}] State reloaded. Current profile: ${this.state.currentProfile}, Environment: ${this.state.currentEnvironment}`),this.emit("profiles:initialized",{profiles:this.state.profiles,currentProfile:this.state.currentProfile,timestamp:Date.now()}),this.state.currentProfile&&this.state.profiles[this.state.currentProfile]){const e=this.state.profiles[this.state.currentProfile],t=this.buildVirtualProfile(e,this.state.currentEnvironment);this.emit("profile:switched",{fromProfile:null,toProfile:this.state.currentProfile,profileId:this.state.currentProfile,profile:t,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0})}return this.emit("environment:changed",{fromEnvironment:null,toEnvironment:this.state.currentEnvironment,environment:this.state.currentEnvironment,timestamp:Date.now()},{synchronous:!0}),this.emit("settings:changed",{settings:this.state.settings,updates:this.state.settings,timestamp:Date.now()}),console.log(`[${this.componentName}] Emitted refresh events after state reload`),{success:!0,profiles:Object.keys(this.state.profiles).length,currentProfile:this.state.currentProfile,environment:this.state.currentEnvironment}}catch(e){return console.error(`[${this.componentName}] Failed to reload state:`,e),{success:!1,error:e.message}}}}class mt{constructor({id:e,defaultSeverity:t,messageKey:i,tags:n=[]}={}){if(!e)throw new Error('Validator requires "id"');if(!t)throw new Error('Validator requires "defaultSeverity"');if(!i)throw new Error('Validator requires "messageKey"');this.id=e,this.level=t,this.messageKey=i,this.tags=n}validate(){throw new Error("validate(ctx) not implemented")}run(e){const t=this.validate(e);return t?{id:this.id,severity:t.severity||this.level,key:"function"==typeof t.key?t.key(e):t.key||this.messageKey,params:t.params||{},defaultMessage:t.defaultMessage}:null}}const ht=/trayexec|slot|stotrayexec/i,ut="undefined"!=typeof window&&window.COMMANDS?window.COMMANDS:{};function pt(e){if(!e)return null;const t=e.trim().split(/\s+/)[0].toLowerCase();for(const e in ut){const i=ut[e];if(i&&i.command&&i.command.toLowerCase()===t)return i.environment||null}return null}const ft="undefined"!=typeof window&&window.COMMANDS?window.COMMANDS:{};function yt(e){if(!e)return null;const t=e.trim().toLowerCase();for(const e in ft){const i=ft[e];if(!i||!i.command)continue;const n=i.command.trim().toLowerCase();if(t===n)return{...i,he:e};if(t.startsWith(n))return{...i,he:e};if(t.split(/\s+/)[0]===n)return{...i,he:e}}return null}const _t=new Set(t.map(e=>e.toUpperCase())),gt=[new class extends mt{constructor(){super({id:"maxLength",defaultSeverity:"warning",messageKey:"command_chain_near_limit",tags:["length","performance"]})}validate(e){const{length:t}=e;return t>=990?{severity:"error",key:"command_chain_too_long",params:{length:t},defaultMessage:`Command chain exceeds safe length (${t}/999). It may fail in game.`}:t>=900?{params:{length:t},defaultMessage:`Command chain is ${t} characters; consider shortening (limit 999).`}:null}},new class extends mt{constructor(){super({id:"stabilizedTrayOnly",defaultSeverity:"warning",messageKey:"stabilized_non_tray_warning"})}validate(e){const{stabilized:t,commands:i}=e;return t&&Array.isArray(i)&&0!==i.length&&i.some(e=>{const t="string"==typeof e?e:e.command||"";return!ht.test(t)})?{severity:"warning",key:"stabilized_non_tray_warning",defaultMessage:"Stabilized execution should only be used with tray execution abilities."}:null}},new class extends mt{constructor(){super({id:"keyCommandCount",defaultSeverity:"warning",messageKey:"too_many_commands_on_key"})}validate(e){const{isAlias:t,commands:i}=e;return t||!Array.isArray(i)?null:i.length>20?{severity:"warning",key:"too_many_commands_on_key",params:{count:i.length},defaultMessage:`Binding ${i.length} commands to one key may fail in game (max recommended 20).`}:null}},new class extends mt{constructor(){super({id:"aliasMixedEnvironment",defaultSeverity:"warning",messageKey:"alias_mixed_environment_warning"})}validate(e){const{isAlias:t,commands:i}=e;if(!t||!Array.isArray(i))return null;let n=!1,a=!1;for(const e of i){const t=pt("string"==typeof e?e:e.command||"");if("space"===t?n=!0:"ground"===t&&(a=!0),n&&a)break}return n&&a?{severity:"warning",key:"alias_mixed_environment_warning",defaultMessage:"Alias contains both space-only and ground-only commands; consider splitting for reliability."}:null}},new class extends mt{constructor(){super({id:"commandWarnings",defaultSeverity:"warning",messageKey:"_internal_command_warning"})}get i18n(){return"undefined"!=typeof window&&window.i18next?window.i18next:null}validate(e){const{commands:t}=e;if(!Array.isArray(t)||0===t.length)return null;const i=[];for(const e of t){const t="string"==typeof e?e:e.command||"",n=yt(t);if(n&&n.warning){let e=n.name||t;if(n.he&&this.i18n){const t=`command_definitions.${n.he}.name`,i=this.i18n.t(t);i&&i!==t&&(e=i)}let a=n.warning;if(this.i18n){const e=this.i18n.t(n.warning);a=e&&e!==n.warning?e:n.warning}i.push({name:e,warnText:a})}}return i}run(e){const t=this.validate(e);return t&&0!==t.length?t.map(({name:e,warnText:t})=>({id:this.id,severity:"warning",defaultMessage:`${e} - ${t}`})):null}}({i18n:"undefined"!=typeof window&&window.i18next?window.i18next:null}),new class extends mt{constructor(){super({id:"unsafeKeybind",defaultSeverity:"warning",messageKey:"unsafe_keybind"})}validate(e){const{key:t}=e||{};if(!t)return null;const i=t.trim().toUpperCase();return _t.has(i)?{severity:"warning",params:{key:t}}:null}},new class extends mt{constructor(){super({id:"stoTrayExecOptimization",defaultSeverity:"warning",messageKey:"sto_tray_exec_optimization_suggestion",tags:["length","optimization","tray"]})}validate(e){const{length:t,generatedCommand:i}=e;if(t<900)return null;const n=i.match(/STOTrayExecByTray/g),a=n?n.length:0;if(a>0){const e=3*a,i=t-e;return{severity:"warning",key:"sto_tray_exec_optimization_suggestion",params:{currentLength:t,potentialSavings:e,newLength:i,count:a},defaultMessage:`Command chain is ${t} characters. Replacing ${a} instance(s) of STOTrayExecByTray with TrayExecByTray would save ${e} characters (new length: ${i}).`}}return null}}];class bt extends re{constructor({eventBus:e,i18n:t,ui:i=null}={}){super(e),this.componentName="CommandChainValidatorService",this.i18n=t,this.ui=i}onInit(){this.addEventListener("command-chain:validate",async({key:e,stabilized:t,isAlias:i})=>{await this.validateChain(e,t,i)})}async validateChain(e,t=void 0,i=void 0){if(!this.ue){this.ue=!0;try{const n=await this.request("command:get-for-selected-key");Array.isArray(n)||console.warn("[CommandChainValidatorService] No commands array returned ‚Äì proceeding with empty list");const a=Array.isArray(n)?n:[],s=await this.request("command:generate-command-preview",{key:e,commands:a,stabilize:!1}),o=void 0!==t&&t,r=void 0!==i&&i;let c,l;if(o&&a.length>1){const t=await this.request("command:generate-command-preview",{key:e,commands:a,stabilize:!0});c=t.length,l=t}else c=s.length,l=s;const d={key:e,commands:a,length:c,stabilized:o,isAlias:r,generatedCommand:l},m=gt.flatMap(e=>{const t=e.run(d);return t?Array.isArray(t)?t:[t]:[]}),h=m.filter(e=>"error"===e.severity),u=m.filter(e=>"warning"===e.severity),p=h.length?"error":u.length?"warning":"success";this.emit("command-chain:validation-result",{key:e,length:c,severity:p,warnings:u,errors:h}),this.pe||(this.pe={}),this.pe[e],this.pe[e]=p}catch(e){console.error("[CommandChainValidatorService] validateChain failed:",e)}finally{this.ue=!1}}}}class vt extends re{constructor(e=null){super(e),this.pendingInitialRender=!1}uiInit(){this.hasRequiredData()?this.performInitialRender():this.pendingInitialRender=!0}onInit(){}handleInitialState(e,t){super.handleInitialState(e,t),this.pendingInitialRender&&this.hasRequiredData()&&(this.pendingInitialRender=!1,this.performInitialRender())}hasRequiredData(){return!0}performInitialRender(){}showToast(e,t="info"){this.emit("toast:show",{message:e,type:t})}}class wt extends vt{constructor({eventBus:e,storage:t,ui:i,fileSystem:n,document:a=window.document,i18n:s}={}){super(e),this.componentName="FileExplorerUI",this.storage=t||window.storageService||null,this.ui=i||window.stoUI||null,this.fileSystem=n||Ee.ce(),this.document=a,this.i18n=s,this.modalId="fileExplorerModal",this.treeId="fileTree",this.contentId="fileContent",this.selectedNode=null}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventBus.on("file-explorer:open",()=>{this.openExplorer()}),this.onDom("fileExplorerBtn","click","fileExplorer-open",()=>{this.openExplorer()}),this.onDom(this.treeId,"click","fileExplorer-tree-click",e=>{const t=e.target.closest(".tree-node");t&&this.selectNode(t)}),this.onDom("copyFileContentBtn","click","fileExplorer-copy-content",async()=>{const e=this.document.getElementById(this.contentId);if(!e)return;const t=e.textContent||"";if(!t.trim())return void this.showToast(i18next.t("nothing_to_copy"),"warning");const i=await this.request("utility:copy-to-clipboard",{text:t});i?.success?this.showToast(i18next.t?.(i?.message),"success"):this.showToast(i18next.t?.(i?.message),"error")}),this.onDom("downloadFileBtn","click","fileExplorer-download",async()=>{if(!this.selectedNode)return;const{type:e,profileId:t,environment:i}=this.selectedNode,n=this.document.getElementById(this.contentId);if(!n)return;const a=n.textContent||"";if(!a.trim())return;let s=i18next.t("default_export_filename");if(this.storage){const n=this.storage.getProfile(t);try{"build"===e?s=await this.request("export:generate-filename",{profile:n,extension:"txt",environment:i}):"aliases"===e&&(s=await this.request("export:generate-alias-filename",{profile:n,extension:"txt"}))}catch(e){console.error("Failed to generate filename via ExportService:",e)}}this.downloadFile(a,s,"text/plain")})}openExplorer(){this.buildTree();const e=this.document.getElementById(this.contentId);e&&(e.textContent=i18next.t("select_an_item_on_the_left_to_preview_export")),this.emit("modal:show",{modalId:this.modalId})}buildTree(){const e=this.document.getElementById(this.treeId);if(!e||!this.storage)return;e.innerHTML="";const t=this.storage.getAllData().profiles||{};Object.entries(t).forEach(([t,i])=>{const n=this.createNode("profile",i.name,{profileId:t}),a=this.document.createElement("div");if(a.className="tree-children",i.builds&&i.builds.space){const e=this.createNode("build",this.i18n.t("space_build"),{profileId:t,environment:"space"});a.appendChild(e)}if(i.builds&&i.builds.ground){const e=this.createNode("build",this.i18n.t("ground_build"),{profileId:t,environment:"ground"});a.appendChild(e)}const s=this.createNode("aliases",this.i18n.t("aliases"),{profileId:t});a.appendChild(s),n.appendChild(a),e.appendChild(n)})}createNode(e,t,i={}){const n=this.document.createElement("div");return n.className=`tree-node ${e}`,n.textContent=t,n.dataset.type=e,Object.entries(i).forEach(([e,t])=>n.setAttribute(`data-${e}`,t)),n}async selectNode(e){const t=this.document.querySelector(".tree-node.selected");t&&t.classList.remove("selected"),e.classList.add("selected");const i=e.dataset.type||e.getAttribute("data-type"),n=e.getAttribute("data-profileid"),a=e.getAttribute("data-environment");if(this.selectedNode={type:i,profileId:n,environment:a},n&&this.storage)try{let e="";e="build"===i?await this.generateBuildExport(n,a):"aliases"===i?await this.generateAliasExport(n):i18next.t("select_a_space_ground_build_or_aliases_to_preview_export");const t=this.document.getElementById(this.contentId);t&&(t.textContent=e||i18next.t("no_content_available"))}catch(e){console.error("Failed to generate export content:",e),this.ui?.showToast(i18next.t("failed_to_generate_export"),"error")}}async generateBuildExport(e,t){const i=this.storage.getProfile(e);return i&&i.builds&&i.builds[t]?await this.request("export:generate-keybind-file",{profileId:e,environment:t}).catch(e=>(console.error("Failed to generate keybind export via ExportService:",e),`; Failed to generate export: ${e.message}`)):""}async generateAliasExport(e){const t=this.storage.getProfile(e);return t?await this.request("export:generate-alias-file",{profileId:e}).catch(e=>(console.error("Failed to generate alias export via ExportService:",e),`; Failed to generate export: ${e.message}`)):""({...t.aliases||{},...t.builds?.space?.aliases||{},...t.builds?.ground?.aliases||{}})}downloadFile(e,t,i){const n=new Blob([e],{type:i}),a=URL.createObjectURL(n),s=this.document.createElement("a");s.href=a,s.download=t,this.document.body.appendChild(s),s.click(),this.document.body.removeChild(s),URL.revokeObjectURL(a)}}const kt=new Proxy({currentProfile:null,currentMode:"space",currentEnvironment:"space",selectedKey:null,isModified:!1,undoStack:[],redoStack:[],maxUndoSteps:50,commandIdCounter:0},{set:(e,t,i)=>(e[t]=i,c&&c.emit&&c.emit(`store:${t}`,i),!0)});class St extends vt{constructor({eventBus:e,ui:t=null,modalManager:i=null,confirmDialog:n=null,document:a=null,i18n:s}){super(e),this.componentName="ProfileUI",this.ui=t,this.modalManager=i,this.confirmDialog=n||("undefined"!=typeof window?window.confirmDialog:null),this.document=a||("undefined"!=typeof window?window.document:null),this.i18n=s,this.fe=!1,this.currentModal=null,this.eventListenersSetup=!1}onInit(){this.setupEventListeners(),this.renderProfiles(),this.updateProfileInfo()}setupEventListeners(){if(this.eventListenersSetup)return;this.eventListenersSetup=!0;const e=this.document.getElementById("profileSelect");e&&this.onDom(e,"change","profile-switch",e=>{this.handleProfileSwitch(e.target.value)}),this.onDom("newProfileBtn","click","profile-new",()=>{this.showNewProfileModal()}),this.onDom("cloneProfileBtn","click","profile-clone",()=>{this.showCloneProfileModal()}),this.onDom("renameProfileBtn","click","profile-rename",()=>{this.showRenameProfileModal()}),this.onDom("deleteProfileBtn","click","profile-delete",()=>{this.confirmDeleteProfile()}),this.onDom("saveProfileBtn","click","profile-save",()=>{this.handleProfileSave()}),this.addEventListener("profile:switched",({profileId:e,environment:t,profile:i}={})=>{this.fe=!1,this.renderProfiles(),this.updateProfileInfo()}),this.addEventListener("environment:changed",({environment:e}={})=>{this.updateProfileInfo()}),this.addEventListener("profile-modified",()=>{this.fe=!0,this.updateProfileInfo()}),this.addEventListener("current-profile:updated",({profile:e})=>{this.updateProfileInfo()})}async handleProfileSwitch(e){try{const t=await this.request("data:switch-profile",{profileId:e});t?.switched&&(this.updateProfileInfo(),this.showToast(t.message,"success"))}catch(e){this.showToast(e.message,"error")}}async renderProfiles(){const e=this.document.getElementById("profileSelect");if(!e)return;const t=await this.request("data:get-all-profiles");e.innerHTML="";const i=Object.entries(t||{});if(0===i.length){const t=this.document.createElement("option");t.value="",t.textContent=this.i18n.t("no_profiles_available"),t.disabled=!0,e.appendChild(t)}else i.forEach(([t,i])=>{const n=this.document.createElement("option");n.value=t,n.textContent=i.name,t===this.cache.currentProfile&&(n.selected=!0),e.appendChild(n)});this.updateProfileInfo()}updateProfileInfo(){this.document.querySelectorAll(".mode-btn").forEach(e=>{e.classList.toggle("active",this.cache.profile&&e.dataset.mode===this.cache.currentEnvironment),e.disabled=!this.cache.currentProfile});const e=this.document.getElementById("keyCount"),t=this.document.getElementById("aliasCount");if(!e||!t)return;if("alias"===this.cache.currentEnvironment){e.style.display="none",t.style.display="";const i=Object.keys(this.cache.aliases||{}).length,n=1===i?this.i18n.t("alias_lowercase"):this.i18n.t("aliases_lowercase");t.textContent=`${i} ${n}`}else if(e.style.display="",t.style.display="none",this.cache.profile){const t=this.cache.profile.builds?.[this.cache.currentEnvironment],i=Object.keys(t?.keys||{}).length,n=1===i?this.i18n.t("key"):this.i18n.t("keys");e.textContent=`${i} ${n}`}else e.textContent=this.i18n.t("no_profile");const i=this.document.getElementById("modifiedIndicator");i&&(i.style.display=this.fe?"inline":"none")}showNewProfileModal(){this.document.getElementById("profileModal");const e=this.document.getElementById("profileModalTitle"),t=this.document.getElementById("profileName"),i=this.document.getElementById("profileDescription");e&&(e.textContent=this.i18n.t("new_profile")),t&&(t.value="",t.placeholder="Enter profile name"),i&&(i.value=""),this.currentModal="new",this.modalManager.show("profileModal")}showCloneProfileModal(){if(!this.cache.profile)return void this.showToast(this.i18n.t("no_profile_selected_to_clone"),"warning");this.document.getElementById("profileModal");const e=this.document.getElementById("profileModalTitle"),t=this.document.getElementById("profileName"),i=this.document.getElementById("profileDescription");e&&(e.textContent=this.i18n.t("clone_profile")),t&&(t.value=`${this.cache.profile.name} Copy`,t.placeholder="Enter new profile name"),i&&(i.value=`Copy of ${this.cache.profile.name}`),this.currentModal="clone",this.modalManager.show("profileModal")}showRenameProfileModal(){if(!this.cache.profile)return void this.showToast(this.i18n.t("no_profile_selected_to_rename"),"warning");this.document.getElementById("profileModal");const e=this.document.getElementById("profileModalTitle"),t=this.document.getElementById("profileName"),i=this.document.getElementById("profileDescription");e&&(e.textContent=this.i18n.t("rename_profile")),t&&(t.value=this.cache.profile.name,t.placeholder="Enter profile name"),i&&(i.value=this.cache.profile.description||""),this.currentModal="rename",this.modalManager.show("profileModal")}async handleProfileSave(){const e=this.document.getElementById("profileName"),t=this.document.getElementById("profileDescription");if(!e)return;const i=e.value.trim(),n=t?t.value.trim():"";if(i)try{let e;switch(this.currentModal){case"new":e=await this.request("data:create-profile",{name:i,description:n}),e?.success&&(await this.request("data:switch-profile",{profileId:e.profileId}),await this.renderProfiles(),this.updateProfileInfo(),this.showToast(e.message,"success"));break;case"clone":e=await this.request("data:clone-profile",{sourceId:this.cache.currentProfile,newName:i}),e?.success&&(await this.renderProfiles(),this.showToast(e.message,"success"));break;case"rename":e=await this.request("data:rename-profile",{profileId:this.cache.currentProfile,newName:i,description:n}),e?.success&&(await this.renderProfiles(),this.updateProfileInfo(),this.showToast(e.message||this.i18n.t("profile_renamed"),"success"))}this.modalManager.hide("profileModal"),this.currentModal=null}catch(e){this.showToast(e.message,"error")}else this.showToast(this.i18n.t("profile_name_required"),"error")}async confirmDeleteProfile(){if(!this.cache.profile)return void this.showToast(this.i18n.t("no_profile_selected_to_delete"),"warning");if(!this.confirmDialog)return;const e=this.i18n.t("confirm_delete_profile",{profileName:this.cache.profile.name}),t=this.i18n.t("confirm_delete");await this.confirmDialog.confirm(e,t,"danger","profileDelete")&&this.deleteCurrentProfile()}async deleteCurrentProfile(){try{const e=await this.request("data:delete-profile",{profileId:this.cache.currentProfile});e.success&&(e.switchedProfile&&this.updateProfileInfo(),this.renderProfiles(),this.showToast(e.message,"success"))}catch(e){this.showToast(e.message,"error")}}handleInitialState(e,t){t&&"DataCoordinator"===e&&(this.renderProfiles(),this.updateProfileInfo())}getCurrentState(){return{currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment,modified:this.fe}}}class xt extends vt{constructor({eventBus:e,modalManager:t=null,i18n:i=null,ui:n=null,document:a=null}={}){super(e),this.componentName="ParameterCommandUI",this.modalManager=t,this.i18n=i,this.ui=n,this.document=a||("undefined"!=typeof window?window.document:null),this.currentParameterCommand=null}safeParseNumber(e,t){if(""===e||null==e)return;const i=Number(e);if(Number.isNaN(i))throw new d(`Invalid number for ${t}: '${e}' is not a valid number`,"INVALID_PARAMETER_NUMBER");return i}safeParseBoolean(e,t){if(""===e||null==e)return;const i=Number(e);if(Number.isNaN(i))throw new d(`Invalid boolean for ${t}: '${e}' is not a valid number`,"INVALID_PARAMETER_BOOLEAN");return 0!==i?1:0}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("parameter-command:edit",({index:e,command:t,commandDef:i,categoryId:n,commandId:a})=>{i&&n&&a&&this.editParameterizedCommand(e,t,i)}),this.addEventListener("language:changed",()=>{})}showParameterModal(e,t,i){this.currentParameterCommand={categoryId:e,commandId:t,commandDef:i},this.document.getElementById("parameterModal")?this.modalManager?.registerRegenerateCallback("parameterModal",()=>{this.regenerateParameterModal()}):this.createParameterModal();const n=this.document.getElementById("parameterModal");n&&n.setAttribute("data-command-def",JSON.stringify(i)),this.populateParameterModal(i),this.modalManager?.show("parameterModal")}createParameterModal(){const e=this.document.createElement("div");e.className="modal",e.id="parameterModal",e.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3 id="parameterModalTitle" data-i18n="parameter_configuration">Parameter Configuration</h3>\n          <button class="modal-close" data-modal="parameterModal">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body">\n          <div id="parameterInputs"></div>\n          <div class="command-preview-modal">\n            <label data-i18n="generated_command">${this.i18n.t("generated_command")}</label>\n            <div class="command-preview" id="parameterCommandPreview"></div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" id="saveParameterCommandBtn">${this.i18n.t("add_command")}</button>\n          <button class="btn btn-secondary" data-modal="parameterModal">${this.i18n.t("cancel")}</button>\n        </div>\n      </div>`,this.document.body.appendChild(e),this.modalManager?.registerRegenerateCallback("parameterModal",()=>{this.regenerateParameterModal()}),this.attachModalEventHandlers()}cancelParameterCommand(){this.emit("parameter-edit:end"),this.currentParameterCommand=null;const e=this.document.getElementById("saveParameterCommandBtn");e&&(e.textContent=this.i18n.t("add_command")),this.modalManager?.unregisterRegenerateCallback("parameterModal"),this.modalManager?.hide("parameterModal")}regenerateParameterModal(){if(!this.currentParameterCommand)return;const{commandDef:e,isEditing:t,editIndex:i,originalCommand:n}=this.currentParameterCommand,a=this.getParameterValues(),s=this.document.getElementById("parameterModal");if(s)if(s.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3 id="parameterModalTitle" data-i18n="parameter_configuration">Parameter Configuration</h3>\n          <button class="modal-close" data-modal="parameterModal">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body">\n          <div id="parameterInputs"></div>\n          <div class="command-preview-modal">\n            <label data-i18n="generated_command">${this.i18n.t("generated_command")}</label>\n            <div class="command-preview" id="parameterCommandPreview"></div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" id="saveParameterCommandBtn">${this.i18n.t(t?"save":"add_command")}</button>\n          <button class="btn btn-secondary" data-modal="parameterModal">${this.i18n.t("cancel")}</button>\n        </div>\n      </div>`,this.attachModalEventHandlers(),t){this.populateParameterModalForEdit(e,a);const t=this.document.getElementById("saveParameterCommandBtn");t&&(t.textContent=this.i18n.t("save"))}else this.populateParameterModal(e)}attachModalEventHandlers(){this.onDom("saveParameterCommandBtn","click","parameter-command-save",()=>{this.saveParameterCommand()});const e=this.document.getElementById("parameterModal");e&&e.querySelectorAll('.modal-close, [data-modal="parameterModal"]').forEach(e=>{this.onDom(e,"click","parameter-modal-close",()=>{this.cancelParameterCommand()})})}populateParameterModal(e){const t=this.document.getElementById("parameterInputs"),i=this.document.getElementById("parameterModalTitle");t&&i&&(i.textContent=`${this.i18n.t("configure_colon")} ${e.name}`,t.innerHTML="",this.buildParameterInputs(t,e),this.updateParameterPreview())}editParameterizedCommand(e,t,i){const n=fe(t);this.currentParameterCommand={categoryId:i.categoryId,commandId:i.commandId,commandDef:i,editIndex:e,originalCommand:t,isEditing:!0},this.document.getElementById("parameterModal")||this.createParameterModal();const a=this.document.getElementById("parameterModal");a&&a.setAttribute("data-command-def",JSON.stringify(i)),(async()=>{try{const e=(await pe(n,this.i18n,{eventBus:this.eventBus})).parameters||{};this.populateParameterModalForEdit(i,e);const t=this.document.getElementById("saveParameterCommandBtn");t&&(t.textContent=this.i18n.t("save")),this.modalManager?.show("parameterModal")}catch(e){console.error("[ParameterCommandUI] Error enriching command for editing:",e),this.populateParameterModalForEdit(i,{}),this.modalManager?.show("parameterModal")}})()}populateParameterModalForEdit(e,t={}){const i=this.document.getElementById("parameterInputs"),n=this.document.getElementById("parameterModalTitle");i&&n&&(n.textContent=`${this.i18n.t("edit_colon")} ${e.name}`,i.innerHTML="",this.buildParameterInputs(i,e,t),this.updateParameterPreview())}async updateParameterPreview(){if(!this.currentParameterCommand)return;const{categoryId:e,commandId:t,commandDef:i}=this.currentParameterCommand;let n;try{n=this.getParameterValues()}catch(e){const t=this.document.getElementById("parameterCommandPreview");return void(t&&(t.textContent=e.message||"Invalid parameter values",t.style.color="#d63031"))}try{const a=await this.request("parameter-command:build",{categoryId:e,commandId:t,commandDef:i,params:n}),s=this.document.getElementById("parameterCommandPreview");if(!s||!a)return;if(Array.isArray(a))s.textContent=a.map(e=>e.command||e).filter(e=>e).join(" $$ ");else{let e="";e="string"==typeof a?a:a.command?a.command:"Error: Invalid command format",s.textContent=e}s.style.color=""}catch(e){const t=this.document.getElementById("parameterCommandPreview");if(t)if("please_enter_a_raw_command"===e.message){const e=this.i18n.t("please_enter_a_raw_command");t.textContent=e}else{console.error("Error updating parameter preview:",e);const i=this.i18n.t("error_generating_command");t.textContent=i}}}getParameterValues(){const e=this.document.getElementById("parameterInputs");if(!e)return{};const t={},i=this.currentParameterCommand?.commandDef,n=i?.parameters||{};return e.querySelectorAll("input, select").forEach(e=>{const i=e.name;if(!i)return;const a=n[i];"number"===e.type?t[i]="boolean"===a?.type?this.safeParseBoolean(e.value,i):this.safeParseNumber(e.value,i):t[i]=e.value}),t}async saveParameterCommand(...e){const t=this.cache.currentEnvironment||"space",i="alias"===t?this.cache.selectedAlias:this.cache.selectedKey;if(!i||!this.currentParameterCommand){const e="alias"===t?this.i18n.t("please_select_an_alias_first"):this.i18n.t("please_select_a_key_first");return void this.ui?.showToast?.(e,"warning")}const{categoryId:n,commandId:a,commandDef:s}=this.currentParameterCommand;let o;try{o=this.getParameterValues()}catch(e){return void this.ui?.showToast?.(e.message||"Invalid parameter values","error")}try{const e=await this.request("parameter-command:build",{categoryId:n,commandId:a,commandDef:s,params:o});if(!e)return;if(this.currentParameterCommand.isEditing&&void 0!==this.currentParameterCommand.editIndex){const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;console.log("[ParameterCommandUI] emitting command:edit [parameterized]",{key:i,index:this.currentParameterCommand.editIndex,updatedCommand:e,bindset:t}),this.emit("command:edit",{key:i,index:this.currentParameterCommand.editIndex,updatedCommand:e,bindset:t})}else{const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;Array.isArray(e)?(console.log("[ParameterCommandUI] emitting command:add [bulk parameterized]",{commands:e,key:i}),this.emit("command:add",{command:e,key:i,bindset:t})):(console.log("[ParameterCommandUI] emitting command:add [single parameterized]",{command:e,key:i}),this.emit("command:add",{command:e,key:i,bindset:t}))}}catch(e){if(console.error("Error building parameterized command:",e),"please_enter_a_raw_command"===e.message){const e=this.i18n.t("please_enter_a_raw_command");this.ui?.showToast?.(e,"warning")}else{const e=this.i18n.t("error_generating_command");this.ui?.showToast?.(e,"error")}return}this.modalManager?.unregisterRegenerateCallback("parameterModal"),this.modalManager?.hide("parameterModal"),this.emit("parameter-edit:end"),this.currentParameterCommand=null;const r=this.document.getElementById("saveParameterCommandBtn");r&&(r.textContent=this.i18n.t("add_command")),this.modalManager?.unregisterRegenerateCallback("parameterModal")}formatParameterName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}getParameterHelp(e,t){return t.help?t.help:this.i18n.t(`command_parameters.${e}.help`)||this.i18n.t("parameter_value")}getOptionLabel(e,t){return"verb"===e?this.i18n.t(`verb.${t}`):"STOTrayExecByTray"===t?this.i18n.t("stotrayexecbytray_description"):"TrayExecByTray"===t?this.i18n.t("trayexecbytray_description"):t}buildParameterInputs(e,t,i={}){Object.entries(t.parameters).forEach(([t,n])=>{const a=this.document.createElement("div");a.className="form-group";const s=this.document.createElement("label");let o;s.textContent=n.label||this.i18n.t(`command_parameters.${t}.label`)||this.i18n.t(t)||this.formatParameterName(t),s.setAttribute("for",`param_${t}`);const r=i[t]??n.default;"select"===n.type?(o=this.document.createElement("select"),o.id=`param_${t}`,o.name=t,n.options.forEach(e=>{const i=this.document.createElement("option");i.value=e,i.textContent=this.getOptionLabel(t,e),e===r&&(i.selected=!0),o.appendChild(i)})):(o=this.document.createElement("input"),o.type="number"===n.type||"boolean"===n.type?"number":"text",o.id=`param_${t}`,o.name=t,o.value=r??"",n.placeholder&&(n.placeholder.startsWith("command_definitions.")&&this.i18n?o.placeholder=this.i18n.t(n.placeholder)||n.placeholder:o.placeholder=n.placeholder),"number"!==n.type&&"boolean"!==n.type||(void 0!==n.min&&(o.min=n.min),void 0!==n.max&&(o.max=n.max),void 0!==n.step&&(o.step=n.step)));const c=this.document.createElement("small");c.textContent=this.getParameterHelp(t,n),a.appendChild(s),a.appendChild(o),a.appendChild(c),e.appendChild(a),"boolean"===n.type?o.addEventListener("input",e=>{const t=e.target.value,i=Number(t);if(!Number.isNaN(i)){const t=0!==i?1:0;i!==t&&(e.target.value=t)}this.updateParameterPreview()}):o.addEventListener("input",()=>this.updateParameterPreview()),"SELECT"===o.tagName&&o.addEventListener("change",()=>this.updateParameterPreview())})}}class Ct extends vt{constructor({service:e,eventBus:t,ui:i,modalManager:n,document:a,i18n:s}){super(t),this.componentName="CommandLibraryUI",this.service=e,this.ui=i,this.modalManager=n,this.document=a||("undefined"!=typeof window?window.document:null),this.i18n=s,this.eventListenersSetup=!1,this.ye=!1,this._e=!1}onInit(){this.setupEventListeners(),this.setupCommandLibrary()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.addEventListener("profile:updated",({profile:e})=>{this.updateCommandLibrary()}),this.addEventListener("profile:switched",({profile:e})=>{this.updateCommandLibrary()}),this.addEventListener("environment:changed",()=>{const e=this.document.getElementById("commandSearch"),t=e?e.value:"";this.applySearchFilter(t)}),this.addEventListener("key-selected",()=>{this.updateChainActions()}),this.addEventListener("alias-selected",()=>{this.updateChainActions()}),this.addEventListener("language:changed",()=>{this.setupCommandLibrary()}),this.addEventListener("aliases-changed",({aliases:e})=>{e&&this.updateCommandLibrary()}),this.addEventListener("command:filter",({filter:e=""})=>{this.applySearchFilter(e)}),this.addEventListener("preferences:saved",()=>{this.setupCommandLibrary()}))}async setupCommandLibrary(){if(this.ye)this._e=!0;else{this.ye=!0;try{const e=this.document.getElementById("commandCategoriesList")||this.document.getElementById("commandCategories");if(!e)return;const t=this.document.createDocumentFragment(),i=await this.request("command:get-categories");Object.entries(i).forEach(([e,i])=>{const n=this.createCategoryElement(e,i);t.appendChild(n)}),e.replaceChildren(t),this.filterCommandLibrary(),await this.updateCommandLibrary()}finally{this.ye=!1,this._e&&(this._e=!1,this.setupCommandLibrary())}}}createCategoryElement(e,t){const i=this.document.createElement("div")||{};i.dataset||(i.dataset={}),i.className="category",i.dataset.category=e;const n=`commandCategory_${e}_collapsed`,a="true"===localStorage.getItem(n);i.innerHTML=`\n      <h4 class="${a?"collapsed":""}" data-category="${e}">\n        <i class="fas fa-chevron-right category-chevron"></i>\n        <i class="${t.icon}"></i> \n        ${t.name}\n        <span class="command-count">(${Object.keys(t.commands).length})</span>\n      </h4>\n      <div class="category-commands ${a?"collapsed":""}">\n        ${Object.entries(t.commands).map(([e,t])=>{const i=`command_definitions.${e}.name`,n=this.i18n.t(i),a=`command_definitions.${e}.description`,s=this.i18n.t(a);return`\n            <div class="command-item ${t.customizable?"customizable":""}" data-command="${e}" title="${s}${t.customizable?" (Customizable)":""}">\n              ${t.icon} ${n}${t.customizable?' <span class="param-indicator">‚öôÔ∏è</span>':""}\n            </div>\n          `}).join("")}\n      </div>\n    `;const s=i.querySelector?i.querySelector("h4"):null;return s&&this.onDom(s,"click","command-category-header",()=>{this.toggleCommandCategory(e,i)}),this.onDom(i,"click","command-item-click",e=>{if(e.target.classList.contains("command-item")){const t=e.target.dataset.command,i=e.target.closest(".category").dataset.category,n=STO_DATA?.commands?.[i]?.commands?.[t];if(!n)return;if(n.customizable)console.log("[CommandLibraryUI] emitting command-add [customizable]",{categoryId:i,commandId:t,commandDef:n}),this.emit("command-add",{categoryId:i,commandId:t,commandDef:n});else{const e={command:n.command,type:i,icon:n.icon,text:n.name,id:`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};console.log("[CommandLibraryUI] emitting command-add [static]",{commandDef:e}),this.emit("command-add",{commandDef:e})}}}),i}toggleCommandCategory(e,t){const i=t.querySelector("h4"),n=t.querySelector(".category-commands"),a=i.querySelector(".category-chevron"),s=`commandCategory_${e}_collapsed`;n.classList.contains("collapsed")?(n.classList.remove("collapsed"),i.classList.remove("collapsed"),a.style.transform="rotate(90deg)",localStorage.setItem(s,"false")):(n.classList.add("collapsed"),i.classList.add("collapsed"),a.style.transform="rotate(0deg)",localStorage.setItem(s,"true"))}createAliasCategoryElement(e,t="aliases",i="command_aliases",n="fas fa-mask"){const a=document.createElement("div");a.className="category",a.dataset.category=t;const s=`commandCategory_${t}_collapsed`,o="true"===localStorage.getItem(s);let r,c;"vertigo-aliases"===t?(r="üëÅÔ∏è",c="command-item vertigo-alias-item"):"bindset-aliases"===t?(r="üîß",c="command-item bindset-alias-item"):(r="üé≠",c="command-item alias-item"),a.innerHTML=`\n            <h4 class="${o?"collapsed":""}" data-category="${t}">\n                <i class="fas fa-chevron-right category-chevron"></i>\n                <i class="${n}"></i>\n                ${this.i18n.t(i)}\n                <span class="command-count">(${e.length})</span>\n            </h4>\n            <div class="category-commands ${o?"collapsed":""}">\n                ${e.map(([e,t])=>`\n                    <div class="${c}" data-alias="${e}" title="${t.description||t.commands}">\n                        ${r} ${t.displayName||t.ge||e}\n                    </div>\n                `).join("")}\n            </div>\n        `;const l=a.querySelector("h4");return this.onDom(l,"click","alias-category-header",()=>{this.toggleAliasCategory(t,a)}),this.onDom(a,"click","alias-item-click",t=>{if(t.target.classList.contains("alias-item")||t.target.classList.contains("vertigo-alias-item")||t.target.classList.contains("bindset-alias-item")){const i=t.target.dataset.alias,n=e.find(([e])=>e===i);console.log("[CommandLibraryUI] aliasEntry",n);const a=n?n[1]:{},s="vfx-alias"===a.type,o={command:i,type:a.type,icon:s?"üëÅÔ∏è":"üé≠",...s?{}:{text:`${i}`},description:a.description,isUserAlias:!0,isVfxAlias:s,id:`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};console.log("[CommandLibraryUI] emitting command:add [alias]",{commandDef:o}),this.emit("command-add",{commandDef:o})}}),a}toggleAliasCategory(e,t){const i=t.querySelector("h4"),n=t.querySelector(".category-commands"),a=i.querySelector(".category-chevron"),s=`commandCategory_${e}_collapsed`;n.classList.contains("collapsed")?(n.classList.remove("collapsed"),i.classList.remove("collapsed"),a.style.transform="rotate(90deg)",localStorage.setItem(s,"false")):(n.classList.add("collapsed"),i.classList.add("collapsed"),a.style.transform="rotate(0deg)",localStorage.setItem(s,"true"))}async updateCommandLibrary(){if(!this.cache.profile)return;const e=this.document.getElementById("aliasCategoriesList")||this.document.getElementById("commandCategories");if(!e)return;const t=await this.request("command:get-combined-aliases")||{},i=Object.entries(t),n=await Promise.all(i.map(async([e,t])=>("vfx-alias"!==t.type||t.ge||(t.ge=await this.be(e,t)),[e,t]))),a=n.filter(([,e])=>"vfx-alias"!==e.type),s=n.filter(([,e])=>"vfx-alias"===e.type);let o=[];try{const e=this.cache.preferences.bindsetsEnabled,t=this.cache.preferences.bindToAliasMode;if(e&&t){const e=(this.cache.profile||{}).bindsets||{},t=["space","ground"],i=(e="")=>{let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"");return/^[0-9]/.test(t)&&(t=`bs_${t}`),t};for(const n of t)["Primary Bindset",...Object.keys(e)].forEach(e=>{const t=`sto_kb_bindset_enable_${n}_${i(e)}`,a=this.i18n.t(n),s="Primary Bindset"===e?this.i18n.t("primary_bindset"):e,r=this.i18n.t("bindset_enable"),c=`${this.i18n.t("bindsets")}: ${a} - ${r} ${s}`;o.push([t,{type:"bindset-alias",description:c,commands:t,displayName:c}])})}}catch{}const r=this.document.createDocumentFragment();a.length>0&&r.appendChild(this.createAliasCategoryElement(a,"aliases","command_aliases","fas fa-mask")),s.length>0&&r.appendChild(this.createAliasCategoryElement(s,"vertigo-aliases","vfx_aliases","fas fa-eye-slash")),o.length>0&&r.appendChild(this.createAliasCategoryElement(o,"bindset-aliases","bindsets","fas fa-tags")),e.replaceChildren(r)}filterCommandLibrary(){this.request("command:filter-library").catch(()=>{})}updateChainActions(){if(window.commandChainUI&&"function"==typeof window.commandChainUI.updateChainActions)return void window.commandChainUI.updateChainActions();if(!this.document||!this.document.getElementById)return;const e=!!("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey),t=this.document;if("alias"===this.cache.currentEnvironment){["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(i=>{const n=t.getElementById(i);n&&(n.disabled=!e)});const i=t.getElementById("importFromKeyOrAliasBtn");i&&(i.disabled=!e),["deleteKeyBtn","duplicateKeyBtn"].forEach(e=>{const i=t.getElementById(e);i&&(i.disabled=!0)})}else["importFromKeyOrAliasBtn","deleteKeyBtn","duplicateKeyBtn"].forEach(i=>{const n=t.getElementById(i);n&&(n.disabled=!e)}),["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(e=>{const i=t.getElementById(e);i&&(i.disabled=!0)})}getCurrentState(){return{aliases:this.cache.aliases,currentProfile:this.cache.currentProfile,currentEnvironment:this.cache.currentEnvironment||"space",selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias}}handleInitialState(e,t){"DataCoordinator"===t&&e.currentProfileData&&this.updateCommandLibrary()}async applySearchFilter(e){const t=(e||"").trim().toLowerCase(),i=this.document||("undefined"!=typeof window?window.document:void 0);if(!i)return;const n=i.getElementById("commandCategories")||i.querySelector(".command-categories");if(!n)return;n.querySelectorAll(".command-item, .alias-item, .vertigo-alias-item, .bindset-alias-item").forEach(e=>{const i="true"===e.dataset.envHidden;if(!t)return void(i||(e.style.display="flex"));const n=(e.textContent||"").toLowerCase().includes(t);e.style.display=n&&!i?"flex":"none"}),n.querySelectorAll(".category").forEach(e=>{const i=e.querySelectorAll('.command-item:not([style*="display: none"]), .alias-item:not([style*="display: none"]), .vertigo-alias-item:not([style*="display: none"]), .bindset-alias-item:not([style*="display: none"])'),n=!t||i.length>0;e.style.display=n?"block":"none"});const a=i.getElementById("commandSearchBtn");a&&(a.classList.toggle("active",!!t),a.setAttribute("aria-pressed",!!t))}async be(e,t){if("vfx-alias"===t.type)try{const t=await this.request("parser:parse-command-string",{commandString:e,options:{generateDisplayText:!0}}),i=t?.commands?.[0];if(i?.displayText)return i.displayText}catch{}return e}}class Tt extends vt{constructor({eventBus:e,ui:t=null,modalManager:i=null,parameterCommandUI:n=null,confirmDialog:a=null,i18n:s,document:o=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="CommandUI",this.ui=t||("undefined"!=typeof stoUI?stoUI:null),this.modalManager=i,this.parameterCommandUI=n,this.confirmDialog=a||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=s,this.ve="Primary Bindset",this.we={warnings:[],errors:[]},this.ke=new Map,this.document=o,this.currentValidationModal=null}onInit(){this.setupEventListeners(),this.setupUIStateEventListeners()}setupUIStateEventListeners(){this.addEventListener("bindset-selector:active-changed",e=>{this.ve=e.bindset||"Primary Bindset"})}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("clearChainBtn","click","command-chain-clear",()=>{const e=this.getSelectedKey();e&&this.confirmClearChain(e)}),this.onDom("validateChainBtn","click","command-chain-validate",()=>{const e=this.getSelectedKey();e&&this.validateCurrentChain(e)}),this.onDomDebounced("commandSearch","input","command-search",e=>{this.filterCommands(e.target.value)},250),this.onDom("commandSearch","keydown","command-search-key",e=>{if("Escape"===e.key){const t=e.target;t.value="",t.classList.remove("expanded"),this.emit("command:filter",{filter:""})}else if("Enter"===e.key){const t=e.target;t.classList.remove("expanded"),t.blur()}}),this.onDom("showAllCommandsBtn","click","command-clear-filter",()=>{const e=this.document.getElementById("commandSearch");if(e){e.value="";const t=new Event("input",{bubbles:!0});e.dispatchEvent(t)}this.filterCommands("")}),this.onDom("commandSearchBtn","click","command-search-toggle",()=>{this.toggleCommandSearch()}),this.onDom("importFromKeyOrAliasBtn","click","import-from-key-or-alias",()=>{this.showImportFromKeyOrAliasModal()}),this.onDom("confirmImportBtn","click","confirm-import",()=>{this.performImport()}),this.addEventListener("command-add",async(e={})=>{const{categoryId:t,commandId:i,commandDef:n}=e;if(!n||t||i)t&&i&&n&&(this.parameterCommandUI?this.parameterCommandUI.showParameterModal(t,i,n):console.error("CommandUI: parameterCommandUI not available"));else try{const e=this.getSelectedKey();if(!e){const e="alias"===this.getCurrentEnvironment()?"please_select_an_alias_first":"please_select_a_key_first",t=this.i18n.t(e);return void await this.showToast(t,"warning")}const t="alias"===this.cache.currentEnvironment?null:this.ve;this.emit("command:add",{command:n,key:e,bindset:t})}catch(e){console.error("CommandUI: Failed to handle static command:",e)}}),this.addEventListener("command-chain:validation-result",async({key:e,severity:t,warnings:i=[],errors:n=[]})=>{const a=this.document.getElementById("statusIndicator");if(!a)return;const s=a.querySelector("i"),o=a.querySelector("span");if(!s||!o)return;const r={success:{icon:"fa-check-circle",textKey:"valid",textDefault:"Valid",color:"status-success"},warning:{icon:"fa-exclamation-triangle",textKey:"warning",textDefault:"Warning",color:"status-warning"},error:{icon:"fa-exclamation-circle",textKey:"error",textDefault:"Error",color:"status-error"}},c=r[t]||r.success;s.className=`fas ${c.icon}`,o.textContent=c.textDefault,o.setAttribute("data-i18n",c.textKey),a.classList.remove("status-success","status-warning","status-error"),a.classList.add(c.color),this.we={warnings:i,errors:n};const l=i&&i.length>0||n&&n.length>0,d=e||"__global__";let m=!1,h=!1;const u=this.ke.get(d);l&&"success"!==t?(m=u!==t,this.ke.set(d,t)):"success"===t?(u&&"success"===u||(h=!0),this.ke.set(d,"success")):this.ke.delete(d);const p=e=>{const t=this.i18n.t(e.key,e.params||{});return t&&"string"==typeof t&&t!==e.key&&!t.startsWith(`${e.key}:`)?t:e.defaultMessage||e.key};if(m){for(const e of n){const t=p(e);this.showToast(t,"error")}for(const e of i){const t=p(e);this.showToast(t,"warning")}}h&&(async()=>{const e=this.i18n.t("command_chain_is_valid");this.showToast(e,"success")})();const f=this.i18n.t(c.textKey);"string"==typeof f&&f&&f!==c.textKey&&(o.textContent=f),"success"!==t&&(i.length||n.length)?(a.classList.add("clickable"),a.onclick=()=>this.showValidationDetails()):(a.classList.remove("clickable"),a.onclick=null)}))}getSelectedKey(){return"alias"===(this.cache.currentEnvironment||"space")?this.cache.selectedAlias:this.cache.selectedKey}getCurrentEnvironment(){return this.cache.currentEnvironment||"space"}async confirmClearChain(e){if(!e)return;const t=this.getCurrentEnvironment(),i="alias"===t?"alias":"key";try{const n=this.i18n.t("confirm_clear_commands",{keyName:e}),a=this.i18n.t("confirm_clear");if(!this.confirmDialog)return console.error("CommandUI: confirmDialog not available, cannot show confirmation dialog"),void await this.showToast("Confirmation dialog not available","error");await this.confirmDialog.confirm(n,a,"warning","commandChainClear")&&(console.log(`[CommandUI] Requesting clear command chain for ${i}: "${e}" in env: "${t}"`),this.emit("command-chain:clear",{key:e}))}catch(e){console.error("CommandUI: Failed to confirm clear chain:",e),await this.showToast("Failed to show confirmation dialog","error")}}async validateCurrentChain(e){if(e){let t=!1;try{t=await this.request("command-chain:is-stabilized",{name:e})}catch(e){}const i="alias"===this.getCurrentEnvironment();this.emit("command-chain:validate",{key:e,stabilized:t,isAlias:i})}}filterCommands(e){this.emit("command:filter",{filter:e});const t=this.document.getElementById("commandSearchBtn");if(t){const i=!(!e||!e.trim());t.classList.toggle("active",i),t.setAttribute("aria-pressed",i)}}toggleCommandSearch(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("commandSearch");t&&(t.classList.toggle("expanded")?t.focus():t.blur())}async showImportFromKeyOrAliasModal(){if(!this.getSelectedKey()){const e="alias"===this.getCurrentEnvironment()?"please_select_an_alias_first":"please_select_a_key_first",t=this.i18n.t(e);return void await this.showToast(t,"warning")}await this.populateImportSources(),this.modalManager&&this.modalManager.show("importFromKeyOrAliasModal")}async populateImportSources(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("importSourceSelect");if(!t)return;t.innerHTML="";const i=this.getCurrentEnvironment(),n=this.getSelectedKey();try{const a=await this.request("command:get-import-sources",{environment:i,currentKey:n});if(a.forEach(i=>{const n=e.createElement("option");n.value=i.value,n.textContent=i.label,t.appendChild(n)}),0===a.length){const i=e.createElement("option");i.value="",i.textContent=this.i18n.t("no_sources_available"),i.disabled=!0,t.appendChild(i)}}catch(i){console.error("CommandUI: Failed to populate import sources:",i);const n=e.createElement("option");n.value="",n.textContent=this.i18n.t("error_loading_sources"),n.disabled=!0,t.appendChild(n)}}async performImport(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("importSourceSelect"),i=e.getElementById("clearDestinationBeforeImport");if(!t||!i)return;const n=t.value,a=i.checked,s=this.getSelectedKey(),o=this.getCurrentEnvironment();if(!n||!s){const e=this.i18n.t("please_select_a_source");return void await this.showToast(e,"warning")}try{const e=await this.request("command:import-from-source",{sourceValue:n,targetKey:s,clearDestination:a,currentEnvironment:o});if(e.success){if(e.droppedCount>0){const t=e.sourceType.charAt(0).toUpperCase()+e.sourceType.slice(1),i=o.charAt(0).toUpperCase()+o.slice(1),n=this.i18n.t("cross_environment_import_warning",{dropped:e.droppedCount,sourceEnv:t,targetEnv:i});await this.showToast(n,"warning")}const t=this.i18n.t("commands_imported_successfully",{count:e.importedCount,source:e.sourceName});await this.showToast(t,"success"),this.modalManager&&this.modalManager.hide("importFromKeyOrAliasModal")}}catch(e){let t;console.error("CommandUI: Failed to import commands:",e),t="Source has no commands to import"===e.message?this.i18n.t("source_has_no_commands"):"No compatible commands found for import"===e.message?this.i18n.t("no_compatible_commands_to_import"):this.i18n.t("import_failed",{error:e?.message||e}),await this.showToast(t,"error")}}async showValidationDetails(){const{warnings:e=[],errors:t=[]}=this.we||{};if(!e.length&&!t.length)return;const i=t.map(e=>"string"==typeof e?this.i18n.t(e):e&&e.key?this.i18n.t(e.key,e.params||{}):e&&e.defaultMessage?e.defaultMessage:""),n=e.map(e=>"string"==typeof e?this.i18n.t(e):e&&e.key?this.i18n.t(e.key,e.params||{}):e&&e.defaultMessage?e.defaultMessage:""),a=this.i18n.t("error"),s=this.i18n.t("warning");let o="";i.length&&(o+=`<h4>${a}</h4><ul>${i.map(e=>`<li class="error-item">${e}</li>`).join("")}</ul>`),n.length&&(o+=`<h4>${s}</h4><ul>${n.map(e=>`<li class="warning-item">${e}</li>`).join("")}</ul>`);const r=this.i18n.t("validation_details"),c=this.i18n.t("ok"),l="validationDetailsModal",d=this.document.getElementById(l);d&&d.remove();const m=this.document.createElement("div");m.id=l,m.className="modal",this.currentValidationModal={errors:t,warnings:e,modalElement:m},this.modalManager?.registerRegenerateCallback(l,()=>{this.regenerateValidationModal()}),m.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header"><h3>${r}</h3></div>\n        <div class="modal-body">${o}</div>\n        <div class="modal-footer"><button class="btn btn-primary" id="validationOkBtn">${c}</button></div>\n      </div>`,this.document.body.appendChild(m),this.onDom("#validationOkBtn","click","validation-dialog-ok",()=>{this.modalManager?.unregisterRegenerateCallback(l),this.currentValidationModal=null,this.modalManager&&this.modalManager.hide(l),m.remove()}),this.modalManager?this.modalManager.show(l):requestAnimationFrame(()=>m.classList.add("active"))}regenerateValidationModal(){if(!this.currentValidationModal)return;const{errors:e,warnings:t}=this.currentValidationModal;this.showValidationDetails()}}class Bt extends vt{constructor({eventBus:e,ui:t=null,profileUI:i=null,document:n=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="InterfaceModeUI",this.ui=t||("undefined"!=typeof stoUI?stoUI:null),this.profileUI=i,this.document=n,this.ae="space",this.Se=!1,this.xe=!1,this.Ce=null,this.Te=null}onInit(){this.setupEventListeners(),this.setupModeButtons()}setupEventListeners(){this.Se||(this.Ce=e=>{const t="string"==typeof e?e:e?.newMode;t&&(this.ae=t,this.updateModeUI(t))},this.Te=(e={})=>{const t="string"==typeof e?e:e.environment||e.newMode||e.mode;t&&(this.ae=t,this.updateModeUI(t))},this.eventBus.on("mode-changed",this.Ce),this.eventBus.on("environment:changed",this.Te),this.Se=!0)}setupModeButtons(){this.xe||(["space","ground","alias"].forEach(e=>{this.onDom(`[data-mode="${e}"]`,"click",`mode-change-${e}`,()=>this.handleModeButtonClick(e))}),this.xe=!0)}async handleModeButtonClick(e){try{const t=await this.request("environment:switch",{mode:e});t.success||console.error("[InterfaceModeUI] Failed to switch environment:",t.error)}catch(e){console.error("[InterfaceModeUI] Error switching environment:",e)}}updateModeUI(e){["space","ground","alias"].forEach(t=>{const i=this.document.querySelector(`[data-mode="${t}"]`);i&&i.classList.toggle("active",t===e)}),this.updateKeyGridDisplay(e)}updateKeyGridDisplay(e){const t=this.document.querySelector(".key-selector-container"),i=this.document.getElementById("aliasSelectorContainer");"alias"===e?(t&&(t.style.display="none"),i&&(i.style.display="")):(t&&(t.style.display=""),i&&(i.style.display="none"),this.emit("key:list-changed"))}get currentMode(){return this.ae}set currentMode(e){this.ae=e,this.request("environment:switch",{mode:e}).catch(e=>{console.error("[InterfaceModeUI] Error switching environment via setter:",e)})}onDestroy(){this.Se&&(this.eventBus.off("mode-changed",this.Ce),this.eventBus.off("environment:changed",this.Te),this.Se=!1),this.xe=!1}handleInitialState(e,t){t&&("InterfaceModeService"===e||t.environment)&&t.environment&&this.updateModeUI(t.environment)}}class $t extends vt{constructor({eventBus:e,modalManager:t,i18n:i}={}){super(e),this.componentName="ConfirmDialogUI",this.modalManager=t,this.i18n=i,this.currentConfirmModal=null,this.currentInformModal=null}async confirm(e,t="Confirm",i="warning",n=""){return new Promise(a=>{const s=this.createConfirmModal(e,t,i),o=n?`${n}ConfirmModal`:"confirmModal";s.id=o,document.body.appendChild(s),this.currentConfirmModal={message:e,title:t,type:i,resolve:a,modalElement:s,confirmId:o},this.modalManager?.registerRegenerateCallback(o,()=>{this.regenerateConfirmModal()});const r=e=>{this.modalManager?.unregisterRegenerateCallback(o),this.currentConfirmModal=null,this.modalManager?.hide(o),s&&s.parentNode&&s.parentNode.removeChild(s),a(e)},c=s.querySelector(".confirm-yes"),l=s.querySelector(".confirm-no");c&&this.onDom(c,"click","confirm-dialog-yes",()=>{r(!0)}),l&&this.onDom(l,"click","confirm-dialog-no",()=>{r(!1)}),requestAnimationFrame(()=>{this.modalManager?.show(o)})})}async inform(e,t="Information",i="info",n=""){return new Promise(a=>{const s=this.createInformModal(e,t,i),o=n?`${n}InformModal`:"informModal";s.id=o,document.body.appendChild(s),this.currentInformModal={message:e,title:t,type:i,resolve:a,modalElement:s,informId:o},this.modalManager?.registerRegenerateCallback(o,()=>{this.regenerateInformModal()});const r=()=>{this.modalManager?.unregisterRegenerateCallback(o),this.currentInformModal=null,this.modalManager?.hide(o),s&&s.parentNode&&s.parentNode.removeChild(s),a(!0)},c=s.querySelector(".inform-ok");c&&this.onDom(c,"click","inform-dialog-ok",r);const l=e=>{"Escape"===e.key&&(document.removeEventListener("keydown",l),r())};document.addEventListener("keydown",l),requestAnimationFrame(()=>{this.modalManager?.show(o)})})}createInformModal(e,t,i){const n=document.createElement("div");n.className="modal inform-modal";const a={warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle",info:"fa-info-circle",success:"fa-check-circle"};return n.innerHTML=`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3>\n                        <i class="fas ${a[i]||a.info}"></i>\n                        ${t}\n                    </h3>\n                </div>\n                <div class="modal-body">\n                    <p>${e}</p>\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary inform-ok">${this.i18n?this.i18n.t("ok"):"OK"}</button>\n                </div>\n            </div>\n        `,n}createConfirmModal(e,t,i){const n=document.createElement("div");n.className="modal confirm-modal";const a={warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle",info:"fa-info-circle"};return n.innerHTML=`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3>\n                        <i class="fas ${a[i]||a.warning}"></i>\n                        ${t}\n                    </h3>\n                </div>\n                <div class="modal-body">\n                    <p>${e}</p>\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary confirm-yes">${this.i18n?this.i18n.t("yes"):"Yes"}</button>\n                    <button class="btn btn-secondary confirm-no">${this.i18n?this.i18n.t("no"):"No"}</button>\n                </div>\n            </div>\n        `,n}regenerateConfirmModal(){if(!this.currentConfirmModal)return;const{message:e,title:t,type:i,modalElement:n,confirmId:a}=this.currentConfirmModal,s=this.createConfirmModal(e,t,i);s.id=a,n.replaceWith(s),this.currentConfirmModal.modalElement=s;const o=s.querySelector(".confirm-yes"),r=s.querySelector(".confirm-no");o&&this.onDom(o,"click","confirm-dialog-regen-yes",()=>{this.handleConfirmAction(!0)}),r&&this.onDom(r,"click","confirm-dialog-regen-no",()=>{this.handleConfirmAction(!1)})}regenerateInformModal(){if(!this.currentInformModal)return;const{message:e,title:t,type:i,modalElement:n,informId:a}=this.currentInformModal,s=this.createInformModal(e,t,i);s.id=a,n.replaceWith(s),this.currentInformModal.modalElement=s;const o=()=>{const{resolve:e,informId:t}=this.currentInformModal;this.modalManager?.unregisterRegenerateCallback(t),this.currentInformModal=null,this.modalManager?.hide(t),s&&s.parentNode&&s.parentNode.removeChild(s),e(!0)},r=s.querySelector(".inform-ok");r&&this.onDom(r,"click","inform-dialog-regen-ok",o);const c=e=>{"Escape"===e.key&&(document.removeEventListener("keydown",c),o())};document.addEventListener("keydown",c)}handleConfirmAction(e){if(!this.currentConfirmModal)return;const{resolve:t,modalElement:i,confirmId:n}=this.currentConfirmModal;this.modalManager?.unregisterRegenerateCallback(n),this.currentConfirmModal=null,this.modalManager?.hide(n),i&&i.parentNode&&i.parentNode.removeChild(i),t(e)}}class Et extends vt{constructor({eventBus:e=null,modalManager:t=null,i18n:i}={}){super(e),this.componentName="InputDialogUI",this.modalManager=t,this.i18n=i,this.currentInputModal=null}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("language:changed",()=>{this.currentInputModal&&this.regenerateInputModal()})}async prompt(e,t={}){const{title:i="Input",defaultValue:n="",placeholder:a="",type:s="text",validate:o=null,maxLength:r=255}=t;return new Promise(t=>{const c=this.createInputModal(e,i,n,a,s,o,r),l="inputModal";c.id=l,document.body.appendChild(c),this.currentInputModal={message:e,title:i,defaultValue:n,placeholder:a,type:s,validate:o,maxLength:r,resolve:t,modalElement:c},this.modalManager?.registerRegenerateCallback(l,()=>{this.regenerateInputModal()});const d=c.querySelector(".input-field"),m=c.querySelector(".input-submit"),h=c.querySelector(".input-cancel"),u=c.querySelector(".input-error"),p=()=>{const e=d.value;if(o&&"function"==typeof o){const t=o(e);if(!0!==t)return u.textContent="string"==typeof t?t:"Invalid input",u.style.display="block",void d.focus()}this.closeModal(c,l),t(e)},f=()=>{this.closeModal(c,l),t(null)};this.onDom(m,"click","input-dialog-submit",p),this.onDom(h,"click","input-dialog-cancel",f),this.onDom(d,"input","input-dialog-input",()=>{u.style.display="none";const e=d.value.trim().length>0;m.disabled=!e}),this.onDom(d,"keydown","input-dialog-keydown",e=>{"Enter"!==e.key||m.disabled?"Escape"===e.key&&(e.preventDefault(),f()):(e.preventDefault(),p())});const y=n.trim().length>0;m.disabled=!y,requestAnimationFrame(()=>{this.modalManager?.show(l),d.focus(),d.select()})})}closeModal(e,t){this.modalManager?.unregisterRegenerateCallback(t),this.currentInputModal=null,this.modalManager?.hide(t),e&&e.parentNode&&e.parentNode.removeChild(e)}createInputModal(e,t,i,n,a,s,o){const r=document.createElement("div");r.className="modal input-modal";const c=this.i18n.t("ok"),l=this.i18n.t("cancel");return r.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-edit"></i>\n            ${t}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${e}</p>\n          <div class="input-group">\n            <input \n              type="${a}" \n              class="input-field" \n              value="${i}" \n              placeholder="${n}"\n              maxlength="${o}"\n              autocomplete="off"\n            />\n            <div class="input-error" style="display: none; color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;"></div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary input-submit">${c}</button>\n          <button class="btn btn-secondary input-cancel">${l}</button>\n        </div>\n      </div>\n    `,r}regenerateInputModal(){if(!this.currentInputModal)return;const{message:e,title:t,defaultValue:i,placeholder:n,type:a,validate:s,maxLength:o,modalElement:r}=this.currentInputModal,c=r.querySelector(".input-field")?.value||i,l=this.createInputModal(e,t,i,n,a,s,o);l.id="inputModal",r.replaceWith(l),this.currentInputModal.modalElement=l;const d=l.querySelector(".input-field"),m=l.querySelector(".input-submit"),h=l.querySelector(".input-cancel"),u=l.querySelector(".input-error");d.value=c;const p=()=>{const e=d.value;if(s&&"function"==typeof s){const t=s(e);if(!0!==t)return u.textContent="string"==typeof t?t:"Invalid input",u.style.display="block",void d.focus()}this.closeModal(l,"inputModal"),this.currentInputModal.resolve(e)},f=()=>{this.closeModal(l,"inputModal"),this.currentInputModal.resolve(null)};this.onDom(m,"click","input-dialog-submit-regen",p),this.onDom(h,"click","input-dialog-cancel-regen",f),this.onDom(d,"input","input-dialog-input-regen",()=>{u.style.display="none";const e=d.value.trim().length>0;m.disabled=!e}),this.onDom(d,"keydown","input-dialog-keydown-regen",e=>{"Enter"!==e.key||m.disabled?"Escape"===e.key&&(e.preventDefault(),f()):(e.preventDefault(),p())});const y=c.trim().length>0;m.disabled=!y,d.focus(),d.select()}}const It={Joy5:{row:1,col:2,width:1,type:"button"},Joy6:{row:1,col:13,width:1,type:"button"},Joy7:{row:0,col:2,width:1,type:"trigger"},Joy8:{row:0,col:13,width:1,type:"trigger"},Joy1:{row:4,col:13,width:1,type:"button"},Joy2:{row:3,col:14,width:1,type:"button"},Joy3:{row:3,col:12,width:1,type:"button"},Joy4:{row:2,col:13,width:1,type:"button"},Joypad_up:{row:2,col:2,width:1,type:"dpad"},Joypad_down:{row:4,col:2,width:1,type:"dpad"},Joypad_left:{row:3,col:1,width:1,type:"dpad"},Joypad_right:{row:3,col:3,width:1,type:"dpad"},Joy9:{row:2,col:6,width:1,type:"button"},Joy10:{row:2,col:9,width:1,type:"button"},Lstick_up:{row:3,col:5,width:1,type:"stick",stick:"left",direction:"up"},Lstick_down:{row:5,col:5,width:1,type:"stick",stick:"left",direction:"down"},Joy11:{row:4,col:5,width:1,type:"button"},Lstick_left:{row:4,col:4,width:1,type:"stick",stick:"left",direction:"left"},Lstick_right:{row:4,col:6,width:1,type:"stick",stick:"left",direction:"right"},Rstick_up:{row:3,col:10,width:1,type:"stick",stick:"right",direction:"up"},Rstick_down:{row:5,col:10,width:1,type:"stick",stick:"right",direction:"down"},Joy12:{row:4,col:10,width:1,type:"button"},Rstick_left:{row:4,col:9,width:1,type:"stick",stick:"right",direction:"left"},Rstick_right:{row:4,col:11,width:1,type:"stick",stick:"right",direction:"right"},Joy13:{row:2,col:16,width:1,type:"button"},Joy14:{row:3,col:16,width:1,type:"button"},Joy15:{row:4,col:16,width:1,type:"button"},Joy16:{row:2,col:17,width:1,type:"button"},Joy17:{row:3,col:17,width:1,type:"button"},Joy18:{row:4,col:17,width:1,type:"button"},Joy19:{row:2,col:18,width:1,type:"button"},Joy20:{row:3,col:18,width:1,type:"button"},Joy21:{row:4,col:18,width:1,type:"button"},Joy22:{row:2,col:19,width:1,type:"button"},Joy23:{row:3,col:19,width:1,type:"button"},Joy24:{row:4,col:19,width:1,type:"button"}};function At(){return It}const Ft={F1:{row:0,col:1,width:1},F2:{row:0,col:2,width:1},F3:{row:0,col:3,width:1},F4:{row:0,col:4,width:1},F5:{row:0,col:5,width:1},F6:{row:0,col:6,width:1},F7:{row:0,col:7,width:1},F8:{row:0,col:8,width:1},F9:{row:0,col:9,width:1},F10:{row:0,col:10,width:1},F11:{row:0,col:11,width:1},F12:{row:0,col:12,width:1},Backquote:{row:1,col:0,width:1},Escape:{row:0,col:0,width:1},Digit1:{row:1,col:1,width:1},Digit2:{row:1,col:2,width:1},Digit3:{row:1,col:3,width:1},Digit4:{row:1,col:4,width:1},Digit5:{row:1,col:5,width:1},Digit6:{row:1,col:6,width:1},Digit7:{row:1,col:7,width:1},Digit8:{row:1,col:8,width:1},Digit9:{row:1,col:9,width:1},Digit0:{row:1,col:10,width:1},Minus:{row:1,col:11,width:1},Equal:{row:1,col:12,width:1},Backspace:{row:1,col:13,width:1.5},Tab:{row:2,col:0,width:1.5},KeyQ:{row:2,col:1.5,width:1},KeyW:{row:2,col:2.5,width:1},KeyE:{row:2,col:3.5,width:1},KeyR:{row:2,col:4.5,width:1},KeyT:{row:2,col:5.5,width:1},KeyY:{row:2,col:6.5,width:1},KeyU:{row:2,col:7.5,width:1},KeyI:{row:2,col:8.5,width:1},KeyO:{row:2,col:9.5,width:1},KeyP:{row:2,col:10.5,width:1},BracketLeft:{row:2,col:11.5,width:1},BracketRight:{row:2,col:12.5,width:1},CapsLock:{row:3,col:0,width:1.75},KeyA:{row:3,col:1.75,width:1},KeyS:{row:3,col:2.75,width:1},KeyD:{row:3,col:3.75,width:1},KeyF:{row:3,col:4.75,width:1},KeyG:{row:3,col:5.75,width:1},KeyH:{row:3,col:6.75,width:1},KeyJ:{row:3,col:7.75,width:1},KeyK:{row:3,col:8.75,width:1},KeyL:{row:3,col:9.75,width:1},Quote:{row:3,col:10.75,width:1},ShiftLeft:{row:4,col:0,width:2.25},KeyZ:{row:4,col:2.25,width:1},KeyX:{row:4,col:3.25,width:1},KeyC:{row:4,col:4.25,width:1},KeyV:{row:4,col:5.25,width:1},KeyB:{row:4,col:6.25,width:1},KeyN:{row:4,col:7.25,width:1},KeyM:{row:4,col:8.25,width:1},Comma:{row:4,col:9.25,width:1},Period:{row:4,col:10.25,width:1},ShiftRight:{row:4,col:11.25,width:2.25},ControlLeft:{row:5,col:0,width:1.25},AltLeft:{row:5,col:2.75,width:1.25},Space:{row:5,col:4,width:5.5},AltRight:{row:5,col:9.5,width:1.25},ControlRight:{row:5,col:12.25,width:1.25},Insert:{row:1,col:14.5,width:1},Delete:{row:2,col:14.5,width:1},Home:{row:1,col:15.5,width:1},End:{row:2,col:15.5,width:1},PageUp:{row:1,col:16.5,width:1},PageDown:{row:2,col:16.5,width:1},ArrowUp:{row:4,col:15,width:1},ArrowLeft:{row:5,col:14,width:1},ArrowDown:{row:5,col:15,width:1},ArrowRight:{row:5,col:16,width:1},NumpadDivide:{row:1,col:18,width:1},NumpadMultiply:{row:1,col:19,width:1},NumpadSubtract:{row:1,col:20,width:1},Numpad7:{row:2,col:17,width:1},Numpad8:{row:2,col:18,width:1},Numpad9:{row:2,col:19,width:1},NumpadAdd:{row:2,col:20,width:1},Numpad4:{row:3,col:17,width:1},Numpad5:{row:3,col:18,width:1},Numpad6:{row:3,col:19,width:1},Numpad1:{row:4,col:17,width:1},Numpad2:{row:4,col:18,width:1},Numpad3:{row:4,col:19,width:1},NumpadEnter:{row:4,col:20,width:1},Numpad0:{row:5,col:17,width:2},NumpadDecimal:{row:5,col:19,width:1},Lclick:{row:0,col:22,width:2},Mclick:{row:0,col:24,width:2},Rclick:{row:0,col:26,width:2},Ldrag:{row:1,col:22,width:2},Mdrag:{row:1,col:24,width:2},Rdrag:{row:1,col:26,width:2},Ldblclick:{row:2,col:22,width:2},Mdblclick:{row:2,col:24,width:2},Rdblclick:{row:2,col:26,width:2},Button4:{row:3,col:22,width:2},Button5:{row:3,col:24,width:2},Button6:{row:3,col:26,width:2},Button7:{row:4,col:22,width:2},Button8:{row:4,col:24,width:2},Button9:{row:4,col:26,width:2},Button10:{row:5,col:22,width:2},Wheelplus:{row:5,col:24,width:2},Wheelminus:{row:5,col:26,width:2}},Pt={name:"QWERTY",languages:["en","es"],keys:{Digit1:{primary:"1",secondary:""},Digit2:{primary:"2",secondary:""},Digit3:{primary:"3",secondary:""},Digit4:{primary:"4",secondary:""},Digit5:{primary:"5",secondary:""},Digit6:{primary:"6",secondary:""},Digit7:{primary:"7",secondary:""},Digit8:{primary:"8",secondary:""},Digit9:{primary:"9",secondary:""},Digit0:{primary:"0",secondary:""},KeyQ:{primary:"Q",secondary:""},KeyW:{primary:"W",secondary:""},KeyE:{primary:"E",secondary:""},KeyR:{primary:"R",secondary:""},KeyT:{primary:"T",secondary:""},KeyY:{primary:"Y",secondary:""},KeyU:{primary:"U",secondary:""},KeyI:{primary:"I",secondary:""},KeyO:{primary:"O",secondary:""},KeyP:{primary:"P",secondary:""},KeyA:{primary:"A",secondary:""},KeyS:{primary:"S",secondary:""},KeyD:{primary:"D",secondary:""},KeyF:{primary:"F",secondary:""},KeyG:{primary:"G",secondary:""},KeyH:{primary:"H",secondary:""},KeyJ:{primary:"J",secondary:""},KeyK:{primary:"K",secondary:""},KeyL:{primary:"L",secondary:""},KeyZ:{primary:"Z",secondary:""},KeyX:{primary:"X",secondary:""},KeyC:{primary:"C",secondary:""},KeyV:{primary:"V",secondary:""},KeyB:{primary:"B",secondary:""},KeyN:{primary:"N",secondary:""},KeyM:{primary:"M",secondary:""},Minus:{primary:"-",secondary:""},Equal:{primary:"=",secondary:""},BracketLeft:{primary:"[",secondary:""},BracketRight:{primary:"]",secondary:""},Quote:{primary:"'",secondary:""},Comma:{primary:",",secondary:""},Period:{primary:".",secondary:""},Backquote:{primary:"`",secondary:"~"},Backspace:{primary:"Backspace",secondary:""},Space:{primary:"Space",secondary:""},Tab:{primary:"Tab",secondary:""},Escape:{name:"Escape",primary:"Esc",secondary:""},Delete:{name:"Delete",primary:"Del",secondary:""},CapsLock:{name:"CapsLock",primary:"Caps",secondary:""},ShiftLeft:{primary:"Shift",secondary:""},ShiftRight:{primary:"Shift",secondary:""},ControlLeft:{primary:"Ctrl",secondary:""},ControlRight:{primary:"Ctrl",secondary:""},AltLeft:{primary:"Alt",secondary:""},AltRight:{primary:"Alt",secondary:""},ArrowUp:{name:"Up",primary:"‚Üë",secondary:""},ArrowDown:{name:"Down",primary:"‚Üì",secondary:""},ArrowLeft:{name:"Left",primary:"‚Üê",secondary:""},ArrowRight:{name:"Right",primary:"‚Üí",secondary:""},Home:{primary:"Home",secondary:""},End:{primary:"End",secondary:""},PageUp:{name:"PageUp",primary:"PgUp",secondary:""},PageDown:{name:"PageDown",primary:"PgDn",secondary:""},Insert:{name:"Insert",primary:"Ins",secondary:""},F1:{primary:"F1",secondary:""},F2:{primary:"F2",secondary:""},F3:{primary:"F3",secondary:""},F4:{primary:"F4",secondary:""},F5:{primary:"F5",secondary:""},F6:{primary:"F6",secondary:""},F7:{primary:"F7",secondary:""},F8:{primary:"F8",secondary:""},F9:{primary:"F9",secondary:""},F10:{primary:"F10",secondary:""},F11:{primary:"F11",secondary:""},F12:{primary:"F12",secondary:""},NumpadDivide:{primary:"/",secondary:""},NumpadMultiply:{primary:"*",secondary:""},NumpadSubtract:{primary:"-",secondary:""},NumpadAdd:{primary:"+",secondary:""},NumpadEnter:{primary:"Enter",secondary:""},NumpadDecimal:{primary:".",secondary:""},Numpad0:{primary:"0",secondary:""},Numpad1:{primary:"1",secondary:""},Numpad2:{primary:"2",secondary:""},Numpad3:{primary:"3",secondary:""},Numpad4:{primary:"4",secondary:""},Numpad5:{primary:"5",secondary:""},Numpad6:{primary:"6",secondary:""},Numpad7:{primary:"7",secondary:""},Numpad8:{primary:"8",secondary:""},Numpad9:{primary:"9",secondary:""}}},Dt={name:"QWERTZ",languages:["de"],keys:{Digit1:{primary:"1",secondary:""},Digit2:{primary:"2",secondary:""},Digit3:{primary:"3",secondary:""},Digit4:{primary:"4",secondary:""},Digit5:{primary:"5",secondary:""},Digit6:{primary:"6",secondary:""},Digit7:{primary:"7",secondary:""},Digit8:{primary:"8",secondary:""},Digit9:{primary:"9",secondary:""},Digit0:{primary:"0",secondary:""},KeyQ:{primary:"Q",secondary:""},KeyW:{primary:"W",secondary:""},KeyE:{primary:"E",secondary:""},KeyR:{primary:"R",secondary:""},KeyT:{primary:"T",secondary:""},KeyZ:{primary:"Y",secondary:""},KeyU:{primary:"U",secondary:""},KeyI:{primary:"I",secondary:""},KeyO:{primary:"O",secondary:""},KeyP:{primary:"P",secondary:""},KeyA:{primary:"A",secondary:""},KeyS:{primary:"S",secondary:""},KeyD:{primary:"D",secondary:""},KeyF:{primary:"F",secondary:""},KeyG:{primary:"G",secondary:""},KeyH:{primary:"H",secondary:""},KeyJ:{primary:"J",secondary:""},KeyK:{primary:"K",secondary:""},KeyL:{primary:"L",secondary:""},KeyY:{primary:"Z",secondary:""},KeyX:{primary:"X",secondary:""},KeyC:{primary:"C",secondary:""},KeyV:{primary:"V",secondary:""},KeyB:{primary:"B",secondary:""},KeyN:{primary:"N",secondary:""},KeyM:{primary:"M",secondary:""},Minus:{primary:"-",secondary:""},Equal:{primary:"=",secondary:""},BracketLeft:{primary:"[",secondary:""},BracketRight:{primary:"]",secondary:""},Quote:{primary:"'",secondary:""},Comma:{primary:",",secondary:""},Period:{primary:".",secondary:""},Backquote:{primary:"`",secondary:"~"},Backspace:{primary:"Backspace",secondary:""},Space:{primary:"Space",secondary:""},Tab:{primary:"Tab",secondary:""},Escape:{name:"Escape",primary:"Esc",secondary:""},Delete:{name:"Delete",primary:"Del",secondary:""},CapsLock:{name:"CapsLock",primary:"Caps",secondary:""},ShiftLeft:{primary:"Shift",secondary:""},ShiftRight:{primary:"Shift",secondary:""},ControlLeft:{primary:"Ctrl",secondary:""},ControlRight:{primary:"Ctrl",secondary:""},AltLeft:{primary:"Alt",secondary:""},AltRight:{primary:"Alt",secondary:""},ArrowUp:{name:"Up",primary:"‚Üë",secondary:""},ArrowDown:{name:"Down",primary:"‚Üì",secondary:""},ArrowLeft:{name:"Left",primary:"‚Üê",secondary:""},ArrowRight:{name:"Right",primary:"‚Üí",secondary:""},Home:{primary:"Home",secondary:""},End:{primary:"End",secondary:""},PageUp:{name:"PageUp",primary:"PgUp",secondary:""},PageDown:{name:"PageDown",primary:"PgDn",secondary:""},Insert:{name:"Insert",primary:"Ins",secondary:""},F1:{primary:"F1",secondary:""},F2:{primary:"F2",secondary:""},F3:{primary:"F3",secondary:""},F4:{primary:"F4",secondary:""},F5:{primary:"F5",secondary:""},F6:{primary:"F6",secondary:""},F7:{primary:"F7",secondary:""},F8:{primary:"F8",secondary:""},F9:{primary:"F9",secondary:""},F10:{primary:"F10",secondary:""},F11:{primary:"F11",secondary:""},F12:{primary:"F12",secondary:""},NumpadDivide:{primary:"/",secondary:""},NumpadMultiply:{primary:"*",secondary:""},NumpadSubtract:{primary:"-",secondary:""},NumpadAdd:{primary:"+",secondary:""},NumpadEnter:{primary:"Enter",secondary:""},NumpadDecimal:{primary:".",secondary:""},Numpad0:{primary:"0",secondary:""},Numpad1:{primary:"1",secondary:""},Numpad2:{primary:"2",secondary:""},Numpad3:{primary:"3",secondary:""},Numpad4:{primary:"4",secondary:""},Numpad5:{primary:"5",secondary:""},Numpad6:{primary:"6",secondary:""},Numpad7:{primary:"7",secondary:""},Numpad8:{primary:"8",secondary:""},Numpad9:{primary:"9",secondary:""}}},Mt={name:"AZERTY",languages:["fr"],keys:{Digit1:{primary:"1",secondary:""},Digit2:{primary:"2",secondary:""},Digit3:{primary:"3",secondary:""},Digit4:{primary:"4",secondary:""},Digit5:{primary:"5",secondary:""},Digit6:{primary:"6",secondary:""},Digit7:{primary:"7",secondary:""},Digit8:{primary:"8",secondary:""},Digit9:{primary:"9",secondary:""},Digit0:{primary:"0",secondary:""},KeyA:{primary:"Q",secondary:""},KeyQ:{primary:"A",secondary:""},KeyZ:{primary:"W",secondary:""},KeyW:{primary:"Z",secondary:""},KeyE:{primary:"E",secondary:""},KeyR:{primary:"R",secondary:""},KeyT:{primary:"T",secondary:""},KeyY:{primary:"Y",secondary:""},KeyU:{primary:"U",secondary:""},KeyI:{primary:"I",secondary:""},KeyO:{primary:"O",secondary:""},KeyP:{primary:"P",secondary:""},KeyS:{primary:"S",secondary:""},KeyD:{primary:"D",secondary:""},KeyF:{primary:"F",secondary:""},KeyG:{primary:"G",secondary:""},KeyH:{primary:"H",secondary:""},KeyJ:{primary:"J",secondary:""},KeyK:{primary:"K",secondary:""},KeyL:{primary:"L",secondary:""},KeyX:{primary:"X",secondary:""},KeyC:{primary:"C",secondary:""},KeyV:{primary:"V",secondary:""},KeyB:{primary:"B",secondary:""},KeyN:{primary:"N",secondary:""},KeyM:{primary:"M",secondary:""},Minus:{primary:"-",secondary:""},Equal:{primary:"=",secondary:""},BracketLeft:{primary:"[",secondary:""},BracketRight:{primary:"]",secondary:""},Quote:{primary:"'",secondary:""},Comma:{primary:",",secondary:""},Period:{primary:".",secondary:""},Backquote:{primary:"`",secondary:"~"},Backspace:{primary:"Backspace",secondary:""},Space:{primary:"Space",secondary:""},Tab:{primary:"Tab",secondary:""},Escape:{name:"Escape",primary:"Esc",secondary:""},Delete:{name:"Delete",primary:"Del",secondary:""},CapsLock:{name:"CapsLock",primary:"Caps",secondary:""},ShiftLeft:{primary:"Shift",secondary:""},ShiftRight:{primary:"Shift",secondary:""},ControlLeft:{primary:"Ctrl",secondary:""},ControlRight:{primary:"Ctrl",secondary:""},AltLeft:{primary:"Alt",secondary:""},AltRight:{primary:"Alt",secondary:""},ArrowUp:{name:"Up",primary:"‚Üë",secondary:""},ArrowDown:{name:"Down",primary:"‚Üì",secondary:""},ArrowLeft:{name:"Left",primary:"‚Üê",secondary:""},ArrowRight:{name:"Right",primary:"‚Üí",secondary:""},Home:{primary:"Home",secondary:""},End:{primary:"End",secondary:""},PageUp:{name:"PageUp",primary:"PgUp",secondary:""},PageDown:{name:"PageDown",primary:"PgDn",secondary:""},Insert:{name:"Insert",primary:"Ins",secondary:""},F1:{primary:"F1",secondary:""},F2:{primary:"F2",secondary:""},F3:{primary:"F3",secondary:""},F4:{primary:"F4",secondary:""},F5:{primary:"F5",secondary:""},F6:{primary:"F6",secondary:""},F7:{primary:"F7",secondary:""},F8:{primary:"F8",secondary:""},F9:{primary:"F9",secondary:""},F10:{primary:"F10",secondary:""},F11:{primary:"F11",secondary:""},F12:{primary:"F12",secondary:""},NumpadDivide:{primary:"/",secondary:""},NumpadMultiply:{primary:"*",secondary:""},NumpadSubtract:{primary:"-",secondary:""},NumpadAdd:{primary:"+",secondary:""},NumpadEnter:{primary:"Enter",secondary:""},NumpadDecimal:{primary:".",secondary:""},Numpad0:{primary:"0",secondary:""},Numpad1:{primary:"1",secondary:""},Numpad2:{primary:"2",secondary:""},Numpad3:{primary:"3",secondary:""},Numpad4:{primary:"4",secondary:""},Numpad5:{primary:"5",secondary:""},Numpad6:{primary:"6",secondary:""},Numpad7:{primary:"7",secondary:""},Numpad8:{primary:"8",secondary:""},Numpad9:{primary:"9",secondary:""}}},Nt={Lclick:{name:"Left Click",description:"Single left mouse click"},Rclick:{name:"Right Click",description:"Single right mouse click"},Mclick:{name:"Middle Click",description:"Single middle mouse click"},Ldblclick:{name:"Left Dbl Click",description:"Double left mouse click"},Rdblclick:{name:"Right Dbl Click",description:"Double right mouse click"},Mdblclick:{name:"Middle Dbl Click",description:"Double middle mouse click"},Ldrag:{name:"Left Drag",description:"Left click and drag"},Rdrag:{name:"Right Drag",description:"Right click and drag"},Mdrag:{name:"Middle Drag",description:"Middle click and drag"},Wheelplus:{name:"Scroll Up",description:"Mouse wheel scroll up"},Wheelminus:{name:"Scroll Down",description:"Mouse wheel scroll down"},Button1:{name:"Button1",description:"Standard left button"},Button2:{name:"Button2",description:"Standard right button"},Button3:{name:"Button3",description:"Middle button"},Button4:{name:"Button4",description:"Extra mouse button 4"},Button5:{name:"Button5",description:"Extra mouse button 5"},Button6:{name:"Button6",description:"Extra mouse button 6"},Button7:{name:"Button7",description:"Extra mouse button 7"},Button8:{name:"Button8",description:"Extra mouse button 8"},Button9:{name:"Button9",description:"Extra mouse button 9"},Button10:{name:"Button10",description:"Extra mouse button 10"}},Lt={QWERTY:Pt,QWERTZ:Dt,AZERTY:Mt,"Standard Gamepad":{name:"Standard Gamepad",type:"gamepad",description:"Xbox/PlayStation style gamepad controller",controls:{Joy1:{primary:"A",secondary:"Cross",gamepadIndex:0,description:"Bottom face button (A/X)",color:"#4CAF50"},Joy2:{primary:"B",secondary:"Circle",gamepadIndex:1,description:"Right face button (B/O)",color:"#F44336"},Joy3:{primary:"X",secondary:"Square",gamepadIndex:2,description:"Left face button (X/‚ñ°)",color:"#2196F3"},Joy4:{primary:"Y",secondary:"Triangle",gamepadIndex:3,description:"Top face button (Y/‚ñ≥)",color:"#FFC107"},Joy5:{primary:"LB",secondary:"L1",gamepadIndex:4,description:"Left bumper/shoulder button",color:"#9E9E9E"},Joy6:{primary:"RB",secondary:"R1",gamepadIndex:5,description:"Right bumper/shoulder button",color:"#9E9E9E"},Joy7:{primary:"LT",secondary:"L2",gamepadIndex:6,description:"Left trigger (analog)",color:"#757575",threshold:.1},Joy8:{primary:"RT",secondary:"R2",gamepadIndex:7,description:"Right trigger (analog)",color:"#757575",threshold:.1},Joypad_up:{primary:"‚Üë",secondary:"D-Up",gamepadIndex:12,description:"D-pad up",color:"#607D8B"},Joypad_down:{primary:"‚Üì",secondary:"D-Down",gamepadIndex:13,description:"D-pad down",color:"#607D8B"},Joypad_left:{primary:"‚Üê",secondary:"D-Left",gamepadIndex:14,description:"D-pad left",color:"#607D8B"},Joypad_right:{primary:"‚Üí",secondary:"D-Right",gamepadIndex:15,description:"D-pad right",color:"#607D8B"},Joy9:{primary:"Select",secondary:"Back",gamepadIndex:8,description:"Select/Back button",color:"#9E9E9E"},Joy10:{primary:"Start",secondary:"Forward",gamepadIndex:9,description:"Start/Forward button",color:"#9E9E9E"},Joy11:{primary:"LS",secondary:"L3",gamepadIndex:10,description:"Left stick click",color:"#795548"},Joy12:{primary:"RS",secondary:"R3",gamepadIndex:11,description:"Right stick click",color:"#795548"},Lstick_up:{primary:"LS‚Üë",secondary:"L-Up",gamepadAxis:1,gamepadDirection:-1,description:"Left stick up",color:"#FF5722",deadzone:.15},Lstick_down:{primary:"LS‚Üì",secondary:"L-Down",gamepadAxis:1,gamepadDirection:1,description:"Left stick down",color:"#FF5722",deadzone:.15},Lstick_left:{primary:"LS‚Üê",secondary:"L-Left",gamepadAxis:0,gamepadDirection:-1,description:"Left stick left",color:"#FF5722",deadzone:.15},Lstick_right:{primary:"LS‚Üí",secondary:"L-Right",gamepadAxis:0,gamepadDirection:1,description:"Left stick right",color:"#FF5722",deadzone:.15},Rstick_up:{primary:"RS‚Üë",secondary:"R-Up",gamepadAxis:3,gamepadDirection:-1,description:"Right stick up",color:"#E91E63",deadzone:.15},Rstick_down:{primary:"RS‚Üì",secondary:"R-Down",gamepadAxis:3,gamepadDirection:1,description:"Right stick down",color:"#E91E63",deadzone:.15},Rstick_left:{primary:"RS‚Üê",secondary:"R-Left",gamepadAxis:2,gamepadDirection:-1,description:"Right stick left",color:"#E91E63",deadzone:.15},Rstick_right:{primary:"RS‚Üí",secondary:"R-Right",gamepadAxis:2,gamepadDirection:1,description:"Right stick right",color:"#E91E63",deadzone:.15}},isController:!0,positions:At()},Joystick:{name:"Joystick",type:"joystick",description:"Flight stick or joystick controller",controls:{Lstick_up:{primary:"UP",secondary:"Forward",gamepadAxis:1,gamepadDirection:-1,description:"Joystick forward/back",color:"#4CAF50",deadzone:.15},Lstick_down:{primary:"DOWN",secondary:"Backward",gamepadAxis:1,gamepadDirection:1,description:"Joystick backward/back",color:"#4CAF50",deadzone:.15},Lstick_left:{primary:"LEFT",secondary:"Port",gamepadAxis:0,gamepadDirection:-1,description:"Joystick left/port",color:"#4CAF50",deadzone:.15},Lstick_right:{primary:"RIGHT",secondary:"Starboard",gamepadAxis:0,gamepadDirection:1,description:"Joystick right/starboard",color:"#4CAF50",deadzone:.15},Joy1:{primary:"Trigger",secondary:"Button 1",gamepadIndex:0,description:"Primary trigger/button",color:"#F44336"},Joy2:{primary:"B1",secondary:"Button 2",gamepadIndex:1,description:"Secondary button",color:"#2196F3"},Joy3:{primary:"B2",secondary:"Button 3",gamepadIndex:2,description:"Tertiary button",color:"#FFC107"},Joy4:{primary:"B3",secondary:"Button 4",gamepadIndex:3,description:"Quaternary button",color:"#4CAF50"},Joypad_up:{primary:"H‚Üë",secondary:"Hat-Up",gamepadIndex:12,description:"Hat switch up",color:"#607D8B"},Joypad_down:{primary:"H‚Üì",secondary:"Hat-Down",gamepadIndex:13,description:"Hat switch down",color:"#607D8B"},Joypad_left:{primary:"H‚Üê",secondary:"Hat-Left",gamepadIndex:14,description:"Hat switch left",color:"#607D8B"},Joypad_right:{primary:"H‚Üí",secondary:"Hat-Right",gamepadIndex:15,description:"Hat switch right",color:"#607D8B"},Joy5:{primary:"B4",secondary:"Button 5",gamepadIndex:4,description:"Additional button 5",color:"#9C27B0"},Joy6:{primary:"B5",secondary:"Button 6",gamepadIndex:5,description:"Additional button 6",color:"#9C27B0"},Joy7:{primary:"B6",secondary:"Button 7",gamepadIndex:6,description:"Additional button 7",color:"#FF9800"},Joy8:{primary:"B7",secondary:"Button 8",gamepadIndex:7,description:"Additional button 8",color:"#FF9800"},Rstick_up:{primary:"TH‚Üë",secondary:"Throttle-Up",gamepadAxis:3,gamepadDirection:-1,description:"Throttle increase",color:"#795548",deadzone:.1},Rstick_down:{primary:"TH‚Üì",secondary:"Throttle-Down",gamepadAxis:3,gamepadDirection:1,description:"Throttle decrease",color:"#795548",deadzone:.1},Joy9:{primary:"B8",secondary:"Button 9",gamepadIndex:8,description:"Additional button 9",color:"#009688"},Joy10:{primary:"B9",secondary:"Button 10",gamepadIndex:9,description:"Additional button 10",color:"#009688"},Joy11:{primary:"B10",secondary:"Button 11",gamepadIndex:10,description:"Additional button 11",color:"#00BCD4"},Joy12:{primary:"B11",secondary:"Button 12",gamepadIndex:11,description:"Additional button 12",color:"#00BCD4"},Joy13:{primary:"B12",secondary:"Button 13",gamepadIndex:16,description:"Additional button 13",color:"#CDDC39"},Joy14:{primary:"B13",secondary:"Button 14",gamepadIndex:17,description:"Additional button 14",color:"#CDDC39"},Joy15:{primary:"B14",secondary:"Button 15",gamepadIndex:18,description:"Additional button 15",color:"#FFEB3B"},Joy16:{primary:"B15",secondary:"Button 16",gamepadIndex:19,description:"Additional button 16",color:"#FFEB3B"},Joy17:{primary:"B16",secondary:"Button 17",gamepadIndex:20,description:"Additional button 17",color:"#FFEB3B"},Joy18:{primary:"B17",secondary:"Button 18",gamepadIndex:21,description:"Additional button 18",color:"#FFEB3B"},Joy19:{primary:"B19",secondary:"Button 19",gamepadIndex:22,description:"Additional button 19",color:"#FFEB3B"},Joy20:{primary:"B20",secondary:"Button 20",gamepadIndex:23,description:"Additional button 20",color:"#FFEB3B"},Joy21:{primary:"B21",secondary:"Button 21",gamepadIndex:24,description:"Additional button 21",color:"#FFEB3B"},Joy22:{primary:"B22",secondary:"Button 22",gamepadIndex:25,description:"Additional button 22",color:"#FFEB3B"},Joy23:{primary:"B23",secondary:"Button 23",gamepadIndex:26,description:"Additional button 23",color:"#FFEB3B"},Joy24:{primary:"B24",secondary:"Button 24",gamepadIndex:27,description:"Additional button 24",color:"#FFEB3B"}},isController:!0,positions:At()}},zt=[{value:"QWERTY",label:"QWERTY (English/Spanish)",type:"keyboard"},{value:"QWERTZ",label:"QWERTZ (German)",type:"keyboard"},{value:"AZERTY",label:"AZERTY (French)",type:"keyboard"},{value:"Standard Gamepad",label:"Standard Gamepad",type:"controller"},{value:"Joystick",label:"Joystick",type:"controller"}];function Kt(e){switch(e){case"de":return Dt;case"fr":return Mt;default:return Pt}}function Rt(e){return Lt[e]||Pt}function jt(e){const t=Lt[e];return t&&!0===t.isController}class Ot extends vt{constructor({eventBus:e,modalManager:i=null,app:n=null,document:a=("undefined"!=typeof window?window.document:void 0),ui:s=null,i18n:o}={}){super(e),this.componentName="KeyCaptureUI",this.modalManager=i,this.app=n||("undefined"!=typeof window?window.app:null),this.document=a,this.ui=s||("undefined"!=typeof window?window.stoUI:null),this.i18n=o,this.currentKeyboard=null,this.highlightedKeys=new Set,this.isDuplicationMode=!1,this.sourceKeyForDuplication=null,this.isCapturing=!1,this.ignoreNextChord=!1,this.captureTargetBindset="Primary Bindset",this.lastModifierSide={ctrl:"L",alt:"L",shift:"L"},this.selectedLayout="QWERTY",this.Be=new Set(t.map(e=>e.toUpperCase())),this.activeAnalogControl=null,this.activeStickInteraction=null,this.boundEndAnalogInteraction=this.endAnalogInteraction.bind(this),this.boundUpdateAnalogInteraction=this.updateAnalogInteraction.bind(this)}onInit(){this.addEventListener("capture-start",e=>this.handleCaptureStart(e)),this.addEventListener("update",e=>this.updateCapturedKeysDisplay(e)),this.addEventListener("chord-captured",e=>this.handleChordCaptured(e)),this.addEventListener("capture-stop",e=>this.handleCaptureStop(e)),this.addEventListener("key:duplicate",({key:e}={})=>{this.handleKeyDuplication(e)}),this.addEventListener("gamepad:button-pressed",e=>this.handleGamepadButtonPressed(e)),this.addEventListener("gamepad:button-released",e=>this.handleGamepadButtonReleased(e)),this.addEventListener("gamepad:axis-moved",e=>this.handleGamepadAxisMoved(e)),this.addEventListener("gamepad:axis-centered",e=>this.handleGamepadAxisCentered(e)),this.addEventListener("gamepad:state-update",e=>this.handleGamepadStateUpdate(e)),this.eventBus&&this.eventBus.on("modal:shown",({modalId:e})=>{"keySelectionModal"===e&&this.initializeModal()}),this.setupEventListeners()}onDestroy(){this.endAnalogInteraction(),this.document&&(this.document.removeEventListener("mouseup",this.boundEndAnalogInteraction),this.document.removeEventListener("touchend",this.boundEndAnalogInteraction),this.document.removeEventListener("mousemove",this.boundUpdateAnalogInteraction),this.document.removeEventListener("touchmove",this.boundUpdateAnalogInteraction));const e=this.document.querySelector(".stick-direction-indicator");e&&e.remove(),this.activeAnalogControl=null,this.activeStickInteraction=null}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("toggleCaptureMode","click","toggle-capture-mode",()=>{this.toggleCaptureMode()}),this.onDom("confirm-key-selection","click","confirm-key-selection",()=>{this.confirmSelection()}),this.onDom("cancel-key-selection","click","cancel-key-selection",()=>{this.cancelSelection()}),this.onDom(".vkey","click","virtual-key-click",e=>{if(this.isCapturing)return;const t=e.target.closest(".vkey");if(!t)return;const i=t.dataset.keyCode;i&&this.selectKeyFromVirtualKeyboard(i)}),this.onDom("keyboardLayoutSelector","change","layout-change",e=>{this.changeKeyboardLayout(e.target.value)}),this.onDom("bindsetTargetSelector","change","bindset-target-change",e=>{this.captureTargetBindset=e.target.value||"Primary Bindset"}),this.onDom("distinguishModifierSide","change","location-specific-toggle",e=>{this.emit("keycapture:set-location-specific",{value:e.target.checked}),this.cache.selectedKey&&this.updateChordWithLocationSpecific(e.target.checked),this.updateModifierHighlighting()}))}initializeModal(){console.log("[KeyCaptureUI] initializeModal called"),this.captureTargetBindset=this.resolveDefaultBindset(),this.buildModalContent();const e=this.document.getElementById("keyboardLayoutSelector");e&&(e.value=this.selectedLayout),this.updateKeyboardLayout();const t=this.document.getElementById("distinguishModifierSide"),i=!!t?.checked;this.emit("keycapture:set-location-specific",{value:i}),this.startCaptureMode(),this.syncBindsetSelector()}handleKeyDuplication(e){this.isDuplicationMode=!0,this.sourceKeyForDuplication=e,this.showKeySelectionModal()}showKeySelectionModal(){this.modalManager&&this.modalManager.show("keySelectionModal")}startCaptureMode(){this.updateCaptureState(!0),this.emit("keycapture:start",{context:"keySelectionModal"})}stopCaptureMode(){this.updateCaptureState(!1),this.emit("keycapture:stop")}toggleCaptureMode(){const e=this.document.getElementById("captureIndicator"),t=e?.classList.contains("active");t?(this.ignoreNextChord=!0,this.stopCaptureMode(),this.cache.selectedKey=null,this.clearVirtualModifiers(),this.updatePreviewDisplay(""),this.disableConfirmButton()):this.startCaptureMode()}updateCaptureState(e){const t=this.document.getElementById("captureIndicator"),i=this.document.getElementById("toggleCaptureMode");this.isCapturing=e,t&&t.classList.toggle("active",e),i&&(i.textContent=e?this.i18n.t("switch_to_manual"):this.i18n.t("start_capture"));const n=this.document.getElementById("virtualKeyboard");n&&n.classList.toggle("disabled",e)}handleCaptureStart({context:e}){this.updateCaptureState(!0)}handleCaptureStop({context:e}){this.updateCaptureState(!1)}updateCapturedKeysDisplay({chord:e,codes:t,context:i}){this.highlightKeysOnVirtualKeyboard(t),this.updatePreviewDisplay(e)}handleChordCaptured({chord:e,context:t}){this.ignoreNextChord?this.ignoreNextChord=!1:(this.selectKey(e),setTimeout(()=>{this.stopCaptureMode()},100))}handleGamepadButtonPressed({gamepadIndex:e,input:t,timestamp:i}){if(!this.currentKeyboard?.isController)return;const n=t.chordName||t.name;n&&(this.highlightControllerButtonRealtime(n,!0),this.showRealtimeFeedback(n,"pressed"))}handleGamepadButtonReleased({gamepadIndex:e,input:t,timestamp:i}){if(!this.currentKeyboard?.isController)return;const n=t.chordName||t.name;n&&(this.highlightControllerButtonRealtime(n,!1),this.hideRealtimeFeedback(n))}handleGamepadAxisMoved({gamepadIndex:e,input:t,timestamp:i}){if(!this.currentKeyboard?.isController)return;const n=t.chordName||t.name,a=Math.abs(t.value);n&&a>.1&&(this.highlightControllerButtonRealtime(n,!0),this.showAnalogMagnitude(n,t.value,a))}handleGamepadAxisCentered({gamepadIndex:e,input:t,timestamp:i}){if(!this.currentKeyboard?.isController)return;const n=t.chordName||t.name;n&&(this.highlightControllerButtonRealtime(n,!1),this.hideAnalogMagnitude(n))}handleGamepadStateUpdate({gamepadIndex:e,activeInputs:t,timestamp:i}){this.currentKeyboard?.isController&&(this.clearRealtimeHighlights(),t.forEach(e=>{const t=e.chordName||e.name;if(t)if(this.highlightControllerButtonRealtime(t,!0),"axis"===e.type){const i=Math.abs(e.value);i>.1&&this.showAnalogMagnitude(t,e.value,i)}else this.showRealtimeFeedback(t,"pressed")}))}selectKey(e){this.isUnsafeChord(e)?this.handleUnsafeChord(e):(this.cache.selectedKey=e,this.updateLastModifierSideFromChord(e),this.updatePreviewDisplay(e),this.enableConfirmButton(),this.highlightSelectedKeyOnKeyboard(e))}selectKeyFromVirtualKeyboard(e){if(["ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"].includes(e))return void this.toggleVirtualModifier(e);const t=this.getActiveVirtualModifiers();let i=e;if(t.length>0){const n=this.keyCodeToDisplayName(e);i=`${t.join("+")}+${n}`}else i=this.keyCodeToDisplayName(e);this.selectKey(i),t.length>0&&this.clearVirtualModifiers(!0)}toggleVirtualModifier(e){const t=this.document.getElementById("distinguishModifierSide")?.checked||!1,i=this.getModifierType(e),n="ctrl"===i?"ControlLeft":"alt"===i?"AltLeft":"ShiftLeft",a="ctrl"===i?"ControlRight":"alt"===i?"AltRight":"ShiftRight",s=(e,t)=>{e&&e.classList.toggle("modifier-active",t)},o=this.document.querySelector(`[data-key-code="${n}"]`),r=this.document.querySelector(`[data-key-code="${a}"]`),c=this.document.querySelector(`[data-key-code="${e}"]`),l=c?.classList.contains("modifier-active");if(this.clearVirtualModifiers(!0),l)return void this.updatePreviewWithCurrentModifiers();t?s(c,!0):(s(o,!0),s(r,!0));const d=["Ctrl","Alt","Shift","LCTRL","RCTRL","LALT","RALT","LSHIFT","RSHIFT"];this.cache.selectedKey&&this.cache.selectedKey.split("+").some(e=>e&&!d.includes(e))||this.updatePreviewWithCurrentModifiers(),i&&(this.lastModifierSide[i]=e.endsWith("Right")?"R":"L")}getModifierType(e){return e.includes("Control")?"ctrl":e.includes("Alt")?"alt":e.includes("Shift")?"shift":null}getActiveVirtualModifiersOfType(e,t){const i="ctrl"===e?"ControlLeft":"alt"===e?"AltLeft":"ShiftLeft",n="ctrl"===e?"ControlRight":"alt"===e?"AltRight":"ShiftRight",a=this.document.querySelector(`[data-key-code="${i}"]`),s=this.document.querySelector(`[data-key-code="${n}"]`),o=[];return a?.classList.contains("modifier-active")&&o.push(t?i:e),s?.classList.contains("modifier-active")&&o.push(t?n:e),[...new Set(o)]}getActiveVirtualModifiers(){const e=this.document.getElementById("distinguishModifierSide")?.checked||!1,t=[];return["ctrl","alt","shift"].forEach(i=>{const n=this.getActiveVirtualModifiersOfType(i,e);e?n.forEach(e=>{"ControlLeft"===e?t.push("LCTRL"):"ControlRight"===e?t.push("RCTRL"):"AltLeft"===e?t.push("LALT"):"AltRight"===e?t.push("RALT"):"ShiftLeft"===e?t.push("LSHIFT"):"ShiftRight"===e&&t.push("RSHIFT")}):n.length>0&&("ctrl"===i?t.push(this.i18n.t("ctrl")):"alt"===i?t.push(this.i18n.t("alt")):"shift"===i&&t.push(this.i18n.t("shift")))}),t}clearVirtualModifiers(e=!1){["ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"].forEach(e=>{const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&t.classList.remove("modifier-active")}),e||this.updatePreviewWithCurrentModifiers()}updatePreviewWithCurrentModifiers(){const e=this.getActiveVirtualModifiers();if(e.length>0){let t=e.join("+");if(this.cache.selectedKey){const e=/^(Ctrl|Alt|Shift|LCTRL|RCTRL|LALT|RALT|LSHIFT|RSHIFT)(\+|$)/i;this.cache.selectedKey.split("+").every(t=>e.test(t))||(t+="+"+this.cache.selectedKey)}else t+="+";this.updatePreviewDisplay(t)}else this.cache.selectedKey?this.updatePreviewDisplay(this.cache.selectedKey):this.updatePreviewDisplay("")}async confirmSelection(){if(this.cache.selectedKey)try{let e;if(this.isDuplicationMode){const t=this.sourceKeyForDuplication,i=this.cache.selectedKey;if(e=await this.request("key:duplicate-with-name",{sourceKey:t,newKey:i}),!e?.success){const t=this.i18n.t(e?.error,e?.params);return void this.showToast(t,"error")}{const n=e.sourceKey||e?.data?.from||t,a=e.newKey||e?.data?.to||i,s=this.i18n.t("key_duplicated",{from:n,to:a});this.showToast(s,"success"),this.isDuplicationMode=!1,this.sourceKeyForDuplication=null}}else{if(e=await this.request("key:add",{key:this.cache.selectedKey,bindset:this.captureTargetBindset}),!e?.success){const t=this.i18n.t(e?.error,e?.params);return void this.showToast(t,"error")}{const e=this.i18n.t("key_added",{keyName:this.cache.selectedKey});this.showToast(e,"success")}}this.modalManager?.hide("keySelectionModal"),this.resetState()}catch(e){console.error("Failed to confirm key selection:",e);const t=this.i18n.t("key_selection_failed");this.showToast(t,"error")}}cancelSelection(){this.modalManager?.hide("keySelectionModal"),this.resetState()}resetState(){this.cache.selectedKey=null,this.highlightedKeys.clear(),this.isDuplicationMode=!1,this.sourceKeyForDuplication=null,this.isCapturing=!1,this.ignoreNextChord=!1,this.lastModifierSide={ctrl:"L",alt:"L",shift:"L"},this.captureTargetBindset="Primary Bindset",this.clearKeyboardHighlights(),this.clearVirtualModifiers(),this.clearRealtimeHighlights(),this.updatePreviewDisplay(""),this.disableConfirmButton(),this.endAnalogInteraction(),this.emit("keycapture:set-location-specific",{value:!1})}shouldShowBindsetPicker(){const e=this.cache?.preferences||{};return e.bindsetsEnabled&&e.bindToAliasMode&&"alias"!==this.cache.currentEnvironment}resolveDefaultBindset(){return this.shouldShowBindsetPicker()&&this.cache?.activeBindset||"Primary Bindset"}syncBindsetSelector(){const e=this.document.getElementById("bindsetTargetSelector");e&&(e.value=this.captureTargetBindset)}buildModalContent(){const e=this.document.getElementById("keySelectionModal");if(!e)return;const t=e.querySelector(".modal-body");t&&(t.innerHTML=this.generateModalHTML())}generateModalHTML(){Kt(this.i18n.language||"en").name;const e=zt,t=this.generateBindsetPickerHTML(),i=e.map(e=>{const t=e.value===this.selectedLayout?"selected":"";return`<option value="${e.value}" ${t}>${e.label}</option>`}).join("");return`\n      <div class="hybrid-key-capture">\n        \x3c!-- Header Section --\x3e\n        <div class="capture-header">\n          <div class="capture-zone" id="captureZone">\n            <div class="capture-indicator" id="captureIndicator">\n              <div class="pulse-ring"></div>\n              <i class="fas fa-keyboard"></i>\n            </div>\n            <div class="capture-instructions">\n              <h3 data-i18n="press_any_key_combination">${this.i18n.t("press_any_key_combination")}</h3>\n              <p data-i18n="capture_instructions">${this.i18n.t("capture_instructions")}</p>\n            </div>\n          </div>\n          <button class="btn btn-secondary toggle-mode" id="toggleCaptureMode" data-i18n="switch_to_manual">\n            ${this.i18n.t("switch_to_manual")}\n          </button>\n        </div>\n\n        \x3c!-- Preview Section --\x3e\n        <div class="selection-preview">\n          <div class="preview-display">\n            <label data-i18n="selected_key">${this.i18n.t("selected_key")}:</label>\n            <div class="key-preview-display" id="keyPreviewDisplay">\n              <span class="no-selection" data-i18n="no_key_selected">${this.i18n.t("no_key_selected")}</span>\n            </div>\n          </div>\n          <div class="preview-controls">\n            <label class="location-specific-toggle">\n              <input type="checkbox" id="distinguishModifierSide" />\n              <span data-i18n="distinguish_left_right_modifiers">${this.i18n.t("distinguish_left_right_modifiers")}</span>\n            </label>\n            ${t}\n          </div>\n        </div>\n\n        \x3c!-- Main Content --\x3e\n        <div class="capture-content">\n          \x3c!-- Virtual Keyboard Section --\x3e\n          <div class="virtual-keyboard-section">\n            <div class="section-header">\n              <select id="keyboardLayoutSelector" class="form-select">\n                ${i}\n              </select>\n            </div>\n            <div class="virtual-keyboard" id="virtualKeyboard">\n              \x3c!-- Virtual keyboard or controller will be rendered here --\x3e\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Footer Section --\x3e\n        <div class="capture-footer">\n          <div class="action-buttons">\n            <button class="btn btn-primary" id="confirm-key-selection" disabled data-i18n="confirm_selection">\n              ${this.i18n.t("confirm_selection")}\n            </button>\n            <button class="btn btn-secondary" id="cancel-key-selection" data-i18n="cancel">\n              ${this.i18n.t("cancel")}\n            </button>\n          </div>\n        </div>\n      </div>\n    `}generateBindsetPickerHTML(){if(!this.shouldShowBindsetPicker())return"";const e=(this.cache?.bindsetNames&&this.cache.bindsetNames.length?this.cache.bindsetNames:["Primary Bindset"]).map(e=>{const t=e===this.captureTargetBindset?"selected":"";return`<option value="${this.escapeHtml(e)}" ${t}>${this.escapeHtml(e)}</option>`}).join("");return`\n      <div class="bindset-target">\n        <label for="bindsetTargetSelector">${this.i18n.t("select_bindset")}</label>\n        <select id="bindsetTargetSelector" class="form-select">\n          ${e}\n        </select>\n      </div>\n    `}updateKeyboardLayout(){this.clearRealtimeHighlights(),jt(this.selectedLayout)?this.currentKeyboard=JSON.parse(JSON.stringify(Rt(this.selectedLayout))):this.currentKeyboard=JSON.parse(JSON.stringify(Kt(this.selectedLayout))),this.renderVirtualKeyboard()}changeKeyboardLayout(e){this.selectedLayout=e||"en",this.clearRealtimeHighlights(),jt(this.selectedLayout)?this.currentKeyboard=JSON.parse(JSON.stringify(Rt(this.selectedLayout))):this.currentKeyboard=JSON.parse(JSON.stringify(Kt(this.selectedLayout))),this.renderVirtualKeyboard()}renderVirtualKeyboard(){const e=this.document.getElementById("virtualKeyboard");if(!e||!this.currentKeyboard)return;if(this.currentKeyboard.isController)return void this.renderVirtualController();const t={},i={},n={},a={};Object.entries(Ft).forEach(([e,s])=>{var o,r,c;o=s.col>=22?a:s.col>=17?n:s.col>=14?i:t,r=s.row,c={keyCode:e,...s},o[r]||(o[r]=[]),o[r].push(c)});const s=e=>{let t=this.currentKeyboard.keys[e.keyCode];return!t&&Nt[e.keyCode]&&(t={primary:Nt[e.keyCode].name,secondary:""}),t||(t={primary:e.keyCode,secondary:""}),`\n        <button class="vkey" data-key-code="${e.keyCode}" data-row="${e.row}" data-col="${e.col}">\n          <span class="key-primary">${t.primary}</span>\n          ${t.secondary?`<span class="key-secondary">${t.secondary}</span>`:""}\n        </button>\n      `},o=Math.max(...Object.values(Ft).map(e=>e.row)),r=(e,t="main")=>{const i=[22,23,24,25,26,27];let n="";for(let a=0;a<=o;a++){const o=(e[a]||[]).sort((e,t)=>e.col-t.col);let r="";if("numpad"===t)if(1===a)r+='<div class="vkey placeholder" style="flex:0 0 2.5rem; height:2.5rem;"></div>',o.forEach(e=>{r+=s(e)});else{const e=20;for(let t=17;t<=e;t++){const e=o.find(e=>e.col===t);e?(r+=s(e),e.width&&e.width>1&&(t+=e.width-1)):r+='<div class="vkey placeholder"></div>'}}else if("mouse"===t)r=i.map(e=>{const t=o.find(t=>t.col===e);return t?s(t):'<div class="vkey placeholder"></div>'}).join("");else if("nav"===t)4===a&&(r+='<div class="vkey placeholder" style="flex:0 0 2.5rem; height:2.5rem;"></div>'),o.forEach(e=>{r+=s(e)});else if(o.length){let e=o[0].col;"nav"===t&&4===a&&o.some(e=>15===e.col)&&(r+='<div class="vkey placeholder" style="flex:0 0 2.5rem; height:2.5rem;"></div>',e=14.5);let i=e;o.forEach(e=>{if(e.col>i){const t=e.col-i;r+=`<div class="vkey placeholder" style="flex:0 0 ${2.5*t}rem; height:2.5rem;"></div>`}r+=s(e),i=e.col+(e.width||1)})}n+=`<div class="keyboard-row">${r}</div>`}return n},c=`\n      <div class="keyboard-columns">\n        <div class="keyboard-column main">${r(t)}</div>\n        <div class="keyboard-column nav">${r(i,"nav")}</div>\n        <div class="keyboard-column numpad">${r(n,"numpad")}</div>\n        <div class="keyboard-column mouse">${r(a,"mouse")}</div>\n      </div>`;e.innerHTML=c}renderVirtualController(){const e=this.document.getElementById("virtualKeyboard");if(!e||!this.currentKeyboard)return;const t=this.currentKeyboard,i=t.controls||{},n=[],a=[],s=[],o=[],r=[],c=[];Object.entries(i).forEach(([e,t])=>{const i=function(e){return It[e]||null}(e);if(!i)return;const l={id:e,...t,...i};e.startsWith("Joy")&&parseInt(e.replace("Joy",""))<=4?n.push(l):e.startsWith("Joy")&&parseInt(e.replace("Joy",""))<=8?a.push(l):e.startsWith("Joypad")?s.push(l):e.startsWith("Joy")&&parseInt(e.replace("Joy",""))<=12?o.push(l):e.includes("stick")?r.push(l):c.push(l)});const l=e=>{const t=`\n        position: absolute;\n        left: ${2.5*e.col}rem;\n        top: ${2.5*e.row}rem;\n        width: ${2.5*(e.width||1)}rem;\n        height: 2.5rem;\n        background: linear-gradient(135deg, ${e.color||"#9e9e9e"}, ${this.adjustColor(e.color||"#9e9e9e",-20)});\n        border: 2px solid #333;\n        border-radius: ${"trigger"===e.type?"0.5rem":"0.25rem"};\n        color: white;\n        font-weight: bold;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 0.8rem;\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3);\n        transition: all 0.15s ease;\n        z-index: 10;\n      `;return`\n        <button class="vkey controller-button ${e.type||"button"}"\n                data-key-code="${e.id}"\n                data-control-type="${e.type||"button"}"\n                data-stick="${e.stick||""}"\n                data-direction="${e.direction||""}"\n                style="${t}"\n                title="${e.description||e.primary}">\n          <div class="button-content">\n            <span class="key-primary">${e.primary}</span>\n            ${e.secondary?`<span class="key-secondary">${e.secondary}</span>`:""}\n          </div>\n        </button>\n      `},d=e=>{let t="";e.id.includes("up")?t="\n          border-radius: 0.5rem 0.5rem 0.25rem 0.25rem;\n          width: 2rem;\n        ":e.id.includes("down")?t="\n          border-radius: 0.25rem 0.25rem 0.5rem 0.5rem;\n          width: 2rem;\n        ":e.id.includes("left")?t="\n          border-radius: 0.5rem 0.25rem 0.25rem 0.5rem;\n          width: 2rem;\n        ":e.id.includes("right")&&(t="\n          border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;\n          width: 2rem;\n        ");const i=`\n        position: absolute;\n        left: ${2.5*e.col}rem;\n        top: ${2.5*e.row}rem;\n        width: ${2.5*(e.width||1)}rem;\n        height: 2.5rem;\n        background: linear-gradient(135deg, ${e.color||"#607D8B"}, ${this.adjustColor(e.color||"#607D8B",-20)});\n        border: 2px solid #333;\n        border-radius: ${"trigger"===e.type?"0.5rem":"0.25rem"};\n        color: white;\n        font-weight: bold;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 0.8rem;\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3);\n        transition: all 0.15s ease;\n        z-index: 10;\n        ${t}\n      `;return`\n        <button class="vkey controller-button dpad-button"\n                data-key-code="${e.id}"\n                data-control-type="dpad"\n                style="${i}"\n                title="${e.description||e.primary}">\n          <span class="key-primary">${e.primary}</span>\n        </button>\n      `},m=e=>{const t=r.filter(t=>t.stick===e.stick);if(t.length>0&&t[0]!==e)return"";const i=t[0],n=`\n        position: absolute;\n        left: ${2.5*i.col}rem;\n        top: ${2.5*i.row}rem;\n        width: ${2.5*(i.width||2)}rem;\n        height: ${2.5*(i.width||2)}rem;\n        background: radial-gradient(circle, #f5f5f5 0%, #e0e0e0 40%, #9e9e9e 100%);\n        border: 3px solid #333;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        box-shadow: 0 4px 8px rgba(0,0,0,0.4), inset 0 2px 4px rgba(0,0,0,0.2);\n        z-index: 5;\n      `,a="left"===i.stick?"L":"R";return`\n        <div class="analog-stick"\n             data-stick="${i.stick}"\n             style="${n}"\n             title="${i.description||`${a} Stick`}">\n          <div class="stick-base" style="\n            width: 1.2rem;\n            height: 1.2rem;\n            background: radial-gradient(circle, ${i.color||"#333"}, ${this.adjustColor(i.color||"#333",-30)});\n            border-radius: 50%;\n            border: 2px solid #222;\n            box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);\n          "></div>\n          <div class="stick-label" style="\n            position: absolute;\n            bottom: -1.5rem;\n            font-size: 0.7rem;\n            font-weight: bold;\n            color: #666;\n          ">${a}</div>\n        </div>\n      `};let h='\n      <div class="controller-layout" style="\n        position: relative;\n        min-height: 28rem;\n        width: 100%;\n        background: linear-gradient(145deg, #f8f9fa, #e9ecef);\n        border-radius: 1rem;\n        border: 2px solid #dee2e6;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        padding: 1rem;\n      ">\n        <div class="controller-body" style="\n          position: relative;\n          width: 100%;\n          height: 20rem;\n          background: linear-gradient(135deg, #495057, #343a40);\n          border-radius: 0.75rem;\n          box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);\n        ">\n    ';s.length>0&&s.forEach(e=>{h+=d(e)});const u=new Set;r.forEach(e=>{u.has(e.stick)||(h+=m(e),u.add(e.stick)),h+=l({...e,color:e.color||("left"===e.stick?"#FF5722":"#E91E63")})}),n.length>0&&n.forEach(e=>{h+=l(e)}),a.length>0&&a.forEach(e=>{"trigger"===e.type&&(e.row,e.color,this.adjustColor(e.color||"#757575",-30)),h+=l({...e})}),o.length>0&&o.forEach(e=>{h+=l(e)}),c.length>0&&c.forEach(e=>{h+=l(e)}),h+=`\n        </div>\n        <div class="controller-info" style="\n          margin-top: 1rem;\n          text-align: center;\n          color: #666;\n          font-size: 0.9rem;\n        ">\n          ${this.i18n.t("controller_layout_instructions",{layout:t.name,description:t.description})}\n        </div>\n      </div>\n    `,e.innerHTML=h,this.setupControllerInteraction(),this.setupControllerVisualFeedback()}adjustColor(e,t){const i=parseInt(e.replace("#",""),16);return`#${(Math.max(0,Math.min(255,(i>>16)+t))<<16|Math.max(0,Math.min(255,(i>>8&255)+t))<<8|Math.max(0,Math.min(255,(255&i)+t))).toString(16).padStart(6,"0")}`}setupControllerInteraction(){this.document.querySelectorAll(".controller-button").forEach(e=>{e.addEventListener("mousedown",t=>{if(this.isCapturing)return;const i=e.dataset.keyCode,n=e.dataset.controlType;i&&(this.showButtonFeedback(e),"axis"===n||"trigger"===n?this.startAnalogInteraction(e,t):this.selectKeyFromVirtualKeyboard(i))}),e.addEventListener("mouseenter",t=>{if(this.isCapturing)return;const i=e.dataset.controlType,n=e.dataset.direction;"axis"===i&&n?this.showMagnitudePreview(e,n,.5):(e.style.transform="scale(1.05)",e.style.boxShadow="0 5px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.4)")}),e.addEventListener("mouseleave",t=>{this.isCapturing||(this.hideMagnitudePreview(e),e.style.transform="scale(1.0)",e.style.boxShadow="0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3)")}),e.addEventListener("touchstart",t=>{if(this.isCapturing)return;t.preventDefault();const i=e.dataset.keyCode,n=e.dataset.controlType;i&&(this.showButtonFeedback(e),"axis"===n||"trigger"===n?this.startAnalogInteraction(e,t.touches[0]):this.selectKeyFromVirtualKeyboard(i))})}),this.document.querySelectorAll(".analog-stick").forEach(e=>{e.addEventListener("mousedown",t=>{this.isCapturing||this.startStickDragInteraction(e,t)}),e.addEventListener("touchstart",t=>{this.isCapturing||(t.preventDefault(),this.startStickDragInteraction(e,t.touches[0]))})}),this.document.addEventListener("mouseup",this.boundEndAnalogInteraction),this.document.addEventListener("touchend",this.boundEndAnalogInteraction),this.document.addEventListener("mousemove",this.boundUpdateAnalogInteraction),this.document.addEventListener("touchmove",e=>{e.touches.length>0&&this.updateAnalogInteraction(e.touches[0])})}setupControllerVisualFeedback(){const e=this.document.createElement("style");e.textContent='\n      @keyframes buttonPress {\n        0% { transform: scale(1.0); box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3); }\n        50% { transform: scale(0.95); box-shadow: 0 1px 3px rgba(0,0,0,0.4), inset 0 1px 2px rgba(0,0,0,0.3); }\n        100% { transform: scale(1.0); box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3); }\n      }\n\n      @keyframes highlightPulse {\n        0% { background-color: rgba(255, 255, 255, 0.1); }\n        50% { background-color: rgba(255, 255, 255, 0.3); }\n        100% { background-color: rgba(255, 255, 255, 0.1); }\n      }\n\n      @keyframes magnitudeGlow {\n        0% { box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); }\n        50% { box-shadow: 0 0 15px rgba(0, 123, 255, 0.6), 0 0 25px rgba(0, 123, 255, 0.3); }\n        100% { box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); }\n      }\n\n      @keyframes directionHighlight {\n        0% { background: linear-gradient(135deg, var(--button-color), var(--button-color-dark)); }\n        50% { background: linear-gradient(135deg, rgba(0, 123, 255, 0.8), rgba(0, 123, 255, 0.6)); }\n        100% { background: linear-gradient(135deg, var(--button-color), var(--button-color-dark)); }\n      }\n\n      @keyframes realtimeButtonPress {\n        0% { transform: scale(1.0); box-shadow: 0 0 15px rgba(255, 193, 7, 0.7); }\n        100% { transform: scale(1.05); box-shadow: 0 0 25px rgba(255, 193, 7, 0.9), inset 0 0 10px rgba(255, 255, 255, 0.4); }\n      }\n\n      @keyframes realtimeAxisGlow {\n        0% { box-shadow: 0 0 15px rgba(255, 87, 34, 0.6), inset 0 0 8px rgba(255, 87, 34, 0.3); }\n        100% { box-shadow: 0 0 25px rgba(255, 87, 34, 0.8), inset 0 0 12px rgba(255, 87, 34, 0.5); }\n      }\n\n      @keyframes realtimeDpadGlow {\n        0% { box-shadow: 0 0 15px rgba(76, 175, 80, 0.6), inset 0 0 8px rgba(76, 175, 80, 0.3); }\n        100% { box-shadow: 0 0 25px rgba(76, 175, 80, 0.8), inset 0 0 12px rgba(76, 175, 80, 0.5); }\n      }\n\n      @keyframes realtimeHighlightPulse {\n        0% { background-color: rgba(255, 193, 7, 0.1); }\n        50% { background-color: rgba(255, 193, 7, 0.3); }\n        100% { background-color: rgba(255, 193, 7, 0.1); }\n      }\n\n      @keyframes realtimePress {\n        0% { transform: scale(1.0); filter: brightness(1.0); }\n        50% { transform: scale(0.95); filter: brightness(1.3); }\n        100% { transform: scale(1.0); filter: brightness(1.0); }\n      }\n\n      .controller-button {\n        position: relative;\n        cursor: pointer;\n        user-select: none;\n        transition: all 0.15s ease;\n        --button-color: #9e9e9e;\n        --button-color-dark: #757575;\n      }\n\n      .controller-button:hover:not(.disabled) {\n        transform: scale(1.05);\n        box-shadow: 0 5px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.4);\n      }\n\n      .controller-button.active {\n        animation: buttonPress 0.2s ease, magnitudeGlow 1s ease infinite;\n        border-color: #007bff !important;\n        box-shadow: 0 0 12px rgba(0, 123, 255, 0.8) !important;\n      }\n\n      .controller-button.selected {\n        border-color: #28a745 !important;\n        box-shadow: 0 0 8px rgba(40, 167, 69, 0.6) !important;\n        background: linear-gradient(135deg, #28a745, #1e7e34) !important;\n      }\n\n      .controller-button[data-control-type="axis"].active {\n        animation: directionHighlight 0.5s ease infinite alternate;\n      }\n\n      .controller-button.realtime-active {\n        animation: realtimeButtonPress 0.3s ease infinite alternate;\n        border-color: #ffc107 !important;\n        z-index: 15;\n      }\n\n      .controller-button.realtime-button {\n        background: linear-gradient(135deg, rgba(255, 193, 7, 0.8), rgba(255, 152, 0, 0.9)) !important;\n        box-shadow: 0 0 15px rgba(255, 193, 7, 0.7), inset 0 2px 4px rgba(255, 255, 255, 0.4) !important;\n      }\n\n      .controller-button.realtime-axis {\n        background: linear-gradient(135deg, rgba(255, 87, 34, 0.8), rgba(255, 152, 0, 0.9)) !important;\n        box-shadow: 0 0 15px rgba(255, 87, 34, 0.7), inset 0 2px 4px rgba(255, 255, 255, 0.4) !important;\n        animation: realtimeAxisGlow 0.4s ease infinite alternate;\n      }\n\n      .controller-button.realtime-dpad {\n        background: linear-gradient(135deg, rgba(76, 175, 80, 0.8), rgba(139, 195, 74, 0.9)) !important;\n        box-shadow: 0 0 15px rgba(76, 175, 80, 0.7), inset 0 2px 4px rgba(255, 255, 255, 0.4) !important;\n        animation: realtimeDpadGlow 0.3s ease infinite alternate;\n      }\n\n      .controller-button.disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n        pointer-events: none;\n      }\n\n      .analog-stick {\n        position: relative;\n        cursor: pointer;\n        user-select: none;\n        transition: all 0.2s ease;\n      }\n\n      .analog-stick:hover:not(.disabled) {\n        transform: scale(1.02);\n      }\n\n      .analog-stick.active {\n        animation: highlightPulse 1s ease infinite;\n        box-shadow: 0 0 20px rgba(0, 123, 255, 0.4), inset 0 0 10px rgba(0, 123, 255, 0.2);\n      }\n\n      .analog-stick.realtime-active {\n        animation: realtimeHighlightPulse 0.5s ease infinite alternate;\n        box-shadow: 0 0 25px rgba(255, 193, 7, 0.6), inset 0 0 15px rgba(255, 193, 7, 0.3);\n        border-color: #ffc107 !important;\n      }\n\n      .controller-layout {\n        transition: all 0.3s ease;\n        user-select: none;\n      }\n\n      .button-content {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        gap: 0.2rem;\n        pointer-events: none;\n        position: relative;\n        z-index: 10;\n      }\n\n      .key-primary {\n        font-weight: bold;\n        text-shadow: 0 1px 2px rgba(0,0,0,0.3);\n      }\n\n      .key-secondary {\n        font-size: 0.6rem;\n        opacity: 0.8;\n      }\n\n      /* Magnitude indicator styles */\n      .magnitude-indicator {\n        border-radius: inherit;\n        pointer-events: none;\n      }\n\n      .direction-preview {\n        animation: fadeIn 0.2s ease;\n      }\n\n      @keyframes fadeIn {\n        from { opacity: 0; transform: translateX(-50%) translateY(-0.5rem); }\n        to { opacity: 1; transform: translateX(-50%) translateY(0); }\n      }\n\n      /* Stick direction indicator styles */\n      .stick-direction-indicator {\n        animation: fadeIn 0.2s ease, pulse 1s ease infinite;\n      }\n\n      @keyframes pulse {\n        0% { transform: translate(-50%, -50%) scale(1); }\n        50% { transform: translate(-50%, -50%) scale(1.1); }\n        100% { transform: translate(-50%, -50%) scale(1); }\n      }\n\n      /* Touch-friendly interaction hints */\n      .controller-button:active {\n        transform: scale(0.98);\n      }\n\n      .analog-stick:active {\n        transform: scale(0.98);\n      }\n\n      /* Enhanced visual feedback for drag interactions */\n      .drag-active {\n        cursor: grabbing !important;\n      }\n\n      .controller-button.drag-active {\n        z-index: 100;\n      }\n\n      .analog-stick.drag-active {\n        z-index: 100;\n        cursor: grabbing;\n      }\n\n      /* Accessibility improvements */\n      .controller-button:focus-visible {\n        outline: 2px solid #007bff;\n        outline-offset: 2px;\n      }\n\n      .analog-stick:focus-visible {\n        outline: 2px solid #007bff;\n        outline-offset: 2px;\n      }\n\n      /* High contrast mode support */\n      @media (prefers-contrast: high) {\n        .controller-button {\n          border-width: 3px;\n        }\n\n        .magnitude-indicator {\n          background: linear-gradient(90deg, #000080, #0000ff) !important;\n        }\n\n        .stick-direction-indicator {\n          background: #0000ff !important;\n          border: 3px solid #fff;\n        }\n      }\n\n      /* Reduced motion support */\n      @media (prefers-reduced-motion: reduce) {\n        .controller-button,\n        .analog-stick,\n        .magnitude-indicator,\n        .stick-direction-indicator,\n        .direction-preview {\n          animation: none;\n          transition: none;\n        }\n\n        .controller-button:hover,\n        .analog-stick:hover {\n          transform: none;\n        }\n      }\n    ',this.document.head.appendChild(e)}showButtonFeedback(e){e.classList.add("active"),setTimeout(()=>{e.classList.remove("active")},200)}showStickDirectionSelector(e,t){const i=this.document.querySelectorAll(`.controller-button[data-stick="${t}"]`);i.forEach(e=>{e.classList.add("active")}),setTimeout(()=>{i.forEach(e=>{e.classList.remove("active")})},500),this.showToast(this.i18n.t("stick_direction_hint",{stick:t.toUpperCase()}),"info")}startAnalogInteraction(e,t){const i=e.dataset.keyCode,n=e.dataset.controlType,a=e.dataset.direction;this.activeAnalogControl={button:e,keyCode:i,controlType:n,direction:a,startX:t.clientX||t.pageX,startY:t.clientY||t.pageY,initialValue:0},e.classList.add("active"),this.showMagnitudeIndicator(e,0)}startStickDragInteraction(e,t){const i=e.dataset.stick,n=e.getBoundingClientRect(),a=n.left+n.width/2,s=n.top+n.height/2;this.activeStickInteraction={stick:e,stickName:i,centerX:a,centerY:s,maxRadius:n.width/3,currentX:0,currentY:0},e.classList.add("active"),this.createStickDirectionIndicator(e,a,s)}updateAnalogInteraction(e){if(this.activeAnalogControl){const{button:t,startX:i,controlType:n}=this.activeAnalogControl,a=(e.clientX||e.pageX)-i;let s=0;if("trigger"===n)s=Math.max(0,Math.min(1,a/100));else{const e=Math.abs(a);s=Math.max(0,Math.min(1,e/50))}this.showMagnitudeIndicator(t,s),this.activeAnalogControl.currentValue=s}if(this.activeStickInteraction){const{centerX:t,centerY:i,maxRadius:n,stick:a,stickName:s}=this.activeStickInteraction,o=(e.clientX||e.pageX)-t,r=(e.clientY||e.pageY)-i,c=Math.sqrt(o*o+r*r),l=Math.min(c,n)/n,d=c>0?o/c*l:0,m=c>0?r/c*l:0;this.activeStickInteraction.currentX=d,this.activeStickInteraction.currentY=m,this.updateStickDirectionIndicator(a,d,m),this.highlightDirectionButtons(s,d,m)}}endAnalogInteraction(){if(this.activeAnalogControl){const{button:e,keyCode:t,currentValue:i,threshold:n=.5}=this.activeAnalogControl;e.classList.remove("active"),this.hideMagnitudeIndicator(e),i>=n&&(this.selectKeyFromVirtualKeyboard(t),this.showButtonFeedback(e)),this.activeAnalogControl=null}if(this.activeStickInteraction){const{stick:e,stickName:t,currentX:i,currentY:n}=this.activeStickInteraction;e.classList.remove("active"),this.removeStickDirectionIndicator(e),this.clearDirectionHighlights(t);const a=.7;let s=null;if(s=Math.abs(i)>Math.abs(n)?i>a?"right":i<-a?"left":null:n>a?"down":n<-a?"up":null,s){const e=`${"left"===t?"L":"R"}stick_${s}`;this.selectKeyFromVirtualKeyboard(e);const i=this.document.querySelector(`.controller-button[data-stick="${t}"][data-direction="${s}"]`);i&&this.showButtonFeedback(i)}this.activeStickInteraction=null}}showMagnitudeIndicator(e,t){this.hideMagnitudeIndicator(e);const i=this.document.createElement("div");i.className="magnitude-indicator",i.style.cssText=`\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: ${100*t}%;\n      height: 100%;\n      background: linear-gradient(90deg, rgba(0,123,255,0.3), rgba(0,123,255,0.6));\n      border-radius: inherit;\n      pointer-events: none;\n      z-index: 15;\n      transition: width 0.1s ease;\n    `,e.appendChild(i)}hideMagnitudeIndicator(e){const t=e.querySelector(".magnitude-indicator");t&&t.remove()}showMagnitudePreview(e,t,i){if(this.showMagnitudeIndicator(e,i),t){const i=this.document.createElement("div");i.className="direction-preview",i.textContent=t.toUpperCase(),i.style.cssText="\n        position: absolute;\n        top: -1.5rem;\n        left: 50%;\n        transform: translateX(-50%);\n        background: rgba(0,0,0,0.8);\n        color: white;\n        padding: 0.25rem 0.5rem;\n        border-radius: 0.25rem;\n        font-size: 0.7rem;\n        white-space: nowrap;\n        z-index: 20;\n      ",e.appendChild(i)}}hideMagnitudePreview(e){this.hideMagnitudeIndicator(e);const t=e.querySelector(".direction-preview");t&&t.remove()}createStickDirectionIndicator(e,t,i){const n=this.document.createElement("div");n.className="stick-direction-indicator",n.style.cssText="\n      position: fixed;\n      width: 20px;\n      height: 20px;\n      background: radial-gradient(circle, rgba(0,123,255,0.8), rgba(0,123,255,0.4));\n      border: 2px solid #fff;\n      border-radius: 50%;\n      pointer-events: none;\n      z-index: 1000;\n      transform: translate(-50%, -50%);\n      box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    ",this.document.body.appendChild(n)}updateStickDirectionIndicator(e,t,i){const n=this.document.querySelector(".stick-direction-indicator");if(!n)return;const a=e.getBoundingClientRect(),s=a.left+a.width/2,o=a.top+a.height/2,r=s+t*a.width/4,c=o+i*a.height/4;n.style.left=`${r}px`,n.style.top=`${c}px`;const l=Math.sqrt(t*t+i*i),d=16+12*l;n.style.width=`${d}px`,n.style.height=`${d}px`;const m=.4+.4*l;n.style.background=`radial-gradient(circle, rgba(0,123,255,${m}), rgba(0,123,255,${.5*m}))`}removeStickDirectionIndicator(e){const t=this.document.querySelector(".stick-direction-indicator");t&&t.remove()}highlightDirectionButtons(e,t,i){if(this.clearDirectionHighlights(e),Math.abs(t)>.5){const i=t>0?"right":"left",n=this.document.querySelector(`.controller-button[data-stick="${e}"][data-direction="${i}"]`);n&&n.classList.add("active")}if(Math.abs(i)>.5){const t=i>0?"down":"up",n=this.document.querySelector(`.controller-button[data-stick="${e}"][data-direction="${t}"]`);n&&n.classList.add("active")}}clearDirectionHighlights(e){this.document.querySelectorAll(`.controller-button[data-stick="${e}"]`).forEach(e=>{e.classList.remove("active")})}updatePreviewDisplay(e){const t=this.document.getElementById("keyPreviewDisplay");if(t)if(e){const i=this.formatKeyForDisplay(e);t.innerHTML=`<span class="key-combination">${i}</span>`}else t.innerHTML=`<span class="no-selection" data-i18n="no_key_selected">${this.i18n.t("no_key_selected")}</span>`}formatKeyForDisplay(e){return e?e.split("+").filter(e=>e.length>0).map(e=>`<kbd>${e}</kbd>`).join('<span class="plus">+</span>'):""}keyCodeToDisplayName(e){if(e.startsWith("Numpad")){const t=e.match(/^Numpad(\d)$/);return t?`numpad${t[1]}`:{Add:"Add",Subtract:"Subtract",Multiply:"Multiply",Divide:"Divide",Decimal:"Decimal",Enter:"numpadenter"}[e.replace("Numpad","")]||e}if(this.currentKeyboard?.isController){const t=this.currentKeyboard?.controls[e];if(t)return t.primary}else{const t=this.currentKeyboard?.keys[e];if(t)return t.primary}return e.replace(/^Key|^Digit/,"")}highlightKeysOnVirtualKeyboard(e){this.clearKeyboardHighlights(),e&&0!==e.length&&e.forEach(e=>{const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&(t.classList.add("pressed"),this.highlightedKeys.add(e))})}updateModifierHighlighting(){const e=this.document.getElementById("distinguishModifierSide")?.checked||!1,t=[];if(["ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"].forEach(e=>{const i=this.document.querySelector(`[data-key-code="${e}"]`);i?.classList.contains("modifier-active")&&t.push(e)}),this.clearVirtualModifiers(!0),t.length>0)if(e){const e=new Set,i={L:"Left",R:"Right"};t.forEach(n=>{const a=this.getModifierType(n);if(!a||e.has(a))return;const s=this.lastModifierSide[a]||"L",o="ctrl"===a?`Control${i[s]}`:"alt"===a?`Alt${i[s]}`:`Shift${i[s]}`;let r=o;if(!t.includes(r)){const e="L"===s?o.replace("Left","Right"):o.replace("Right","Left");t.includes(e)&&(r=e)}const c="ctrl"===a?"ControlLeft":"alt"===a?"AltLeft":"ShiftLeft",l="ctrl"===a?"ControlRight":"alt"===a?"AltRight":"ShiftRight";if(r===c){const e=this.document.querySelector(`[data-key-code="${l}"]`);e?.classList.remove("selected")}else{const e=this.document.querySelector(`[data-key-code="${c}"]`);e?.classList.remove("selected")}this.highlightKey(r),e.add(a)})}else{const e=new Set;t.forEach(t=>{const i=this.getModifierType(t);i&&e.add(i)}),e.forEach(e=>{const t="ctrl"===e?"ControlLeft":"alt"===e?"AltLeft":"ShiftLeft",i="ctrl"===e?"ControlRight":"alt"===e?"AltRight":"ShiftRight",n=this.document.querySelector(`[data-key-code="${t}"]`),a=this.document.querySelector(`[data-key-code="${i}"]`);n?.classList.add("modifier-active"),a?.classList.add("modifier-active")})}const i=["Ctrl","Alt","Shift","LCTRL","RCTRL","LALT","RALT","LSHIFT","RSHIFT"];this.cache.selectedKey&&this.cache.selectedKey.split("+").some(e=>e&&!i.includes(e))||this.updatePreviewWithCurrentModifiers()}highlightSelectedKeyOnKeyboard(e){if(this.clearKeyboardHighlights(),!e)return;const t=e.split("+");this.updateLastModifierSideFromChord(e),t.forEach(e=>{if(this.currentKeyboard?.isController)return void this.highlightControllerKey(e);let t=null;const i=this.document.getElementById("distinguishModifierSide")?.checked||!1;if("Ctrl"===e&&!i)return this.highlightKey("ControlLeft"),void this.highlightKey("ControlRight");if("Alt"===e&&!i)return this.highlightKey("AltLeft"),void this.highlightKey("AltRight");if("Shift"===e&&!i)return this.highlightKey("ShiftLeft"),void this.highlightKey("ShiftRight");if("LCTRL"===e)t="ControlLeft";else if("RCTRL"===e)t="ControlRight";else if("LALT"===e)t="AltLeft";else if("RALT"===e)t="AltRight";else if("LSHIFT"===e)t="ShiftLeft";else if("RSHIFT"===e)t="ShiftRight";else if("Ctrl"===e)t="ControlLeft";else if("Alt"===e)t="AltLeft";else if("Shift"===e)t="ShiftLeft";else if(this.currentKeyboard){const i={1:"Digit1",2:"Digit2",3:"Digit3",4:"Digit4",5:"Digit5",6:"Digit6",7:"Digit7",8:"Digit8",9:"Digit9",0:"Digit0",numpad0:"Numpad0",numpad1:"Numpad1",numpad2:"Numpad2",numpad3:"Numpad3",numpad4:"Numpad4",numpad5:"Numpad5",numpad6:"Numpad6",numpad7:"Numpad7",numpad8:"Numpad8",numpad9:"Numpad9",Add:"NumpadAdd",Subtract:"NumpadSubtract",Multiply:"NumpadMultiply",Divide:"NumpadDivide",Decimal:"NumpadDecimal",numpadenter:"NumpadEnter",A:"KeyA",B:"KeyB",C:"KeyC",D:"KeyD",E:"KeyE",F:"KeyF",G:"KeyG",H:"KeyH",I:"KeyI",J:"KeyJ",K:"KeyK",L:"KeyL",M:"KeyM",N:"KeyN",O:"KeyO",P:"KeyP",Q:"KeyQ",R:"KeyR",S:"KeyS",T:"KeyT",U:"KeyU",V:"KeyV",W:"KeyW",X:"KeyX",Y:"KeyY",Z:"KeyZ",Space:"Space",Tab:"Tab",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12"};for(const[i,n]of Object.entries(this.currentKeyboard.keys))if(n.primary===e||n.secondary===e){t=i;break}t||(t=i[e])}t&&this.highlightKey(t)})}highlightControllerKey(e){if(!this.currentKeyboard?.isController)return;const t=this.currentKeyboard.controls||{};for(const[i,n]of Object.entries(t))if(n.primary===e||n.secondary===e||i===e)return void this.highlightControllerButton(i);const i={A:"Joy1",B:"Joy2",X:"Joy3",Y:"Joy4",LB:"Joy5",RB:"Joy6",LT:"Joy7",RT:"Joy8",Select:"Joy9",Start:"Joy10",LS:"Joy11",RS:"Joy12"}[e];if(i&&t[i])this.highlightControllerButton(i);else if(e.includes("LS")||e.includes("Lstick")){const i=`Lstick_${e.replace("LS","").replace("Lstick_","").toLowerCase()}`;t[i]&&(this.highlightControllerButton(i),this.highlightAnalogStick("left"))}else if(e.includes("RS")||e.includes("Rstick")){const i=`Rstick_${e.replace("RS","").replace("Rstick_","").toLowerCase()}`;t[i]&&(this.highlightControllerButton(i),this.highlightAnalogStick("right"))}else if(e.includes("D-")||e.includes("Joypad_")){const i=`Joypad_${e.replace("D-","").replace("Joypad_","").toLowerCase()}`;t[i]&&this.highlightControllerButton(i)}}highlightControllerButton(e){const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&(t.classList.add("selected"),this.highlightedKeys.add(e),t.style.animation="buttonPress 0.3s ease, highlightPulse 1s ease 2",setTimeout(()=>{t.style.animation=""},2300))}highlightAnalogStick(e){const t=this.document.querySelector(`[data-stick="${e}"]`);t&&(t.classList.add("active"),setTimeout(()=>{t.classList.remove("active")},2e3))}highlightControllerButtonRealtime(e,t){const i=this.document.querySelector(`[data-key-code="${e}"]`);if(i)if(t){i.classList.add("realtime-active");const e=i.dataset.controlType;"axis"===e?i.classList.add("realtime-axis"):"dpad"===e?i.classList.add("realtime-dpad"):i.classList.add("realtime-button")}else i.classList.remove("realtime-active","realtime-axis","realtime-dpad","realtime-button"),this.hideAnalogMagnitude(e);e.includes("Lstick")?this.highlightAnalogStickRealtime("left",t):e.includes("Rstick")&&this.highlightAnalogStickRealtime("right",t)}highlightAnalogStickRealtime(e,t){const i=this.document.querySelector(`[data-stick="${e}"]`);i&&(t?i.classList.add("realtime-active"):i.classList.remove("realtime-active"))}showRealtimeFeedback(e,t){const i=this.document.querySelector(`[data-key-code="${e}"]`);i&&(i.style.animation="none",setTimeout(()=>{i.style.animation="realtimePress 0.2s ease"},10))}showAnalogMagnitude(e,t,i){const n=this.document.querySelector(`[data-key-code="${e}"]`);if(!n)return;this.hideAnalogMagnitude(e);const a=this.document.createElement("div");a.className="realtime-magnitude-indicator",a.style.cssText=`\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: ${100*i}%;\n      height: 100%;\n      background: linear-gradient(90deg, rgba(255,193,7,0.4), rgba(255,152,0,0.7));\n      border-radius: inherit;\n      pointer-events: none;\n      z-index: 20;\n      transition: width 0.05s ease;\n    `;const s=n.dataset.controlType,o=n.dataset.direction;"axis"===s&&o&&((o.includes("up")||o.includes("left"))&&(a.style.left="auto",a.style.right="0",a.style.background="linear-gradient(180deg, rgba(255,193,7,0.4), rgba(255,152,0,0.7))"),o.includes("vertical")&&(a.style.width="100%",a.style.height=100*i+"%",a.style.background="linear-gradient(180deg, rgba(255,193,7,0.4), rgba(255,152,0,0.7))")),n.appendChild(a);const r=this.document.createElement("div");r.className="realtime-magnitude-text",r.textContent=i.toFixed(2),r.style.cssText="\n      position: absolute;\n      top: -1.2rem;\n      right: 0;\n      background: rgba(0,0,0,0.8);\n      color: #ffc107;\n      padding: 0.1rem 0.3rem;\n      border-radius: 0.2rem;\n      font-size: 0.6rem;\n      font-weight: bold;\n      z-index: 25;\n      pointer-events: none;\n    ",n.appendChild(r)}hideAnalogMagnitude(e){const t=this.document.querySelector(`[data-key-code="${e}"]`);if(t){const e=t.querySelector(".realtime-magnitude-indicator"),i=t.querySelector(".realtime-magnitude-text");e&&e.remove(),i&&i.remove()}}clearRealtimeHighlights(){this.document.querySelectorAll(".realtime-active, .realtime-axis, .realtime-dpad, .realtime-button").forEach(e=>{e.classList.remove("realtime-active","realtime-axis","realtime-dpad","realtime-button")}),this.document.querySelectorAll(".realtime-magnitude-indicator").forEach(e=>e.remove()),this.document.querySelectorAll(".realtime-magnitude-text").forEach(e=>e.remove())}highlightKey(e){const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&(t.classList.add("selected"),this.highlightedKeys.add(e))}escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return String(e).replace(/[&<>"']/g,e=>t[e]||e)}clearKeyboardHighlights(){this.highlightedKeys.forEach(e=>{const t=this.document.querySelector(`[data-key-code="${e}"]`);t&&(t.classList.remove("pressed","selected","active"),t.style.animation="")}),this.document.querySelectorAll(".analog-stick.active").forEach(e=>{e.classList.remove("active")}),this.document.querySelectorAll(".controller-button.active, .controller-button.selected").forEach(e=>{e.classList.remove("active","selected"),e.style.animation=""}),this.clearRealtimeHighlights(),this.highlightedKeys.clear()}enableConfirmButton(){const e=this.document.getElementById("confirm-key-selection");e&&(e.disabled=!1)}disableConfirmButton(){const e=this.document.getElementById("confirm-key-selection");e&&(e.disabled=!0)}updateChordWithLocationSpecific(e){if(!this.cache.selectedKey)return;let t=this.cache.selectedKey;t=e?t.replace(/\bCtrl\b/g,"R"===this.lastModifierSide.ctrl?"RCTRL":"LCTRL").replace(/\bAlt\b/g,"R"===this.lastModifierSide.alt?"RALT":"LALT").replace(/\bShift\b/g,"R"===this.lastModifierSide.shift?"RSHIFT":"LSHIFT"):t.replace(/\bLCTRL\b/g,"Ctrl").replace(/\bRCTRL\b/g,"Ctrl").replace(/\bLALT\b/g,"Alt").replace(/\bRALT\b/g,"Alt").replace(/\bLSHIFT\b/g,"Shift").replace(/\bRSHIFT\b/g,"Shift"),t!==this.cache.selectedKey&&this.selectKey(t)}updateLastModifierSideFromChord(e){e&&e.split("+").forEach(e=>{"LCTRL"===e?this.lastModifierSide.ctrl="L":"RCTRL"===e?this.lastModifierSide.ctrl="R":"LALT"===e?this.lastModifierSide.alt="L":"RALT"===e?this.lastModifierSide.alt="R":"LSHIFT"===e?this.lastModifierSide.shift="L":"RSHIFT"===e&&(this.lastModifierSide.shift="R")})}isUnsafeChord(e){return!!e&&this.Be.has(e.toUpperCase())}async handleUnsafeChord(e){const t=this.i18n.t("unsafe_keybind",{key:e});this.emit("toast:show",{message:t,type:"error"}),this.cache.selectedKey=null,this.updatePreviewDisplay(""),this.disableConfirmButton()}}class Ut extends vt{constructor({eventBus:e,modalManager:t,i18n:i}={}){super(e),this.componentName="VFXManagerUI",this.modalManager=t,this.i18n=i,this.domListenersSetup=!1,this.vfxManager=null}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventBus.on("vfx:modal-populate",this.handleModalPopulate.bind(this)),this.setupDOMEventListeners()}handleModalPopulate({vfxManager:e}){this.vfxManager=e,this.populateModal(),this.modalManager.show("vertigoModal"),this.updatePreview()}populateModal(){if(!this.vfxManager)return;const e=document.getElementById("spaceEffectsList");e&&(e.innerHTML="",window.VFX_EFFECTS.space.forEach(t=>{const i=this.createEffectItem("space",t);e.appendChild(i)}));const t=document.getElementById("groundEffectsList");t&&(t.innerHTML="",window.VFX_EFFECTS.ground.forEach(e=>{const i=this.createEffectItem("ground",e);t.appendChild(i)})),this.updateCheckboxes("space"),this.updateCheckboxes("ground");const i=document.getElementById("vertigoShowPlayerSay");i&&(i.checked=this.vfxManager.showPlayerSay),this.updateEffectCounts(),this.updatePreview()}createEffectItem(e,t){const i=document.createElement("div");i.className="effect-item";const n=this.vfxManager.isEffectSelected(e,t.effect);return i.innerHTML=`\n      <label class="effect-label">\n        <input type="checkbox" \n               class="effect-checkbox" \n               data-environment="${e}" \n               data-effect="${t.effect}"\n               ${n?"checked":""}>\n        <span class="effect-name">${t.label}</span>\n      </label>\n    `,i}updateCheckboxes(e){document.querySelectorAll(`input[data-environment="${e}"]`).forEach(t=>{const i=t.dataset.effect;t.checked=this.vfxManager.isEffectSelected(e,i)})}updateEffectCounts(){const e=this.vfxManager.getEffectCount("space"),t=document.getElementById("spaceEffectCount");t&&(t.textContent=`${e} ${this.i18n.t("selected")}`);const i=this.vfxManager.getEffectCount("ground"),n=document.getElementById("groundEffectCount");n&&(n.textContent=`${i} ${this.i18n.t("selected")}`)}updatePreview(){const e=document.getElementById("spaceAliasCommand");if(e&&this.vfxManager){const t=this.vfxManager.generateAlias("space");e.textContent=t||this.i18n.t("no_space_effects_selected")}const t=document.getElementById("groundAliasCommand");if(t&&this.vfxManager){const e=this.vfxManager.generateAlias("ground");t.textContent=e||this.i18n.t("no_ground_effects_selected")}}setupDOMEventListeners(){this.domListenersSetup||(this.onDom(".effect-checkbox","change","vfx-effect-change",e=>{const t=e.target.dataset.environment,i=e.target.dataset.effect;this.vfxManager&&(this.vfxManager.toggleEffect(t,i),this.updateEffectCounts(),this.updatePreview())}),this.onDom("#vertigoShowPlayerSay","change","vfx-playersay-change",e=>{this.vfxManager&&(this.vfxManager.showPlayerSay=e.target.checked,this.updatePreview())}),this.onDom("spaceSelectAll","click","vfx-space-select-all",()=>{this.vfxManager&&(this.vfxManager.selectAllEffects("space"),this.updateCheckboxes("space"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("spaceClearAll","click","vfx-space-clear-all",()=>{this.vfxManager&&(this.vfxManager.selectedEffects.space.clear(),this.updateCheckboxes("space"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("groundSelectAll","click","vfx-ground-select-all",()=>{this.vfxManager&&(this.vfxManager.selectAllEffects("ground"),this.updateCheckboxes("ground"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("groundClearAll","click","vfx-ground-clear-all",()=>{this.vfxManager&&(this.vfxManager.selectedEffects.ground.clear(),this.updateCheckboxes("ground"),this.updateEffectCounts(),this.updatePreview())}),this.onDom("saveVertigoBtn","click","vfx-save",()=>{this.emit("vfx:save-effects")}),this.domListenersSetup=!0)}onDestroy(){this.domListenersSetup=!1,this.vfxManager=null}}class qt extends vt{constructor({eventBus:e,modalManager:t,i18n:i}={}){super(e),this.componentName="BindsetDeleteConfirmUI",this.modalManager=t,this.i18n=i,this.currentModal=null}async confirm(e,t,i=""){return new Promise(n=>{const a=this.createModal(e,t),s=i?`${i}BindsetDeleteConfirmModal`:"bindsetDeleteConfirmModal";a.id=s,document.body.appendChild(a);const o=a.querySelector("#bindset-delete-confirm-checkbox"),r=a.querySelector("#bindset-delete-confirm-input"),c=a.querySelector(".bindset-delete-confirm-btn"),l=a.querySelector(".bindset-delete-cancel-btn");this.currentModal={bindsetName:e,keyCount:t,resolve:n,modalElement:a,modalId:s},this.modalManager?.registerRegenerateCallback(s,()=>{this.regenerateModal()});const d=()=>{const e=o.checked,t=r.value.trim().toUpperCase(),i=e&&"DELETE"===t;return c.disabled=!i,r.disabled=!e,i};o.addEventListener("change",d),r.addEventListener("input",d);const m=()=>{this.modalManager?.unregisterRegenerateCallback(s),this.currentModal=null,this.modalManager?.hide(s),a&&a.parentNode&&a.parentNode.removeChild(a),n(!1)};c.addEventListener("click",()=>{this.modalManager?.unregisterRegenerateCallback(s),this.currentModal=null,this.modalManager?.hide(s),a&&a.parentNode&&a.parentNode.removeChild(a),n(!0)}),l.addEventListener("click",m);const h=e=>{"Escape"===e.key&&(document.removeEventListener("keydown",h),m())};document.addEventListener("keydown",h),this.modalManager?.show(s),d()})}createModal(e,t){const i=document.createElement("div");i.className="modal bindset-delete-confirm-modal";const n=this.i18n?this.i18n.t("confirm_delete_bindset_with_keys"):"Delete Bindset with Keys",a=this.i18n?this.i18n.t("bindset_delete_warning",{name:e,count:t}):`This bindset "${e}" contains ${t} keys and will be permanently deleted.`,s=this.i18n?this.i18n.t("bindset_delete_confirmation_text"):"I understand this will permanently delete all keys in this bindset",o=this.i18n?this.i18n.t("bindset_delete_type_confirm"):"Type DELETE to confirm",r=this.i18n?this.i18n.t("delete"):"Delete",c=this.i18n?this.i18n.t("cancel"):"Cancel";return i.innerHTML=`\n      <div class="modal-content bindset-delete-confirm-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-exclamation-triangle"></i>\n            ${n}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <div class="bindset-delete-warning">\n            <p><strong>${a}</strong></p>\n            <p>${this.i18n?this.i18n.t("bindset_delete_consequences"):"All keybinds in this bindset will be permanently lost and cannot be recovered."}</p>\n          </div>\n\n          <div class="bindset-delete-steps">\n            <div class="bindset-delete-step">\n              <label class="checkbox-label">\n                <input type="checkbox" id="bindset-delete-confirm-checkbox">\n                <span class="checkmark"></span>\n                ${s}\n              </label>\n            </div>\n\n            <div class="bindset-delete-step">\n              <label for="bindset-delete-confirm-input" class="input-label">\n                ${o}\n              </label>\n              <input\n                type="text"\n                id="bindset-delete-confirm-input"\n                class="form-control"\n                placeholder="DELETE"\n                disabled\n                autocomplete="off"\n                spellcheck="false"\n              >\n            </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-secondary bindset-delete-cancel-btn">\n            ${c}\n          </button>\n          <button class="btn btn-danger bindset-delete-confirm-btn" disabled>\n            ${r}\n          </button>\n        </div>\n      </div>\n    `,i}regenerateModal(){if(!this.currentModal)return;const{bindsetName:e,keyCount:t,modalElement:i,modalId:n}=this.currentModal,a=i.querySelector("#bindset-delete-confirm-checkbox"),s=i.querySelector("#bindset-delete-confirm-input"),o=a.checked,r=s.value,c=this.createModal(e,t);c.id=n,i.replaceWith(c),this.currentModal.modalElement=c;const l=c.querySelector("#bindset-delete-confirm-checkbox"),d=c.querySelector("#bindset-delete-confirm-input"),m=c.querySelector(".bindset-delete-confirm-btn"),h=c.querySelector(".bindset-delete-cancel-btn");l.checked=o,d.value=r;const u=()=>{const e=l.checked,t=d.value.trim().toUpperCase(),i=e&&"DELETE"===t;return m.disabled=!i,d.disabled=!e,i};l.addEventListener("change",u),d.addEventListener("input",u),m.addEventListener("click",()=>{this.modalManager?.unregisterRegenerateCallback(n),this.currentModal=null,this.modalManager?.hide(n),c.parentNode&&c.parentNode.removeChild(c),this.currentModal.resolve(!0)}),h.addEventListener("click",()=>{this.modalManager?.unregisterRegenerateCallback(n),this.currentModal=null,this.modalManager?.hide(n),c.parentNode&&c.parentNode.removeChild(c),this.currentModal.resolve(!1)}),u()}}class Gt extends vt{constructor({eventBus:e,app:t=null,modalManager:i=null,confirmDialog:n=null,inputDialog:a=null,i18n:s,document:o=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="KeyBrowserUI",this.app=t||(void 0!==window.app?window.app:null),this.modalManager=i,this.confirmDialog=n||("undefined"!=typeof window?window.confirmDialog:null),this.inputDialog=a||("undefined"!=typeof window?window.inputDialog:null),this.i18n=s,this.document=o,this.bindsetDeleteConfirm=new qt({eventBus:this.eventBus,modalManager:this.modalManager,i18n:this.i18n})}onInit(){const e=localStorage.getItem("keyViewMode")||"grid";this.updateViewToggleButton(e),this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("addKeyBtn","click","key-add",()=>{this.showKeySelectionModal()}),this.onDom("deleteKeyBtn","click","key-delete",()=>{this.cache.selectedKey&&this.confirmDeleteKey(this.cache.selectedKey)}),this.onDom("duplicateKeyBtn","click","key-duplicate",()=>{this.cache.selectedKey&&this.duplicateKey(this.cache.selectedKey)}),this.onDomDebounced("keyFilter","input","key-filter",e=>{this.filterKeys(e.target.value)},250),this.onDom("keyFilter","keydown","key-filter-key",e=>{if("Escape"===e.key){e.preventDefault();const t=e.target;t.value="",t.classList.remove("expanded"),this.emit("key:filter",{filter:""})}else if("Enter"===e.key){const t=e.target;t.classList.remove("expanded"),t.blur()}}),this.onDom("showAllKeysBtn","click","show-all-keys",()=>{this.showAllKeys()}),this.onDom("toggleKeyViewBtn","click","toggle-key-view",()=>{this.toggleKeyView()}),this.onDom("keySearchBtn","click","key-search-toggle",()=>{this.toggleKeySearch()}),this.eventBus.on("key:list-changed",()=>this.render()),this.ensureCorrectViewMode(),this.addEventListener("environment:changed",(e={})=>{const t="string"==typeof e?e:e.environment||e.newMode||e.mode;t&&(this.toggleVisibility(t),"alias"!==t&&this.render())}),this.addEventListener("key-selected",()=>{this.render()}),this.addEventListener("profile:switched",()=>{this.render()}),this.addEventListener("key-view:toggle",()=>this.toggleKeyView()),this.addEventListener("key-view:update-toggle",e=>this.updateViewToggleButton(e?.viewMode)),this.addEventListener("keys:filter",e=>{const t="string"==typeof e?e:e?.value||"";this.filterKeys(t)}),this.addEventListener("keys:show-all",()=>this.showAllKeys()),this.addEventListener("key-view:mode-changed",()=>this.render()),this.addEventListener("language:changed",()=>{this.render()}),this.addEventListener("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};for(const[e,i]of Object.entries(t))"theme"===e?this.render():"bindsetsEnabled"!==e&&"bindToAliasMode"!==e||(this.ensureCorrectViewMode(),this.render())}),this.addEventListener("bindset-section:collapse-changed",()=>{this.render()}),this.addEventListener("bindsets:changed",()=>{this.shouldShowBindsetSections()&&this.render()}),this.addEventListener("bindset:created",()=>{this.shouldShowBindsetSections()&&this.render()}),this.addEventListener("bindset:deleted",()=>{this.shouldShowBindsetSections()&&this.render()}))}async render(){const e=this.document.getElementById("keyGrid");if(!e)return;const t=this.cache.profile;if(!t)return void(e.innerHTML=`<div class="empty-state"><i class="fas fa-folder-open"></i><h4>${this.i18n.t("no_profile_selected")}</h4></div>`);const i=this.document.createDocumentFragment(),n=this.getCurrentViewMode(),a=await this.request("key:get-all"),s=Object.keys(a),o={};s.forEach(e=>{const t=a[e];t&&t.length>0&&(o[e]=t)});const r=[...new Set([...s,...Object.keys(o)])];this.$e=a,this.shouldShowBindsetSections()?(await this.renderBindsetSectionsView(i,n,t,a,o,r),e.classList.add("categorized")):"key-types"===n?(await this.renderKeyTypeView(i,t,r),e.classList.add("categorized")):"grid"===n?(await this.renderSimpleGridView(i,r),e.classList.remove("categorized")):(await this.renderCommandCategoryView(i,o,r),e.classList.add("categorized")),e.innerHTML="",e.appendChild(i)}getCurrentViewMode(){return localStorage.getItem("keyViewMode")||"grid"}shouldShowBindsetSections(){const e=this.cache.preferences?.bindsetsEnabled||!1,t=this.cache.preferences?.bindToAliasMode||!1,i=this.cache.currentEnvironment||"space";return e&&t&&"alias"!==i}ensureCorrectViewMode(){const e=this.getCurrentViewMode();this.emit("key-view:mode-changed",{mode:e})}async renderSimpleGridView(e,t){(await this.request("key:sort",{keys:t})).forEach(t=>{const i=this.createKeyElement(t);e.appendChild(i)})}async renderCommandCategoryView(e,t,i){const n=await this.categorizeKeys(t,i),a=Object.entries(n).sort(([e,t],[i,n])=>t.priority!==n.priority?t.priority-n.priority:t.name.localeCompare(n.name));for(const[t,i]of a){const n=await this.createKeyCategoryElement(t,i);e.appendChild(n)}}async renderKeyTypeView(e,t,i){const n=await this.categorizeKeysByType(this.$e,i),a=Object.entries(n).sort(([,e],[,t])=>e.priority-t.priority);for(const[t,i]of a){const n=await this.createKeyCategoryElement(t,i,"key-type");e.appendChild(n)}}async renderBindsetSectionView(e,t){const i=await this.request("key:get-all-sectional"),n=Object.entries(i).sort(([e],[t])=>"Primary Bindset"===e?-1:"Primary Bindset"===t?1:e.localeCompare(t));for(const[t,i]of n){const n=await this.createBindsetSectionElement(t,i);e.appendChild(n)}}async renderBindsetSectionsView(e,t,i,n,a,s){const o=await this.request("key:get-all-sectional"),r=Object.entries(o).sort(([e],[t])=>"Primary Bindset"===e?-1:"Primary Bindset"===t?1:e.localeCompare(t));this.Ee=t;for(const[o,c]of r){const r=await this.createBindsetSectionElement(o,c,t,i,n,a,s);e.appendChild(r)}}toggleBindsetSection(e,t){const i=t.classList.toggle("collapsed");localStorage.setItem(`bindset-section-collapsed-${e}`,i.toString());const n=t.querySelector('[data-action="toggle-collapse"] i');n&&(n.className=i?"fas fa-chevron-right":"fas fa-chevron-down"),this.emit("bindset-section:collapse-changed",{bindsetName:e,isCollapsed:i})}async renderSimpleGridViewForKeys(e,t,i){const n=t.sort();for(const t of n){const n=this.createKeyElement(t,i[t]);n&&e.appendChild(n)}}async renderKeyTypeViewForKeys(e,t,i,n){const a={};i.forEach(e=>{a[e]=n[e]||[]});const s=await this.request("key:detect-types",{keys:Object.keys(a)}),o=["standard","weapon","system","movement","social"],r=Object.keys(s).sort((e,t)=>{const i=o.indexOf(e.toLowerCase()),n=o.indexOf(t.toLowerCase());return-1===i&&-1===n?e.localeCompare(t):-1===i?1:-1===n?-1:i-n});for(const t of r){const i=s[t];if(0===i.keys.length)continue;const a=this.document.createElement("div");a.className="category-group";const o=this.document.createElement("div");o.className="category-header",o.innerHTML=`<i class="fas ${i.icon}"></i> ${i.name}`,a.appendChild(o);const r=this.document.createElement("div");r.className="category-commands",i.keys.forEach(e=>{const t=this.createKeyElement(e,n[e]);t&&r.appendChild(t)}),a.appendChild(r),e.appendChild(a)}}async renderCommandCategoryViewForKeys(e,t,i,n){const a=await this.categorizeKeys(t,i),s=Object.keys(a).sort();for(const t of s){const s=a[t];if(0===s.length)continue;const o=s.filter(e=>i.includes(e));if(0===o.length)continue;const r=this.document.createElement("div");r.className="category-group";const c=this.document.createElement("div");c.className="category-header",c.textContent=t,r.appendChild(c);const l=this.document.createElement("div");l.className="category-commands",o.forEach(e=>{const t=this.createKeyElement(e,n[e]);t&&l.appendChild(t)}),r.appendChild(l),e.appendChild(r)}}async categorizeKeys(e,t){return await this.request("key:categorize-by-command",{keysWithCommands:e,allKeys:t})}async categorizeKeysByType(e,t){return await this.request("key:categorize-by-type",{keysWithCommands:e,allKeys:t})}formatKeyName(e){return e.replace(/\+/g,"<br>+")}createKeyElement(e,t=null){const i=this.$e||{},n=i&&i[e]?i[e]:[],a=this.isKeySelectedInContext(e,t),s=n.filter(e=>"string"==typeof e?""!==e.trim():!(!e||"string"!=typeof e.command)&&""!==e.command.trim()),o=this.document.createElement("div");o.className="key-item "+(a?"active":""),o.dataset.key=e,o.title=`${e}: ${s.length} command${1!==s.length?"s":""}`;const r=this.formatKeyName(e),c=e.length,l=c<=3?"short":c<=5?"medium":c<=8?"long":"extra-long";return o.dataset.length=l,o.innerHTML=`<div class="key-label">${r}</div>${s.length>0?`<div class="activity-bar" style="width:${Math.min(15*s.length,100)}%"></div><div class="command-count-badge">${s.length}</div>`:""}`,this.onDom(o,"click","key-element-click",t=>{const i=o.closest(".bindset-section"),n=i?.dataset?.bindset;console.log(`[KeyBrowserUI] Sending key:select with bindset context: ${n}`),this.request("key:select",{keyName:e,environment:this.cache?.currentEnvironment||"space",bindset:n&&"Primary Bindset"!==n?n:null})}),o}isKeySelectedInContext(e,t){return t?e===this.cache.selectedKey&&this.cache.activeBindset===t:e===this.cache.selectedKey}async createKeyCategoryElement(e,t,i="command",n=null){const a=this.document.createElement("div");a.className="category",a.dataset.category=e;const s=await this.request("key:get-category-state",{categoryId:e,mode:i});a.innerHTML=`<h4 class="${s?"collapsed":""}" data-category="${e}" data-mode="${i}"><i class="fas fa-chevron-right category-chevron"></i><i class="${t.icon}"></i>${t.name}<span class="key-count">(${t.keys.length})</span></h4><div class="category-commands ${s?"collapsed":""}">${t.keys.map(e=>this.createKeyElement(e,n).outerHTML).join("")}</div>`;const o=a.querySelector("h4");this.onDom(o,"click","category-header-click",()=>{this.toggleKeyCategory(e,a,i)});const r=a.querySelector(".category-commands");return r.innerHTML="",t.keys.forEach(e=>r.appendChild(this.createKeyElement(e,n))),a}async createBindsetSectionElement(e,t,i,n,a,s,o){const r=this.document.createElement("div");r.className="bindset-section",r.dataset.bindset=e;const c=this.document.createElement("div");c.className="bindset-header command-group-separator",c.dataset.bindset=e,c.dataset.action="bindset-section-header";const l=this.document.createElement("div");l.className="bindset-info group-info";const d=this.document.createElement("i");d.className="fas fa-chevron-right twisty "+(t.isCollapsed?"collapsed":"");const m=this.document.createElement("span");m.className="bindset-name group-title",m.textContent=e;const h=this.document.createElement("span");h.className="bindset-count",h.textContent=`(${t.keyCount})`,l.appendChild(d),l.appendChild(m),l.appendChild(h),c.appendChild(l);const u=this.document.createElement("div");u.className="bindset-actions";const p=this.document.createElement("button");p.className="control-btn bindset-menu-btn",p.dataset.action="bindset-menu",p.innerHTML='<i class="fas fa-ellipsis-v"></i>',p.title=this.i18n.t("bindset_actions"),u.appendChild(p);const f=this.document.createElement("div");f.className="bindset-menu-dropdown",f.dataset.bindset=e,"Primary Bindset"===e?(this.addMenuItem(f,"create","fas fa-plus",this.i18n.t("create_bindset"),()=>this.handleCreateBindset()),this.addMenuItem(f,"clone","fas fa-copy",this.i18n.t("clone_bindset"),()=>this.handleCloneBindset(e))):(this.addMenuItem(f,"clone","fas fa-copy",this.i18n.t("clone_bindset"),()=>this.handleCloneBindset(e)),this.addMenuItem(f,"rename","fas fa-edit",this.i18n.t("rename_bindset"),()=>this.handleRenameBindset(e)),this.addMenuItem(f,"delete","fas fa-trash",this.i18n.t("delete_bindset"),()=>this.handleDeleteBindset(e),!0)),u.appendChild(f),this.onDom(p,"click","bindset-menu-btn",e=>{e.stopPropagation(),this.toggleBindsetMenu(f)}),this.onDom(this.document,"click","bindset-menu-outside",e=>{e.target.closest(".bindset-actions")||this.closeAllBindsetMenus()}),c.appendChild(u),r.appendChild(c);const y=this.document.createElement("div");if(y.className="bindset-content "+(t.isCollapsed?"collapsed":""),console.log(`[KeyBrowserUI] bindsetData.keys for "${e}":`,t.keys),console.log("[KeyBrowserUI] bindsetData.keys.length:",t.keys.length),t.keys.length>0){let n={};if("Primary Bindset"===e)n=await this.request("key:get-all");else{const t=this.cache.currentEnvironment||"space",i=this.cache.profile;console.log(`[KeyBrowserUI] Profile bindsets for "${e}":`,i?.bindsets?.[e]),console.log(`[KeyBrowserUI] Environment: "${t}"`),n={},i?.bindsets?.[e]?.[t]?.keys?(n=i.bindsets[e][t].keys,console.log(`[KeyBrowserUI] Created keyMap for bindset "${e}" with ${Object.keys(n).length} keys:`,Object.keys(n))):(console.log(`[KeyBrowserUI] No keys found - profile.bindsets.${e}?:`,!!i?.bindsets?.[e]),console.log(`[KeyBrowserUI] No keys found - profile.bindsets.${e}.${t}?:`,!!i?.bindsets?.[e]?.[t]),console.log("[KeyBrowserUI] Available bindsets:",Object.keys(i?.bindsets||{})))}this.$e=n;const a=i||"grid";if("key-types"===a)await this.renderKeyTypeViewForBindset(y,t.keys,n,e,s,o);else if("categorized"===a)await this.renderCommandCategoryViewForBindset(y,t.keys,n,e,s);else{const i=this.document.createElement("div");i.className="key-grid-subsection",t.keys.forEach(t=>{const n=this.createKeyElement(t,e);i.appendChild(n)}),y.appendChild(i)}}else{console.log(`[KeyBrowserUI] Showing empty message for bindset "${e}" - no keys found`);const t=this.document.createElement("div");t.className="empty-section",t.textContent=this.i18n.t("no_keys_in_bindset"),y.appendChild(t)}return r.appendChild(y),this.onDom(c,"click","bindset-section-header-click",()=>{this.toggleBindsetSection(e,r)}),r}async renderKeyTypeViewForBindset(e,t,i,n,a,s){const o=await this.categorizeKeysByType(a,t),r=["standard","weapon","system","movement","social"],c=Object.keys(o).sort((e,t)=>{const i=r.indexOf(e.toLowerCase()),n=r.indexOf(t.toLowerCase());return-1===i&&-1===n?e.localeCompare(t):-1===i?1:-1===n?-1:i-n});for(const t of c){const i=o[t];if(0===i.keys.length)continue;const a=await this.createKeyCategoryElement(t,i,"type",n);e.appendChild(a)}}async renderCommandCategoryViewForBindset(e,t,i,n,a){const s=await this.categorizeKeys(a,t),o=Object.keys(s).sort();for(const t of o){const i=s[t];if(0===i.keys.length)continue;const a={name:this.i18n.t(t),icon:"fas fa-folder",keys:i.keys},o=await this.createKeyCategoryElement(t,a,"command",n);e.appendChild(o)}}async toggleKeyCategory(e,t,i="command"){const n=await this.request("key:toggle-category",{categoryId:e,mode:i}),a=t.querySelector("h4"),s=t.querySelector(".category-commands");n?(a.classList.add("collapsed"),s.classList.add("collapsed")):(a.classList.remove("collapsed"),s.classList.remove("collapsed"))}async toggleBindsetSection(e,t){const i=await this.request("bindset:toggle-collapse",{bindsetName:e}),n=t.querySelector(".bindset-header"),a=t.querySelector(".bindset-content"),s=t.querySelector(".twisty");i?(n?.classList.add("collapsed"),a?.classList.add("collapsed"),s&&s.classList.add("collapsed")):(n?.classList.remove("collapsed"),a?.classList.remove("collapsed"),s&&s.classList.remove("collapsed"))}async countBindsetKeys(e){try{const t=this.cache.profile||this.cache.currentProfile;console.log(`[KeyBrowserUI] countBindsetKeys for "${e}":`,{profile:!!t,profileBindsets:!!t?.bindsets,bindsetKeys:Object.keys(t?.bindsets||{}),targetBindset:t?.bindsets?.[e]});const i=t?.bindsets?.[e];if(!i)return console.log(`[KeyBrowserUI] countBindsetKeys: bindset "${e}" not found`),0;let n=0;const a=e=>{const t=i?.[e]?.keys,n=t&&Object.keys(t).length>0;return console.log(`[KeyBrowserUI] countBindsetKeys: env "${e}" has keys: ${n}, key count: ${n?Object.keys(t).length:0}`),n};if(a("space")&&(n+=Object.keys(i.space.keys).length),a("ground")&&(n+=Object.keys(i.ground.keys).length),console.log(`[KeyBrowserUI] countBindsetKeys: final count for "${e}" = ${n}`),0===n){console.log("[KeyBrowserUI] countBindsetKeys: cache reports 0 keys, checking with service...");try{const t=await this.request("bindset:delete",{name:e});if(console.log("[KeyBrowserUI] countBindsetKeys: service check result:",t),!1===t?.success&&"not_empty"===t?.error)return console.log("[KeyBrowserUI] countBindsetKeys: service indicates bindset has keys, using fallback count"),1}catch(e){console.warn("[KeyBrowserUI] countBindsetKeys: service check failed:",e)}}return n}catch(e){return console.error("Error counting bindset keys:",e),0}}async confirmDeleteBindset(e){if(!e||!this.confirmDialog)return!1;const t=await this.countBindsetKeys(e);if(t>0){if(await this.bindsetDeleteConfirm.confirm(e,t,"bindsetDelete")){const t=await this.request("bindset:delete-with-keys",{name:e});if(t?.success){const t=this.i18n.t("bindset_deleted",{name:e});return this.showToast(t,"success"),!0}{const e=this.i18n.t(t?.error,t?.params);return this.showToast(e,"error"),!1}}return!1}{const t=this.i18n.t("confirm_delete_bindset",{name:e}),i=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(t,i,"danger","bindsetDelete")){const t=await this.request("bindset:delete",{name:e});if(t?.success){const t=this.i18n.t("bindset_deleted",{name:e});return this.showToast(t,"success"),!0}{const e=this.i18n.t(t?.error,t?.params);return this.showToast(e,"error"),!1}}return!1}}updateViewToggleButton(e){const t=this.document.getElementById("toggleKeyViewBtn");if(!t)return;const i=t.querySelector("i")||t;"categorized"===e?(i.className="fas fa-sitemap",t.title=this.i18n.t("switch_to_key_type_view")):"key-types"===e?(i.className="fas fa-th",t.title=this.i18n.t("switch_to_grid_view")):(i.className="fas fa-list",t.title=this.i18n.t("switch_to_categorized_view"))}toggleKeyView(){if(this.app&&"alias"===this.app.currentEnvironment)return;const e=localStorage.getItem("keyViewMode")||"grid";let t;t="grid"===e?"categorized":"categorized"===e?"key-types":"grid",localStorage.setItem("keyViewMode",t),this.render(),this.updateViewToggleButton(t),this.emit("key-view:mode-changed",{mode:t})}filterKeys(e=""){const t=(e||"").toString().toLowerCase(),i=this.document.getElementById("keyGrid");if(!i)return;const n=Array.from(i.querySelectorAll(".key-item")).map(e=>e.dataset.key),a=new Set;n.forEach(e=>{(!t||e.toLowerCase().includes(t))&&a.add(e)}),i.querySelectorAll(".key-item").forEach(e=>{const t=e.dataset.key,i=a.has(t);e.style.display=i?"flex":"none"}),i.querySelectorAll(".command-item[data-key]").forEach(e=>{const t=e.dataset.key,i=a.has(t);e.style.display=i?"flex":"none"}),i.querySelectorAll(".category").forEach(e=>{const i=e.querySelectorAll('.command-item[data-key]:not([style*="display: none"])'),n=!t||i.length>0;e.style.display=n?"block":"none"});const s=this.document.getElementById("keySearchBtn");if(s){const e=!!t;s.classList.toggle("active",e),s.setAttribute("aria-pressed",e)}}showAllKeys(){const e=this.document.getElementById("keyGrid");if(!e)return;e.querySelectorAll(".key-item").forEach(e=>{e.style.display="flex"}),e.querySelectorAll(".command-item[data-key]").forEach(e=>{e.style.display="flex"}),e.querySelectorAll(".category").forEach(e=>{e.style.display="block"});const t=this.document.getElementById("keyFilter");t&&(t.value="");const i=this.document.getElementById("keySearchBtn");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false"))}toggleVisibility(e){requestAnimationFrame(()=>{const t=this.document.querySelector(".key-selector-container");t?"alias"!==e?t.style.removeProperty("display"):t.style.setProperty("display","none","important"):console.warn("[KeyBrowserUI] Key selector container not found in DOM")})}handleInitialState(e,t){if(!t)return;if("SelectionService"===e)return void(t.selectedKey&&this.render());const i=t.environment||t.currentEnvironment;i&&(this.toggleVisibility(i),"alias"!==i&&this.render())}showKeySelectionModal(){this.modalManager&&this.modalManager.show("keySelectionModal")}async confirmDeleteKey(e){if(!e||!this.confirmDialog)return!1;const t=this.i18n.t("confirm_delete_key",{keyName:e}),i=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(t,i,"danger","keyDelete")){const t=await this.request("key:delete",{key:e});if(t?.success){const t=this.i18n.t("key_deleted",{keyName:e});return this.showToast(t,"success"),!0}{const e=this.i18n.t(t?.error,t?.params);return this.showToast(e,"error"),!1}}return!1}async duplicateKey(e){return!!e&&(this.emit("key:duplicate",{key:e}),!0)}toggleKeySearch(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("keyFilter");t&&(t.classList.toggle("expanded")?t.focus():t.blur())}hasRequiredData(){return this.cache&&this.cache.currentProfile&&this.cache.currentEnvironment&&void 0!==this.cache.keys}performInitialRender(){this.render().catch(e=>{console.error("[KeyBrowserUI] Initial render failed:",e)})}addMenuItem(e,t,i,n,a,s=!1){const o=this.document.createElement("div");o.className="bindset-menu-item "+(s?"dangerous":""),o.dataset.action=t,o.innerHTML=`<i class="${i}"></i><span>${n}</span>`,this.onDom(o,"click",`bindset-menu-${t}`,e=>{e.stopPropagation(),a(),this.closeAllBindsetMenus()}),e.appendChild(o)}toggleBindsetMenu(e){const t=e.classList.contains("open");this.closeAllBindsetMenus(),t||e.classList.add("open")}closeAllBindsetMenus(){this.document.querySelectorAll(".bindset-menu-dropdown.open").forEach(e=>{e.classList.remove("open")})}async handleCreateBindset(){if(!this.inputDialog)return;const e=this.i18n.t("create_bindset"),t=this.i18n.t("enter_bindset_name"),i=await this.inputDialog.prompt(t,{title:e,placeholder:this.i18n.t("bindset_name"),validate:e=>{const t=e.trim();return t?!this.cache.bindsetNames.includes(t)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!i?.trim())return;const n=await this.request("bindset:create",{name:i.trim()});n?.success||this.showError(n.error)}async handleCloneBindset(e){if(!this.inputDialog)return;const t=this.i18n.t("clone_bindset"),i=this.i18n.t("enter_bindset_name"),n="Primary Bindset"===e?this.i18n.t("primary_bindset_copy_default"):`${e} ${this.i18n.t("copy_suffix")}`,a=await this.inputDialog.prompt(i,{title:t,defaultValue:n,placeholder:this.i18n.t("bindset_name"),validate:t=>{const i=t.trim();return i?i===e?this.i18n.t("name_unchanged"):!this.cache.bindsetNames.includes(i)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!a?.trim()||a.trim()===e)return;const s=await this.request("bindset:clone",{sourceBindset:e,targetBindset:a.trim()});s?.success||this.showError(s.error)}async handleRenameBindset(e){if(!this.inputDialog)return;const t=this.i18n.t("rename_bindset"),i=this.i18n.t("enter_bindset_name"),n=await this.inputDialog.prompt(i,{title:t,defaultValue:e,placeholder:this.i18n.t("bindset_name"),validate:t=>{const i=t.trim();return i?i===e?this.i18n.t("name_unchanged"):!this.cache.bindsetNames.includes(i)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!n?.trim()||n.trim()===e)return;const a=await this.request("bindset:rename",{oldName:e,newName:n.trim()});a?.success||this.showError(a.error)}handleDeleteBindset(e){this.confirmDeleteBindset(e)}}class Vt{constructor(e=null,t={}){this.eventBus=e,this.options={enableCache:!0,maxCacheSize:1e3,enablePerformanceMetrics:!1,hotPathThreshold:10,...t},this.parseCache=new Map,this.hotPathCache=new Map,this.frequencyTracker=new Map,this.performanceMetrics=new Map,this.signatures=this.initializeCommandSignatures(),this.eventBus&&this.setupRequestHandlers()}setupRequestHandlers(){oe(this.eventBus,"parser:parse-command-string",({commandString:e,options:t})=>this.parseCommandString(e,t)),oe(this.eventBus,"parser:get-performance-metrics",()=>Array.from(this.performanceMetrics.entries())),oe(this.eventBus,"parser:clear-cache",()=>(this.parseCache.clear(),this.hotPathCache.clear(),this.frequencyTracker.clear(),{success:!0}))}initializeCommandSignatures(){return{TrayExecution:{patterns:[{regex:/^(\+(?:STO)?TrayExecByTray)\s+(\d+)\s+(\d+)$/i,weight:100,signature:"TrayExecByTray(active: number, tray: number, slot: number)",extractParams:e=>({active:1,tray:parseInt(e[2]),slot:parseInt(e[3]),baseCommand:e[1],isShorthand:!0}),generateDisplayText:e=>({key:"command_definitions.custom_tray.name",params:{tray:e.tray,slot:e.slot},fallback:`Tray Execution (${e.tray} ${e.slot})`})},{regex:/^((?:STO)?TrayExecByTray)\s+(\d+)\s+(\d+)\s+(\d+)$/i,weight:99,signature:"TrayExecByTray(active: number, tray: number, slot: number)",extractParams:e=>({active:parseInt(e[2]),tray:parseInt(e[3]),slot:parseInt(e[4]),baseCommand:e[1],isShorthand:!1}),generateDisplayText:e=>({key:"command_definitions.custom_tray.name",params:{tray:e.tray,slot:e.slot},fallback:`Tray Execution (${e.tray} ${e.slot})`})}],category:"tray",baseCommand:"TrayExecByTray",icon:"‚ö°"},TrayWithBackup:{patterns:[{regex:/^(\+TrayExecByTrayWithBackup)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)$/i,weight:90,signature:"TrayExecByTrayWithBackup(active: number, tray: number, slot: number, backup_tray: number, backup_slot: number)",extractParams:e=>({active:1,tray:parseInt(e[2]),slot:parseInt(e[3]),backup_tray:parseInt(e[4]),backup_slot:parseInt(e[5]),baseCommand:e[1],isShorthand:!0}),generateDisplayText:e=>({key:"command_definitions.tray_with_backup.name",params:{tray:e.tray,slot:e.slot,backup_tray:e.backup_tray,backup_slot:e.backup_slot},fallback:`Tray Execution with Backup (${e.tray} ${e.slot} -> ${e.backup_tray} ${e.backup_slot})`})},{regex:/^(TrayExecByTrayWithBackup)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)$/i,weight:89,signature:"TrayExecByTrayWithBackup(active: number, tray: number, slot: number, backup_tray: number, backup_slot: number)",extractParams:e=>({active:parseInt(e[2]),tray:parseInt(e[3]),slot:parseInt(e[4]),backup_tray:parseInt(e[5]),backup_slot:parseInt(e[6]),baseCommand:e[1],isShorthand:!1}),generateDisplayText:e=>({key:"command_definitions.tray_with_backup.name",params:{tray:e.tray,slot:e.slot,backup_tray:e.backup_tray,backup_slot:e.backup_slot},fallback:`Tray Execution with Backup (${e.tray} ${e.slot} -> ${e.backup_tray} ${e.backup_slot})`})}],category:"tray",baseCommand:"TrayExecByTrayWithBackup",icon:"‚ö°"},Communication:{patterns:[{regex:/^(say|team|zone|tell)\s+"([^"]+)"$/i,weight:70,signature:"Communication(verb: string, message: string)",extractParams:e=>({verb:e[1],message:e[2]}),generateDisplayText:e=>`${e.verb}: "${e.message}"`},{regex:/^(say|team|zone|tell)\s+(.+)$/i,weight:65,signature:"Communication(verb: string, message: string)",extractParams:e=>({verb:e[1],message:e[2]}),generateDisplayText:e=>`${e.verb}: ${e.message}`}],category:"communication",baseCommand:"Communication",icon:"üí¨"},TargetWithName:{patterns:[{regex:/^Target\s+"([^"]+)"$/i,weight:60,signature:"Target(entityName: string)",extractParams:e=>({entityName:e[1]}),generateDisplayText:e=>`Target "${e.entityName}"`}],category:"targeting",baseCommand:"Target",icon:"üéØ"},VFXCommands:{patterns:[{regex:/^dynFxSetFXExclusionList_Combined$/i,weight:48,signature:"VFXExclusionMaster()",extractParams:()=>({}),generateDisplayText:()=>"undefined"!=typeof i18next&&i18next.t?i18next.t("vfx_alias_combined"):"VFX Alias: Combined Space/Ground"},{regex:/^dynFxSetFXExclusionList\s+(.+)$/i,weight:51,signature:"VFXExclusion(effects: string)",extractParams:e=>({effects:e[1]}),generateDisplayText:e=>`VFX Exclude: ${e.effects}`},{regex:/^dynFxSetFXExclusionList_(.+)$/i,weight:49,signature:"VFXExclusionAlias(aliasName: string)",extractParams:e=>({aliasName:e[1]}),generateDisplayText:e=>{if("undefined"!=typeof i18next&&i18next.t){const t=e.aliasName.toLowerCase();if("space"===t)return i18next.t("vfx_alias_space");if("ground"===t)return i18next.t("vfx_alias_ground")}return`VFX Alias: ${e.aliasName}`}}],category:"vfx",baseCommand:"VFXControl",icon:"‚ú®"},PowerCommands:{patterns:[{regex:/^\+power_exec\s+(.+)$/i,weight:30,signature:"PowerExec(powerName: string)",extractParams:e=>({powerName:e[1]}),generateDisplayText:e=>`Power: ${e.powerName}`}],category:"power",baseCommand:"PowerExec",icon:"üîã"},MovementCommands:{patterns:[{regex:/^\+(fullimpulse|reverse|turn_left|turn_right|up|down|left|right|forward|backward)$/i,weight:25,signature:"Movement(direction: string)",extractParams:e=>({direction:e[1]}),generateDisplayText:e=>`Movement: ${e.direction}`}],category:"movement",baseCommand:"Movement",icon:"üöÄ"},SystemCommands:{patterns:[{regex:/^(screenshot|interactwindow|\+gentoggle.*)$/i,weight:20,signature:"System(command: string)",extractParams:e=>({command:e[1]}),generateDisplayText:e=>`System: ${e.command}`}],category:"system",baseCommand:"System",icon:"‚öôÔ∏è"},CameraCommands:{patterns:[{regex:/^(.*cam.*|.*look.*|.*zoom.*)$/i,weight:15,signature:"Camera(command: string)",extractParams:e=>({command:e[1]}),generateDisplayText:e=>`Camera: ${e.command}`}],category:"camera",baseCommand:"Camera",icon:"üìπ"}}}parseCommandString(e,t={}){const i=performance.now();if(this.trackCommandFrequency(e),this.hotPathCache.has(e))return this.updateMetrics("hotpath_hit",i),this.hotPathCache.get(e);if(this.options.enableCache&&this.parseCache.has(e))return this.updateMetrics("cache_hit",i),this.parseCache.get(e);const n=e.split(/\s*\$\$\s*/).map(e=>e.trim()).filter(e=>e),a=n.map((e,i)=>this.parseIndividualCommand(e,i,t)),s={originalString:e,commands:a,isMirrored:this.detectMirroring(n),parseTime:performance.now()-i,metadata:{totalCommands:a.length,cacheStatus:"miss",parseMethod:"signature-based"}};return this.options.enableCache&&this.cacheResult(e,s),this.updateMetrics("parse_complete",i),s}parseIndividualCommand(e,t,i={}){const n=Object.entries(this.signatures).sort((e,t)=>{const i=Math.max(...e[1].patterns.map(e=>e.weight));return Math.max(...t[1].patterns.map(e=>e.weight))-i});for(const[a,s]of n)for(const n of s.patterns){const o=e.match(n.regex);if(o){const r=n.extractParams(o),c=!1!==i.generateDisplayText&&n.generateDisplayText?n.generateDisplayText(r):e;return{command:e,signature:n.signature,category:s.category,baseCommand:s.baseCommand,icon:s.icon,parameters:r,displayText:c,matchPattern:n,id:`parsed_${Date.now()}_${t}`,parseMetadata:{signatureName:a,patternWeight:n.weight,matchTime:performance.now()}}}}return{command:e,signature:"UnknownCommand(command: string)",category:"custom",baseCommand:"Custom",icon:"‚öôÔ∏è",parameters:{command:e},displayText:e,id:`unknown_${Date.now()}_${t}`,parseMetadata:{signatureName:"fallback",patternWeight:0,matchTime:performance.now()}}}trackCommandFrequency(e){const t=this.frequencyTracker.get(e)||0;if(this.frequencyTracker.set(e,t+1),t>=this.options.hotPathThreshold&&!this.hotPathCache.has(e)){const t=this.options.hotPathThreshold;this.options.hotPathThreshold=1/0;const i=this.parseCommandString(e);this.hotPathCache.set(e,i),this.options.hotPathThreshold=t}}detectMirroring(e){if(e.length<=1)return!1;if(e.length<3||e.length%2==0)return!1;const t=Math.floor(e.length/2),i=e.slice(0,t+1),n=e.slice(t+1),a=i.slice(0,-1).reverse();return n.length===a.length&&n.every((e,t)=>e.trim()===a[t].trim())}cacheResult(e,t){if(this.parseCache.size>=this.options.maxCacheSize){const e=this.parseCache.keys().next().value;this.parseCache.delete(e)}this.parseCache.set(e,t)}updateMetrics(e,t){if(!this.options.enablePerformanceMetrics)return;const i=performance.now()-t,n=this.performanceMetrics.get(e)||{count:0,totalTime:0,avgTime:0};n.count++,n.totalTime+=i,n.avgTime=n.totalTime/n.count,this.performanceMetrics.set(e,n)}static createStandalone(e={}){return new Vt(null,e)}}const Jt={"TrayExecByTray(active: number, tray: number, slot: number)":{commandId:"custom_tray",name:"Execute Tray Slot",category:"tray",icon:"‚ö°",description:"Execute a specific tray slot",parameters:{active:{type:"number",min:0,max:1,default:1,label:"Active",help:"Set to 1 to enable, 0 to disable (temporarily disable without removing)"},tray:{type:"number",min:0,max:9,default:0,label:"Tray Number",help:"Tray number (0-9, displays as 1-10 in UI)"},slot:{type:"number",min:0,max:9,default:0,label:"Slot Number",help:"Slot number (0-9, displays as 1-10 in UI)"},command_type:{type:"select",options:["STOTrayExecByTray","TrayExecByTray"],default:"STOTrayExecByTray",label:"Command Type",help:"STOTrayExecByTray shows binding in UI, TrayExecByTray does not"}}},"TrayExecByTrayWithBackup(active: number, tray: number, slot: number, backup_tray: number, backup_slot: number)":{commandId:"tray_with_backup",name:"Execute Tray with Backup",category:"tray",icon:"‚ö°",description:"Execute tray slot with backup fallback",parameters:{active:{type:"number",min:0,max:1,default:1,label:"Active State",help:"Primary tray state (0 or 1)"},tray:{type:"number",min:0,max:9,default:0,label:"Primary Tray",help:"Primary tray number"},slot:{type:"number",min:0,max:9,default:0,label:"Primary Slot",help:"Primary slot number"},backup_tray:{type:"number",min:0,max:9,default:0,label:"Backup Tray",help:"Backup tray number"},backup_slot:{type:"number",min:0,max:9,default:0,label:"Backup Slot",help:"Backup slot number"}}},"Communication(verb: string, message: string)":{commandId:"communication",name:"Communication Command",category:"communication",icon:"üí¨",description:"Send message to chat channel",parameters:{verb:{type:"select",options:["say","team","zone","tell"],default:"say",label:"Channel",help:"Chat channel to send message to"},message:{type:"text",default:"",placeholder:"Enter your message...",label:"Message",help:"Message text to send"}}},"Target(entityName: string)":{commandId:"target_entity",name:"Target Entity",category:"targeting",icon:"üéØ",description:"Target specific entity by name",parameters:{entityName:{type:"text",default:"",placeholder:"Entity name...",label:"Entity Name",help:"Name of entity to target"}}},"VFXExclusion(effects: string)":{commandId:"vfx_exclusion",name:"VFX Exclusion List",category:"vfx",icon:"‚ú®",description:"Set visual effects exclusion list",parameters:{effects:{type:"text",default:"",placeholder:"Fx_Explosion,Fx_Beam,Fx_Particle...",label:"Effects List",help:"Comma-separated list of effects to exclude"}}},"VFXExclusionAlias(aliasName: string)":{commandId:"vfx_exclusion_alias",name:"VFX Exclusion Alias",category:"vfx",icon:"‚ú®",description:"Use predefined VFX exclusion alias",parameters:{aliasName:{type:"text",default:"",placeholder:"LowVFX, NoParticles, etc...",label:"Alias Name",help:"Name of predefined VFX exclusion alias"}}},"VFXExclusionMaster()":{commandId:"vfx_exclusion_master",name:"VFX Exclusion Master Alias",category:"vfx",icon:"‚ú®",description:"Combined space and ground VFX suppression alias",parameters:{}},"PowerExec(powerName: string)":{commandId:"power_exec",name:"Execute Power",category:"power",icon:"üîã",description:"Execute specific power by name",parameters:{powerName:{type:"text",default:"",placeholder:"Power name...",label:"Power Name",help:"Name of power to execute"}}},"StaticCombat()":{commandId:"static_combat",name:"Combat Command",category:"combat",icon:"üî•",description:"Static combat command",parameters:{commandName:{type:"hidden",default:"",label:"Command Name"}}},"StaticTargeting()":{commandId:"static_targeting",name:"Targeting Command",category:"targeting",icon:"üéØ",description:"Static targeting command",parameters:{commandName:{type:"hidden",default:"",label:"Command Name"}}}};function Wt(e){return Jt[e]||null}const Xt=Vt.createStandalone(),Ht=(()=>{const e=function(){const e=new Set;return Object.values(Xt.signatures).forEach(t=>{"vfx"===(t.category||"").toLowerCase()||(t.baseCommand&&e.add(t.baseCommand.toLowerCase()),Array.isArray(t.patterns)&&t.patterns.forEach(t=>{const i=t.regex?.source?.match(/^\^\(([^)]+)\)/);i&&i[1].split("|").forEach(t=>e.add(t.toLowerCase()))}))}),e}();return Object.values(Jt).forEach(t=>{(t.parameters?.command_type?.options||t.parameters?.verb?.options||[]).forEach(t=>e.add(t.toLowerCase()))}),e})(),Zt=/^[A-Za-z][A-Za-z0-9_]*$/;function Yt(e=""){return Zt.test(e)}function Qt(e=""){return!!Yt(e)&&!Ht.has(e.toLowerCase())}var ei=Object.freeze({__proto__:null,generateBindToAliasName:function(e,t,i=null){const n=(e||"space").toLowerCase().replace(/[^a-z0-9]/g,"");let a=(t||"").toLowerCase();const s={"[":"leftbracket","]":"rightbracket","(":"leftparen",")":"rightparen","{":"leftbrace","}":"rightbrace","<":"less",">":"greater","=":"equals","-":"minus",Ie:"underscore","\\":"backslash","/":"slash","|":"pipe","`":"backtick","~":"tilde","!":"exclamation","@":"at","#":"hash",$:"dollar","%":"percent","^":"caret","&":"ampersand","*":"asterisk","?":"question",":":"colon",";":"semicolon",'"':"quote","'":"apostrophe",",":"comma",".":"period"};for(const[e,t]of Object.entries(s)){const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");a=a.replace(new RegExp(i,"g"),t)}if(a=a.replace(/[^a-z0-9_]/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"),!a)return null;/^[0-9]/.test(a)&&(a=`k${a}`);let o="";i&&"Primary Bindset"!==i&&(o=i.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"));const r=o?`sto_kb_${n}_${o}_${a}`:`sto_kb_${n}_${a}`;return Yt(r)?r:null},isAliasNameAllowed:Qt,isAliasNamePatternValid:Yt});class ti extends vt{constructor({eventBus:e=c,modalManager:t=null,confirmDialog:i=null,document:n=("undefined"!=typeof window?window.document:void 0),i18n:a}={}){super(e),this.componentName="AliasBrowserUI",this.modalManager=t,this.confirmDialog=i||("undefined"!=typeof window?window.confirmDialog:null),this.document=n,this.i18n=a}async onInit(){this.Ae=null,this.setupEventListeners(),this.eventBus.on("aliases-changed",()=>{this.render()}),this.eventBus.on("alias-selected",e=>{this.Ae=e.name,this.render()}),this.addEventListener("profile:switched",({profileId:e,environment:t}={})=>{this.Ae=null,this.render()}),this.eventBus.on("environment:changed",(e={})=>{const t="string"==typeof e?e:e.environment||e.newMode||e.mode;this.toggleVisibility(t)}),await this.render()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("addAliasChainBtn","click","alias-chain-add",()=>{this.createAliasModal()}),this.onDom("deleteAliasChainBtn","click","alias-chain-delete",()=>{this.Ae&&this.confirmDeleteAlias(this.Ae)}),this.onDom("duplicateAliasChainBtn","click","alias-chain-duplicate",()=>{this.Ae&&this.duplicateAlias(this.Ae)}),this.onDomDebounced("aliasFilter","input","alias-filter",e=>{this.filterAliases(e.target.value)},250),this.onDom("aliasFilter","keydown","alias-filter-key",e=>{if("Escape"===e.key){const t=e.target;t.value="",t.classList.remove("expanded"),this.filterAliases("")}else if("Enter"===e.key){const t=e.target;t.classList.remove("expanded"),t.blur()}}),this.onDom("showAllAliasesBtn","click","alias-show-all",()=>{const e=this.document.getElementById("aliasFilter");e&&(e.value=""),this.filterAliases("")}),this.onDom("aliasSearchBtn","click","alias-search-toggle",()=>{this.toggleAliasSearch()}))}async confirmDeleteAlias(e){if(!e||!this.confirmDialog)return;const t=this.i18n.t("confirm_delete_alias",{aliasName:e}),i=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(t,i,"danger","aliasDelete")){const t=await this.request("alias:delete",{name:e});if(t?.success){const i=this.i18n.t(t?.message||"alias_deleted",{name:e});this.showToast(i,"success")}else{const i=(t?.params||{}).reason||"Unknown error",n=this.i18n.t(t?.error||"failed_to_delete_alias",{name:e,reason:i});this.showToast(n,"error")}}}async duplicateAlias(e){if(!e||!this.modalManager)return;let t=this.cache.aliases;if(!t||0===Object.keys(t).length){const e=await this.request("alias:get-all")||{};t=e.aliases||e||{},this.cache.aliases=t}const i=function(e,t={}){let i=`${e}_copy`,n=i,a=1;for(;t[n];)n=`${i}${a}`,a++;return n}(e,t),n=this.document.getElementById("aliasDuplicateModal");if(!n)return;const a=n.querySelector("#duplicateAliasNameInput"),s=n.querySelector("#confirmDuplicateAliasBtn"),o=n.querySelector("#duplicateAliasValidation"),r=()=>{const e=(a.value||"").trim(),i=t[e];let n=null;e&&Yt(e)?Qt(e)?i&&(n="alias_name_in_use"):n="reserved_command_name":n="invalid_alias_name",o.textContent=n?this.i18n.t(n):"";const r=!!n;o.style.display=r?"":"none",s.disabled=r};a.value=i,o.style.display="none";const c=()=>r();a.removeEventListener("input",c),a.addEventListener("input",c),s.onclick=async()=>{const i=a.value.trim();if(!i||t[i])return;this.modalManager?.hide?.("aliasDuplicateModal");const n=await this.request("alias:duplicate-with-name",{sourceName:e,newName:i});if(n?.success){const a=this.i18n.t(n?.message||"alias_duplicated",{from:e,to:i});this.showToast(a,"success"),this.cache.aliases={...t,[i]:JSON.parse(JSON.stringify(t[e]))},this.render().catch(()=>{})}else{const t=(n?.params||{}).reason||"Unknown error",i=this.i18n.t(n?.error||"failed_to_duplicate_alias",{sourceName:e,reason:t});this.showToast(i,"error")}},this.modalManager.show("aliasDuplicateModal"),r()}async render(){const e=this.document.getElementById("aliasGrid");if(!e)return;const t=await this.request("alias:get-all"),i=t&&t.aliases?t.aliases:t||{};this.cache.aliases=i;const n=Object.entries(i);0!==n.length?(e.classList.remove("categorized"),e.innerHTML=n.map(([e,t])=>this.createAliasElement(e,t)).join(""),"function"==typeof e.querySelectorAll&&e.querySelectorAll(".alias-item").forEach(e=>{this.onDom(e,"click","alias-item-click",async()=>{await this.request("alias:select",{aliasName:e.dataset.alias}),this.emit("alias-browser/alias-clicked",{name:e.dataset.alias})})})):e.innerHTML=`\n        <div class="empty-state">\n          <i class="fas fa-mask"></i>\n          <h4 data-i18n="no_aliases_defined">${this.i18n.t("no_aliases_defined")}</h4>\n          <p data-i18n="create_alias_to_get_started">${this.i18n.t("create_alias_to_get_started")}</p>\n        </div>`}createAliasElement(e,t){let i=0;Array.isArray(t.commands)?i=t.commands.filter(e=>{if(!e)return!1;if("string"==typeof e)return e.trim().length>0;if("object"==typeof e&&e.command){const t=e.command;return t&&"string"==typeof t&&t.trim().length>0}return!1}).length:"string"==typeof t.commands&&t.commands.trim()&&(i=t.commands.trim().split(/\s*\$\$/).length);const n=(this.Ae||null)===e,a=t.description||"";return`\n      <div class="alias-item ${n?"active":""}" data-alias="${e}" data-length="${e.length<=8?"short":e.length<=12?"medium":e.length<=16?"long":"extra-long"}" title="${a}">\n        <div class="alias-name">${e}</div>\n        <div class="alias-command-count">${i} <span data-i18n="${1===i?"command_singular":"commands"}">${this.i18n.t(1===i?"command_singular":"commands")}</span></div>\n      </div>`}toggleVisibility(e){const t=this.document.getElementById("aliasSelectorContainer")||this.document.getElementById("aliasGrid")?.parentElement?.parentElement;if(!t)return;const i="alias"===e;t.style.display=i?"":"none"}handleInitialState(e,t){if(t&&(t.environment||t.currentEnvironment)){const i=t.environment||t.currentEnvironment;console.log("[AliasBrowserUI] handleInitialState from",e,"environment:",i),this.toggleVisibility(i)}}async createAliasModal(){if(!this.modalManager)return;const e=await this.request("alias:get-all"),t=this.document.getElementById("aliasCreationModal");if(!t)return;const i=t.querySelector("#newAliasNameInput"),n=t.querySelector("#confirmCreateAliasBtn"),a=t.querySelector("#createAliasValidation"),s=()=>{const t=(i.value||"").trim();let s=null;t&&Yt(t)?Qt(t)?e[t]&&(s="alias_name_in_use"):s="reserved_command_name":s="invalid_alias_name",a.textContent=s?this.i18n.t(s):"";const o=!!s;a.style.display=o?"":"none",n.disabled=o};i.value="",a.style.display="none",i.removeEventListener("input",s),i.addEventListener("input",s),n.onclick=null,n.onclick=async()=>{const e=i.value.trim();if(!e)return;if(this.modalManager.hide("aliasCreationModal"),!await this.request("alias:validate-name",{name:e}))return void this.showToast("Invalid alias name","error");const t=await this.request("alias-browser:create",{name:e,description:""});if(t?.success){const i=this.i18n.t(t?.message||"alias_created",{name:e});this.showToast(i,"success")}else if(t?.error){const e=this.i18n.t(t.error,t.params);this.showToast(e,"error")}else this.showToast("Failed to create alias","error")},this.modalManager.show("aliasCreationModal"),s()}filterAliases(e=""){const t=(e||"").toString().toLowerCase(),i=this.document.getElementById("aliasGrid");if(!i)return;i.querySelectorAll(".alias-item").forEach(e=>{const i=(e.dataset.alias||"").toLowerCase(),n=!t||i.includes(t);e.style.display=n?"flex":"none"});const n=this.document.getElementById("aliasSearchBtn");if(n){const e=!!t;n.classList.toggle("active",e),n.setAttribute("aria-pressed",e)}}toggleAliasSearch(){const e=this.document||("undefined"!=typeof window?window.document:void 0);if(!e)return;const t=e.getElementById("aliasFilter");t&&(t.classList.toggle("expanded")?t.focus():t.blur())}}class ii extends vt{constructor({eventBus:e,confirmDialog:t=null,document:i=("undefined"!=typeof window?window.document:void 0),i18n:n}={}){super(e),this.componentName="HeaderMenuUI",this.document=i,this.confirmDialog=t||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=n}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.onDom("settingsBtn","click","settings-toggle",()=>{this.toggleSettingsMenu()}),this.onDom("importMenuBtn","click","import-toggle",()=>{this.toggleImportMenu()}),this.onDom("backupMenuBtn","click","backup-toggle",()=>{this.toggleBackupMenu()}),this.onDom("languageMenuBtn","click","language-toggle",()=>{this.toggleLanguageMenu()}),this.onDom("vertigoBtn","click","vfx-open",()=>{this.emit("vfx:show-modal")}),this.onDom("fileExplorerBtn","click","file-explorer-open",()=>{this.emit("file-explorer:open")}),this.onDom("syncNowBtn","click","sync-now",()=>{this.emit("sync:sync-now")}),this.onDom("preferencesBtn","click","preferences-open",()=>{this.emit("preferences:show")}),this.onDom("aboutBtn","click","about-open",()=>{this.emit("about:show")}),this.onDom(this.document,"click","document-click-outside",e=>{e.target.closest(".dropdown")||this.document.querySelectorAll(".dropdown.active").forEach(e=>{e.classList.remove("active")})}),this.onDom("openProjectBtn","click","project-open",()=>{this.emit("project:open")}),this.onDom("saveProjectBtn","click","project-save",()=>{this.emit("project:save")}),this.onDom("exportKeybindsBtn","click","keybinds-export",()=>{this.emit("keybinds:export")}),this.onDom("importKeybindsBtn","click","keybinds-import",()=>{this.emit("keybinds:import")}),this.onDom("importAliasesBtn","click","aliases-import",()=>{this.emit("aliases:import")}),this.onDom("importKbfBtn","click","kbf-import",()=>{this.emit("keybinds:kbf-import")}),this.onDom("loadDefaultDataBtn","click","data-load-default",()=>{this.emit("data:load-default")}),this.onDom("resetAppBtn","click","app-reset",()=>{this.confirmResetApp()}),this.onDom("[data-lang]","click","language-change",e=>{const t=e.target.closest("[data-lang]"),i=t?t.getAttribute("data-lang"):null;i&&this.emit("language:change",{language:i})}),this.addEventListener("language:changed",({language:e})=>{this.showToast(this.i18n.t("language_updated"),"success")}),this.onDom("themeToggleBtn","click","theme-toggle",()=>{this.emit("theme:toggle")}))}toggleSettingsMenu(){this.toggleDropdown("settingsBtn")}toggleImportMenu(){this.toggleDropdown("importMenuBtn")}toggleBackupMenu(){this.toggleDropdown("backupMenuBtn")}toggleLanguageMenu(){this.toggleDropdown("languageMenuBtn")}toggleDropdown(e){const t=this.document.getElementById(e);if(!t)return;const i=t.closest(".dropdown");i&&(this.document.querySelectorAll(".dropdown.active").forEach(e=>{e!==i&&e.classList.remove("active")}),i.classList.toggle("active"))}async confirmResetApp(){if(!this.confirmDialog)return;const e=this.i18n.t("confirm_reset_application"),t=this.i18n.t("confirm_reset_app");await this.confirmDialog.confirm(e,t,"danger","resetApplication")&&this.emit("app:reset-confirmed")}onDestroy(){}}class ni extends vt{constructor({eventBus:e,document:t=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="AboutModalUI",this.document=t}onInit(){this.setupEventListeners(),this.populateAboutContent()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.eventBus.on("about:show",()=>{this.showAboutModal()}),this.eventBus.on("modal:regenerated",({modalId:e})=>{"aboutModal"===e&&this.populateAboutContent()}))}showAboutModal(){this.populateAboutContent(),this.emit("modal:show",{modalId:"aboutModal"})}populateAboutContent(){const t=this.document.getElementById("aboutVersion");t&&(t.textContent=` ${e}`)}}class ai extends vt{constructor({eventBus:e,document:t=("undefined"!=typeof window?window.document:void 0),i18n:i,modalManager:n=null}={}){super(e),this.componentName="ImportUI",this.document=t,this.i18n=i,this.modalManager=n,this.currentImportModal=null,this.currentBindsetSelectionModal=null,this.currentEnhancedBindsetSelectionModal=null}onInit(){this.addEventListener("keybinds:import",()=>this.openFileDialog("keybinds")),this.addEventListener("aliases:import",()=>this.openFileDialog("aliases")),this.addEventListener("keybinds:kbf-import",()=>this.openFileDialog("kbf"))}async openFileDialog(e){const t=this.document.createElement("input");t.type="file",t.accept="kbf"===e?".kbf,.txt":".txt",t.style.display="none",this.document.body.appendChild(t),t.addEventListener("change",async i=>{if(!i.target.files||0===i.target.files.length)return;const n=i.target.files[0],a=new FileReader;a.onload=async i=>{try{const n=i.target.result,a=await this.request("data:get-current-state"),s=a.currentProfile;let o;if("keybinds"===e){const e=await this.promptEnvironment(a.currentEnvironment||"space","keybinds");if(!e)return;if("overwrite_all"===e.strategy){const t=this.storage?.getProfile?.(s),i=Object.keys(t?.builds?.[e.environment]?.keys||{}).length;if(i>0&&!await this.showOverwriteConfirmation("keys",i,0,e.environment))return}o=await this.request("import:keybind-file",{content:n,profileId:s,environment:e.environment,strategy:e.strategy})}else if("kbf"===e){const e=await this.request("preferences:get-settings"),i=e?.bindsetsEnabled??!0,r=await this.promptEnvironment(a.currentEnvironment||"space","kbf",{bindsetsEnabled:i});if(!r)return;const c=await this.request("parse-kbf-file",{content:n,environment:r.environment});if(!c.valid){const e=this.i18n.t("invalid_kbf_file_format");return this.showToast(e,"error"),void this.document.body.removeChild(t)}const l=await this.promptEnhancedBindsetSelection(c);if(!l)return void this.document.body.removeChild(t);o=await this.request("import:kbf-file",{content:n,profileId:s,environment:r.environment,strategy:r.strategy,configuration:l})}else{const e=await this.promptAliasStrategy();if(!e)return;if("overwrite_all"===e){const e=this.storage?.getProfile?.(s),t=Object.keys(e?.aliases||{}).length;if(t>0&&!await this.showOverwriteConfirmation("aliases",t,0))return}o=await this.request("import:alias-file",{content:n,profileId:s,strategy:e})}if(o?.success){let t;if("kbf"===e)t=this.getKBFSuccessMessage(o);else{let e;const i=o.imported?.keys||o.imported?.aliases||0,n=o.skipped||0,a=o.overwritten||0,s=o.cleared||0;s>0?(e="import_result_overwrite_all",t=this.i18n.t(e,{imported:i,cleared:s})):a>0?(e="import_result_overwrote",t=this.i18n.t(e,{imported:i,overwritten:a})):n>0?(e="import_result_skipped",t=this.i18n.t(e,{imported:i,skipped:n})):t=this.i18n.t(o?.message,{count:i})}this.showToast(t,"success")}else{let t;t="kbf"===e?this.getKBFErrorMessage(o):this.i18n.t(o?.error,o?.params),this.showToast(t,"error")}}catch(e){console.error("[ImportUI] Failed to import file:",e)}this.document.body.removeChild(t)},a.readAsText(n)}),t.click()}promptEnvironment(e="space",t="keybinds",i={}){return new Promise(n=>{const a=this.createImportModal(e,t,i),s="importModal";a.id=s,this.document.body.appendChild(a),this.currentImportModal={defaultEnv:e,importType:t,additionalContext:i,resolve:n,modalElement:a},this.modalManager?.registerRegenerateCallback(s,()=>{this.regenerateImportModal()});const o=e=>{const t=a.querySelector('input[name="import-strategy"]:checked'),i=t?t.value:"merge_keep";this.modalManager?.unregisterRegenerateCallback(s),this.currentImportModal=null,this.modalManager?.hide(s),a&&a.parentNode&&a.parentNode.removeChild(a),n(e?{environment:e,strategy:i}:null)};this.onDom(".import-space","click","import-dialog-space",()=>o("space")),this.onDom(".import-ground","click","import-dialog-ground",()=>o("ground")),this.onDom(".import-cancel","click","import-dialog-cancel",()=>o(null)),requestAnimationFrame(()=>{this.modalManager?.show(s)})})}createImportModal(e,t="keybinds",i={}){const n=this.document.createElement("div");n.className="modal import-modal";const a=this.i18n.t("import_environment"),s=this.i18n.t("import_environment_question"),o=this.i18n.t("import_strategy"),r=this.i18n.t("merge_keep_existing"),c=this.i18n.t("merge_overwrite_existing"),l=this.i18n.t("overwrite_all"),d=this.i18n.t("space"),m=this.i18n.t("ground"),h=this.i18n.t("cancel");let u="";if("keybinds"===t)u=this.i18n.t("overwrite_all_description_keybinds");else if("kbf"===t){const{bindsetsEnabled:e}=i;u=!1===e?this.i18n.t("overwrite_all_description_kbf_primary"):this.i18n.t("overwrite_all_description_kbf_bindsets")}else"aliases"===t&&(u=this.i18n.t("overwrite_all_description_aliases"));return n.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-file-import"></i>\n            ${a}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${s}</p>\n\n          <div class="import-strategy-section">\n            <label class="import-strategy-label">${o}</label>\n            <div class="import-strategy-options">\n              <label class="import-strategy-option">\n                <input type="radio" name="import-strategy" value="merge_keep" checked>\n                <span>${r}</span>\n              </label>\n              <label class="import-strategy-option">\n                <input type="radio" name="import-strategy" value="merge_overwrite">\n                <span>${c}</span>\n              </label>\n              <label class="import-strategy-option">\n                <input type="radio" name="import-strategy" value="overwrite_all">\n                <span>${l}</span>\n                ${u?`<div class="strategy-description">${u}</div>`:""}\n              </label>\n            </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary import-space ${"space"===e?"btn-primary":"btn-secondary"}">${d}</button>\n          <button class="btn btn-primary import-ground ${"ground"===e?"btn-primary":"btn-secondary"}">${m}</button>\n          <button class="btn btn-secondary import-cancel">${h}</button>\n        </div>\n      </div>\n    `,n}regenerateImportModal(){if(!this.currentImportModal)return;const{defaultEnv:e,importType:t,additionalContext:i,modalElement:n}=this.currentImportModal,a=this.createImportModal(e,t,i);a.id="importModal",n.replaceWith(a),this.currentImportModal.modalElement=a;const s=e=>{const{resolve:t}=this.currentImportModal,i=a.querySelector('input[name="import-strategy"]:checked'),n=i?i.value:"merge_keep";this.modalManager?.unregisterRegenerateCallback("importModal"),this.currentImportModal=null,this.modalManager?.hide("importModal"),a&&a.parentNode&&a.parentNode.removeChild(a),t(e?{environment:e,strategy:n}:null)};this.onDom(".import-space","click","import-dialog-regen-space",()=>s("space")),this.onDom(".import-ground","click","import-dialog-regen-ground",()=>s("ground")),this.onDom(".import-cancel","click","import-dialog-regen-cancel",()=>s(null))}promptAliasStrategy(){return new Promise(e=>{const t=this.createAliasStrategyModal(),i="aliasStrategyModal";t.id=i,this.document.body.appendChild(t),this.currentAliasStrategyModal={resolve:e,modalElement:t},this.modalManager?.registerRegenerateCallback(i,()=>{this.regenerateAliasStrategyModal()});const n=n=>{this.modalManager?.unregisterRegenerateCallback(i),this.currentAliasStrategyModal=null,this.modalManager?.hide(i),t&&t.parentNode&&t.parentNode.removeChild(t),e(n)};this.onDom(".alias-strategy-confirm","click","alias-strategy-confirm",()=>{const e=t.querySelector('input[name="alias-import-strategy"]:checked'),i=e?e.value:"merge_keep";n(i)}),this.onDom(".alias-strategy-cancel","click","alias-strategy-cancel",()=>n(null)),requestAnimationFrame(()=>{this.modalManager?.show(i)})})}createAliasStrategyModal(){const e=this.document.createElement("div");e.className="modal import-modal";const t=this.i18n.t("import_strategy"),i=this.i18n.t("import_strategy"),n=this.i18n.t("merge_keep_existing"),a=this.i18n.t("merge_overwrite_existing"),s=this.i18n.t("overwrite_all"),o=this.i18n.t("overwrite_all_description_aliases"),r=this.i18n.t("import"),c=this.i18n.t("cancel");return e.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-file-import"></i>\n            ${t}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <label class="import-strategy-label">${i}</label>\n          <div class="import-strategy-options">\n            <label class="import-strategy-option">\n              <input type="radio" name="alias-import-strategy" value="merge_keep" checked>\n              <span>${n}</span>\n            </label>\n            <label class="import-strategy-option">\n              <input type="radio" name="alias-import-strategy" value="merge_overwrite">\n              <span>${a}</span>\n            </label>\n            <label class="import-strategy-option">\n              <input type="radio" name="alias-import-strategy" value="overwrite_all">\n              <span>${s}</span>\n              <div class="strategy-description">${o}</div>\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary alias-strategy-confirm">${r}</button>\n          <button class="btn btn-secondary alias-strategy-cancel">${c}</button>\n        </div>\n      </div>\n    `,e}regenerateAliasStrategyModal(){if(!this.currentAliasStrategyModal)return;const{modalElement:e}=this.currentAliasStrategyModal,t=this.createAliasStrategyModal();t.id="aliasStrategyModal",e.replaceWith(t),this.currentAliasStrategyModal.modalElement=t;const i=e=>{const{resolve:i}=this.currentAliasStrategyModal;this.modalManager?.unregisterRegenerateCallback("aliasStrategyModal"),this.currentAliasStrategyModal=null,this.modalManager?.hide("aliasStrategyModal"),t&&t.parentNode&&t.parentNode.removeChild(t),i(e)};this.onDom(".alias-strategy-confirm","click","alias-strategy-regen-confirm",()=>{const e=t.querySelector('input[name="alias-import-strategy"]:checked'),n=e?e.value:"merge_keep";i(n)}),this.onDom(".alias-strategy-cancel","click","alias-strategy-regen-cancel",()=>i(null))}async showOverwriteConfirmation(e,t,i,n=null,a=null){return new Promise(s=>{const o=this.createOverwriteConfirmationModal(e,t,i,n,a),r="overwriteConfirmModal";o.id=r,this.document.body.appendChild(o),this.currentOverwriteConfirmModal={resolve:s,modalElement:o,customMessage:a},this.modalManager?.registerRegenerateCallback(r,()=>{this.regenerateOverwriteConfirmationModal(e,t,i,n,a)});const c=e=>{this.modalManager?.unregisterRegenerateCallback(r),this.currentOverwriteConfirmModal=null,this.modalManager?.hide(r),o&&o.parentNode&&o.parentNode.removeChild(o),s(e)};this.onDom(".overwrite-confirm-yes","click","overwrite-confirm-yes",()=>c(!0)),this.onDom(".overwrite-confirm-no","click","overwrite-confirm-no",()=>c(!1)),requestAnimationFrame(()=>{this.modalManager?.show(r)})})}createOverwriteConfirmationModal(e,t,i,n,a=null){const s=this.document.createElement("div");s.className="modal import-modal";const o=this.i18n.t("overwrite_confirm_title");let r;r=a||("keys"===e&&n?this.i18n.t("overwrite_confirm_body_keys",{environment:n}):this.i18n.t("overwrite_confirm_body_aliases"));const c=a?"":this.i18n.t("overwrite_counts",{current:t,incoming:i}),l=this.i18n.t("overwrite_all_action"),d=this.i18n.t("cancel");return s.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-exclamation-triangle"></i>\n            ${o}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${r}</p>\n          ${c?`<p><strong>${c}</strong></p>`:""}\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-danger overwrite-confirm-yes">${l}</button>\n          <button class="btn btn-secondary overwrite-confirm-no">${d}</button>\n        </div>\n      </div>\n    `,s}regenerateOverwriteConfirmationModal(e,t,i,n,a=null){if(!this.currentOverwriteConfirmModal)return;const{modalElement:s,customMessage:o}=this.currentOverwriteConfirmModal,r=this.createOverwriteConfirmationModal(e,t,i,n,o);r.id="overwriteConfirmModal",s.replaceWith(r),this.currentOverwriteConfirmModal.modalElement=r;const c=e=>{const{resolve:t}=this.currentOverwriteConfirmModal;this.modalManager?.unregisterRegenerateCallback("overwriteConfirmModal"),this.currentOverwriteConfirmModal=null,this.modalManager?.hide("overwriteConfirmModal"),r&&r.parentNode&&r.parentNode.removeChild(r),t(e)};this.onDom(".overwrite-confirm-yes","click","overwrite-confirm-regen-yes",()=>c(!0)),this.onDom(".overwrite-confirm-no","click","overwrite-confirm-regen-no",()=>c(!1))}promptBindsetSelection(e,t,i){return new Promise(n=>{const a=this.createBindsetSelectionModal(e,t,i),s="bindsetSelectionModal";a.id=s,this.document.body.appendChild(a),this.currentBindsetSelectionModal={bindsetNames:e,hasMasterBindset:t,masterDisplayName:i,resolve:n,modalElement:a},this.modalManager?.registerRegenerateCallback(s,()=>{this.regenerateBindsetSelectionModal()});const o=e=>{this.modalManager?.unregisterRegenerateCallback(s),this.currentBindsetSelectionModal=null,this.modalManager?.hide(s),a&&a.parentNode&&a.parentNode.removeChild(a),n(e)};this.onDom(".bindset-confirm","click","bindset-selection-confirm",()=>{const e=[];a.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{e.push(t.value)}),o(e)}),this.onDom(".bindset-cancel","click","bindset-selection-cancel",()=>o(null)),requestAnimationFrame(()=>{this.modalManager?.show(s)})})}createBindsetSelectionModal(e,t,i){const n=this.document.createElement("div");n.className="modal import-modal";const a=this.i18n.t("select_bindsets_to_import"),s=this.i18n.t("select_bindsets_to_import_question"),o=this.i18n.t("import_selected"),r=this.i18n.t("cancel");let c="";return e.forEach(e=>{const t="master"===e.toLowerCase()&&i||e,n="master"===e.toLowerCase()?"checked":"";c+=`\n        <div class="bindset-option">\n          <input type="checkbox" id="bindset_${e}" name="bindsets" value="${e}" ${n}>\n          <label for="bindset_${e}">${t}</label>\n        </div>\n      `}),n.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-layer-group"></i>\n            ${a}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${s}</p>\n          <div class="bindset-list">\n            ${c}\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary bindset-confirm">${o}</button>\n          <button class="btn btn-secondary bindset-cancel">${r}</button>\n        </div>\n      </div>\n    `,n}regenerateBindsetSelectionModal(){if(!this.currentBindsetSelectionModal)return;const{bindsetNames:e,hasMasterBindset:t,masterDisplayName:i,modalElement:n}=this.currentBindsetSelectionModal,a=this.createBindsetSelectionModal(e,t,i);a.id="bindsetSelectionModal",n.replaceWith(a),this.currentBindsetSelectionModal.modalElement=a;const s=e=>{const{resolve:t}=this.currentBindsetSelectionModal;this.modalManager?.unregisterRegenerateCallback("bindsetSelectionModal"),this.currentBindsetSelectionModal=null,this.modalManager?.hide("bindsetSelectionModal"),a&&a.parentNode&&a.parentNode.removeChild(a),t(e)};this.onDom(".bindset-confirm","click","bindset-selection-regen-confirm",()=>{const e=[];a.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{e.push(t.value)}),s(e)}),this.onDom(".bindset-cancel","click","bindset-selection-regen-cancel",()=>s(null))}getKBFSuccessMessage(e){const{imported:t,skipped:i,overwritten:n,cleared:a,stats:s,errors:o,warnings:r}=e;let c=this.i18n.t("kbf_import_completed",{bindsets:t?.bindsets||0,keys:t?.keys||0,aliases:t?.aliases||0});const l=[];a>0?l.push(this.i18n.t("import_result_overwrite_all",{imported:t?.keys||0,cleared:a})):n>0?l.push(this.i18n.t("import_result_overwrote",{imported:t?.keys||0,overwritten:n})):i>0&&l.push(this.i18n.t("import_result_skipped",{imported:t?.keys||0,skipped:i})),s?.skippedActivities>0&&l.push(this.i18n.t("kbf_import_skipped_activities",{count:s.skippedActivities}));const d=s?.totalErrors||o?.length||0,m=s?.totalWarnings||r?.length||0;if((d>0||m>0)&&(d>0&&l.push(this.i18n.t("kbf_import_errors_encountered",{count:d})),m>0&&l.push(this.i18n.t("kbf_import_warnings_generated",{count:m}))),s?.processingTimeMs){const e=Math.round(s.processingTimeMs/1e3);l.push(this.i18n.t("kbf_import_processing_time",{seconds:e}))}return l.length>0&&(c+="\n"+l.join(" ‚Ä¢ ")),c}async promptEnhancedBindsetSelection(e){return new Promise(async t=>{const i=await this.request("preferences:get-settings");let n;n=i?.bindsetsEnabled??1?this.createEnhancedBindsetSelectionModal(e):this.createSingleBindsetSelectionModal(e);const a="enhancedBindsetSelectionModal";n.id=a,this.document.body.appendChild(n),this.currentEnhancedBindsetSelectionModal={parseResult:e,resolve:t,modalElement:n},this.modalManager?.registerRegenerateCallback(a,()=>{this.regenerateEnhancedBindsetSelectionModal()});const s=e=>{this.modalManager?.unregisterRegenerateCallback(a),this.currentEnhancedBindsetSelectionModal=null,this.modalManager?.hide(a),n&&n.parentNode&&n.parentNode.removeChild(n),t(e)};this.onDom(".enhanced-bindset-confirm","click","enhanced-bindset-selection-confirm",()=>{const t=this.validateBindsetConfiguration(n,e);t&&s(t)}),this.onDom(".single-bindset-confirm","click","single-bindset-selection-confirm",()=>{const t=this.validateSingleBindsetConfiguration(n,e);t&&s(t)}),this.onDom(".enhanced-bindset-cancel","click","enhanced-bindset-selection-cancel",()=>s(null)),this.onDom(".single-bindset-cancel","click","single-bindset-selection-cancel",()=>s(null)),requestAnimationFrame(()=>{this.modalManager?.show(a)})})}createEnhancedBindsetSelectionModal(e){const t=this.document.createElement("div");t.className="modal import-modal enhanced-bindset-selection large-modal";const i=this.i18n.t("configure_kbf_import"),n=this.i18n.t("configure_kbf_import_question"),a=this.i18n.t("import_configured"),s=this.i18n.t("cancel"),{bindsetNames:o,bindsetKeyCounts:r,hasMasterBindset:c,masterDisplayName:l}=e;let d="";return o.forEach(e=>{const t=e,i="master"===e.toLowerCase(),n=i,a=r[e]||0;d+=`\n        <tr class="bindset-row" data-bindset="${e}">\n          <td class="bindset-name-cell">\n            <span class="bindset-name">${t}</span>\n            ${i?'<span class="bindset-indicator primary">Primary</span>':""}\n          </td>\n          <td class="bindset-count-cell">\n            <span class="key-count">${a}</span>\n          </td>\n          <td class="bindset-type-cell" colspan="2">\n            <select class="bindset-mapping-select" data-bindset="${e}">\n              <option value="primary" ${n?"selected":""}>${this.i18n.t("maps_to_primary_bindset")}</option>\n              <option value="mapped" ${n?"":"selected"}>${this.i18n.t("maps_to")}</option>\n              <option value="none">${this.i18n.t("not_mapped")}</option>\n            </select>\n            <div class="bindset-custom-container" style="display: none;">\n              <input type="text" class="bindset-custom-input" data-bindset="${e}"\n                     placeholder="${e}" value="${e}">\n            </div>\n          </td>\n        </tr>\n      `}),t.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-layer-group"></i>\n            ${i}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${n}</p>\n\n          <div class="enhanced-bindset-grid">\n            <table class="bindset-table">\n              <thead>\n                <tr>\n                  <th class="bindset-header">${this.i18n.t("original_bindset_name")}</th>\n                  <th class="bindset-header">${this.i18n.t("key_count")}</th>\n                  <th class="bindset-header">${this.i18n.t("mapping_type")}</th>\n                  <th class="bindset-header">${this.i18n.t("mapping_destination")}</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${d}\n              </tbody>\n            </table>\n          </div>\n\n          <div class="enhanced-preview-section">\n            <h4>${this.i18n.t("import_preview")}</h4>\n            <div id="preview_content" class="preview-content">\n              <p class="preview-placeholder">${this.i18n.t("select_bindsets_for_preview")}</p>\n            </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary enhanced-bindset-confirm">${a}</button>\n          <button class="btn btn-secondary enhanced-bindset-cancel">${s}</button>\n        </div>\n      </div>\n    `,setTimeout(()=>{this.setupPreviewUpdates(t,e)},0),t}createSingleBindsetSelectionModal(e){const t=this.document.createElement("div");t.className="modal import-modal single-bindset-selection medium-modal";const i=this.i18n.t("select_bindset_to_import"),n=this.i18n.t("select_bindset_import_question"),a=this.i18n.t("import_selected"),s=this.i18n.t("cancel"),{bindsetNames:o,bindsetKeyCounts:r,hasMasterBindset:c,masterDisplayName:l}=e;let d="";return o.forEach((e,t)=>{const i=e,n="master"===e.toLowerCase(),a=r[e]||0,s=n||0===t;d+=`\n        <div class="single-bindset-option ${s?"selected":""}" data-bindset="${e}">\n          <label class="single-bindset-label">\n            <input type="radio" name="selectedBindset" value="${e}"\n                   class="single-bindset-radio" data-bindset="${e}"\n                   ${s?"checked":""}>\n\n            <div class="single-bindset-content">\n              <div class="single-bindset-main">\n                <span class="single-bindset-name">${i}</span>\n                ${n?'<span class="single-bindset-badge primary">Primary</span>':""}\n              </div>\n              <div class="single-bindset-meta">\n                <span class="single-bindset-count">${a} keys</span>\n              </div>\n            </div>\n          </label>\n        </div>\n      `}),t.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>\n            <i class="fas fa-layer-group"></i>\n            ${i}\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p>${n}</p>\n\n          <div class="single-bindset-container">\n            ${d}\n          </div>\n\n          <div class="bindset-functionality-info">\n            <div class="info-header">\n              <i class="fas fa-info-circle"></i>\n              <span>${this.i18n.t("reduced_bindset_functionality")}</span>\n            </div>\n            <div class="info-content">\n              <p>${this.i18n.t("reduced_bindset_functionality_description")}</p>\n              <p><strong>${this.i18n.t("enable_full_bindset_functionality")}</strong></p>\n            </div>\n          </div>\n\n          <div class="single-bindset-note">\n            <i class="fas fa-info-circle"></i> ${this.i18n.t("single_bindset_import_note")}\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary single-bindset-confirm">${a}</button>\n          <button class="btn btn-secondary single-bindset-cancel">${s}</button>\n        </div>\n      </div>\n    `,setTimeout(()=>{this.setupSingleBindsetSelection(t)},0),t}setupSingleBindsetSelection(e){if(!e||"function"!=typeof e.querySelectorAll)return;const t=e.querySelectorAll(".single-bindset-option"),i=e.querySelectorAll(".single-bindset-radio");t.forEach(t=>{t.addEventListener("click",()=>{const i=t.dataset.bindset,n=e.querySelector(`.single-bindset-radio[data-bindset="${i}"]`);n&&(n.checked=!0,this.updateSingleBindsetSelection(e))})}),i.forEach(t=>{t.addEventListener("change",()=>{this.updateSingleBindsetSelection(e)})}),this.updateSingleBindsetSelection(e)}updateSingleBindsetSelection(e){const t=e.querySelectorAll(".single-bindset-option");e.querySelectorAll(".single-bindset-radio"),t.forEach(t=>{const i=t.dataset.bindset,n=e.querySelector(`.single-bindset-radio[data-bindset="${i}"]`);n&&n.checked?t.classList.add("selected"):t.classList.remove("selected")})}setupPreviewUpdates(e,t){this.initializeTableStructure(e);const i=()=>{const i=this.validateBindsetConfiguration(e,t),n=e.querySelector("#preview_content");if(i&&i.selectedBindsets.length>0){let e='<div class="preview-table">';i.selectedBindsets.forEach(t=>{const n=t,a=i.bindsetMappings[t],s=i.bindsetRenames[t];let o="";"primary"===a?o=`<span class="mapping-indicator primary">${this.i18n.t("maps_to_primary_bindset")}</span>`:"custom"===a&&(o=`<span class="mapping-indicator custom ${s!==(i.bindsetRenames[t]||t)?"conflict":""}">${this.i18n.t("maps_to")}: ${s}</span>`),e+=`\n            <div class="preview-row">\n              <span class="preview-original">${n}</span>\n              <span class="preview-arrow">‚Üí</span>\n              ${o}\n            </div>\n          `}),e+="</div>",n.innerHTML=e}else n.innerHTML=`<p class="preview-placeholder">${this.i18n.t("select_bindsets_for_preview")}</p>`};if(!e||"function"!=typeof e.querySelectorAll)return;const n=e.querySelectorAll(".bindset-mapping-select"),a=e.querySelectorAll(".bindset-custom-input");n.forEach(t=>{t.addEventListener("change",t=>{const n=t.target.dataset.bindset,a=e.querySelector(`tr[data-bindset="${n}"]`),s=a.querySelector(".bindset-type-cell"),o=e.querySelector(`.bindset-custom-container[data-bindset="${n}"]`)||e.querySelector(`.bindset-type-cell[data-bindset="${n}"] .bindset-custom-container`),r=e.querySelector(`.bindset-custom-input[data-bindset="${n}"]`);"mapped"===t.target.value?this.addThirdColumnCell(a,s,r,n):this.removeThirdColumnCell(a,s,o,r),i()})}),a.forEach(e=>{e.addEventListener("input",i)}),i()}initializeTableStructure(e){e&&"function"==typeof e.querySelectorAll&&e.querySelectorAll(".bindset-mapping-select").forEach(t=>{const i=t.dataset.bindset,n=e.querySelector(`tr[data-bindset="${i}"]`);if(!n)return;const a=n.querySelector(".bindset-type-cell"),s=e.querySelector(`.bindset-custom-container[data-bindset="${i}"]`)||e.querySelector(`.bindset-type-cell[data-bindset="${i}"] .bindset-custom-container`),o=e.querySelector(`.bindset-custom-input[data-bindset="${i}"]`);"mapped"===t.value?n.querySelector(".bindset-custom-cell")||this.addThirdColumnCell(n,a,o,i):n.querySelector(".bindset-custom-cell")&&this.removeThirdColumnCell(n,a,s,o)})}addThirdColumnCell(e,t,i,n){if(e.querySelector(".bindset-custom-cell"))return;t.removeAttribute("colspan");const a=this.document.createElement("td");a.className="bindset-custom-cell",a.setAttribute("data-bindset",n);const s=i.cloneNode(!0);s.style.display="block",a.appendChild(s),e.appendChild(a);const o=t.querySelector(".bindset-custom-container");o&&(o.style.display="none"),s.focus()}removeThirdColumnCell(e,t,i,n){const a=e.querySelector(".bindset-custom-cell");if(a){const t=a.querySelector(".bindset-custom-input");t&&(n.value=t.value),e.removeChild(a)}t.setAttribute("colspan","2"),i&&(i.style.display="none"),n.style.display="none"}getPrimaryMappingPreview(e){switch(e.type){case"master-to-primary":return`<span class="mapping-indicator primary">${this.i18n.t("mapped_to_primary")}</span>`;case"new-primary":return`<span class="mapping-indicator new-primary">${this.i18n.t("mapped_to_new_primary",{name:e.primaryBindsetName||"Custom Primary"})}</span>`;case"skip-primary":return`<span class="mapping-indicator skip-primary">${this.i18n.t("mapped_to_named")}</span>`;default:return""}}resolveBindsetName(e,t){if(!t||!t.includes(e))return e;let i=1,n=`${e} (${i})`;for(;t.includes(n);)i++,n=`${e} (${i})`;return n}validateBindsetConfiguration(e,t){const i={selectedBindsets:[],bindsetMappings:{},bindsetRenames:{}};return e.querySelectorAll(".bindset-mapping-select").forEach(n=>{const a=n.dataset.bindset,s=n.value;if("none"!==s)if(i.selectedBindsets.push(a),"mapped"===s){let n=e.querySelector(`.bindset-custom-cell[data-bindset="${a}"] .bindset-custom-input`)||e.querySelector(`.bindset-custom-input[data-bindset="${a}"]`);const s=n?.value?.trim(),o=this.resolveBindsetName(s||a,t.existingBindsets);i.bindsetMappings[a]="custom",i.bindsetRenames[a]=o}else i.bindsetMappings[a]="primary"}),i.selectedBindsets.length>0?i:null}validateSingleBindsetConfiguration(e,t){const i=e.querySelector(".single-bindset-radio:checked");if(!i)return null;const n=i.value;return n.toLowerCase(),{selectedBindsets:[n],bindsetMappings:{[n]:"primary"},bindsetRenames:{},singleBindsetMode:!0}}regenerateEnhancedBindsetSelectionModal(){if(!this.currentEnhancedBindsetSelectionModal)return;const{parseResult:e,modalElement:t}=this.currentEnhancedBindsetSelectionModal,i=t.classList.contains("single-bindset-selection");let n;n=i?this.createSingleBindsetSelectionModal(e):this.createEnhancedBindsetSelectionModal(e),n.id="enhancedBindsetSelectionModal",t.replaceWith(n),this.currentEnhancedBindsetSelectionModal.modalElement=n;const a=e=>{const{resolve:t}=this.currentEnhancedBindsetSelectionModal;this.modalManager?.unregisterRegenerateCallback("enhancedBindsetSelectionModal"),this.currentEnhancedBindsetSelectionModal=null,this.modalManager?.hide("enhancedBindsetSelectionModal"),n&&n.parentNode&&n.parentNode.removeChild(n),t(e)};this.onDom(".enhanced-bindset-confirm","click","enhanced-bindset-selection-regen-confirm",()=>{const t=this.validateBindsetConfiguration(n,e);t&&a(t)}),this.onDom(".single-bindset-confirm","click","single-bindset-selection-regen-confirm",()=>{const t=this.validateSingleBindsetConfiguration(n,e);t&&a(t)}),this.onDom(".enhanced-bindset-cancel","click","enhanced-bindset-selection-regen-cancel",()=>a(null)),this.onDom(".single-bindset-cancel","click","single-bindset-selection-regen-cancel",()=>a(null)),setTimeout(()=>{i?this.setupSingleBindsetSelection(n):this.setupPreviewUpdates(n,e)},0)}getKBFErrorMessage(e){const{params:t,errors:i,warnings:n,processedBindsets:a,failedBindsets:s}=e;let o=this.i18n.t(e?.error||"import_failed",t||{});const r=[],c=a?.length||0,l=s?.length||0;(c>0||l>0)&&(c>0&&r.push(this.i18n.t("kbf_import_bindsets_processed",{count:c})),l>0&&r.push(this.i18n.t("kbf_import_bindsets_failed",{count:l})));const d=t?.totalErrors||i?.length||0,m=t?.totalWarnings||n?.length||0;return d>0&&r.push(this.i18n.t("kbf_import_total_errors",{count:d})),m>0&&r.push(this.i18n.t("kbf_import_total_warnings",{count:m})),r.length>0&&(o+="\n"+this.i18n.t("kbf_import_error_summary")+": "+r.join(" ‚Ä¢ ")),o}}class si extends re{constructor({ui:e,eventBus:t}={}){super(t),this.componentName="AliasBrowserService",this.ui=e,this.eventBus&&(this.respond("alias:get-all",()=>this.getAliases()),this.respond("alias-browser:create",({name:e,description:t=""}={})=>this.createAlias(e,t)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{"undefined"!=typeof window&&console.log(`[AliasBrowserService] profile:updated received. profileId: ${e}, cache.currentProfile: ${this.cache.currentProfile}, match: ${e===this.cache.currentProfile}`),e===this.cache.currentProfile&&(this.updateCacheFromProfile(t),this.emit("aliases-changed",{aliases:this.cache.aliases}))}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{this.cache.currentProfile=e,i&&(this.cache.currentEnvironment=i),this.updateCacheFromProfile(t),this.emit("aliases-changed",{aliases:this.cache.aliases})}),this.addEventListener("environment:changed",async e=>{const t="string"==typeof e?e:e?.environment;"undefined"!=typeof window&&console.log("[AliasBrowserService] environment:changed received. payload:",e,`parsed env: ${t}`),t&&(this.cache.currentEnvironment=t)})}updateCacheFromProfile(e){e&&(this.cache.profile=e,this.cache.aliases=e.aliases||{})}getAliases(){return Object.fromEntries(Object.entries(this.cache.aliases||{}).filter(([e,t])=>"vfx-alias"!==t.type))}async selectAlias(e){return await this.request("selection:select-alias",{aliasName:e})}async createAlias(e,t=""){const i=await this.request("alias:add",{name:e,description:t});return i&&await this.selectAlias(e),i}}class oi extends re{constructor({i18n:e,eventBus:t=null}={}){super(t),this.componentName="CommandChainService",this.i18n=e,this.commands=[],this.Fe=!1,this.Pe=!1,this.ne=[],this.eventBus&&this.ne.push(this.respond("command:set-stabilize",({name:e,stabilize:t,bindset:i})=>this.setStabilize(e,t,i)),this.respond("command:is-stabilized",({name:e,bindset:t})=>this.isStabilized(e,t)),this.respond("command-chain:clear",async({key:e,bindset:t})=>{try{return await this.clearCommandChain(e,t)}catch(e){throw e}}),this.respond("command-chain:is-stabilized",({name:e,bindset:t})=>this.isStabilized(e,t)),this.respond("command-chain:generate-alias-name",({environment:e,keyName:t,bindsetName:i})=>this.generateBindToAliasName(e,t,i)),this.respond("command-chain:generate-alias-preview",({aliasName:e,commands:t})=>this.generateAliasPreview(e,t)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("profile:updated",e=>{if(e?.profile&&e?.profileId){const t={...e.profile,id:e.profileId};this.updateCacheFromProfile(t),this.refreshCommands()}}),this.addEventListener("profile:switched",e=>{e.profile&&this.updateCacheFromProfile(e.profile)}),this.addEventListener("environment:changed",e=>{("string"==typeof e?e:e?.environment)&&("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey)&&this.refreshCommands()}),console.log("[CommandChainService] Setting up bindset-selector:active-changed listener"),this.addEventListener("bindset-selector:active-changed",({bindset:e,name:t})=>{const i=e||t;console.log(`[CommandChainService] *** bindset-selector:active-changed received: ${this.cache.activeBindset} -> ${i} ***`),i&&(this.Fe=!0,console.log(`[CommandChainService] Calling refreshCommands() for bindset: ${i}`),this.refreshCommands(),setTimeout(()=>{this.Fe=!1,console.log(`[CommandChainService] Bindset switch completed for: ${i}`)},100))}),this.addEventListener("bindset-operation:started",({type:e,bindset:t,key:i})=>{console.log(`[CommandChainService] Bindset operation started: ${e} key=${i} bindset=${t}`),this.Pe=!0}),this.addEventListener("bindset-operation:completed",({type:e,bindset:t,key:i})=>{console.log(`[CommandChainService] Bindset operation completed: ${e} key=${i} bindset=${t}`),this.Pe=!1}),this.addEventListener("bindset-selector:key-added",async({key:e,bindset:t})=>{if(console.log(`[CommandChainService] bindset-selector:key-added received: key=${e}, bindset=${t}, selectedKey=${this.cache.selectedKey}`),e===this.cache.selectedKey){console.log(`[CommandChainService] Key added to bindset ${t} - refreshing command chain to show empty state`),console.log(`[CommandChainService] About to refresh commands - activeBindset: ${this.cache.activeBindset}, expected: ${t}`);const e=await this.getCommandsForSelectedKey();console.log(`[CommandChainService] Refreshed commands for new bindset ${t}: ${e.length} commands`),this.emit("chain-data-changed",{commands:e})}}),this.addEventListener("key-selected",async({key:e,name:t})=>{var i;if(console.log(`[CommandChainService] key-selected event received: key=${e}, name=${t}`),i={key:e,name:t},"undefined"!=typeof window&&console.log("[CommandChainService] key-selected:",i),!this.cache)return void console.error("[CommandChainService] Cache not available!");if(console.log(`[CommandChainService] Cache state: currentEnvironment=${this.cache.currentEnvironment}, activeBindset=${this.cache.activeBindset}`),"alias"===this.cache.currentEnvironment)return;const n=await this.getCommandsForSelectedKey();console.log("[CommandChainService] [key-selected] emitting chain-data-changed with",n.length,"commands"),this.emit("chain-data-changed",{commands:n})}),this.addEventListener("alias-selected",async({name:e})=>{if(!e)return;const t=await this.getCommandsForSelectedKey();console.log("[CommandChainService] [alias-selected] emitting chain-data-changed with",t.length,"commands"),this.emit("chain-data-changed",{commands:t})}),this.addEventListener("command-added",async({command:e,key:t})=>{console.log("[CommandChainService] command-added received:",{command:e,key:t});const i=await this.getCommandsForSelectedKey();console.log("[CommandChainService] emitting chain-data-changed with",i.length,"commands"),this.emit("chain-data-changed",{commands:i})});const e=async(e,t)=>{console.log(`[CommandChainService] ${e} received:`,t);let i=Array.isArray(t?.commands)?t.commands:null;i||(i=await this.getCommandsForSelectedKey()),this.emit("chain-data-changed",{commands:i})};this.addEventListener("command-edited",async t=>{await e("command-edited",t)}),this.addEventListener("command-deleted",async t=>{await e("command-deleted",t)}),this.addEventListener("command-moved",async t=>{await e("command-moved",t)}),this.addEventListener("commandchain:edit",async({index:e})=>{if(void 0===e)return;const t=(await this.getCommandsForSelectedKey())[e];if(!t)return;let i;if(i="string"==typeof t?{command:t}:t.parameters?{...t,parameters:{...t.parameters}}:{...t},!i.parameters)try{const e=await this.request("parser:parse-command-string",{commandString:i.command,options:{generateDisplayText:!1}});e.commands&&e.commands[0]?.parameters&&(i.parameters=e.commands[0].parameters)}catch(e){console.warn("[CommandChainService] Failed to derive parameters from command:",e)}const n=await this.findCommandDefinition(i),a=!(!n||!n.customizable),s="custom"===i.type||"custom"===i.category||i.command&&await this.isCustomCommand(i.command);if(a)this.emit("parameter-command:edit",{index:e,command:i,commandDef:n,categoryId:n.categoryId||i.type,commandId:n.commandId});else{if(s){const t={name:"Edit Custom Command",customizable:!0,categoryId:"custom",commandId:"add_custom_command",parameters:{rawCommand:{type:"text",default:i.command||"",placeholder:"Enter any STO command",label:"Command:"}}};return void this.emit("parameter-command:edit",{index:e,command:i,commandDef:t,categoryId:"custom",commandId:"add_custom_command"})}"undefined"!=typeof stoUI&&stoUI.showToast&&stoUI.showToast(i.command||t,"info")}}),this.addEventListener("commandchain:delete",async({index:e})=>{const t="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(void 0===e||!t)return;const i="alias"===this.cache.currentEnvironment||"Primary Bindset"===this.cache.activeBindset?null:this.cache.activeBindset;try{await this.request("command:delete",{key:t,index:e,bindset:i}),this.emit("chain-data-changed",{commands:await this.getCommandsForSelectedKey()})}catch(e){console.error("Failed to delete command:",e)}}),this.addEventListener("commandchain:move",async({fromIndex:e,toIndex:t})=>{const i="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(!i)return;const n="alias"===this.cache.currentEnvironment||"Primary Bindset"===this.cache.activeBindset?null:this.cache.activeBindset;try{await this.request("command:move",{key:i,fromIndex:e,toIndex:t,bindset:n}),this.emit("chain-data-changed",{commands:await this.getCommandsForSelectedKey()})}catch(e){console.error("Failed to move command:",e)}}),this.addEventListener("command-chain:clear",async({key:e})=>{e&&(console.log(`[CommandChainService] Clearing command chain for key="${e}", activeBindset="${this.cache.activeBindset}", env="${this.cache.currentEnvironment}"`),await this.clearCommandChain(e,"Primary Bindset"!==this.cache.activeBindset?this.cache.activeBindset:null))}),this.addEventListener("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};for(const[e,i]of Object.entries(t))"bindToAliasMode"===e&&console.log(`[CommandChainService] Preference changed: bindToAliasMode = ${i}`)})}async getCommandsForSelectedKey(){try{const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(console.log(`[CommandChainService] getCommandsForSelectedKey called - activeBindset: ${this.cache.activeBindset}, selectedKey: ${this.cache.selectedKey}, selectedAlias: ${this.cache.selectedAlias}, resolvedKey: ${e}, environment: ${this.cache.currentEnvironment}`),"alias"===this.cache.currentEnvironment)return await this.request("command:get-for-selected-key");const t=this.cache.activeBindset||"Primary Bindset";if(console.log(`[CommandChainService] Using activeBindset: ${t}`),"Primary Bindset"!==t){console.log(`[CommandChainService] Requesting commands from bindset: ${t}`);const e=Date.now(),i=new Promise((e,t)=>{setTimeout(()=>t(new Error("Request timeout after 5 seconds")),5e3)});try{const n="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey,a=this.request("bindset:get-key-commands",{bindset:t,environment:this.cache.currentEnvironment,key:n}),s=await Promise.race([a,i]),o=Date.now()-e;return console.log(`[CommandChainService] Received ${s?.length||0} commands from bindset in ${o}ms:`,s),Array.isArray(s)?s:[]}catch(i){const n=Date.now()-e;return console.error(`[CommandChainService] bindset:get-key-commands failed after ${n}ms:`,i),console.error("[CommandChainService] This suggests BindsetService is not responding. Check if BindsetService is initialized."),console.warn(`[CommandChainService] Falling back to empty commands array for bindset: ${t}`),[]}}console.log("[CommandChainService] Requesting commands from Primary Bindset");const i=await this.request("command:get-for-selected-key",{key:e,environment:this.cache.currentEnvironment,bindset:"Primary Bindset"});return console.log(`[CommandChainService] Received ${i?.length||0} commands from Primary:`,i),i}catch(e){return console.error("Failed to get commands for selected key:",e),Array.isArray(this.commands)?this.commands:[]}}async getEmptyStateInfo(){try{return await this.request("command:get-empty-state-info")}catch(e){return console.error("Failed to get empty state info:",e),{title:"",preview:"",commandCount:0,icon:"",emptyTitle:"",emptyDesc:""}}}async findCommandDefinition(e){try{return console.log("[CommandChainService] findCommandDefinition command:find-definition",{command:e}),await this.request("command:find-definition",{command:e})}catch(e){return console.error("Failed to find command definition:",e),null}}async getCommandWarning(e){try{return await this.request("command:get-warning",{command:e})}catch(e){return console.error("Failed to get command warning:",e),null}}async isCustomCommand(e){try{const t=await this.request("parser:parse-command-string",{commandString:e,options:{generateDisplayText:!1}});return!t.commands||!t.commands[0]||"custom"===t.commands[0].category}catch(e){return!0}}async clearCommandChain(e,t=null){try{if(!e)return console.warn("CommandChainService: Cannot clear chain - no key specified"),!1;const i=this.getCurrentProfile();if(!i)return console.warn("CommandChainService: Cannot clear chain - no active profile"),!1;const n=this.cache.currentEnvironment||"space",a=t&&"Primary Bindset"!==t&&"alias"!==n;if("alias"===n)i.aliases&&i.aliases[e]&&(i.aliases[e].commands=[]);else if(a)i.bindsets?.[t]||(i.bindsets={...i.bindsets||{},[t]:{space:{keys:{}},ground:{keys:{}}}}),i.bindsets[t][n]||(i.bindsets[t][n]={keys:{}}),i.bindsets[t][n].keys[e]=[];else{const t=i.builds?.[n]?.keys?.[e];t&&(i.builds[n].keys[e]=[])}const s=this.cache.currentProfile||this.currentProfile;if(!s)return console.error("CommandChainService: Cannot clear command chain - no current profile ID available"),!1;let o;o="alias"===n?{modify:{aliases:{[e]:i.aliases[e]}}}:a?{modify:{bindsets:{[t]:{[n]:{keys:{[e]:[]}}}}}}:{modify:{builds:{[n]:{keys:{[e]:[]}}}}};const r=await this.request("data:update-profile",{profileId:s,...o});return r?.success?(this.emit("command-chain-cleared",{key:e}),this.emit("chain-data-changed",{commands:[]}),!0):(console.error("CommandChainService: Failed to save profile via DataCoordinator"),!1)}catch(e){return console.error("CommandChainService: Failed to clear command chain:",e),!1}}updateCacheFromProfile(e){e?(console.log("[CommandChainService] updateCacheFromProfile called with profile:",{profileId:e.id,environment:this.cache.currentEnvironment,stackTrace:(new Error).stack}),console.log("[CommandChainService] Cache updated:",{currentProfile:this.cache.currentProfile,keysCount:Object.keys(this.cache.keys||{}).length,aliasesCount:Object.keys(this.cache.aliases||{}).length})):console.log("[CommandChainService] updateCacheFromProfile called with null/undefined profile")}getCurrentProfile(){return this.cache.profile?this.getCurrentBuild(this.cache.profile):null}getCurrentBuild(e){return e?(e.builds||(e.builds={space:{keys:{}},ground:{keys:{}}}),e.builds[this.cache.currentEnvironment]||(e.builds[this.cache.currentEnvironment]={keys:{}}),e.builds[this.cache.currentEnvironment].keys||(e.builds[this.cache.currentEnvironment].keys={}),{...e,keys:e.builds[this.cache.currentEnvironment].keys,aliases:e.aliases||{}}):null}async refreshCommands(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(e){const t=await this.request("command:get-for-selected-key",{key:e});this.emit("chain-data-changed",{commands:t})}}getCurrentState(){return{commands:this.commands}}onDestroy(){this.ne&&(this.ne.forEach(e=>e()),this.ne=[])}isStabilized(e,t=null){if(!e)return!1;const i=this.cache.profile||null;return!!(i&&(i.aliasMetadata&&i.aliasMetadata[e]&&!0===i.aliasMetadata[e].stabilizeExecutionOrder||"alias"!==this.cache.currentEnvironment&&(t&&"Primary Bindset"!==t?i.bindsetMetadata&&i.bindsetMetadata[t]&&i.bindsetMetadata[t][this.cache.currentEnvironment]&&i.bindsetMetadata[t][this.cache.currentEnvironment][e]&&!0===i.bindsetMetadata[t][this.cache.currentEnvironment][e].stabilizeExecutionOrder:i.keybindMetadata&&i.keybindMetadata[this.cache.currentEnvironment]&&i.keybindMetadata[this.cache.currentEnvironment][e]&&!0===i.keybindMetadata[this.cache.currentEnvironment][e].stabilizeExecutionOrder)))}async setStabilize(e,t=!0,i=null){try{if(!e)return{success:!1};const n=this.cache.profile;if(!n)return{success:!1};const a="alias"===this.cache.currentEnvironment||!(!n.aliases||!n.aliases[e]);let s;if(a){const i={},a=n.aliasMetadata&&n.aliasMetadata[e]||{};i[e]={...a},i[e].stabilizeExecutionOrder=!!t,s={aliasMetadata:i}}else if(i&&"Primary Bindset"!==i){const a={};a[i]={},a[i][this.cache.currentEnvironment]={};const o={...n.bindsetMetadata&&n.bindsetMetadata[i]&&n.bindsetMetadata[i][this.cache.currentEnvironment]&&n.bindsetMetadata[i][this.cache.currentEnvironment][e]||{}};o.stabilizeExecutionOrder=!!t,a[i][this.cache.currentEnvironment][e]=o,s={bindsetMetadata:a}}else{const i={};i[this.cache.currentEnvironment]||(i[this.cache.currentEnvironment]={});const a=n.keybindMetadata&&n.keybindMetadata[this.cache.currentEnvironment]&&n.keybindMetadata[this.cache.currentEnvironment][e]||{};i[this.cache.currentEnvironment][e]={...a},i[this.cache.currentEnvironment][e].stabilizeExecutionOrder=!!t,s={keybindMetadata:i}}const o=this.cache.currentProfile||this.currentProfile;if(!o)return{success:!1};const r=await this.request("data:update-profile",{profileId:o,modify:s});return r?.success?(r.profile&&this.updateCacheFromProfile({...r.profile,id:o}),this.emit("stabilize-changed",{name:e,stabilize:t,isAlias:a,bindset:i}),this.emit("profile:updated",{profileId:o,profile:r.profile}),{success:!0}):{success:!1}}catch(e){return console.error("[CommandChainService] setStabilize failed",e),{success:!1,error:e.message}}}async generateBindToAliasName(e,t,i=null){try{const{generateBindToAliasName:n}=await Promise.resolve().then(function(){return ei});return n(e,t,i)}catch(e){return console.error("[CommandChainService] Failed to generate alias name:",e),null}}generateAliasPreview(e,t){if(!e)return"";try{if(!Array.isArray(t))return`alias ${e} <&  &>`;const i=t.map(e=>null==e?"":"string"==typeof e?e:e.command||"").filter(Boolean);return 0===i.length?`alias ${e} <&  &>`:`alias ${e} <& ${i.join(" $$ ")} &>`}catch(t){return console.error("[CommandChainService] Failed to generate alias preview:",t),`alias ${e} <&  &>`}}handleInitialState(e,t){super.handleInitialState(e,t),"PreferencesService"===e&&this.cache.preferences&&console.log(`[CommandChainService] Preferences received via ComponentBase: bindToAliasMode = ${this.cache.preferences.bindToAliasMode}`)}}class ri extends vt{constructor({eventBus:e,ui:t=null,document:i=("undefined"!=typeof window?window.document:void 0),i18n:n}){super(e),this.componentName="CommandChainUI",this.ui=t||("undefined"!=typeof stoUI?stoUI:null),this.document=i,this.i18n=n}async onInit(){await this.setupEventListeners(),this.render()}async setupEventListeners(){if(!this.eventListenersSetup){this.eventListenersSetup=!0,this.addEventListener("chain-data-changed",({commands:e})=>{console.log("[CommandChainUI] chain-data-changed received with",e.length,"commands"),this.render(e)}),this.addEventListener("environment:changed",e=>{("string"==typeof e?e:e?.environment)&&(this.updateChainActions(),this.updatePreviewLabel(),this.setupBindsetDropdown().catch(()=>{}),this.render().catch(()=>{}))}),this.addEventListener("key-selected",async e=>{const t=void 0!==e.key?e.key:e.name;void 0!==t&&(this.cache.selectedKey=t),e?.environment&&(this.cache.currentEnvironment=e.environment),this.updateChainActions(),this.emit("bindset-selector:set-selected-key",{key:t}),await this.refreshActiveBindset(),this.render().catch(()=>{})}),this.addEventListener("profile:switched",async e=>{console.log("[CommandChainUI] Profile switched, clearing cached state"),await this.request("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"}),this.render().catch(()=>{})}),this.addEventListener("language:changed",()=>{this.render()}),this.addEventListener("bindset-selector:active-changed",({bindset:e})=>{this.cache.activeBindset=e,this.updateBindsetBanner(),this.updateChainActions(),this.render()});try{const e=await this.request("key:get-selected");e&&(this.cache.selectedKey=e)}catch(e){console.warn("[CommandChainUI] Failed to sync initial selected key state",e)}this.cache.currentEnvironment||(this.cache.currentEnvironment="space"),console.log("[CommandChainUI] Setting up bindset-selector:key-added event listener"),this.addEventListener("bindset-selector:key-added",({key:e,bindset:t})=>{console.log(`[CommandChainUI] *** bindset-selector:key-added received: key=${e}, bindset=${t}, selectedKey=${this.cache.selectedKey} ***`),e===this.cache.selectedKey?console.log(`[CommandChainUI] *** Key added to bindset: ${t} (bindset switching already handled) ***`):console.log(`[CommandChainUI] *** Event key ${e} does not match selectedKey ${this.cache.selectedKey}, ignoring ***`)}),console.log("[CommandChainUI] bindset-selector:key-added event listener registered"),this.addEventListener("bindset-selector:key-removed",async({key:e,bindset:t})=>{e===this.cache.selectedKey&&this.cache.activeBindset===t&&await this.request("bindset-selector:set-active-bindset",{bindset:"Primary Bindset"})}),this.addEventListener("preferences:loaded",async({settings:e})=>{e&&void 0!==e.bindsetsEnabled&&this.cache.preferences.bindsetsEnabled&&!this.De&&await this.setupBindsetDropdown()}),this.addEventListener("bindsets:changed",async e=>{console.log("[CommandChainUI] bindsets:changed received with",e.names.length,"bindsets"),this.Me=e.names,await this.setupBindsetDropdown()}),this.onDom("stabilizeExecutionOrderBtn","click","commandchain-stabilize",async()=>{await this.toggleStabilize()}),this.onDom("copyAliasBtn","click","commandchain-copy-alias",async()=>{await this.copyAliasToClipboard()}),this.onDom("copyPreviewBtn","click","commandchain-copy-preview",async()=>{await this.copyCommandPreviewToClipboard()}),this.onDom("#commandList","click","commandchain-action",e=>{const t=e.target.closest(".btn-edit:not(.btn-placeholder)"),i=e.target.closest(".btn-delete"),n=e.target.closest(".btn-up"),a=e.target.closest(".btn-down");if(t&&!t.disabled){const i=t.closest(".command-item-row"),n=parseInt(i?.dataset?.index);Number.isNaN(n)||(console.log("[CommandChainUI] EDIT BUTTON CLICKED:",{index:n,buttonId:t.id,buttonClass:t.className,buttonElement:t}),e.preventDefault(),e.stopPropagation(),this.emit("commandchain:edit",{index:n}))}else if(i&&!i.disabled){const t=i.closest(".command-item-row"),n=parseInt(t?.dataset?.index);Number.isNaN(n)||(console.log("[CommandChainUI] DELETE BUTTON CLICKED:",{index:n,buttonId:i.id,buttonClass:i.className,buttonElement:i}),e.preventDefault(),e.stopPropagation(),this.emit("commandchain:delete",{index:n}))}else if(n&&!n.disabled){const e=n.closest(".command-item-row"),t=parseInt(e?.dataset?.index),i=e?.dataset?.group||null;if(!Number.isNaN(t)){const e=this.getMoveTarget(t,i,"up");this.emit("commandchain:move",{fromIndex:t,toIndex:e})}}else if(a&&!a.disabled){const e=a.closest(".command-item-row"),t=parseInt(e?.dataset?.index),i=e?.dataset?.group||null;if(!Number.isNaN(t)){const e=this.getMoveTarget(t,i,"down");this.emit("commandchain:move",{fromIndex:t,toIndex:e})}}}),this.onDom("#commandList","dblclick","commandchain-edit-customizable",e=>{const t=e.target.closest(".command-item-row.customizable");if(t){const i=parseInt(t.dataset?.index);Number.isNaN(i)||(console.log("[CommandChainUI] DOUBLE-CLICK on command element:",{index:i,target:e.target,targetClass:e.target.className}),this.emit("commandchain:edit",{index:i}))}}),this.onDom("#commandList","click","commandchain-palindromic-toggle",async e=>{const t=e.target.closest(".btn-palindromic-toggle");if(t){e.preventDefault(),e.stopPropagation();const i=parseInt(t.dataset.commandIndex);if(!Number.isNaN(i)){const e=await this.getCommandsForCurrentSelection();if(e&&i>=0&&i<e.length){const t=e[i],n="object"!=typeof t||!1!==t.palindromicGeneration,a=!n;console.log("[CommandChainUI] Toggling palindromic:",{index:i,command:t,isCurrentlyIncluded:n,newValue:a}),await this.updateCommandPalindromicSetting(i,"palindromicGeneration",a)}}}}),this.onDom("#commandList","click","commandchain-placement-toggle",async e=>{const t=e.target.closest(".btn-placement-toggle");if(t){e.preventDefault(),e.stopPropagation();const i=parseInt(t.dataset.commandIndex);if(!Number.isNaN(i)){const e=await this.getCommandsForCurrentSelection();if(e&&i>=0&&i<e.length){const t=e[i],n="object"==typeof t&&t.placement?t.placement:"before-pre-pivot",a="in-pivot-group"===n?"before-pre-pivot":"in-pivot-group";console.log("[CommandChainUI] Toggling placement:",{index:i,command:t,currentPlacement:n,newPlacement:a}),await this.updateCommandPalindromicSetting(i,"placement",a)}}}}),this.onDom("#commandList","click","commandchain-group-header",e=>{const t=e.target.closest(".group-header");if(t){const e=t.dataset.group;if(e){const t=this.getGroupCollapsedState(e);this.setGroupCollapsedState(e,!t),this.render()}}}),this.setupDragAndDrop(),this.updateChainActions(),this.addEventListener("preferences:changed",async e=>{const t=e.changes||{[e.key]:e.value};let i=!1,n=!1;for(const[e,a]of Object.entries(t))if("bindsetsEnabled"===e){if(i=!0,!a&&this.De){const e=this.document.getElementById("bindsetSelect");e&&(e.style.display="none")}}else"bindToAliasMode"===e&&(console.log(`[CommandChainUI] Preference changed: bindToAliasMode = ${a}`),i=!0,n=!0);i&&await this.setupBindsetDropdown(),n&&this.render().catch(()=>{})}),this.cache.activeBindset||console.log("[CommandChainUI] No active bindset in cache, waiting for ComponentBase state sync")}}async render(e=null){const t=this.document.getElementById("commandList"),i=this.document.getElementById("chainTitle"),n=this.document.getElementById("commandPreview"),a=this.document.getElementById("commandCount"),s=this.document.getElementById("emptyState");if(this.document.getElementById("generatedAlias"),this.document.getElementById("aliasPreview"),!t||!i||!n)return;const o=this.cache.preferences.bindToAliasMode;console.log(`[CommandChainUI] render: bindToAliasMode = ${o} (type: ${typeof o})`),console.log("[CommandChainUI] render: full preferences cache:",this.cache.preferences);let r=e;if(!r){if(!("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey)||!this.cache.profile||!this.cache.currentProfile){const e=await this.request("command:get-empty-state-info");i.textContent=e.title||"",n.textContent=e.preview||"",a&&(a.textContent=e.commandCount||"");const s=this.document.createElement("div");return s.innerHTML=`\n            <div class="empty-state show" id="emptyState">\n              <i class="${e.icon}"></i>\n              <h4>${e.emptyTitle}</h4>\n              <p>${e.emptyDesc}</p>\n            </div>`,void t.replaceChildren(...s.children)}r=await this.getCommandsForCurrentSelection()}const c=await this.request("command:get-empty-state-info"),l="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(this.cache.activeBindset||(this.cache.activeBindset="Primary Bindset"),!l||0===r.length){i.textContent=c.title,a&&(a.textContent=c.commandCount),await this.updateBindToAliasMode(o,l,r);const e=this.document.createElement("div");e.innerHTML=`\n          <div class="empty-state ${0===r.length?"show":""}" id="emptyState">\n            <i class="${c.icon}"></i>\n            <h4>${c.emptyTitle}</h4>\n            <p>${c.emptyDesc}</p>\n          </div>`,t.replaceChildren(...e.children);try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,t=await this.request("command-chain:is-stabilized",{name:l,bindset:e}),i="alias"===this.cache.currentEnvironment;this.emit("command-chain:validate",{key:l,stabilized:t,isAlias:i})}catch(e){}return}i.textContent=c.title;const d=this.document.getElementById("aliasCommandCount"),m=this.document.getElementById("commandCountDisplay"),h=this.document.getElementById("aliasCommandCountDisplay"),u=m?.querySelector('[data-i18n="commands"], [data-i18n="command_singular"]'),p=h?.querySelector('[data-i18n="commands"], [data-i18n="command_singular"]'),f=r.length,y=1===f?"command_singular":"commands";o&&l&&"alias"!==this.cache.currentEnvironment?(d&&(d.textContent=f.toString()),p&&(p.setAttribute("data-i18n",y),p.textContent=this.i18n.t(y)),h&&(h.style.display=""),m&&(m.style.display="none")):(a&&(a.textContent=f.toString()),u&&(u.setAttribute("data-i18n",y),u.textContent=this.i18n.t(y)),m&&(m.style.display=""),h&&(h.style.display="none")),await this.updateBindToAliasMode(o,l,r);const _=this.cache.preferences?.bindToAliasMode??!1;if(o||_||!l||"alias"===this.cache.currentEnvironment)(o||_)&&console.log("[CommandChainUI] Skipping mirroring logic - bind-to-alias mode is active");else{console.log("[CommandChainUI] Applying mirroring for non-bind-to-alias mode");try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(await this.request("command-chain:is-stabilized",{name:l,bindset:e})&&r.length>1){const e=r.map(e=>"string"==typeof e?{command:e}:e),t=await this.request("command:generate-mirrored-commands",{commands:e});t&&(n.textContent=`${l} "${t}"`)}}catch(e){console.warn("[CommandChainUI] Failed to generate mirrored preview",e)}}s&&s.classList.remove("show");let g=!1;try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;g=await this.request("command-chain:is-stabilized",{name:l,bindset:e})}catch(e){console.warn("[CommandChainUI] Failed to check stabilization state:",e)}const b=[];if(g&&r.length>0){const e=this.groupCommands(r);this.currentGroups=e;const t=["non-trayexec","palindromic","pivot"];for(const i of t){const t=e[i];if(t&&t.commands.length>0){const e=this.renderGroupSeparator(i,t);if(e){const t=this.document.createElement("div");t.innerHTML=e,b.push(...t.children)}if(!t.isCollapsed)for(let e=0;e<t.commands.length;e++){const{command:n,index:a}=t.commands[e],s=e+1,o=await this.createCommandElement(n,a,r.length,i,s);b.push(o)}}}}else{this.currentGroups=null;for(let e=0;e<r.length;e++){const t=await this.createCommandElement(r[e],e,r.length);b.push(t)}}t.replaceChildren(...b);try{const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,t=await this.request("command-chain:is-stabilized",{name:l,bindset:e}),i="alias"===this.cache.currentEnvironment;this.emit("command-chain:validate",{key:l,stabilized:t,isAlias:i})}catch(e){}this.updateBindsetBanner()}groupCommands(e){const t={"non-trayexec":{title:this.i18n.t("command_group_non_trayexec"),commands:[],isCollapsed:this.getGroupCollapsedState("non-trayexec")},palindromic:{title:this.i18n.t("command_group_palindromic"),commands:[],isCollapsed:this.getGroupCollapsedState("palindromic")},pivot:{title:this.i18n.t("command_group_pivot"),commands:[],isCollapsed:this.getGroupCollapsedState("pivot")}};let i=!1;return e.forEach((e,t)=>{("string"==typeof e?e:e.command).match(/^(?:\+)?TrayExecByTray/),"object"==typeof e&&e.palindromicGeneration,"object"==typeof e&&"in-pivot-group"===e.placement&&(i=!0)}),e.forEach((e,n)=>{const a=("string"==typeof e?e:e.command).match(/^(?:\+)?TrayExecByTray/),s="object"==typeof e&&!1===e.palindromicGeneration,o="object"==typeof e&&"in-pivot-group"===e.placement;let r=null;r=a?s&&o&&i?"pivot":s?"non-trayexec":"palindromic":"non-trayexec",t[r].commands.push({command:e,index:n})}),t}getGroupCollapsedState(e){if("undefined"==typeof window||!window.localStorage)return!1;const t=`commandGroup_${e}_collapsed`;return"true"===localStorage.getItem(t)}setGroupCollapsedState(e,t){if("undefined"==typeof window||!window.localStorage)return;const i=`commandGroup_${e}_collapsed`;t?localStorage.setItem(i,"true"):localStorage.removeItem(i)}renderGroupSeparator(e,t){const i=this.getReorderHint(e);return`\n      <div class="command-group-separator" data-group="${e}">\n        <div class="group-header" data-group="${e}" data-action="commandchain-group-header">\n          <div class="group-info">\n            <i class="fas fa-chevron-right twisty ${t.isCollapsed?"collapsed":""}"></i>\n            <span class="group-title">${t.title}</span>\n            <span class="group-count">(${t.commands.length})</span>\n          </div>\n          ${i?`\n            <div class="group-hint">\n              ${i}\n            </div>\n          `:""}\n        </div>\n      </div>\n    `}getReorderHint(e){switch(e){case"non-trayexec":return this.i18n.t("command_group_hint_fixed_order");case"palindromic":return this.i18n.t("command_group_hint_palindromic");case"pivot":return this.i18n.t("command_group_hint_pivot");default:return""}}getButtonState(e,t,i,n,a){if(n&&this.currentGroups&&this.currentGroups[n]){const i=this.currentGroups[n].commands,a=i.length,s=i.findIndex(e=>e.index===t);return a<=1?"up"===e?'<button class="command-action-btn btn-up" title="Move Up" disabled><i class="fas fa-chevron-up"></i></button>':'<button class="command-action-btn btn-down" title="Move Down" disabled><i class="fas fa-chevron-down"></i></button>':"up"===e?`<button class="command-action-btn btn-up" title="Move Up" ${0===s?"disabled":""}><i class="fas fa-chevron-up"></i></button>`:`<button class="command-action-btn btn-down" title="Move Down" ${s===a-1?"disabled":""}><i class="fas fa-chevron-down"></i></button>`}return"up"===e?`<button class="command-action-btn btn-up" title="Move Up" ${0===t?"disabled":""}><i class="fas fa-chevron-up"></i></button>`:`<button class="command-action-btn btn-down" title="Move Down" ${t===i-1?"disabled":""}><i class="fas fa-chevron-down"></i></button>`}getMoveTarget(e,t,i){if(t&&this.currentGroups&&this.currentGroups[t]){const n=this.currentGroups[t].commands,a=n.length,s=n.findIndex(t=>t.index===e);return"up"===i?s<=0?e:n[s-1].index:s>=a-1?e:n[s+1].index}return"up"===i?e-1:e+1}async createCommandElement(e,t,i,n=null,a=null){const s=this.document.createElement("div")||{};s.dataset||(s.dataset={}),s.className="command-item-row",s.dataset.index=t,s.draggable=!0,n&&(s.dataset.group=n);const o="string"==typeof e?e:fe(e),r=this.i18n,c=await pe(o,r,{eventBus:this.eventBus});console.log("[CommandChainUI] enriched command:",c);let l=!1;try{const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(e){const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;l=await this.request("command-chain:is-stabilized",{name:e,bindset:t})}}catch(e){console.warn("[CommandChainUI] Failed to check stabilization state:",e)}const d=await this.request("command:find-definition",{command:o}),m="custom"===c.type||"custom"===c.category,h=d&&d.customizable||m,u=o.match(/^(?:\+)?TrayExecByTray/),p="object"!=typeof e||!1!==e.palindromicGeneration,f=!p,y="in-pivot-group"===("object"==typeof e&&e.placement?e.placement:"before-pre-pivot");let _="";l&&u&&(_=`\n        <button class="command-action-btn toolbar-toggle btn-palindromic-toggle ${p?"active":""}" \n                title="${p?this.i18n.t("palindromic_included_tooltip"):this.i18n.t("palindromic_excluded_tooltip")}" \n                data-command-index="${t}"\n                data-action="commandchain-palindromic-toggle">\n          <i class="fas fa-balance-scale"></i>\n        </button>\n      `);let g="";l&&u&&f&&(g=`\n        <button class="command-action-btn toolbar-toggle btn-placement-toggle ${y?"active":""}" \n                title="${y?this.i18n.t("placement_in_pivot_group_tooltip"):this.i18n.t("placement_before_palindromes_tooltip")}" \n                data-command-index="${t}"\n                data-action="commandchain-placement-toggle">\n          <i class="fas fa-arrows-left-right-to-line"></i>\n        </button>\n      `);let b=(e=>{if("string"==typeof e)return e;if("object"==typeof e&&e){if(e.key&&e.fallback){if(this.i18n&&this.i18n.t){const t=this.i18n.t(e.key,e.params||{});if(t&&t!==e.key)return t}return e.fallback}if(e.fallback)return e.fallback;if(e.text)return e.text;const t=e.name||e.displayText;if(t)return t}return o})(c.displayText)||c.text||o,v=c.icon;h&&(s.dataset.parameters="true",s.classList.add("customizable"));const w=await this.request("command:get-warning",{command:o});let k=null;if(w){const e=this.i18n.t(w);k=e&&e!==w?e:w}const S=k?`<span class="command-warning-icon" title="${k}" data-i18n-title="${w}"><i class="fas fa-exclamation-triangle"></i></span>`:"",x=h?' <span class="param-indicator" title="Editable parameters">‚öôÔ∏è</span>':"";console.log("[CommandChainUI] command",e),console.log("[CommandChainUI] commandDef",d);let C=c.type||c.category;d&&d.categoryId&&!["vfx-alias","alias"].includes(c.type)&&!["vfx-alias","alias"].includes(c.category)&&(C=d.categoryId);const T=null!==a?a:t+1;return s.innerHTML=`\n      <div class="command-number">${T}</div>\n      <div class="command-content">\n        <span class="command-icon">${v}</span>\n        <span class="command-text">${b}${x}</span>\n        ${S}\n      </div>\n      <span class="command-type ${C}">${C}</span>\n      <div class="command-actions">\n        ${h?'<button class="command-action-btn btn-edit" title="Edit Command"><i class="fas fa-edit"></i></button>':'<button class="command-action-btn btn-edit btn-placeholder" disabled aria-hidden="true" style="visibility:hidden"><i class="fas fa-edit"></i></button>'}\n        <button class="command-action-btn command-action-btn-danger btn-delete" title="Delete Command"><i class="fas fa-times"></i></button>\n        ${_}\n        ${g}\n        ${this.getButtonState("up",t,i,n,a)}\n        ${this.getButtonState("down",t,i,n,a)}\n      </div>`,s}setupDragAndDrop(){if(!this.ui||"function"!=typeof this.ui.initDragAndDrop)return;const e=this.document.getElementById("commandList");e&&this.ui.initDragAndDrop(e,{draggableSelector:".command-item-row",dropZoneSelector:".command-item-row",onDrop:(e,t,i)=>{if(!t?.dragElement||!i)return;const n=parseInt(t.dragElement.dataset.index),a=parseInt(i.dataset.index);n===a||Number.isNaN(n)||Number.isNaN(a)||this.emit("commandchain:move",{fromIndex:n,toIndex:a})}})}updatePreviewLabel(){const e=this.document.querySelector(".generated-command label[data-i18n]");if(e){const t="alias"===this.cache.currentEnvironment?"generated_alias":"generated_command";e.setAttribute("data-i18n",t),"undefined"!=typeof window&&window.applyTranslations?window.applyTranslations(e.parentElement):this.i18n&&this.i18n.t?e.textContent=this.i18n.t(t):e.textContent="generated_alias"===t?"Generated Alias:":"Generated Command:"}}async updateBindToAliasMode(e,t,i){const n=this.document.getElementById("generatedAlias"),a=this.document.getElementById("aliasPreview"),s=this.document.getElementById("commandPreview"),o=this.cache.preferences?.bindToAliasMode??!1,r=e||o;if(console.log(`[CommandChainUI] updateBindToAliasMode: bindToAliasMode=${e}, current=${o}, effective=${r}, selectedKeyName=${t}, environment=${this.cache.currentEnvironment}, activeBindset=${this.cache.activeBindset}`),n&&a&&s)if(r&&t&&"alias"!==this.cache.currentEnvironment){n.style.display="";try{const e=await this.request("command-chain:generate-alias-name",{environment:this.cache.currentEnvironment,keyName:t,bindsetName:this.cache.activeBindset});if(e){let n=await this.request("command-chain:generate-alias-preview",{aliasName:e,commands:i});try{const a="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(await this.request("command-chain:is-stabilized",{name:t,bindset:a})&&i.length>1){const t=i.map(e=>"string"==typeof e?{command:e}:{command:e.command||e,placement:e.placement,palindromicGeneration:e.palindromicGeneration}).filter(Boolean),a=await this.request("command:generate-mirrored-commands",{commands:t});a&&(n=`alias ${e} <& ${a} &>`)}}catch(e){console.warn("[CommandChainUI] Failed to apply mirroring:",e)}a.textContent=n,s.textContent=`${t} "${e}"`,r&&console.log("[CommandChainUI] Set main preview to alias name - bind-to-alias mode takes precedence")}else a.textContent="Invalid key name for alias generation",s.textContent=`${t} "..."`}catch(e){console.error("[CommandChainUI] Failed to generate alias preview:",e),a.textContent="Error generating alias preview",s.textContent=`${t} "..."`}}else{n.style.display="none",this.updatePreviewLabel();let e=i.map(e=>"string"==typeof e?e:e.command||e).filter(Boolean).join(" $$ ");try{const n="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(await this.request("command-chain:is-stabilized",{name:t,bindset:n})&&i.length>1){const t=i.map(e=>"string"==typeof e?{command:e}:{command:e.command||e,placement:e.placement,palindromicGeneration:e.palindromicGeneration}).filter(Boolean),n=await this.request("command:generate-mirrored-commands",{commands:t});n&&(e=n)}}catch{}t?"alias"===this.cache.currentEnvironment?s.textContent=`alias ${t} <& ${e} &>`:s.textContent=`${t} "${e}"`:s.textContent=""}else console.log(`[CommandChainUI] Missing UI elements: generatedAlias=${!!n}, aliasPreviewEl=${!!a}, previewEl=${!!s}`)}async updateChainActions(){const e=!!("alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey),t=this.document.getElementById("stabilizeExecutionOrderBtn");if(t)if(t.disabled=!e,e){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;try{const i="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,n=await this.request("command:is-stabilized",{name:e,bindset:i});t.classList.toggle("active",!!n)}catch{}}else t.classList.remove("active");if("alias"===this.cache.currentEnvironment){["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(t=>{const i=this.document.getElementById(t);i&&(i.disabled=!e)});const t=this.document.getElementById("importFromKeyOrAliasBtn");t&&(t.disabled=!e),["deleteKeyBtn","duplicateKeyBtn"].forEach(e=>{const t=this.document.getElementById(e);t&&(t.disabled=!0)})}else["importFromKeyOrAliasBtn","deleteKeyBtn","duplicateKeyBtn"].forEach(t=>{const i=this.document.getElementById(t);i&&(i.disabled=!e)}),["deleteAliasChainBtn","duplicateAliasChainBtn"].forEach(e=>{const t=this.document.getElementById(e);t&&(t.disabled=!0)})}async toggleStabilize(){const e="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(!e)return;const t=this.document.getElementById("stabilizeExecutionOrderBtn"),i=t?.classList.contains("active");try{const t="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset;if(i){const i=await this.getCommandsForCurrentSelection();if(i&&i.length>0){const n=this.extractOriginalFromMirrored(i),a=this.cache.currentEnvironment;let s;s="alias"===this.cache.currentEnvironment?{modify:{aliases:{[e]:{commands:n}}}}:t&&"Primary Bindset"!==t?{modify:{bindsets:{[t]:{[a]:{keys:{[e]:n}}}}}}:{modify:{builds:{[a]:{keys:{[e]:n}}}}},await this.request("data:update-profile",{profileId:this.cache.currentProfile,...s})}}const n=await this.request("command:set-stabilize",{name:e,stabilize:!i,bindset:t});n&&n.success&&(await this.updateChainActions(),this.render())}catch(e){console.error("[CommandChainUI] Failed to toggle stabilization",e)}}extractOriginalFromMirrored(e){if(!Array.isArray(e)||0===e.length)return e;const t=[],i=[],n=[];e.forEach(e=>{const a=("string"==typeof e?e:e.command).match(/^(?:\+)?TrayExecByTray/),s="object"==typeof e&&!1===e.palindromicGeneration;a?s?"object"==typeof e&&"in-pivot-group"===e.placement?n.push(e):t.push(e):i.push(e):t.push(e)});let a=[],s=i;return n.length>0?a=n:i.length>0&&(a=[i[i.length-1]],s=i.slice(0,-1)),[...t,...s,...a]}async updateCommandPalindromicSetting(e,t,i){try{const n=await this.getCommandsForCurrentSelection();if(!n||e<0||e>=n.length)return void console.warn("[CommandChainUI] Invalid command index:",e);const a=n[e],s="string"==typeof a?a:fe(a);if(console.log("[CommandChainUI] updateCommandPalindromicSetting:",{commandIndex:e,setting:t,value:i,currentCommand:a,commandString:s}),"string"==typeof a)n[e]={command:s,palindromicGeneration:i};else{const s={...a,[t]:i};n[e]=s}console.log("[CommandChainUI] Updated command:",n[e]);const o="alias"===this.cache.currentEnvironment?this.cache.selectedAlias:this.cache.selectedKey;if(o){const e="alias"===this.cache.currentEnvironment?null:this.cache.activeBindset,t=this.cache.currentEnvironment;let i;i="alias"===this.cache.currentEnvironment?{modify:{aliases:{[o]:{commands:n}}}}:e&&"Primary Bindset"!==e?{modify:{bindsets:{[e]:{[t]:{keys:{[o]:n}}}}}}:{modify:{builds:{[t]:{keys:{[o]:n}}}}},console.log("[CommandChainUI] Updating commands with payload:",i),await this.request("data:update-profile",{profileId:this.cache.currentProfile,...i}),console.log("[CommandChainUI] Commands after update:",n),await this.render(n)}}catch(e){console.error("[CommandChainUI] Failed to update command palindromic setting:",e)}}onDestroy(){}handleInitialState(e,t){if(!t)return;if("BindsetSelectorService"===e)return console.log("[CommandChainUI] Received initial state from BindsetSelectorService:",t),this.updateBindsetBanner(),this.updateChainActions(),void this.render();if("SelectionService"===e)return void this.render().catch(()=>{});const i="InterfaceModeService"===e||"DataCoordinator"===e;(t.environment||t.currentEnvironment)&&i&&(t.environment||t.currentEnvironment,this.updateChainActions(),this.render().catch(()=>{})),t.bindsets&&(this.Me=Array.isArray(t.bindsets)?t.bindsets:[...t.bindsets]),"PreferencesService"===e&&this.cache.preferences&&(console.log("[CommandChainUI] Late-join preferences received, checking bindset setup"),this.cache.preferences.bindsetsEnabled&&!this.De&&this.setupBindsetDropdown().catch(()=>{}))}async setupBindsetDropdown(){const e=this.cache.preferences.bindToAliasMode,t=this.document.getElementById("bindsetSelectorContainer");"alias"!==this.cache.currentEnvironment&&this.cache.preferences.bindsetsEnabled&&e?(t&&(t.style.display="block"),await this.refreshActiveBindset(),this.De=!0):t&&(t.style.display="none")}async refreshActiveBindset(e=void 0){try{if(void 0!==e){const t=e||"Primary Bindset";return this.cache.activeBindset=t,void this.updateBindsetBanner()}this.cache.activeBindset?this.updateBindsetBanner():console.warn("[CommandChainUI] No active bindset in cache - ComponentBase state sync may be incomplete")}catch(e){console.error("[CommandChainUI] Failed to refresh active bindset state",e)}}async getCommandsForCurrentSelection(){if("alias"===this.cache.currentEnvironment)return await this.request("command:get-for-selected-key",{key:this.cache.selectedAlias,environment:this.cache.currentEnvironment});const e=this.cache.selectedKey;return e?!0===this.cache.preferences?.bindsetsEnabled&&this.cache.activeBindset&&"Primary Bindset"!==this.cache.activeBindset?await this.request("bindset:get-key-commands",{bindset:this.cache.activeBindset,environment:this.cache.currentEnvironment,key:e}):await this.request("data:get-key-commands",{environment:this.cache.currentEnvironment,key:e}):[]}updateBindsetBanner(){try{const e=this.document.querySelector(".chain-header");if(!e)return;let t=this.document.getElementById("bindsetBanner");if(!this.cache.activeBindset||"Primary Bindset"===this.cache.activeBindset)return void(t&&t.remove());e.style.flexWrap="wrap",t||(t=this.document.createElement("div"),t.id="bindsetBanner",t.className="bindset-banner",Object.assign(t.style,{marginTop:"4px",padding:"0.125rem 0.5rem",background:"#3a3d42",color:"#fff",borderRadius:"4px",fontSize:"0.85em",flex:"0 0 100%",textAlign:"center"}),e.appendChild(t)),t.textContent=this.cache.activeBindset}catch(e){console.error("[CommandChainUI] Failed to update bindset banner",e)}}async copyAliasToClipboard(){const e=this.document.getElementById("aliasPreview"),t=e?.textContent?.trim();if(t)try{const e=await this.request("utility:copy-to-clipboard",{text:t});if(e?.success){const t=this.i18n.t(e?.message||"content_copied_to_clipboard");this.showToast(t,"success")}else{const t=this.i18n.t(e?.message||"failed_to_copy_to_clipboard");this.showToast(t,"error")}}catch(e){console.error("Failed to copy alias to clipboard:",e),this.showToast(this.i18n.t("failed_to_copy_to_clipboard"),"error")}else this.showToast(this.i18n.t("nothing_to_copy"),"warning")}async copyCommandPreviewToClipboard(){const e=this.document.getElementById("commandPreview"),t=e?.textContent?.trim();if(t)try{const e=await this.request("utility:copy-to-clipboard",{text:t});if(e?.success){const t=this.i18n.t(e?.message||"content_copied_to_clipboard");this.showToast(t,"success")}else{const t=this.i18n.t(e?.message||"failed_to_copy_to_clipboard");this.showToast(t,"error")}}catch(e){console.error("Failed to copy command preview to clipboard:",e);const t=this.i18n.t("failed_to_copy_to_clipboard");this.showToast(t,"error")}else this.showToast(this.i18n.t("nothing_to_copy"),"warning")}hasRequiredData(){return this.cache&&this.cache.currentEnvironment}performInitialRender(){this.render().catch(e=>{console.error("[CommandChainUI] Initial render failed:",e)})}}class ci extends re{constructor({eventBus:e,i18n:t}={}){super(e),this.componentName="KeyBrowserService",this.i18n=t,this.eventBus&&(this.respond("key:get-all",()=>this.getKeys()),this.respond("key:get-all-sectional",()=>this.getSectionalKeys()),this.respond("bindset:get-available",()=>this.getAvailableBindsets()),this.respond("bindset:toggle-collapse",({bindsetName:e})=>this.toggleBindsetCollapse(e)),this.respond("bindset:get-collapsed-state",({bindsetName:e})=>this.getBindsetCollapsedState(e)),this.respond("key:categorize-by-command",({keysWithCommands:e,allKeys:t})=>this.categorizeKeys(e,t)),this.respond("key:categorize-by-type",({keysWithCommands:e,allKeys:t})=>this.categorizeKeysByType(e,t)),this.respond("key:compare",({keyA:e,keyB:t})=>this.compareKeys(e,t)),this.respond("key:detect-types",({keyName:e})=>this.detectKeyTypes(e)),this.respond("key:sort",({keys:e})=>this.sortKeys(e)),this.respond("key:filter",({keys:e,filter:t})=>this.filterKeys(e,t)),this.respond("key:show-all",({keys:e})=>this.showAllKeys(e)),this.respond("key:toggle-category",({categoryId:e,mode:t})=>this.toggleKeyCategory(e,t)),this.respond("key:get-category-state",({categoryId:e,mode:t})=>this.getCategoryState(e,t)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&(this.updateCacheFromProfile(t),this.emit("key:list-changed",{keys:this.getKeys()}))}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{this.cache.currentProfile=e,i&&(this.cache.currentEnvironment=i),this.updateCacheFromProfile(t),this.emit("key:list-changed",{keys:this.getKeys()})}),this.addEventListener("environment:changed",async e=>{("string"==typeof e?e:e?.environment)&&this.emit("key:list-changed",{keys:this.getKeys()})}),this.addEventListener("profile-modified",()=>{this.emit("key:list-changed",{keys:this.getKeys()})}),this.addEventListener("bindset:active-changed",({bindset:e})=>{this.cache.activeCommandChainBindset=e}),this.addEventListener("bindset:modified",({bindsetName:e})=>{this.emit("bindset-section:refresh-needed",{bindsetName:e})})}updateCacheFromProfile(e){e&&console.log("[KeyBrowserService] Profile updated - ComponentBase handles caching automatically")}getKeys(){return this.cache.keys||{}}async categorizeKeys(e,t){const i={unknown:{name:"Unknown",icon:"fas fa-question-circle",keys:new Set,priority:0}};try{if(await this.request("data:has-commands")){const e=await this.request("data:get-commands");Object.entries(e).forEach(([e,t])=>{i[e]={name:t.name,icon:t.icon,keys:new Set,priority:1}})}}catch(e){console.warn("KeyBrowserService: Failed to get command categories:",e)}return await Promise.all(t.map(async t=>{const n=e[t]||[];if(!n||0===n.length)return void i.unknown.keys.add(t);const a=new Set;await Promise.all(n.map(async e=>{const t=e.category||e.type;if(t&&i[t])a.add(t);else try{const t=await this.request("parser:parse-command-string",{commandString:e.command,options:{generateDisplayText:!1}});if(t.commands&&t.commands.length>0){const e=t.commands[0].category;i[e]&&a.add(e)}}catch(e){i.custom||(i.custom={name:this.i18n.t("custom"),icon:"fas fa-cog",keys:new Set,priority:2})}})),a.size>0?a.forEach(e=>i[e].keys.add(t)):(i.custom||(i.custom={name:this.i18n.t("custom"),icon:"fas fa-cog",keys:new Set,priority:2}),i.custom.keys.add(t))})),Object.values(i).forEach(e=>{e.keys=Array.from(e.keys).sort((e,t)=>this.compareKeys(e,t))}),i}detectKeyTypes(e){const t=[];return/^F[0-9]+$/.test(e)&&t.push("function"),/^[A-Z0-9]$/.test(e)&&t.push("alphanumeric"),/^NUMPAD/.test(e)&&t.push("numberpad"),/(Ctrl|Alt|Shift)/.test(e)&&t.push("modifiers"),/(UP|DOWN|LEFT|RIGHT|HOME|END|PGUP|PGDN)/.test(e)&&t.push("navigation"),/(ESC|TAB|CAPS|PRINT|SCROLL|PAUSE|Space|Enter|Escape)/.test(e)&&t.push("system"),/MOUSE|WHEEL/.test(e)&&t.push("mouse"),0===t.length&&/[^A-Za-z0-9]/.test(e)&&t.push("symbols"),0===t.length&&t.push("other"),t}categorizeKeysByType(e,t){const i={function:{name:this.i18n.t("key_type.function_keys"),icon:"fas fa-keyboard",keys:new Set,priority:1},alphanumeric:{name:this.i18n.t("key_type.letters_numbers"),icon:"fas fa-font",keys:new Set,priority:2},numberpad:{name:this.i18n.t("key_type.numberpad"),icon:"fas fa-calculator",keys:new Set,priority:3},modifiers:{name:this.i18n.t("key_type.modifier_keys"),icon:"fas fa-hand-paper",keys:new Set,priority:4},navigation:{name:this.i18n.t("key_type.navigation"),icon:"fas fa-arrows-alt",keys:new Set,priority:5},system:{name:this.i18n.t("key_type.system_keys"),icon:"fas fa-cogs",keys:new Set,priority:6},mouse:{name:this.i18n.t("key_type.mouse_wheel"),icon:"fas fa-mouse",keys:new Set,priority:7},symbols:{name:this.i18n.t("key_type.symbols_punctuation"),icon:"fas fa-at",keys:new Set,priority:8},other:{name:this.i18n.t("key_type.other_keys"),icon:"fas fa-question-circle",keys:new Set,priority:9}};return t.forEach(e=>{this.detectKeyTypes(e).forEach(t=>(i[t]||i.other).keys.add(e))}),Object.values(i).forEach(e=>{e.keys=Array.from(e.keys).sort((e,t)=>this.compareKeys(e,t))}),i}compareKeys(e,t){const i=e.match(/^F(\d+)$/),n=t.match(/^F(\d+)$/);if(i&&n)return parseInt(i[1])-parseInt(n[1]);if(i&&!n)return-1;if(!i&&n)return 1;const a=/^\d+$/.test(e),s=/^\d+$/.test(t);if(a&&s)return parseInt(e)-parseInt(t);if(a&&!s)return-1;if(!a&&s)return 1;const o=/^[A-Z]$/.test(e),r=/^[A-Z]$/.test(t);if(o&&r)return e.localeCompare(t);if(o&&!r)return-1;if(!o&&r)return 1;const c=["Space","Tab","Enter","Escape"],l=c.indexOf(e),d=c.indexOf(t);return-1!==l&&-1!==d?l-d:-1!==l&&-1===d?-1:-1===l&&-1!==d?1:e.localeCompare(t)}sortKeys(e){return Array.isArray(e)?[...e].sort((e,t)=>this.compareKeys(e,t)):[]}filterKeys(e,t=""){if(!Array.isArray(e))return[];if(!t)return e;const i=t.toString().toLowerCase();return e.filter(e=>(e||"").toLowerCase().includes(i))}showAllKeys(e){return Array.isArray(e)?e:[]}toggleKeyCategory(e,t="command"){if(!e)return!1;const i="key-type"===t?`keyTypeCategory_${e}_collapsed`:`keyCategory_${e}_collapsed`,n=!("true"===localStorage.getItem(i));return localStorage.setItem(i,n),n}getCategoryState(e,t="command"){if(!e)return!1;const i="key-type"===t?`keyTypeCategory_${e}_collapsed`:`keyCategory_${e}_collapsed`;return"true"===localStorage.getItem(i)}async getAvailableBindsets(){try{console.log("[KeyBrowserService] Raw cache.bindsetNames:",this.cache.bindsetNames);const e=["Primary Bindset",...(this.cache.bindsetNames||[]).filter(e=>"Primary Bindset"!==e)];return console.log("[KeyBrowserService] Available bindsets:",e),e}catch(e){return console.warn("[KeyBrowserService] Failed to get available bindsets:",e),["Primary Bindset"]}}async getSectionalKeys(){try{const e=await this.getAvailableBindsets();console.log("[KeyBrowserService] Processing bindsets for sections:",e);const t={};for(const i of e){const e=this.getBindsetCollapsedState(i);let n=[];if("Primary Bindset"===i)n=Object.keys(this.getKeys()||{});else try{const e=this.cache.profile,t=this.cache.currentEnvironment||"space";console.log(`[KeyBrowserService] Getting keys for bindset "${i}" in environment "${t}"`),e?.bindsets?.[i]?.[t]?.keys?(n=Object.keys(e.bindsets[i][t].keys),console.log(`[KeyBrowserService] Found ${n.length} keys for bindset "${i}":`,n)):(console.log(`[KeyBrowserService] No keys found for bindset "${i}" in environment "${t}"`),n=[])}catch(e){console.warn(`[KeyBrowserService] Failed to get keys for bindset "${i}":`,e),n=[]}const a=this.sortKeys(n);t[i]={name:i,keys:a,isCollapsed:e,keyCount:a.length}}return t}catch(e){console.error("[KeyBrowserService] Failed to get sectional keys:",e);const t=this.sortKeys(Object.keys(this.getKeys()||{}));return{"Primary Bindset":{name:"Primary Bindset",keys:t,isCollapsed:!1,keyCount:t.length}}}}toggleBindsetCollapse(e){if(!e)return!1;const t=`bindsetSection_${e}_collapsed`,i=!("true"===localStorage.getItem(t));return localStorage.setItem(t,i),this.emit("bindset-section:collapse-changed",{bindsetName:e,isCollapsed:i}),i}getBindsetCollapsedState(e){if(!e)return!1;const t=`bindsetSection_${e}_collapsed`;return"true"===localStorage.getItem(t)}}class li extends vt{constructor({eventBus:e,ui:t=null,document:i=null}={}){super(e),this.componentName="PreferencesUI",this.ui=t,this.document=i||("undefined"!=typeof window?window.document:null),this.eventsSetup=!1,this.settingDefinitions={language:{type:"select",element:"languageSelect"},translateGeneratedMessages:{type:"boolean",element:"translateGeneratedMessagesCheckbox"},autoSave:{type:"boolean",element:"autoSaveCheckbox"},autoSync:{type:"boolean",element:"autoSync"},autoSyncInterval:{type:"select",element:"autoSyncInterval"},bindToAliasMode:{type:"boolean",element:"bindToAliasModeCheckbox"},bindsetsEnabled:{type:"boolean",element:"bindsetsEnabledCheckbox"}},this.pendingSettings={}}onInit(){this.request("preferences:init").then(()=>{this.populatePreferencesModal()}),this.setupEventListeners()}setupEventListeners(){this.eventBus.on("preferences:show",()=>{this.showPreferences()}),this.eventBus.on("sync:folder-set",()=>{this.updateFolderDisplay()}),this.eventBus.on("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};void 0===t.autoSync&&void 0===t.autoSyncInterval||this.notifyAutoSyncSettingsChanged()}),document.querySelectorAll(".category-item").forEach(e=>{this.onDom(e,"click","pref-cat",e=>{const t=e.currentTarget.dataset.category;this.switchCategory(t)})}),this.onDom("savePreferencesBtn","click","pref-save",()=>{this.saveAllSettings(!0)}),this.setupSettingControls();const e=document.getElementById("setSyncFolderBtn");e&&e.addEventListener("click",async()=>{if(console.log("[PreferencesUI] setSyncFolderBtn clicked"),window.stoSync?.setSyncFolder)try{const e=await window.stoSync.setSyncFolder(!0);console.log("[PreferencesUI] setSyncFolder returned",{hasHandle:!!e,name:e?.name}),e&&(await this.request("preferences:load-settings"),this.updateFolderDisplay(),console.log("[PreferencesUI] settings reloaded after setSyncFolder"))}catch(e){console.error("[PreferencesUI] setSyncFolder failed",e)}})}setupSettingControls(){Object.entries(this.settingDefinitions).forEach(([e,t])=>{const i=document.getElementById(t.element);if(i)switch("bindsetsEnabled"===e&&(i.disabled=!(this.pendingSettings.bindToAliasMode||i.checked)),t.type){case"boolean":this.onDom(i,"change",`pref-${e}`,t=>{this.handleSettingChange(e,t.target.checked)});break;case"select":this.onDom(i,"change",`pref-${e}`,t=>{this.handleSettingChange(e,t.target.value)})}})}switchCategory(e){document.querySelectorAll(".category-item").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-category="${e}"]`);t&&t.classList.add("active"),document.querySelectorAll(".settings-panel").forEach(e=>e.classList.remove("active"));const i=document.getElementById(`${e}-settings`);i&&i.classList.add("active")}async updateSetting(e,t){await this.setSetting(e,t),"syncFolderName"!==e&&"syncFolderPath"!==e||this.updateFolderDisplay()}updateUI(e,t){const i=this.settingDefinitions[e];if(!i)return;const n=document.getElementById(i.element);n&&("boolean"===i.type?n.checked=!!t:"select"===i.type&&(n.value=t),"bindToAliasMode"===e&&this.updateBindsetsCheckboxState(t))}async saveAllSettings(e=!0){if(console.log("[PreferencesUI] saveAllSettings called",{manual:e,pending:{...this.pendingSettings}}),Object.keys(this.pendingSettings).length>0){const e={...await this.request("preferences:get-settings"),...this.pendingSettings};await this.request("preferences:set-settings",e),this.pendingSettings={},console.log("[PreferencesUI] pending settings applied")}const t=await this.saveSettings();console.log("[PreferencesUI] preferences:save-settings result",{ok:t}),t&&e&&this.ui?.showToast&&this.emit("toast:show",{message:Q.t("preferences_saved"),type:"success"}),this.notifyAutoSyncSettingsChanged(),await this.emit("modal:hide",{modalId:"preferencesModal"},{synchronous:!0})}async showPreferences(){console.log("[PreferencesUI] showPreferences"),await this.request("preferences:load-settings"),this.pendingSettings={};const e=await this.request("preferences:get-settings");Object.entries(e).forEach(([e,t])=>this.updateUI(e,t)),this.updateFolderDisplay(),this.emit("modal:show",{modalId:"preferencesModal"})}async populatePreferencesModal(){await this.request("preferences:load-settings")}async updateFolderDisplay(){const e=await this.request("preferences:get-settings"),{syncFolderName:t,syncFolderPath:i}=e;console.log("[PreferencesUI] updateFolderDisplay",{syncFolderName:t,syncFolderPath:i});const n=this.document.getElementById("currentSyncFolder");n&&(t?(n.textContent=t,n.removeAttribute("data-i18n")):(n.textContent=Q.t("no_folder_selected"),n.setAttribute("data-i18n","no_folder_selected")))}async notifyAutoSyncSettingsChanged(){this.emit("preferences:autosync-settings-changed")}async setSetting(e,t){await this.request("preferences:set-setting",{key:e,value:t}),this.updateUI(e,t)}async saveSettings(){return await this.request("preferences:save-settings")}handleSettingChange(e,t){"bindToAliasMode"===e||"bindsetsEnabled"===e?(this.pendingSettings[e]=t,this.updateUI(e,t),"bindToAliasMode"===e&&(this.updateBindsetsCheckboxState(t),t||(this.pendingSettings.bindsetsEnabled=!1))):this.updateSetting(e,t)}updateBindsetsCheckboxState(e=null){const t=document.getElementById("bindsetsEnabledCheckbox");if(!t)return;let i=e;if(null===i){const e=this.pendingSettings.bindToAliasMode;i=void 0!==e?e:t.checked}t.disabled=!i,i||(t.checked=!1,this.pendingSettings.bindsetsEnabled=!1)}}class di extends re{constructor({eventBus:e,i18n:t,ui:i}={}){super(e),this.componentName="AliasService",this.i18n=t,this.ui=i,this.eventBus&&(this.respond("alias:add",({name:e,description:t}={})=>this.addAlias(e,t)),this.respond("alias:delete",({name:e}={})=>this.deleteAlias(e)),this.respond("alias:duplicate-with-name",({sourceName:e,newName:t}={})=>this.duplicateAliasWithName(e,t)),this.respond("alias:validate-name",({name:e}={})=>this.isValidAliasName(e)),this.respond("alias:import-file",({content:e}={})=>this.importAliasFile(e)))}onInit(){this.setupEventListeners()}setupEventListeners(){this.eventBus&&(this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{this.cache.currentProfile=e,this.cache.currentEnvironment=i||"space",this.updateCacheFromProfile(t)}),this.addEventListener("environment:changed",({environment:e})=>{e&&(this.cache.currentEnvironment=e||"space")}))}updateCacheFromProfile(e){e&&(this.cache.aliases=e.aliases||{},this.cache.profile=e)}async addAlias(e,t=""){if(!await this.isValidAliasName(e))return{success:!1,error:"invalid_alias_name",params:{name:e}};if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(this.cache.aliases[e])return{success:!1,error:"alias_already_exists",params:{name:e}};try{return await this.request("selection:select-alias",{aliasName:e,skipPersistence:!0}),await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{aliases:{[e]:{description:t,commands:[],type:"alias"}}}}),this.emit("alias-created",{name:e}),{success:!0,message:"alias_created",data:{name:e}}}catch(e){return console.error("[AliasService] Failed to add alias:",e),{success:!1,error:"failed_to_add_alias"}}}async deleteAlias(e){if(!this.cache.currentProfile)return{success:!1,error:"no_profile_selected"};if(!this.cache.aliases[e])return{success:!1,error:"alias_not_found",params:{name:e}};try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,delete:{aliases:[e]}}),this.emit("alias-deleted",{name:e}),{success:!0,message:"alias_deleted",data:{name:e}}}catch(e){return console.error("[AliasService] Failed to delete alias:",e),{success:!1,error:"failed_to_delete_alias"}}}async duplicateAliasWithName(e,t){if(!e||!t)return{success:!1,error:"invalid_alias_name"};if(!this.cache.aliases[e])return{success:!1,error:"alias_not_found",params:{name:e}};if(!await this.isValidAliasName(t))return{success:!1,error:"invalid_alias_name",params:{name:t}};if(this.cache.aliases[t])return{success:!1,error:"alias_already_exists",params:{name:t}};const i=this.cache.aliases[e];try{return await this.request("data:update-profile",{profileId:this.cache.currentProfile,add:{aliases:{[t]:{description:i.description,commands:i.commands,type:i.type||"alias"}}}}),this.cache.aliases[t]={description:i.description,commands:i.commands,type:i.type||"alias"},this.emit("alias-created",{name:t}),this.emit("alias-duplicated",{from:e,to:t}),{success:!0,message:"alias_duplicated",data:{from:e,to:t}}}catch(e){return console.error("[AliasService] Failed to duplicate alias with name:",e),{success:!1,error:"failed_to_duplicate_alias"}}}async isValidAliasName(e){if(!e||"string"!=typeof e)return!1;try{const{isAliasNameAllowed:t}=await Promise.resolve().then(function(){return ei});return t(e)}catch(t){return/^[A-Za-z][A-Za-z0-9_]*$/.test(e)&&e.length<=50}}importAliasFile(e){const t=this.cache.currentProfile;return request(this.eventBus,"import:alias-file",{content:e,profileId:t})}}class mi extends re{constructor({eventBus:e=null,i18n:t}={}){super(e),this.componentName="GamepadCaptureService",this.i18n=t,this.isCapturing=!1,this.connectedGamepads=new Map,this.activeGamepadIndex=null,this.pollFrameId=null,this.deadzone=.15,this.triggerThreshold=.1,this.isAvailable=!1,this.customMappings=new Map,this.isCalibrating=!1,this.calibrationGamepadIndex=null,this.calibrationStep=null,this.calibrationSteps=[],this.calibrationCallback=null,this.boundGamepadConnected=this.handleGamepadConnected.bind(this),this.boundGamepadDisconnected=this.handleGamepadDisconnected.bind(this)}onInit(){this.checkAvailability(),this.isAvailable&&(this.setupGamepadEventListeners(),this.scanInitialGamepads(),this.loadCustomMappings()),this.respond("gamepad:start-capture",this.startCapture.bind(this)),this.respond("gamepad:stop-capture",this.stopCapture.bind(this)),this.respond("gamepad:get-connected",this.getConnectedGamepads.bind(this)),this.respond("gamepad:select-active",this.selectActiveGamepad.bind(this)),this.respond("gamepad:set-deadzone",this.setDeadzone.bind(this)),this.respond("gamepad:start-calibration",this.startCalibration.bind(this)),this.respond("gamepad:calibrate-button",this.calibrateButton.bind(this)),this.respond("gamepad:cancel-calibration",this.cancelCalibration.bind(this)),this.respond("gamepad:get-custom-mapping",this.getCustomMapping.bind(this)),this.respond("gamepad:clear-custom-mapping",this.clearCustomMapping.bind(this)),this.respond("gamepad:get-modifiers",this.getModifiers.bind(this))}checkAvailability(){if("undefined"!=typeof window)return!1===window.isSecureContext?(this.isAvailable=!1,this.emit("gamepad-unavailable",{reason:"insecure_context"}),void this.emitGamepadUnavailableMessage("insecure_context")):navigator.getGamepads?void(this.isAvailable=!0):(this.isAvailable=!1,this.emit("gamepad-unavailable",{reason:"unsupported"}),void this.emitGamepadUnavailableMessage("unsupported"));this.isAvailable=!1}emitGamepadUnavailableMessage(e){let t;switch(e){case"insecure_context":t="gamepad_unavailable_secure_context";break;case"unsupported":t="gamepad_unsupported";break;default:t="gamepad_unavailable"}this.emit("toast:show",{message:this.i18n.t(t),type:"warning"})}setupGamepadEventListeners(){"undefined"!=typeof window&&(window.addEventListener("gamepadconnected",this.boundGamepadConnected),window.addEventListener("gamepaddisconnected",this.boundGamepadDisconnected))}removeGamepadEventListeners(){"undefined"!=typeof window&&(window.removeEventListener("gamepadconnected",this.boundGamepadConnected),window.removeEventListener("gamepaddisconnected",this.boundGamepadDisconnected))}scanInitialGamepads(){const e=navigator.getGamepads();for(let t=0;t<e.length;t++){const i=e[t];i&&this.handleGamepadConnection(i)}}handleGamepadConnected(e){this.handleGamepadConnection(e.gamepad)}handleGamepadConnection(e){const t={id:e.id,index:e.index,mapping:e.mapping||"",connected:e.connected,type:this.detectGamepadType(e),activeInputs:[],lastState:this.cloneGamepadState(e)};this.connectedGamepads.set(e.index,t),this.emit("gamepad:connected",{gamepad:t}),null===this.activeGamepadIndex&&(this.activeGamepadIndex=e.index,this.emit("gamepad:active-changed",{gamepadIndex:e.index}))}handleGamepadDisconnected(e){this.handleGamepadDisconnection(e.gamepad)}handleGamepadDisconnection(e){const t=this.connectedGamepads.get(e.index);t&&(this.connectedGamepads.delete(e.index),this.emit("gamepad:disconnected",{gamepad:t}),this.activeGamepadIndex===e.index&&(this.activeGamepadIndex=this.connectedGamepads.size>0?this.connectedGamepads.keys().next().value:null,this.emit("gamepad:active-changed",{gamepadIndex:this.activeGamepadIndex,gamepadsLeft:this.connectedGamepads.size})))}detectGamepadType(e){const t=e.id.toLowerCase();return"standard"===e.mapping?"gamepad":t.includes("joystick")||t.includes("flight")||t.includes("stick")?"joystick":"generic"}cloneGamepadState(e){return{buttons:e.buttons.map(e=>({pressed:e.pressed,value:e.value})),axes:[...e.axes],timestamp:e.timestamp}}loadCustomMappings(){try{const e=localStorage.getItem("gamepad-custom-mappings");if(e){const t=JSON.parse(e);this.customMappings=new Map(Object.entries(t))}}catch(e){console.warn("Failed to load custom gamepad mappings:",e)}}saveCustomMappings(){try{const e=Object.fromEntries(this.customMappings);localStorage.setItem("gamepad-custom-mappings",JSON.stringify(e))}catch(e){console.warn("Failed to save custom gamepad mappings:",e)}}startPolling(){this.stopPolling(),this.boundPollGamepads=this.pollGamepads.bind(this),this.pollFrameId=requestAnimationFrame(this.boundPollGamepads),console.log("GamepadCaptureService: Started 60Hz polling loop")}stopPolling(){this.pollFrameId&&(cancelAnimationFrame(this.pollFrameId),this.pollFrameId=null),this.boundPollGamepads=null,console.log("GamepadCaptureService: Stopped polling loop")}pollGamepads(){if(!this.isCapturing)return;const e=navigator.getGamepads();for(let t=0;t<e.length;t++){const i=e[t];i&&(null!==this.activeGamepadIndex&&t===this.activeGamepadIndex&&this.processGamepadInput(i),this.updateGamepadState(i))}this.pollFrameId=requestAnimationFrame(this.boundPollGamepads)}processGamepadInput(e){const t=this.connectedGamepads.get(e.index);if(!t||!t.lastState)return;const i=t.lastState,n=[];let a=!1;e.buttons.forEach((t,s)=>{const o=i.buttons[s],r=t.pressed||t.value>=this.triggerThreshold;if(r!==(o.pressed||o.value>=this.triggerThreshold)){a=!0;const i={type:"button",index:s,value:t.value,pressed:r,threshold:this.triggerThreshold,name:this.getButtonName(s,e),standardMapping:"standard"===e.mapping,chordName:this.getButtonChordName(s,e)};r?(n.push(i),this.emit("gamepad:button-pressed",{gamepadIndex:e.index,input:i,timestamp:e.timestamp}),this.emitChordCaptured(n,e)):this.emit("gamepad:button-released",{gamepadIndex:e.index,input:i,timestamp:e.timestamp})}}),e.axes.forEach((t,s)=>{const o=i.axes[s]||0,r=Math.abs(t)>=this.deadzone;if(r!==Math.abs(o)>=this.deadzone||r&&Math.abs(t-o)>=.01){a=!0;const i={type:"axis",index:s,value:t,pressed:r,threshold:this.deadzone,name:this.getAxisName(s,e),standardMapping:"standard"===e.mapping,chordName:this.getAxisChordName(s,t,e)};r?(n.push(i),this.emit("gamepad:axis-moved",{gamepadIndex:e.index,input:i,timestamp:e.timestamp}),this.emitChordCaptured(n,e)):this.emit("gamepad:axis-centered",{gamepadIndex:e.index,input:i,timestamp:e.timestamp})}}),t.activeInputs=n,this.connectedGamepads.set(e.index,t),a&&this.emit("gamepad:state-update",{gamepadIndex:e.index,timestamp:e.timestamp,connected:e.connected,activeInputs:n})}emitChordCaptured(e,t){e&&0!==e.length&&this.request("keycapture:get-modifiers").then(i=>{const n=[...i||[],...e.map(e=>e.chordName?e.chordName:"button"===e.type?`Joy${e.index+1}`:`Axis${e.index+1}`)],a=this.createChordString(n);this.emit("chord-captured",{chord:a,context:"keySelectionModal",source:"gamepad",gamepadIndex:t.index,gamepadInputs:e,timestamp:t.timestamp})}).catch(i=>{console.warn("GamepadCaptureService: Could not get keyboard modifiers:",i);const n=e.map(e=>e.chordName?e.chordName:"button"===e.type?`Joy${e.index+1}`:`Axis${e.index+1}`),a=this.createChordString(n);this.emit("chord-captured",{chord:a,context:"keySelectionModal",source:"gamepad",gamepadIndex:t.index,gamepadInputs:e,timestamp:t.timestamp})})}createChordString(e){return e&&0!==e.length?[...e].sort((e,t)=>{const i=["Ctrl","Alt","Shift","Meta"],n=i.some(t=>e.includes(t)),a=i.some(e=>t.includes(e));return n&&!a?-1:!n&&a?1:e.localeCompare(t)}).join("+"):""}getButtonName(e,t){return"standard"===t.mapping&&["A","B","X","Y","LB","RB","LT","RT","Select","Start","LS","RS","D-pad Up","D-pad Down","D-pad Left","D-pad Right"][e]||`Button ${e}`}getButtonChordName(e,t){return"standard"===t.mapping&&{0:"Joy1",1:"Joy2",2:"Joy3",3:"Joy4",4:"Joy5",5:"Joy6",6:"Joy7",7:"Joy8",8:"Joy9",9:"Joy10",10:"Joy11",11:"Joy12",12:"Joypad_up",13:"Joypad_down",14:"Joypad_left",15:"Joypad_right"}[e]||`Joy${e+1}`}getAxisName(e,t){return"standard"===t.mapping&&["Left Stick X","Left Stick Y","Right Stick X","Right Stick Y"][e]||`Axis ${e}`}getAxisChordName(e,t,i){if("standard"===i.mapping){if(Math.abs(t)<this.deadzone)return null;switch(e){case 0:return t>0?"Lstick_right":"Lstick_left";case 1:return t>0?"Lstick_down":"Lstick_up";case 2:return t>0?"Rstick_right":"Rstick_left";case 3:return t>0?"Rstick_down":"Rstick_up";default:return`Axis${e+1}_${t>0?"positive":"negative"}`}}return Math.abs(t)>=this.deadzone?`Axis${e+1}_${t>0?"positive":"negative"}`:null}updateGamepadState(e){const t=this.connectedGamepads.get(e.index);t&&(t.lastState=this.cloneGamepadState(e),this.connectedGamepads.set(e.index,t))}startCapture(){return this.isAvailable?this.isCapturing?(console.warn("GamepadCaptureService: Capture already in progress"),!0):(this.isCapturing=!0,console.log("GamepadCaptureService: Started gamepad capture"),this.emit("gamepad:capture-started",{isCapturing:!0}),this.startPolling(),!0):(console.warn("GamepadCaptureService: Cannot start capture - Gamepad API not available"),!1)}stopCapture(){return!this.isCapturing||(this.isCapturing=!1,this.stopPolling(),console.log("GamepadCaptureService: Stopped gamepad capture"),this.emit("gamepad:capture-stopped",{isCapturing:!1}),!0)}getConnectedGamepads(){return Array.from(this.connectedGamepads.values()).map(e=>({index:e.index,id:e.id,type:e.type,mapping:e.mapping,connected:e.connected}))}selectActiveGamepad({gamepadIndex:e}){if(this.connectedGamepads.has(e)){const t=this.activeGamepadIndex;return this.activeGamepadIndex=e,console.log(`GamepadCaptureService: Selected active gamepad ${e}`),this.emit("gamepad:active-changed",{previousIndex:t,activeIndex:e,gamepad:this.connectedGamepads.get(e)}),!0}return console.warn(`GamepadCaptureService: Gamepad ${e} not found`),!1}setDeadzone({deadzone:e=null,triggerThreshold:t=null}){const i=this.deadzone,n=this.triggerThreshold;if(null!==e&&"number"==typeof e){if(!(e>=0&&e<=1))return console.warn(`GamepadCaptureService: Invalid deadzone value ${e}, must be between 0.0 and 1.0`),!1;this.deadzone=e,console.log(`GamepadCaptureService: Set deadzone to ${e}`)}if(null!==t&&"number"==typeof t){if(!(t>=0&&t<=1))return console.warn(`GamepadCaptureService: Invalid trigger threshold value ${t}, must be between 0.0 and 1.0`),!1;this.triggerThreshold=t,console.log(`GamepadCaptureService: Set trigger threshold to ${t}`)}return this.deadzone===i&&this.triggerThreshold===n||this.emit("gamepad:deadzone-changed",{deadzone:this.deadzone,triggerThreshold:this.triggerThreshold,oldDeadzone:i,oldTriggerThreshold:n}),!0}startCalibration({gamepadIndex:e,steps:t=null,callback:i=null}){if(!this.isAvailable)return{success:!1,error:"gamepad_unavailable",message:this.i18n.t("gamepad_unavailable")};const n=this.connectedGamepads.get(e);if(!n)return{success:!1,error:"gamepad_not_found",message:this.i18n.t("gamepad_not_found")};if("standard"===n.mapping)return{success:!1,error:"standard_controller",message:this.i18n.t("gamepad_calibration_standard_not_needed")};const a=t||this.getDefaultCalibrationSteps();this.isCalibrating=!0,this.calibrationGamepadIndex=e,this.calibrationSteps=a,this.calibrationStep=0,this.calibrationCallback=i;const s=n.id;return this.customMappings.has(s)||this.customMappings.set(s,{buttons:{},axes:{},created:(new Date).toISOString(),lastUpdated:(new Date).toISOString()}),console.log(`GamepadCaptureService: Started calibration for gamepad ${e}`),this.emit("gamepad:calibration-started",{gamepadIndex:e,gamepadId:n.id,steps:a,currentStep:0}),this.emitCalibrationPrompt(),{success:!0,gamepadIndex:e,steps:a,currentStep:0}}getDefaultCalibrationSteps(){return[{id:"button_a",name:"A Button (bottom face)",type:"button",chordName:"Joy1"},{id:"button_b",name:"B Button (right face)",type:"button",chordName:"Joy2"},{id:"button_x",name:"X Button (left face)",type:"button",chordName:"Joy3"},{id:"button_y",name:"Y Button (top face)",type:"button",chordName:"Joy4"},{id:"button_lb",name:"Left Bumper",type:"button",chordName:"Joy5"},{id:"button_rb",name:"Right Bumper",type:"button",chordName:"Joy6"},{id:"button_lt",name:"Left Trigger",type:"button",chordName:"Joy7"},{id:"button_rt",name:"Right Trigger",type:"button",chordName:"Joy8"},{id:"button_select",name:"Select/Back Button",type:"button",chordName:"Joy9"},{id:"button_start",name:"Start/Forward Button",type:"button",chordName:"Joy10"},{id:"button_ls",name:"Left Stick Click",type:"button",chordName:"Joy11"},{id:"button_rs",name:"Right Stick Click",type:"button",chordName:"Joy12"},{id:"dpad_up",name:"D-Pad Up",type:"button",chordName:"Joypad_up"},{id:"dpad_down",name:"D-Pad Down",type:"button",chordName:"Joypad_down"},{id:"dpad_left",name:"D-Pad Left",type:"button",chordName:"Joypad_left"},{id:"dpad_right",name:"D-Pad Right",type:"button",chordName:"Joypad_right"},{id:"left_stick_x",name:"Left Stick Left/Right",type:"axis",chordNamePositive:"Lstick_right",chordNameNegative:"Lstick_left"},{id:"left_stick_y",name:"Left Stick Up/Down",type:"axis",chordNamePositive:"Lstick_down",chordNameNegative:"Lstick_up"},{id:"right_stick_x",name:"Right Stick Left/Right",type:"axis",chordNamePositive:"Rstick_right",chordNameNegative:"Rstick_left"},{id:"right_stick_y",name:"Right Stick Up/Down",type:"axis",chordNamePositive:"Rstick_down",chordNameNegative:"Rstick_up"}]}calibrateButton({gamepadIndex:e,buttonIndex:t=null,axisIndex:i=null,axisValue:n=null}){if(!this.isCalibrating||this.calibrationGamepadIndex!==e)return{success:!1,error:"not_calibrating",message:this.i18n.t("gamepad_not_calibrating")};const a=this.calibrationSteps[this.calibrationStep];if(!a)return{success:!1,error:"invalid_step",message:this.i18n.t("gamepad_calibration_invalid_step")};const s=this.connectedGamepads.get(e).id,o=this.customMappings.get(s);if("button"===a.type&&null!==t)o.buttons[a.id]={index:t,chordName:a.chordName,name:a.name},console.log(`GamepadCaptureService: Mapped ${a.name} to button ${t}`),this.emit("gamepad:button-calibrated",{gamepadIndex:e,stepId:a.id,buttonIndex:t,chordName:a.chordName});else{if("axis"!==a.type||null===i||null===n)return{success:!1,error:"invalid_input",message:this.i18n.t("gamepad_calibration_invalid_input")};o.axes[a.id]={index:i,chordNamePositive:a.chordNamePositive,chordNameNegative:a.chordNameNegative,name:a.name,polarity:n>0?"positive":"negative"},console.log(`GamepadCaptureService: Mapped ${a.name} to axis ${i}`),this.emit("gamepad:axis-calibrated",{gamepadIndex:e,stepId:a.id,axisIndex:i,chordNamePositive:a.chordNamePositive,chordNameNegative:a.chordNameNegative,polarity:n>0?"positive":"negative"})}return o.lastUpdated=(new Date).toISOString(),this.calibrationStep++,this.calibrationStep>=this.calibrationSteps.length?this.completeCalibration():(this.emitCalibrationPrompt(),{success:!0,stepCompleted:this.calibrationStep-1,nextStep:this.calibrationStep,totalSteps:this.calibrationSteps.length})}cancelCalibration({gamepadIndex:e}){if(!this.isCalibrating||this.calibrationGamepadIndex!==e)return{success:!1,error:"not_calibrating",message:this.i18n.t("gamepad_not_calibrating")};console.log(`GamepadCaptureService: Cancelled calibration for gamepad ${e}`);const t={success:!0,gamepadIndex:e,stepsCompleted:this.calibrationStep,totalSteps:this.calibrationSteps.length};return this.resetCalibrationState(),this.emit("gamepad:calibration-cancelled",t),t}getCustomMapping({gamepadIndex:e}){const t=this.connectedGamepads.get(e);if(!t)return{success:!1,error:"gamepad_not_found",message:this.i18n.t("gamepad_not_found")};const i=t.id,n=this.customMappings.get(i);return{success:!0,gamepadIndex:e,gamepadId:i,hasCustomMapping:!!n,mapping:n||null,isStandard:"standard"===t.mapping}}clearCustomMapping({gamepadIndex:e}){const t=this.connectedGamepads.get(e);if(!t)return{success:!1,error:"gamepad_not_found",message:this.i18n.t("gamepad_not_found")};const i=t.id,n=this.customMappings.has(i);return this.customMappings.delete(i),this.saveCustomMappings(),console.log(`GamepadCaptureService: Cleared custom mapping for gamepad ${e}`),this.emit("gamepad:mapping-cleared",{gamepadIndex:e,gamepadId:i,hadMapping:n}),{success:!0,gamepadIndex:e,gamepadId:i,hadMapping:n}}completeCalibration(){const e=this.calibrationGamepadIndex,t=this.connectedGamepads.get(e).id;console.log(`GamepadCaptureService: Completed calibration for gamepad ${e}`),this.saveCustomMappings();const i={success:!0,gamepadIndex:e,gamepadId:t,stepsCompleted:this.calibrationSteps.length};if("function"==typeof this.calibrationCallback)try{this.calibrationCallback(i)}catch(e){console.warn("GamepadCaptureService: Calibration callback error:",e)}return this.resetCalibrationState(),this.emit("gamepad:calibration-completed",i),i}resetCalibrationState(){this.isCalibrating=!1,this.calibrationGamepadIndex=null,this.calibrationStep=null,this.calibrationSteps=[],this.calibrationCallback=null}emitCalibrationPrompt(){const e=this.calibrationSteps[this.calibrationStep];if(!e)return;const t=this.i18n.t("gamepad_calibrate_prompt",{buttonName:e.name,stepNumber:this.calibrationStep+1,totalSteps:this.calibrationSteps.length});this.emit("gamepad:calibration-prompt",{gamepadIndex:this.calibrationGamepadIndex,step:this.calibrationStep,stepId:e.id,stepType:e.type,stepName:e.name,message:t,progress:{current:this.calibrationStep+1,total:this.calibrationSteps.length,percentage:Math.round((this.calibrationStep+1)/this.calibrationSteps.length*100)}})}getCustomButtonName(e,t){if("standard"===t.mapping)return this.getButtonName(e,t);const i=t.id,n=this.customMappings.get(i);if(!n)return this.getButtonName(e,t);for(const[t,i]of Object.entries(n.buttons))if(i.index===e)return i.name;return this.getButtonName(e,t)}getCustomButtonChordName(e,t){if("standard"===t.mapping)return this.getButtonChordName(e,t);const i=t.id,n=this.customMappings.get(i);if(!n)return this.getButtonChordName(e,t);for(const[t,i]of Object.entries(n.buttons))if(i.index===e)return i.chordName;return this.getButtonChordName(e,t)}getCustomAxisName(e,t){if("standard"===t.mapping)return this.getAxisName(e,t);const i=t.id,n=this.customMappings.get(i);if(!n)return this.getAxisName(e,t);for(const[t,i]of Object.entries(n.axes))if(i.index===e)return i.name;return this.getAxisName(e,t)}getCustomAxisChordName(e,t,i){if("standard"===i.mapping)return this.getAxisChordName(e,t,i);const n=i.id,a=this.customMappings.get(n);if(!a)return this.getAxisChordName(e,t,i);for(const[i,n]of Object.entries(a.axes))if(n.index===e&&Math.abs(t)>=this.deadzone)return t>0?n.chordNamePositive:n.chordNameNegative;return this.getAxisChordName(e,t,i)}getModifiers(){return this.request("keycapture:get-modifiers").then(e=>e||[]).catch(e=>(console.warn("GamepadCaptureService: Could not get keyboard modifiers:",e),[]))}onDestroy(){this.stopCapture(),this.removeGamepadEventListeners(),this.isCalibrating&&this.resetCalibrationState(),this.saveCustomMappings(),this.stopPolling(),this.connectedGamepads.clear(),this.customMappings.clear()}}class hi extends re{constructor({eventBus:e}={}){if(super(e),this.componentName="SelectionService",this.editingContext=null,this.cachedSelections={space:null,ground:null,alias:null},this.ne=[],this.Ne=null,this.Le=null,"undefined"!=typeof vi&&"function"==typeof vi.fn&&!vi.isMockFunction?.(this.emit)){const e=this.emit.bind(this);this.emit=vi.fn((...t)=>e(...t))}}onInit(){this.setupEventListeners(),this.setupRequestHandlers(),this.cache&&!this.cache.cachedSelections&&(this.cache.cachedSelections={...this.cachedSelections})}setCachedSelection(e,t){e&&(this.cachedSelections[e]=t,this.cache&&(this.cache.cachedSelections?this.cache.cachedSelections[e]=t:this.cache.cachedSelections={...this.cachedSelections}))}getCachedSelection(e){if(e)return Object.prototype.hasOwnProperty.call(this.cachedSelections,e)?this.cachedSelections[e]:this.cache?.cachedSelections&&Object.prototype.hasOwnProperty.call(this.cache.cachedSelections,e)?this.cache.cachedSelections[e]:void 0}setupEventListeners(){this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&(this.updateCacheFromProfile(t),this.validateCurrentSelectionAfterUpdate())}),this.addEventListener("profile:switched",({profileId:e,profile:t,environment:i})=>{if(console.log(`[SelectionService] profile:switched: profileId="${e}", env="${i}"`),this.updateCacheFromProfile(t),!t)return void(this.cachedSelections={space:null,ground:null,alias:null});t.selections&&(t.selections.space&&(this.cachedSelections.space=t.selections.space,this.setCachedSelection("space",t.selections.space)),t.selections.ground&&(this.cachedSelections.ground=t.selections.ground,this.setCachedSelection("ground",t.selections.ground)),t.selections.alias&&(this.cachedSelections.alias=t.selections.alias,this.setCachedSelection("alias",t.selections.alias)),console.log("[SelectionService] Restored cached selections from profile:",this.cachedSelections));const n=this.cachedSelections[this.cache.currentEnvironment];console.log(`[SelectionService] Validating and restoring selection for "${this.cache.currentEnvironment}": "${n}"`),n?(console.log(`[SelectionService] Setting initial selection from profile: "${n}" for env "${this.cache.currentEnvironment}"`),setTimeout(async()=>{"alias"===this.cache.currentEnvironment?(this.cache.selectedAlias=n,this.cache.selectedKey=null,this.emit("alias-selected",{name:n,source:"SelectionService"}),this.validateAliasExists(n)||(console.log(`[SelectionService] Cached alias "${n}" doesn't exist in current profile, clearing and auto-selecting`),await this.validateAndRestoreSelection("alias",null))):(this.cache.selectedKey=n,this.cache.selectedAlias=null,this.emit("key-selected",{key:n,environment:this.cache.currentEnvironment,source:"SelectionService"}),this.validateKeyExists(n,this.cache.currentEnvironment)||(console.log(`[SelectionService] Cached key "${n}" doesn't exist in current profile, clearing and auto-selecting`),await this.validateAndRestoreSelection(this.cache.currentEnvironment,null)))},0)):(console.log(`[SelectionService] No cached selection, validating for env "${this.cache.currentEnvironment}"`),setTimeout(async()=>{await this.validateAndRestoreSelection(this.cache.currentEnvironment,n)},0))}),this.addEventListener("environment:changed",async e=>{const t="string"==typeof e?e:e?.environment,i="object"==typeof e&&e?.fromEnvironment?e.fromEnvironment:this.cache.currentEnvironment;t&&t!==i&&await this.switchEnvironment(t,i)}),this.addEventListener("alias-deleted",async({name:e})=>{this.Le=e,this.cache.selectedAlias===e&&(this.cache.selectedAlias=null,this.setCachedSelection("alias",null),this.cache.aliases&&this.cache.aliases[e]&&delete this.cache.aliases[e],this.cache.profile?.aliases&&this.cache.profile.aliases[e]&&delete this.cache.profile.aliases[e],this.emit("alias-selected",{name:null,source:"SelectionService"}),"alias"===this.cache.currentEnvironment&&await this.autoSelectFirst("alias"))}),this.addEventListener("key-deleted",async({keyName:e})=>{if(this.Ne=e,this.cache.selectedKey===e){if(this.cache.selectedKey=null,this.cache.builds)for(const[t,i]of Object.entries(this.cache.builds))i.keys&&i.keys[e]&&(delete i.keys[e],this.setCachedSelection(t,null));this.cache.keys&&this.cache.keys[e]&&(delete this.cache.keys[e],this.setCachedSelection(this.cache.currentEnvironment,null)),this.emit("key-selected",{key:null,source:"SelectionService"}),"alias"!==this.cache.currentEnvironment&&await this.autoSelectFirst(this.cache.currentEnvironment)}})}setupRequestHandlers(){this.ne.push(this.respond("selection:select-alias",({aliasName:e,skipPersistence:t,isAuto:i,forceEmit:n})=>{const a={};return!0===t&&(a.skipPersistence=!0),!0===i&&(a.isAuto=!0),!0===n&&(a.forceEmit=!0),this.selectAlias(e,a)}),this.respond("selection:clear",({type:e})=>this.clearSelection(e)),this.respond("selection:get-selected",({environment:e})=>this.getSelectedItem(e)),this.respond("selection:get-state",()=>this.getSelectionState()),this.respond("selection:get-cached",({environment:e})=>this.getCachedSelection(e)),this.respond("selection:auto-select-first",({environment:e})=>this.autoSelectFirst(e)),this.respond("selection:set-editing-context",({context:e})=>this.setEditingContext(e)),this.respond("selection:get-editing-context",()=>this.editingContext),this.respond("key:get-selected",()=>this.cache.selectedKey),this.respond("key:select",({keyName:e,environment:t,bindset:i})=>this.selectKey(e,t,{bindset:i})),this.respond("alias:select",({aliasName:e})=>this.selectAlias(e)),this.respond("selection:select-key",({keyName:e,environment:t,bindset:i,skipPersistence:n,isAuto:a,forceEmit:s})=>{const o={bindset:i};return!0===n&&(o.skipPersistence=!0),!0===a&&(o.isAuto=!0),!0===s&&(o.forceEmit=!0),this.selectKey(e,t,o)}))}async selectKey(e,t=null,i={}){const n=t||this.cache.currentEnvironment,a=!0===i.isAuto,s=!0===i.skipPersistence,o=i.bindset||null,r=this.cache.selectedKey===e&&this.cache.currentEnvironment===n&&(o?this.cache.activeBindset===o:"Primary Bindset"===this.cache.activeBindset),c=!0===i.forceEmit||null==e||!a&&("auto"===this.ze||null==this.ze);return r&&!c||(this.cache.selectedKey=e,this.cache.selectedAlias=null,this.setCachedSelection(n,e),null==t&&(this.cache.currentEnvironment=n),s||await this.persistSelectionToProfile(n,e),await this.Ke(n,o),console.log(`[SelectionService] Emitting key-selected with: key=${e}, environment=${n}, bindset=${i.bindset||null}`),this.emit("key-selected",{key:e,environment:n,bindset:o,source:"SelectionService"}),this.ze=a?"auto":"manual"),e}async Ke(e,t){if("alias"===e)return;const i=this.cache?.preferences||{};if(!i.bindsetsEnabled||!i.bindToAliasMode)return;const n=this.cache?.activeBindset||"Primary Bindset";let a=null;if(t&&t!==n?a=t:t||"Primary Bindset"===n||(a="Primary Bindset"),a)try{await this.request("bindset-selector:set-active-bindset",{bindset:a})}catch(e){console.warn("[SelectionService] Failed to synchronize bindset context:",e)}}async selectAlias(e,t={}){const i=!0===t.isAuto,n=!0===t.skipPersistence,a=this.cache.selectedAlias===e,s=!0===t.forceEmit||null==e||!i&&("auto"===this.Re||null==this.Re);return a&&!s&&"alias"===this.cache.currentEnvironment||(this.cache.selectedAlias=e,this.cache.selectedKey=null,this.setCachedSelection("alias",e),n||await this.persistSelectionToProfile("alias",e),this.emit("alias-selected",{name:e,source:"SelectionService"}),this.Re=i?"auto":"manual"),e}clearSelection(e="all"){switch(e){case"key":this.cache.selectedKey=null;break;case"alias":this.cache.selectedAlias=null;break;case"editing":this.editingContext=null;break;default:this.cache.selectedKey=null,this.cache.selectedAlias=null,this.editingContext=null}"all"!==e&&"key"!==e||this.emit("key-selected",{key:null,source:"SelectionService"}),"all"!==e&&"alias"!==e||this.emit("alias-selected",{name:null,source:"SelectionService"})}getSelectedItem(e=null){return"alias"===(e||this.cache.currentEnvironment)?this.cache.selectedAlias:this.cache.selectedKey}getSelectionState(){return{selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,editingContext:this.editingContext,cachedSelections:{...this.cachedSelections},currentEnvironment:this.cache.currentEnvironment}}setEditingContext(e){return this.editingContext=e,this.emit("editing-context-changed",{context:e}),e}async switchEnvironment(e,t=null){const i=t??this.cache.currentEnvironment??this.cache.profile?.currentEnvironment??"space";"alias"===i&&this.cache.selectedAlias?(this.setCachedSelection("alias",this.cache.selectedAlias),console.log(`[SelectionService] Cached alias selection "${this.cache.selectedAlias}" before switching from ${i} to ${e}`),await this.persistSelectionToProfile("alias",this.cache.selectedAlias)):"alias"!==i&&this.cache.selectedKey&&(this.setCachedSelection(i,this.cache.selectedKey),console.log(`[SelectionService] Cached key selection "${this.cache.selectedKey}" for env "${i}" before switching to ${e}`),await this.persistSelectionToProfile(i,this.cache.selectedKey)),this.cache.currentEnvironment=e,this.je(e);let n=this.getCachedSelection(e);void 0===n&&(n=this.cache.profile?.selections?.[e]??null,this.setCachedSelection(e,n)),console.log(`[SelectionService] Switching to ${e}, cached selection: "${n}"`),"alias"===e?(this.cache.selectedKey=null,this.cache.selectedAlias=n??null,this.emit("key-selected",{key:null,source:"SelectionService"}),await this.validateAndRestoreSelection("alias",n)):(this.cache.selectedAlias=null,this.cache.selectedKey=n??null,this.emit("alias-selected",{name:null,source:"SelectionService"}),await this.validateAndRestoreSelection(e,n)),this.emit("environment:switched",{from:i,to:e,source:"SelectionService"}),setTimeout(async()=>{try{const e={};this.cachedSelections.space&&(e.space=this.cachedSelections.space),this.cachedSelections.ground&&(e.ground=this.cachedSelections.ground),this.cachedSelections.alias&&(e.alias=this.cachedSelections.alias),this.cache.currentProfile&&Object.keys(e).length>0&&await this.request("data:update-profile",{profileId:this.cache.currentProfile,updates:{properties:{selections:e}},updateSource:"SelectionService"})}catch(e){}},10)}je(e){if(!e)return;const t=this.cache.builds||this.cache.profile?.builds;t&&t[e]?.keys?this.cache.keys=t[e].keys:this.cache.profile?.keys&&e===this.cache.currentEnvironment?this.cache.keys=this.cache.profile.keys:this.cache.keys={}}async autoSelectFirst(e=null){if(!this.cache.profile||!this.cache.currentProfile)return console.log("[SelectionService] Profile data not loaded, skipping auto-selection"),null;const t=e||this.cache.currentEnvironment;if("alias"!==t){let e=this.cache.keys||{};if(t===this.cache.currentEnvironment&&0!==Object.keys(e).length||!this.cache.builds||(e=this.cache.builds[t]?.keys||{}),0===Object.keys(e).length)try{e=await this.request("data:get-keys",{environment:t})||{}}catch(e){return null}let i=Object.keys(e);if(this.Ne&&(i=i.filter(e=>e!==this.Ne)),i.length>0){const e=i[0];return await this.selectKey(e,t,{isAuto:!0,bindset:"Primary Bindset"}),this.Ne=null,e}return"alias"===this.cache.currentEnvironment?await this.selectAlias(null,{isAuto:!0}):await this.selectKey(null,this.cache.currentEnvironment,{isAuto:!0}),null}{let e=this.cache.aliases||{};if(0===Object.keys(e).length)try{e=await this.request("data:get-aliases")||{}}catch(e){return console.warn("[SelectionService] Failed to get aliases for auto-selection:",e),null}let t=Object.entries(e).filter(([e,t])=>"vfx-alias"!==t.type);if(this.Le&&(t=t.filter(([e])=>e!==this.Le)),t.length>0){const e=t[0][0];return await this.selectAlias(e,{isAuto:!0}),this.Le=null,e}}return null}validateKeyExists(e,t=null){if(!e)return!1;const i=t||this.cache.currentEnvironment,n=this.cache.profile;if(!n)return!1;const a=n.builds?.[i]?.keys?.[e];return void 0!==a&&Array.isArray(a)}validateAliasExists(e){if(!e)return!1;const t=this.cache.aliases||{};return Object.fromEntries(Object.entries(t).filter(([e,t])=>"vfx-alias"!==t.type)).hasOwnProperty(e)}async validateAndRestoreSelection(e,t,i={}){const{skipPersistence:n=!1}=i;if(console.log(`[SelectionService] validateAndRestoreSelection: env="${e}", cached="${t}", skipPersistence=${n}`),!this.cache.profile||!this.cache.currentProfile)return void console.log("[SelectionService] Profile data not available for validation");if(!t)return void await this.autoSelectFirst(e);let a=!1;"alias"===e?(a=this.validateAliasExists(t),a?(console.log(`[SelectionService] Restoring cached alias: "${t}"`),await this.selectAlias(t,{isAuto:!0,skipPersistence:n})):(console.log(`[SelectionService] Cached alias "${t}" no longer exists, auto-selecting`),this.setCachedSelection("alias",null),await this.autoSelectFirst("alias"))):(a=this.validateKeyExists(t,e),a?(console.log(`[SelectionService] Restoring cached key: "${t}" for env "${e}"`),await this.selectKey(t,e,{isAuto:!0,skipPersistence:n})):(console.log(`[SelectionService] Cached key "${t}" no longer exists in ${e}, auto-selecting`),this.setCachedSelection(e,null),await this.autoSelectFirst(e)))}updateCacheFromProfile(e){e&&(this.cache.profile=e,this.cache.builds=e.builds||{space:{keys:{}},ground:{keys:{}}},this.cache.keys=e.keys||{},this.cache.aliases=e.aliases||{})}async validateCurrentSelectionAfterUpdate(){if(!this.cache.profile||!this.cache.currentProfile)return;const e=this.cache.currentEnvironment;if("alias"!==e){const t=this.cachedSelections[e];t&&!this.validateKeyExists(t,e)&&(console.log(`[SelectionService] Current selection "${t}" no longer valid in ${e}, auto-selecting`),this.setCachedSelection(e,null),await this.autoSelectFirst(e))}const t=this.cachedSelections.alias;t&&!this.validateAliasExists(t)&&(console.log(`[SelectionService] Current alias "${t}" no longer valid, auto-selecting`),this.setCachedSelection("alias",null),await this.autoSelectFirst("alias"))}async persistSelectionToProfile(e,t){if(this.cache.currentProfile&&t)try{const i={...this.cache.profile?.selections||{},[e]:t};await this.request("data:update-profile",{profileId:this.cache.currentProfile,updates:{properties:{selections:i}},updateSource:"SelectionService"})}catch(e){console.warn("[SelectionService] Failed to persist selection to profile:",e)}}getCurrentState(){return{selectedKey:this.cache.selectedKey,selectedAlias:this.cache.selectedAlias,editingContext:this.editingContext,cachedSelections:{...this.cachedSelections},currentEnvironment:this.cache.currentEnvironment}}async handleInitialState(e,t){if(t&&"DataCoordinator"===e&&t.hasOwnProperty("currentProfileData")){const e=t.currentProfileData;if(!e)return this.cache.currentProfile=null,void(this.cachedSelections={space:null,ground:null,alias:null});this.cache.currentProfile=e.id,this.cache.currentEnvironment=e.environment||"space",this.updateCacheFromProfile(e),e.selections&&(e.selections.space&&(this.cachedSelections.space=e.selections.space,this.setCachedSelection("space",e.selections.space)),e.selections.ground&&(this.cachedSelections.ground=e.selections.ground,this.setCachedSelection("ground",e.selections.ground)),e.selections.alias&&(this.cachedSelections.alias=e.selections.alias,this.setCachedSelection("alias",e.selections.alias)));const i=this.getCachedSelection(this.cache.currentEnvironment);i&&("alias"===this.cache.currentEnvironment?(this.cache.selectedAlias=i,this.cache.selectedKey=null):(this.cache.selectedKey=i,this.cache.selectedAlias=null))}}onDestroy(){this.ne&&(this.ne.forEach(e=>{"function"==typeof e&&e()}),this.ne=[])}}class ui extends vt{constructor({eventBus:e,document:t=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="HeaderToolbarUI",this.document=t}init(){super.init(),this.setupEventListeners(),this.updateBindsetButtonVisibility()}setupEventListeners(){this.addEventListener("preferences:changed",e=>{!e.changes||void 0===e.changes.bindsetsEnabled&&void 0===e.changes.bindToAliasMode||this.updateBindsetButtonVisibility()})}updateBindsetButtonVisibility(){try{const e=this.getPreference("bindToAliasMode",!1),t=this.getPreference("bindsetsEnabled",!1),i=this.document.getElementById("bindsetManagerBtn");if(console.log("[HeaderToolbarUI] updateBindsetButtonVisibility:",{aliasMode:e,bindsets:t,buttonFound:!!i,cacheExists:!!this.cache,preferencesCache:this.cache?.preferences,fullCache:this.cache}),i){const n=e&&t;i.style.display=n?"":"none";const a=i.closest(".toolbar-group");a&&(a.style.display=n?"":"none"),console.log("[HeaderToolbarUI] Button visibility updated:",{show:n})}else console.log("[HeaderToolbarUI] bindsetManagerBtn element not found in DOM")}catch(e){console.warn("[HeaderToolbarUI] Failed to update bindset button visibility:",e)}}handleInitialState(e,t){"PreferencesService"===e&&this.cache.preferences&&(console.log("[HeaderToolbarUI] Received preferences via ComponentBase, updating UI"),this.updateBindsetButtonVisibility())}getPreference(e,t=!1){return this.cache?.preferences?.[e]??t}}class pi extends vt{constructor({eventBus:e,ui:t=null}={}){super(e),this.componentName="SyncUI",this.ui=t}init(){this.setupEventListeners()}setupEventListeners(){this.eventBus.on("sync:sync-now",()=>{this.performSync("manual")})}async performSync(e="manual"){this.ui?.showToast(Q.t("syncing"),"info"),await this.request("sync:sync-project",{source:e})}}class fi{static newToOld(e){return e?{command:e.command,type:e.category,parameters:e.parameters||{},signature:e.signature,baseCommand:e.baseCommand,displayText:e.displayText,icon:e.icon,id:e.id}:null}static normalize(e){return e?e.signature&&e.category?this.newToOld(e):e.command&&e.type?{command:e.command,type:e.type,parameters:e.parameters||{},signature:e.signature,baseCommand:e.baseCommand,displayText:e.displayText||e.command,icon:e.icon||"‚öôÔ∏è",id:e.id}:e:null}}class yi extends re{constructor({eventBus:e=c,dataService:t=null}={}){super(e),this.componentName="ParameterCommandService",this.editingContext=null,this.ne=[],this.eventBus&&this.ne.push(this.respond("parameter-command:build",async({categoryId:e,commandId:t,commandDef:i,params:n})=>this.buildParameterizedCommand(e,t,i,n)),this.respond("parameter-command:find-definition",({commandString:e})=>this.findCommandDefinition(e)),this.respond("parameter-command:generate-id",()=>this.generateCommandId()))}onInit(){this.setupEventListeners()}setupEventListeners(){this.addEventListener("environment:changed",e=>{const t="string"==typeof e?e:e.environment;t&&(this.cache.currentEnvironment=t)}),this.addEventListener("parameter-edit:start",e=>{this.editingContext={isEditing:!0,editIndex:e.index,existingCommand:e.command}}),this.addEventListener("parameter-edit:end",()=>{this.editingContext=null})}getCurrentState(){return{editingContext:this.editingContext}}onDestroy(){this.ne&&(this.ne.forEach(e=>{"function"==typeof e&&e()}),this.ne=[])}generateCommandId(){return`cmd_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}generateTrayRangeCommands(e,t,i,n,a,s=1){const o=[];if(t===n)for(let n=i;n<=a;n++)if(1!==s||e.startsWith("+"))if(1===s&&e.startsWith("+"))o.push(`${e} ${t} ${n}`);else{const i=e.replace(/^\+/,"");o.push(`${i} ${s} ${t} ${n}`)}else o.push(`+${e} ${t} ${n}`);else for(let r=t;r<=n;r++){let c,l;r===t?(c=i,l=9):r===n?(c=0,l=a):(c=0,l=9);for(let t=c;t<=l;t++)if(1!==s||e.startsWith("+"))if(1===s&&e.startsWith("+"))o.push(`${e} ${r} ${t}`);else{const i=e.replace(/^\+/,"");o.push(`${i} ${s} ${r} ${t}`)}else o.push(`+${e} ${r} ${t}`)}return o}generateWholeTrayCommands(e,t,i=1){const n=[];for(let a=0;a<=9;a++)if(1!==i||e.startsWith("+"))if(1===i&&e.startsWith("+"))n.push(`${e} ${t} ${a}`);else{const s=e.replace(/^\+/,"");n.push(`${s} ${i} ${t} ${a}`)}else n.push(`+${e} ${t} ${a}`);return n}generateTrayRangeWithBackupCommands(e,t,i,n,a,s,o,r,c){const l=[];if(t===n)for(let n=i;n<=a;n++){const a=o+(n-i);1===e?l.push(`+TrayExecByTrayWithBackup ${t} ${n} ${s} ${a}`):l.push(`TrayExecByTrayWithBackup ${e} ${t} ${n} ${s} ${a}`)}else{let d=0;for(let m=t;m<=n;m++){let h,u;m===t?(h=i,u=9):m===n?(h=0,u=a):(h=0,u=9);for(let t=h;t<=u;t++){const i=10*s+o+d,n=Math.floor(i/10),a=i%10;n<=r&&(n<r||a<=c)?1===e?l.push(`+TrayExecByTrayWithBackup ${m} ${t} ${n} ${a}`):l.push(`TrayExecByTrayWithBackup ${e} ${m} ${t} ${n} ${a}`):1===e?l.push(`+TrayExecByTrayWithBackup ${m} ${t} ${s} ${o}`):l.push(`TrayExecByTrayWithBackup ${e} ${m} ${t} ${s} ${o}`),d++}}}return l}generateWholeTrayWithBackupCommands(e,t,i){const n=[];for(let a=0;a<=9;a++)1===e?n.push(`+TrayExecByTrayWithBackup ${t} ${a} ${i} ${a}`):n.push(`TrayExecByTrayWithBackup ${e} ${t} ${a} ${i} ${a}`);return n}async parseCommandsToObjects(e){const t=e.map(async e=>{try{const t=await this.request("parser:parse-command-string",{commandString:e});if(t.commands&&t.commands.length>0)return t.commands[0]}catch(t){console.warn("Failed to parse command:",e,t)}return{command:e,category:"tray",displayText:e,id:this.generateCommandId(),parameters:{}}});return Promise.all(t)}async buildParameterizedCommand(e,t,i,n={}){const a={targeting:e=>["target_enemy_near_forarc","target_enemy_near_aftarc","target_enemy_near_sidearc"].includes(t)&&void 0!==e.degrees?{command:`${i.command} ${e.degrees}`,text:`${i.name} (${e.degrees}¬∞)`,parameters:{degrees:e.degrees}}:"target"!==t&&"target_entity"!==t||!e.entityName?{command:"string"==typeof i.command?i.command:"Target",text:i.name}:{command:`Target "${e.entityName}"`,text:`Target: ${e.entityName}`},tray:async e=>{const n=e.tray||0,a=e.slot||0,s=void 0!==e.active?e.active:1;if("tray_with_backup"===t){const t=e.backup_tray||0,i=e.backup_slot||0;return 1===s?{command:`+TrayExecByTrayWithBackup ${n} ${a} ${t} ${i}`,text:`Execute Tray ${n+1} Slot ${a+1} (backup: Tray ${t+1} Slot ${i+1})`}:{command:`TrayExecByTrayWithBackup ${s} ${n} ${a} ${t} ${i}`,text:`Execute Tray ${n+1} Slot ${a+1} (backup: Tray ${t+1} Slot ${i+1})`}}if("tray_range"===t){const t=e.start_tray||0,n=e.start_slot||0,a=e.end_tray||0,o=e.end_slot||0;let r;if(i.baseCommand)r=i.baseCommand;else if(e.baseCommand)r=e.baseCommand;else{const t=e.command_type||"STOTrayExecByTray";r=1===s?`+${t}`:t}const c=this.generateTrayRangeCommands(r,t,n,a,o,s);return await this.parseCommandsToObjects(c)}if("tray_range_with_backup"===t){const t=e.start_tray||0,i=e.start_slot||0,n=e.end_tray||0,a=e.end_slot||0,o=e.backup_start_tray||0,r=e.backup_start_slot||0,c=e.backup_end_tray||0,l=e.backup_end_slot||0,d=this.generateTrayRangeWithBackupCommands(s,t,i,n,a,o,r,c,l);return await this.parseCommandsToObjects(d)}if("whole_tray"===t){let t;if(i.baseCommand)t=i.baseCommand;else if(e.baseCommand)t=e.baseCommand;else{const i=e.command_type||"STOTrayExecByTray";t=1===s?`+${i}`:i}const a=this.generateWholeTrayCommands(t,n,s);return await this.parseCommandsToObjects(a)}if("whole_tray_with_backup"===t){const t=e.backup_tray||0,i=this.generateWholeTrayWithBackupCommands(s,n,t);return await this.parseCommandsToObjects(i)}let o,r;return this.editingContext&&this.editingContext.isEditing,o=i.baseCommand?i.baseCommand.replace(/^\+/,""):e.baseCommand?e.baseCommand.replace(/^\+/,""):e.command_type?e.command_type:"STOTrayExecByTray",r=1===s?`+${o} ${n} ${a}`:`${o} ${s} ${n} ${a}`,{command:r,text:`Execute Tray ${n+1} Slot ${a+1}`,parameters:{active:s,tray:n,slot:a}}},movement:e=>{let n=i.command;return"throttle_adjust"===t&&void 0!==e.amount?n=`${n||"ThrottleAdjust"} ${e.amount}`:"throttle_set"===t&&void 0!==e.position&&(n=`${n||"ThrottleSet"} ${e.position}`),{command:n||i.name||"Movement Command",text:i.name}},camera:e=>{let n=i.command;return"cam_distance"===t&&void 0!==e.distance&&(n=`${n||"camdist"} ${e.distance}`),{command:n||i.name||"Camera Command",text:i.name}},custom:e=>{const t=e.rawCommand||"";if(!t.trim())throw new Error("please_enter_a_raw_command");return{command:t.trim(),text:`Custom: ${t.trim()}`,type:"custom",category:"custom"}},communication:e=>{const t=i&&i.command?i.command:"say",n=e.verb||t,a=e.message||"Message text here";return{command:`${n} "${a}"`,text:`${n}: "${a}"`}},vfx:e=>{if("vfx_exclusion"===t){const t=e.effects||"";return{command:`dynFxSetFXExlusionList ${t}`,text:`VFX Exclude: ${t}`}}if("vfx_exclusion_alias"===t){const t=e.aliasName||"";return{command:`dynFxSetFXExclusionList_${t}`,text:`VFX Alias: ${t}`}}return{command:i.command,text:i.name}},power:e=>{if("power_exec"===t){const t=e.powerName||"";return{command:`+power_exec ${t}`,text:`Power: ${t}`}}return{command:i.command,text:i.name}},combat:e=>({command:e.commandName||i.command,text:i.name}),system:e=>{let n=i.command;return"bind_save_file"!==t&&"bind_load_file"!==t||!e.filename?"combat_log"===t&&void 0!==e.state?n=`${n||"CombatLog"} ${e.state}`:"ui_remember_positions"===t&&void 0!==e.state?n=`${n||"UIRememberPositions"} ${e.state}`:"chat_log"===t&&void 0!==e.state?n=`${n||"ChatLog"} ${e.state}`:"autofire_set"===t&&void 0!==e.state?n=`${n||"defaultautoattack"} ${e.state}`:"ui_tooltip_delay"===t&&void 0!==e.seconds?n=`${n||"ui_TooltipDelay"} ${e.seconds}`:"remember_ui_lists"===t&&void 0!==e.state?n=`${n||"RememberUILists"} ${e.state}`:"safe_login"===t&&void 0!==e.state?n=`${n||"SafeLogin"} ${e.state}`:"net_timing_graph"===t&&void 0!==e.state?n=`${n||"netTimingGraph"} ${e.state}`:"net_timing_graph_alpha"===t&&void 0!==e.alpha?n=`${n||"netTimingGraphAlpha"} ${e.alpha}`:"net_timing_graph_paused"===t&&void 0!==e.state?n=`${n||"netTimingGraphPaused"} ${e.state}`:"netgraph"===t&&void 0!==e.state?n=`${n||"netgraph"} ${e.state}`:"ui_load_file"===t&&e.filename?n=`${n||"ui_load_file"} ${e.filename}`:"ui_save_file"===t&&e.filename&&(n=`${n||"ui_save_file"} ${e.filename}`):n=`${n||("bind_save_file"===t?"bind_save_file":"bind_load_file")} ${e.filename}`,{command:n||i.name||"System Command",text:i.name}},alias:e=>{const t=e.alias_name?.trim()||"";return t?{command:t,text:`Alias: ${t}`}:null},bridge_officer:e=>"assist"===t&&e.name?{command:`Assist "${e.name}"`,text:`Assist: ${e.name}`}:"assist"===t?{command:"Assist",text:"Assist Current Target"}:{command:i.command,text:i.name},cosmetic:e=>"setactivecostume"===t&&e.modifier1&&e.modifier2?{command:`${i.command} ${e.modifier1} ${e.modifier2}`,text:`Set Costume: ${e.modifier1} ${e.modifier2}`}:{command:i.command,text:i.name}}[e];if(!a)return null;const s=await a(n);return s?Array.isArray(s)?s:{command:s.command,type:e,icon:i.icon,displayText:s.text,id:this.generateCommandId(),parameters:s.parameters||n}:null}async findCommandDefinition(e){try{const t=fi.normalize(e);if(!t)return null;const i=await this.request("parser:parse-command-string",{commandString:t.command});if(!i?.commands?.[0])return null;const n=i.commands[0],a=Wt(n.signature);return a&&function(e){const t=Wt(e);return!!t&&Object.values(t.parameters||{}).some(e=>"hidden"!==e.type)}(n.signature)?{commandId:a.commandId,categoryId:a.category,name:a.name,description:a.description,icon:a.icon,category:a.category,parameters:a.parameters,signature:n.signature,baseCommand:n.baseCommand,extractedParameters:n.parameters,...n.parameters}:null}catch(e){return console.warn("[ParameterCommandService] Error finding command definition:",e),null}}}class _i{constructor({i18n:e}={}){this.i18n=e,this.store=kt,this.eventListeners=new Map,this.autoSyncManager=null,this.dataService=null,this.profileUI=null,this.aliasService=null,this.aliasUI=null,this.commandService=null,this.commandLibraryService=null,this.keyBrowserService=null,this.keyBrowserUI=null,this.commandUI=null,this.keyService=null,this.fileOperationsService=null,this.keyCaptureService=null,this.keyCaptureUI=null,this.importUI=null,this.confirmDialogUI=null,this.inputDialogUI=null,this.projectManagementService=null}get currentMode(){return this.interfaceModeService?this.interfaceModeService.currentMode:this.store?.currentMode}set currentMode(e){this.store&&(this.store.currentMode=e),this.interfaceModeService&&(this.interfaceModeService.currentMode=e)}get undoStack(){return(this&&this.store?this.store:kt).undoStack}set undoStack(e){(this&&this.store?this.store:kt).undoStack=e}get redoStack(){return(this&&this.store?this.store:kt).redoStack}set redoStack(e){(this&&this.store?this.store:kt).redoStack=e}get maxUndoSteps(){return(this&&this.store?this.store:kt).maxUndoSteps}set maxUndoSteps(e){(this&&this.store?this.store:kt).maxUndoSteps=e}get commandIdCounter(){return(this&&this.store?this.store:kt).commandIdCounter}set commandIdCounter(e){(this&&this.store?this.store:kt).commandIdCounter=e}async init(){try{if("undefined"==typeof storageService||"undefined"==typeof stoUI)throw new Error("Required dependencies not loaded");this.modalManagerService=new Ze({eventBus:c,i18n:this.i18n}),this.modalManagerService.init();const e=this.modalManagerService;if(this.stoCommandParser=new Vt(c),window.stoCommandParser=this.stoCommandParser,this.dataService=window.dataService,!this.dataService)throw new Error("DataService not available - it should be initialized in main.js before app.init()");this.selectionService=new hi({eventBus:c}),this.selectionService.init(),this.confirmDialogUI=new $t({eventBus:c,modalManager:e,i18n:this.i18n}),this.inputDialogUI=new Et({eventBus:c,modalManager:e,i18n:this.i18n}),window.confirmDialog=this.confirmDialogUI,window.inputDialog=this.inputDialogUI;try{this.profileUI=new St({eventBus:c,ui:stoUI,modalManager:e,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n})}catch(e){throw e}this.aliasService=new di({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),await this.aliasService.init(),this.aliasBrowserService=new si({storage:storageService,ui:stoUI,eventBus:c}),this.aliasBrowserUI=new ti({eventBus:c,modalManager:e,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n}),this.keyBrowserService=new ci({eventBus:c,i18n:this.i18n,storage:storageService,profileService:this.profileService,ui:stoUI}),this.keyBrowserUI=new Gt({service:this.keyBrowserService,eventBus:c,document:document,modalManager:e,confirmDialog:this.confirmDialogUI,inputDialog:this.inputDialogUI,i18n:this.i18n}),this.keyService=new Fe({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.keyService.init(),this.importService=new Ge({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.importService.init(),this.exportService=new Je({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.exportService.init(),this.keyCaptureService=new He({eventBus:c,i18n:this.i18n}),this.keyCaptureService.init(),this.keyCaptureUI=new Ot({eventBus:c,modalManager:e,document:document,i18n:this.i18n}),this.keyCaptureUI.init(),this.gamepadCaptureService=new mi({eventBus:c,i18n:this.i18n}),this.gamepadCaptureService.init(),this.commandService=new Te({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI}),this.commandService.init(),this.commandLibraryService=new ue({storage:storageService,eventBus:c,i18n:this.i18n,ui:stoUI,modalManager:e}),this.commandLibraryUI=new Ct({service:this.commandLibraryService,eventBus:c,ui:stoUI,modalManager:e,document:document,i18n:this.i18n}),this.commandChainService=new oi({eventBus:c,i18n:this.i18n}),this.commandChainUI=new ri({eventBus:c,ui:stoUI,document:document,i18n:this.i18n}),this.parameterCommandService=new yi({eventBus:c}),this.parameterCommandUI=new xt({eventBus:c,modalManager:e,i18n:this.i18n,ui:stoUI}),this.commandUI=new Tt({eventBus:c,ui:stoUI,modalManager:e,parameterCommandUI:this.parameterCommandUI,confirmDialog:this.confirmDialogUI,i18n:this.i18n}),this.headerMenuUI=new ii({eventBus:c,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n}),this.headerToolbarUI=new ui({eventBus:c,document:document,i18n:this.i18n}),this.syncUI=new pi({eventBus:c,ui:stoUI}),this.aboutModalUI=new ni({eventBus:c,document:document,i18n:this.i18n}),this.interfaceModeService=new Be({eventBus:c,storage:storageService,profileService:this.profileService,app:this}),this.interfaceModeUI=new Bt({eventBus:c,ui:stoUI,profileUI:this.profileUI,document:document,i18n:this.i18n}),this.vfxManagerService=new Ye(c,this.i18n),this.vfxManagerUI=new Ut({eventBus:c,modalManager:e,i18n:this.i18n}),this.vfxManagerService.init(),this.vfxManagerUI.init(),this.preferencesService=new ce({storage:storageService,eventBus:c,ui:stoUI,i18n:this.i18n}),this.preferencesUI=new li({eventBus:c,service:this.preferencesService,ui:stoUI}),this.preferencesManager=this.preferencesUI,this.preferencesService.init(),this.preferencesUI.init(),window.stoAliases=this.aliasBrowserUI,this.aliasBrowserService.init(),this.aliasBrowserUI.init(),this.commandLibraryService.init(),this.commandLibraryUI.init(),this.commandChainService.init(),this.commandChainUI.init(),this.keyBrowserService.init(),this.keyBrowserUI.init(),this.parameterCommandService.init(),this.commandUI.init(),this.parameterCommandUI.init(),this.autoSyncManager=new me({eventBus:c,storage:storageService,syncManager:window.stoSync,ui:stoUI}),this.autoSyncManager.init(),this.profileUI.init();try{this.interfaceModeService.init()}catch(e){throw e}try{this.headerMenuUI.init()}catch(e){throw e}try{this.headerToolbarUI.init()}catch(e){throw e}try{this.syncUI.init()}catch(e){throw e}try{this.aboutModalUI.init()}catch(e){throw e}try{this.interfaceModeUI.init()}catch(e){throw e}this.profileUI.renderProfiles(),this.profileUI.updateProfileInfo(),this.checkAndShowWelcomeMessage(),stoUI.showToast(this.i18n.t("sto_tools_keybind_manager_loaded_successfully"),"success"),this.initialized=!0,c.emit("sto-app-ready",{app:this}),window.commandChainUI=this.commandChainUI,window.keyBrowserUI=this.keyBrowserUI,window.keyBrowserService=this.keyBrowserService,this.projectManagementService=new de({storage:storageService,ui:stoUI,app:this,eventBus:c,i18n:this.i18n}),this.projectManagementService.init(),this.importUI=new ai({eventBus:c,document:document,i18n:this.i18n,modalManager:this.modalManagerService}),this.importUI.init();const{default:t}=await Promise.resolve().then(function(){return wi}),{default:i}=await Promise.resolve().then(function(){return ki}),{default:n}=await Promise.resolve().then(function(){return Si}),{default:a}=await Promise.resolve().then(function(){return xi});this.bindsetService=new t({eventBus:c}),this.bindsetManagerUI=new i({eventBus:c,i18n:this.i18n,confirmDialog:this.confirmDialogUI,inputDialog:this.inputDialogUI}),this.bindsetService.init(),this.bindsetManagerUI.init(),this.bindsetSelectorService=new n({eventBus:c}),this.bindsetSelectorUI=new a({eventBus:c,confirmDialog:this.confirmDialogUI,document:document,i18n:this.i18n}),this.bindsetSelectorService.init(),this.bindsetSelectorUI.init()}catch(e){throw"undefined"!=typeof stoUI&&stoUI.showToast&&stoUI.showToast(this.i18n.t("failed_to_load_application"),"error"),c.emit("sto-app-error",{error:e}),e}}generateCommandId(){return`cmd_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}isFirstTime(){return!localStorage.getItem("sto_keybind_manager_visited")}checkAndShowWelcomeMessage(){this.isFirstTime()&&(localStorage.setItem("sto_keybind_manager_visited","true"),this.modalManagerService.show("aboutModal"))}}const gi=new class{constructor(){this.isEnabled=!1,this.i18nTracking=!1,this.cssTracking=!1,this.i18nStats={usedKeys:new Set,missingKeys:new Set,keyUsageCount:new Map,lastUsed:new Map},this.cssStats={usedSelectors:new Set,unusedSelectors:new Set,selectorUsageCount:new Map,lastChecked:null},this.originalI18nT=null,this.originalI18nExists=null,this.cssCheckInterval=null,this.isDevelopment=this.checkDevelopmentMode()}checkDevelopmentMode(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||"file:"===window.location.protocol||window.location.search.includes("dev=true")||"true"===localStorage.getItem("dev-mode")}enableI18nTracking(){if(!this.isDevelopment)return console.warn("DevMonitor: I18n tracking only available in development mode"),!1;if(this.i18nTracking)return console.log("DevMonitor: I18n tracking already enabled"),!0;if(!window.i18next)return console.error("DevMonitor: i18next not found"),!1;if(console.log("DevMonitor: Enabling i18n tracking..."),this.originalI18nT=window.i18next.t.bind(window.i18next),this.originalI18nExists=window.i18next.exists.bind(window.i18next),window.i18next.t=(e,t)=>(this.trackI18nUsage(e,t),this.originalI18nT(e,t)),window.applyTranslations){const e=window.applyTranslations;window.applyTranslations=t=>((t||document).querySelectorAll("[data-i18n], [data-i18n-placeholder], [data-i18n-title], [data-i18n-alt]").forEach(e=>{const t=e.getAttribute("data-i18n")||e.getAttribute("data-i18n-placeholder")||e.getAttribute("data-i18n-title")||e.getAttribute("data-i18n-alt");t&&this.trackI18nUsage(t)}),e(t))}return this.i18nTracking=!0,this.isEnabled=!0,console.log("DevMonitor: I18n tracking enabled"),!0}trackI18nUsage(e,t={}){const i="string"==typeof e?e:String(e),n=Date.now();this.i18nStats.usedKeys.add(i),this.i18nStats.keyUsageCount.set(i,(this.i18nStats.keyUsageCount.get(i)||0)+1),this.i18nStats.lastUsed.set(i,n),this.originalI18nExists&&!this.originalI18nExists(i)&&this.i18nStats.missingKeys.add(i)}enableCSSTracking(){return this.isDevelopment?this.cssTracking?(console.log("DevMonitor: CSS tracking already enabled"),!0):(console.log("DevMonitor: Enabling CSS tracking..."),this.cssCheckInterval=setInterval(()=>{this.checkCSSUsage()},2e3),this.cssTracking=!0,this.isEnabled=!0,console.log("DevMonitor: CSS tracking enabled (checking every 2 seconds)"),!0):(console.warn("DevMonitor: CSS tracking only available in development mode"),!1)}checkCSSUsage(){const e=Date.now(),t=Array.from(document.styleSheets);console.log(`[DevMonitor] Checking ${t.length} stylesheets...`),t.forEach((e,t)=>{try{if(console.log(`[DevMonitor] Sheet ${t}:`,{href:e.href,origin:window.location.origin,canAccess:!!e.cssRules||!!e.rules}),e.href&&!e.href.includes(window.location.origin)&&!e.href.startsWith("file://"))return void console.log(`[DevMonitor] Skipping external stylesheet: ${e.href}`);const i=Array.from(e.cssRules||e.rules||[]);console.log(`[DevMonitor] Found ${i.length} rules in sheet ${t}`),i.forEach((e,t)=>{if(e.type===CSSRule.STYLE_RULE){const t=e.selectorText;if(!t)return;try{document.querySelectorAll(t).length>0?(this.cssStats.usedSelectors.add(t),this.cssStats.selectorUsageCount.set(t,(this.cssStats.selectorUsageCount.get(t)||0)+1),this.cssStats.unusedSelectors.delete(t)):this.cssStats.usedSelectors.has(t)||this.cssStats.unusedSelectors.add(t)}catch(e){console.warn(`[DevMonitor] Invalid selector "${t}":`,e.message)}}})}catch(e){console.warn(`[DevMonitor] Can't access stylesheet ${t}:`,e.message)}}),this.cssStats.lastChecked=e,console.log("[DevMonitor] CSS check complete:",{usedSelectors:this.cssStats.usedSelectors.size,unusedSelectors:this.cssStats.unusedSelectors.size})}getI18nStats(){if(!this.i18nTracking)return console.warn("DevMonitor: I18n tracking not enabled"),null;return{summary:{totalKeysUsed:this.i18nStats.usedKeys.size,totalKeysMissing:this.i18nStats.missingKeys.size,totalUsages:Array.from(this.i18nStats.keyUsageCount.values()).reduce((e,t)=>e+t,0)},usedKeys:Array.from(this.i18nStats.usedKeys).sort(),missingKeys:Array.from(this.i18nStats.missingKeys).sort(),keyUsageCount:Object.fromEntries(Array.from(this.i18nStats.keyUsageCount.entries()).sort((e,t)=>t[1]-e[1])),mostUsedKeys:Array.from(this.i18nStats.keyUsageCount.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e,t])=>({key:e,count:t})),recentlyUsed:Array.from(this.i18nStats.lastUsed.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e,t])=>({key:e,lastUsed:new Date(t).toISOString()}))}}getCSSStats(){return this.cssTracking?{summary:{totalSelectorsUsed:this.cssStats.usedSelectors.size,totalSelectorsUnused:this.cssStats.unusedSelectors.size,lastChecked:this.cssStats.lastChecked?new Date(this.cssStats.lastChecked).toISOString():null},usedSelectors:Array.from(this.cssStats.usedSelectors).sort(),unusedSelectors:Array.from(this.cssStats.unusedSelectors).sort(),selectorUsageCount:Object.fromEntries(Array.from(this.cssStats.selectorUsageCount.entries()).sort((e,t)=>t[1]-e[1])),mostUsedSelectors:Array.from(this.cssStats.selectorUsageCount.entries()).sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({selector:e,count:t}))}:(console.warn("DevMonitor: CSS tracking not enabled"),null)}exportI18nStats(){const e=this.getI18nStats();if(!e)return null;const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),n=document.createElement("a");return n.href=i,n.download=`i18n-stats-${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(i),console.log("DevMonitor: I18n stats exported"),e}exportCSSStats(){const e=this.getCSSStats();if(!e)return null;const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),n=document.createElement("a");return n.href=i,n.download=`css-stats-${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(i),console.log("DevMonitor: CSS stats exported"),e}generateCSSCleanupScript(){const e=this.getCSSStats();if(!e)return null;const t=`\n// Auto-generated CSS cleanup script\n// Remove unused selectors (review before applying!)\n\n/*\nUNUSED SELECTORS (${e.unusedSelectors.length} total):\n${e.unusedSelectors.map(e=>`- ${e}`).join("\n")}\n*/\n\n// Most used selectors to keep:\n${e.mostUsedSelectors.map(({selector:e,count:t})=>`/* ${e} (used ${t} times) */`).join("\n")}\n`,i=new Blob([t],{type:"text/plain"}),n=URL.createObjectURL(i),a=document.createElement("a");return a.href=n,a.download=`css-cleanup-${(new Date).toISOString().split("T")[0]}.txt`,a.click(),URL.revokeObjectURL(n),console.log("DevMonitor: CSS cleanup script generated"),t}clearStats(){this.i18nStats={usedKeys:new Set,missingKeys:new Set,keyUsageCount:new Map,lastUsed:new Map},this.cssStats={usedSelectors:new Set,unusedSelectors:new Set,selectorUsageCount:new Map,lastChecked:null},console.log("DevMonitor: All stats cleared")}disableI18nTracking(){this.i18nTracking&&(this.originalI18nT&&window.i18next&&(window.i18next.t=this.originalI18nT),this.i18nTracking=!1,console.log("DevMonitor: I18n tracking disabled"))}disableCSSTracking(){this.cssTracking&&(this.cssCheckInterval&&(clearInterval(this.cssCheckInterval),this.cssCheckInterval=null),this.cssTracking=!1,console.log("DevMonitor: CSS tracking disabled"))}disableAll(){this.disableI18nTracking(),this.disableCSSTracking(),this.isEnabled=!1,console.log("DevMonitor: All tracking disabled")}checkCSSNow(){return this.isDevelopment?(console.log("DevMonitor: Running manual CSS check..."),this.checkCSSUsage(),this.getCSSStats()):(console.warn("DevMonitor: CSS checking only available in development mode"),!1)}getStatus(){return{isEnabled:this.isEnabled,isDevelopment:this.isDevelopment,i18nTracking:this.i18nTracking,cssTracking:this.cssTracking,i18nStatsCount:this.i18nStats.usedKeys.size,cssStatsCount:this.cssStats.usedSelectors.size}}};gi.isDevelopment&&(window.devMonitor=gi,console.log("\nüîß DevMonitor loaded! Available commands:\n- devMonitor.enableI18nTracking()    // Start tracking i18n usage\n- devMonitor.enableCSSTracking()     // Start tracking CSS usage  \n- devMonitor.getI18nStats()          // Get i18n usage statistics\n- devMonitor.getCSSStats()           // Get CSS usage statistics\n- devMonitor.checkCSSNow()           // Run CSS check immediately (debug)\n- devMonitor.exportI18nStats()       // Download i18n stats as JSON\n- devMonitor.exportCSSStats()        // Download CSS stats as JSON\n- devMonitor.generateCSSCleanupScript() // Generate CSS cleanup script\n- devMonitor.clearStats()            // Clear all tracking data\n- devMonitor.disableAll()            // Disable all tracking\n- devMonitor.getStatus()             // Get current status\n  "));const bi=new class extends re{constructor({eventBus:e,data:t=null}={}){super(e),this.componentName="DataService",this.data=t||{},this.responseHandlers=[]}onInit(){this.responseHandlers.push(this.respond("data:get-commands",()=>this.data.commands||{})),this.responseHandlers.push(this.respond("data:get-command-category",({categoryId:e})=>this.data.commands?.[e]||null)),this.responseHandlers.push(this.respond("data:get-command-definition",({categoryId:e,commandId:t})=>this.data.commands?.[e]?.commands?.[t]||null)),this.responseHandlers.push(this.respond("data:find-command-by-name",({command:e})=>{if(!this.data.commands||!e)return null;for(const[t,i]of Object.entries(this.data.commands))if(i.commands)for(const[n,a]of Object.entries(i.commands))if(a.command===e)return{...a,categoryId:t,commandId:n};return null})),this.responseHandlers.push(this.respond("data:get-validation-patterns",()=>this.data.validation||{})),this.responseHandlers.push(this.respond("data:get-key-name-pattern",()=>this.data.validation?.keyNamePattern||"USE_STO_KEY_NAMES")),this.responseHandlers.push(this.respond("data:get-alias-name-pattern",()=>this.data.validation?.aliasNamePattern||/^[A-Za-z0-9_]+$/)),this.responseHandlers.push(this.respond("data:has-commands",()=>!(!this.data||!this.data.commands))),this.responseHandlers.push(this.respond("data:get-tray-category",()=>this.data.commands?.tray||null)),this.responseHandlers.push(this.respond("data:get-communication-category",()=>this.data.commands?.communication||null)),this.responseHandlers.push(this.respond("data:get-combat-category",()=>this.data.commands?.combat||null)),this.responseHandlers.push(this.respond("data:get-default-profiles",()=>this.data.defaultProfiles||{})),this.responseHandlers.push(this.respond("data:get-default-profile",({profileId:e})=>this.data.defaultProfiles?.[e]||null))}onDestroy(){this.responseHandlers.forEach(e=>{"function"==typeof e&&e()}),this.responseHandlers=[]}getCurrentState(){return{defaultProfiles:this.data.defaultProfiles||{},hasCommands:!(!this.data||!this.data.commands),dataAvailable:Object.keys(this.data).length>0}}}({eventBus:c,data:"undefined"!=typeof globalThis?globalThis.STO_DATA:null});(async()=>{await Q.init({lng:"en",fallbackLng:"en",resources:{en:{translation:ee},de:{translation:te},fr:{translation:ie},es:{translation:ne}}}),window.i18next=Q;const t=new he({eventBus:c,i18n:Q});t.init(),bi.init();const i=new dt({eventBus:c,storage:t,i18n:Q});i.init();const n=t.getSettings();function a(e=document){e.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n"),i=e.getAttribute("data-i18n-attr");if(!t)return;const n=Q.t(t);i?e.setAttribute(i,n):e.textContent=n}),e.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const t=e.getAttribute("data-i18n-placeholder");t&&e.setAttribute("placeholder",Q.t(t))}),e.querySelectorAll("[data-i18n-title]").forEach(e=>{const t=e.getAttribute("data-i18n-title");t&&e.setAttribute("title",Q.t(t))}),e.querySelectorAll("[data-i18n-alt]").forEach(e=>{const t=e.getAttribute("data-i18n-alt");t&&e.setAttribute("alt",Q.t(t))})}function s(){a();const t=document.getElementById("appVersion");t&&(t.textContent=e)}n.language&&"en"!==n.language&&await Q.changeLanguage(n.language),gi.isDevelopment&&console.log("üîß DevMonitor: Development mode detected, monitoring tools available"),window.localizeCommandData&&window.localizeCommandData(),window.applyTranslations=a,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s();const o=new Fe,r=new Xe(c);new We({eventBus:c});const l={showToast:(e,t="info")=>c.emit("toast:show",{message:e,type:t}),confirm:(e,t)=>c.emit("confirm:show",{message:e,callback:t}),showModal:e=>c.emit("modal:show",{modalId:e}),hideModal:e=>c.emit("modal:hide",{modalId:e}),copyToClipboard:e=>c.emit("ui:copy-to-clipboard",{text:e}),initDragAndDrop:(e,t={})=>{r&&"function"==typeof r.initDragAndDrop?r.initDragAndDrop(e,t):c.emit("ui:init-drag-drop",{container:e,options:t})}};new bt({eventBus:c,i18n:Q,ui:l}).init();const d=new wt({eventBus:c,storage:t,ui:l,i18n:Q});d.init();const m=new Ae({eventBus:c,storage:t,ui:l,i18n:Q});Object.assign(window,{storageService:t,dataService:bi,dataCoordinator:i,stoKeybinds:o,stoUI:l,stoFileExplorer:d,stoSync:m,eventBus:c});const h=new _i({i18n:Q});if("function"!=typeof h.init)console.error("app.init is not a function!");else try{const e=h.init();e&&"function"==typeof e.catch?await e:console.log("TEST: app.init() did not return a Promise")}catch(e){console.log("TEST: app.init() failed:",e)}c.on("sto-app-ready",()=>{o.init(),d.isInitialized()||d.init(),console.log("=== Settings Button Debug ===");const e=document.getElementById("settingsBtn"),t=document.getElementById("settingsMenu"),i=document.getElementById("preferencesBtn");console.log("1. Elements exist check:"),console.log("- settingsBtn:",!!e),console.log("- settingsMenu:",!!t),console.log("- preferencesBtn:",!!i),e&&(console.log("\n2. Settings Button properties:"),console.log("- tagName:",e.tagName),console.log("- className:",e.className),console.log("- parent dropdown:",e.closest(".dropdown")?.className),console.log("\n3. Event Listeners:"),console.log("- Has onclick:",!!e.onclick),console.log("- Has click listeners:",!!e.Oe),console.log("\n4. Event-based architecture check:"),console.log("- eventBus exists:",!!window.eventBus),console.log("- Settings managed by HeaderMenuUI via events")),t&&(console.log("\n5. Settings Menu properties:"),console.log("- display:",t.style.display),console.log("- visibility:",t.style.visibility),console.log("- parent dropdown active:",e?.closest(".dropdown")?.classList.contains("active")))})})();var wi=Object.freeze({__proto__:null,default:class extends re{constructor({eventBus:e}={}){super(e),this.componentName="BindsetService",this.eventBus&&(this.respond("bindset:create",({name:e})=>this.createBindset(e)),this.respond("bindset:clone",({sourceBindset:e,targetBindset:t})=>this.cloneBindset(e,t)),this.respond("bindset:rename",({oldName:e,newName:t})=>this.renameBindset(e,t)),this.respond("bindset:delete",({name:e})=>this.deleteBindset(e)),this.respond("bindset:delete-with-keys",({name:e})=>this.deleteBindset(e,!0)),this.respond("bindset:get-key-commands",({bindset:e,environment:t,key:i})=>this.getKeyCommands(e,t,i))),this.setupEventListeners()}getCurrentState(){return{bindsets:[...this.cache.bindsetNames]}}onInit(){console.log("[BindsetService] Initializing..."),console.log("[BindsetService] Initialized successfully")}handleInitialState(e,t){console.log("[BindsetService] handleInitialState called:",e,!!t),"DataCoordinator"===e&&t?.currentProfileData&&(console.log("[BindsetService] Received initial profile data from DataCoordinator"),this.updateCacheFromProfile(t.currentProfileData))}setupEventListeners(){this.Ue||(this.Ue=!0,this.addEventListener("profile:updated",({profileId:e,profile:t})=>{e===this.cache.currentProfile&&this.updateCacheFromProfile(t)}),this.addEventListener("profile:switched",({profile:e})=>{this.updateCacheFromProfile(e)}))}updateCacheFromProfile(e){console.log("[BindsetService] updateCacheFromProfile: profile =",e,"id =",e&&e.id),e&&(!e.id&&this.cache.currentProfile&&(e.id=this.cache.currentProfile),this.cache.bindsetNames=["Primary Bindset",...Object.keys(e.bindsets||{})],this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}))}async getProfile(){if(this.cache.profile)return this.cache.profile;const e=await this.request("data:get-current-state").catch(()=>null),t=e?.currentProfileData||null;return t&&this.updateCacheFromProfile(t),t}async createBindset(e){if(!e||"Primary Bindset"===e)return{success:!1,error:"invalid_name"};const t=await this.getProfile();if(console.log("[BindsetService] createBindset: profile =",t,"id =",t&&t.id),!t||!t.id)return console.error("[BindsetService] createBindset: no_profile error, profile:",t),{success:!1,error:"no_profile"};if(t.bindsets&&t.bindsets[e])return{success:!1,error:"name_exists"};const i={add:{bindsets:{[e]:{space:{keys:{}},ground:{keys:{}}}}}},n=await this.request("data:update-profile",{profileId:t.id,updates:i});return n?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),n}async cloneBindset(e,t){if(!e||!t)return{success:!1,error:"invalid_name"};if("Primary Bindset"===t)return{success:!1,error:"invalid_name"};const i=await this.getProfile();if(console.log("[BindsetService] cloneBindset: profile =",i,"id =",i&&i.id),!i||!i.id)return console.error("[BindsetService] cloneBindset: no_profile error, profile:",i),{success:!1,error:"no_profile"};if(i.bindsets&&i.bindsets[t])return{success:!1,error:"name_exists"};let n;if("Primary Bindset"===e)n={space:{keys:i.builds?.space?.keys||{}},ground:{keys:i.builds?.ground?.keys||{}}};else if(n=i.bindsets?.[e],!n)return{success:!1,error:"source_not_found"};const a={add:{bindsets:{[t]:{space:{keys:{...n.space?.keys||{}}},ground:{keys:{...n.ground?.keys||{}}}}}}},s=await this.request("data:update-profile",{profileId:i.id,updates:a});return s?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),s}async renameBindset(e,t){if(!e||!t||"Primary Bindset"===e||"Primary Bindset"===t)return{success:!1,error:"invalid_name"};const i=await this.getProfile();if(!i.bindsets||!i.bindsets[e])return{success:!1,error:"not_found"};if(i.bindsets[t])return{success:!1,error:"name_exists"};const n=i.bindsets[e],a={add:{bindsets:{[t]:n}},delete:{bindsets:[e]}};i.bindsetMetadata&&i.bindsetMetadata[e]&&(a.add.bindsetMetadata={[t]:i.bindsetMetadata[e]},a.delete.bindsetMetadata=[e]);const s=await this.request("data:update-profile",{profileId:i.id,updates:a});return s?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),s}async deleteBindset(e,t=!1){if(!e||"Primary Bindset"===e)return{success:!1,error:"invalid_name"};const i=await this.getProfile(),n=i.bindsets?.[e];if(!n)return{success:!1,error:"not_found"};if(!t){const e=e=>n?.[e]?.keys&&Object.keys(n[e].keys).length>0;if(e("space")||e("ground"))return{success:!1,error:"not_empty"}}const a={delete:{bindsets:[e]}},s=await this.request("data:update-profile",{profileId:i.id,updates:a});return s?.success&&this.emit("bindsets:changed",{names:[...this.cache.bindsetNames]}),s}async getKeyCommands(e,t="space",i){if(console.log(`[BindsetService] *** getKeyCommands called: bindset=${e}, environment=${t}, key=${i} ***`),!i)return console.log("[BindsetService] *** No key provided, returning empty array ***"),[];console.log("[BindsetService] *** Requesting data:get-current-state ***");const n=await this.request("data:get-current-state").catch(e=>(console.error("[BindsetService] *** Failed to get current state: ***",e),null)),a=n?.currentProfile,s=a&&n?.profiles?n.profiles[a]:null;if(console.log(`[BindsetService] *** Profile data retrieved: profileId=${a}, hasProfile=${!!s} ***`),!s)return console.log("[BindsetService] *** No profile data, returning empty array ***"),[];if(!e||"Primary Bindset"===e){const e=s.builds?.[t]?.keys?.[i]||[];return console.log(`[BindsetService] *** Primary bindset commands for key ${i}:`,e),Array.isArray(e)?[...e]:[]}const o=s.bindsets?.[e]?.[t]?.keys?.[i]||[];return console.log(`[BindsetService] *** Bindset "${e}" commands for key ${i}:`,o),Array.isArray(o)?[...o]:[]}}}),ki=Object.freeze({__proto__:null,default:class extends vt{constructor({eventBus:e,i18n:t,confirmDialog:i=null,inputDialog:n=null,document:a=("undefined"!=typeof window?window.document:void 0)}={}){super(e),this.componentName="BindsetManagerUI",this.i18n=t,this.document=a,this.confirmDialog=i||("undefined"!=typeof window?window.confirmDialog:null),this.inputDialog=n||("undefined"!=typeof window?window.inputDialog:null),this.selectedBindset=null}async onInit(){this.setupEventListeners(),this.render(),this.eventBus.on("bindsets:changed",()=>{this.render()})}setupEventListeners(){this.listenersSetup||(this.listenersSetup=!0,this.onDom("bindsetManagerBtn","click","bindset-manager-open",()=>{this.render(),this.emit("modal:show",{modalId:"bindsetManagerModal"})}),this.onDom("createBindsetBtn","click","bindset-create",async()=>{if(!this.inputDialog)return;const e=this.i18n.t("create_bindset"),t=this.i18n.t("enter_bindset_name"),i=await this.inputDialog.prompt(t,{title:e,placeholder:this.i18n.t("bindset_name"),validate:e=>{const t=e.trim();return t?!this.cache.bindsetNames.includes(t)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!i?.trim())return;const n=await this.request("bindset:create",{name:i.trim()});n?.success||this.showError(n.error)}),this.onDom("renameBindsetBtn","click","bindset-rename",async()=>{if(!this.selectedBindset||!this.inputDialog)return;const e=this.i18n.t("rename_bindset"),t=this.i18n.t("enter_new_name"),i=await this.inputDialog.prompt(t,{title:e,defaultValue:this.selectedBindset,placeholder:this.i18n.t("bindset_name"),validate:e=>{const t=e.trim();return t?t===this.selectedBindset?this.i18n.t("name_unchanged"):!this.cache.bindsetNames.includes(t)||this.i18n.t("name_exists"):this.i18n.t("name_required")}});if(!i?.trim()||i.trim()===this.selectedBindset)return;const n=await this.request("bindset:rename",{oldName:this.selectedBindset,newName:i.trim()});n?.success||this.showError(n.error)}),this.onDom("deleteBindsetBtn","click","bindset-delete",async()=>{if(!this.selectedBindset||!this.confirmDialog)return;const e=this.i18n.t("confirm_delete_bindset",{name:this.selectedBindset}),t=this.i18n.t("confirm_delete");if(await this.confirmDialog.confirm(e,t,"danger","bindsetDelete")){const e=await this.request("bindset:delete",{name:this.selectedBindset});e?.success||this.showError(e.error)}}))}showError(e){const t={invalid_name:"invalid_name",name_exists:"bindset_name_in_use",not_found:"not_found",not_empty:"bindset_not_empty"}[e]||"error",i=this.document.getElementById("bindsetError");i&&(i.textContent=this.i18n.t(t),i.style.display="",setTimeout(()=>{i.style.display="none"},4e3))}async render(){const e=this.document.getElementById("bindsetList");if(!e)return;const t=this.cache.bindsetNames||[];e.innerHTML="",t.forEach(t=>{const i=this.document.createElement("li");i.textContent=t,i.className="bindset-item"+(t===this.selectedBindset?" selected":""),i.onclick=()=>{this.selectedBindset=t===this.selectedBindset?null:t,this.render()},e.appendChild(i)});const i=this.document.getElementById("renameBindsetBtn"),n=this.document.getElementById("deleteBindsetBtn"),a=this.selectedBindset&&"Primary Bindset"!==this.selectedBindset;i&&(i.disabled=!a),n&&(n.disabled=!a)}handleInitialState(e,t){t&&t.bindsets&&this.isInitialized()&&this.render()}}}),Si=Object.freeze({__proto__:null,default:class extends re{constructor({eventBus:e}={}){super(e),this.componentName="BindsetSelectorService",this.keyBindsetMembership=new Map,this.keyService=new Fe(e),this.eventBus&&(this.respond("bindset-selector:set-key",({key:e})=>this.setSelectedKey(e)),this.respond("bindset-selector:add-key-to-bindset",({bindset:e})=>this.addKeyToBindset(e)),this.respond("bindset-selector:remove-key-from-bindset",({bindset:e})=>this.removeKeyFromBindset(e)),this.respond("bindset-selector:set-active-bindset",({bindset:e})=>this.setActiveBindset(e)),this.respond("bindset-selector:find-key-in-bindset",({keysObject:e,selectedKey:t})=>this.findKeyInBindset(e,t))),this.setupEventListeners()}async onInit(){console.log("[BindsetSelectorService] onInit called"),console.log("[BindsetSelectorService] Initial cache state:",this.cache),console.log("[BindsetSelectorService] Component name:",this.componentName),setTimeout(()=>{this.cache.profile||(console.warn("[BindsetSelectorService] No profile data received after 1 second - late-join sync may have failed"),console.log("[BindsetSelectorService] Current cache after timeout:",this.cache))},1e3)}setupEventListeners(){this.Ue||(this.Ue=!0,this.addEventListener("bindsets:changed",({names:e})=>{console.log("[BindsetSelectorService] bindsets:changed received:",e),this.updateKeyMembership()}),this.addEventListener("preferences:changed",e=>{const t=e.changes||{[e.key]:e.value};if(void 0!==t.bindsetsEnabled||void 0!==t.bindToAliasMode){console.log("[BindsetSelectorService] bindset preferences changed, updating visibility");const e=this.shouldDisplay();this.emit("bindset-selector:visibility-changed",{visible:e})}}),this.addEventListener("profile:switched",()=>{console.log("[BindsetSelectorService] profile:switched - updating key membership"),this.updateKeyMembership()}),this.addEventListener("profile:updated",({profileId:e})=>{console.log("[BindsetSelectorService] profile:updated - updating key membership"),e===this.cache.currentProfile&&this.updateKeyMembership()}),this.addEventListener("environment:changed",()=>{console.log("[BindsetSelectorService] environment:changed - updating key membership and visibility"),this.updateKeyMembership();const e=this.shouldDisplay();this.emit("bindset-selector:visibility-changed",{visible:e})}),this.addEventListener("key-selected",({key:e,name:t,bindset:i})=>{const n=e||t;console.log("[BindsetSelectorService] key-selected received:",n,"with bindset context:",i),console.log("[BindsetSelectorService] BEFORE: cache.selectedKey =",this.cache.selectedKey),n!==this.cache.selectedKey&&(this.cache.selectedKey=n,console.log("[BindsetSelectorService] FORCE UPDATED: cache.selectedKey =",this.cache.selectedKey),this.updateKeyMembership(),i&&i!==this.cache.activeBindset&&console.log("[BindsetSelectorService] Respecting bindset context from key-selected event:",i))}))}setSelectedKey(e){this.updateKeyMembership()}setActiveBindset(e){console.log(`[BindsetSelectorService] setActiveBindset called: ${this.cache.activeBindset} -> ${e}`),console.log("[BindsetSelectorService] About to emit bindset-selector:active-changed with bindset:",e),this.emit("bindset-selector:active-changed",{bindset:e},{synchronous:!0}),console.log("[BindsetSelectorService] Successfully emitted bindset-selector:active-changed with bindset:",e)}async updateKeyMembership(){if(this.cache.selectedKey){console.log(`[BindsetSelectorService] updateKeyMembership: STARTING with selectedKey="${this.cache.selectedKey}"`),this.keyBindsetMembership.clear();for(const e of this.cache.bindsetNames){const t=await this.keyExistsInBindset(e);this.keyBindsetMembership.set(e,t),console.log(`[BindsetSelectorService] updateKeyMembership: ${e} -> ${t} (key: ${this.cache.selectedKey})`)}console.log(`[BindsetSelectorService] updateKeyMembership: EMITTING membership-updated with key="${this.cache.selectedKey}"`),this.emit("bindset-selector:membership-updated",{key:this.cache.selectedKey,membership:new Map(this.keyBindsetMembership)})}else console.log("[BindsetSelectorService] updateKeyMembership: early return - no selectedKey")}findKeyInBindset(e,t){return e&&t&&e[t]||null}async keyExistsInBindset(e){if(!this.cache.selectedKey)return console.log("[BindsetSelectorService] keyExistsInBindset early return: no selectedKey"),!1;if(!this.cache.profile)return console.log("[BindsetSelectorService] keyExistsInBindset early return: no profile data - cache:",this.cache),!1;try{if("Primary Bindset"===e){const e=this.cache.profile.builds?.[this.cache.currentEnvironment]?.keys,t=this.findKeyInBindset(e,this.cache.selectedKey);return void 0!==t&&Array.isArray(t)}{const t=this.cache.profile.bindsets?.[e]?.[this.cache.currentEnvironment]?.keys,i=this.findKeyInBindset(t,this.cache.selectedKey);return void 0!==i&&Array.isArray(i)}}catch(e){return console.error("[BindsetSelectorService] Error checking key existence:",e),!1}}async addKeyToBindset(e){if(!this.cache.selectedKey||"Primary Bindset"===e)return{success:!1,error:"invalid_operation"};try{this.emit("bindset-operation:started",{type:"add-key",bindset:e,key:this.cache.selectedKey});const t=this.cache.profile;if(!t||!t.id)return{success:!1,error:"no_profile"};const i={modify:{bindsets:{[e]:{[this.cache.currentEnvironment]:{keys:{[this.cache.selectedKey]:[]}}}}}},n=await this.request("data:update-profile",{profileId:t.id,updates:i});return n?.success&&(this.keyBindsetMembership.set(e,!0),console.log(`[BindsetSelectorService] *** Switching to bindset ${e} immediately ***`),this.setActiveBindset(e),console.log(`[BindsetSelectorService] *** EMITTING bindset-selector:key-added: key=${this.cache.selectedKey}, bindset=${e} ***`),this.emit("bindset-selector:key-added",{key:this.cache.selectedKey,bindset:e,environment:this.cache.currentEnvironment}),console.log("[BindsetSelectorService] *** bindset-selector:key-added event emitted successfully ***"),this.emit("bindset-operation:completed",{type:"add-key",bindset:e,key:this.cache.selectedKey},{synchronous:!0})),n}catch(e){return console.error("[BindsetSelectorService] Error adding key to bindset:",e),{success:!1,error:"add_failed"}}}async removeKeyFromBindset(e){if(!this.cache.selectedKey||"Primary Bindset"===e)return{success:!1,error:"invalid_operation"};try{const t=this.cache.profile;if(!t||!t.id)return{success:!1,error:"no_profile"};const i={modify:{bindsets:{[e]:{[this.cache.currentEnvironment]:{keys:{[this.cache.selectedKey]:null}}}}}},n=await this.request("data:update-profile",{profileId:t.id,updates:i});return n?.success&&(this.keyBindsetMembership.set(e,!1),this.emit("bindset-selector:key-removed",{key:this.cache.selectedKey,bindset:e,environment:this.cache.currentEnvironment})),n}catch(e){return console.error("[BindsetSelectorService] Error removing key from bindset:",e),{success:!1,error:"remove_failed"}}}shouldDisplay(){return this.cache.preferences.bindsetsEnabled&&this.cache.preferences.bindToAliasMode&&"alias"!==this.cache.currentEnvironment}getCurrentState(){return{selectedKey:this.cache.selectedKey,activeBindset:this.cache.activeBindset,bindsetNames:[...this.cache.bindsetNames],keyBindsetMembership:new Map(this.keyBindsetMembership),shouldDisplay:this.shouldDisplay(),preferences:{...this.cache.preferences}}}handleInitialState(e,t){if(console.log("[BindsetSelectorService] handleInitialState called:",e,!!t),"BindsetService"===e&&t&&t.bindsets&&(this.cache.bindsetNames=t.bindsets,console.log("[BindsetSelectorService] Updated bindsetNames from BindsetService:",this.cache.bindsetNames),this.updateKeyMembership()),"PreferencesService"===e&&this.cache.preferences){console.log("[BindsetSelectorService] Preferences received via ComponentBase");const e=this.shouldDisplay();this.emit("bindset-selector:visibility-changed",{visible:e})}"SelectionService"!==e&&"DataCoordinator"!==e||(console.log("[BindsetSelectorService] Received state from",e,"- updating key membership"),this.updateKeyMembership())}}}),xi=Object.freeze({__proto__:null,default:class extends vt{constructor({eventBus:e,confirmDialog:t=null,document:i=("undefined"!=typeof window?window.document:void 0),i18n:n}={}){super(e),this.componentName="BindsetSelectorUI",this.document=i,this.confirmDialog=t||("undefined"!=typeof window?window.confirmDialog:null),this.i18n=n,this.containerId="bindsetSelectorContainer",this.isOpen=!1,this.service=null,this.keyBindsetMembership=new Map,this.isVisible=!1}async onInit(){this.setupEventListeners(),this.render()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.addEventListener("bindset-selector:active-changed",()=>{this.render()}),this.addEventListener("bindset-selector:membership-updated",({membership:e})=>{console.log("[BindsetSelectorUI] membership-updated received:",Object.fromEntries(e)),console.log("[BindsetSelectorUI] current cache.selectedKey:",this.cache.selectedKey),console.log("[BindsetSelectorUI] Primary Bindset membership:",e.get("Primary Bindset")),this.keyBindsetMembership=e,this.render()}),this.addEventListener("bindset-selector:visibility-changed",({visible:e})=>{this.isVisible=e,this.render()}),this.addEventListener("bindsets:changed",({names:e})=>{console.log("[BindsetSelectorUI] bindsets:changed received:",e),this.render()}),this.addEventListener("key:selected",({key:e})=>{console.log(`[BindsetSelectorUI] key:selected received: key="${e}", current cache.selectedKey="${this.cache.selectedKey}"`),this.request("bindset-selector:set-key",{key:e})}),this.addEventListener("environment:changed",({environment:e})=>{console.log("[BindsetSelectorUI] environment:changed received:",e),this.render()}),this.addEventListener("bindset-manager:open",()=>{this.openBindsetManager()}),this.onDom("bindsetSelectorBtn","click","bindset-toggle",e=>{e.preventDefault(),e.stopPropagation(),this.toggleDropdown()}),this.onDom("#bindsetOptionsMenu","click","bindset-option-selected",e=>{const t=e.target.closest(".bindset-option");if(t&&!e.target.closest(".toolbar-group")){if(t.classList.contains("greyed-out"))return;const e=t.dataset.bindset;this.request("bindset-selector:set-active-bindset",{bindset:e}),this.close()}}),this.onDom("#bindsetOptionsMenu","click","bindset-add-key",e=>{const t=e.target.closest(".add-key-btn");if(t&&!t.disabled){e.preventDefault(),e.stopPropagation();const i=t.dataset.bindset;this.showAddKeyConfirmation(i)}}),this.onDom("#bindsetOptionsMenu","click","bindset-remove-key",e=>{const t=e.target.closest(".remove-key-btn");if(t&&!t.disabled){e.preventDefault(),e.stopPropagation();const i=t.dataset.bindset;this.showRemoveKeyConfirmation(i)}}),this.onDom("manageBindsetsLink","click","bindset-manage",e=>{e.preventDefault(),e.stopPropagation(),this.openBindsetManager(),this.close()}),this.onDom(this.document,"click","bindset-outside-click",e=>{e.target.closest(`#${this.containerId}`)||e.target.closest("#bindsetOptionsMenu")||this.close()}),this.onDom(this.document,"keydown","bindset-escape",e=>{"Escape"===e.key&&this.isOpen&&this.close()}))}render(){const e=this.document?.getElementById(this.containerId);e?(console.log("[BindsetSelectorUI] render() called - isVisible:",this.isVisible,"bindsetNames:",this.cache.bindsetNames),this.isVisible?(e.style.display="block",e.innerHTML=this.generateDropdownHTML(),this.createDropdownMenu()):e.style.display="none"):console.log("[BindsetSelectorUI] Container not found:",this.containerId)}generateDropdownHTML(){return this.cache.activeBindset,`\n      <button class="toolbar-btn" id="bindsetSelectorBtn" title="${this.i18n.t("select_bindset")}">\n        <i class="fas fa-tags"></i>\n      </button>\n    `}generateDropdownMenuHTML(){const e=this.cache.activeBindset;let t='\n      <div id="bindsetOptionsMenu" class="bindset-dropdown-menu" style="display: none;">\n    ';const i="Primary Bindset"===e,n=this.keyBindsetMembership.get("Primary Bindset")||!1;return t+=`\n      <div class="bindset-option ${i?"active":""} ${n?"":"greyed-out"}" data-bindset="Primary Bindset">\n        <span class="bindset-name">${this.i18n.t("primary_bindset")}</span>\n      </div>\n    `,this.cache.bindsetNames.forEach(i=>{if("Primary Bindset"===i)return;const n=e===i,a=this.keyBindsetMembership.get(i)||!1,s=a?"":"greyed-out";console.log(`[BindsetSelectorUI] Bindset: ${i}, hasKey: ${a}, selectedKey: ${this.cache.selectedKey}`),t+=`\n        <div class="bindset-option ${n?"active":""} ${s}" data-bindset="${i}">\n          <span class="bindset-name">${this.escapeHtml(i)}</span>\n          <div class="toolbar-group">\n            <button class="toolbar-btn-small add-key-btn" \n                    data-bindset="${this.escapeHtml(i)}" \n                    title="${this.i18n.t("add_key_to_bindset")}"\n                    ${a?"disabled":""}>\n              <i class="fas fa-plus"></i>\n            </button>\n            <button class="toolbar-btn-small remove-key-btn" \n                    data-bindset="${this.escapeHtml(i)}" \n                    title="${this.i18n.t("remove_key_from_bindset")}"\n                    ${a?"":"disabled"}>\n              <i class="fas fa-minus"></i>\n            </button>\n          </div>\n        </div>\n      `}),t+=`\n        <div class="bindset-dropdown-footer">\n          <a href="#" id="manageBindsetsLink" class="text-link">[${this.i18n.t("manage_bindsets")}]</a>\n        </div>\n      </div>\n    `,t}createDropdownMenu(){const e=this.document?.getElementById("bindsetOptionsMenu");e&&e.remove();const t=this.generateDropdownMenuHTML(),i=this.document?.createElement("div");if(i){i.innerHTML=t;const e=i.firstElementChild;e&&this.document.body.appendChild(e)}}async showAddKeyConfirmation(e){const t=this.i18n.t("add_key_to_bindset_confirm",{key:this.cache.selectedKey,bindset:e});let i=!1;if(this.confirmDialog){const e=this.i18n.t("confirm_add");i=await this.confirmDialog.confirm(t,e,"info","bindsetAddKey")}else i=window.confirm(t);i&&this.request("bindset-selector:add-key-to-bindset",{bindset:e}).then(e=>{e?.success||this.showError(e?.error||"add_failed")}).catch(e=>{console.error("[BindsetSelectorUI] Add key error:",e),this.showError("add_failed")}),this.close()}async showRemoveKeyConfirmation(e){const t=this.i18n.t("remove_key_from_bindset_confirm",{key:this.cache.selectedKey,bindset:e});let i=!1;if(this.confirmDialog){const e=this.i18n.t("confirm_remove");i=await this.confirmDialog.confirm(t,e,"warning","bindsetRemoveKey")}else i=window.confirm(t);i&&this.request("bindset-selector:remove-key-from-bindset",{bindset:e}).then(e=>{e?.success||this.showError(e?.error||"remove_failed")}).catch(e=>{console.error("[BindsetSelectorUI] Remove key error:",e),this.showError("remove_failed")}),this.close()}showError(e){const t=this.i18n.t(`error_${e}`);this.emit("toast:show",{type:"error",message:t,duration:3e3})}openBindsetManager(){this.emit("modal:show",{modalId:"bindsetManagerModal"})}toggleDropdown(){this.isOpen?this.close():this.open()}open(){const e=this.document?.getElementById("bindsetOptionsMenu"),t=this.document?.getElementById("bindsetSelectorBtn");if(e&&t){const i=t.getBoundingClientRect();e.style.left=`${i.left}px`,e.style.top=`${i.bottom+4}px`,e.style.display="block",this.isOpen=!0}}close(){const e=this.document?.getElementById("bindsetOptionsMenu");e&&(e.style.display="none",this.isOpen=!1)}escapeHtml(e){const t=this.document?.createElement("div");return t?(t.textContent=e,t.innerHTML):String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}handleInitialState(e,t){"BindsetSelectorService"===e&&t&&(console.log("[BindsetSelectorUI] handleInitialState from BindsetSelectorService:",t),this.keyBindsetMembership=t.keyBindsetMembership||new Map,this.isVisible=t.shouldDisplay||!1,this.render())}}});
//# sourceMappingURL=bundle.js.map
