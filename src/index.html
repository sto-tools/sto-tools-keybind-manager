<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="sto_tools_keybind_manager"></title>
    <meta
      name="description"
      content="Star Trek Online Keybind Manager - Create, edit, and export keybind configurations"
    />
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css"
    />
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="header-left">
          <h1>
            <a
              href="https://sto-tools.org/"
              target="_blank"
              rel="noopener noreferrer"
              ><img
                src="img/delta_64x64.png"
                alt="STO Tools Logo"
                class="app-logo"
            /></a>
            <span data-i18n="sto_tools_keybind_manager"></span>
          </h1>
          <span class="version" id="appVersion"></span>
        </div>
        <div class="header-right">
          <div class="dropdown">
            <button
              class="btn btn-secondary dropdown-toggle"
              id="backupMenuBtn"
              data-i18n-title="backup_menu"
            >
              <i class="fas fa-save"></i>
              <span data-i18n="backup"></span>
            </button>
            <div class="dropdown-menu" id="backupMenu">
              <button class="dropdown-item" id="saveProjectBtn" data-i18n-title="backup_application_state">
                <i class="fas fa-download"></i>
                <span data-i18n="backup_application_state"></span>
              </button>
              <button class="dropdown-item" id="openProjectBtn" data-i18n-title="restore_application_state">
                <i class="fas fa-upload"></i>
                <span data-i18n="restore_application_state"></span>
              </button>
            </div>
          </div>
          <button
            class="btn btn-secondary"
            id="fileExplorerBtn"
            data-i18n-title="file_explorer"
          >
            <i class="fas fa-sitemap"></i>
            <span data-i18n="explorer"></span>
          </button>
          <div class="dropdown">
            <button
              class="btn btn-secondary dropdown-toggle"
              id="importMenuBtn"
              data-i18n-title="import"
            >
              <i class="fas fa-file-import"></i>
              <span data-i18n="import"></span>
            </button>
            <div class="dropdown-menu" id="importMenu">
              <button class="dropdown-item" id="importKeybindsBtn">
                <i class="fas fa-keyboard"></i>
                <span data-i18n="import_keybinds"></span>
              </button>
              <button class="dropdown-item" id="importAliasesBtn">
                <i class="fas fa-mask"></i>
                <span data-i18n="import_aliases"></span>
              </button>
            </div>
          </div>
          <button class="btn btn-secondary" id="vertigoBtn" data-i18n-title="vfx_manager">
            <i class="fas fa-eye-slash"></i>
            <span data-i18n="vfx"></span>
          </button>
          <button class="btn btn-secondary" id="syncNowBtn" data-i18n-title="sync_now">
            <i class="fas fa-sync"></i>
            <span data-i18n="sync_now"></span>
          </button>
          <div class="dropdown language-select">
            <button class="btn btn-icon dropdown-toggle" id="languageMenuBtn" data-i18n-title="language">
              <span id="languageFlag" class="fi fi-gb"></span>
            </button>
            <div class="dropdown-menu" id="languageMenu">
              <button class="dropdown-item language-option" data-lang="en">
                <span class="fi fi-gb"></span>
                <span>English</span>
              </button>
              <button class="dropdown-item language-option" data-lang="de">
                <span class="fi fi-de"></span>
                <span>Deutsch</span>
              </button>
              <button class="dropdown-item language-option" data-lang="es">
                <span class="fi fi-es"></span>
                <span>Español</span>
              </button>
              <button class="dropdown-item language-option" data-lang="fr">
                <span class="fi fi-fr"></span>
                <span>Français</span>
              </button>
            </div>
          </div>
          <div class="dropdown">
            <button
              class="btn btn-icon dropdown-toggle"
              id="settingsBtn"
              data-i18n-title="settings"
            >
              <i class="fas fa-cog"></i>
            </button>
            <div class="dropdown-menu" id="settingsMenu">
              <button class="dropdown-item" id="preferencesBtn">
                <i class="fas fa-sliders-h"></i>
                <span data-i18n="preferences"></span>
              </button>
              <button class="dropdown-item" id="themeToggleBtn">
                <i class="fas fa-moon"></i>
                <span id="themeToggleText" data-i18n="dark_mode"></span>
              </button>
              <button class="dropdown-item" id="loadDefaultDataBtn">
                <i class="fas fa-download"></i>
                <span data-i18n="load_default_data"></span>
              </button>
              <button class="dropdown-item" id="resetAppBtn">
                <i class="fas fa-refresh"></i>
                <span data-i18n="reset_application"></span>
              </button>
              <button class="dropdown-item" id="aboutBtn">
                <i class="fas fa-info-circle"></i>
                <span data-i18n="about"></span>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Profile Bar -->
      <div class="profile-bar">
        <div class="profile-selector">
          <i class="fas fa-clipboard-list"></i>
          <select id="profileSelect" data-i18n-title="select_profile">
            <!-- Profiles populated by JavaScript -->
          </select>
          <div class="toolbar-group">
            <button class="toolbar-btn toolbar-btn-primary" id="newProfileBtn" data-i18n-title="new_profile">
              <i class="fas fa-plus"></i>
            </button>
            <button class="toolbar-btn" id="cloneProfileBtn" data-i18n-title="clone_profile">
              <i class="fas fa-copy"></i>
            </button>
            <button class="toolbar-btn" id="renameProfileBtn" data-i18n-title="rename_profile">
              <i class="fas fa-edit"></i>
            </button>
            <button class="toolbar-btn toolbar-btn-danger" id="deleteProfileBtn" data-i18n-title="delete_profile">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="toolbar-group">
            <button class="toolbar-btn" id="bindsetManagerBtn" style="display:none" data-i18n-title="bindset_manager">
              <i class="fas fa-tags"></i>
            </button>
          </div>
        </div>
        <div class="status-indicators">
          <span
            class="modified-indicator"
            id="modifiedIndicator"
            style="display: none"
            data-i18n-title="unsaved_changes"
          >
            <i class="fas fa-circle"></i>
            <span data-i18n="modified"></span>
          </span>
          <span
            class="status-indicator"
            id="statusIndicator"
            data-i18n-title="validation_status"
          >
            <i class="fas fa-check-circle"></i>
            <span data-i18n="valid"></span>
          </span>
          <span class="key-count" id="keyCount" data-i18n-title="bound_keys">
            0 keys
          </span>
          <span class="alias-count" id="aliasCount" data-i18n-title="bound_aliases" title="Bound Aliases" style="display: none;">
            0 aliases
          </span>
        </div>
        <div class="profile-info">
          <div class="mode-toggle">
            <button
              class="mode-btn active"
              data-mode="space"
              data-i18n-title="space_mode"
            >
              <i class="fas fa-rocket"></i>
              <span data-i18n="space"></span>
            </button>
            <button class="mode-btn" data-mode="ground" data-i18n-title="ground_mode">
              <i class="fas fa-user"></i>
              <span data-i18n="ground"></span>
            </button>
            <button class="mode-btn" data-mode="alias" data-i18n-title="alias_mode">
              <i class="fas fa-mask"></i>
              <span data-i18n="aliases"></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Key Selector -->
        <div class="key-selector-container">
          <div class="key-selector-header">
            <div class="key-header-left">
              <h3 data-i18n="keys_firstupper"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Key Actions -->
              <div class="toolbar-group">
                <button class="toolbar-btn toolbar-btn-primary" id="addKeyBtn" data-i18n-title="add_new_key">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="toolbar-btn toolbar-btn-danger" id="deleteKeyBtn" disabled data-i18n-title="delete_selected_key">
                  <i class="fas fa-trash"></i>
                </button>
                <button class="toolbar-btn" id="duplicateKeyBtn" disabled data-i18n-title="duplicate_selected_key">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
              <!-- View Controls -->
              <div class="toolbar-group">
                <button
                  class="toolbar-btn"
                  id="toggleKeyViewBtn"
                  data-i18n-title="toggle_between_grid_and_categorized_view"
                >
                  <i class="fas fa-list"></i>
                </button>
              </div>
              <!-- Search/Filter (rightmost) -->
              <div class="toolbar-group">
                <div class="toolbar-search">
                  <input
                    type="text"
                    id="keyFilter"
                    data-i18n-placeholder="filter_keys"
                    class="toolbar-search-input"
                  />
                  <button class="toolbar-btn toolbar-search-btn" id="keySearchBtn" data-i18n-title="search_keys">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
                <button class="toolbar-btn" id="showAllKeysBtn" data-i18n-title="show_all_keys" aria-label="Show All Keys">
                  <i class="fas fa-times-circle"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="key-selector">
            <div class="key-grid" id="keyGrid">
              <!-- Keys populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Alias Selector -->
        <div class="alias-selector-container" id="aliasSelectorContainer" style="display: none;">
          <div class="alias-selector-header">
            <div class="alias-header-left">
              <h3 data-i18n="aliases"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Alias Actions -->
              <div class="toolbar-group">
                <button class="toolbar-btn toolbar-btn-primary" id="addAliasChainBtn" data-i18n-title="add_new_alias">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="toolbar-btn toolbar-btn-danger" id="deleteAliasChainBtn" disabled data-i18n-title="delete_selected_alias">
                  <i class="fas fa-trash"></i>
                </button>
                <button class="toolbar-btn" id="duplicateAliasChainBtn" disabled data-i18n-title="duplicate_selected_alias">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
              <!-- Search/Filter (rightmost) -->
              <div class="toolbar-group">
                <div class="toolbar-search">
                  <input
                    type="text"
                    id="aliasFilter"
                    data-i18n-placeholder="filter_aliases"
                    class="toolbar-search-input"
                  />
                  <button class="toolbar-btn toolbar-search-btn" id="aliasSearchBtn" data-i18n-title="search_aliases">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
                <button class="toolbar-btn" id="showAllAliasesBtn" data-i18n-title="clear_filter" aria-label="Clear filter">
                  <i class="fas fa-times-circle"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="alias-selector">
            <div class="alias-grid-container">
              <div class="alias-grid" id="aliasGrid">
                <!-- Aliases populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>

        <!-- Command Chain Editor -->
        <div class="command-chain-container">
          <div class="chain-header">
            <div class="chain-header-left">
              <h3 id="chainTitle"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Bindset selector -->
              <div class="toolbar-group">
                <div id="bindsetSelectorContainer" style="display:none;"></div>
              </div>
              <!-- Options -->
              <div class="toolbar-group">
                <button
                  class="toolbar-btn toolbar-toggle"
                  id="stabilizeExecutionOrderBtn"
                  data-i18n-title="ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left"
                >
                  <i class="fas fa-balance-scale"></i>
                </button>
                <select id="bindsetSelect" class="bindset-select" style="display:none; position:absolute; z-index:1000;"></select>
              </div>
              
              <!-- Chain Actions -->
              <div class="toolbar-group">
                <button class="toolbar-btn" id="importFromKeyOrAliasBtn" disabled data-i18n-title="import_from_key_or_alias">
                  <i class="fas fa-copy"></i>
                </button>
                <button class="toolbar-btn" id="validateChainBtn" data-i18n-title="validate_command_chain">
                  <i class="fas fa-check"></i>
                </button>
                <button class="toolbar-btn toolbar-btn-danger" id="clearChainBtn" data-i18n-title="clear_all_commands">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            
            <!-- Hidden checkbox for stabilize (controlled by toolbar button) -->
            <input type="checkbox" id="stabilizeExecutionOrder" style="display: none;" />
            
                      </div>

          <div class="command-list-container">
            <div class="command-list" id="commandList">
              <div class="empty-state" id="emptyState">
                <i class="fas fa-keyboard"></i>
                <h4 data-i18n="no_key_selected"></h4>
                <p data-i18n="select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain"></p>
              </div>
            </div>
          </div>

          <!-- Generated Alias (shown when bind-to-alias mode is active) -->
          <div class="generated-alias" id="generatedAlias" style="display: none;">
            <div class="command-preview-header">
              <label data-i18n="generated_alias"></label>
              <span class="command-count-display" id="aliasCommandCountDisplay" style="display: none;">
                (<span id="aliasCommandCount">0</span> <span data-i18n="commands"></span> in chain)
              </span>
              <button
                class="btn btn-small"
                id="copyAliasBtn"
                data-i18n-title="copy_to_clipboard"
              >
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="command-preview" id="aliasPreview"></div>
          </div>

          <div class="generated-command">
            <div class="command-preview-header">
              <label data-i18n="generated_command"></label>
              <span class="command-count-display" id="commandCountDisplay">
                (<span id="commandCount">0</span> <span data-i18n="commands"></span> in chain)
              </span>
              <button
                class="btn btn-small"
                id="copyPreviewBtn"
                data-i18n-title="copy_to_clipboard"
              >
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="command-preview" id="commandPreview"></div>
          </div>


        </div>

        <!-- Command Library -->
        <div class="command-library">
          <div class="library-header">
            <div class="library-header-left">
              <h3 data-i18n="command_library"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Search -->
              <div class="toolbar-group">
                <div class="toolbar-search">
                  <input
                    type="text"
                    id="commandSearch"
                    data-i18n-placeholder="search_commands"
                    class="toolbar-search-input"
                  />
                  <button class="toolbar-btn toolbar-search-btn" id="commandSearchBtn" data-i18n-title="search_commands">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
                <button class="toolbar-btn" id="showAllCommandsBtn" data-i18n-title="clear_filter" aria-label="Clear filter">
                  <i class="fas fa-times-circle"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="library-content" id="libraryContent">
            <div class="command-categories" id="commandCategories">
              <!-- Non-alias command categories populated by JavaScript -->
              <div id="commandCategoriesList"></div>
              <!-- Alias and Vertigo alias categories will be injected here so they share styling/scrollbar -->
              <div id="aliasCategoriesList"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Toast Notifications -->
      <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay"></div>

    <!-- Duplicate Alias Modal -->
    <div class="modal" id="aliasDuplicateModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="duplicate_alias">Duplicate Alias</h3>
          <button class="modal-close" data-modal="aliasDuplicateModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="duplicateAliasNameInput" data-i18n="enter_new_alias_name"></label>
            <input type="text" id="duplicateAliasNameInput" />
            <div class="validation-error" id="duplicateAliasValidation" style="display:none;" data-i18n="alias_name_in_use"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="confirmDuplicateAliasBtn" disabled data-i18n="duplicate"></button>
          <button class="btn btn-secondary" data-modal="aliasDuplicateModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- Create Alias Modal -->
    <div class="modal" id="aliasCreationModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="create_alias">Create Alias</h3>
          <button class="modal-close" data-modal="aliasCreationModal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="newAliasNameInput" data-i18n="alias_name"></label>
            <input type="text" id="newAliasNameInput" />
            <div class="validation-error" id="createAliasValidation" style="display:none;"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="confirmCreateAliasBtn" disabled data-i18n="create"></button>
          <button class="btn btn-secondary" data-modal="aliasCreationModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>



    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="profileModalTitle" data-i18n="profile"></h3>
          <button class="modal-close" data-modal="profileModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="profileName" data-i18n="profile_name"></label>
            <input
              type="text"
              id="profileName"
              data-i18n-placeholder="enter_profile_name"
              autocomplete="off"
            />
          </div>
          <div class="form-group">
            <label for="profileDescription" data-i18n="description_optional"></label>
            <textarea
              id="profileDescription"
              data-i18n-placeholder="describe_this_keybind_profile"
              rows="3"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="saveProfileBtn" data-i18n="save"></button>
          <button class="btn btn-secondary" data-modal="profileModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>



    <!-- Enhanced Key Selection Modal -->
    <div class="modal extra-large-modal" id="keySelectionModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="select_key_dialog_title">Select Key</h3>
          <button class="modal-close" data-modal="keySelectionModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <!-- Content dynamically generated by KeyCaptureUI -->
            </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal large-modal" id="vertigoModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="vfx_manager">VFX Manager</h3>
          <button class="modal-close" data-modal="vertigoModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="vertigo-content">
            <div class="vertigo-header">
              <p data-i18n="vfx_manager_description">
                Select visual effects to disable using dynFxSetFXExlusionList
                aliases. Effects are organized by environment.
              </p>
            </div>
            <div class="vertigo-environments">
              <div class="vertigo-environment">
                <div class="environment-header">
                  <h4><i class="fas fa-rocket"></i> <span data-i18n="space_effects">Space Effects</span></h4>
                  <div class="environment-controls">
                    <button class="btn btn-small" id="spaceSelectAll" data-i18n="select_all">
                      Select All
                    </button>
                    <button class="btn btn-small" id="spaceClearAll" data-i18n="clear_all">
                      Clear All
                    </button>
                    <span class="effect-count" id="spaceEffectCount">0</span>
                  </div>
                </div>
                <div class="effects-list" id="spaceEffectsList">
                  <!-- Space effects populated by JavaScript -->
                </div>
              </div>
              <div class="vertigo-environment">
                <div class="environment-header">
                  <h4 data-i18n="ground_effects"><i class="fas fa-user"></i> Ground Effects</h4>
                  <div class="environment-controls">
                    <button class="btn btn-small" id="groundSelectAll" data-i18n="select_all">
                      Select All
                    </button>
                    <button class="btn btn-small" id="groundClearAll" data-i18n="clear_all">
                      Clear All
                    </button>
                    <span class="effect-count" id="groundEffectCount">0</span>
                  </div>
                </div>
                <div class="effects-list" id="groundEffectsList">
                  <!-- Ground effects populated by JavaScript -->
                </div>
              </div>
            </div>
            <div class="vertigo-preview">
              <div class="alias-preview-section">
                <h4 data-i18n="generated_aliases">Generated Aliases:</h4>
                <div class="alias-preview" id="spaceAliasPreview">
                  <label data-i18n="space_alias">Space Alias:</label>
                  <div class="command-preview" id="spaceAliasCommand" data-i18n="no_space_effects_selected">
                    No space effects selected
                  </div>
                </div>
                <div class="alias-preview" id="groundAliasPreview">
                  <label data-i18n="ground_alias">Ground Alias:</label>
                  <div class="command-preview" id="groundAliasCommand" data-i18n="no_ground_effects_selected">
                    No ground effects selected
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="vertigo-controls">
            <label class="checkbox-label">
              <input type="checkbox" id="vertigoShowPlayerSay" />
              <span class="checkmark"></span>
              <span data-i18n="show_player_say">Show Player Say</span>
            </label>
          </div>

          <button class="btn btn-primary" id="saveVertigoBtn" data-i18n="generate_aliases">
            Generate Aliases
          </button>
          <button class="btn btn-secondary" data-modal="vertigoModal" data-i18n="cancel">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="about_sto_tools_keybind_manager"></h3>
          <button class="modal-close" data-modal="aboutModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="about-content">
            <div class="app-info">
              <h4>
                <i class="fas fa-bolt"></i>
                <span data-i18n="sto_tools_keybind_manager"></span>
                <span id="aboutVersion"></span>
              </h4>
              <p data-i18n="app_description">
                A comprehensive web-based tool for creating, editing, and
                managing Star Trek Online keybind configurations with visual
                editing and advanced features.
              </p>
            </div>
            <div class="features">
              <h4 data-i18n="features">Features:</h4>
              <ul>
                <li data-i18n="visual_keybind_editor">Visual keybind editor</li>
                <li data-i18n="sto_command_library_with_search_and_categorization">STO command library with search and categorization</li>
                <li data-i18n="multiple_profile_management_create_clone_rename_delete">
                  Multiple profile management (create, clone, rename, delete)
                </li>
                <li data-i18n="custom_alias_system_for_complex_command_sequences">Custom alias system for complex command sequences</li>
                <li data-i18n="vertigo_inspired_vfx_manager_for_visual_effects_control">VERTIGO-inspired VFX Manager for visual effects control</li>
                <li data-i18n="import_export_keybind_and_alias_files_and_project_backups">
                  Import/export keybind and alias files, and project backups
                </li>
                <li data-i18n="real_time_validation_and_command_preview">Real-time validation and command preview</li>
              </ul>
            </div>
            <div class="usage">
              <h4 data-i18n="quick_start">Quick Start:</h4>
              <ol>
                <li data-i18n="create_a_new_profile_or_use_the_default_profile">Create a new profile or use the default profile</li>
                <li data-i18n="select_keys_from_the_grid_and_add_commands_from_the_library">
                  Select keys from the grid and add commands from the library
                </li>
                <li data-i18n="use_the_command_chain_editor_to_build_complex_sequences">Use the command chain editor to build complex sequences</li>
                <li data-i18n="export_your_keybinds_as_txt_files_for_use_in_sto">Export your keybinds as .txt files for use in STO</li>
              </ol>
            </div>
            <div class="contact-info">
              <h4 data-i18n="resources">Resources:</h4>
              <p>
                <i class="fas fa-globe"></i>
                <a
                  href="https://sto-tools.org/"
                  target="_blank"
                  rel="noopener noreferrer"
                >https://sto-tools.org/</a>
                | <i class="fas fa-envelope"></i>
                <a href="mailto:keybinds@sto-tools.org">keybinds@sto-tools.org</a>
              </p>
            </div>
            <div class="copyright">
              <p><small data-i18n="copyright">© 2025 STO Tools. All rights reserved.</small></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" data-modal="aboutModal" data-i18n="got_it"></button>
        </div>
      </div>
    </div>

    <!-- Preferences Modal -->
    <div class="modal large-modal" id="preferencesModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="preferences"></h3>
          <button class="modal-close" data-modal="preferencesModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="preferences-layout">
            <!-- Category Tree -->
            <div class="preferences-sidebar">
              <div class="category-tree">
                <div class="category-item active" data-category="sync">
                  <i class="fas fa-sync-alt"></i>
                  <span data-i18n="synchronization"></span>
                </div>
                <div class="category-item" data-category="advanced">
                  <i class="fas fa-cogs"></i>
                  <span data-i18n="advanced"></span>
                </div>
              </div>
            </div>
            
            <!-- Settings Content -->
            <div class="preferences-content">
                              <!-- Sync Settings -->
                <div class="settings-panel active" id="sync-settings">
                  <h4 data-i18n="synchronization_settings"></h4>
                  <div class="settings-group">
                    <div class="setting-item">
                      <label data-i18n="sync_folder_label"></label>
                      <div class="setting-control">
                        <div class="folder-setting">
                          <span id="currentSyncFolder" class="folder-path" data-i18n="no_folder_selected"></span>
                          <button type="button" class="btn btn-secondary" id="setSyncFolderBtn">
                            <i class="fas fa-folder-open"></i>
                            <span data-i18n="set_sync_folder"></span>
                          </button>
                        </div>
                        <span class="setting-description" data-i18n="sync_folder_description"></span>
                      </div>
                    </div>
                    <div class="setting-item">
                      <label data-i18n="auto_sync"></label>
                      <div class="setting-control">
                        <label class="toggle-switch">
                          <input type="checkbox" id="autoSync">
                          <span class="slider"></span>
                        </label>
                        <span class="setting-description" data-i18n="auto_sync_description"></span>
                      </div>
                    </div>
                    <div class="setting-item">
                      <label data-i18n="auto_sync_interval"></label>
                      <div class="setting-control">
                        <select id="autoSyncInterval" class="setting-select">
                          <option value="change" data-i18n="after_every_change"></option>
                          <option value="60" data-i18n="every_1_minute"></option>
                          <option value="120" data-i18n="every_2_minutes"></option>
                          <option value="300" data-i18n="every_5_minutes"></option>
                        </select>
                        <span class="setting-description" data-i18n="auto_sync_interval_description"></span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Advanced Settings -->
                <div class="settings-panel" id="advanced-settings">
                  <h4 data-i18n="advanced_settings"></h4>
                  <div class="settings-group">
                    <div class="setting-item">
                      <label data-i18n="bind_to_alias_mode"></label>
                      <div class="setting-control">
                        <label class="toggle-switch">
                          <input type="checkbox" id="bindToAliasModeCheckbox">
                          <span class="slider"></span>
                        </label>
                        <span class="setting-description" data-i18n="bind_to_alias_mode_description"></span>
                      </div>
                    </div>
                    <div class="setting-item">
                      <label data-i18n="bindsets_enabled"></label>
                      <div class="setting-control">
                        <label class="toggle-switch">
                          <input type="checkbox" id="bindsetsEnabledCheckbox" disabled>
                          <span class="slider"></span>
                        </label>
                        <span class="setting-description" data-i18n="bindsets_enabled_description"></span>
                      </div>
                    </div>
                    <div class="setting-item">
                      <label data-i18n="translate_generated_messages"></label>
                      <div class="setting-control">
                        <label class="toggle-switch">
                          <input type="checkbox" id="translateGeneratedMessagesCheckbox">
                          <span class="slider"></span>
                        </label>
                        <span class="setting-description" data-i18n="translate_generated_messages_description"></span>
                      </div>
                    </div>
                  </div>
                </div>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="savePreferencesBtn" data-i18n="save"></button>
          <button class="btn btn-secondary" data-modal="preferencesModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- File Explorer Modal -->
    <div class="modal large-modal" id="fileExplorerModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="file_explorer"></h3>
          <button class="modal-close" data-modal="fileExplorerModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="file-explorer-content">
            <div class="file-tree" id="fileTree">
              <!-- Tree populated by JavaScript -->
            </div>
            <div class="file-details">
              <div class="file-actions">
                <button
                  class="btn btn-small"
                  id="copyFileContentBtn"
                  data-i18n-title="copy_to_clipboard"
                >
                  <i class="fas fa-copy"></i>
                  <span data-i18n="copy"></span>
                </button>
                <button
                  class="btn btn-small"
                  id="downloadFileBtn"
                >
                  <i class="fas fa-download"></i>
                  <span data-i18n="download"></span>
                </button>
              </div>
              <pre class="file-content" id="fileContent" data-i18n="select_an_item_on_the_left_to_preview_export"></pre>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-modal="fileExplorerModal" data-i18n="close"></button>
        </div>
    </div>
  </div>

    <!-- Import from Key or Alias Modal -->
    <div class="modal" id="importFromKeyOrAliasModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="import_from_key_or_alias"></h3>
          <button class="modal-close" data-modal="importFromKeyOrAliasModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label data-i18n="select_source_to_import_from"></label>
            <select id="importSourceSelect">
              <!-- Options populated by JavaScript -->
            </select>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="clearDestinationBeforeImport" />
              <span class="checkmark"></span>
              <span data-i18n="clear_destination_chain_prior_to_import"></span>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="confirmImportBtn" data-i18n="import"></button>
          <button class="btn btn-secondary" data-modal="importFromKeyOrAliasModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    

    <!-- File input for imports (hidden) -->
    <input
      type="file"
      id="fileInput"
      accept=".json,.txt"
      style="display: none"
    />

    <!-- Bindset Manager Modal -->
    <div class="modal" id="bindsetManagerModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="bindset_manager"></h3>
          <button class="modal-close" data-modal="bindsetManagerModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="bindset-list-container">
            <ul id="bindsetList" class="bindset-list"></ul>
          </div>
          <div class="bindset-actions">
            <button class="btn btn-small" id="createBindsetBtn" data-i18n="create"></button>
            <button class="btn btn-small" id="renameBindsetBtn" data-i18n="rename" disabled></button>
            <button class="btn btn-small btn-danger" id="deleteBindsetBtn" data-i18n="delete" disabled></button>
          </div>
          <span id="bindsetError" class="error-text" style="display:none"></span>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" data-modal="bindsetManagerModal" data-i18n="close"></button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="dist/bundle.js"></script>
  </body>
</html>
