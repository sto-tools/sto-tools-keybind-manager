<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="sto_tools_keybind_manager"></title>
    <meta
      name="description"
      content="Star Trek Online Keybind Manager - Create, edit, and export keybind configurations"
    />
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css"
    />
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="header-left">
          <h1>
            <a
              href="https://sto-tools.org/"
              target="_blank"
              rel="noopener noreferrer"
              ><img
                src="img/delta_64x64.png"
                alt="STO Tools Logo"
                class="app-logo"
            /></a>
            <span data-i18n="sto_tools_keybind_manager"></span>
          </h1>
          <span class="version" id="appVersion"></span>
        </div>
        <div class="header-right">
          <div class="dropdown">
            <button
              class="btn btn-secondary dropdown-toggle"
              id="backupMenuBtn"
              data-i18n-title="backup_menu"
            >
              <i class="fas fa-save"></i>
              <span data-i18n="backup"></span>
            </button>
            <div class="dropdown-menu" id="backupMenu">
              <button class="dropdown-item" id="saveProjectBtn" data-i18n-title="backup_application_state">
                <i class="fas fa-download"></i>
                <span data-i18n="backup_application_state"></span>
              </button>
              <button class="dropdown-item" id="openProjectBtn" data-i18n-title="restore_application_state">
                <i class="fas fa-upload"></i>
                <span data-i18n="restore_application_state"></span>
              </button>
            </div>
          </div>
          <button
            class="btn btn-secondary"
            id="fileExplorerBtn"
            data-i18n-title="file_explorer"
          >
            <i class="fas fa-sitemap"></i>
            <span data-i18n="explorer"></span>
          </button>
          <div class="dropdown">
            <button
              class="btn btn-secondary dropdown-toggle"
              id="importMenuBtn"
              data-i18n-title="import"
            >
              <i class="fas fa-file-import"></i>
              <span data-i18n="import"></span>
            </button>
            <div class="dropdown-menu" id="importMenu">
              <button class="dropdown-item" id="importKeybindsBtn">
                <i class="fas fa-keyboard"></i>
                <span data-i18n="import_keybinds"></span>
              </button>
              <button class="dropdown-item" id="importAliasesBtn">
                <i class="fas fa-mask"></i>
                <span data-i18n="import_aliases"></span>
              </button>
            </div>
          </div>
          <button class="btn btn-secondary" id="vertigoBtn" data-i18n-title="vfx_manager">
            <i class="fas fa-eye-slash"></i>
            <span data-i18n="vfx"></span>
          </button>
          <button class="btn btn-secondary" id="syncNowBtn" data-i18n-title="sync_now">
            <i class="fas fa-sync"></i>
            <span data-i18n="sync_now"></span>
          </button>
          <div class="dropdown language-select">
            <button class="btn btn-icon dropdown-toggle" id="languageMenuBtn" data-i18n-title="language">
              <span id="languageFlag" class="fi fi-gb"></span>
            </button>
            <div class="dropdown-menu" id="languageMenu">
              <button class="dropdown-item language-option" data-lang="en">
                <span class="fi fi-gb"></span>
                <span>English</span>
              </button>
              <button class="dropdown-item language-option" data-lang="de">
                <span class="fi fi-de"></span>
                <span>Deutsch</span>
              </button>
              <button class="dropdown-item language-option" data-lang="es">
                <span class="fi fi-es"></span>
                <span>Español</span>
              </button>
              <button class="dropdown-item language-option" data-lang="fr">
                <span class="fi fi-fr"></span>
                <span>Français</span>
              </button>
            </div>
          </div>
          <div class="dropdown">
            <button
              class="btn btn-icon dropdown-toggle"
              id="settingsBtn"
              data-i18n-title="settings"
            >
              <i class="fas fa-cog"></i>
            </button>
            <div class="dropdown-menu" id="settingsMenu">
              <button class="dropdown-item" id="preferencesBtn">
                <i class="fas fa-sliders-h"></i>
                <span data-i18n="preferences"></span>
              </button>
              <button class="dropdown-item" id="themeToggleBtn">
                <i class="fas fa-moon"></i>
                <span id="themeToggleText" data-i18n="dark_mode"></span>
              </button>
              <button class="dropdown-item" id="loadDefaultDataBtn">
                <i class="fas fa-download"></i>
                <span data-i18n="load_default_data"></span>
              </button>
              <button class="dropdown-item" id="resetAppBtn">
                <i class="fas fa-refresh"></i>
                <span data-i18n="reset_application"></span>
              </button>
              <button class="dropdown-item" id="aboutBtn">
                <i class="fas fa-info-circle"></i>
                <span data-i18n="about"></span>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Profile Bar -->
      <div class="profile-bar">
        <div class="profile-selector">
          <i class="fas fa-clipboard-list"></i>
          <select id="profileSelect" data-i18n-title="select_profile">
            <!-- Profiles populated by JavaScript -->
          </select>
          <div class="profile-actions">
            <button class="btn-small" id="newProfileBtn" data-i18n-title="new_profile">
              <i class="fas fa-plus"></i>
              <span data-i18n="new"></span>
            </button>
            <button
              class="btn-small"
              id="cloneProfileBtn"
              data-i18n-title="clone_profile"
            >
              <i class="fas fa-copy"></i>
              <span data-i18n="clone"></span>
            </button>
            <button
              class="btn-small"
              id="renameProfileBtn"
              data-i18n-title="rename_profile"
            >
              <i class="fas fa-edit"></i>
              <span data-i18n="rename"></span>
            </button>
            <button
              class="btn-small btn-danger"
              id="deleteProfileBtn"
              data-i18n-title="delete_profile"
            >
              <i class="fas fa-trash"></i>
              <span data-i18n="delete"></span>
            </button>
          </div>
        </div>
        <div class="status-indicators">
          <span
            class="modified-indicator"
            id="modifiedIndicator"
            style="display: none"
            data-i18n-title="unsaved_changes"
          >
            <i class="fas fa-circle"></i>
            <span data-i18n="modified"></span>
          </span>
          <span
            class="status-indicator"
            id="statusIndicator"
            data-i18n-title="validation_status"
          >
            <i class="fas fa-check-circle"></i>
            <span data-i18n="valid"></span>
          </span>
          <span class="key-count" id="keyCount" data-i18n-title="bound_keys">
            0 keys
          </span>
        </div>
      <div class="profile-info">
          <div class="mode-toggle">
            <button
              class="mode-btn active"
              data-mode="space"
              data-i18n-title="space_mode"
            >
              <i class="fas fa-rocket"></i>
              <span data-i18n="space"></span>
            </button>
            <button class="mode-btn" data-mode="ground" data-i18n-title="ground_mode">
              <i class="fas fa-user"></i>
              <span data-i18n="ground"></span>
            </button>
            <button class="mode-btn" data-mode="alias" data-i18n-title="alias_mode">
              <i class="fas fa-mask"></i>
              <span data-i18n="aliases"></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Key Selector -->
        <div class="key-selector-container">
          <div class="key-selector-header">
            <div class="key-header-left">
              <h3 data-i18n="keys_firstupper"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Key Actions -->
              <div class="toolbar-group">
                <button class="toolbar-btn toolbar-btn-primary" id="addKeyBtn" data-i18n-title="add_new_key">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="toolbar-btn toolbar-btn-danger" id="deleteKeyBtn" disabled data-i18n-title="delete_selected_key">
                  <i class="fas fa-trash"></i>
                </button>
                <button class="toolbar-btn" id="duplicateKeyBtn" disabled data-i18n-title="duplicate_selected_key">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
              <!-- View Controls -->
              <div class="toolbar-group">
                <button
                  class="toolbar-btn"
                  id="toggleKeyViewBtn"
                  data-i18n-title="toggle_between_grid_and_categorized_view"
                >
                  <i class="fas fa-list"></i>
                </button>
              </div>
              <!-- Search/Filter (rightmost) -->
              <div class="toolbar-group">
                <div class="toolbar-search">
                  <input
                    type="text"
                    id="keyFilter"
                    data-i18n-placeholder="filter_keys"
                    class="toolbar-search-input"
                  />
                  <button class="toolbar-btn toolbar-search-btn" id="keySearchBtn" data-i18n-title="search_keys">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
                <button class="toolbar-btn" id="showAllKeysBtn" data-i18n-title="show_all_keys">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="key-selector">
            <div class="key-grid" id="keyGrid">
              <!-- Keys populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Alias Selector -->
        <div class="alias-selector-container" id="aliasSelectorContainer" style="display: none;">
          <div class="alias-selector-header">
            <div class="alias-header-left">
              <h3 data-i18n="aliases"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Alias Actions -->
              <div class="toolbar-group">
                <button class="toolbar-btn toolbar-btn-primary" id="addAliasChainBtn" data-i18n-title="add_new_alias">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="toolbar-btn toolbar-btn-danger" id="deleteAliasChainBtn" disabled data-i18n-title="delete_selected_alias">
                  <i class="fas fa-trash"></i>
                </button>
                <button class="toolbar-btn" id="duplicateAliasChainBtn" disabled data-i18n-title="duplicate_selected_alias">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
              <!-- Search/Filter (rightmost) -->
              <div class="toolbar-group">
                <div class="toolbar-search">
                  <input
                    type="text"
                    id="aliasFilter"
                    data-i18n-placeholder="filter_aliases"
                    class="toolbar-search-input"
                  />
                  <button class="toolbar-btn toolbar-search-btn" id="aliasSearchBtn" data-i18n-title="search_aliases">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
                <button class="toolbar-btn" id="showAllAliasesBtn" data-i18n-title="show_all_aliases">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="alias-selector">
            <div class="alias-grid-container">
              <div class="alias-grid" id="aliasGrid">
                <!-- Aliases populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>

        <!-- Command Chain Editor -->
        <div class="command-chain-container">
          <div class="chain-header">
            <div class="chain-header-left">
              <h3 id="chainTitle" data-i18n="select_a_key_to_edit"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Options -->
              <div class="toolbar-group">
                <button
                  class="toolbar-btn toolbar-toggle"
                  id="stabilizeExecutionOrderBtn"
                  data-i18n-title="ensures_consistent_execution_order_by_mirroring_commands_phase_1_left_to_right_phase_2_right_to_left"
                >
                  <i class="fas fa-balance-scale"></i>
                </button>
                <button
                  class="toolbar-btn toolbar-toggle"
                  id="aliasOptionsBtn"
                  data-i18n-title="alias_options"
                  style="display: none;"
                >
                  <i class="fas fa-cog"></i>
                </button>
              </div>
              
              <!-- Chain Actions -->
              <div class="toolbar-group">
                <button class="toolbar-btn toolbar-btn-primary" id="addCommandBtn" disabled data-i18n-title="add_command">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="toolbar-btn" id="importFromKeyBtn" disabled data-i18n-title="copy_from_key">
                  <i class="fas fa-copy"></i>
                </button>
                <button class="toolbar-btn" id="validateChainBtn" data-i18n-title="validate_command_chain">
                  <i class="fas fa-check"></i>
                </button>
                <button class="toolbar-btn toolbar-btn-danger" id="clearChainBtn" data-i18n-title="clear_all_commands">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            
            <!-- Hidden checkbox for stabilize (controlled by toolbar button) -->
            <input type="checkbox" id="stabilizeExecutionOrder" style="display: none;" />
            
            <!-- Alias options dropdown (shown when alias options button is clicked) -->
            <div class="alias-options" id="aliasOptions" style="display: none;">
              <div class="custom-multiselect">
                <div class="multiselect-trigger" id="aliasOptionsDropdown">
                  <span class="multiselect-label" data-i18n="select_options">Select Options</span>
                  <i class="fas fa-chevron-down multiselect-arrow"></i>
                </div>
                <div class="multiselect-options" id="aliasOptionsMenu" style="display: none;">
                  <label class="multiselect-option">
                    <input type="checkbox" value="stabilize" id="aliasStabilizeOption">
                    <span data-i18n="stabilize_execution_order">Stabilise Execution Order</span>
                  </label>
                  <label class="multiselect-option">
                    <input type="checkbox" value="toggle" id="aliasToggleOption">
                    <span data-i18n="toggle_type">Toggle-Type</span>
                  </label>
                  <label class="multiselect-option">
                    <input type="checkbox" value="cycle" id="aliasCycleOption">
                    <span data-i18n="cycle_type">Cycle-Type</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="command-list-container">
            <div class="command-list" id="commandList">
              <div class="empty-state" id="emptyState">
                <i class="fas fa-keyboard"></i>
                <h4 data-i18n="no_key_selected"></h4>
                <p data-i18n="select_a_key_from_the_left_panel_to_view_and_edit_its_command_chain"></p>
              </div>
            </div>
          </div>

          <div class="generated-command">
            <div class="command-preview-header">
              <label data-i18n="generated_command"></label>
              <span class="command-count-display" id="commandCountDisplay">
                (<span id="commandCount">0</span> <span data-i18n="commands"></span> in chain)
              </span>
              <button
                class="btn btn-small"
                id="copyPreviewBtn"
                data-i18n-title="copy_to_clipboard"
              >
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="command-preview" id="commandPreview" data-i18n="select_a_key_to_see_the_generated_command"></div>
          </div>


        </div>

        <!-- Command Library -->
        <div class="command-library">
          <div class="library-header">
            <div class="library-header-left">
              <h3 data-i18n="command_library"></h3>
            </div>
            <div class="header-toolbar">
              <!-- Search -->
              <div class="toolbar-group">
                <div class="toolbar-search">
                  <input
                    type="text"
                    id="commandSearch"
                    data-i18n-placeholder="search_commands"
                    class="toolbar-search-input"
                  />
                  <button class="toolbar-btn toolbar-search-btn" id="commandSearchBtn" data-i18n-title="search_commands">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="library-content" id="libraryContent">
            <div class="command-categories" id="commandCategories">
              <!-- Categories populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Toast Notifications -->
      <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay"></div>

    <!-- Add Key Modal -->
    <div class="modal" id="addKeyModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="add_new_key"></h3>
          <button class="modal-close" data-modal="addKeyModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="newKeyName" data-i18n="key_name"></label>
            <input
              type="text"
              id="newKeyName"
              data-i18n-placeholder="enter_key_name"
              autocomplete="off"
            />
            <small data-i18n="use_alphanumeric_characters_only_no_spaces"></small>
          </div>
          
          <!-- Key Capture Section -->
          <div class="form-group">
            <label data-i18n="or_capture_keys">Or capture keys:</label>
            <div class="key-capture-section">
              <button 
                type="button" 
                class="btn btn-primary" 
                id="addKeyCaptureBtn"
                data-i18n="click_here_then_press_keys"
              >
                <i class="fas fa-keyboard"></i>
                <span data-i18n="click_here_then_press_keys">Click here, then press the key combination</span>
              </button>
              <div class="key-capture-status" id="addKeyCaptureStatus" style="display: none;">
                <div class="capture-indicator">
                  <i class="fas fa-circle-notch fa-spin"></i>
                  <span data-i18n="press_key_combination_now">Press the key combination now...</span>
                </div>
                <div class="captured-keys" id="addKeyCapturedKeys"></div>
                <div class="key-capture-confirm" id="addKeyConfirmSection" style="display: none;">
                  <span id="addKeyConfirmText"></span>
                  <div class="confirm-btns">
                    <button type="button" class="btn btn-success" id="addKeyConfirmYesBtn" data-i18n="yes">Yes</button>
                    <button type="button" class="btn btn-secondary" id="addKeyConfirmNoBtn" data-i18n="no">No</button>
                  </div>
                </div>
              </div>
            </div>
            <small data-i18n="supports_single_modifier_plus_key_combinations">Supports single modifier + key combinations (e.g., Ctrl+A, Alt+1, Shift+Space)</small>
          </div>
          
          <div class="common-keys">
            <h4 data-i18n="common_keys"></h4>
            <div class="key-suggestions">
              <button class="key-suggestion" data-key="F5">F5</button>
              <button class="key-suggestion" data-key="F6">F6</button>
              <button class="key-suggestion" data-key="F7">F7</button>
              <button class="key-suggestion" data-key="F8">F8</button>
              <button class="key-suggestion" data-key="Ctrl+1">Ctrl+1</button>
              <button class="key-suggestion" data-key="Ctrl+2">Ctrl+2</button>
              <button class="key-suggestion" data-key="Alt+1">Alt+1</button>
              <button class="key-suggestion" data-key="Shift+Space">
                Shift+Space
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="confirmAddKeyBtn" data-i18n="add_key"></button>
          <button class="btn btn-secondary" data-modal="addKeyModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- Add Command Modal -->
    <div class="modal" id="addCommandModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="add_command"></h3>
          <button class="modal-close" data-modal="addCommandModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="commandType" data-i18n="command_type"></label>
            <select id="commandType">
              <option value="" data-i18n="select_command_type"></option>
              <option value="targeting" data-i18n="targeting"></option>
              <option value="combat" data-i18n="combat"></option>
              <option value="cosmetic" data-i18n="cosmetic"></option>
              <option value="bridge_officer" data-i18n="bridge_officer"></option>
              <option value="tray" data-i18n="tray_execution"></option>
              <option value="power" data-i18n="shield_management"></option>
              <option value="movement" data-i18n="movement"></option>
              <option value="camera" data-i18n="camera"></option>
              <option value="communication" data-i18n="communication"></option>
              <option value="system" data-i18n="system"></option>
              <option value="alias" data-i18n="alias"></option>
              <option value="custom" data-i18n="custom_command"></option>
            </select>
          </div>

          <div class="command-builder" id="commandBuilder">
            <!-- Command builder content populated by JavaScript -->
          </div>

          <div class="command-preview-modal">
            <label data-i18n="generated_command"></label>
            <div class="command-preview" id="modalCommandPreview" data-i18n="select_a_command_type_to_see_preview"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="saveCommandBtn" disabled data-i18n="add_command"></button>
          <button class="btn btn-secondary" data-modal="addCommandModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="profileModalTitle" data-i18n="profile"></h3>
          <button class="modal-close" data-modal="profileModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="profileName" data-i18n="profile_name"></label>
            <input
              type="text"
              id="profileName"
              data-i18n-placeholder="enter_profile_name"
              autocomplete="off"
            />
          </div>
          <div class="form-group">
            <label for="profileDescription" data-i18n="description_optional"></label>
            <textarea
              id="profileDescription"
              data-i18n-placeholder="describe_this_keybind_profile"
              rows="3"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="saveProfileBtn" data-i18n="save"></button>
          <button class="btn btn-secondary" data-modal="profileModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- Alias Manager Modal -->
    <div class="modal large-modal" id="aliasManagerModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="command_alias_manager"></h3>
          <button class="modal-close" data-modal="aliasManagerModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="alias-manager-content">
            <div class="alias-list" id="aliasList">
              <!-- Aliases populated by JavaScript -->
            </div>
            <div class="alias-actions">
              <button class="btn btn-primary" id="newAliasBtn">
                <i class="fas fa-plus"></i>
                <span data-i18n="new_alias"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Alias Modal -->
    <div class="modal" id="editAliasModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="editAliasTitle" data-i18n="edit_alias"></h3>
          <button class="modal-close" data-modal="editAliasModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="aliasName" data-i18n="alias_name"></label>
            <input
              type="text"
              id="aliasName"
              data-i18n-placeholder="myalias"
              autocomplete="off"
            />
            <small data-i18n="use_alphanumeric_characters_only_no_spaces"></small>
          </div>
          <div class="form-group">
            <label for="aliasDescription" data-i18n="description"></label>
            <input
              type="text"
              id="aliasDescription"
              data-i18n-placeholder="brief_description_of_what_this_alias_does"
              autocomplete="off"
            />
          </div>
          <div class="form-group">
            <label for="aliasCommands" data-i18n="commands"></label>
            <div class="textarea-with-button">
              <textarea
                id="aliasCommands"
                data-i18n-placeholder="enter_command_sequence_use_to_separate_commands"
                rows="4"
              ></textarea>
              <button
                type="button"
                class="btn btn-small insert-target-btn"
                data-i18n-title="insert_target_variable"
              >
                <i class="fas fa-crosshairs"></i> <span data-i18n="target"></span>
              </button>
            </div>
            <small data-i18n="example_target_self_power_exec_science_team_team_healing_target"></small>
            <div class="variable-help">
              <strong>$Target</strong> <span data-i18n="use_in_communication_commands_to_include_target_name"></span>
            </div>
          </div>
          <div class="alias-preview">
            <label data-i18n="preview"></label>
            <div class="command-preview" id="aliasPreview" data-i18n="alias_myalias_command_sequence"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="saveAliasBtn" data-i18n="save_alias"></button>
          <button class="btn btn-secondary" data-modal="editAliasModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- Key Selection Modal -->
    <div class="modal large-modal" id="keySelectionModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="select_key_dialog_title">Select Key</h3>
          <button class="modal-close" data-modal="keySelectionModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="key-selection-content">
            <div class="key-selection-header">
              <h4 data-i18n="select_key">Select Key</h4>
              <p data-i18n="select_key_dialog_description">Choose from the available keys below:</p>
            </div>
            
            <!-- Preview Section (moved up) -->
            <div class="key-preview">
              <label data-i18n="key_combination">Key Combination:</label>
              <div class="key-preview-display" id="keyPreviewDisplay">
                <span class="no-selection" data-i18n="no_key_selected">No key selected</span>
              </div>
              <div class="key-preview-actions">
                <button class="btn" id="keySelectionCaptureBtn">
                  <i class="fas fa-keyboard"></i> <span data-i18n="capture_key">Capture Key</span>
                </button>
                <button class="btn btn-primary" id="confirmKeySelection" disabled data-i18n="select_this_key">
                  Select This Key
                </button>
              </div>
              
              <!-- Key Capture Status Popup -->
              <div class="key-capture-status" id="keyCaptureStatus" style="display: none;">
                <div class="capture-indicator">
                  <i class="fas fa-circle-notch fa-spin"></i>
                  <span data-i18n="press_key_combination_now">Press the key combination now...</span>
                </div>
                <div class="captured-keys" id="capturedKeys"></div>
              </div>
            </div>
            
            <!-- Modifier + Key Selection Section -->
            <div class="modifier-key-selection">
              <h4 data-i18n="select_modifier_key">Select Modifier + Key</h4>
              
              <!-- Step 1: Modifier Selection -->
              <div class="modifier-selection">
                <label data-i18n="step_1_select_modifiers_optional">Step 1: Select Modifiers (Optional)</label>
                <div class="modifier-buttons">
                  <button class="modifier-btn" data-modifier="Ctrl" data-selected="false">
                    <span class="modifier-label" data-i18n="ctrl">Ctrl</span>
                  </button>
                  <button class="modifier-btn" data-modifier="Alt" data-selected="false">
                    <span class="modifier-label" data-i18n="alt">Alt</span>
                  </button>
                  <button class="modifier-btn" data-modifier="Shift" data-selected="false">
                    <span class="modifier-label" data-i18n="shift">Shift</span>
                  </button>
                </div>
              </div>
              
              <!-- Step 2: Key Selection -->
              <div class="key-selection">
                <label data-i18n="step_2_select_key">Step 2: Select Key</label>
                <div class="key-selection-tabs">
                  <button class="tab-btn active" data-tab="common" data-i18n="common">Common</button>
                  <button class="tab-btn" data-tab="letters" data-i18n="letters">Letters</button>
                  <button class="tab-btn" data-tab="numbers" data-i18n="numbers">Numbers</button>
                  <button class="tab-btn" data-tab="function" data-i18n="function">Function</button>
                  <button class="tab-btn" data-tab="arrows" data-i18n="arrows">Arrows</button>
                  <button class="tab-btn" data-tab="symbols" data-i18n="symbols">Symbols</button>
                  <button class="tab-btn" data-tab="mouse" data-i18n="mouse">Mouse</button>
                  <button class="tab-btn" data-tab="gamepad" data-i18n="gamepad">Gamepad</button>
                </div>
                
                <div class="key-tab-content">
                  <div class="key-tab active" id="common-tab">
                    <div class="key-grid" id="commonKeyGrid">
                      <!-- Common keys populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="letters-tab">
                    <div class="key-grid" id="lettersKeyGrid">
                      <!-- Letter keys populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="numbers-tab">
                    <div class="key-grid" id="numbersKeyGrid">
                      <!-- Number keys populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="function-tab">
                    <div class="key-grid" id="functionKeyGrid">
                      <!-- Function keys populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="arrows-tab">
                    <div class="key-grid" id="arrowsKeyGrid">
                      <!-- Arrow keys populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="symbols-tab">
                    <div class="key-grid" id="symbolsKeyGrid">
                      <!-- Symbol keys populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="mouse-tab">
                    <div class="key-grid" id="mouseKeyGrid">
                      <!-- Mouse controls populated by JavaScript -->
                    </div>
                  </div>
                  <div class="key-tab" id="gamepad-tab">
                    <div class="key-grid" id="gamepadKeyGrid">
                      <!-- Gamepad controls populated by JavaScript -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-modal="keySelectionModal" data-i18n="cancel">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal large-modal" id="vertigoModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="vfx_manager">VFX Manager</h3>
          <button class="modal-close" data-modal="vertigoModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="vertigo-content">
            <div class="vertigo-header">
              <p>
                Select visual effects to disable using dynFxSetFXExlusionList
                aliases. Effects are organized by environment.
              </p>
            </div>
            <div class="vertigo-environments">
              <div class="vertigo-environment">
                <div class="environment-header">
                  <h4><i class="fas fa-rocket"></i> Space Effects</h4>
                  <div class="environment-controls">
                    <button class="btn btn-small" id="spaceSelectAll" data-i18n="select_all">
                      Select All
                    </button>
                    <button class="btn btn-small" id="spaceClearAll" data-i18n="clear_all">
                      Clear All
                    </button>
                    <span class="effect-count" id="spaceEffectCount"
                      >0 selected</span
                    >
                  </div>
                </div>
                <div class="effects-list" id="spaceEffectsList">
                  <!-- Space effects populated by JavaScript -->
                </div>
              </div>
              <div class="vertigo-environment">
                <div class="environment-header">
                  <h4><i class="fas fa-user"></i> Ground Effects</h4>
                  <div class="environment-controls">
                    <button class="btn btn-small" id="groundSelectAll" data-i18n="select_all">
                      Select All
                    </button>
                    <button class="btn btn-small" id="groundClearAll" data-i18n="clear_all">
                      Clear All
                    </button>
                    <span class="effect-count" id="groundEffectCount"
                      >0 selected</span
                    >
                  </div>
                </div>
                <div class="effects-list" id="groundEffectsList">
                  <!-- Ground effects populated by JavaScript -->
                </div>
              </div>
            </div>
            <div class="vertigo-preview">
              <div class="alias-preview-section">
                <h4>Generated Aliases:</h4>
                <div class="alias-preview" id="spaceAliasPreview">
                  <label>Space Alias:</label>
                  <div class="command-preview" id="spaceAliasCommand" data-i18n="no_space_effects_selected">
                    No space effects selected
                  </div>
                </div>
                <div class="alias-preview" id="groundAliasPreview">
                  <label>Ground Alias:</label>
                  <div class="command-preview" id="groundAliasCommand" data-i18n="no_ground_effects_selected">
                    No ground effects selected
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="vertigo-controls">
            <label class="checkbox-label">
              <input type="checkbox" id="vertigoShowPlayerSay" />
              <span class="checkmark"></span>
              <span data-i18n="show_player_say">Show Player Say</span>
            </label>
          </div>

          <button class="btn btn-primary" id="saveVertigoBtn" data-i18n="generate_aliases">
            Generate Aliases
          </button>
          <button class="btn btn-secondary" data-modal="vertigoModal">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="about_sto_tools_keybind_manager"></h3>
          <button class="modal-close" data-modal="aboutModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="about-content">
            <div class="app-info">
              <h4>
                <i class="fas fa-bolt"></i>
                <span data-i18n="sto_tools_keybind_manager"></span>
                <span id="aboutVersion"></span>
              </h4>
              <p data-i18n="a_comprehensive_web_based_tool_for_creating_editing_and_managing_star_trek_online_keybind_configurations_with_visual_editing_and_advanced_features">
                A comprehensive web-based tool for creating, editing, and
                managing Star Trek Online keybind configurations with visual
                editing and advanced features.
              </p>
            </div>
            <div class="features">
              <h4 data-i18n="features">Features:</h4>
              <ul>
                <li data-i18n="visual_keybind_editor">Visual keybind editor</li>
                <li data-i18n="sto_command_library_with_search_and_categorization">STO command library with search and categorization</li>
                <li data-i18n="multiple_profile_management_create_clone_rename_delete">
                  Multiple profile management (create, clone, rename, delete)
                </li>
                <li data-i18n="custom_alias_system_for_complex_command_sequences">Custom alias system for complex command sequences</li>
                <li data-i18n="vertigo_inspired_vfx_manager_for_visual_effects_control">VERTIGO-inspired VFX Manager for visual effects control</li>
                <li data-i18n="import_export_keybind_and_alias_files_and_project_backups">
                  Import/export keybind and alias files, and project backups
                </li>
                <li data-i18n="real_time_validation_and_command_preview">Real-time validation and command preview</li>
              </ul>
            </div>
            <div class="usage">
              <h4 data-i18n="quick_start">Quick Start:</h4>
              <ol>
                <li data-i18n="create_a_new_profile_or_use_the_default_profile">Create a new profile or use the default profile</li>
                <li data-i18n="select_keys_from_the_grid_and_add_commands_from_the_library">
                  Select keys from the grid and add commands from the library
                </li>
                <li data-i18n="use_the_command_chain_editor_to_build_complex_sequences">Use the command chain editor to build complex sequences</li>
                <li data-i18n="export_your_keybinds_as_txt_files_for_use_in_sto">Export your keybinds as .txt files for use in STO</li>
              </ol>
            </div>
            <div class="contact-info">
              <h4 data-i18n="resources">Resources:</h4>
              <p>
                <i class="fas fa-globe"></i>
                <a
                  href="https://sto-tools.org/"
                  target="_blank"
                  rel="noopener noreferrer"
                >https://sto-tools.org/</a>
                | <i class="fas fa-envelope"></i>
                <a href="mailto:keybinds@sto-tools.org">keybinds@sto-tools.org</a>
              </p>
            </div>
            <div class="copyright">
              <p><small data-i18n="copyright">© 2025 STO Tools. All rights reserved.</small></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" data-modal="aboutModal" data-i18n="got_it"></button>
        </div>
      </div>
    </div>

    <!-- Preferences Modal -->
    <div class="modal large-modal" id="preferencesModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="preferences"></h3>
          <button class="modal-close" data-modal="preferencesModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="preferences-layout">
            <!-- Category Tree -->
            <div class="preferences-sidebar">
              <div class="category-tree">
                <div class="category-item active" data-category="sync">
                  <i class="fas fa-sync-alt"></i>
                  <span data-i18n="synchronization"></span>
                </div>
              </div>
            </div>
            
            <!-- Settings Content -->
            <div class="preferences-content">
                              <!-- Sync Settings -->
                <div class="settings-panel active" id="sync-settings">
                  <h4 data-i18n="synchronization_settings"></h4>
                  <div class="settings-group">
                    <div class="setting-item">
                      <label data-i18n="sync_folder_label"></label>
                      <div class="setting-control">
                        <div class="folder-setting">
                          <span id="currentSyncFolder" class="folder-path" data-i18n="no_folder_selected"></span>
                          <button type="button" class="btn btn-secondary" id="setSyncFolderBtn">
                            <i class="fas fa-folder-open"></i>
                            <span data-i18n="set_sync_folder"></span>
                          </button>
                        </div>
                        <span class="setting-description" data-i18n="sync_folder_description"></span>
                      </div>
                    </div>
                    <div class="setting-item">
                      <label data-i18n="auto_sync"></label>
                      <div class="setting-control">
                        <label class="toggle-switch">
                          <input type="checkbox" id="autoSync">
                          <span class="slider"></span>
                        </label>
                        <span class="setting-description" data-i18n="auto_sync_description"></span>
                      </div>
                    </div>
                    <div class="setting-item">
                      <label data-i18n="auto_sync_interval"></label>
                      <div class="setting-control">
                        <select id="autoSyncInterval" class="setting-select">
                          <option value="change" data-i18n="after_every_change"></option>
                          <option value="60" data-i18n="every_1_minute"></option>
                          <option value="120" data-i18n="every_2_minutes"></option>
                          <option value="300" data-i18n="every_5_minutes"></option>
                        </select>
                        <span class="setting-description" data-i18n="auto_sync_interval_description"></span>
                      </div>
                    </div>
                  </div>
                </div>


            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="savePreferencesBtn" data-i18n="save"></button>
          <button class="btn btn-secondary" data-modal="preferencesModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- File Explorer Modal -->
    <div class="modal large-modal" id="fileExplorerModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="file_explorer"></h3>
          <button class="modal-close" data-modal="fileExplorerModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="file-explorer-content">
            <div class="file-tree" id="fileTree">
              <!-- Tree populated by JavaScript -->
            </div>
            <div class="file-details">
              <div class="file-actions">
                <button
                  class="btn btn-small"
                  id="copyFileContentBtn"
                  data-i18n-title="copy_to_clipboard"
                >
                  <i class="fas fa-copy"></i>
                  <span data-i18n="copy"></span>
                </button>
                <button
                  class="btn btn-small"
                  id="downloadFileBtn"
                >
                  <i class="fas fa-download"></i>
                  <span data-i18n="download"></span>
                </button>
              </div>
              <pre class="file-content" id="fileContent" data-i18n="select_an_item_on_the_left_to_preview_export"></pre>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-modal="fileExplorerModal" data-i18n="close"></button>
        </div>
    </div>
  </div>

    <!-- Export Options Modal -->
    <div class="modal" id="exportModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="select_export_format"></h3>
          <button class="modal-close" data-modal="exportModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="exportFormat" data-i18n="export_as"></label>
            <select id="exportFormat">
              <option value="sto_keybind" data-i18n="sto_keybind_file_txt"></option>
              <option value="json_profile" data-i18n="json_profile_json"></option>
              <option value="json_project" data-i18n="complete_project_json"></option>
              <option value="csv_data" data-i18n="csv_data_csv"></option>
              <option value="html_report" data-i18n="html_report_html"></option>
              <option value="alias_file" data-i18n="alias_file_txt"></option>
            </select>
          </div>
          <div class="form-group">
            <label for="exportEnvironment" data-i18n="environment"></label>
            <select id="exportEnvironment">
              <option value="space" data-i18n="space"></option>
              <option value="ground" data-i18n="ground"></option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="confirmExportBtn" data-i18n="export"></button>
          <button class="btn btn-secondary" data-modal="exportModal" data-i18n="cancel"></button>
        </div>
      </div>
    </div>

    <!-- File input for imports (hidden) -->
    <input
      type="file"
      id="fileInput"
      accept=".json,.txt"
      style="display: none"
    />

    <!-- Scripts -->
    <script src="dist/bundle.js"></script>
  </body>
</html>
